---
version: gc/alpha1
kind: IngressDomain
spec:
  domain: docs.service.newrelic.com
  visibility: external
  # Note: target_environment is omitted because this service is NOT deployed via Grand Central
  # For non-GPC services, the upstream must be synced manually via Grand Central UI

  # Upstream configuration - where to send the traffic (Netlify)
  upstreams:
    - name: netlify-docs
      hostname: docs.newrelic.com
      port: 443
      protocol: https
      # This points to the Netlify-hosted docs site
      environment: production

  # Routing rules
  routes:
    - name: default-route
      priority: 100
      config:
        matchOn:
          path:
            prefix: "/"
        upstream: netlify-docs
        options:
          timeout: 10s
          # Start with 5% traffic to ERS, 95% to Service Gateway
          percentToSendToSG: 95
          cors:
            enabled: true
            # Default allowed origins - adjust if needed
            allowOrigins:
              - "https://*.newrelic.com"
              - "https://newrelic.com"
            allowMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowHeaders:
              - "Content-Type"
              - "Authorization"
              - "X-Requested-With"
              - "Accept"
            exposeHeaders:
              - "Content-Length"
              - "Content-Type"
            maxAge: 86400
            allowCredentials: true
          csrf:
            enabled: true
          auth:
            type: unauthenticated