
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">Add-on Managers</a></strong></p>
</div>
<p>If you use Gradle or Android Studio, follow these instructions to install New Relic Mobile for the first time. If you have previously installed the Android agent SDK for New Relic Mobile, follow the <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure/upgrade-new-relic-mobiles-android-sdk#android_upgrade_1">steps before upgrading</a> to the latest version with Gradle and Android Studio.</p>
<h2>Install your Android app [#installation]</h2>
<p>As part of the installation process, New Relic Mobile automatically generates an <a href="/docs/mobile-apps/viewing-your-application-token">application token</a>. This is a 40-character hexadecimal string for authenticating each mobile app you monitor in New Relic Mobile.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">Add-on Managers</a></strong></p>
</div>
<p>If you have an existing New Relic account, follow this procedure to install and configure your Android application. If you do not have a New Relic account, get <a href="/docs/mobile-monitoring/new-relic-mobile/getting-started/introduction-new-relic-mobile">New Relic Mobile</a>.</p>
<ol>
  <li>Go to <strong><a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a></strong>.</li>
  <li>If applicable: From the <a href="/docs/mobile-monitoring/mobile-monitoring-ui/mobile-app-pages/mobile-apps-index"><strong>Mobile apps</strong> index</a>, select <strong>Add a new app</strong>. 
    <img src="./images/screen-mobile-app-add.png" alt="screen mobile app add.png" title="screen mobile app add.png">
  </li>
  <li>From the <strong>Get started</strong> page, select <strong>Android</strong> as the platform for mobile monitoring.</li>
  <li>Type a meaningful name for your mobile app, and select <strong>Continue</strong>.</li>
</ol>
<p>Continue with the steps to <a href="#configuration">configure New Relic Mobile</a> with Gradle and Android Studio.</p>
<p>OR:</p>
<ul>
  <li>To complete the configuration process for a new mobile app later: Go to <strong><a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a></strong>, then select <strong>See instructions</strong> next to your mobile app name.</li>
  <li>To upgrade an existing Android installation: Go to <strong><a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a> > (select an app) > Settings > Installation</strong>.</li>
</ul>
<h2>Configure with Gradle and Android Studio [#configuration]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">Add-on Managers</a></strong></p>
</div>
<p>These procedures to configure your Android app with Gradle and Android Studio also appear on the <strong>Get started</strong> page in New Relic Mobile.</p>
<ol>
  <li>
    <p>Merge the New Relic Mobile code in the <strong>Gradle &#x26; Android Studio</strong> tab to your <code>build.gradle</code> file.</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHJvamVjdC1sZXZlbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUHJvamVjdCBsZXZlbCBidWlsZC5ncmFkbGUgZmlsZToifV0=">
        <div data-prop-text="title">Project level build.gradle file:</div>
        <p>In this example, AGENT_VERSION represents your agent version number. See the <a href="/docs/release-notes/mobile-release-notes/android-release-notes">agent release notes</a>, and use the latest version.</p>
        <pre><code>buildscript {
  repositories {
    mavenCentral()
  }

  dependencies {
    classpath "com.newrelic.agent.android:agent-gradle-plugin:AGENT_VERSION"
  }
}

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXBwLWxldmVsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBcHAgbGV2ZWwgYnVpbGQuZ3JhZGxlIGZpbGU6In1d">
        <div data-prop-text="title">App level build.gradle file:</div>
        <p>In this example, AGENT_VERSION represents your agent version number. See the <a href="/docs/release-notes/mobile-release-notes/android-release-notes">agent release notes</a>, and use the latest version.</p>
        <pre><code>repositories {
  mavenCentral()
}

apply plugin: 'android'
apply plugin: 'newrelic'

dependencies {
  compile 'com.newrelic.agent.android:android-agent:AGENT_VERSION'
}

</code></pre>
      </div>
    </div>
  </li>
  <li>
    <p><strong>ProGuard or DexGuard:</strong> In your project’s root directory (<code>projectname/app</code>), add a <code>newrelic.properties</code> file with the following line:</p>
    <pre><code>com.newrelic.application_token=GENERATED_TOKEN
</code></pre>
  </li>
  <li>
    <p>Follow the additional, <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-proguard-or-dexguard-android-apps">required configuration steps for using ProGuard or DexGuard</a> with New Relic.</p>
  </li>
  <li>
    <p>Set app permissions: Ensure that your Android app requests <code>INTERNET</code> and <code>ACCESS_NETWORK_STATE</code> permissions by adding these lines to your <code>AndroidManifest.xml</code> file:</p>
    <pre><code>&#x3C;uses-permission android:name="android.permission.INTERNET" />
&#x3C;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
</code></pre>
  </li>
  <li>
    <p>To start the New Relic Mobile agent: In your <strong>Default Activity</strong> (as defined in your <strong>Manifest</strong>), import the <code>NewRelic</code> class:</p>
    <pre><code>import com.newrelic.agent.android.NewRelic;
</code></pre>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>New Relic does not support starting the Mobile agent in other classes, as that can cause unexpected or unstable behavior.</p>
    </div>
  </li>
  <li>
    <p>To initialize New Relic Mobile: In the <code>onCreate()</code> method, add this call:</p>
    <pre><code>NewRelic.withApplicationToken("GENERATED_TOKEN").start(this.getApplication());
</code></pre>
  </li>
  <li>
    <p>Optional: Change the <a href="/docs/mobile-monitoring/new-relic-mobile-android/api-guides/android-agent-configuration-feature-flags#logging">logging level</a>.</p>
  </li>
  <li>
    <p>To build and run your application: Clean your project, then run your app in an emulator or device to generate traffic.</p>
  </li>
  <li>
    <p>Wait a few minutes, then view data for your Android app from the <a href="/docs/mobile-monitoring/mobile-monitoring-ui/mobile-app-pages/mobile-apps-overview-page">New Relic Mobile <strong>Overview</strong> page</a>: Go to <strong><a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a> > (select an app)</strong>.</p>
  </li>
</ol>
<p>If you have problems with your Android installation, or if you do not see data in the New Relic Mobile UI for your Android app, follow the <a href="/docs/mobile-monitoring/new-relic-mobile-android/troubleshoot/no-data-appears-android">troubleshooting procedures</a>.</p>
<h2>Update your Android installation [#upgrading]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">Add-on Managers</a></strong></p>
</div>
<p>To keep your Android agent up to date, follow the procedures to <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure/upgrading-new-relic-mobiles-android-sdk">upgrade the Android agent SDK</a> for New Relic Mobile. To install the latest Android version for your mobile app: Go to <strong><a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a> > (select an app) > Settings > Installation</strong>.</p>
<h2>Android 4.x: Multidex support [#4x-multidex]</h2>
<p>New Relic Mobile for Android versions prior to Android 5.0 (API level 21) use the Dalvik runtime to execute app code. By default, Dalvik limits apps to a single <code>classes.dex</code> bytecode file per APK. In order to get around this limitation, you <strong>must</strong> <a href="https://developer.android.com/studio/build/multidex.html">enable multidex support</a>. Then you can use the <a href="https://developer.android.com/tools/support-library/features.html#multidex">multidex support library</a>, which becomes part of the primary DEX file of your app and then manages access to the additional DEX files and the code they contain.</p>
<p>When building each DEX file for a multidex app, the build tools perform complex decision making to determine which classes are needed in the primary DEX file so that your app can start successfully. If any class required during startup is not provided in the primary DEX file, then your app crashes with the error <code>java.lang.NoClassDefFoundError</code>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">Add-on Managers</a></strong></p>
</div>
<p>If you see the <code>java.lang.NoClassDefFoundError</code> error, then you must <a href="https://developer.android.com/studio/build/multidex.html#keep">manually specify these additional classes as required</a> in the primary DEX file:</p>
<ol>
  <li>
    <p>Create a <code>proguard.multidex.config</code> file within the <code>/app</code> folder of your project. Update <code>mypackage</code> to reflect your package name.</p>
    <pre><code>####################
# keep class names #
####################

#Keep New Relic in the main dex
-keep class com.newrelic.** { *; }
-keep class com.mypackage.activities.** { *; }
</code></pre>
  </li>
  <li>
    <p>Merge the following code into the app-level <code>build.gradle</code> file:</p>
    <pre><code>android { 
    defaultConfig{
        …
        multiDexKeepProguard file("proguard.multidex.config")
    }
}
</code></pre>
  </li>
</ol>
<p>For more information, see the <a href="https://developer.android.com/studio/build/multidex.html#keep">Android Developers documentation</a> on declaring classes required in the primary DEX file.</p>
<h2>New Relic Gradle Plugin configuration [#more_help]</h2>
<p>For details on how to configure the behavior of the agent plugin during Gradle builds, see the <a href="https://docs.newrelic.com/docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-new-relic-gradle-plugin">New Relic Gradle plugin</a> extension guide.</p>
