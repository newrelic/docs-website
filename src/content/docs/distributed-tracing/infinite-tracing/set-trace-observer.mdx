---
title: Set up the trace observer
tags:
  - Understand dependencies
  - Distributed tracing
  - Infinite Tracing
metaDescription: 'How to set up New Relic''s trace observer, which is required for enabling our tracing tools that use Infinite Tracing.'
redirects:
  - /docs/infinite-tracing-configure-trace-observer
  - /docs/infinite-tracing-set-trace-observer
  - /docs/set-infinite-tracing
  - /docs/configure-trace-observer
  - /docs/understand-dependencies/distributed-tracing/infinite-tracing/configure-trace-observer
  - /docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer
---

If you are following the [steps](/docs/distributed-tracing/enable-configure/quick-start) to set up distributed tracing and are continuing with the steps for the advanced option called Infinite Tracing, you need to set up a trace observer. The trace observer is what allows you to go beyond the basic [head-based sampling](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#head-based) of standard distributed tracing. 

The trace observer is a cloud-based New Relic tool that uses [tail-based sampling](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#tail-based) to decide what trace data to keep and send to New Relic. The trace observer is an AWS-based service that provides you with a low-latency and low-cost way to send your telemetry data to New Relic. The trace observer sends data via our Trace API, which is the entry point for all distributed trace data we ingest.

Complete the trace observer setup up that fits your types of data sources (services, apps, or entities). You may need to do setup steps in more than one section if you have a variety of types:

* [Services instrumented with APM agents and third-party telemetry tools](#apm-and-third-party)
* [Services instrumented with New Relic browser, mobile, and lambda](#browser-mobile-lambda)
* [(Optional) Additional configuration for all service types](#follow-up-config)

<Callout variant="tip">
Do some of your requests communicate with services that are still using standard distributed tracing? To avoid [configuration conflicts](/docs/understand-dependencies/distributed-tracing/troubleshooting/infinite-tracing-trace-configuration-conflicts), you should ideally enable Infinite Tracing for all associated services.
</Callout>

## Services instrumented with APM agents and third-party telemetry tools [#apm-and-third-party]

To create a new trace observer if you're using New Relic APM agents or third-party integrations:

1. Go to [one.newrelic.com](https://one.newrelic.com), and click **Apps**. Under **Your apps**, click **New Relic Edge**.
2. Select an account in the upper-left dropdown. If you have access to multiple accounts, make sure you're in the account where you want Infinite Tracing enabled.
3. If no trace observers are already present, click **New trace observer** to add one, fill out the information, and click **Create**.

   <Callout variant="important">
     Note: If you select a trace observer in an EU region, you’ll still need a US-based New Relic account because data is reported to US data centers.
   </Callout>

4. Under the **Endpoints** dropdown, copy the endpoint value under **For other integrations** and have it ready. This value is referenced in our code examples as <var>YOUR_TRACE_OBSERVER_URL</var>. This is used to test the [trace observer](#sample-payload), as well as to configure our [telemetry integrations](/docs/distributed-tracing/enable-configure/quick-start) and for sending data via the [Trace API](/docs/distributed-tracing/trace-api/introduction-trace-api/).

5. If you are setting up an APM agent, you should also copy the endpoint value under **For language agents** and have it ready. This value is referenced in our code examples as <var>YOUR_TRACE_OBSERVER_HOST</var>. This is used for [configuring our language agents to send data to the trace observer](/docs/distributed-tracing/enable-configure/quick-start).

6. (Optional) To verify the trace observer is working, we recommend sending a sample trace payload. If you're using our [Trace API](/docs/understand-dependencies/distributed-tracing/trace-api/introduction-trace-api) directly, this will help you learn how the API works.

   <CollapserGroup>
     <Collapser
       id="sample-request"
       title="Send sample payload"
     >
       <Callout variant="important">
         If you're using Zipkin-format data, see [Send Zipkin payload](/docs/understand-dependencies/distributed-tracing/trace-api/report-zipkin-format-traces-trace-api#send-zipkin-curl).
       </Callout>

       This test sends a sample trace payload with one trace and two spans from a service named `Test Service A`.

       To send this sample request:

       1. Get the [license key](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key) for the account you want to report data to and have it ready.
       2. Copy the following `curl` request into a text editor:

          ```
          curl -i -H "Content-Type: application/json" \
            -H "Api-Key: <var>$YOUR_LICENSE_KEY</var>" \
            -H 'Data-Format: newrelic' \
            -H 'Data-Format-Version: 1' \
            -X POST \
            -d '[
                {
                    "common": {
                    "attributes": {
                        "environment": "staging"
                    }
                    },
                    "spans": [
                    {
                        "trace.id": "123456",
                        "id": "ABC",
                        "attributes": {
                            "duration.ms": 12.53,
                            "host": "host123.example.com",
                            "name": "/home",
                            "service.name": "Test Service A"
                        }
                    },
                    {
                        "trace.id": "123456",
                        "id": "DEF",
                        "attributes": {
                            "duration.ms": 2.97,
                            "host": "host456.example.com",
                            "error.message": "Invalid credentials",
                            "name": "/auth",
                            "parent.id": "ABC",
                            "service.name": "Test Service B"
                        }
                    }
                    ]
                }
                ]' \
          '<var>$YOUR_TRACE_OBSERVER_URL</var>'
          ```
       3. Insert your own values into the `curl` request:

          <table>
            <thead>
              <tr>
                <th>
                  Value
                </th>

                <th>
                  Description
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  <var>
                    $YOUR_LICENSE_KEY
                  </var>
                </td>

                <td>
                  Replace this with your [license key](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key).
                </td>
              </tr>

              <tr>
                <td>
                  <var>
                    $YOUR_TRACE_OBSERVER_URL
                  </var>
                </td>

                <td>
                  Replace this with the **For other integrations** endpoint value you copied in a previous step.
                </td>
              </tr>
            </tbody>
          </table>
       4. Copy the curl request into a terminal and execute it.
       5. The test should return `HTTP/1.1 202 Accepted`, indicating success. If it does not, check the following common issues:
          * Confirm that you used the [**For other integrations** endpoint](#endpoints) value.
          * Confirm you're using single quotes around <var>YOUR_TRACE_OBSERVER_URL</var>.
          * Check that you're using the correct API key.
       6. If your test returned `HTTP/1.1 202 Accepted`, go to the New Relic UI to see a query of the sample payload data using the span attribute `service.name = Test Service A` ([here's a link for that query](https://one.newrelic.com/launcher/distributed-tracing-nerdlets.distributed-tracing?launcher=eyJ0aW1lUmFuZ2UiOnsiYmVnaW5fdGltZSI6bnVsbCwiZW5kX3RpbWUiOm51bGwsImR1cmF0aW9uIjoxODAwMDAwfSwiJGlzRmFsbGJhY2tUaW1lUmFuZ2UiOnRydWV9&pane=eyJuZXJkbGV0SWQiOiJkaXN0cmlidXRlZC10cmFjaW5nLW5lcmRsZXRzLmRpc3RyaWJ1dGVkLXRyYWNpbmctbGF1bmNoZXIiLCJzb3J0SW5kZXgiOjAsInNvcnREaXJlY3Rpb24iOiJERVNDIiwicXVlcnkiOnsib3BlcmF0b3IiOiJBTkQiLCJpbmRleFF1ZXJ5Ijp7ImNvbmRpdGlvblR5cGUiOiJJTkRFWCIsIm9wZXJhdG9yIjoiQU5EIiwiY29uZGl0aW9ucyI6W119LCJzcGFuUXVlcnkiOnsib3BlcmF0b3IiOiJBTkQiLCJjb25kaXRpb25TZXRzIjpbeyJjb25kaXRpb25UeXBlIjoiU1BBTiIsIm9wZXJhdG9yIjoiQU5EIiwiY29uZGl0aW9ucyI6W3siYXR0ciI6InNlcnZpY2UubmFtZSIsIm9wZXJhdG9yIjoiRVEiLCJ2YWx1ZSI6IlRlc3QgU2VydmljZSBBIn1dfV19fX0=)). Because the sample payload contains an error attribute, the error sampler will mark it for keeping. If you modify the payload to remove the error attributes, the random sampler may not choose to keep this particular trace.

          <Callout variant="tip">
            Traces may take up to one minute to show up in the UI.
          </Callout>
     </Collapser>
   </CollapserGroup>

7. Bookmark the [optional configurations](#follow-up-config) below so you can return to them after you experiment with Infinite Tracing.

8. Return to your original distributed tracing setup instructions for your agent or third-party telemetry tool and insert your new endpoint value in the configuration for each service.

9. If you have some services instrumented with New Relic browser, mobile, or lambda, follow the steps in that [section](#browser-mobile-lambda) to select your data sources (services, apps, or entities) in the trace observer.

## Services instrumented with New Relic browser, mobile, and lambda [#browser-mobile-lambda]

To create a new trace observer if you're using New Relic browser, mobile, or lambda, you follow similar steps to those for [APM agents and third-party integrations](#apm-and-third-party). Where this setup differs is that you don't need to insert a new trace observer endpoint in each service's configuration. Instead, you complete a separate configuration in the trace observer that specifies which data sources (services, apps, or entities) should have their data sent to the Infinite Tracing trace observer. 

If you already created a trace observer while setting up another type of service (for example, an APM agent), you can skip the steps about creating the trace observer and go right to [Initial trace observer configuration for browser, mobile, and lambda](#initial-config) to select your data sources.

### Create a trace observer [#create-for-mlb]

If you haven't already set up a trace observer, complete the following:

1. Go to [one.newrelic.com](https://one.newrelic.com), and click **Apps**. Under **Your apps**, click **New Relic Edge**.
2. Select an account in the upper-left dropdown. If you have access to multiple accounts, make sure you're in the account where you want Infinite Tracing enabled.
3. If no trace observers are already present, click **New trace observer** to add one, fill out the information, and click **Create**.

   <Callout variant="important">
     Note: If you select a trace observer in an EU region, you’ll still need a US-based New Relic account because data is reported to US data centers.
   </Callout>

4. Under the **Endpoints** dropdown, copy the endpoint value under **For other integrations** and have it ready. This value is referenced in our code examples as <var>YOUR_TRACE_OBSERVER_URL</var>. This is used to test the [trace observer](#sample-payload).

5. (Optional) To verify the trace observer is working, we recommend sending a sample trace payload. 

   <CollapserGroup>
     <Collapser
       id="sample-request"
       title="Send sample payload"
     >
       <Callout variant="important">
         If you're using Zipkin-format data, see [Send Zipkin payload](/docs/understand-dependencies/distributed-tracing/trace-api/report-zipkin-format-traces-trace-api#send-zipkin-curl).
       </Callout>

       This test sends a sample trace payload with one trace and two spans from a service named `Test Service A`.

       To send this sample request:

       1. Get the [license key](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key) for the account you want to report data to and have it ready.
       2. Copy the following `curl` request into a text editor:

          ```
          curl -i -H "Content-Type: application/json" \
            -H "Api-Key: <var>$YOUR_LICENSE_KEY</var>" \
            -H 'Data-Format: newrelic' \
            -H 'Data-Format-Version: 1' \
            -X POST \
            -d '[
                {
                    "common": {
                    "attributes": {
                        "environment": "staging"
                    }
                    },
                    "spans": [
                    {
                        "trace.id": "123456",
                        "id": "ABC",
                        "attributes": {
                            "duration.ms": 12.53,
                            "host": "host123.example.com",
                            "name": "/home",
                            "service.name": "Test Service A"
                        }
                    },
                    {
                        "trace.id": "123456",
                        "id": "DEF",
                        "attributes": {
                            "duration.ms": 2.97,
                            "host": "host456.example.com",
                            "error.message": "Invalid credentials",
                            "name": "/auth",
                            "parent.id": "ABC",
                            "service.name": "Test Service B"
                        }
                    }
                    ]
                }
                ]' \
          '<var>$YOUR_TRACE_OBSERVER_URL</var>'
          ```
       3. Insert your own values into the `curl` request:

          <table>
            <thead>
              <tr>
                <th>
                  Value
                </th>

                <th>
                  Description
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  <var>
                    $YOUR_LICENSE_KEY
                  </var>
                </td>

                <td>
                  Replace this with your [license key](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key).
                </td>
              </tr>

              <tr>
                <td>
                  <var>
                    $YOUR_TRACE_OBSERVER_URL
                  </var>
                </td>

                <td>
                  Replace this with the **For other integrations** endpoint value you copied in a previous step.
                </td>
              </tr>
            </tbody>
          </table>
       4. Copy the curl request into a terminal and execute it.
       5. The test should return `HTTP/1.1 202 Accepted`, indicating success. If it does not, check the following common issues:
          * Confirm that you used the [**For other integrations** endpoint](#endpoints) value.
          * Confirm you're using single quotes around <var>YOUR_TRACE_OBSERVER_URL</var>.
          * Check that you're using the correct API key.
       6. If your test returned `HTTP/1.1 202 Accepted`, go to the New Relic UI to see a query of the sample payload data using the span attribute `service.name = Test Service A` ([here's a link for that query](https://one.newrelic.com/launcher/distributed-tracing-nerdlets.distributed-tracing?launcher=eyJ0aW1lUmFuZ2UiOnsiYmVnaW5fdGltZSI6bnVsbCwiZW5kX3RpbWUiOm51bGwsImR1cmF0aW9uIjoxODAwMDAwfSwiJGlzRmFsbGJhY2tUaW1lUmFuZ2UiOnRydWV9&pane=eyJuZXJkbGV0SWQiOiJkaXN0cmlidXRlZC10cmFjaW5nLW5lcmRsZXRzLmRpc3RyaWJ1dGVkLXRyYWNpbmctbGF1bmNoZXIiLCJzb3J0SW5kZXgiOjAsInNvcnREaXJlY3Rpb24iOiJERVNDIiwicXVlcnkiOnsib3BlcmF0b3IiOiJBTkQiLCJpbmRleFF1ZXJ5Ijp7ImNvbmRpdGlvblR5cGUiOiJJTkRFWCIsIm9wZXJhdG9yIjoiQU5EIiwiY29uZGl0aW9ucyI6W119LCJzcGFuUXVlcnkiOnsib3BlcmF0b3IiOiJBTkQiLCJjb25kaXRpb25TZXRzIjpbeyJjb25kaXRpb25UeXBlIjoiU1BBTiIsIm9wZXJhdG9yIjoiQU5EIiwiY29uZGl0aW9ucyI6W3siYXR0ciI6InNlcnZpY2UubmFtZSIsIm9wZXJhdG9yIjoiRVEiLCJ2YWx1ZSI6IlRlc3QgU2VydmljZSBBIn1dfV19fX0=)). Because the sample payload contains an error attribute, the error sampler will mark it for keeping. If you modify the payload to remove the error attributes, the random sampler may not choose to keep this particular trace.

          <Callout variant="tip">
            Traces may take up to one minute to show up in the UI.
          </Callout>
     </Collapser>
   </CollapserGroup>

### Initial trace observer configuration for browser, mobile, and lambda [#initial-config]

Once you have a trace observer, you need to specify which data sources (services, apps, or entities) should have their data sent to the Infinite Tracing trace observer. 

1. See our [GraphQL tutorial](/docs/apis/nerdgraph/examples/configure-infinite-tracing-graphql/#updating-the-data-sources) about how to specify your Infinite Tracing data sources. When you finish, return to this page and continue the steps below.

2. Bookmark the [optional configurations](#follow-up-config) below so you can return to them after you experiment with Infinite Tracing.

3. View your Infinite Tracing data in the [New Relic UI](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui/).

4. If you have some services instrumented with New Relic APM agents or third-party telemetry tools, complete the steps in that [section](#apm-and-third-party) to ensure their data also gets to New Relic.

## (Optional) Additional configuration for all service types [#follow-up-config]

<Callout variant="tip">
You may want to postpone these optional configurations until after you've worked with this feature for a while.
</Callout>

You can control the behavior of the trace observer with various configurations. Here are some of the features you can configure:

* [Configure trace observer monitoring](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-trace-observer-monitoring/): Allows you to see the amount of traces seen and retained.
* [Configure span attribute trace filter](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-span-attribute-trace-filter/): Make custom filter rules for spans.
* [Infinite Tracing: Configure random trace filter](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-random-trace-filter): Adjust the percentage of for the random trace filter.

