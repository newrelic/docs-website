---
title: Configure minimal spans tracing
tags:
  - Understand dependencies
  - Distributed tracing
  - Core Tracing
metaDescription: Reduce trace span volume by 50-70% with minimal spans tracing while preserving service-to-service connectivity.
freshnessValidatedDate: never
---

Minimal spans tracing (MST) reduces the number of spans in your traces by controlling which span types get captured and reported. You can cut span volume by 50-70% while still maintaining complete service-to-service visibility.

## Before you begin [#before-you-begin]

Make sure you have:

* [Distributed tracing enabled](/docs/distributed-tracing/concepts/quick-start) on your services
* Agent versions that support MST (see [requirements](#requirements) below)
* Permission to modify agent configuration files or environment variables
* A plan for which services to configure (we recommend starting with non-critical services)

<Callout variant="tip">
  Test MST on a development or staging environment first to understand the impact before applying to production.
</Callout>

## How span types work [#span-types]

To understand MST, you need to know about the three types of spans in distributed tracing:

### Entry spans

The first span in a service's part of the trace. This represents the incoming request to your service.

**Example:** An HTTP request arriving at your API service.

### Exit spans

Spans that represent calls from your service to downstream services or external resources.

**Examples:**
* HTTP calls to other microservices
* Database queries
* Cache operations
* External API calls

### In-process spans

Spans that represent internal method calls within your service. These show the detailed execution path inside your code.

**Examples:**
* Individual function calls
* Internal service layers
* Business logic methods

## MST configuration options [#mst-options]

MST gives you three levels of span capture:

<table>
  <thead>
    <tr>
      <th width={150}>
        Configuration
      </th>
      <th>
        What gets captured
      </th>
      <th>
        Typical span reduction
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **All spans** (default)
      </td>
      <td>
        Entry spans + exit spans + in-process spans
      </td>
      <td>
        0% (baseline)
      </td>
    </tr>

    <tr>
      <td>
        **Entry and exit only**
      </td>
      <td>
        Entry spans + exit spans
        (no in-process spans)
      </td>
      <td>
        40-60%
      </td>
    </tr>

    <tr>
      <td>
        **Minimal**
      </td>
      <td>
        Entry spans + unique exit spans
        (compresses duplicate calls)
      </td>
      <td>
        60-70%
      </td>
    </tr>
  </tbody>
</table>

The "minimal" option goes further by compressing exit spans—if your service makes multiple identical calls to the same downstream service, only the first call gets reported as a span. This preserves the service-to-service relationship while reducing redundant data.

## Requirements [#requirements]

Minimum agent versions for MST:

<table>
  <thead>
    <tr>
      <th width={200}>
        Agent
      </th>
      <th>
        Minimum version
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Java
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        .NET
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Node.js
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Python
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Go
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Ruby
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        PHP
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>
  </tbody>
</table>

## Configure MST [#configure]

Choose your agent language to see configuration instructions:

<CollapserGroup>
  <Collapser
    id="java"
    title="Java agent"
  >
    To configure MST for your Java application, add the `span_events.span_type_filter` setting to your `newrelic.yml` configuration file.

    **Configuration file approach:**

    1. Open your `newrelic.yml` file (typically in your application's root directory).
    2. Under the `distributed_tracing` section, add the `span_events` configuration:

    ```yml
    distributed_tracing:
      enabled: true
      span_events:
        span_type_filter: minimal  # Options: all, entry_exit, minimal
    ```

    3. Save the file and restart your Java application.

    **Environment variable approach:**

    Set the environment variable before starting your application:

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="dotnet"
    title=".NET agent"
  >
    To configure MST for your .NET application, add the `spanTypeFilter` attribute to your `newrelic.config` file.

    **Configuration file approach:**

    1. Open your `newrelic.config` file.
    2. Add the `spanTypeFilter` attribute to the `distributedTracing` element:

    ```xml
    <configuration>
      <distributedTracing enabled="true">
        <spanEvents spanTypeFilter="minimal" />
      </distributedTracing>
    </configuration>
    ```

    3. Save the file and restart your .NET application or IIS.

    **Environment variable approach:**

    ```bash
    set NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="nodejs"
    title="Node.js agent"
  >
    To configure MST for your Node.js application, add the `span_type_filter` setting to your `newrelic.js` configuration file.

    **Configuration file approach:**

    1. Open your `newrelic.js` file.
    2. Add the `span_events` configuration under `distributed_tracing`:

    ```js
    'use strict'

    exports.config = {
      distributed_tracing: {
        enabled: true
      },
      span_events: {
        span_type_filter: 'minimal' // Options: 'all', 'entry_exit', 'minimal'
      }
    }
    ```

    3. Save the file and restart your Node.js application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="python"
    title="Python agent"
  >
    To configure MST for your Python application, add the `span_events.span_type_filter` setting to your `newrelic.ini` file.

    **Configuration file approach:**

    1. Open your `newrelic.ini` file.
    2. Add the setting under the `[newrelic]` section:

    ```ini
    [newrelic]
    distributed_tracing.enabled = true
    span_events.span_type_filter = minimal
    ```

    3. Save the file and restart your Python application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="go"
    title="Go agent"
  >
    To configure MST for your Go application, set the configuration when initializing the New Relic application.

    **Code-based configuration:**

    ```go
    app, err := newrelic.NewApplication(
        newrelic.ConfigAppName("Your Application Name"),
        newrelic.ConfigLicense("YOUR_LICENSE_KEY"),
        newrelic.ConfigDistributedTracerEnabled(true),
        func(cfg *newrelic.Config) {
            cfg.SpanEvents.SpanTypeFilter = "minimal" // Options: "all", "entry_exit", "minimal"
        },
    )
    ```

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="ruby"
    title="Ruby agent"
  >
    To configure MST for your Ruby application, add the `span_events.span_type_filter` setting to your `newrelic.yml` file.

    **Configuration file approach:**

    1. Open your `newrelic.yml` file.
    2. Add the setting under the `common` section:

    ```yml
    common: &default_settings
      distributed_tracing:
        enabled: true
      span_events:
        span_type_filter: minimal  # Options: all, entry_exit, minimal
    ```

    3. Save the file and restart your Ruby application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_SPAN_TYPE_FILTER=minimal
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="php"
    title="PHP agent"
  >
    To configure MST for your PHP application, add the setting to your `newrelic.ini` file or use `ini_set()` in your code.

    **Configuration file approach:**

    1. Open your `newrelic.ini` file.
    2. Add the setting:

    ```ini
    newrelic.distributed_tracing.enabled = true
    newrelic.span_events.span_type_filter = "minimal"
    ```

    3. Save the file and restart your web server.

    **Runtime configuration:**

    ```php
    ini_set('newrelic.span_events.span_type_filter', 'minimal');
    ```

    **Option values:**
    * `all`: Capture all span types (default)
    * `entry_exit`: Capture entry and exit spans only
    * `minimal`: Capture entry spans and unique exit spans

  </Collapser>

  <Collapser
    id="opentelemetry"
    title="OpenTelemetry"
  >
    For OpenTelemetry instrumentation, MST configuration depends on your exporter setup.

    **Using the New Relic OpenTelemetry exporter:**

    Configure the span processor to filter span types before export:

    ```yaml
    # otel-config.yaml
    processors:
      span_type_filter:
        filter_type: minimal  # Options: all, entry_exit, minimal

    exporters:
      otlp:
        endpoint: https://otlp.nr-data.net:4317
        headers:
          api-key: YOUR_LICENSE_KEY

    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [span_type_filter]
          exporters: [otlp]
    ```

    **Note:** Specific OTel configuration may vary based on your collector setup. Refer to OpenTelemetry documentation for detailed processor configuration.

  </Collapser>
</CollapserGroup>

## Verify MST is working [#verify]

After configuring MST, verify it's working correctly:

### Check span counts

Run this NRQL query to see if span volume has decreased:

```sql
SELECT count(*)
FROM Span
WHERE entity.name = 'YOUR_SERVICE_NAME'
SINCE 1 day ago
COMPARE WITH 1 day ago
```

You should see a reduction of 40-70% depending on your configuration.

### Verify span types

Check which span types are being captured:

```sql
SELECT count(*),
       filter(count(*), WHERE span.kind = 'server') as 'Entry Spans',
       filter(count(*), WHERE span.kind = 'client') as 'Exit Spans',
       filter(count(*), WHERE span.kind = 'internal') as 'In-Process Spans'
FROM Span
WHERE entity.name = 'YOUR_SERVICE_NAME'
SINCE 30 minutes ago
```

* **Entry and exit only config:** You should see entry and exit spans, but in-process spans should be 0
* **Minimal config:** You should see entry spans and reduced exit spans

### Check trace completeness

Ensure your traces still show complete service-to-service flows:

1. Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > APM & services > Distributed tracing**.
2. Select a recent trace that includes your MST-configured service.
3. Verify you can still see:
   * All services in the request path
   * Service-to-service connections
   * Request flow from start to finish

## Troubleshoot issues [#troubleshoot]

### Configuration not taking effect

**Problem:** You configured MST but span counts haven't changed.

**Solutions:**

1. Verify you restarted your application after configuration changes.
2. Check agent logs for configuration errors:
   ```bash
   grep -i "span_type_filter\|minimal\|entry_exit" /path/to/agent.log
   ```
3. Confirm your agent version supports MST (see [requirements](#requirements)).
4. Validate configuration syntax matches your agent's format exactly.

### Traces appear incomplete

**Problem:** Traces show gaps or missing services after enabling MST.

**Solutions:**

1. MST only affects span volume, not trace context propagation. If traces are incomplete, check:
   * Distributed tracing is enabled on all services
   * Trace context headers are propagating correctly
   * No proxies or middleware are stripping headers

2. Verify the "missing" services aren't filtered out by [trace sampling](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#sampling).

### Can't see service-to-service calls

**Problem:** After enabling minimal config, you can't see calls between specific services.

**Solutions:**

1. Check if the downstream service is instrumented with distributed tracing.
2. Verify exit spans are being captured (query for `span.kind = 'client'`).
3. If using "minimal" config, unique exit spans should still appear—duplicate calls to the same service are compressed but the first call is captured.

<Callout variant="important">
  If you need more detailed troubleshooting help, see [Troubleshoot Core Tracing issues](/docs/distributed-tracing/troubleshooting/core-tracing-issues) or contact [New Relic Support](https://support.newrelic.com).
</Callout>

## What's next [#whats-next]

Now that you've configured MST, consider these next steps:

* [Configure low-granularity tracing](/docs/distributed-tracing/core-tracing/configure-low-granularity-tracing) to reduce span attributes for additional cost savings
* [Optimize your configuration strategy](/docs/distributed-tracing/core-tracing/cost-optimization-strategies) with a service prioritization framework
* [Review use cases](/docs/distributed-tracing/core-tracing/use-cases-examples) to see how other customers are using MST
