---
title: Configure span attribute reduction for APM agents
tags:
  - Understand dependencies
  - Distributed tracing
  - Span configuration
  - APM agents
metaDescription: Reduce trace data volume by controlling span attributes in APM agents while maintaining service connectivity and flow visualization.
freshnessValidatedDate: never
---

APM agents can reduce span size by sending only essential attributes needed for service relationships and trace connectivity. This attribute reduction is part of Options 2 and 3 in the span filtering configuration, and works together with span filtering to reduce your distributed tracing data volume while maintaining complete end-to-end traces and Dynamic Flow Maps.

## Before you begin [#before-you-begin]

Make sure you have:

* **APM agent monitoring:** This only works with New Relic APM agents (Java, .NET, Node.js, Python, Go, Ruby, PHP)â€”not OpenTelemetry
* [Distributed tracing enabled](/docs/distributed-tracing/concepts/quick-start) on your services
* Agent versions that support span attribute reduction (see [requirements](#requirements) below)
* Permission to modify agent configuration files or environment variables
* Understanding of which attributes your teams actively use for troubleshooting

<Callout variant="important">
  Attribute reduction does **not** include custom attributes by default. If you need custom attributes with reduced spans, you must explicitly opt in. See [Add custom attributes](#custom-attributes).
</Callout>

## What data gets captured with attribute reduction [#what-data]

With attribute reduction enabled (Options 2-3), spans contain a minimal set of attributes focused on maintaining trace connectivity and service relationships:

### Attributes included with attribute reduction

<table>
  <thead>
    <tr>
      <th width={250}>
        Attribute category
      </th>
      <th>
        Specific attributes
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **Core trace identifiers**
      </td>
      <td>
        * `trace.id`
        * `span.id`
        * `parent.id`
        * `entity.guid`
        * `entity.name`
      </td>
    </tr>

    <tr>
      <td>
        **Service relationship data**
      </td>
      <td>
        * `service.name`
        * `span.kind` (server, client, internal)
        * `component` (e.g., http, database, message)
      </td>
    </tr>

    <tr>
      <td>
        **Timing information**
      </td>
      <td>
        * `timestamp`
        * `duration`
      </td>
    </tr>

    <tr>
      <td>
        **Request basics**
      </td>
      <td>
        * `http.method` (GET, POST, etc.)
        * `http.status_code`
        * `error` (true/false)
      </td>
    </tr>

    <tr>
      <td>
        **LGT metadata**
      </td>
      <td>
        * `nr.lowGranularity` (set to `true` for identification)
      </td>
    </tr>
  </tbody>
</table>

### Attributes excluded from LGT

<table>
  <thead>
    <tr>
      <th width={250}>
        Attribute category
      </th>
      <th>
        Examples of excluded attributes
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **Detailed HTTP information**
      </td>
      <td>
        * `http.url`
        * `http.request.headers.*`
        * `http.response.headers.*`
        * Query parameters
      </td>
    </tr>

    <tr>
      <td>
        **Database details**
      </td>
      <td>
        * SQL statements
        * Database connection strings
        * Query parameters
      </td>
    </tr>

    <tr>
      <td>
        **Custom attributes**
      </td>
      <td>
        * All custom attributes (unless explicitly opted in)
        * User-defined metadata
        * Business context attributes
      </td>
    </tr>

    <tr>
      <td>
        **Detailed error information**
      </td>
      <td>
        * Stack traces
        * Error messages
        * Exception details
      </td>
    </tr>

    <tr>
      <td>
        **Performance details**
      </td>
      <td>
        * Queue time
        * External segment details
        * Database rollup metrics
      </td>
    </tr>
  </tbody>
</table>

The key principle: attribute reduction keeps everything needed for "what service called what service and how long did it take" while removing the detailed "how and why" information.

## Requirements [#requirements]

Minimum agent versions for span attribute reduction:

<table>
  <thead>
    <tr>
      <th width={200}>
        Agent
      </th>
      <th>
        Minimum version
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Java
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        .NET
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Node.js
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Python
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Go
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        Ruby
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>

    <tr>
      <td>
        PHP
      </td>
      <td>
        TBD (check with Engineering)
      </td>
    </tr>
  </tbody>
</table>

## Configure span attribute reduction [#configure]

Choose your agent language to see configuration instructions. This attribute reduction configuration is part of Options 2 and 3, and should be combined with [span filtering](/docs/distributed-tracing/core-tracing/configure-minimal-spans-tracing) for maximum data reduction.

<CollapserGroup>
  <Collapser
    id="java"
    title="Java agent"
  >
    To configure span attribute reduction for your Java application, add the `span_events.attributes.enabled` setting to your `newrelic.yml` configuration file.

    **Configuration file approach:**

    1. Open your `newrelic.yml` file.
    2. Under the `distributed_tracing` section, add the `span_events.attributes` configuration:

    ```yml
    distributed_tracing:
      enabled: true
      span_events:
        attributes:
          enabled: false  # Disable all attributes
          include:
            - minimal_set  # Include only minimal attributes
    ```

    3. Save the file and restart your Java application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="dotnet"
    title=".NET agent"
  >
    To configure span attribute reduction for your .NET application, modify the `span` element attributes in your `newrelic.config` file.

    **Configuration file approach:**

    1. Open your `newrelic.config` file.
    2. Configure the span events attributes:

    ```xml
    <configuration>
      <distributedTracing enabled="true">
        <spanEvents>
          <attributes enabled="false">
            <include>minimal_set</include>
          </attributes>
        </spanEvents>
      </distributedTracing>
    </configuration>
    ```

    3. Save the file and restart your .NET application or IIS.

    **Environment variable approach:**

    ```bash
    set NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    set NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="nodejs"
    title="Node.js agent"
  >
    To configure span attribute reduction for your Node.js application, add the `span_events.attributes` settings to your `newrelic.js` configuration file.

    **Configuration file approach:**

    1. Open your `newrelic.js` file.
    2. Add the `span_events` configuration:

    ```js
    'use strict'

    exports.config = {
      distributed_tracing: {
        enabled: true
      },
      span_events: {
        attributes: {
          enabled: false,  // Disable all attributes
          include: ['minimal_set']  // Include only minimal attributes
        }
      }
    }
    ```

    3. Save the file and restart your Node.js application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="python"
    title="Python agent"
  >
    To configure span attribute reduction for your Python application, add the `span_events.attributes` settings to your `newrelic.ini` file.

    **Configuration file approach:**

    1. Open your `newrelic.ini` file.
    2. Add the settings under the `[newrelic]` section:

    ```ini
    [newrelic]
    distributed_tracing.enabled = true
    span_events.attributes.enabled = false
    span_events.attributes.include = minimal_set
    ```

    3. Save the file and restart your Python application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="go"
    title="Go agent"
  >
    To configure span attribute reduction for your Go application, set the configuration when initializing the New Relic application.

    **Code-based configuration:**

    ```go
    app, err := newrelic.NewApplication(
        newrelic.ConfigAppName("Your Application Name"),
        newrelic.ConfigLicense("YOUR_LICENSE_KEY"),
        newrelic.ConfigDistributedTracerEnabled(true),
        func(cfg *newrelic.Config) {
            cfg.SpanEvents.Attributes.Enabled = false
            cfg.SpanEvents.Attributes.Include = []string{"minimal_set"}
        },
    )
    ```

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="ruby"
    title="Ruby agent"
  >
    To configure span attribute reduction for your Ruby application, add the `span_events.attributes` settings to your `newrelic.yml` file.

    **Configuration file approach:**

    1. Open your `newrelic.yml` file.
    2. Add the settings under the `common` section:

    ```yml
    common: &default_settings
      distributed_tracing:
        enabled: true
      span_events:
        attributes:
          enabled: false  # Disable all attributes
          include:
            - minimal_set  # Include only minimal attributes
    ```

    3. Save the file and restart your Ruby application.

    **Environment variable approach:**

    ```bash
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_ENABLED=false
    export NEW_RELIC_DISTRIBUTED_TRACING_SPAN_EVENTS_ATTRIBUTES_INCLUDE=minimal_set
    ```

  </Collapser>

  <Collapser
    id="php"
    title="PHP agent"
  >
    To configure span attribute reduction for your PHP application, add the settings to your `newrelic.ini` file.

    **Configuration file approach:**

    1. Open your `newrelic.ini` file.
    2. Add the settings:

    ```ini
    newrelic.distributed_tracing.enabled = true
    newrelic.span_events.attributes.enabled = false
    newrelic.span_events.attributes.include = "minimal_set"
    ```

    3. Save the file and restart your web server.

    **Runtime configuration:**

    ```php
    ini_set('newrelic.span_events.attributes.enabled', 'false');
    ini_set('newrelic.span_events.attributes.include', 'minimal_set');
    ```

  </Collapser>
</CollapserGroup>

## Add custom attributes (optional) [#custom-attributes]

By default, attribute reduction does **not** include custom attributes. This is intentional to keep costs predictable. If you have custom attributes that are critical for your troubleshooting workflows, you can explicitly opt them in.

<Callout variant="caution">
  Adding custom attributes to spans with attribute reduction increases ingest volume and costs. Only include attributes you actively use for troubleshooting or business intelligence.
</Callout>

### Opt in specific custom attributes

To include specific custom attributes in spans with attribute reduction, add them to the `include` list:

**Java example:**

```yml
distributed_tracing:
  enabled: true
  span_events:
    attributes:
      enabled: false
      include:
        - minimal_set
        - user.id          # Custom attribute
        - transaction.type  # Custom attribute
```

**Node.js example:**

```js
span_events: {
  attributes: {
    enabled: false,
    include: [
      'minimal_set',
      'user.id',          // Custom attribute
      'transaction.type'  // Custom attribute
    ]
  }
}
```

### Monitor custom attribute impact

After adding custom attributes, monitor your ingest volume:

```sql
SELECT bytecountestimate() / 1e9 as 'GB Estimate'
FROM Span
WHERE nr.lowGranularity = true
SINCE 1 day ago
COMPARE WITH 1 day ago
```

If ingest increases more than expected, review which custom attributes are actually being used in queries and remove unused ones.

## Using attribute reduction with span filtering [#combine]

Attribute reduction is part of Options 2 and 3 in the [span filtering configuration](/docs/distributed-tracing/core-tracing/configure-minimal-spans-tracing). These options automatically combine span filtering with attribute reduction:

* **Option 2:** Removes in-process spans + reduces attributes (60-75% reduction)
* **Option 3:** Removes in-process spans + reduces attributes + compresses duplicates (70-85% reduction)

**Java example for Option 2 or 3:**

```yml
distributed_tracing:
  enabled: true
  span_events:
    span_type_filter: entry_exit  # Option 1: Remove in-process spans
    attributes:
      enabled: false                # Option 2+: Reduce span attributes
      include:
        - minimal_set
```

When you configure both `span_type_filter` and `attributes.enabled = false`, you're implementing Option 2 (or Option 3 if using `span_type_filter: minimal`). This approach is ideal for supporting services where you need connectivity data but not detailed telemetry.

## Verify attribute reduction is working [#verify]

After configuring attribute reduction, verify it's working correctly:

### Check for spans with reduced attributes

Run this NRQL query to confirm spans with reduced attributes are being reported:

```sql
SELECT count(*)
FROM Span
WHERE nr.lowGranularity = true
AND entity.name = 'YOUR_SERVICE_NAME'
SINCE 30 minutes ago
```

You should see spans with `nr.lowGranularity = true`.

### Compare attribute counts

Check the difference in attribute count between full and reduced-attribute spans:

```sql
SELECT average(nr.attributeCount)
FROM Span
WHERE entity.name = 'YOUR_SERVICE_NAME'
FACET nr.lowGranularity
SINCE 30 minutes ago
```

Spans with reduced attributes should show significantly fewer attributes (typically 10-15 attributes vs 40-60 for full spans).

### Verify trace completeness

Ensure Dynamic Flow Maps and trace visualization still work:

1. Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > APM & services > Service map**.
2. Verify your services with attribute reduction appear correctly in the map.
3. Check that service-to-service connections are visible.
4. Click on a service to view distributed tracing and confirm traces are complete.

## Troubleshoot issues [#troubleshoot]

### Attribute reduction not taking effect

**Problem:** You configured attribute reduction but spans still have all attributes.

**Solutions:**

1. Restart your application after configuration changes.
2. Check agent logs for configuration errors.
3. Verify your agent version supports span attribute reduction.
4. Confirm syntax matches your agent's configuration format exactly.

### Custom attributes not appearing

**Problem:** You opted in custom attributes but they're not appearing in spans with reduced attributes.

**Solutions:**

1. Verify the attribute names match exactly (case-sensitive).
2. Confirm attributes are being set before the span is created.
3. Check that the attributes exist on full spans first:
   ```sql
   SELECT uniques(attribute.names)
   FROM Span
   WHERE entity.name = 'YOUR_SERVICE_NAME'
   AND nr.lowGranularity IS NULL
   SINCE 1 hour ago
   ```

### Ingest volume didn't decrease as expected

**Problem:** Attribute reduction is enabled but ingest volume hasn't decreased significantly.

**Solutions:**

1. Verify spans with reduced attributes are being created (check `nr.lowGranularity = true`).
2. Check if you opted in many custom attributes, which increases span size.
3. Ensure you're also using span filtering (Options 2-3) for maximum reduction.
4. Allow 24-48 hours for ingest metrics to stabilize before evaluating impact.

<Callout variant="important">
  For additional troubleshooting help, see [Troubleshoot missing trace data](/docs/distributed-tracing/troubleshooting/missing-trace-data) or contact [New Relic Support](https://support.newrelic.com).
</Callout>

## What's next [#whats-next]

Now that you've configured span attribute reduction:

* Review [span filtering configuration](/docs/distributed-tracing/core-tracing/configure-minimal-spans-tracing) to understand Options 2-3 which combine span filtering with attribute reduction
* [Optimize your costs](/docs/distributed-tracing/core-tracing/cost-optimization-strategies) with a comprehensive service prioritization strategy
* Review the main [distributed tracing introduction](/docs/distributed-tracing/concepts/introduction-distributed-tracing) to understand how attribute reduction fits into your overall observability strategy
