---
title: Manually install the Android agent (Gradle/Android Studio)
tags:
  - Mobile monitoring
  - New Relic Mobile Android
  - Install configure
translate:
  - jp
  - kr
metaDescription: 'New accounts: Get Android app monitoring in New Relic at newrelic.com/signup. Existing accounts: Add mobile monitoring to your Android apps from the UI.'
redirects:
  - /docs/mobile-apps/troubleshooting-eclipse-configurations
  - /docs/mobile-monitoring-installation/troubleshooting-eclipse-configurations
  - /docs/mobile-apps/maven-installation
  - /docs/mobile-monitoring-installation/maven-installation
  - /docs/mobile-apps/gradle-installation
  - /docs/mobile-monitoring-installation/gradle-installation
  - /docs/mobile-apps/android-installation-and-configuration
  - /docs/mobile-monitoring-installation/android-installation-and-configuration
  - /docs/mobile-apps/eclipse-installation
  - /docs/mobile-monitoring-installation/eclipse-installation
  - /docs/mobile-monitoring/mobile-monitoring-installation/getting-started/android-installation-and-configuration
  - /docs/mobile-monitoring/mobile-monitoring-installation/android/installing-android-apps-gradle-and
  - /docs/mobile-monitoring/mobile-monitoring-installation/android/troubleshooting-eclipse-configurations
  - /docs/mobile-monitoring/mobile-monitoring-installation/android/installing-android-apps-eclipse
  - /docs/mobile-monitoring/mobile-monitoring-installation/getting-started/android-installation-configuration
  - /docs/mobile-monitoring/mobile-monitoring-installation/android/installing-android-apps-gradle-android-studio
  - /docs/mobile-monitoring/mobile-monitoring-installation/android/installing-android-apps-maven
  - /docs/mobile-monitoring/mobile-monitoring-installation/legacy/installing-android-apps-eclipse
  - /docs/mobile-monitoring/new-relic-mobile-android/install-configure/android-installation-configuration
  - /docs/mobile-monitoring/new-relic-mobile-android/install-configure/installing-android-apps-gradle-android-studio
  - /docs/mobile-monitoring/new-relic-mobile-android/get-started/android-installation-configuration
  - /docs/mobile-monitoring/new-relic-mobile-android/legacy/installing-android-apps-eclipse
  - /docs/mobile-monitoring/new-relic-mobile-android/install-configure/installing-android-apps-maven
  - /docs/mobile-monitoring/new-relic-mobile-android/install-configure
  - /docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-android-gradle-android-studio
---

You can install the mobile agent for Android monitoring with our [guided install](https://onenr.io/0kjnEoryzRo), or you can install manually. The guided install is a good option for simple app environments. For other cases, you can follow the steps below to install the Android agent with Gradle and Android Studio.

## Install your Android app [#installation]

As part of the installation process for mobile monitoring, New Relic automatically generates an [application token](/docs/mobile-apps/viewing-your-application-token). This is a 40-character hexadecimal string for authenticating each mobile app you monitor in New Relic.

<Steps>
    <Step>
        ### Add your Android app to New Relic

1. Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Mobile**.
2. From the [**Mobile apps** index](/docs/mobile-monitoring/mobile-monitoring-ui/mobile-app-pages/mobile-apps-index), select **Add a new app**.
3. From the **Get started** page, select **Android** as your mobile monitoring platform.
4. Enter a name for your mobile app, and select **Continue**.

    </Step>
    <Step>
        ### Update your Gradle build file on the project and/or app level

Configure all apps that are part of a project with project-level configuration. This configuration includes setting the project token, enabling or disabling features, and setting thresholds for alerts.  

To update your build file on the project level:

      ```java
      buildscript {
        repositories {
          mavenCentral()
        }

        dependencies {
          classpath "com.newrelic.agent.android:agent-gradle-plugin:<a href="/docs/release-notes/mobile-release-notes/android-release-notes">AGENT_VERSION</a>"
        }
      }
      ```

If you want to configure settings for one specific app, then update your build file on the app level:

      ```java
      repositories {
        mavenCentral()
      }

      apply plugin: 'android'
      apply plugin: 'newrelic'

      dependencies {
        implementation 'com.newrelic.agent.android:android-agent:<a href="/docs/release-notes/mobile-release-notes/android-release-notes">AGENT_VERSION</a>'
      }
      ```

In both scripts, replace `<AGENT_VERSION>` with the most recent agent version. See the [agent release notes](/docs/release-notes/mobile-release-notes/android-release-notes) to stay up to date. You may choose to configure one or both depending on your monitoring needs. 

    </Step>
    <Step>
        ### Set app permissions 

  Sett app permissions to make requests to `INTERNET` and `ACCESS_NETWORK_STATE`. Add this code snippet to your `AndroidManifest.xml` file:

```
  <uses-permission android:name="android.permission.INTERNET" />
  <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
  ```

        
    </Step>
    <Step>
        ### Start the Android agent on app start up

    In your **Default Activity**, import the `NewRelic` class. Your **Default Activity** is defined in your **Manifest**. 

    ```
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    ```

    To  initialize mobile monitoring, add the following script in your `onCreate()` method:

    ```
    import com.newrelic.agent.android.NewRelic;
    ```

    </Step>
</Steps>

You may prefer completing the configuration process for a new mobile app later. To do that, go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Mobile**, then select **See instructions** next to your mobile app name.

If you want to upgrade an existing Android installation, then go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Mobile > (select an app) > Settings > Installation**.

## Set up Gradle DSL with Gradle Plugin Portal [#gradle-dsl]

<Callout variant="important">

By default, the plugins `{} DSL` resolves itself from the [public Gradle Plugin Portal](https://plugins.gradle.org/). The Android agent is not yet available as a community plugin, but you can provide the classpath to [MavenCentral](https://mvnrepository.com/artifact/com.newrelic.agent.android/agent-gradle-plugin">MavenCentral) and still use the Plugins DSL.
</Callout>

<Steps>
    <Step>
        ### Configure your `settings.gradle(.kts)` file for the agent plugin

<Tabs>
	<TabsBar>
        <TabsBarItem id="kts">
            Configure with `settings.gradle(.kts)`
        </TabsBarItem>
        <TabsBarItem id="project">
            Configure in the project-level build file
        </TabsBarItem>
    </TabsBar>

    <TabsPages>
        <TabsPageItem id="kts">
        Resolution of the agent plugin is configured in your project's `settings.gradle(.kts)` file, through the through the [`pluginManagement { ... }`](https://docs.gradle.org/current/dsl/org.gradle.plugin.management.PluginManagementSpec.html) block. In this example, replace `AGENT_VERSION` with the most recent [agent release version](/docs/release-notes/mobile-release-notes/android-release-notes). 

        ```
        pluginManagement {
          repositories {
            mavenCentral()  // adds repo for NewRelic artifacts
          }
          resolutionStrategy {
            eachPlugin {
              if (requested.id.id.startsWith("newrelic")) {
                useModule("com.newrelic.agent.android:agent-gradle-plugin:${AGENT_VERSION}")
              }
            }
          }

          // optional: define as a community plugin here or in root level build file

          // for core Gradle plugins or plugins already available to the build script
          plugins {
            id("newrelic") version "${<AGENT_VERSION>}"
          }
        }
        ```
        </TabsPageItem>
        <TabsPageItem id="project">
        You can also update your build file on the project-level:

        ```
        plugins {
          // for binary Gradle plugins that need to be resolved
          id("newrelic") version "<AGENT_VERSION>" apply false
        }        
        </TabsPageItem>
    </TabsPages>
</Tabs>

    </Step>
    <Step>
        ### Apply the plugin on the app level

Regardless of what route you took, you then need to apply the plugin on the app level:

        ```
        plugins {
            id("com.android.application")
            id("org.jetbrains.kotlin.android")
            id("newrelic")
        }
        ```
    </Step>
</Steps>

For details on how to configure the behavior of the mobile monitoring agent plugin during Gradle builds, see the [New Relic Gradle plugin](/docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-new-relic-gradle-plugin) extension guide.

## Set up ProGuard or DexGuard

    a. In your project’s root directory (`projectname/app`), add a `newrelic.properties` file with the following line:

      ```properties
      com.newrelic.application_token=GENERATED_TOKEN
      ```
    b. Complete the configuration steps on [Configure ProGuard or DexGuard for Android apps](/docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-proguard-or-dexguard-android-apps). Then come back to this page and move on to the next step.

## Update your Android installation [#upgrading]

To keep your Android agent up to date, follow the procedures to [upgrade the Android agent SDK](/docs/mobile-monitoring/new-relic-mobile-android/install-configure/upgrading-new-relic-mobiles-android-sdk) for New Relic. To install the latest Android version for your mobile app: Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Mobile > (select an app) > Settings > Installation**.

## Android 4.x: Multidex support [#4x-multidex]

New Relic's mobile monitoring for Android versions prior to Android 5.0 (API level 21) use the Dalvik runtime to execute app code. By default, Dalvik limits apps to a single `classes.dex` bytecode file per APK. In order to get around this limitation, you **must** [enable multidex support](https://developer.android.com/studio/build/multidex.html). Then you can use the [multidex support library](https://developer.android.com/tools/support-library/features.html#multidex), which becomes part of the primary DEX file of your app and then manages access to the additional DEX files and the code they contain.

When building each DEX file for a multidex app, the build tools perform complex decision making to determine which classes are needed in the primary DEX file so that your app can start successfully. If any class required during startup is not provided in the primary DEX file, then your app crashes with the error `java.lang.NoClassDefFoundError`.

If you see the `java.lang.NoClassDefFoundError` error, then you must [manually specify these additional classes as required](https://developer.android.com/studio/build/multidex.html#keep) in the primary DEX file:

1. Create a `proguard.multidex.config` file within the `/app` folder of your project. Update `mypackage` to reflect your package name.

  ```
  ####################
  # keep class names #
  ####################

  #Keep New Relic in the main dex
  -keep class com.newrelic.** { *; }
  -keep class com.mypackage.activities.** { *; }
  ```
2. Merge the following code into the app-level `build.gradle` file:


  ```
  android {
      defaultConfig{
          …
          multiDexKeepProguard file("proguard.multidex.config")
      }
  }
  ```

For more information, see the [Android Developers documentation](https://developer.android.com/studio/build/multidex.html#keep) on declaring classes required in the primary DEX file.

## What's next? 

6. Optional: Change the [logging level](/docs/mobile-monitoring/new-relic-mobile-android/api-guides/android-agent-configuration-feature-flags#logging).
7. To build and run your application: Clean your project, then run your app in an emulator or device to generate traffic.
8. Wait a few minutes, then view data for your Android app from the [**Summary** page](/docs/mobile-monitoring/mobile-monitoring-ui/mobile-app-pages/mobile-apps-overview-page): Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Mobile > (select an app)**.

If you have problems with your Android installation, or if you do not see data in the mobile monitoring UI, follow the [troubleshooting procedures](/docs/mobile-monitoring/new-relic-mobile-android/troubleshoot/no-data-appears-android).

<InstallFeedback />
