---
title: "Additional configuration"
metaDescription: "Additional configuration instructions for SAP systems."
freshnessValidatedDate: never
---

This section provides additional instructions for setting up the system.

<Steps>
  <Step>
    ## Upload authorization role [#upload-authorization-role]

    1. Use `SAP transaction PFCG`.
    2. Go to **Role** > **Upload** and upload the file **_NEWR_DATA_PROVIDER.SAP** from the installation package.
    3. Confirm the role `/NEWR/DATA_PROVIDER` is to be loaded.

        <img
          title="Authorization Role"
          alt="A screenshot displaying the authorization role upload"
          src="/images/authorisation-role.webp"
          width="600"
        />

    4. Click the <img src="/images/change-icon.webp" class="inline" style={{height: "22px", width: "22px"}} alt="change icon in SAP" title="Change icon indicator in SAP" /> icon once loaded.
    5. In the **Authorizations** tab, select <img src="/images/change-icon.webp" class="inline" style={{height: "20px", width: "20px"}} alt="change icon in SAP" title="Change icon indicator in SAP" /> **Change Authorization Data**, and activate using <img src="/images/activate-option.webp" class="inline" style={{height: "25px", width: "30px"}} alt="activate icon in SAP" title="Activate Icon in SAP" /> icon.

      <img
          title="Authorizations Tab"
          alt="A screenshot displaying the authorization tab and Change Authorization Data in SAP upload"
          src="/images/sap-authorization-1.webp"
          width="500"
        />

    6. If a profile name is suggested, click the green check icon.
    7. Verify that the message **Profile(s) were updated** appears on the status bar.

  </Step>
  <Step>
    ## Create New Relic RFC user ID [#create-rfc-user-id]

    After activating the authorization profile, use transaction `SU01` to create a new RFC user ID (e.g., `NR4SAPDP`). Set the user type to **System** or **Communication** and add the role `/NEWR/DATA_PROVIDER`.

      <img
          title="Create New RFC User"
          alt="A screenshot displaying the creation of a new RFC user in SAP"
          src="/images/rfc-userid.webp"
          width="600"
        />

  </Step>
  <Step>
    ## Create RFC destinations for monitored systems [#create-rfc-for-monitored-systems]

    Use transaction `SM59` to create an RFC destination for each monitored system.

    1. Select the **ABAP Connections** and click the **Create** icon to set up a new RFC destination.
    2. Enter a descriptive **RFC Destination** name. We recommend to name the RFC destination as `NR_<SYSID>CLNT<CLNT#>`
    3. Set **Connection Type** to `3 - ABAP Connection`.
    4. On the **Technical Settings** tab, enter the:
        - **Target Host** (fully qualified domain or IP) and **Instance No.**
        - Specify the **Gateway Host** and **Service** if necessary.

      <img
          title="Create RFC destinations for monitored systems"
          alt="A screenshot displaying the how to create RFC destinations for monitored systems"
          src="/images/rfc-destination.webp"
          width="600"
          />

    5. On the **Logon & Security** tab, enter the RFC user (`NR4SAPDP`) and password.
    6. Click the **Save**.
    7. Go to **Utility > Test > Connection Test** and **Authorization Test** to confirm a successful connection.
      <Callout variant="important">
        Ensure that the test results are successful.
      </Callout>
  </Step>
  <Step>
    ## Set HTTP destination to New Relic cloud

    Use transaction `SM59` to set up HTTPS connections to the New Relic API endpoints.
      <Callout variant="important">
        Ensure to create individual RFC destination for Events, Logs, Metrics, and Traces separately.
      </Callout>

    1. Enter a **Destination Name** (e.g., `NR_API_EVENT`).
    2. Set **Connection Type** to `G` (HTTP Connections to External Server).
    3. Enter the **Target Host**, **Service No.** as (443) (see [standard port](/docs/sap-solutions/additional-resources/network-accessibility) for HTTPS), and **Path Prefix** (see [installation readiness checklist](/docs/sap-solutions/additional-resources/installation-readiness) for details).
    4. If a proxy is required, configure it on the **Technical Settings** tab.
    5. On the **Security Options** tab, check the **Active** radio button for SSL.
      <img
          title="HTTP destination to New Relic"
          alt="A screenshot displaying the connection setup for HTTP destination to New Relic"
          src="/images/http-destination-to-new-relic.webp"
          width="600"
          />
    6. If needed, download the root certificate from [New Relic](https://one.newrelic.com) and add it to SAP using transaction `STRUST`.
    7. Use **Connection Test** to verify the connection. A successful connection will prompt to **Enter Logon Data**. If the test times out, check your firewall settings.
    8. Repeat this procedure for all New Relic API endpoints.
  </Step>
  <Step>
    ## Create BTP/CloudALM authentication endpoint [#create-authentication-endpoint]

    Follow the instructions below based on the service:

    <CollapserGroup>
      <Collapser
          id="btp-process-integration-runtime"
          title="BTP process integration runtime"
        >
        1. Note the `clientId`, `clientsecret`, and `tokenurl` from the downloaded **Service Key**.
        2. Go to the `tokenurl` in a web browser and download the necessary certificates (`Digicert root, global, and SAP on demand`).

        <img
          title="BTP process integration runtime"
          alt="A screenshot displaying the connection setup for BTP process integration runtime"
          src="/images/btp-process-integration.webp"
          width="600"
          />

        3. Use transaction `STRUST` to upload the three certificates one by one and click **Add to Certificate List**.
        4. Click **Save**.
        5. Use transaction `SMICM` and navigate to **Administration > ICM > Exit Soft > Global** to restart all ICM processes.

        <img
          title="Administration ICM"
          alt="A screenshot displaying the Administration ICM"
          src="/images/administration-icm.webp"
          width="600"
        />

        6. Use transaction `SM59` to create a new RFC connection under **HTTP Connections to External Server**.
        7. Split the tokenurl into the host and path prefix. Append the path prefix with `?grant_type=client_credentials`.
        8. Set the **Service No.** to `443`.

        <img
          title="Service No."
          alt="A screenshot displaying the Service No."
          src="/images/service-no.webp"
          width="600"
        />

        9. On the **Login & Security** tab, select **Basic Authentication** and enter the `clientId` and `clientsecret` as the username and password.
        10. Set the **Secure Protocol** status to **Active** and save the configuration.
        11. Run a **Connection Test**.
        </Collapser>

        <Collapser
            id="cloud-alm-api"
            title="CloudALM API"
          >
          1. Note the `clientId`, `clientsecret`, and `url` from the downloaded **Service Key**.
          2. Go to the url in a web browser and download the **Digicert root**, **global** and **SAP on demand** certificates.

          <img
            title="CloudALM API"
            alt="A screenshot displaying the connection setup for CloudALM API"
            src="/images/cloudalm-api.webp"
            width="600"
          />

          3. Use transaction `STRUST` to upload the three certificates one by one and click **Add to Certificate List**.
          4. Click **Save**.
          5. Use transaction `SMICM` and navigate to **Administration > ICM > Exit Soft > Global** to restart all ICM processes.

          <img
            title="Administration ICM"
            alt="A screenshot displaying the Administration ICM"
            src="/images/administration-icm.webp"
            width="600"
          />

          6. Use transaction `SM59` to create a new RFC connection.
          7. Insert the url as the **Target host** and set the **Service No.** to `443`. Set the **Path Prefix** to `/oauth/token?grant_type=client_credentials`.

          <img
            title="SM59 Configuration"
            alt="A screenshot displaying the SM59 configuration"
            src="/images/sm59-configuration.webp"
            width="600"
          />

          8. On the **Login & Security** tab, select **Basic Authentication** and enter the `clientId` and `clientsecret` as the username and password.
          9. Set the **Secure Protocol** status to **Active** and save the configuration.
          10. Run a **Connection Test**.
        </Collapser>
    </CollapserGroup>
  </Step>
  <Step>
    ## Create database connection [#create-database-connection]

    Use transaction `DBACOCKPIT` to define the remote **HANA Database** connections.

    1. Double-click **Database Connections** and click **Add**.

        <img
          title="Database Connection"
          alt="A screenshot displaying the Database Connection"
          src="/images/database-connection.webp"
          width="600"
        />

    2. Enter a **Connection Name** (preferably the same as the SAP system ID).
    3. Select **HANA Database** as the **Database System**.
    4. Enter the **Database user ID** (e.g., `NRAGENT`) and password.
    5. Enter the **Database Host** and **SQL Port**.

        <img
            title="SAP Connection Name"
            alt="A screenshot displaying the SAP Connection Name"
            src="/images/connection-name.webp"
            width="600"
          />

    6. Save the data and click **Test** to verify the connection.
  </Step>
</Steps>