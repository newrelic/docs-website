---
title: Install Elasticsearch OpenTelemetry integration
tags:
  - OpenTelemetry
  - Elasticsearch
  - Integrations
metaDescription: "Install and configure the OpenTelemetry Collector to monitor Elasticsearch clusters and send data to New Relic."
freshnessValidatedDate: never
redirects:
  - /install/elasticsearch-otel
---

Install the New Relic Elasticsearch OpenTelemetry integration to monitor your Elasticsearch clusters with industry-standard protocols. This guide walks you through configuring the OpenTelemetry Collector to collect metrics and logs from your Elasticsearch infrastructure and send them to New Relic.

You can choose between two collector distributions:
* **NRDOT:** New Relic Distribution of OpenTelemetry
* **OTel Collector Contrib:** Standard OpenTelemetry Collector with community-contributed components

## Installation options [#installation-options]

Choose the collector distribution that matches your needs:

<Tabs>
  <TabsBar>
    <TabsBarItem id="nrdot">NRDOT Collector</TabsBarItem>
    <TabsBarItem id="otel-contrib">OTel Collector Contrib</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="nrdot">

<Callout variant="important">
**NRDOT support for Elasticsearch monitoring is coming soon!**

We're working on bringing you the New Relic Distribution of OpenTelemetry (NRDOT) for Elasticsearch monitoring. In the meantime, please use the OTel Collector Contrib option.

Stay tuned for updates!
</Callout>

    </TabsPageItem>

    <TabsPageItem id="otel-contrib">

<Steps>

<Step>

### Before you begin [#prereq-otel]

Before configuring the OTel Collector Contrib, ensure you have:

**Required access privileges:**
* Your New Relic <InlinePopover type="licenseKey"/>
* Root or sudo privileges on the host machine
* Elasticsearch cluster admin privileges with `monitor` or `manage` cluster privilege (see [Elasticsearch security privileges documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-privileges.html) for details)

**System requirements:**
* **Elasticsearch version 7.16 or higher** - This integration requires a modern Elasticsearch cluster
* **Network connectivity** - Outbound HTTPS (port 443) to New Relic's [OTLP ingest endpoint](/docs/opentelemetry/best-practices/opentelemetry-otlp)

**Configuration values ready:**
* **Elasticsearch endpoint** - Your Elasticsearch cluster URL (e.g., `http://localhost:9200`)
* **Cluster name** - A unique identifier for your cluster in New Relic

<Callout variant="important">
You must have [OpenTelemetry Collector Contrib](https://github.com/open-telemetry/opentelemetry-collector-contrib/releases/latest) installed on your host before proceeding. We recommend installing via official packages (.deb or .rpm) to ensure the systemd service unit is created correctly.
</Callout>

</Step>

<Step>

### Configure Elasticsearch monitoring [#configure-es-otel]

Once the OTel Collector Contrib is installed, replace the collector's default configuration file with the Elasticsearch monitoring configuration. This will enable Elasticsearch metrics collection. Host metrics and logs are optional and can be added separately.

The configuration file is located at: `/etc/otelcol-contrib/config.yaml`

<Callout variant="tip">
**Backup your default configuration:** Before modifying the configuration file, create a backup copy to preserve the default settings:
```bash
sudo cp /etc/otelcol-contrib/config.yaml /etc/otelcol-contrib/config.yaml.backup
```
</Callout>

To configure the collector:

1. Open the configuration file with a text editor using root or sudo privileges:

    ```bash
    sudo nano /etc/otelcol-contrib/config.yaml
    ```

2. Delete all existing content and replace it with the following configuration for Elasticsearch monitoring:

<Callout variant="important">
Replace the `endpoint` value with your Elasticsearch cluster endpoint and update `elasticsearch.cluster.name` in the processor block with a unique name to identify your cluster in New Relic.
</Callout>


```yaml
receivers:
  elasticsearch:
    endpoint: "http://localhost:9200"
    collection_interval: 15s
    metrics:
      elasticsearch.os.cpu.usage:
        enabled: true
      elasticsearch.cluster.data_nodes:
        enabled: true
      elasticsearch.cluster.health:
        enabled: true
      elasticsearch.cluster.in_flight_fetch:
        enabled: true
      elasticsearch.cluster.nodes:
        enabled: true
      elasticsearch.cluster.pending_tasks:
        enabled: true
      elasticsearch.cluster.shards:
        enabled: true
      elasticsearch.cluster.state_update.time:
        enabled: true
      elasticsearch.index.documents:
        enabled: true
      elasticsearch.index.operations.merge.current:
        enabled: true
      elasticsearch.index.operations.time:
        enabled: true
      elasticsearch.node.cache.count:
        enabled: true
      elasticsearch.node.cache.evictions:
        enabled: true
      elasticsearch.node.cache.memory.usage:
        enabled: true
      elasticsearch.node.shards.size:
        enabled: true
      elasticsearch.node.cluster.io:
        enabled: true
      elasticsearch.node.documents:
        enabled: true
      elasticsearch.node.disk.io.read:
        enabled: true
      elasticsearch.node.disk.io.write:
        enabled: true
      elasticsearch.node.fs.disk.available:
        enabled: true
      elasticsearch.node.fs.disk.total:
        enabled: true
      elasticsearch.node.http.connections:
        enabled: true
      elasticsearch.node.ingest.documents.current:
        enabled: true
      elasticsearch.node.ingest.operations.failed:
        enabled: true
      elasticsearch.node.open_files:
        enabled: true
      elasticsearch.node.operations.completed:
        enabled: true
      elasticsearch.node.operations.current:
        enabled: true
      elasticsearch.node.operations.get.completed:
        enabled: true
      elasticsearch.node.operations.time:
        enabled: true
      elasticsearch.node.shards.reserved.size:
        enabled: true
      elasticsearch.index.shards.size:
        enabled: true
      elasticsearch.os.cpu.load_avg.1m:
        enabled: true
      elasticsearch.os.cpu.load_avg.5m:
        enabled: true
      elasticsearch.os.cpu.load_avg.15m:
        enabled: true
      elasticsearch.os.memory:
        enabled: true
      jvm.gc.collections.count:
        enabled: true
      jvm.gc.collections.elapsed:
        enabled: true
      jvm.memory.heap.max:
        enabled: true
      jvm.memory.heap.used:
        enabled: true
      jvm.memory.heap.utilization:
        enabled: true
      jvm.threads.count:
        enabled: true
      elasticsearch.index.segments.count:
        enabled: true
      elasticsearch.index.operations.completed:
        enabled: true
      elasticsearch.node.script.cache_evictions:
        enabled: false
      elasticsearch.node.cluster.connections:
        enabled: false
      elasticsearch.node.pipeline.ingest.documents.preprocessed:
        enabled: false
      elasticsearch.node.thread_pool.tasks.queued:
        enabled: false
      elasticsearch.cluster.published_states.full:
        enabled: false
      jvm.memory.pool.max:
        enabled: false
      elasticsearch.node.script.compilation_limit_triggered:
        enabled: false
      elasticsearch.node.shards.data_set.size:
        enabled: false
      elasticsearch.node.pipeline.ingest.documents.current:
        enabled: false
      elasticsearch.cluster.state_update.count:
        enabled: false
      elasticsearch.node.fs.disk.free:
        enabled: false
      jvm.memory.nonheap.used:
        enabled: false
      jvm.memory.pool.used:
        enabled: false
      elasticsearch.node.translog.size:
        enabled: false
      elasticsearch.node.thread_pool.threads:
        enabled: false
      elasticsearch.cluster.state_queue:
        enabled: false
      elasticsearch.node.translog.operations:
        enabled: false
      elasticsearch.memory.indexing_pressure:
        enabled: false
      elasticsearch.node.ingest.documents:
        enabled: false
      jvm.classes.loaded:
        enabled: false
      jvm.memory.heap.committed:
        enabled: false
      elasticsearch.breaker.memory.limit:
        enabled: false
      elasticsearch.indexing_pressure.memory.total.replica_rejections:
        enabled: false
      elasticsearch.breaker.memory.estimated:
        enabled: false
      elasticsearch.cluster.published_states.differences:
        enabled: false
      jvm.memory.nonheap.committed:
        enabled: false
      elasticsearch.node.translog.uncommitted.size:
        enabled: false
      elasticsearch.node.script.compilations:
        enabled: false
      elasticsearch.node.pipeline.ingest.operations.failed:
        enabled: false
      elasticsearch.indexing_pressure.memory.limit:
        enabled: false
      elasticsearch.breaker.tripped:
        enabled: false
      elasticsearch.indexing_pressure.memory.total.primary_rejections:
        enabled: false
      elasticsearch.node.thread_pool.tasks.finished:
        enabled: false
processors:
  memory_limiter:
    check_interval: 60s
    limit_mib: ${env:NEW_RELIC_MEMORY_LIMIT_MIB:-100}
  cumulativetodelta: {}
  resource/cluster_name_override:
    attributes:
      - key: elasticsearch.cluster.name
        value: "<elasticsearch-cluster-name>"
        action: upsert
  resourcedetection:
    detectors: [ system ]
    system:
      resource_attributes:
        host.name:
          enabled: true
        host.id:
          enabled: true
        os.type:
          enabled: true
  batch:
    timeout: 10s
    send_batch_size: 1024
  attributes/cardinality_reduction:
    actions:
      - key: process.pid
        action: delete
      - key: process.parent_pid
        action: delete
  transform/metadata_nullify:
    metric_statements:
      - context: metric
        statements:
          - set(description, "")
          - set(unit, "")
exporters:
  otlphttp:
    endpoint: ${env:NEWRELIC_OTLP_ENDPOINT}
    headers:
      api-key: ${env:NEWRELIC_LICENSE_KEY}
service:
  pipelines:
    metrics/elasticsearch:
      receivers: [elasticsearch]
      processors: [memory_limiter, resourcedetection, resource/cluster_name_override, attributes/cardinality_reduction, cumulativetodelta, transform/metadata_nullify, batch]
      exporters: [otlphttp]
```

3. *(Optional)* For secured Elasticsearch with authentication and SSL, modify the receiver configuration:

    ```yaml
    receivers:
      elasticsearch:
        endpoint: "https://localhost:9200"
        username: "your_elasticsearch_username"
        password: "your_elasticsearch_password"
        tls:
          ca_file: "/etc/elasticsearch/certs/http_ca.crt"
          insecure_skip_verify: false
        collection_interval: 15s
    ```

4. *(Optional)* To collect host metrics, add the hostmetrics receiver:

    ```yaml
    receivers:
      hostmetrics:
        collection_interval: 60s
        scrapers:
          cpu:
            metrics:
              system.cpu.utilization: {enabled: true}
              system.cpu.time: {enabled: true}
          load:
            metrics:
              system.cpu.load_average.1m: {enabled: true}
              system.cpu.load_average.5m: {enabled: true}
              system.cpu.load_average.15m: {enabled: true}
          memory:
            metrics:
              system.memory.usage: {enabled: true}
              system.memory.utilization: {enabled: true}
          disk:
            metrics:
              system.disk.io: {enabled: true}
              system.disk.operations: {enabled: true}
          filesystem:
            metrics:
              system.filesystem.usage: {enabled: true}
              system.filesystem.utilization: {enabled: true}
          network:
            metrics:
              system.network.io: {enabled: true}
              system.network.packets: {enabled: true}
          process:
            metrics:
              process.cpu.utilization:
                enabled: true
    ```

    And add to the service pipelines:

    ```yaml
    service:
      pipelines:
        metrics/host:
          receivers: [hostmetrics]
          processors: [memory_limiter, resourcedetection, batch]
          exporters: [otlphttp]
    ```

5. *(Optional)* To collect Elasticsearch logs, add the filelog receiver. Ensure the user running the collector service (otelcol-contrib) has read access to your Elasticsearch log files:

    **If running Elasticsearch on Linux (Host):**
    ```yaml
    receivers:
      filelog:
        include:
          - /var/log/elasticsearch/elasticsearch.log
          - /var/log/elasticsearch/*.log
    ```

    **If running Elasticsearch in Docker:**
    ```yaml
    receivers:
      filelog:
        include:
          - /var/lib/docker/containers/*/*.log
        operators:
          - type: move
            from: attributes.log
            to: body
    ```

    And add to the service pipelines:

    ```yaml
    service:
      pipelines:
        logs:
          receivers: [filelog]
          processors: [resource/cluster_name_override]
          exporters: [otlphttp]
    ```

6. *(Optional)* To add custom metadata tags to your metrics, use the `resource/static_override` processor:

    ```yaml
    processors:
      resource/static_override:
        attributes:
          - key: env
            value: "production"
            action: upsert
    service:
      pipelines:
        metrics/elasticsearch:
          receivers: [elasticsearch]
          processors: [memory_limiter, resourcedetection, resource/cluster_name_override, resource/static_override, attributes/cardinality_reduction, cumulativetodelta, transform/metadata_nullify, batch]
          exporters: [otlphttp]
    ```

7. Save the configuration file.

8. Set the environment variables:

    Create a systemd override directory:

    ```bash
    sudo mkdir -p /etc/systemd/system/otelcol-contrib.service.d
    ```

    Create the environment configuration file:

    ```bash
    cat <<EOF | sudo tee /etc/systemd/system/otelcol-contrib.service.d/environment.conf
    [Service]
    Environment="NEWRELIC_OTLP_ENDPOINT=https://otlp.nr-data.net:4318"
    Environment="NEWRELIC_LICENSE_KEY=YOUR_LICENSE_KEY_HERE"
    Environment="NEW_RELIC_MEMORY_LIMIT_MIB=100"
    EOF
    ```

    Update the configuration with your values:
    * Replace `https://otlp.nr-data.net:4318` with your region's endpoint
    * Replace `YOUR_LICENSE_KEY_HERE` with your actual New Relic license key
    * Replace `100` with your desired memory limit in MiB for the collector (default: 100 MiB). Adjust based on your environment's needs

9. Restart the OTel Collector Contrib to apply changes:

    ```bash
    sudo systemctl daemon-reload
    sudo systemctl restart otelcol-contrib.service
    ```

</Step>

<Step>

### Verify data collection [#verify-otel]

Verify that the OTel Collector Contrib is running and collecting data without errors:

1. Check the collector service status:

    ```bash
    sudo systemctl status otelcol-contrib.service
    ```

2. Monitor the collector logs for any errors:

    ```bash
    sudo journalctl -u otelcol-contrib.service -f
    ```

    Look for successful connections to Elasticsearch and New Relic. If you see errors, refer to the [troubleshooting guide](/docs/opentelemetry/integrations/elasticsearch/troubleshooting).

</Step>

</Steps>

    </TabsPageItem>

  </TabsPages>
</Tabs>

<Callout variant="tip">
**Correlate APM with Elasticsearch**: To connect your APM application and Elasticsearch cluster, include the resource attribute `es.cluster.name="your-cluster-name"` in your APM metrics. This enables cross-service visibility and faster troubleshooting within New Relic.
</Callout>

## View your Elasticsearch data [#find-and-use]

Once the collector is running and sending data, you can view your Elasticsearch metrics in New Relic:

1. Go to **[one.newrelic.com](https://one.newrelic.com)** > **Integrations & Agents**
2. Search for **Elasticsearch (OpenTelemetry)**
3. Under **Dashboards**, click **Elasticsearch OpenTelemetry Dashboard**
4. Select your account and click **View dashboard**

You should see dashboards showing cluster health, performance metrics, and resource usage.

<Callout variant="tip">
**Not seeing data?** It may take a few minutes for data to appear. If you don't see metrics after 10 minutes, check the collector logs and verify your configuration.
</Callout>

**Next steps with your data:**
- **Explore metrics**: All Elasticsearch metrics are stored as `Metric` [event types](/docs/data-apis/understand-data/new-relic-data-types)
- **Create custom queries**: Use [NRQL](/docs/nrql/get-started/introduction-nrql-new-relics-query-language) to build custom charts and dashboards
- **Set up alerts**: Configure proactive monitoring (see below)

## Set up alerts [#alerts]

Proactive monitoring with alerts helps you catch issues before they impact your users. To create alert conditions in New Relic:

1. Go to **[one.newrelic.com](https://one.newrelic.com)** > **Alerts** > **Alert Conditions**
2. Click **Create condition**
3. Configure the alert using either **Guided mode** or the **NRQL** query builder

The alert configurations below are recommended for robust Elasticsearch monitoring:

### Essential Alerts (High Priority)

These alerts monitor critical cluster health issues that can cause data loss or service outages:

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>Alert Name</th>
      <th>Threshold Rationale (Example Condition)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Unassigned Shards Alert**</td>
      <td>Metric `elasticsearch.cluster.shards` (where `state = 'unassigned'`) is above 0 for at least 5 minutes.</td>
    </tr>
    <tr>
      <td>**Healthy Data Nodes Alert**</td>
      <td>Metric `elasticsearch.cluster.data_nodes` is below your minimum required node count for at least 5 minutes.</td>
    </tr>
    <tr>
      <td>**Heap Usage Too High Alert**</td>
      <td>Heap usage percentage (Used/Max) is above 90% for at least 5 minutes.</td>
    </tr>
    <tr>
      <td>**Pending Tasks Alert**</td>
      <td>Metric `elasticsearch.cluster.pending_tasks` is above 5 for at least 5 minutes.</td>
    </tr>
  </tbody>
</table>

### Additional Monitoring Alerts

These alerts help monitor performance and operational issues:

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>Alert Name</th>
      <th>Threshold Rationale (Example Condition)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Query Time Slow Alert**</td>
      <td>95th percentile of `elasticsearch.node.operations.time` is above 5ms for at least 2 minutes.</td>
    </tr>
    <tr>
      <td>**Initializing Shards Too Long**</td>
      <td>Metric `elasticsearch.cluster.shards` (where `state = 'initializing'`) is above 0 for at least 5 minutes.</td>
    </tr>
    <tr>
      <td>**Relocating Shards Too Long**</td>
      <td>Metric `elasticsearch.cluster.shards` (where `state = 'relocating'`) is above 0 for at least 5 minutes.</td>
    </tr>
  </tbody>
</table>

## Troubleshooting [#troubleshooting]

If you encounter issues during installation or don't see data in New Relic, see our comprehensive [troubleshooting guide](/docs/opentelemetry/integrations/elasticsearch/troubleshooting) for step-by-step solutions to common problems.

