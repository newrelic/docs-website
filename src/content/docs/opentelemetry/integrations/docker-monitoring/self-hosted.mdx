---
title: Configure the OpenTelemetry Collector
tags:
  - Integrations
  - OpenTelemetry
  - Docker

metaDescription: "Install OpenTelemetry Collector on Linux hosts to monitor self-hosted Docker containers with comprehensive metrics and logging."
freshnessValidatedDate: never
---

Monitor your Docker containers by installing the OpenTelemetry Collector directly on Linux hosts. This guide provides complete setup instructions for collecting container metrics and optional log collection.

## Before you begin [#prerequisites]

Before you begin, ensure you have:

- A [New Relic account](https://newrelic.com/signup) with a <InlinePopover type="licenseKey"/>
- Docker Engine (API version 1.25+) installed and running
- Access to the Docker socket (typically `/var/run/docker.sock`)
- [OpenTelemetry Collector Contrib](https://github.com/open-telemetry/opentelemetry-collector-contrib/releases/latest) installed and running on a Linux host
- Network access from the Linux host to:
  - Docker Engine socket
  - One of the [New Relic OTLP](https://docs.newrelic.com/docs/opentelemetry/best-practices/opentelemetry-otlp/#configure-endpoint-port-protocol) endpoints
- For log collection: Read permissions to `/var/lib/docker/containers/` directory (typically requires root or docker group membership)

### Verify your setup

<CollapserGroup>
<Collapser
  id="check-docker-version"
  title="Check Docker version and API"
>

```bash
docker version --format '{{.Client.APIVersion}}'
```
Expected output: `1.25` or higher

</Collapser>

<Collapser
  id="check-otelcol"
  title="Check OpenTelemetry Collector"
>

```bash
otelcol-contrib --version
```
Expected output: Version information (minimum v0.88.0 recommended)

</Collapser>

<Collapser
  id="test-docker-socket"
  title="Test Docker socket access"
>

```bash
docker info
```
Expected output: Docker system information (confirms socket access)

</Collapser>

<Collapser
  id="test-network-connectivity"
  title="Test network connectivity"
>

```bash
# For US region
curl -I https://otlp.nr-data.net/v1/metrics

# For EU region
curl -I https://otlp.eu.nr-data.net/v1/metrics
```
Expected output: HTTP/2 200 response

</Collapser>
</CollapserGroup>

## Setup [#setup]

Follow these steps to configure Docker container monitoring with OpenTelemetry.

### Step 1: Configure the OpenTelemetry Collector [#configure-collector]

Update the `endpoint` value if your Docker socket is at a different location. Merge the receivers, processors, exporters, and service pipelines from the snippet below into your current configuration (typically located at `/etc/otelcol-contrib/config.yaml`).

```yaml
receivers:
  # Docker Stats Receiver - collects container metrics
  docker_stats:
    endpoint: unix:///var/run/docker.sock
    collection_interval: 15s
    timeout: 5s
    api_version: "1.25"
    # Most metrics required for New Relic UI are enabled by default:
    # CPU: container.cpu.usage.total, container.cpu.utilization
    # Memory: container.memory.usage.total, container.memory.percent
    # Network: container.network.io.usage.tx_bytes, container.network.io.usage.rx_bytes
    #          container.network.io.usage.tx_dropped, container.network.io.usage.rx_dropped
    # Storage: container.blockio.io_service_bytes_recursive
    #
    # The following metrics need to be explicitly enabled:
    metrics:
      # Required for New Relic UI
      container.pids.count:
        enabled: true
      # Additional network error metrics
      container.network.io.usage.tx_errors:
        enabled: true
      container.network.io.usage.rx_errors:
        enabled: true

processors:
  # Resource detection - adds host metadata
  resourcedetection:
    detectors: [system, docker]
    system:
      resource_attributes:
        host.name:
          enabled: true
        host.id:
          enabled: true

  # Batch processor - optimizes data transmission
  batch:
    timeout: 30s
    send_batch_size: 512

exporters:
  # New Relic OTLP Exporter
  otlphttp/newrelic:
    endpoint: ${env:NEWRELIC_OTLP_ENDPOINT}
    headers:
      api-key: ${env:NEWRELIC_LICENSE_KEY}
    compression: gzip
    timeout: 30s
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 300s

service:
  pipelines:
    metrics:
      receivers: [docker_stats]
      processors: [resourcedetection, batch]
      exporters: [otlphttp/newrelic]
```

Save the file and ensure the `otelcol-contrib` system user can read it.

### Step 2: Optional - Configure log collection [#configure-logs]

You can also collect logs from your Docker containers using the OpenTelemetry [receiver creator](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator) with the [Docker observer](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/observer/dockerobserver) extension.

<Callout variant="important">
  **Requirements for log collection:**
  - The OpenTelemetry Collector process must have read permissions to the `/var/lib/docker/containers/` directory. This typically requires running the collector as root or adding the collector user to the docker group.
  - Container ports must be exposed for the receiver creator to discover and scrape logs from containers.
</Callout>

Add the following configuration to collect container logs:

```yaml
extensions:
  # Docker observer - discovers running containers
  docker_observer:
    endpoint: unix:///var/run/docker.sock
    use_hostname_if_present: true
    use_container_labels: true

receivers:
  # Receiver creator - dynamically creates filelog receivers for discovered containers
  receiver_creator:
    watch_observers: [docker_observer]
    receivers:
      filelog:
        rule: type == "container"
        config:
          include:
            - /var/lib/docker/containers/`container_id`/`container_id`-json.log
          poll_interval: 200ms
          start_at: end
          include_file_name: false
          include_file_path: false
          operators:
            - id: container-parser
              type: container
              format: docker
              add_metadata_from_filepath: false

processors:
  # Add entity type attribute for logs (required for New Relic entity correlation)
  attributes/logs:
    actions:
      - key: nr.entity_type
        value: CONTAINER
        action: upsert

service:
  extensions: [docker_observer]
  pipelines:
    logs:
      receivers: [receiver_creator]
      processors: [resourcedetection, resource/docker, attributes/logs, batch]
      exporters: [otlphttp/newrelic]
```

### Step 3: Set environment variables [#set-environment-variables]

Configure your New Relic credentials and endpoint:

```bash
# Set your New Relic license key
export NEWRELIC_LICENSE_KEY="your-license-key-here"

# Set the appropriate OTLP endpoint for your region
# For US region:
export NEWRELIC_OTLP_ENDPOINT="https://otlp.nr-data.net/v1/metrics"
# For EU region:
export NEWRELIC_OTLP_ENDPOINT="https://otlp.eu.nr-data.net/v1/metrics"
```

For persistent configuration, add these to your shell profile or create a systemd environment file:

```bash
# Create environment file for systemd
sudo tee /etc/default/otelcol-contrib <<EOF
NEWRELIC_LICENSE_KEY="your-license-key-here"
NEWRELIC_OTLP_ENDPOINT="https://otlp.nr-data.net/v1/metrics"
EOF
```

Then update your systemd service to use the environment file:
```bash
sudo systemctl edit otelcol-contrib
```

Add the following content:
```ini
[Service]
EnvironmentFile=/etc/default/otelcol-contrib
```

### Step 4: Restart the collector [#restart-collector]

Restart the OpenTelemetry Collector to apply the new configuration:

```bash
sudo systemctl restart otelcol-contrib
```

Verify the collector is running:
```bash
sudo systemctl status otelcol-contrib
```

### Step 5: View your data in New Relic [#view-data]

After a few minutes, you should start seeing data in New Relic:

1. Go to **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > All entities**.
2. Search for your Docker host by hostname or container name.
3. Click your entity to view Docker container metrics and details.
4. Explore the **Summary** page to see performance metrics, resource usage, and container health.

The Docker container metrics are attached to the `Metric` [event type](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic). You can [query this data](/docs/using-new-relic/data/understand-data/query-new-relic-data) for troubleshooting purposes or to create custom charts and dashboards.

## Troubleshooting [#troubleshooting]

If you're having issues with your Docker monitoring setup, check these common problems and solutions.

### Collector not starting or crashing [#collector-issues]

**Issue**: OpenTelemetry Collector fails to start or crashes immediately.

**Diagnostics**:
```bash
# Check collector status
sudo systemctl status otelcol-contrib

# View recent logs
journalctl -u otelcol-contrib --since "1 hour ago" -f

# Test configuration syntax
otelcol-contrib --config-validate --config=/etc/otelcol-contrib/config.yaml
```

**Solutions**:
- **Configuration errors**: Fix YAML syntax errors and ensure all required fields are present
- **Missing permissions**: Ensure collector user has read access to configuration file
- **Environment variables**: Verify `NEWRELIC_LICENSE_KEY` and `NEWRELIC_OTLP_ENDPOINT` are set correctly

### No metrics appearing in New Relic [#no-metrics]

**Issue**: Docker containers are running but no metrics appear in New Relic after 10+ minutes.

**Diagnostics**:
```bash
# Verify collector is running and processing data
journalctl -u otelcol-contrib | grep -i "docker\|error\|export"

# Check Docker daemon accessibility
docker info

# Test Docker socket permissions
ls -l /var/run/docker.sock

# Verify containers are running
docker ps
```

**Solutions**:
1. **Docker socket access**: Add collector user to docker group:
   ```bash
   sudo usermod -aG docker otelcol-contrib
   sudo systemctl restart otelcol-contrib
   ```

2. **License key issues**: Verify your license key is correct and has proper permissions:
   ```bash
   echo $NEWRELIC_LICENSE_KEY
   # Should be 40-character NRAK-prefixed key for US, or EU equivalent
   ```

3. **Network connectivity**: Test OTLP endpoint accessibility:
   ```bash
   # For US region
   curl -v -H "api-key: $NEWRELIC_LICENSE_KEY" https://otlp.nr-data.net/v1/metrics

   # For EU region
   curl -v -H "api-key: $NEWRELIC_LICENSE_KEY" https://otlp.eu.nr-data.net/v1/metrics
   ```

4. **Docker API version**: Ensure Docker API version is 1.25+:
   ```bash
   docker version --format '{{.Client.APIVersion}}'
   ```

### Permission denied errors [#permission-errors]

**Issue**: Collector logs show "permission denied" when accessing Docker socket.

**Diagnostics**:
```bash
# Check socket ownership and permissions
ls -la /var/run/docker.sock

# Check collector user membership
groups otelcol-contrib
```

**Solutions**:
```bash
# Option 1: Add collector user to docker group (recommended)
sudo usermod -aG docker otelcol-contrib
sudo systemctl restart otelcol-contrib

# Option 2: Adjust socket permissions (less secure)
sudo chmod 666 /var/run/docker.sock

# Option 3: Run collector as root (not recommended for production)
# Modify systemd service file User= setting
```

### Incomplete or missing container metrics [#incomplete-metrics]

**Issue**: Some containers show metrics while others don't, or metrics are sporadic.

**Diagnostics**:
```bash
# Check for containers with networking issues
docker inspect $(docker ps -q) | grep -A5 "NetworkSettings"

# Review collector configuration
grep -A20 "docker_stats:" /etc/otelcol-contrib/config.yaml

# Check for resource constraints
docker stats --no-stream
```

**Solutions**:
- **Container visibility**: Ensure all containers are accessible via the Docker socket path configured in the collector
- **Resource limits**: Increase collector timeout values if containers are slow to respond:
  ```yaml
  docker_stats:
    timeout: 10s  # Increase from default 5s
    collection_interval: 30s  # Reduce frequency if needed
  ```

- **Network namespaces**: Some containers in restricted network namespaces may not be accessible

### High memory or CPU usage by collector [#performance-issues]

**Issue**: OpenTelemetry Collector consuming excessive system resources.

**Diagnostics**:
```bash
# Monitor collector resource usage
top -p $(pgrep otelcol-contrib)

# Check metric collection frequency
grep -A10 "docker_stats:" /etc/otelcol-contrib/config.yaml

# Count active containers
docker ps --format 'table {{.Names}}\t{{.Status}}' | wc -l
```

**Solutions**:
- **Adjust collection interval**: Reduce monitoring frequency for high-container-count environments:
  ```yaml
  docker_stats:
    collection_interval: 30s  # Increase from 15s
  ```

- **Disable expensive metrics**: Turn off per-CPU metrics if not needed:
  ```yaml
  docker_stats:
    metrics:
      container.cpu.usage.percpu:
        enabled: false
  ```

- **Configure batch processing**: Optimize batching for your environment:
  ```yaml
  batch:
    timeout: 60s
    send_batch_size: 1024
  ```

### Log collection not working [#no-logs]

**Issue**: Configured log collection but container logs don't appear in New Relic.

**Diagnostics**:
```bash
# Check log directory permissions
ls -la /var/lib/docker/containers/

# Verify receiver creator is discovering containers
journalctl -u otelcol-contrib | grep -i "receiver.*creator\|docker.*observer"

# Check if containers have exposed ports (required for discovery)
docker ps --format 'table {{.Names}}\t{{.Ports}}'
```

**Solutions**:
1. **File permissions**: Grant log directory access:
   ```bash
   sudo chmod -R 755 /var/lib/docker/containers/
   # Or add collector to docker group
   sudo usermod -aG docker otelcol-contrib
   ```

2. **Container port exposure**: Expose ports for container discovery:
   ```bash
   # When running containers, expose at least one port
   docker run -p 8080:8080 my-app:latest
   # Or use --expose flag
   docker run --expose 80 my-app:latest
   ```

3. **Observer configuration**: Verify Docker observer settings:
   ```yaml
   docker_observer:
     endpoint: unix:///var/run/docker.sock
     use_hostname_if_present: true
     use_container_labels: true
   ```

### Data not appearing in correct New Relic account [#wrong-account]

**Issue**: Metrics appear in wrong New Relic account or organization.

**Diagnostics**:
```bash
# Verify license key format and region
echo $NEWRELIC_LICENSE_KEY | cut -c1-4
# Should show "NRAK" for US accounts

# Check configured endpoint
echo $NEWRELIC_OTLP_ENDPOINT
```

**Solutions**:
- **US accounts**: Use `https://otlp.nr-data.net/v1/metrics`
- **EU accounts**: Use `https://otlp.eu.nr-data.net/v1/metrics`
- **Verify license key**: Ensure you're using the correct account's license key

For persistent issues, check the [OpenTelemetry Collector troubleshooting guide](https://opentelemetry.io/docs/collector/troubleshooting/) and [New Relic OpenTelemetry documentation](/docs/opentelemetry/opentelemetry-introduction/).

## Next steps [#next-steps]

Now that you have Docker container monitoring set up, you can enhance your observability stack:

### Monitoring and alerting
- **Create custom dashboards**: Build [custom queries and charts](/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/) using NRQL to analyze container performance patterns
- **Set up alerts**: Create <InlinePopover type="alerts"/> for critical container metrics like high memory usage, CPU spikes, or container restart events
- **Monitor container lifecycle**: Track container starts, stops, and restarts to identify stability issues

### Advanced configuration
- **Optimize performance**: Fine-tune collection intervals and metric selection based on your container density and monitoring requirements
- **Add custom attributes**: Enhance your configuration with additional [resource detection processors](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/resourcedetectionprocessor) for richer metadata
- **Explore examples**: Check out [Docker OpenTelemetry configuration examples](https://github.com/newrelic/newrelic-opentelemetry-examples/tree/main/other-examples/collector/docker) in the New Relic OpenTelemetry examples repository

### Expand your observability
- **Application monitoring**: Add [OpenTelemetry auto-instrumentation](https://opentelemetry.io/docs/instrumentation/) to your containerized applications for distributed tracing and application metrics
- **Infrastructure monitoring**: Monitor the underlying host infrastructure with [infrastructure monitoring](https://docs.newrelic.com/docs/infrastructure/)
- **Kubernetes monitoring**: If using Kubernetes, consider [Kubernetes monitoring with OpenTelemetry](https://docs.newrelic.com/docs/kubernetes/kubernetes-monitoring/)

### Learn more
- **Find and query your data**: Learn how to [find and query your Docker data](/docs/opentelemetry/integrations/docker-monitoring/find-and-query-data) in New Relic
- **Explore metrics**: Review the complete [Docker metrics reference](/docs/opentelemetry/integrations/docker-monitoring/metrics-reference) for detailed metric descriptions and alerting recommendations
- **OpenTelemetry fundamentals**: Deepen your understanding with [OpenTelemetry in New Relic](/docs/opentelemetry/opentelemetry-introduction/)