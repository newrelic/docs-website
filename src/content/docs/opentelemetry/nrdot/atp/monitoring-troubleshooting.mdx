---
title: 'Monitor and troubleshoot ATP'
metaDescription: 'Learn how to monitor ATP performance, verify data filtering effectiveness, and troubleshoot common configuration issues.'
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Monitoring
  - Troubleshooting
  - Performance
freshnessValidatedDate: never
---

Learn how to monitor ATP's performance, verify data reduction effectiveness, and troubleshoot common configuration issues.

## Monitor ATP performance [#monitor-atp]

### Verify ATP is running

Check that ATP is loaded and processing data:

```bash
# Check service status
sudo systemctl status nrdot-collector-host

# Look for ATP-specific log messages
sudo journalctl -u nrdot-collector-host -f | grep -i "adaptive"
```

You should see log entries indicating ATP processor initialization and activity.

### Monitor data reduction metrics

ATP automatically generates telemetry about its own performance. Query these metrics in New Relic:

```sql
FROM Metric 
SELECT latest(atp.processes_tracked) as 'Tracked Processes',
       latest(atp.metrics_filtered) as 'Filtered Metrics',
       latest(atp.metrics_retained) as 'Retained Metrics',
       latest(atp.data_reduction_percentage) as 'Data Reduction %'
WHERE deployment.name = 'YOUR_DEPLOYMENT_NAME'
SINCE 1 hour ago
```

### Check ATP state file

ATP maintains a JSON state file to persist process tracking across collector restarts:

```bash
# Check state file exists and has recent updates
ls -la /var/lib/nrdot-collector/adaptivetelemetry.db
stat /var/lib/nrdot-collector/adaptivetelemetry.db

# View state file contents (optional - for debugging)
sudo cat /var/lib/nrdot-collector/adaptivetelemetry.db | jq '.'
```

The state file should be updated regularly (every collection interval) and contain process tracking information.

### Validate configuration

Test your ATP configuration without restarting the service:

```bash
# Dry run to validate configuration
sudo nrdot-collector-host --config-file=/etc/nrdot-collector-host/config.yaml --dry-run
```

## Troubleshoot common issues [#troubleshoot]

### ATP not filtering any metrics

**Symptom**: Data volume remains unchanged after enabling ATP

**Possible causes and solutions**:

<CollapserGroup>
  <Collapser
    id="process-name-mismatch"
    title="Process name mismatch"
  >
    **Problem**: Process names in configuration don't match actual running processes.

    **Solution**: Verify exact process names on your system:
    ```bash
    # Get list of running process names
    ps aux | awk '{print $11}' | sort | uniq

    # Or use htop/top to see process names interactively
    htop
    ```

    Update your configuration with correct process names (use basename only):
    ```yaml
    include_process_list:
      - "nginx"        # ✅ Correct
      - "postgres"     # ✅ Correct
      - "java"         # ✅ Correct
    ```
  </Collapser>

  <Collapser
    id="thresholds-too-high"
    title="Thresholds set too high"
  >
    **Problem**: Metric thresholds are higher than actual process resource usage.

    **Solution**: Lower thresholds to match your environment:
    ```yaml
    metric_thresholds:
      process.cpu.utilization: 0.01    # Lower from 0.05 (1% instead of 5%)
      process.memory.usage: 52428800   # Lower to 50MB instead of 100MB
    ```

    Start with very low thresholds and gradually increase based on your needs.
  </Collapser>

  <Collapser
    id="metrics-not-collected"
    title="Process metrics not being collected"
  >
    **Problem**: ATP requires process metrics to function, but they're not being collected.

    **Solution**: Ensure hostmetrics receiver includes process metrics:
    ```yaml
    receivers:
      hostmetrics:
        collection_interval: 30s
        scrapers:
          processes:
            process:
              metrics:
                process.cpu.utilization:
                  enabled: true
                process.memory.usage:
                  enabled: true
    ```
  </Collapser>
</CollapserGroup>

### Permission denied errors

**Symptom**: ATP fails to create or write to state file

**Error messages**:
- `"permission denied writing to storage path"`
- `"failed to create state file"`

**Solutions**:

```bash
# Create storage directory with correct permissions
sudo mkdir -p /var/lib/nrdot-collector
sudo chmod 755 /var/lib/nrdot-collector
sudo chown nrdot-collector:nrdot-collector /var/lib/nrdot-collector

# Fix existing state file permissions
sudo chown nrdot-collector:nrdot-collector /var/lib/nrdot-collector/adaptivetelemetry.db
sudo chmod 644 /var/lib/nrdot-collector/adaptivetelemetry.db
```

### Collector fails to start

**Symptom**: NRDOT collector service fails to start after adding ATP configuration

**Common causes and solutions**:

<CollapserGroup>
  <Collapser
    id="yaml-syntax-error"
    title="YAML syntax errors"
  >
    **Problem**: Invalid YAML in configuration file.

    **Solution**: Validate YAML syntax:
    ```bash
    # Test configuration file syntax
    sudo nrdot-collector-host --config-file=/etc/nrdot-collector-host/config.yaml --dry-run

    # Use YAML linter
    yamllint /etc/nrdot-collector-host/config.yaml
    ```

    Common YAML errors:
    - Missing spaces after colons
    - Incorrect indentation
    - Mixing tabs and spaces
  </Collapser>

  <Collapser
    id="processor-order"
    title="Incorrect processor order"
  >
    **Problem**: ATP placed in wrong position in processing pipeline.

    **Solution**: Ensure ATP is placed **before** batch processor:
    ```yaml
    service:
      pipelines:
        metrics:
          receivers: [hostmetrics]
          processors: [memory_limiter, adaptivetelemetryprocessor, batch]  # ATP before batch
          exporters: [otlp]
    ```
  </Collapser>

  <Collapser
    id="missing-processor-definition"
    title="Missing processor definition"
  >
    **Problem**: Pipeline references ATP but processor isn't defined.

    **Solution**: Ensure ATP processor is defined in processors section:
    ```yaml
    processors:
      adaptivetelemetryprocessor:  # Must be defined here
        storage_path: "/var/lib/nrdot-collector/adaptivetelemetry.db"
        # ... other config

    service:
      pipelines:
        metrics:
          processors: [adaptivetelemetryprocessor, batch]  # Then referenced here
    ```
  </Collapser>
</CollapserGroup>

### High memory usage

**Symptom**: NRDOT collector consuming excessive memory after enabling ATP

**Solutions**:

1. **Add memory limiter**:
   ```yaml
   processors:
     memory_limiter:
       limit_mib: 512      # 512 MB limit
       spike_limit_mib: 128
       check_interval: 1s
   ```

2. **Reduce ATP retention period**:
   ```yaml
   processors:
     adaptivetelemetryprocessor:
       retention_minutes: 15  # Reduce from default 30 minutes
   ```

3. **Limit process tracking**:
   ```yaml
   processors:
     adaptivetelemetryprocessor:
       include_process_list:
         - "nginx"  # Only track specific processes instead of all
         - "postgres"
   ```

### ATP state file corruption

**Symptom**: ATP fails to start or behaves unexpectedly after collector restart

**Error messages**:
- `"failed to load state file"`
- `"corrupted state data"`

**Solution**: Reset ATP state:
```bash
# Stop collector
sudo systemctl stop nrdot-collector-host

# Remove corrupted state file
sudo rm /var/lib/nrdot-collector/adaptivetelemetry.db

# Start collector (ATP will create new state file)
sudo systemctl start nrdot-collector-host
```

<Callout variant="important">
  Removing the state file resets all process tracking history. ATP will start fresh and rebuild process state over time.
</Callout>

### Data not appearing in New Relic

**Symptom**: ATP is running but no data appears in New Relic UI

**Troubleshooting steps**:

1. **Verify collector connectivity**:
   ```bash
   # Check if collector can reach New Relic endpoints
   curl -I https://otlp.nr-data.net
   ```

2. **Check exporter configuration**:
   ```yaml
   exporters:
     otlp:
       endpoint: https://otlp.nr-data.net:443
       headers:
         api-key: "YOUR_LICENSE_KEY"
   ```

3. **Verify pipeline configuration**:
   ```yaml
   service:
     pipelines:
       metrics:
         receivers: [hostmetrics]
         processors: [adaptivetelemetryprocessor, batch]
         exporters: [otlp]  # Ensure exporter is included
   ```

4. **Check collector logs**:
   ```bash
   # Look for export errors
   sudo journalctl -u nrdot-collector-host -f | grep -i "export\|error\|failed"
   ```

## Performance optimization [#optimize]

### Tune collection intervals

Balance data freshness with system load:

```yaml
receivers:
  hostmetrics:
    collection_interval: 60s  # Increase from 30s to reduce load
```

### Optimize threshold values

Set thresholds based on your environment's typical resource usage:

```yaml
processors:
  adaptivetelemetryprocessor:
    metric_thresholds:
      # Set to 2x your typical idle usage
      process.cpu.utilization: 0.02    # 2% CPU
      process.memory.usage: 104857600  # 100 MB memory
```

### Configure retention strategically

Balance visibility with storage requirements:

```yaml
processors:
  adaptivetelemetryprocessor:
    retention_minutes: 45  # Longer retention for critical processes
    include_process_list:
      - "nginx"            # Always track important services
      - "postgres"
      - "redis"
```

## Log analysis [#log-analysis]

### Useful log patterns

Monitor ATP activity with these log searches:

```bash
# ATP initialization and configuration
sudo journalctl -u nrdot-collector-host | grep "adaptivetelemetryprocessor"

# Process tracking activity
sudo journalctl -u nrdot-collector-host | grep -i "process.*tracked\|process.*filtered"

# Error conditions
sudo journalctl -u nrdot-collector-host | grep -E "ERROR|WARN.*adaptive"

# State file operations
sudo journalctl -u nrdot-collector-host | grep -i "state.*file\|storage"
```

### Enable debug logging

For detailed troubleshooting, enable debug-level logging:

```yaml
service:
  telemetry:
    logs:
      level: debug  # Change from info to debug
```

<Callout variant="caution">
  Debug logging significantly increases log volume. Use only for troubleshooting and revert to `info` level afterward.
</Callout>