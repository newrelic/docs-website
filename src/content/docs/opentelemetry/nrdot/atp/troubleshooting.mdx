---
title: 'Monitor and troubleshoot ATP'
metaDescription: 'Learn how to monitor ATP performance, verify data filtering effectiveness, and troubleshoot common configuration issues.'
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Monitoring
  - Troubleshooting
  - Performance
freshnessValidatedDate: never
---

<Callout title="Preview">
We're still working on this feature, but we'd love for you to try it out!

This feature is currently provided as part of a preview pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/).
</Callout>

Learn how to verify ATP is working correctly and troubleshoot common configuration issues across host and Kubernetes environments.

## Verify ATP is working [#verify-atp]

After installing ATP, verify that New Relic is receiving process data by running these queries in the [query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

<CollapserGroup>
  <Collapser
    id="host-verification"
    title="Host environments"
  >
    
    * To view recent process metrics:
    ```sql
    FROM Metric SELECT *
    WHERE metricName LIKE 'process.%'
    LIMIT 100
    ```

    * To count unique process metric types:
    ```sql
    FROM Metric SELECT uniqueCount(metricName)
    WHERE metricName LIKE 'process.%'
    ```
    
  </Collapser>

  <Collapser
    id="kubernetes-verification"
    title="Kubernetes environments"
  >
    
    * To view recent process metrics for your cluster:
    ```sql
    FROM Metric SELECT *
    WHERE k8s.cluster.name='your-cluster-name'
    AND metricName LIKE 'process.%'
    LIMIT 100
    ```

    * To count unique process metric types for your cluster:
    ```sql
    FROM Metric SELECT uniqueCount(metricName)
    WHERE k8s.cluster.name='your-cluster-name'
    AND metricName LIKE 'process.%'
    ```
    
  </Collapser>
</CollapserGroup>

## Troubleshoot ATP issues [#troubleshoot]

### ATP not filtering metrics

**Problem**: All process metrics are being sent, not filtered.

<CollapserGroup>
  <Collapser
    id="host-atp-filtering"
    title="Host environment solutions"
  >
    
    1. **Verify ATP is in the pipeline processors list**
    2. **Check `metric_thresholds` are configured**
    3. **Ensure process metrics are being collected**
    4. **Review collector logs for ATP initialization errors**
    
  </Collapser>

  <Collapser
    id="kubernetes-atp-filtering"
    title="Kubernetes environment solutions"
  >
    
    1. **Verify ATP is enabled**:
        ```bash
        kubectl get configmap -n newrelic nr-k8s-otel-collector-daemonset-config -o yaml | grep adaptivetelemetry
        ```

    2. **Check ATP is in the pipeline**: Look for `adaptivetelemetry` in the `metrics/nr` pipeline

    3. **Verify you're using the correct collector image**:
        ```bash
        kubectl get daemonset -n newrelic nr-k8s-otel-collector-daemonset -o yaml | grep "image:"
        ```
        
        Expected: `newrelic/nrdot-collector:1.8.0` (or later)  
        **NOT**: `newrelic/nrdot-collector-k8s:1.8.0`

    4. **Verify `enable_atp` is set to `true`** in your `values.yaml` or ConfigMap
    
  </Collapser>
</CollapserGroup>

### High memory usage [#high-memory]

**Problem**: Collector memory increases over time

**Solution**: Adjust retention settings:

```yaml
processors:
  adaptivetelemetry:
    retention_minutes: 15  # Reduce from default 30
```

### Processes not being captured [#missing-processes]

**Problem**: Expected processes are missing from telemetry

**Solution**: Must use full path to add processes to include list. Entries without path separators won't match any process.:

```yaml
processors:
  adaptivetelemetry:
    include_process_list:
      - "/usr/bin/myapp"  # Always captured regardless of thresholds
```

## Configuration requirements [#config-requirements]

### Enable persistence file feature

To enable ATP's persistence file feature, you need to run the binary with escalated privileges.

For Kubernetes (Helm chart), add this to the `daemonset.yaml` file:

```yaml
hostPID: true
```

### Enable disk.io data

To enable `disk.io` data collection by the OpenTelemetry hostmetrics receiver, you need escalated privileges because the io data stored at `/proc/[PID]/io` requires root user access. This is not an ATP requirement - ATP only processes data that's already been collected by OpenTelemetry.

Add this to your Helm chart:

```yaml
securityContext:
  allowPrivilegeEscalation: true
  privileged: true
  readOnlyRootFilesystem: false
  runAsNonRoot: false
  runAsUser: 0
```
## Related resources [#related-resources]

<DocTiles>
    <DocTile title="Advanced-features" path="/docs/opentelemetry/nrdot/atp/advanced-features">Learn how to enable advanced features for your ATP deployment.</DocTile>
    <DocTile title="Query your data" path="/docs/opentelemetry/nrdot/atp/query">Learn how to query ATP data in New Relic using NRQL.</DocTile>
    <DocTile title="View your data" path="/docs/opentelemetry/nrdot/atp/view-data">Learn how to view the data collected by ATP in New Relic.</DocTile>
</DocTiles>