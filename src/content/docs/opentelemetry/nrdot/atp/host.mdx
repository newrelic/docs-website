---
title: 'Configure ATP for host'
metaDescription: 'Step-by-step guide to install and configure the Adaptive Telemetry Processor (ATP) with NRDOT Collector Host distribution.'
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Configuration
  - Setup
  - Installation
freshnessValidatedDate: never
---

<Callout title="Preview">
We're still working on this feature, but we'd love for you to try it out!

This feature is currently provided as part of a preview pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/). It is not available to customers subject to HIPAA or FedRAMP regulations.
</Callout>

Learn how to install and configure the Adaptive Telemetry Processor (ATP) with the NRDOT Collector. ATP is included with the standard NRDOT distribution to reduce telemetry data volume while maintaining critical visibility.



## Installation options [#installation-options]

Choose the installation approach that matches your current setup:

<Tabs>
  <TabsBar>
    <TabsBarItem id="new">New installation</TabsBarItem>
    <TabsBarItem id="upgrade">Upgrade from NRDOT</TabsBarItem>
    <TabsBarItem id="native">Migrate from native agent</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="new">

<Steps>

<Step>

### Before you begin [#prereq]

Ensure you have:

* Your New Relic license key
* Root or sudo privileges.
* Network access to GitHub releases

</Step>


  <Step>

    ### Install NRDOT collector host [#install-nrdot]

ATP comes pre-packaged with the NRDOT collector distribution. Based on your OS, choose your installation method:

<CollapserGroup>
  <Collapser
    id="deb"
    title="For Debian/Ubuntu"
  >

1. Set the environment variables:

    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="amd64"  # Use 'arm64' for ARM processors
    export license_key="YOUR_NEW_RELIC_LICENSE_KEY"
    ```

2. Download the NRDOT package:

    ```bash
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
      --location \
      --output collector.deb
    ```

3. Install the downloaded package:

    ```bash
    sudo dpkg -i collector.deb
    ```

3. Configure the NRDOT collector to use defined environment variables:

    ```bash
    echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
    ```

4. Start the NRDOT collector service:

    ```bash
    sudo systemctl reload-or-restart "${collector_distro}.service"
    ```
  </Collapser>

  <Collapser
    id="rhel"
    title="For RHEL/CentOS"
  >

1. Set the environment variables:

    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="x86_64"  # Use 'arm64' for ARM processors
    export license_key="YOUR_LICENSE_KEY"
    ```

2. Download the NRDOT package:

    ```bash
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
      --location \
      --output collector.rpm
      ```

3. Install the downloaded package:

    ```bash
    sudo rpm -i collector.rpm
    ```

3. Configure the NRDOT collector to use defined environment variables:

    ```bash
    echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
    ```

4. Start the NRDOT collector service:

    ```bash
    sudo systemctl reload-or-restart "${collector_distro}.service"
    ```
  </Collapser>

  <Collapser
    id="binary"
    title="For manual binary"
  >
    
1. Set the environment variables:

    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="amd64"  # Use 'arm64' for ARM processors
    export license_key="YOUR_LICENSE_KEY"
    ```

2. Download and extract the collector:

    ```bash
    # Download the tarball
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.tar.gz" \
      --location \
      --output collector.tar.gz

    # Extract contents
    tar -xzf collector.tar.gz
    ```

3. Run the collector:

    ```bash
    # Run collector in foreground
    NEW_RELIC_LICENSE_KEY="${license_key}" ./nrdot-collector-host --config ./config.yaml
    ```

  </Collapser>

</CollapserGroup>

</Step>

<Step>

### Configure ATP [#configure-atp]

Once the NRDOT collector is installed, edit the collector's configuration file to enable and customize ATP. The configuration file paths vary depending on your installation method:

* For DEB/RPM installations, the config file is located at `/etc/nrdot-collector-host/config.yaml`.
* For manual binary installations, the config file is located inside the extracted folder.


To edit the configuration file:

1. Open the configuration file (`config.yaml`) with a text editor using root or sudo privileges:

  ```bash
  sudo nano /etc/nrdot-collector-host/config.yaml
  ```

2. To collect the process metrics, add the following code snippet under the `processes` section:

    ```yaml
    processes:
    process:
      metrics:
        process.cpu.utilization:
          enabled: true
        process.memory.utilization:
          enabled: true
      mute_process_name_error: true
      mute_process_exe_error: true
      mute_process_io_error: true
      mute_process_user_error: true

    ```

3. To enable ATP, add the following ATP processor configuration under the `processors` section:

    ```yaml
    processors:
    adaptivetelemetryprocessor:
      storage_path: "/var/lib/nrdot-collector/adaptiveprocess.db"
      retention_minutes: 30
      include_process_list:
        - "stress-ng"  # Replace with your target processes
      metric_thresholds:
        process.cpu.utilization: 0.05     # 5% CPU
        process.memory.utilization: 0.05  # 5% memory
    ```

4. Add the ATP processor to your metrics pipeline under the `service` section:

    ```yaml
    service:
      pipelines:
        metrics/host:
          receivers: [hostmetrics]
          processors:
            - memory_limiter
            - adaptivetelemetryprocessor  # ADD THIS LINE
            - metricstransform
            - filter/exclude_cpu_utilization
            - filter/exclude_memory_utilization
    ```

3. *(Optional)* Update the ATP configuration as required. For more details on configuration options, see the [Configuration parameters](#config-parameters).

4. Save the configuration file.

5. Restart the NRDOT collector to apply changes:

  ```bash
  sudo systemctl restart nrdot-collector-host
  ```

</Step>

</Steps>

{/* 

### Configure ATP [#atp-configuration]

Add the ATP processor configuration to your `config.yaml` file. Here's a complete configuration example:

```yaml
processors:
  adaptivetelemetryprocessor:
    storage_path: "/var/lib/nrdot-collector/adaptivetelemetry.db"
    retention_minutes: 30
    include_process_list:
      - "stress-ng"
    metric_thresholds:
      process.cpu.utilization: 0.0005
      process.memory.utilization: 0.0005
      process.memory.virtual: 20971520  # 20 MB
      process.threads: 16
      process.open_file_descriptors: 30
      process.disk.io: 204800  # 200KB
      process.disk.operations: 300
      process.context_switches: 8
      process.paging.faults: 50
      process.cpu.time: 0.01
    
    # Enable intelligence layers
    enable_dynamic_thresholds: true
    dynamic_smoothing_factor: 0.1
    min_thresholds:
      process.cpu.utilization: 0.0005
      process.memory.utilization: 0.0005
    max_thresholds:
      process.cpu.utilization: 0.30
      process.memory.utilization: 0.30
    
    # Multi-metric composite scoring
    enable_multi_metric: true
    composite_threshold: 0.8
    weights:
      process.cpu.utilization: 0.5
      process.memory.utilization: 0.5
    
    # Anomaly detection
    enable_anomaly_detection: true
    anomaly_history_size: 15
    anomaly_change_threshold: 50.0
    anomaly_min_data_points: 3

service:
  pipelines:
    metrics:
      receivers: [hostmetrics]
      processors: [adaptivetelemetryprocessor, batch]
      exporters: [otlp]
``` */}

    </TabsPageItem>

    <TabsPageItem id="upgrade">


### Before you begin [#upgrade-prereq]

Ensure you have:

* Existing NRDOT Collector version `TO-Be-Confirmed` or later
* Your New Relic license key
* Root or sudo privileges
* Backup of current configuration


## Upgrade NRDOT to ATP-enabled version [#upgrade-nrdot]

### Step 1: Backup current configuration

Safeguard your current settings before proceeding:

```bash
cp /etc/nrdot-collector-host/config.yaml /etc/nrdot-collector-host/config.yaml.bak
```

### Step 2: Upgrade the collector binary

You don't need to uninstall your current version. Simply run the installation commands for the latest version, which will overwrite the old binary while preserving your existing configuration file.

<CollapserGroup>
  <Collapser
    id="upgrade-deb"
    title="Debian/Ubuntu upgrade"
  >
    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="amd64"  # Use 'arm64' for ARM processors

    # Download and install latest version
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
      --location \
      --output collector.deb

    sudo dpkg -i collector.deb
    ```
  </Collapser>

  <Collapser
    id="upgrade-rpm"
    title="RHEL/CentOS upgrade"
  >
    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="x86_64"  # Use 'arm64' for ARM processors

    # Download and install latest version
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
      --location \
      --output collector.rpm

    sudo rpm -U collector.rpm
    ```
  </Collapser>
</CollapserGroup>

### Step 3: Add ATP configuration

The upgrade preserved your previous settings, so your `config.yaml` doesn't yet contain the new ATP settings. You must add them manually.

**Edit the configuration file:**

```bash
sudo nano /etc/nrdot-collector-host/config.yaml
```

**Add ATP processor block to the `processors:` section:**

```yaml
processors:
  # Your existing processors...
  adaptivetelemetryprocessor:
    storage_path: "/var/lib/nrdot-collector/adaptivetelemetry.db"
    retention_minutes: 30
    include_process_list:
      - "stress-ng"
    metric_thresholds:
      process.cpu.utilization: 0.0005
      process.memory.utilization: 0.0005
      process.memory.virtual: 20971520  # 20 MB
      process.threads: 16
      process.open_file_descriptors: 30
```

**Update the service pipeline to include ATP:**

Add `adaptivetelemetryprocessor` to your metrics pipeline (ensure it's placed **before** `batch`):

```yaml
service:
  pipelines:
    metrics:
      receivers: [otlp, processes]
      processors: [memory_limiter, adaptivetelemetryprocessor, batch]  # Add ATP here
      exporters: [otlphttp]
```

### Step 4: Restart the service

```bash
sudo systemctl restart nrdot-collector-host
```

### Step 5: Verify ATP is working

Check the logs to confirm ATP is running:

```bash
sudo journalctl -u nrdot-collector-host -f | grep -i "adaptive"
```

    </TabsPageItem>

    <TabsPageItem id="native">

## Before you begin [#prerequisites-migration]

Ensure you have:

* Currently running New Relic native infrastructure agent (`newrelic-infra`)
* Your New Relic license key
* Root or sudo access
* Plan for minimal service interruption

<Callout variant="important">
  You must stop the existing infrastructure agent to prevent data conflicts and duplicate charges.
</Callout>

## Migrate from native agent to NRDOT with ATP [#migrate-native]

### Step 1: Stop and disable native agent

Stop the existing infrastructure agent to prevent data conflict:

```bash
# Stop the service
sudo systemctl stop newrelic-infra

# Disable from starting on boot
sudo systemctl disable newrelic-infra
```

<Callout variant="tip">
  For detailed uninstallation instructions, see [Uninstall Infrastructure Agent](https://docs.newrelic.com/docs/infrastructure/infrastructure-agent/update-or-uninstall/uninstall-infrastructure-agent/).
</Callout>

### Step 2: Install NRDOT Collector with ATP

Choose your installation method:

<CollapserGroup>
  <Collapser
    id="migrate-deb"
    title="Debian/Ubuntu installation"
  >
    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="amd64"  # Use 'arm64' for ARM processors
    export license_key="YOUR_LICENSE_KEY"

    # Download the .deb package
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
      --location \
      --output collector.deb

    # Install the package
    sudo dpkg -i collector.deb

    # Configure license key
    echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null

    # Start the collector service
    sudo systemctl reload-or-restart "${collector_distro}.service"
    ```
  </Collapser>

  <Collapser
    id="migrate-rpm"
    title="RHEL/CentOS installation"
  >
    ```bash
    export collector_distro="nrdot-collector-host"
    export collector_version="1.8.0"
    export collector_arch="x86_64"  # Use 'arm64' for ARM processors
    export license_key="YOUR_LICENSE_KEY"

    # Download the .rpm package
    curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
      --location \
      --output collector.rpm

    # Install the package
    sudo rpm -i collector.rpm

    # Configure license key
    echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null

    # Start the collector service
    sudo systemctl reload-or-restart "${collector_distro}.service"
    ```
  </Collapser>
</CollapserGroup>

### Step 3: Configure ATP (Optional)

By default, NRDOT collects data without ATP filtering. To enable ATP's intelligent filtering:

```bash
sudo nano /etc/nrdot-collector-host/config.yaml
```

Add ATP processor configuration to reduce data volume:

```yaml
processors:
  adaptivetelemetryprocessor:
    storage_path: "/var/lib/nrdot-collector/adaptivetelemetry.db"
    retention_minutes: 30
    metric_thresholds:
      process.cpu.utilization: 0.0005
      process.memory.utilization: 0.0005
      process.memory.virtual: 20971520  # 20 MB
```

Update the pipeline:

```yaml
service:
  pipelines:
    metrics:
      receivers: [hostmetrics]
      processors: [adaptivetelemetryprocessor, batch]
      exporters: [otlp]
```

Restart the service:

```bash
sudo systemctl restart nrdot-collector-host
```

### Step 4: Verify migration

Check that data is flowing to New Relic:

1. **Verify service status:**
   ```bash
   sudo systemctl status nrdot-collector-host
   ```

2. **Check logs:**
   ```bash
   sudo journalctl -u nrdot-collector-host -f
   ```

3. **Confirm data in New Relic UI:**
   - Go to [one.newrelic.com](https://one.newrelic.com)
   - Navigate to **Infrastructure** to see your host data

<Callout variant="tip">
  It may take a few minutes for data to appear in the New Relic UI after starting the collector.
</Callout>

    </TabsPageItem>

  </TabsPages>
</Tabs>

## Configuration parameters [#config-parameters]

<CollapserGroup>
  <Collapser
    id="core-settings"
    title="Core settings"
  >
    <table>
      <thead>
        <tr>
          <th>
            **Parameter**
          </th>
          <th>
            **Type**
          </th>
          <th>
            **Default**
          </th>
          <th>
            **Description**
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            `storage_path`
          </td>
          <td>
            string
          </td>
          <td>
            `"./adaptiveprocess.db"`
          </td>
          <td>
            Path to JSON state file for persistence
          </td>
        </tr>
        <tr>
          <td>
            `retention_minutes`
          </td>
          <td>
            integer
          </td>
          <td>
            `30`
          </td>
          <td>
            How long to retain process state in minutes
          </td>
        </tr>
        <tr>
          <td>
            `include_process_list`
          </td>
          <td>
            array
          </td>
          <td>
            `[]`
          </td>
          <td>
            Process names to always include (bypasses filtering)
          </td>
        </tr>
        <tr>
          <td>
            `metric_thresholds`
          </td>
          <td>
            map
          </td>
          <td>
            `{}`
          </td>
          <td>
            Static thresholds per metric type
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="dynamic-thresholds"
    title="Dynamic thresholds"
  >
    <table>
      <thead>
        <tr>
          <th>
            **Parameter**
          </th>
          <th>
            **Type**
          </th>
          <th>
            **Default**
          </th>
          <th>
            **Description**
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            `enable_dynamic_thresholds`
          </td>
          <td>
            boolean
          </td>
          <td>
            `false`
          </td>
          <td>
            Enable adaptive threshold adjustment
          </td>
        </tr>
        <tr>
          <td>
            `dynamic_smoothing_factor`
          </td>
          <td>
            float
          </td>
          <td>
            `0.1`
          </td>
          <td>
            Smoothing factor for threshold adaptation (0.0-1.0)
          </td>
        </tr>
        <tr>
          <td>
            `min_thresholds`
          </td>
          <td>
            map
          </td>
          <td>
            `{}`
          </td>
          <td>
            Minimum threshold values per metric
          </td>
        </tr>
        <tr>
          <td>
            `max_thresholds`
          </td>
          <td>
            map
          </td>
          <td>
            `{}`
          </td>
          <td>
            Maximum threshold values per metric
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="multi-metric-scoring"
    title="Multi-metric composite scoring"
  >
    <table>
      <thead>
        <tr>
          <th>
            **Parameter**
          </th>
          <th>
            **Type**
          </th>
          <th>
            **Default**
          </th>
          <th>
            **Description**
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            `enable_multi_metric`
          </td>
          <td>
            boolean
          </td>
          <td>
            `false`
          </td>
          <td>
            Enable composite scoring across metrics
          </td>
        </tr>
        <tr>
          <td>
            `composite_threshold`
          </td>
          <td>
            float
          </td>
          <td>
            `0.8`
          </td>
          <td>
            Threshold for composite score evaluation (0.0-1.0)
          </td>
        </tr>
        <tr>
          <td>
            `weights`
          </td>
          <td>
            map
          </td>
          <td>
            `{}`
          </td>
          <td>
            Weight values per metric for composite scoring
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="anomaly-detection"
    title="Anomaly detection"
  >
    <table>
      <thead>
        <tr>
          <th>
            **Parameter**
          </th>
          <th>
            **Type**
          </th>
          <th>
            **Default**
          </th>
          <th>
            **Description**
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            `enable_anomaly_detection`
          </td>
          <td>
            boolean
          </td>
          <td>
            `false`
          </td>
          <td>
            Enable anomaly detection layer
          </td>
        </tr>
        <tr>
          <td>
            `anomaly_history_size`
          </td>
          <td>
            integer
          </td>
          <td>
            `15`
          </td>
          <td>
            Number of historical data points to track
          </td>
        </tr>
        <tr>
          <td>
            `anomaly_change_threshold`
          </td>
          <td>
            float
          </td>
          <td>
            `50.0`
          </td>
          <td>
            Percentage change threshold for anomalies
          </td>
        </tr>
        <tr>
          <td>
            `anomaly_min_data_points`
          </td>
          <td>
            integer
          </td>
          <td>
            `3`
          </td>
          <td>
            Minimum data points required before anomaly detection
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

{/* ## Metric threshold guidelines

### CPU utilization (0.0-1.0 scale)
- **Light filtering**: `0.10` (10% CPU)
- **Standard filtering**: `0.05` (5% CPU)  
- **Aggressive filtering**: `0.02` (2% CPU)

### Memory utilization (0.0-1.0 scale)
- **Light filtering**: `0.10` (10% memory)
- **Standard filtering**: `0.05` (5% memory)
- **Aggressive filtering**: `0.02` (2% memory)

### Memory usage (bytes)
- **Small processes**: `52428800` (50 MB)
- **Medium processes**: `104857600` (100 MB)
- **Large processes**: `209715200` (200 MB)

### I/O thresholds (bytes)
- **Light I/O**: `1048576` (1 MB)
- **Medium I/O**: `5242880` (5 MB)
- **Heavy I/O**: `10485760` (10 MB)

## Process name matching

ATP matches process names using the **basename** (not full path):

### Examples
- ✅ **Correct**: `"nginx"` matches `/usr/sbin/nginx`
- ✅ **Correct**: `"java"` matches `/usr/bin/java`
- ❌ **Incorrect**: `"/usr/sbin/nginx"` won't match

### Common process names
```yaml
include_process_list:
  # Web servers
  - "nginx"
  - "apache2"
  - "httpd"
  
  # Databases
  - "postgres"
  - "mysql"
  - "redis"
  - "mongodb"
  
  # Applications
  - "java"
  - "python"
  - "node"
  - "php-fpm"
``` */}