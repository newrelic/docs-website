---
title: Install the Kubernetes integration for Windows
tags:
  - Integrations
  - Kubernetes integration
  - Installation
metaDescription: How to install the K8 integration for Windows.
---

<Callout title="LIMITED RELEASE">
This feature is a limited release.
</Callout>

To run our Kubernetes installation for Windows, follow the steps below to:

* Check the [compatibility and requirements](#k8-windows-req).
* [Update the manifest](#k8-windows-install) file.
* Learn about the [limitations](#k8-windows-limitations) of the integration.

## Compatibility and requirements [#k8-windows-req]

Before you install [New Relic's Kubernetes integration](/docs/integrations/kubernetes-integration/get-started/introduction-kubernetes-integration), review the [compatibility and requirements](/docs/integrations/kubernetes-integration/get-started/kubernetes-integration-compatibility-requirements).

<Callout variant="important">
  When using containers in Windows, the container host version and the container image version must be the same. Our Kubernetes integration supports Windows versions 1809 and 1909.
</Callout>

To check your Windows version:

1. Open a command window.
2. Run the following command:

   ```
   Reg Query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v 
   ReleaseIdcmd.exe
   ```

### Example: Get Kubernetes for Windows from a BusyBox container.

```
$ kubectl exec -it busybox1-766bb4d6cc-rmsnj -- Reg Query 
    "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ReleaseId
```

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion
	ReleaseId	REG_SZ	1809
```

## Install [#k8-windows-install]

You can install the Kubernetes integration for Windows using Helm. See an example on how to install the integration in a cluster with nodes having different build versions of Windows (1809 and 2004):

1. Install [kube-state-metrics](https://github.com/kubernetes/kube-state-metrics#kubernetes-deployment "Link opens in a new window.") and run it in your cluster using this snippet:

   ```
   curl -L -o kube-state-metrics-1.9.5.zip 
   https://github.com/kubernetes/kube-state-metrics/archive/v1.9.5.zip && 
   unzip kube-state-metrics-1.9.5.zip && kubectl apply -f 
   kube-state-metrics-1.9.5/examples/standard
   ```
2. Create a `values.yml` file with the follow data to be used by Helm:

   ```
   global:
     licenseKey: <YOUR_LICENSE_KEY> 
     cluster: <YOUR_CLUSTER_NAME>

   enableLinux: false
   enableWindows: true
   windowsOsList:
     - version: 1809
       imageTag: 2.2.0-windows-1809-alpha
       buildNumber: 10.0.17763
     - version: 2004
       imageTag: 2.2.0-windows-2004-alpha
       buildNumber: 10.0.19041
   ```
3. Install the integration with:

   ```
   helm install <YOUR_INSTALL_NAME> newrelic/newrelic-infrastructure -f values.yml
   ```
4. Confirm that the `DaemonSet` has been created successfully by looking for `newrelic-infra` in the results generated by this command:

   ```
   kubectl get daemonsets
   ```

The Helm chart will create one DeamonSet per each version of Windows that is in the list and use NodeSelector to deploy the corresponding Pod per Node.

## Limitations [#k8-windows-limitations]

The following limitations apply to the Kubernetes integration for Windows:

* The Windows agent only sends the [Kubernetes samples](/docs/integrations/kubernetes-integration/understand-use-data/understand-use-data#event-types) (`K8sNodeSample`, `K8sPodSample`, etc.)
  * `SystemSample`, `StorageSample`, `NetworkSample`, and `ProcessSample` are not generated.
* Some [Kubernetes metrics](/docs/integrations/kubernetes-integration/understand-use-data/understand-use-data#metrics) are missing because the Windows kubelet doesnâ€™t have them:
  * Node:
    * `fsInodes`: not sent
    * `fsInodesFree`: not sent
    * `fsInodesUsed`: not sent
    * `memoryMajorPageFaultsPerSecond`: always returns zero as a value
    * `memoryPageFaults`: always returns zero as a value
    * `memoryRssBytes`: always returns zero as a value
    * `runtimeInodes`: not sent
    * `runtimeInodesFree`: not sent
    * `runtimeInodesUsed`: not sent
  * Pod:
    * `net.errorsPerSecond`: not sent
    * `net.rxBytesPerSecond`: not sent
    * `net.txBytesPerSecond`: not sent
  * Container:
    * `containerID`: not sent
    * `containerImageID`: not sent
    * `memoryUsedBytes`: in the UI, this is displayed in the pod card that appears when you click on a pod, and will show no data. We will soon fix this by updating our charts to use `memoryWorkingSetBytes` instead.
  * Volume:
    * `fsUsedBytes`: zero, so `fsUsedPercent` is zero

## Known issues with the Windows Kubelet [#k8-windows-limitations]

There are a couple of issues with the Windows version of Kubelet that can prevent the integration from fetching data:

* [Issue 90554:](https://github.com/kubernetes/kubernetes/pull/90554) This issue makes the Kubelet return 500 errors when the integration makes a request to the `/stats/summary` endpoint. It will be included in the Kubernetes 1.19 release and has been backported to the releases 1.16.11, 1.17.7, and 1.18.4. There is no solution on the integration side for this problem, we advise you to update to one of the patch versions as soon as possible. You can see if you're being affected by this problem by [enabling verbose logs](/docs/integrations/kubernetes-integration/troubleshooting/get-logs-version#verbose) and looking for messages of the type:

  ```
  error querying Kubelet. Get "https://<var><KUBELET_IP></var>/stats/summary": error calling kubelet endpoint. Got status code: 500
  ```
* [Issue 87730:](https://github.com/kubernetes/kubernetes/pull/87730) This issue makes the Kubelet metrics very slow when running minimal load. It makes the integration fail with a timeout error. A patch for this issue has been added for Kubernetes 1.18 and backported to 1.15.12, 1.16.9, and 1.17.5. We advise you to update to one of the patch versions as soon as possible. To mitigate this issue you can increase the integration timeout with the [`TIMEOUT` config option](/docs/integrations/kubernetes-integration/installation/kubernetes-integration-install-configure#kube-state-metrics-timeout-change). You can see if you're being affected by this problem by [enabling verbose logs](/docs/integrations/kubernetes-integration/troubleshooting/get-logs-version#verbose) and looking for messages of the type:

  ```
  error querying Kubelet. Get "https://<var><KUBELET_IP></var>/stats/summary": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
  ```
