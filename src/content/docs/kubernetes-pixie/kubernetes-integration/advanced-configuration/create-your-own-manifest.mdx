---
title: Create your own manifest file
tags:
  - Integrations
  - Kubernetes integration
  - Installation
metaDescription: How to create a manifest using Helm as a templating system
---

You can create your own manifest file using Helm to cover all your needs, such as to set the proxy you want to use. To understand all the power of Helm, we recommend you to read [how to install Kubernetes integration using Helm](/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm) before going through this document.

## Compatibility and requirements [#compatibility]

* Ensure [Helm](https://github.com/helm/helm#install) matches your Kubernetes integration version. For example, version 3 of the Kubernetes integration requires Helm version 3.
* A New Relic account. Don't have one? [Sign up for free!](https://newrelic.com/signup) No credit card required.
* Your New Relic <InlinePopover type="licenseKey" />.
* Your Kubernetes cluster's name.
  * If you need a display name for your cluster, you can use the output of the following command:
    ```shell
    kubectl config current-context
    ```

## Templating Kubernetes integration with Helm [#install-k8-helm]

<Callout variant="important">
  Installing and upgrading using a manifest isn't supported and is prone to errors. Be completely sure that this is the approach you need for your environment.
</Callout>

1. Add the New Relic Helm charts repository by running:
  ```shell
  helm repo add newrelic https://helm-charts.newrelic.com
  ```

2. Create a file named `values-newrelic.yaml`, which will be used to define your configuration, that follows this structure:

<Callout variant="important">
Refer to our Helm installation documentation to know [how to configure it](/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm/#configure)
</Callout>

```yaml
global:
  licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
  cluster: _K8S_CLUSTER_NAME_

newrelic-prometheus-agent:
  # Automatically scrape prometheus metrics for annotated services in the cluster
  enabled: true
nri-metadata-injection:
  # Deploy our webhook to link APM and Kubernetes entities
  enabled: true
nri-kube-events:
  # Report Kubernetes events
  enabled: true
newrelic-logging:
  # Report logs for containers running in the cluster
  enabled: true
kube-state-metrics:
  # Deploy kube-state-metrics in the cluster.
  # Set this to true unless it is already deployed.
  enabled: true
```

3. Make sure everything is configured properly in the chart by running the following command. Notice that we're specifying `--dry-run` and `--debug`, so nothing is installed in this step:

```shell
helm upgrade --install newrelic newrelic/nri-bundle \
--namespace newrelic --create-namespace \
-f values-newrelic.yaml \
--dry-run \
--debug
```

Please notice and modify the following values:

* `global.licenseKey=YOUR_NEW_RELIC_LICENSE_KEY`: Set it to a valid New Relic <InlinePopover type="licenseKey" /> for your account.
* `global.cluster=K8S_CLUSTER_NAME`: Set it to identify the cluster in New Relic, so it should be a unique descriptive value.
* `kube-state-metrics.enabled=true`: Setting it to `true` will automatically install Kube State Metrics (KSM) for you, which is required for our integration to run. You can set this to `false` if KSM is already present in your cluster, even if it's on a different namespace.
* `newrelic-prometheus-agent.enabled=true`: Set it to `true` to deploy our Prometheus agent, which automatically collects data from Prometheus endpoints present in the cluster.
* `nri-metadata-injection.enabled=true`: Set it to `true` to install our minimal webhook, which adds environment variables that allow [linking applications instrumented with New Relic APM to Kubernetes](/docs/kubernetes-pixie/kubernetes-integration/link-your-applications/link-your-applications-kubernetes).

<Callout variant="tip">
Our Kubernetes charts have a comprehensive set of flags and tunables that you can edit to fit your particular needs. Check how to [configure the integration](#configure) below to see what you can modify.
</Callout>

4. Template the Kubernetes integration by running:
  ```shell
  helm template newrelic newrelic/nri-bundle \
  --namespace newrelic --create-namespace \
  -f values-newrelic.yaml > templated-nri-bundle.yaml
  ```

5. Apply the manifest generated by running:
  ```shell
  kubectl -n newrelic apply -f templated-nri-bundle.yaml
  ```

## Upgrade using Manifest [#upgrade]

<Callout variant="important">
  Installing and upgrading using a manifest isn't supported and is prone to errors. Be completely sure that this is the approach you need for your environment.
</Callout>

1. Update the local chart repository by running:
  ```shell
  helm repo update
  ```

2. Template the file by running:
  ```shell
  helm template newrelic newrelic/nri-bundle \
  --namespace newrelic --create-namespace \
  -f values-newrelic.yaml > new-templated-nri-bundle.yaml
  ```

3. Uninstall the previous version of the Kubernetes integration, which uses the previous manifest, and apply the new one by running:
  ```shell
  kubectl -n newrelic delete -f templated-nri-bundle.yaml
  kubectl -n newrelic apply -f new-templated-nri-bundle.yaml
  ```

## Uninstall Kubernetes integration [#uninstall]

To uninstall the Kubernetes integration using Helm, run:
  ```shell
  kubectl -n newrelic delete -f templated-nri-bundle.yaml
  ```
