---
title: New Relic Lens
tags:
  - New Relic Lens
  - Query data
  - SQL queries
  - Cross-database joins
  - Data analysis
  - Multiple data sources
metaDescription: "Use New Relic Lens to query multiple data sources using ANSI SQL, perform cross-database joins, and analyze data from various sources in a unified interface."
freshnessValidatedDate: never
---

import lensArch from 'images/lens/nr-lens-arch.webp'

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

As a New Relic user, you may need to analyze your telemetry data alongside data stored across multiple databases, data warehouses, and spreadsheets. Manually exporting data from each source and combining it with your observability data offline takes time and reduces productivity. Additionally, you often can't consolidate all data into a single database due to compliance, security, or operational requirements.

New Relic Lens addresses these challenges. Lens is a unified query platform within New Relic that lets you connect and query multiple data sources directly from New Relic. Write a query in Lens using ANSI SQL and perform cross-database joins to analyze and correlate data from various sources.

<img
  title="New Relic Lens Architecture"
  alt="A schematic diagram of New Relic Lens architecture."
  src={lensArch}
/>

## What you can do [#features]

Whether you have business data stored in Snowflake, finance or customer data stored in Google Sheets, you can query all of this data using Lens. You can use Lens to:

<CollapserGroup>

  <Collapser id="connect-sources" title="Connect to multiple data sources">
    You can connect to various data sources including:
    * **NRDB**: New Relic's telemetry database and entities
    * **Cloud data warehouses**: Snowflake
    * **Databases**: PostgreSQL, MySQL, OpenSearch, and Redshift
    * **Spreadsheets**: Google Sheets
    * **Data lakes**: Iceberg

    For details on connecting data sources, refer to [Lens connectors](/docs/new-relic-lens/lens-connectors). If you want to connect to additional databases, contact your account team to confirm compatibility with Lens.

  </Collapser>

  <Collapser id="query-sql" title="Query data using ANSI SQL">
    Lens uses ANSI SQL to query its data sources, so you don't need to learn database-specific query languages. Lens translates your ANSI SQL queries to work with each data source.

    <Callout variant="tip">
    When querying data sources, Lens doesn't restrict the number of rows you can retrieve. However, queries to NRDB through Lens maintain the same 5,000 row limit as NRQL.
    </Callout>

    For more information on querying data with Lens, refer to [Query data with Lens](#query-data).
  </Collapser>


  <Collapser id="cross-db-joins" title="Perform cross-database joins">
    You can run queries that join data from different data sources within a single SQL query. For example, you can join employee data from Google Sheets with user login data from NRDB to analyze access patterns.

      <Callout variant="tip">
      Lens pushes all computational work to the data source. The data source processes the query and returns only the results. Lens then combines results from multiple data sources to display the final output. Lens does not ingest raw data. It only combines the processed results.
    </Callout>
  </Collapser>

  <Collapser id="materialized-views" title="Create and manage materialized views">
    For larger, computationally expensive queries, you can store the results as materialized views. Query the materialized view instead of running the complex query each time. You can refresh the view to get the latest data. This approach avoids repeatedly fetching the same data from data sources in short intervals, reducing query costs and improving performance.

    For details on creating and managing materialized views, refer to [Materialized views](#materialized-views).
  </Collapser>

</CollapserGroup>

## Use cases [#use-cases]

Lens enables various data analysis scenarios:

* **Budget analysis**: Compare New Relic utilization data from NRDB with budget data stored in Snowflake to track spending against allocated budgets.
* **Workflow optimization**: Replace multiple manual export/import steps (from one database to another) with a single SQL query that joins all necessary data, reducing costs and improving efficiency.
* **Aggregate data across regions**: Track user traffic across various geographical regions by unioning data from different data sources.
* **Performance optimization with materialized views**: An executive dashboard combines data from 5+ databases and refreshes weekly. By storing the results from the multi-database `JOIN` query in a materialized view, you avoid running the computationally expensive query each time someone loads the dashboard. This reduces query costs and significantly improves page load speed.

## User roles and permissions [#permissions]

Access to Lens features depends on your user role. The following sections describe the permissions for different Lens operations.

### Connector permissions [#connector-permissions]

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>Role</th>
      <th>Permissions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Admin**</td>
      <td>
        * Create, edit, and delete connectors
        * Add or remove users and user groups to any role for a connector
        * Query all connectors
        * Refresh connector connections
      </td>
    </tr>
    <tr>
      <td>**Viewer**</td>
      <td>
        * Query connectors they have been granted access to
        * View connector details (credentials remain hidden)
        * Refresh connector connections
      </td>
    </tr>
  </tbody>
</table>

### IAM capabilities [#iam-capabilities]

Admin users or users with [custom roles](/docs/accounts/accounts-billing/new-relic-one-user-management/account-user-mgmt-tutorial/#roles) containing specific IAM capabilities can perform the following operations:

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>Operations</th>
      <th>Required capabilities</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Connectors - Full access**</td>
      <td>
        * `nr_lens.read.catalogs`
        * `nr_lens.create.catalogs`
        * `nr_lens.update.catalogs`
        * `nr_lens.delete.catalogs`
      </td>
    </tr>
    <tr>
      <td>**Connectors - Read only**</td>
      <td>`nr_lens.read.catalogs`</td>
    </tr>
    <tr>
      <td>**Query data sources**</td>
      <td>`nr_lens.query.connector`</td>
    </tr>
    <tr>
      <td>**Materialized views - Full access**</td>
      <td>
        * `nr_lens.read.materialized_views`
        * `nr_lens.create.materialized_views`
        * `nr_lens.update.materialized_views`
        * `nr_lens.refresh.materialized_views`
        * `nr_lens.delete.materialized_views`
      </td>
    </tr>
    <tr>
      <td>**Materialized views - Read only**</td>
      <td>`nr_lens.read.materialized_views`</td>
    </tr>
    <tr>
      <td>**Materialized views - Refresh only**</td>
      <td>`nr_lens.refresh.materialized_views`</td>
    </tr>
  </tbody>
</table>

### Data access control [#data-access-control]

Access to data in Lens depends on the data source type:

* **Data connectors**: Available at the organization level for users with appropriate permissions. Admins can grant access to specific users or user groups for each connector.
* **NRDB data**: Restricted to account-specific access based on your existing New Relic permissions. For example, if you only have access to Account A in New Relic, you can query NRDB data specific to Account A only.

## Query data with Lens [#query-data]

Lens operates exclusively within New Relic [Notebooks](/docs/query-your-data/explore-query-data/notebooks/introduction-notebooks/). Notebooks are structured, shareable documents that combine queries, visualizations, and descriptive markdown blocks to capture analytical workflows. To use Lens, you create SQL blocks in a notebook to query your data sources.

To query data:

<Steps>
  <Step>
    ### Access notebooks

    From the New Relic platform, go to **[one.newrelic.com](https://one.newrelic.com) > Query your data**.
  </Step>

  <Step>
    ### Enable notebooks

    Enable the toggle beside **Notebooks**. The **+ SQL** button appears.
  </Step>

  <Step>
    ### Add a SQL block

    Click **+ SQL**. A block appears that allows you to write your SQL query.
  </Step>

  <Step>
    ### Select an account

    From the account dropdown, select the account from which you want to query NRDB data. This account selector is only relevant when querying NRDB system connectors. You can only access data from accounts you have permissions for.

    <Callout variant="tip">
    Data connectors are available at the organization level for users with appropriate permissions and don't require account selection. The account dropdown only controls which NRDB data you can access when joining data from data sources with NRDB data.
    </Callout>
  </Step>

  <Step>
    ### Write your SQL query

    Write your SQL query using the format: `connection_name.schema.table`

    For example:
    * Query the count of Transactions per appName in NRDB via Lens:
      ```sql
      SELECT appName, count(*)
      FROM telemetry.Transaction
      GROUP BY appName
      ```

    * Query Google Sheets employee login data:
      ```sql
      SELECT *
      FROM gsheets.default.employees
      ```

    * Perform a cross-database join:
      ```sql
      WITH employees AS (
        SELECT * FROM gsheets.default.employees
      ),
      logins AS (
        SELECT * FROM telemetry.user_logins
      )
      SELECT *
      FROM logins
      JOIN employees ON logins.user_id = employees.employee_id
      ```
  </Step>

  <Step>
    ### Run the query

    To run your query and view the results, click **Run**.
  </Step>
</Steps>

## Materialized views [#materialized-views]

For larger, computationally expensive queries, you can store the results as materialized views. This approach avoids repeatedly fetching the same data from data sources, reducing query costs and improving performance.

### Create a materialized view [#create-materialized-view]

To create a materialized view:

1. From the New Relic platform, go to **[one.newrelic.com](https://one.newrelic.com) > Administration > Materialized views**.
2. Click **Create a materialized view**.
3. Enter a unique name for the materialized view and write your SQL query that will generate the result set to store.
4. Click **Create**.

<Callout variant="tip">
To get fresh data in your materialized view, manually refresh it from the <Icon name="fe-more-horizontal"/> menu.
</Callout>

### Query a materialized view [#use-materialized-view]

You can query a materialized view like any other table:

1. From the New Relic platform, go to **[one.newrelic.com](https://one.newrelic.com) > Query your data**.
2. In a SQL block, reference your materialized view with the connector name as `mv.` followed by the view name.

   ```sql
   SELECT * FROM mv.your_materialized_view_name
   ```
3. You can apply additional filters, joins, or aggregations on the materialized view:

   ```sql
   SELECT store_id, transaction_count
   FROM mv.top_stores_mv
   WHERE transaction_count > 1000
   ORDER BY transaction_count DESC
   ```
4. To view the results, run the query.

The materialized view acts as a table containing the precomputed results, allowing you to perform further analysis without running the original complex query again.

## Related topics [#related-topics]

<DocTiles>
  <DocTile title="Lens connectors" path="/docs/new-relic-lens/lens-connectors">
    Learn how to set up and manage connections to your data sources.
  </DocTile>
  <DocTile title="Introduction to Notebooks" path="/docs/query-your-data/explore-query-data/notebooks/introduction-notebooks">
    Learn about Notebooks for creating shareable analytical workflows.
  </DocTile>
  <DocTile title="User management" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">
    Understand user roles and permissions in New Relic.
  </DocTile>
</DocTiles>
