---
title: Query Data with Lens
tags:
  - New Relic Lens
  - SQL queries
  - Cross-database joins
  - Query syntax
metaDescription: "Learn how to write SQL queries in New Relic Lens, including syntax, cross-database joins, and query examples."
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Lens uses ANSI SQL to query data sources, so you don't need to learn database-specific query languages. This page covers SQL syntax, query patterns, and examples for querying data in Lens.

## SQL syntax [#syntax]

### Table reference format [#table-format]

When writing queries in Lens, reference tables using the format:

```
connection_name.schema.table
```

For example:
* `telemetry.Transaction` - Query the Transaction table from the telemetry (NRDB) connector
* `snowflake.sales.orders` - Query the orders table from a Snowflake connector named "snowflake" in the "sales" schema
* `gsheets.default.employees` - Query a Google Sheets connector named "gsheets"

### Supported SQL statements [#supported-sql]

Lens supports standard ANSI SQL statements including:

* `SELECT` - Query data from one or more tables
* `JOIN` - Combine data from multiple tables (including cross-database joins)
* `WHERE` - Filter results
* `GROUP BY` - Aggregate data
* `ORDER BY` - Sort results
* `LIMIT` - Restrict the number of returned rows
* `WITH` (CTEs) - Define common table expressions for complex queries

## Query examples [#examples]

### Basic queries [#basic-queries]

<CollapserGroup>
  <Collapser id="nrdb-telemetry" title="Query NRDB telemetry data">
    Query transaction data with aggregations:

    ```sql
    SELECT
      appName,
      count(*) as transaction_count,
      average(duration) as avg_duration
    FROM telemetry.Transaction
    GROUP BY appName
    ORDER BY transaction_count DESC
    LIMIT 10
    ```
  </Collapser>

  <Collapser id="external-source" title="Query an external data source">
    Query data from a Snowflake connector:

    ```sql
    SELECT
      customer_id,
      customer_name,
      total_spend
    FROM snowflake.customers.customer_data
    WHERE total_spend > 1000
    ORDER BY total_spend DESC
    ```
  </Collapser>

  <Collapser id="google-sheets" title="Query Google Sheets data">
    Query employee data from a Google Sheets connector:

    ```sql
    SELECT *
    FROM gsheets.default.employees
    WHERE department = 'Engineering'
    ```
  </Collapser>
</CollapserGroup>

### Cross-database joins [#cross-db-joins]

One of the most powerful features of Lens is the ability to join data from different data sources in a single query.

<CollapserGroup>
  <Collapser id="join-nrdb-external" title="Join NRDB with external data">
    Join user login events from NRDB with employee data from Google Sheets:

    ```sql
    WITH employees AS (
      SELECT * FROM gsheets.default.employees
    ),
    logins AS (
      SELECT user_id, count(*) as login_count
      FROM telemetry.UserLogin
      GROUP BY user_id
    )
    SELECT
      e.employee_name,
      e.department,
      l.login_count
    FROM logins l
    JOIN employees e ON l.user_id = e.employee_id
    ORDER BY l.login_count DESC
    ```
  </Collapser>

  <Collapser id="join-multiple-sources" title="Join multiple external sources">
    Combine data from Snowflake and PostgreSQL:

    ```sql
    SELECT
      s.store_name,
      s.region,
      p.inventory_count,
      p.last_updated
    FROM snowflake.retail.stores s
    JOIN postgres.inventory.stock p ON s.store_id = p.store_id
    WHERE p.inventory_count < 100
    ```
  </Collapser>

  <Collapser id="three-way-join" title="Three-way join across sources">
    Combine NRDB telemetry with business data from multiple sources:

    ```sql
    WITH app_errors AS (
      SELECT
        appName,
        count(*) as error_count
      FROM telemetry.TransactionError
      GROUP BY appName
    ),
    app_owners AS (
      SELECT * FROM gsheets.default.app_ownership
    ),
    cost_data AS (
      SELECT * FROM snowflake.finance.app_costs
    )
    SELECT
      e.appName,
      o.owner_name,
      o.team,
      e.error_count,
      c.monthly_cost
    FROM app_errors e
    JOIN app_owners o ON e.appName = o.app_name
    JOIN cost_data c ON e.appName = c.app_name
    ORDER BY e.error_count DESC
    ```
  </Collapser>
</CollapserGroup>

### Query materialized views [#query-mv]

Reference materialized views using the `mv.` prefix:

```sql
SELECT *
FROM mv.weekly_performance_summary
WHERE week_number = 42
```

You can join materialized views with other data sources:

```sql
SELECT
  mv.store_id,
  mv.total_sales,
  s.store_name,
  s.region
FROM mv.store_sales_mv mv
JOIN snowflake.retail.stores s ON mv.store_id = s.store_id
WHERE mv.total_sales > 10000
```

## Query limits and considerations [#limits]

<Callout variant="tip">
When querying data sources, Lens doesn't restrict the number of rows you can retrieve from external sources. However, queries to NRDB through Lens maintain the same 5,000 row limit as NRQL.
</Callout>

### How Lens processes queries [#processing]

Lens pushes computational work to the data sources:

1. Each data source processes its portion of the query
2. Data sources return only the results (not raw data)
3. Lens combines results from multiple data sources
4. The final output is displayed

This approach means Lens doesn't ingest raw data from your external sources. It only combines the processed results, which helps minimize data transfer and maintain security.

### Performance tips [#performance-tips]

* **Use filters early**: Apply `WHERE` clauses to reduce the amount of data processed
* **Limit results**: Use `LIMIT` to restrict returned rows when exploring data
* **Consider materialized views**: For frequently-run complex queries, create a materialized view
* **Optimize joins**: When joining large tables, filter data before the join when possible

## Related topics [#related-topics]

<DocTiles>
  <DocTile title="Get started" path="/docs/new-relic-lens/get-started">
    Learn how to access Lens and write your first query.
  </DocTile>
  <DocTile title="Materialized views" path="/docs/new-relic-lens/materialized-views">
    Store query results for better performance.
  </DocTile>
  <DocTile title="Connectors overview" path="/docs/new-relic-lens/connectors/overview">
    Learn about system and data connectors.
  </DocTile>
</DocTiles>
