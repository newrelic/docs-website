---
title: Query data with Lens
tags:
  - New Relic Lens
  - SQL queries
  - Cross-database joins
  - Query syntax
  - Notebooks
  - Query Builder
  - Dashboards
metaDescription: "Learn how to query data with New Relic Lens in Query Builder, Notebooks, and custom dashboards."
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy). To enable <DNT>Lens</DNT>, check with your <dnt>Organization Manager</dnt> to opt in from the <DNT>**[Previews & Trials](https://one.newrelic.com/admin-portal/promotion-management/home)**</DNT> page.
</Callout>

You can write <DNT>Lens</DNT> queries in **Query Builder**, <dnt>**Notebooks**</dnt>, and **custom dashboards**. This page explains how to query data in each platform.

<Callout variant="tip">
When querying data sources, <DNT>Lens</DNT> doesn't restrict the number of rows you can retrieve from external sources. However, queries to NRDB through <DNT>Lens</DNT> maintain the same 5,000 row limit as NRQL.
</Callout>

## Prerequisites [#prerequisites]

Before you start:

* Verify you have the necessary [permissions](/docs/new-relic-lens/overview#permissions) to query data sources.
* If you need to query external data sources, ensure the [<dnt>connectors</dnt>](/docs/new-relic-lens/set-up-connectors) are set up.

## Query in the query builder [#query-builder]

1. Go to <dnt>**[one.newrelic.com](https://one.newrelic.com)**</dnt>.
2. From the drawer at the bottom of the page, open the <dnt>**Query your data**</dnt> console.
3. In the query editor, select <DNT>**Lens data (SQL)**</DNT> as the query language.
4. If you want to query NRDB data, select the account from the account selector. Other <dnt>data connectors</dnt> are available at the organization level and don't require account selection.
5. Write your SQL query using the [table reference format](#table-format): `connection_name.schema.table`
6. Click <dnt>**Run**</dnt>. The chart renders based on your query results.

## Save query in <dnt>Notebooks</dnt> [#notebooks]

[Notebooks](/docs/query-your-data/explore-query-data/notebooks/introduction-notebooks/) are shareable documents that combine queries, visualizations, and markdown documentation.

1. Go to <dnt>**[one.newrelic.com](https://one.newrelic.com)**</dnt>.
2. From the drawer at the bottom of the page, open the <dnt>**Query your data**</dnt> console.
3. Enable the toggle beside <dnt>**Notebooks**</dnt>. At the bottom of the page, the <dnt>**+ SQL**</dnt> button appears.
4. Click <dnt>**+ SQL**</dnt> to add a SQL block.
5. If you want to query NRDB data, select the account from the account selector. Other <dnt>data connectors</dnt> are available at the organization level and don't require account selection.
6. Write your SQL query using the [table reference format](#table-format): `connection_name.schema.table`
7. Click <dnt>**Run**</dnt>. The chart renders based on your query results.
8. Click <dnt>**Save**</dnt>.
9. For further guidance, refer to the [Notebooks documentation](/docs/query-your-data/explore-query-data/notebooks/introduction-notebooks/).

## Query in custom dashboards [#dashboards]

You can add SQL-based charts to your [custom dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards):

1. Go to <dnt>**[one.newrelic.com](https://one.newrelic.com) > Dashboards**</dnt>.
2. [Create a new dashboard](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards#dashboards-create-new) or open an existing one.
3. Click <dnt>**+ Add widget**</dnt> and select a chart type.
4. In the query editor, select <DNT>**Lens data (SQL)**</DNT> as the query language.
5. If you want to query NRDB data, select the account from the account selector. Other <dnt>data connectors</dnt> are available at the organization level and don't require account selection.
6. Write your SQL query using the [table reference format](#table-format): `connection_name.schema.table`
7. Click <dnt>**Run**</dnt>. The chart renders based on your query results.
8. Click <dnt>**Add to dashboard**</dnt>. For further guidance, refer to the [custom dashboards documentation](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/).
<Callout variant="important">
SQL-based charts are only supported in private dashboards. Public dashboards don't support SQL queries.
</Callout>

## SQL syntax [#syntax]

<DNT>Lens</DNT> uses ANSI SQL to query data sources, so you don't need to learn database-specific query languages.

### Table reference format [#table-format]

When writing queries in <DNT>Lens</DNT>, reference tables using the format:

```
connection_name.schema.table
```

For example:
* `telemetry.Transaction` - Query the Transaction table from the telemetry (NRDB) <dnt>connector</dnt>
* `snowflake.sales.orders` - Query the orders table from a Snowflake <dnt>connector</dnt> named "snowflake" in the "sales" schema
* `gsheets.default.employees` - Query a Google Sheets <dnt>connector</dnt> named "gsheets"

### Supported SQL statements [#supported-sql]

<DNT>Lens</DNT> supports standard ANSI SQL statements including:

* `SELECT` - Query data from one or more tables
* `JOIN` - Combine data from multiple tables (including cross-database joins)
* `WHERE` - Filter results
* `GROUP BY` - Aggregate data
* `ORDER BY` - Sort results
* `LIMIT` - Restrict the number of returned rows
* `WITH` (CTEs) - Define common table expressions for complex queries

### Performance tips [#performance-tips]

* **Use filters early**: Apply `WHERE` clauses to reduce the amount of data processed.
* **Limit results**: Use `LIMIT` to restrict returned rows when exploring data.
* **Consider <dnt>materialized views</dnt>**: For frequently-run complex queries, create a <dnt>materialized view</dnt>.
* **Optimize joins**: When joining large tables, filter data before the join when possible.

## Query syntax differences from NRQL and examples [#syntax-differences]

<DNT>Lens</DNT> uses ANSI SQL instead of NRQL. The following examples show key differences and common query patterns.

<CollapserGroup>

  <Collapser id="groupby" title="Use `GROUP BY` instead of `FACET`">
    When grouping results, use `GROUP BY` and include the grouped column in your `SELECT` statement.

    **NRQL:**

    ```sql
    FROM PageViewTiming
    SELECT count(*)
    FACET enduser.id
    ```

    **SQL:**

    ```sql
    SELECT "enduser.id", count(*)
    FROM telemetry.PageViewTiming
    GROUP BY "enduser.id"
    ```
  </Collapser>

  <Collapser id="where-timestamp" title="Use `WHERE` with `timestamp` instead of `SINCE`">
    Filter time ranges using `WHERE` with the `timestamp` column and date intervals.

    **NRQL:**

    ```sql
    FROM PageViewTiming
    SELECT count(*)
    SINCE 1 day ago
    ```

    **SQL:**

    ```sql
    SELECT count(*)
    FROM telemetry.PageViewTiming
    WHERE timestamp > current_date - INTERVAL '1' DAY
    ```
  </Collapser>

  <Collapser id="timeseries" title="Time series with epoch format">
    To create time series visualizations, structure your query so the first column contains dates in epoch format. Use `to_unixtime()` to convert dates.

    ```sql
    WITH orders AS (
      SELECT
        to_unixtime(date(date_parse(order_date, '%Y-%m-%d'))) as dt,
        count(*) as orders
      FROM gsheets.default.orders
      GROUP BY 1
    )
    SELECT *
    FROM orders
    WHERE dt >= to_unixtime(date('2025-10-19'))
      AND dt <= to_unixtime(date('2025-10-21'))
    ORDER BY dt ASC
    ```
  </Collapser>

  <Collapser id="cross-db-join" title="Cross-database `JOIN`">
    Use standard SQL `JOIN` syntax to combine data from multiple sources in a single query.

    ```sql
    WITH sf AS (
      SELECT DISTINCT user_id, assigned_success_manager
      FROM demogorgon.default.relibank_opportunity_matrix
    )
    SELECT
      sf.assigned_success_manager,
      MAX(nrdb.largestContentfulPaint)
    FROM telemetry.PageViewTiming nrdb
    LEFT JOIN sf ON nrdb."enduser.id" = sf.user_id
    WHERE timingName = 'largestContentfulPaint'
      AND nrdb.timestamp > current_date - INTERVAL '1' DAY
    GROUP BY sf.assigned_success_manager
    ```
  </Collapser>

  <Collapser id="query-mv" title="Query materialized views">
    Reference <dnt>materialized views</dnt> using the `mv.` prefix:

    ```sql
    SELECT *
    FROM mv.weekly_performance_summary
    WHERE week_number = 42
    ```

    You can join <dnt>materialized views</dnt> with other data sources:

    ```sql
    SELECT
      mv.store_id,
      mv.total_sales,
      s.store_name,
      s.region
    FROM mv.store_sales_mv mv
    JOIN snowflake.retail.stores s ON mv.store_id = s.store_id
    WHERE mv.total_sales > 10000
    ```
  </Collapser>

</CollapserGroup>



## Related topics [#related-topics]

<DocTiles>
  <DocTile title="Materialized views" path="/docs/new-relic-lens/materialized-views">
    Store query results for better performance.
  </DocTile>
  <DocTile title="Lens overview" path="/docs/new-relic-lens/overview">
    Learn about <DNT>Lens</DNT> features, use cases, and permissions.
  </DocTile>
  <DocTile title="Set up connectors" path="/docs/new-relic-lens/set-up-connectors">
    Connect to external data sources.
  </DocTile>
</DocTiles>
