---
title: '.NET: Configure with Serilog'
tags:
  - Logs
  - Enable log management in New Relic
  - Logs in context for .NET
redirects:
  - /docs/logs/new-relic-logs/enable-logs-context/enable-logs-context-net-serilog
  - /docs/logs/enable-logs/logs-context-net/net-configure-serilog
  - /docs/logs/enable-log-monitoring-new-relic/logs-context-net/net-configure-serilog
---

Use our [Serilog](https://serilog.net/ "Link opens in a new window.") extension to link to your log data with related data across the rest of the New Relic platform. Read on to learn how to configure logs in context and enrich your log data.

## Compatibility and requirements [#compatibility-dotnet-serilog]

To use New Relic logs in context with Serilog, ensure your configuration meets the following requirements:

* Microsoft [.NET Framework 4.5+](https://dotnet.microsoft.com/download/dotnet-framework) or [.NET Core 2.0+](https://dotnet.microsoft.com/download/dotnet-core)
* [New Relic .NET agent 8.21+](https://docs.newrelic.com/docs/release-notes/agent-release-notes/net-release-notes)
* [New Relic .NET agent API 8.21](https://docs.newrelic.com/docs/agents/net-agent/net-agent-api)[+](https://docs.newrelic.com/docs/agents/net-agent/net-agent-api)
* [Serilog 2.5+](https://serilog.net/)
* [Serilog File Sinks v4.0+](https://www.nuget.org/packages/Serilog.Sinks.File/)

## Overview

Serilog is a structured logging framework that records log messages from your application and creates a `LogEvent` to store the message data. Using [Enrichers](https://github.com/serilog/serilog/wiki/Enrichment), you can add additional information to the log events, while [Sinks](https://github.com/serilog/serilog/wiki/Provided-Sinks) and [Formatters](https://github.com/serilog/serilog/wiki/Formatting-Output) allow you to format and output those log events for downstream consumption and viewing.

This diagram illustrates the flow of log messages through Serilog.

![Logs-in-context Serilog](./images/LogsInContext---Serilog-%282%29_0.jpg "LogsInContext-Serilog.jpg")

This diagram illustrates the flow of log messages through Serilog, highlighting specific components of the New Relic Serilog extension.

The above diagram highlights several components of the Serilog extension:

* **New Relic Enricher**: The `NewRelicEnricher` adds contextual information from the .NET agent (using the API) to the log events generated by the application. This contextual information, known as linking metadata, is used by New Relic to link log messages to the transactions and spans from which they were created.
* **New Relic Formatter**: The `NewRelicFormatter`translates enriched log events into the JSON format expected by New Relic. A sink instructs Serilog to output the JSON to a file in the location that the Log Forwarder expects.
* **New Relic Log Forwarder**: The `NewRelicFormatter`translates enriched log events into the JSON format expected by New Relic. A sink instructs Serilog to output the JSON to a file in the location that the log forwarder expects. The example below uses the [New Relic Fluentd log forwarded](https://github.com/newrelic/newrelic-fluentd-output), however there are many other log forwarders that can be used. For more information, see [Introduction to log management](/docs/introduction-new-relic-logs).

For more information about Serilog log events, see the Serilog [Getting started](https://github.com/serilog/serilog/wiki/Getting-Started) documentation.

## Configure logs in context with log management [#configure-logs]

To configure New Relic logs in context with Serilog:

1. [Enable log management](/docs/introduction-new-relic-logs) with a compatible [log forwarding plugin](/docs/logs/enable-logs/enable-logs/enable-new-relic-logs#enable-logs).
2. [Install or update the .NET agent](#dotnet-extension).
3. [Configure the Serilog extension](#enable-logs-serilog).
4. [Check for logging data.](#test-extension-dotnet)

## Enable log management [#enable-logs]

Confirm that you have [log management](/docs/introduction-new-relic-logs) enabled, with a compatible [log forwarding plugin](/docs/logs/enable-logs/enable-logs/enable-new-relic-logs#enable-logs) installed to send your application logs to New Relic.

## Install or update the .NET agent [#dotnet-extension]

[Install](/docs/agents/net-agent/installation/introduction-net-agent-install) or [update](/docs/agents/net-agent/installation/update-net-agent) to the most recent .NET agent version, and [enable Distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing).

## Configure the Serilog extension [#enable-logs-serilog]

To configure logs in context with the Serilog extension, complete the following steps:

1. Using the Visual Studio [NuGet Package Manager](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), locate and install the [`NewRelic.LogEnrichers.Serilog`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Serilog) package.
2. In your application code, update your logging configuration to add the `NewRelicEnricher` and `NewRelicFormatter`.

   The following code example enriches log events with New Relic linking metadata. In addition to the existing log files, it outputs new log files in a specific JSON format at `C:\logs\SerilogExample.log.json` for consumption by the Log Forwarder:

   ```
   var loggerConfig = new LoggerConfiguration()
           
    loggerConfig
       .Enrich.WithThreadName()
       .Enrich.WithThreadId()    
       .Enrich.WithNewRelicLogsInContext()
       .WriteTo.File( path: @"C:\logs\ExistingLoggingOutput.txt")
       .WriteTo.File(
           formatter: new NewRelicFormatter(), 
           path: @"C:\logs\SerilogExample.log.json");

    var log = loggerConfig.CreateLogger();
   ```

   <Callout variant="caution">
     The above configuration results in new JSON files that are written to disk. Some of these [configuration options](https://github.com/serilog/serilog-sinks-file) may be useful in managing the amount of disk space used and/or the performance of the sink.

     * `restrictedToMinimumLevel`
     * `buffered`
     * `rollingInterval`
     * `rollOnFileSizeLimit`
     * `retainedFileCountLimit`
   </Callout>

   <Callout variant="important">
     Though not required, using the [Serilog Asynchronous Sink Wrapper](https://www.nuget.org/packages/Serilog.Sinks.Async) may help improve the performance by performing formatting and output of log files on a different thread.
   </Callout>
3. Once you have configured the Serilog extension and updated your logging file, you can configure your extension to send data to New Relic Logs. See below for an example of this configuration using the Fluentd plugin for New Relic Logs:

   ```
   <!--NewRelicLoggingExample.conf-->
   <source> 
       @type tail 
       path C:\logs\SerilogExample.log.json
       pos_file C:\logs\SerilogExample.log.json.pos 
       tag logfile.*
    <parse> 
       @type json 
   </parse>
   </source>
   <match **> 
       @type newrelic 
       license_key <YOUR NEW_RELIC_LICENSE_KEY>
       base_uri https://log-api.newrelic.com/log/v1
   </match>
   ```

## File-based configuration

Configuration of the New Relic Logs Serilog extension may also be accomplished with file-based configuration providers.

<CollapserGroup>
  <Collapser
    id=""
    title={<><InlineCode>appsettings.json</InlineCode> based configuration</>}
  >
    The example code below creates a logger based on settings contained in an `appSettings.json` file.

    <Callout variant="important">
      The following additional NuGet Packages are required:

      * [Microsoft.Extensions.Configuration](https://www.nuget.org/packages/Microsoft.Extensions.Configuration/)
      * [Serilog.Settings.Configuration](https://www.nuget.org/packages/Serilog.Settings.Configuration)
    </Callout>

    **Instantiating Logger using `appsettings.json`**

    ```
    var builder = new ConfigurationBuilder()
            .AddJsonFile("appsettings.json");
        
    var configuration = builder.Build();

    var logger = new LoggerConfiguration()
            .ReadFrom.Configuration(configuration)
            .CreateLogger();
    ```

    **Sample `appsettings.json` file**

    ```
    {
      "Serilog": {
        "Using": [ 
              "Serilog.Sinks.Console",
              "Serilog.Sinks.File",
              "NewRelic.LogEnrichers.Serilog" 
        ],
        "MinimumLevel": "Debug",
        "Enrich": [ "WithNewRelicLogsInContext" ],
        "WriteTo": [
          {
            "Name": "File",
            "Args": {
              "path": "C:\\Logs\\SerilogExample.log.json",
              "formatter": "NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog"
              }
          }
        ],
    
        "Properties": {
          "Application": "NewRelic Logging Serilog Example"
        }
      }
    }
    ```
  </Collapser>

  <Collapser
    id=""
    title={<><InlineCode>.Config</InlineCode> based configuration</>}
  >
    The example code below creates a logger based on settings contained in an web.config file.

    <Callout variant="important">
      The [Serilog.Settings.AppSettings](https://www.nuget.org/packages/Serilog.Settings.AppSettings) NuGet Package is required.
    </Callout>

    **Instantiating Logger using `.config` file**

    ```
    var logger = new LoggerConfiguration()
        .ReadFrom.AppSettings()
        .CreateLogger();
    ```

    **Sample `web.config` file**

    ```
    <?xml version="1.0" encoding="utf-8"?>
    <configuration>
      <appSettings>
        <add key="serilog:using:NewRelic" value="NewRelic.LogEnrichers.Serilog" />
        <add key="serilog:using:File" value="Serilog.Sinks.File" />
        <!--Add other enrichers here-->
        <add key="serilog:enrich:WithNewRelicLogsInContext" />
        <add key="serilog:write-to:File.path" value="C:\logs\SerilogExample.log.json" />
        <add key="serilog:write-to:File.formatter" value="NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog" />
      </appSettings>
    ```
  </Collapser>
</CollapserGroup>

## What's next? [#what-next]

Now that you've set up APM logs in context, here are some potential next steps:

* Explore your data using the [Logs UI](/docs/explore-your-data-new-relic-logs-ui).
* Troubleshoot errors with [distributed tracing](/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing), stack traces, application logs, and more.
* [Query your data](/docs/using-new-relic/data/understand-data/query-new-relic-data) and [create custom dashboards](/docs/dashboards/new-relic-one-dashboards/get-started/introduction-new-relic-one-dashboards) or [alerts](/docs/alerts/new-relic-alerts/configuring-alert-policies/create-edit-or-find-alert-policy).
