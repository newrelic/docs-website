---
title: '.NET: Configure with log4net'
tags:
  - Logs
  - Enable log management in New Relic
  - Logs in context for .NET
redirects:
  - /docs/logs/enable-new-relic-logs/logs-context-net/net-configure-log4net
  - /docs/logs/enable-log-monitoring-new-relic/logs-context-net/net-configure-log4net
---

Use the [Apache log4net](https://logging.apache.org/log4net/) extension to link to your log data with related data across the rest of the New Relic platform. Read on to learn how to configure logs in context and enrich your log data.

## Compatibility and requirements [#compatibility-dotnet-serilog]

To use New Relic logs in context with [log4net](https://logging.apache.org/log4net/), ensure your configuration meets the following requirements:

* Microsoft [.NET Framework 4.5+](https://dotnet.microsoft.com/download/dotnet-framework) or [.NET Core 2.0+](https://dotnet.microsoft.com/download/dotnet-core)
* [New Relic .NET agent 8.21+](https://docs.newrelic.com/docs/release-notes/agent-release-notes/net-release-notes)
* [New Relic .NET agent API 8.21](https://docs.newrelic.com/docs/agents/net-agent/net-agent-api)[+](https://docs.newrelic.com/docs/agents/net-agent/net-agent-api)
* [Log4net 2.0.8+](https://logging.apache.org/log4net/)

## Overview

Log4net uses `appender` and `layout` to store and format log messages. [`NewRelicAppender`](https://github.com/newrelic/newrelic-logenricher-dotnet/tree/master/src/Log4Net) enriches log messages with contextual information from the New Relic .NET agent if it is attached to your application. The appender passes enriched log messages to downstream appenders for specific use case log message handle.

Log4net also provides [`NewRelicLayout`](https://github.com/newrelic/newrelic-logenricher-dotnet/tree/master/src/Log4Net) to output log messages in the way required by the New Relic logging endpoint. A target can then be configured to write logging data to an output folder, which can be monitored by a log forwarder to incrementally send log information to New Relic.

This diagram illustrates the flow of log messages through log4net:

![Logs In Context - Log4Net](./images/LogsInContext---Log4Net.jpg "log4net-extension-diagram")

This diagram illustrates the flow of log messages through log4net, highlighting specific components of the New Relic log4net extension.

The above diagram highlights the main components of the log4net logs in context solution:

* **New Relic Appender**: The `NewRelicAppender` adds contextual information from the .NET agent (using the API) to the log events generated by the application. This contextual information, known as linking metadata, is used by New Relic to link log messages to the transactions and spans from which they were created. This appender will pass the enriched Log Events to downstream appenders for further processing. Since the `NewRelicAppender` is `ForwardingAppender` type, it needs to be the first appender in the chain and requires another appender that can write to an actual output destination as its child in order to work.
* **New Relic Layout**: The `NewRelicLayout` formats the enriched log events into the JSON format expected by New Relic. The appender, which this layout is assigned to, instructs log4net to output the JSON to a file in the location that the log forwarder expects.
* **New Relic Log Forwarder**: The [log forwarder](/docs/logs/enable-logs/enable-logs/enable-new-relic-logs#enable-logs) monitors an output folder and incrementally sends New Relic formatted Log information to the New Relic Logging Endpoint. There are many log-forwarders available. For our examples, we will use [Fluentd](https://www.fluentd.org/).

For more information about logging with log4net, see the Apache log4net [Getting started](https://logging.apache.org/log4net/) documentation.

## Configure logs in context with New Relic Logs [#configure-logs]

To configure New Relic logs in context with

1. [Enable New Relic Logs](/docs/introduction-new-relic-logs) with a compatible [log forwarding plugin](/docs/logs/enable-logs/enable-logs/enable-new-relic-logs#enable-logs).
2. [Install or update the .NET agent](#dotnet-extension).
3. [Configure the log4net extension](#enable-logs-nlog).
4. [Check for logging data.](#test-extension-dotnet)

## Enable New Relic Logs [#enable-logs]

Confirm that you have [New Relic Logs](/docs/introduction-new-relic-logs) enabled, with a compatible [log forwarding plugin](/docs/logs/enable-logs/enable-logs/enable-new-relic-logs#enable-logs) installed to send your application logs to New Relic.

## Install or update the .NET agent [#dotnet-extension]

[Install](/docs/agents/net-agent/installation/introduction-net-agent-install) or [update](/docs/agents/net-agent/installation/update-net-agent) to the most recent .NET agent version, and [enable Distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing).

## Configure the log4net extension [#enable-logs-nlog]

To configure logs in context with the log4net extension, complete the following steps:

1. Using the Visual Studio [NuGet Package Manager](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), locate and install the [`NewRelic.LogEnrichers.Log4Net`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Log4Net/) package.
2. In your log4net configuration file, update your logging configuration to use the NewRelicAppender as the first level appender, and reference your existing appenders as its children. You also need to replace the layout of the appender that writes log messages to an output destination with the `NewRelicLayout` .

   The following log4net configuration example enriches log events with New Relic linking metadata. In addition to the existing log files, it outputs new log files in a specific JSON format at `C:\logs\log4netExample.log.json` for consumption by the log forwarder:

   ```
   <log4net>
     <root>
       <level value="ALL" />
       <appender-ref ref="NewRelicAppender" />
     </root>

     <appender name="NewRelicAppender" type="NewRelic.LogEnrichers.Log4Net.NewRelicAppender, NewRelic.LogEnrichers.Log4Net" >
       <threshold value="ALL"/>
       <appender-ref ref="FileAppender" />
     </appender>

     <appender name="FileAppender" type="log4net.Appender.FileAppender">
       <file value="<code>C:\logs\log4netExample.log.json</code>" />
       <param name="AppendToFile" value="true" />
       <layout type="NewRelic.LogEnrichers.Log4Net.NewRelicLayout, NewRelic.LogEnrichers.Log4Net">
       </layout>
     </appender>
   </log4net>
   ```

   Once you have configured the log4net extension and updated your logging file, you can configure your extension to send data to New Relic Logs.

   See below for an example of this configuration using the Fluentd plugin for New Relic Logs:

   ```
   <!--NewRelicLoggingExample.conf-->
   <source> 
       @type tail 
       path C:\logs\log4netExample.log.json
       pos_file C:\logs\log4netExample.log.json.pos 
       tag logfile.*
    <parse> 
       @type json 
   </parse>
   </source>
   <match **> 
       @type newrelic 
       license_key <YOUR NEW_RELIC_LICENSE_KEY>
       base_uri https://log-api.newrelic.com/log/v1
   </match>
   ```

## What's next? [#what-next]

Now that you've set up APM logs in context, here are some potential next steps:

* Explore your data using the [Logs UI](/docs/explore-your-data-new-relic-logs-ui).
* Troubleshoot errors with [distributed tracing](/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing), stack traces, application logs, and more.
* [Query your data](/docs/using-new-relic/data/understand-data/query-new-relic-data) and [create custom dashboards](/docs/dashboards/new-relic-one-dashboards/get-started/introduction-new-relic-one-dashboards) or [alerts](/docs/alerts/new-relic-alerts/configuring-alert-policies/create-edit-or-find-alert-policy).
