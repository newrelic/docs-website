---
title: 'PHP agent logs in context'
tags:
  - Logs
  - Enable log management in New Relic
  - Logs in context for PHP
metaDescription: For apps monitored by the PHP agent, learn how to link log data with related data across the rest of the New Relic platform.
redirects:
  - /docs/logs/new-relic-logs/enable-logs-context/enable-logs-context-php
  - /docs/logs/enable-logs/logs-context-php/configure-logs-context-php
  - /docs/logs/enable-log-monitoring-new-relic/logs-context-php/configure-logs-context-php
  - /docs/logs/enable-log-management-new-relic/logs-context-php
  - /docs/logs/enable-log-management-new-relic/logs-context-php/configure-logs-context-php
  - /docs/logs/enable-log-management-new-relic/configure-logs-context/configure-logs-context-php 
---

With our PHP <InlinePopover type="apm" /> agent, you can get **logs in context**, which lets you see your app logs in the context of your other New Relic data. For general information on this feature, see [APM logs in context](/docs/apm/new-relic-apm/getting-started/get-started-logs-context).

<Callout variant="tip">
Got lots of PHP logs? Check out our [tutorial on how to optimize and manage them](/docs/tutorial-large-logs/get-started-managing-large-logs/). 
</Callout>

## Automatic logs in context options [#automatic-logs-in-context]

If you're using a supported framework, you can configure the APM agent to send your app's logs and linking metadata automatically to New Relic. Supported frameworks for automatic logs in context include:

* Monolog (version 2 or 3)

This is the simplest approach, and it's a great choice for developers who may not have the access or interest in setting up a log forwarder, or for accounts that want to see the power of logs and other linking metadata in context of their apps, without a lot of overhead.

Using this option, the agent adds `span.id`, `trace.id`, `hostname`, `entity.guid`, and `entity.name`. [Learn about log forwarding limitations](/docs/logs/logs-context/get-started-logs-context#forwarding-details).


<Callout variant="important">
  As of agent release 10.3.0 the logging metrics and agent log forwarding features are enabled by default. 
</Callout>

All you need to do is install an agent version with log forwarding capabilities ([PHP agent 10.1.0 or higher](/docs/release-notes/agent-release-notes/php-release-notes/)). If forwarding is disabled, you can use this configuration: 

Configuration file (`newrelic.ini`):

```
newrelic.application_logging.enabled = true
newrelic.application_logging.metrics.enabled = true
newrelic.application_logging.forwarding.enabled = true
```

The PHP agent configuration docs explain in detail how to configure your agent, but here we'll review and link to some of the most important aspects of the PHP logs configuration. 

There is a single option to control if the core logging feature is active: 

* [`newrelic.application_logging.enabled`](/docs/apm/agents/php-agent/configuration/php-agent-configuration/#cfg-application_logging_forwarding-enabled)

If you're using a supported logging framework the agent can send metrics which measure the number of severity of log messages your application is generating. You can enable this features using the  [`newrelic.config.application_logging.metrics.enabled`](/docs/apm/agents/php-agent/configuration/php-agent-configuration/#cfg-application_logging_metrics-enabled) config. 


If you're using a supported logging framework and want to use the agent to send your application logs to New Relic, you can control that through settings `newrelic.config.application_logging.forwarding` prefixed INI settings. Options available are:

* [`enabled`](/docs/apm/agents/php-agent/configuration/php-agent-configuration/#cfg-application_logging_forwarding-enabled)
* [`max_samples_stored`](/docs/apm/agents/php-agent/configuration/php-agent-configuration/#cfg-application_logging_forwarding-max_samples_stored)
* [`log_level`](/docs/apm/agents/php-agent/configuration/php-agent-configuration/#cfg-application_logging_forwarding-log-level)

<Callout variant="important">
  If you have an existing log forwarding solution and are updating your agent to use automatic logs in context, be sure to **disable your manual log forwarder**. Otherwise, your app will be sending double the log data. Depending on your account, this could result in double billing. For more information, learn how to [disable your specific log forwarder](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
</Callout>

<InstallFeedback />

## Secure your data [#obfuscation]

Your logs may include sensitive information protected by HIPAA or other compliance protocols. By default we obfuscate number patterns that appear to be for items such as credit cards or Social Security numbers, but you may need to hash or mask additional information.

For more information, see our documentation about [obfuscation expressions and rules](/docs/logs/ui-data/obfuscation-ui/). You can hash or mask your log data by using the New Relic UI or by using NerdGraph, our GraphQL API.

## Explore your data [#view-ui]

To make the most of your logging data:

* On the [APM **Summary** page](/docs/apm/apm-ui-pages/monitoring/apm-summary-page-view-transaction-apdex-usage-data), click your **Web transaction time** chart to view logs associated with a specific point in time.
* Check your app's [**Errors inbox**](/docs/errors-inbox/errors-inbox) to view the logs associated with your errors.
* Use [distributed tracing](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui) to see the logs associated with individual traces.
* Explore more logging data across your platform with our [logs UI](/docs/logs/log-management/ui-data/use-logs-ui/).
* Set up [alerts](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/) based on log output and severity.
* [Query your data](/docs/logs/ui-data/query-syntax-logs/) using our specialized UI for logs data, and [create dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/) with the results.

## Troubleshooting tips [#troubleshooting]

Typically your logs will start to appear less than a minute after you enable <InlinePopover type="apm" /> logs in context. Check your app's **Triage > Logs** section. You will also start seeing [log patterns](/docs/logs/ui-data/find-unusual-logs-log-patterns) related to the error there.

If you don't see any logs for errors or traces, there may not be any for your app. Try refreshing the UI page, or change the [selected time period](/docs/new-relic-one/ui-data/basic-ui-features/#data-analysis).

## Disable automatic logging [#disable-automatic]

APM logs in context automatically forwards <InlinePopover type="apm" /> agent log data when enabled.  As of agent release 10.3.0, this feature is enabled by default for the PHP agent. This can have a negative impact on your security, compliance, billing, or system performance. For more information, or if you need to adjust the default setting, follow the procedures to [disable automatic logging](/docs/logs/logs-context/disable-automatic-logging).


## Manual logs in context option [#enable-logs-php]

Before language agents had the ability to forward and decorate logs, you could use our manual solutions to send linking metadata.

This option is still supported, but is no longer encouraged. Also, this method requires that you install a log forwarder before enabling logs in context. If you do not have a log forwarder, the New Relic UI will prompt you to use our [infrastructure agent](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/).

If you decide to use your existing log forwarding solution and later decide to update your agent to use automatic logs in context, be sure to **disable your manual log forwarder**. Otherwise, your app will be sending double log lines. Depending on your account, this could result in double billing. For more information, follow the procedures to disable your [specific log forwarder](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).


<Callout variant="important">
  This option should not be used with in-agent forwarding. Using an [external log forwarder](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding) to send logs to New Relic while in-agent forwarding is enabled will cause your logs to be sent up twice to New Relic. Depending on your account, this may result in double billing.
</Callout>

Update your agent's configuration to disable log forwarding, then restart the agent.

    Configuration file (`newrelic.ini`):

    ```
    newrelic.application_logging.forwarding.enabled = false

    ```

If you need to use the manual process to set up logs in context for PHP, first setup your PHP app.

1. Make sure you have already [set up logging in New Relic](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/). This includes configuring a supported log forwarder that collects your application logs and extends the metadata that is forwarded to New Relic.
2. [Install](/docs/agents/php-agent/installation/php-agent-installation-overview/) or [update](/docs/agents/php-agent/installation/update-php-agent/) to the latest PHP agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/quick-start/). Use [PHP agent version 9.13.0.270 or higher](/docs/release-notes/agent-release-notes/php-release-notes/) for logs in context.
3. Install [Monolog](https://github.com/Seldaek/monolog) version 1 or 2, or use a [compatible log forwarding plugin](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/#log-forwarding) if you are not using the built-in Monolog Handler for New Relic.
4. Configure logs in context for PHP using the Monolog extension, if used.

<CollapserGroup>
  <Collapser
    id="php-monolog"
    title="PHP configuration with Monolog"
  >
    You must install the Monolog log enricher package before you can configure Monolog for logs in context. This is done by using Composer to install the [`newrelic/monolog-enricher` package](https://packagist.org/packages/newrelic/monolog-enricher).

    In most cases, use the `Processor` and `Handler` classes provided by the log enricher package in conjunction with Monolog's built-in `BufferHandler`.

    * The `Processor` adds the contextual metadata required for New Relic's logs in context capabilities to operate.
    * The `Handler` sends the log records to New Relic.
    * The `BufferHandler` ensures that the logs are delivered with as little overhead as possible.

      At the point where you create the `Monolog\Logger` object, add the following `pushProcessor` and `pushHandler` calls to add the `Processor` and `Handler`:

      ```
      <?php

      use Monolog\Handler\BufferHandler;
      use Monolog\Logger;
      use NewRelic\Monolog\Enricher\{Handler, Processor};

      $log = new Logger('log');
      $log->pushProcessor(new Processor);
      $log->pushHandler(new BufferHandler(new Handler));
      ```

      <Callout variant="tip">
        You can use the `Processor` and `Handler` in conjunction with any existing Monolog setup. You do not need to remove your existing processors and handlers.
      </Callout>
  </Collapser>

  <Collapser
    id="php-advanced"
    title="PHP configuration with other log forwarders"
  >
    If you use Monolog to send logs to a compatible log forwarder, and if you have already configured that tool to send logs to New Relic, you can use the `Processor` and `Formatter` solely for that tool. This option prevents additional overhead of sending logs directly to New Relic with the `Handler`.

    You will need to be using a handler that supports the `setFormatter()` method, and your logging tool must be able to ingest JSON logs.

    Here's an example of configuring Monolog to handle other log forwarders:

    ```
    <?php

    use Monolog\Handler\StreamHandler;
    use Monolog\Logger;
    use NewRelic\Monolog\Enricher\{Formatter, Processor};

    $log = new Logger('log');
    $log->pushProcessor(new Processor);

    $handler = new StreamHandler('php://stderr');
    $handler->setFormatter(new Formatter);
    $log->pushHandler($handler);
    ```
  </Collapser>
</CollapserGroup>

5. To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with the enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields. If you don't see log data in the UI, follow the [troubleshooting procedures](/docs/logs/log-management/troubleshooting/no-log-data-appears-ui/).

If the logs from your application do not include fields like `trace.id` and `span.id`, there may be a problem with the configuration of the Monolog log enricher. In this situation:

* Check that the PHP agent for your app has been installed and is configured to enable distributed tracing.
* Check that your application is using the Monolog logger object when sending log records, not `syslog()`.
* Check that another Monolog handler is not preventing the log record from [bubbling](https://github.com/Seldaek/monolog/blob/master/doc/01-usage.md#core-concepts).

