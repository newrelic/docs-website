---
title: "Get started with Lambda containerized functions"
metaDescription: Create Lambda containerized functions with New Relic.
redirects:
freshnessValidatedDate: never
---

import serverlessLambdaContainerizedFunctions from 'images/serverless_screenshot-full_lambda-containerized-functions.webp'

Lambda containerized functions offer an alternative way to deploy code within AWS Lambda while still enjoying the benefits of serverless computing. 

With New Relic, you can monitor AWS Lambda functions deployed using containerized images and: 

* **Increase flexibility**: Use familiar container tooling and leverage pre-built images for your code and dependencies.
* **Improve security**: Benefit from container isolation and potential security advantages associated with containerized environments.
* **Ensure consistent runtime**: Ensure a constant development, testing, and deployment environment.

<img
    title="containerized functions"
    alt="A screenshot for lambda containerized functions"
    src={serverlessLambdaContainerizedFunctions}
/>

<figcaption>
  To view your Lambda containerized functions,  Go to [<DoNotTranslate>**one.newrelic.com > All capabilities**</DoNotTranslate>](https://one.newrelic.com/all-capabilities) > Serverless functions. 
</figcaption>

To start using Lambda containerized functions, you can use Node.js 16.x or Node.js 18.x operating system. 

<CollapserGroup>
 <Collapser
   id="node-16"
   title="Create a Lambda containerized function with the Node.js 16. x agent"
 >
<Steps>
<Step>
### Install Python [#python]

Before you begin, make sure you've installed Python in your local system.

Run the following:

```
brew install python@3.9
```

</Step>
<Step>
## Create an IAM role [#create-role]

After you've installed Python, you must create an IAM role that grants the following IAM permissions in your AWS account:

```
* Resource: "*"
    * Action:
        * "cloudwatch:GetMetricStatistics"
        * "cloudwatch:ListMetrics"
        * "cloudwatch:GetMetricData"
        * "lambda:GetAccountSettings"
        * "lambda:ListFunctions"
        * "lambda:ListAliases"
        * "lambda:ListTags"
        * "lambda:ListEventSourceMappings"
```
</Step>
<Step>
### Install the AWS CLI [#install-aws-cli]

After you've installed Python and created an IAM role, you need to install the AWS CLI. Complete the following steps:

1. First,  run the following script in your local system:

```
python3 -m pip install awscli
aws configure
AWS Access Key ID: <MYACCESSKEY>
AWS Secret Access Key: <MYSECRETKEY>
Default region name [us-east-1]: 
Default output format [None]: 
```

2. Then run the following:

```
python3 -m pip install awscli
aws configure
AWS Access Key ID: <MYACCESSKEY>
AWS Secret Access Key: <MYSECRETKEY>
Default region name [us-east-1]: 
Default output format [None]: 
```

You can read more about AWS CLI and how to install it [here](https://github.com/aws/aws-cli#getting-started).

</Step>
<Step>
## Install New Relic's Lambda CLI [#lambda]

Now, you need to install New Relic's Lambda CLI in your local system. 

1. First run:

```
pip3 install newrelic-lambda-cli
```

2. Then run:

```
    newrelic-lambda integrations install \
    --nr-account-id <account id> \
    --no-API-key <api key> --nr-region staging
```

For more information, please see our [New Relic Lambda documentation](https://github.com/newrelic/newrelic-lambda-cli#installation)
</Step>
<Step>
## Install the Lambda serverless framework [#install-lambda-serverless-framework]

Once you have the Lambda CLI you can install the serverless framework. This is the foundation for containerized functions. Run the following script:

```
npm install -g serverless

```
</Step>
<Step>
### Install the New Relic serverless framework [#install-new-relic-serverless-framework]

After you've installed Lambda's serverless framework, you need to install New Relic's serverless framework. Complete the following steps:

1. Run: 

```
npm install --save-dev serverless-newrelic-lambda-layers
```
2. Then run:

```
npm add --dev serverless-newrelic-lambda-layers

```
</Step>
<Step>
## Add the plugin [#plugin]

You can choose any example code in the `serverless-newrelic-lambda-layers` repository. Once you've selected the code, edit the `serverless.yml` file and add the plugin using the following steps:

```
plugins: 
- serverless-newrelic-lambda-layers
```
You can set the name using the service name function in the `serverless.yml` file.

```
service: <function name>
```

The following is an example:

```
custom:
  newRelic:
    accountId: <accountId>
    apiKey: <apiKey>
    enableIntegration: true
            enableFunctionLogs: true
    enableExtension: true
    logLevel: debug
    linkedAccount: New Relic Lambda Integration - <accountId>
```
</Step>
<Step>
## Deploy [#deploy]
You have now completed all the necessary steps to create a containerized function. All you have to do now is deploy it by running the following script:

```
sls deploy
```

After you've successfully deployed the containerized function, you can test the function using the following command:  

```
newrelic-lambda functions list

```
</Step>
<Step>
## Add New Relic layers [#add-new-relic-layers]

Now that you've successfully deployed, you can create layers and add subscriptions. You can do this by running the following commands:

```
newrelic-lambda layers install --nr-account-id <accountId> --function <function name>
```
And:

```
newrelic-lambda subscriptions install --function <funcion name>
```
</Step>
</Steps>

Keep in mind that New Relic for Node.js automatically instruments most standard web requests, but occasionally you might want expanded instrumentation. Using the agent's custom instrumentation API, you can create instrumentation for otherwise unsupported web frameworks, data stores, and message service clients.
</Collapser>
</CollapserGroup>

<CollapserGroup>
 <Collapser
   id="node-18"
   title="Create a Lambda containerized function with the Node.js 18. x agent"
 >
## Requirements [#Requirements]

To create a Lambda containerized function using the Node18.x agent, you will need the following:

* [AWS Command Line Interface (AWS CLI) version 2] (https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
* [Docker ](https://docs.docker.com/get-docker/)
* Node.js

<Steps>
<Step>
## Create a project directory [#project-directory]

When you build a containerized function the first step is to create a project directory. You can do this by completing the following steps: 

1. Run: 
```
mkdir example_node
cd example_node
npm init
vi index.js and add the following code.
exports.handler = async (event) => {
    const response = {
        statusCode: 200,
        body: JSON.stringify('Hello from Lambda!'),
    };
    return response;
};
```
2. Once you're finished, you will need to create a new Docker file with the following configuration:

```
FROM public.ecr.aws/lambda/nodejs:18
# Copy function code COPY index.js
${LAMBDA_TASK_ROOT} 
# Set the CMD to your handler (could also be done as a parameter override outside of the Dockerfile) 
CMD [ "index.handler" ]

```
3. Next, build the Docker image with the Docker build:

```
docker build --platform linux/amd64 -t docker-image:test 
```
</Step>
<Step>
## Test the image locally (optional) [#test-image]

Before going any further we recommend testing the image locally to make sure everything works as expected. To do this complete the following:

1. Start the Docker image with the docker run command:

```
docker run -p 9000:8080 docker-image:test
```
2. From a new terminal window, post an event to the following endpoint using a curl command:

```
curl "http://localhost:9000/2015-03-31/functions/function/invocations" -d '{}'
```

3. Get the container ID.

```
docker ps
```
4. Use the Docker kill command to stop the container. When you use this command, replace `3766c4ab331c` with the container ID from the previous step.

```
docker kill 3766c4ab331c
```
</Step>

<Step>
## Deploy the image [#deploy-image]

Now that you've successfully created the image, you will need to upload the image to Amazon ECR and create the Lambda function.  To do this, complete the following:

1. Run the `get-login-password` command to authenticate the Docker CLI to your Amazon ECR registry.
2. Set the `--region` value to the AWS Region where you want to create the Amazon ECR repository.
3. Replace 111122223333 with your AWS account ID.
```
    aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 111122223333.dkr.ecr.us-east-1.amazonaws.com
```
4. Create a repository in Amazon ECR using the create-repository command.
```
aws ecr create-repository --repository-name hello-world --image-scanning-configuration scanOnPush=true --image-tag-mutability MUTABLE
```
5. Copy the `repositoryUri` from the output in the previous step.
6. Run the [docker tag](https://docs.docker.com/reference/cli/docker/image/tag/) command to tag your local image into your Amazon ECR repository as the latest version. In this command, replace `docker-image:test` with the name and tag of your Docker image. Then replace &lt; ECRrepositoryUri &gt; with the `repositoryUri` you copied. Ensure that you include `:latest` at the end of the URI.

```
docker tag docker-image:test <ECRrepositoryUri> :latest
EX: docker tag docker-image:test 111122223333.dkr.ecr.us-east-1.amazonaws.com/hello-world:latest
```
7. Now, run the docker push command to deploy your local image to the Amazon ECR repository. Ensure you include `:latest` at the end of the repository URI.
```
docker push 111122223333.dkr.ecr.us-east-1.amazonaws.com/hello-world:latest
```
</Step>
<Step>
## Create a Lambda containerized function [#create-containerized-function]

Now, you're ready to create a Lambda containerized function. 

You'll need to create an execution role for the function if you don't already have one. If you're not sure how to do this, please refer to the [AWS documentation](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html#with-userapp-walkthrough-custom-events-create-iam-role). For the next step, you will need the Amazon Resource Name, or ARN, of the role. 

Now, you are ready to create the Lambda function. When completing the following command, you must specify the repository URI from earlier for the `Image` and `ImageUri` fields. Ensure that you include `:latest` at the end of the URI.

```
aws lambda create-function \ --function-name hello-world \ --package-type Image \ --code ImageUri=111122223333.dkr.ecr.us-east-1.amazonaws.com/hello-world:latest \ --role arn:aws:iam::111122223333:role/lambda-ex
```
Next, you have to invoke the function:

```
aws Lambda invoke --function-name hello-world response.json
```

If you have any questions, see [AWS's documentation for deploying Lambda functions with container images](https://docs.aws.amazon.com/lambda/latest/dg/nodejs-image.html).
</Step>

<Step>
## Add a New Relic Lambda layer as an image [#add-new-relic-image]

Now you're ready for the final step and can create a New Relic Lambda layer as an image.

1. First, you can see which Amazon Resource Name (ARN) layers are available [here](https://layers.newrelic-external.com/#/get-layers/get).
2. Create a new docker image using the following code:

```
FROM alpine:latest as layer-copy 
# Create a build stage to copy the files from S3 using credentials ARG AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-"region"} 
ARG AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-"accessKey"} 
ARG AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-"secretkey"} ENV AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION} 
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} 
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} 
RUN apk add aws-cli curl unzip 
RUN mkdir -p /opt 
RUN curl $(aws lambda get-layer-version-by-arn --arn <your ARN Link> --query 'Content.Location' --output text) --output layer.zip 
RUN unzip layer.zip -d /opt 
RUN rm layer.zip 
FROM scratch 
# Start second stage from blank image to squash all previous history, including credentials. 
WORKDIR /opt 
COPY --from=layer-copy /opt .
```
3. Push that image to Amazon ECR:

```
docker build -t layer-image1:latest .
```
4. Deploy the image.
5. Once you have created and deployed the image in ECR, you can use that image with the URI in your Dockerfile. Here is an example:

```

FROM <image uri> AS layer
FROM public.ecr.aws/lambda/python:3.11

# Layer code
WORKDIR /opt
COPY --from=layer /opt/ .

# Copy requirements.txt
COPY requirements.txt ${LAMBDA_TASK_ROOT}

# Copy function code
COPY lambda_function.py ${LAMBDA_TASK_ROOT}

# Install the specified packages
RUN pip freeze > requirements.txt

# Set the CMD to your handler (could also be done as a parameter override outside of the Dockerfile)
CMD [ "lambda_function.handler" ]

```
5. You can also create a docker image using the same code as above and push that image to Amazon ECR.

```
docker build -t docker-image1:latest 
```
6. Deploy the image. 
</Step>
</Steps>
</Collapser>
</CollapserGroup>

<DocTiles>
  <DocTile title="Create a New Relic Lambda layer as an image" path="/docs/tutorial-improve-app-performance/problematic-transactions" > After you've completed this setup, you can create a New Relic Lambda layer as an image</DocTile>
  <DocTile title="Learn more about Lambda and New Relic" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/monitoring-aws-lambda-serverless-monitoring" > Review New Relic's Lambda monitoring capabilities. </DocTile>
</DocTiles>










