---
title: Security data structure (NRQL reference)
metaDescription: Learn about the data structure and entity types used to store security data in New Relic.
freshnessValidatedDate: never
---

Security RX stores vulnerability and misconfiguration data in New Relic's database (NRDB), making it queryable using NRQL. This reference guide explains the entity types, attributes, and data structure you can use to build custom queries, dashboards, and alerts.

## Entity and event types

Security RX uses the following entity and event types to store security data:

### SecurityFinding Entity (Recommended)

The `SECURITY_FINDING` is a specialized entity type that serves as a generic container for all security issues detected by Security RX. This is the recommended way to query security data in New Relic.

**Important:** SecurityFinding is queried as an Entity type, not as a traditional event:

```sql
FROM Entity
SELECT * WHERE type = 'SECURITY_FINDING'
```

#### Understanding findingType

The `findingType` attribute is the key field for distinguishing the data source:

* **`findingType = 'VULNERABILITY'`**: Indicates a vulnerability finding from sources like APM agents, Infrastructure agents, or third-party scanners (Snyk, Trivy, FOSSA)
* **`findingType = 'MISCONFIGURATION'`**: Indicates a cloud security posture management (CSPM) finding from Security RX Cloud (e.g., from AWS Security Hub, GuardDuty, or Config)

Other findingType values include: `LIBRARY_VULNERABILITY`, `INFRASTRUCTURE_VULNERABILITY`, `APPLICATION_VULNERABILITY`, `SYSTEM_VULNERABILITY`, `SECURITY_EVENT`, and `OTHER`.

#### Core entity fields

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`id`</td>
      <td>String</td>
      <td>Globally unique identifier for this SecurityFinding (targets specific CVE & impacted entity)</td>
      <td>"ABC123..."</td>
    </tr>
    <tr>
      <td>`type`</td>
      <td>String</td>
      <td>Entity type - always "SECURITY_FINDING"</td>
      <td>"SECURITY_FINDING"</td>
    </tr>
    <tr>
      <td>`name`</td>
      <td>String</td>
      <td>Title of the vulnerability or misconfiguration</td>
      <td>"CVE-2024-12345: SQL Injection in library-name"</td>
    </tr>
    <tr>
      <td>`scope.id`</td>
      <td>String</td>
      <td>Account ID where this finding was detected</td>
      <td>"1234567"</td>
    </tr>
    <tr>
      <td>`scope.type`</td>
      <td>String</td>
      <td>Scope type - typically "ACCOUNT"</td>
      <td>"ACCOUNT"</td>
    </tr>
    <tr>
      <td>`metadata.createdAt`</td>
      <td>Timestamp</td>
      <td>When this entity was created</td>
      <td>Unix timestamp</td>
    </tr>
    <tr>
      <td>`metadata.updatedAt`</td>
      <td>Timestamp</td>
      <td>When this entity was last updated</td>
      <td>Unix timestamp</td>
    </tr>
    <tr>
      <td>`tags`</td>
      <td>Array</td>
      <td>List of tags applicable to entity (typically empty for SecurityFinding)</td>
      <td>[]</td>
    </tr>
  </tbody>
</table>

#### Classification fields

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`vulnerabilityIdentifier`</td>
      <td>String</td>
      <td>Identifier for aggregating SecurityFindings (usually CVE ID)</td>
      <td>"CVE-2024-12345"</td>
    </tr>
    <tr>
      <td>`findingType`</td>
      <td>String</td>
      <td>Top-level type of finding</td>
      <td>"VULNERABILITY", "MISCONFIGURATION"</td>
    </tr>
    <tr>
      <td>`findingSubType`</td>
      <td>String</td>
      <td>Sub-type (language for APM vulnerabilities, INFRA_OS_VULNERABILITY or INFRA_PACKAGE_VULNERABILITY for infrastructure)</td>
      <td>"java", "INFRA_PACKAGE_VULNERABILITY"</td>
    </tr>
    <tr>
      <td>`source`</td>
      <td>String</td>
      <td>Source of the finding</td>
      <td>"New Relic", "Snyk", "AWS Security Hub"</td>
    </tr>
  </tbody>
</table>

#### Status and severity fields

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`severity`</td>
      <td>String</td>
      <td>Reported severity of the finding</td>
      <td>"CRITICAL", "HIGH", "MEDIUM", "LOW", "UNKNOWN", "INFO"</td>
    </tr>
    <tr>
      <td>`status`</td>
      <td>String</td>
      <td>Current status of the finding</td>
      <td>"AFFECTED", "IGNORED", "NO_LONGER_DETECTED", "UNKNOWN"</td>
    </tr>
    <tr>
      <td>`remediation.remediationExists`</td>
      <td>Boolean</td>
      <td>Whether a remediation exists</td>
      <td>true, false</td>
    </tr>
    <tr>
      <td>`remediation.upgradeAction`</td>
      <td>String</td>
      <td>Security RX's suggested upgrade</td>
      <td>"Upgrade to version 2.17.1"</td>
    </tr>
    <tr>
      <td>`remediation.remediationDetails`</td>
      <td>String</td>
      <td>Brief remediation text from the source</td>
      <td>"Update library to patched version"</td>
    </tr>
    <tr>
      <td>`remediation.url`</td>
      <td>String</td>
      <td>Documentation URL from the source</td>
      <td>"https://example.com/security-advisory"</td>
    </tr>
  </tbody>
</table>

#### CVE reference fields

For vulnerability findings, the `cve` object contains detailed CVE information:

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`cve.id`</td>
      <td>String</td>
      <td>CVE identifier</td>
    </tr>
    <tr>
      <td>`cve.description`</td>
      <td>String</td>
      <td>CVE description</td>
    </tr>
    <tr>
      <td>`cve.cvssScore`</td>
      <td>Number</td>
      <td>CVSS score</td>
    </tr>
    <tr>
      <td>`cve.cvssVector`</td>
      <td>String</td>
      <td>CVSS vector string</td>
    </tr>
    <tr>
      <td>`cve.epssScore`</td>
      <td>Number</td>
      <td>EPSS exploit probability score</td>
    </tr>
    <tr>
      <td>`cve.epssPercentile`</td>
      <td>Number</td>
      <td>EPSS percentile ranking</td>
    </tr>
    <tr>
      <td>`cve.exploitKnown`</td>
      <td>Boolean</td>
      <td>Whether a known exploit exists</td>
    </tr>
    <tr>
      <td>`cve.disclosureUrl`</td>
      <td>String</td>
      <td>URL where CVE was disclosed</td>
    </tr>
    <tr>
      <td>`cve.disclosedAt`</td>
      <td>Timestamp</td>
      <td>When CVE was disclosed</td>
    </tr>
  </tbody>
</table>

#### Misconfiguration fields (Cloud findings)

For misconfiguration findings, the `misconfiguration` object contains cloud-specific information:

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`misconfiguration.cloudProvider`</td>
      <td>String</td>
      <td>Cloud provider</td>
    </tr>
    <tr>
      <td>`misconfiguration.issueTitle`</td>
      <td>String</td>
      <td>Title of the misconfiguration</td>
    </tr>
    <tr>
      <td>`misconfiguration.misconfigurationType`</td>
      <td>String</td>
      <td>Raw finding type from source</td>
    </tr>
    <tr>
      <td>`misconfiguration.normalizedResourceType`</td>
      <td>String</td>
      <td>Simplified resource type (e.g., "S3", "EC2", "RDS")</td>
    </tr>
  </tbody>
</table>

#### Impacted entity fields

The `impactedEntity` object identifies which New Relic entity is affected:

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`impactedEntity.id`</td>
      <td>String</td>
      <td>Entity GUID</td>
    </tr>
    <tr>
      <td>`impactedEntity.name`</td>
      <td>String</td>
      <td>Entity name</td>
    </tr>
    <tr>
      <td>`impactedEntity.type`</td>
      <td>String</td>
      <td>Entity type (APM-APPLICATION, INFRA-HOST, etc.)</td>
    </tr>
    <tr>
      <td>`impactedEntity.scope.id`</td>
      <td>String</td>
      <td>Account ID</td>
    </tr>
    <tr>
      <td>`impactedEntity.scope.type`</td>
      <td>String</td>
      <td>Scope type</td>
    </tr>
  </tbody>
</table>

#### Timestamp fields

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`firstDetected`</td>
      <td>Timestamp</td>
      <td>When the finding was first detected</td>
    </tr>
    <tr>
      <td>`findingUpdatedAt`</td>
      <td>Timestamp</td>
      <td>When the finding was last updated</td>
    </tr>
    <tr>
      <td>`lastSeen`</td>
      <td>Timestamp</td>
      <td>When the finding was last known to be active</td>
    </tr>
  </tbody>
</table>

#### UI and internal fields

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`vulnerabilityUILinks.detailsUrl`</td>
      <td>String</td>
      <td>Link to details page in Security RX UI</td>
    </tr>
    <tr>
      <td>`vulnerabilityUILinks.tabUrl`</td>
      <td>String</td>
      <td>Link to entity-view in Security RX UI</td>
    </tr>
    <tr>
      <td>`internalState.status`</td>
      <td>String</td>
      <td>Internal status field</td>
    </tr>
    <tr>
      <td>`internalState.active`</td>
      <td>Boolean</td>
      <td>Internal active flag (used in cloud queries)</td>
    </tr>
    <tr>
      <td>`entityLookupValue`</td>
      <td>String</td>
      <td>Internal field (will be hidden in production)</td>
    </tr>
    <tr>
      <td>`issueInstanceKey`</td>
      <td>String</td>
      <td>Internal field (will be hidden in production)</td>
    </tr>
    <tr>
      <td>`additionalInfo`</td>
      <td>Array of Objects</td>
      <td>Additional metadata with key-value pairs (used for cloud account IDs, etc.)</td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
Fields marked as "internal" are currently visible in NRDB but may be hidden upon final launch. The `internalState.active` field is commonly used in cloud misconfiguration queries to filter active findings.
</Callout>

#### Query examples for vulnerabilities

**Count active critical vulnerabilities by entity:**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND severity = 'CRITICAL'
FACET impactedEntity.name
```

**Find entities affected by a specific CVE:**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND cve.id = 'CVE-2024-23944'
FACET impactedEntity.name
```

**Find CVEs with active ransomware campaigns:**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.exploitKnown IS true
FACET impactedEntity.name, cve.id
```

**Find likely exploitable vulnerabilities (high EPSS score):**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.epssPercentile > '0.95'
FACET cve.id
```

**Find reporting sources for your findings:**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
FACET source
```

**Entities with high vulnerability thresholds:**
```sql
SELECT impactedEntity
FROM (
  SELECT count(*) AS vulnerableCount
  FROM Entity
  WHERE type = 'SECURITY_FINDING'
    AND severity IN ('CRITICAL', 'HIGH')
  FACET impactedEntity.name AS impactedEntity, severity
)
WHERE (severity = 'HIGH' AND vulnerableCount > 10)
   OR (severity = 'CRITICAL' AND vulnerableCount > 5)
```

#### Query examples for cloud misconfigurations

**Count unique misconfigurations by status:**
```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET status
```

**Top 10 most common misconfiguration types:**
```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.issueTitle
LIMIT 10
```

**Find riskiest AWS accounts:**
```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity IN ('CRITICAL', 'HIGH')
FACET aparse(additionalInfo, '%"key":"cloudProviderAccountId","values":["*"]%') AS 'AWS Account ID'
LIMIT 10
```

**Count misconfigurations by resource type:**
```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.normalizedResourceType
```

**Find critical and publicly exposed resources:**
```sql
FROM Entity
SELECT name, impactedEntity.name, misconfiguration.misconfigurationType
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity = 'CRITICAL'
  AND misconfiguration.misconfigurationType LIKE 'Effects/Data Exposure'
SINCE 1 day ago
```

### NrAiIncident (Legacy)

Legacy event type that stores vulnerability findings and their current status. This event type is still supported for backward compatibility, but we recommend using `SecurityFinding` for new queries.

**Primary use:** Query vulnerabilities affecting your entities

**Key attributes:**

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Type
      </th>

      <th>
        Description
      </th>

      <th>
        Example
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `title`
      </td>

      <td>
        String
      </td>

      <td>
        Vulnerability title
      </td>

      <td>
        "CVE-2024-12345: SQL Injection in library-name"
      </td>

    </tr>

    <tr>
      <td>
        `priority`
      </td>

      <td>
        String
      </td>

      <td>
        Computed priority rank
      </td>

      <td>
        "CRITICAL", "HIGH", "MEDIUM", "LOW"
      </td>

    </tr>

    <tr>
      <td>
        `state`
      </td>

      <td>
        String
      </td>

      <td>
        Current vulnerability state
      </td>

      <td>
        "OPEN", "CLOSED"
      </td>

    </tr>

    <tr>
      <td>
        `acknowledged`
      </td>

      <td>
        Boolean
      </td>

      <td>
        Whether vulnerability has been reviewed
      </td>

      <td>
        `true`, `false`
      </td>

    </tr>

    <tr>
      <td>
        `conditionName`
      </td>

      <td>
        String
      </td>

      <td>
        Detection source/condition
      </td>

      <td>
        "Security RX - Vulnerability Detection"
      </td>

    </tr>

    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        String
      </td>

      <td>
        Entity GUID affected by vulnerability
      </td>

      <td>
        "ABC123..."
      </td>

    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        String
      </td>

      <td>
        Entity name
      </td>

      <td>
        "my-application"
      </td>

    </tr>

    <tr>
      <td>
        `entityType`
      </td>

      <td>
        String
      </td>

      <td>
        Type of affected entity
      </td>

      <td>
        "APPLICATION", "HOST"
      </td>

    </tr>

  </tbody>
</table>
**Query example:**
```sql
FROM NrAiIncident
SELECT count(*)
WHERE conditionName LIKE '%Security RX%'
FACET priority, state
```

### Vulnerability (Custom Event)

Stores detailed vulnerability metadata including CVE information, severity scores, and remediation guidance.

**Primary use:** Deep dive into vulnerability details and metadata

**Key attributes:**

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Type
      </th>

      <th>
        Description
      </th>

      <th>
        Example
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `cveId`
      </td>

      <td>
        String
      </td>

      <td>
        CVE identifier
      </td>

      <td>
        "CVE-2024-12345"
      </td>

    </tr>

    <tr>
      <td>
        `severity`
      </td>

      <td>
        String
      </td>

      <td>
        CVSS-based severity
      </td>

      <td>
        "CRITICAL", "HIGH", "MEDIUM", "LOW"
      </td>

    </tr>

    <tr>
      <td>
        `cvssScore`
      </td>

      <td>
        Number
      </td>

      <td>
        CVSS numeric score
      </td>

      <td>
        9.8
      </td>

    </tr>

    <tr>
      <td>
        `epssScore`
      </td>

      <td>
        Number
      </td>

      <td>
        EPSS exploit probability
      </td>

      <td>
        0.95
      </td>

    </tr>

    <tr>
      <td>
        `epssPercentile`
      </td>

      <td>
        Number
      </td>

      <td>
        EPSS percentile ranking
      </td>

      <td>
        98.5
      </td>

    </tr>

    <tr>
      <td>
        `activeRansomware`
      </td>

      <td>
        Boolean
      </td>

      <td>
        Used in known ransomware campaigns
      </td>

      <td>
        `true`, `false`
      </td>

    </tr>

    <tr>
      <td>
        `affectedPackage`
      </td>

      <td>
        String
      </td>

      <td>
        Vulnerable library/package name
      </td>

      <td>
        "log4j-core"
      </td>

    </tr>

    <tr>
      <td>
        `affectedVersion`
      </td>

      <td>
        String
      </td>

      <td>
        Vulnerable package version
      </td>

      <td>
        "2.14.0"
      </td>

    </tr>

    <tr>
      <td>
        `fixedVersion`
      </td>

      <td>
        String
      </td>

      <td>
        Version with fix
      </td>

      <td>
        "2.17.1"
      </td>

    </tr>

    <tr>
      <td>
        `entityGuid`
      </td>

      <td>
        String
      </td>

      <td>
        Affected entity GUID
      </td>

      <td>
        "ABC123..."
      </td>

    </tr>

    <tr>
      <td>
        `source`
      </td>

      <td>
        String
      </td>

      <td>
        Detection source
      </td>

      <td>
        "APM_AGENT", "SNYK", "AWS_SECURITY_HUB"
      </td>

    </tr>

  </tbody>
</table>
**Query example:**
```sql
FROM Vulnerability
SELECT count(*)
WHERE severity = 'CRITICAL'
AND activeRansomware = true
FACET affectedPackage
```

### NrAiIncidentTimeline

Tracks status changes and lifecycle events for vulnerabilities.

**Primary use:** Audit vulnerability status history and track remediation progress

**Key attributes:**

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Type
      </th>

      <th>
        Description
      </th>

      <th>
        Example
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `incidentId`
      </td>

      <td>
        String
      </td>

      <td>
        Related incident/vulnerability ID
      </td>

      <td>
        "INC-123"
      </td>

    </tr>

    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        When status changed
      </td>

      <td>
        Unix timestamp
      </td>

    </tr>

    <tr>
      <td>
        `event`
      </td>

      <td>
        String
      </td>

      <td>
        Type of change
      </td>

      <td>
        "STATUS_CHANGED", "DETECTED", "RESOLVED"
      </td>

    </tr>

    <tr>
      <td>
        `previousState`
      </td>

      <td>
        String
      </td>

      <td>
        State before change
      </td>

      <td>
        "AFFECTED"
      </td>

    </tr>

    <tr>
      <td>
        `newState`
      </td>

      <td>
        String
      </td>

      <td>
        State after change
      </td>

      <td>
        "IGNORED"
      </td>

    </tr>

    <tr>
      <td>
        `changedBy`
      </td>

      <td>
        String
      </td>

      <td>
        User who made change
      </td>

      <td>
        "user@example.com"
      </td>

    </tr>

    <tr>
      <td>
        `reason`
      </td>

      <td>
        String
      </td>

      <td>
        Reason for status change
      </td>

      <td>
        "False positive - not using vulnerable code path"
      </td>

    </tr>

  </tbody>
</table>
**Query example:**
```sql
FROM NrAiIncidentTimeline
SELECT timestamp, event, previousState, newState, changedBy
WHERE event = 'STATUS_CHANGED'
SINCE 7 days ago
```

## Common attributes across event types

These attributes appear across multiple event types:

### Entity identification

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Description
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        Unique identifier for the affected entity
      </td>

    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        Human-readable entity name
      </td>

    </tr>

    <tr>
      <td>
        `entity.type`
      </td>

      <td>
        Entity type (APPLICATION, HOST, SERVICE)
      </td>

    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        New Relic account ID
      </td>

    </tr>

  </tbody>
</table>
### Timestamps

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Description
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        When the event occurred
      </td>

    </tr>

    <tr>
      <td>
        `detectedAt`
      </td>

      <td>
        When vulnerability was first detected
      </td>

    </tr>

    <tr>
      <td>
        `updatedAt`
      </td>

      <td>
        Last update timestamp
      </td>

    </tr>

    <tr>
      <td>
        `resolvedAt`
      </td>

      <td>
        When vulnerability was marked resolved
      </td>

    </tr>

  </tbody>
</table>
### Source tracking

<table>
  <thead>
    <tr>
      <th>
        Attribute
      </th>

      <th>
        Description
      </th>

    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `source`
      </td>

      <td>
        Data source (APM_AGENT, INFRASTRUCTURE, SNYK, etc.)
      </td>

    </tr>

    <tr>
      <td>
        `sourceId`
      </td>

      <td>
        Unique ID from source system
      </td>

    </tr>

    <tr>
      <td>
        `integrationName`
      </td>

      <td>
        Integration that provided data
      </td>

    </tr>

  </tbody>
</table>
## Data relationships

Understanding how data types relate to each other:

### Modern approach (Recommended)

```
SecurityFinding Entity (type = 'SECURITY_FINDING')
    ↓ contains
    ├─ findingType (VULNERABILITY or MISCONFIGURATION)
    ├─ cve (CVE details for vulnerabilities)
    ├─ misconfiguration (Cloud security details)
    └─ impactedEntity (Affected New Relic entity)
```

### Legacy approach (Backward compatibility)

```
Entity (Application/Host)
    ↓ has many
NrAiIncident (Active vulnerabilities)
    ↓ references
Vulnerability (CVE details)
    ↓ has many
NrAiIncidentTimeline (Status history)
```

## Query patterns

<Callout variant="tip">
**Recommended:** Use `SecurityFinding` Entity queries (shown in the SecurityFinding section above) for new implementations. The patterns below use legacy event types and are provided for backward compatibility only.
</Callout>

### Modern query patterns

For modern query patterns using SecurityFinding Entity, see the [Query examples sections above](#query-examples-for-vulnerabilities).

### Legacy query patterns

These patterns use the legacy event types:

#### Join entity data with vulnerabilities (Legacy)

```sql
FROM NrAiIncident
SELECT entity.name, count(*) as 'Vulnerability Count'
WHERE conditionName LIKE '%Security RX%'
AND state = 'OPEN'
FACET entity.name
SINCE 1 day ago
```

**Modern equivalent:**
```sql
FROM Entity
SELECT impactedEntity.name, count(*) as 'Vulnerability Count'
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
FACET impactedEntity.name
SINCE 1 day ago
```

#### Calculate exposure windows (Legacy)

```sql
FROM Vulnerability
SELECT entity.name,
       cveId,
       (max(timestamp) - min(timestamp)) / 86400 as 'Days Exposed'
WHERE severity IN ('CRITICAL', 'HIGH')
FACET entity.name, cveId
SINCE 30 days ago
```

**Modern equivalent:**
```sql
FROM Entity
SELECT impactedEntity.name,
       cve.id,
       (max(findingUpdatedAt) - min(firstDetected)) / 86400 as 'Days Exposed'
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
FACET impactedEntity.name, cve.id
SINCE 30 days ago
```

#### Track remediation velocity (Legacy)

```sql
FROM NrAiIncidentTimeline
SELECT count(*) as 'Vulnerabilities Resolved'
WHERE event = 'STATUS_CHANGED'
AND newState = 'CLOSED'
FACET weekOf(timestamp)
SINCE 90 days ago
```

<Callout variant="important">
For tracking status changes with SecurityFinding Entity, monitor changes in the `status` field over time or use New Relic Alerts to get notifications when status changes occur.
</Callout>

## Attribute types and formats

### Severity values

```
CRITICAL - CVSS 9.0-10.0
HIGH     - CVSS 7.0-8.9
MEDIUM   - CVSS 4.0-6.9
LOW      - CVSS 0.1-3.9
INFO     - CVSS 0.0
```

### State values

```
OPEN      - Vulnerability currently active
CLOSED    - Vulnerability resolved or fixed
AFFECTED  - Entity is confirmed affected
IGNORED   - Marked as not applicable
NO_LONGER_DETECTED - No longer seen in scans
```

### Source values

```
APM_AGENT            - Detected by New Relic APM agent
INFRASTRUCTURE       - Detected by Infrastructure agent
SNYK                 - Imported from Snyk
AWS_SECURITY_HUB     - Imported from AWS Security Hub
DEPENDABOT           - Imported from GitHub Dependabot
FOSSA                - Imported from FOSSA
TRIVY                - Imported from Trivy
SECURITY_DATA_API    - Sent via API
```

## Querying tips

### Filter by severity (Modern approach)

Findings are prioritized based on severity:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
  AND status = 'AFFECTED'
FACET impactedEntity.name
```

### Filter by finding type

Separate vulnerabilities from misconfigurations:

```sql
-- Vulnerabilities only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'VULNERABILITY'
FACET impactedEntity.type

-- Misconfigurations only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET misconfiguration.normalizedResourceType
```

### Filter by entity type

Separate application from infrastructure vulnerabilities:

```sql
-- Application vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%APPLICATION%'
FACET impactedEntity.name

-- Infrastructure vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%HOST%'
FACET impactedEntity.name
```

### Filter by detection source

Query findings from specific integrations:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND source = 'Snyk'
FACET severity
```

### Time-based filtering

Find recently detected findings:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND firstDetected > ago(7 days)
FACET cve.id, severity
```

## Building custom dashboards

Use SecurityFinding Entity to create comprehensive security dashboards:

1. **Executive dashboard** - High-level security metrics across all finding types
   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET severity, findingType
   ```

2. **Vulnerability trends** - Track vulnerability detection over time
   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'VULNERABILITY'
   FACET weekOf(firstDetected)
   SINCE 90 days ago
   ```

3. **Cloud security posture** - Monitor cloud misconfigurations
   ```sql
   FROM Entity
   SELECT uniqueCount(misconfiguration.issueTitle)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'MISCONFIGURATION'
   FACET misconfiguration.cloudProvider, severity
   ```

4. **Entity security posture** - Per-entity security views
   ```sql
   FROM Entity
   SELECT count(*) AS 'Findings'
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET impactedEntity.name, severity
   ```

For more query examples, see [Security data query examples](/docs/vulnerability-management/advanced/query-examples).

### Legacy dashboard approaches

For backward compatibility, you can still use the legacy event types (`NrAiIncident`, `Vulnerability`, `NrAiIncidentTimeline`), but we recommend migrating to SecurityFinding Entity for new dashboards.

## What's next?

<DocTiles>
  <DocTile title="Query examples" path="/docs/vulnerability-management/advanced/query-examples">
    Ready-to-use NRQL queries for common security scenarios
  </DocTile>

  <DocTile title="Set up alerts" path="/docs/vulnerability-management/advanced/set-up-alerts">
    Create NRQL-based alerts for vulnerabilities
  </DocTile>

  <DocTile title="Manage vulnerability status" path="/docs/vulnerability-management/advanced/manage-vulnerability-status">
    Change vulnerability status and track remediation
  </DocTile>
</DocTiles>
