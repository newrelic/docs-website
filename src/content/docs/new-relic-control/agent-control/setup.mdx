---
title: "Setup and Install Agent Control"
metaDescription: "Learn how to install and configure Agent Control on a Kubernetes cluster, Linux host, or Windows host."
freshnessValidatedDate: never
---

<Callout variant="important">
  Agent Control and New Relic Control are now **generally available** for Kubernetes! Support for Linux and Windows hosts is also in **public preview** program, pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

## Overview

Agent Control simplifies the management of your instrumentation agents. This guide will walk you through the process of installing and uninstalling Agent Control on your Kubernetes clusters, Linux hosts, or Windows hosts using different methods.

## Install Agent Control

<Callout title="tip">
For automating Agent Control setup across large-scale infrastructure, see [Set up Agent Control with Terraform](/docs/infrastructure-as-code/terraform/agent-control).
</Callout>

### Guided install
1. Log in to New Relic.
2. Ensure the correct account is selected.

<Callout title="important">
    To install Agent Control, it is mandatory to have a fleet. If you haven't yet created a fleet for this managed entity, you can create a fleet during the instalaltion in the Guided Install or complete the fleet creation process in **New Relic Control**, and then return to this guided installation step.
</Callout>

3. In Integrations & Agents, click **Install Agent Control** or search for **Agent Control**.

   <img
     title="Agent Control guided install"
     alt="Screenshot of the guided install tasks for Agent Control"
     src="/images/agent-control-guided-install.webp"
   />

4. Follow the steps to complete the installation and configuration process.

<Callout title="tip">
    To install Agent Control, it is mandatory to have a fleet. If you haven't yet created a fleet for this managed entity, you can create a fleet during the installation in the Guided Install or complete the fleet creation process in **Fleet Control**, and then return to this guided installation step.
</Callout>

5. Download the generated configuration to your computer and run the provided command in your terminal to install Agent Control. After installation, click **Continue**.
6. Test the connection to confirm the installation was successful. This step may take 5-10 minutes to complete.

<Callout variant="important" title="Windows installation notes">
  **Installation method:** Agent Control for Windows is installed using PowerShell scripts. MSI or MSIX installers are not currently available. You'll need to run the provided PowerShell installation script with Administrator privileges.

  **Fleet type requirement:** For Windows hosts, you must select or create a fleet with the **"Host - Windows"** type during the guided installation. Using a fleet with a different type (such as "Host - Linux") will cause installation or operation issues.

  **Agent version requirements:** Ensure you select compatible agent versions during installation:
  - Infrastructure Agent: version 1.71.0 or higher
  - NRDOT (OpenTelemetry Collector): version 1.5.0 or higher

  Templates and configurations from Linux environments may require adjustments for Windows compatibility.

  **Existing agents:** If you have New Relic agents already installed on your Windows host (Infrastructure Agent, APM agents, etc.), you must uninstall them before installing Agent Control. Agent Control does not support automatic migration of existing agents on Windows. After installing Agent Control, you can reinstall and manage agents through Fleet Control.
</Callout>

### Note about Authentication

New Relic Control requires the use of system identities, which are non-human identities used to authenticate and establish trust between services and applications.

During the Agent Control guided installation process, the first system identity is created using client credentials, which are included in the Helm chart's values. **The credentials for this system identity expire after 12 hours.**
When they expire, the Agent Control Helm chart deployment will fail to authenticate with the Fleet Control service, resulting in the following error:

```
Error getting system identity auth token. The API endpoint returned 400: Expired client secret.
```

In this case, the Helm chart must be updated with new system identity credentials.
```yaml
global:
  cluster: "cluster-name"
  licenseKey: "*************************"
agentControlDeployment:
  chartValues:
    systemIdentity:
      organizationId: "00000000-0000-0000-0000-000000000000"
      parentIdentity:
        clientId: "CLIENT_ID"
        clientSecret: "CLIENT_SECRET"
    config:
      fleet_control:
        fleet_id: "SAMPLE_FLEET_ID"
      agents:
        ...
```

## Verify Installation

Now that Agent Control is installed and running, you're ready to [configure and manage your agents](/docs/new-relic-control/agent-control/configuration) or deploy changes to your agents using Fleet Control](/docs/new-relic-control/fleet-control/overview).

### Kubernetes

1. Run the following commands to check the status of your pods:

  Agent Control installs subagents in a different namespace for security reasons. To verify that everything is working, check that the Agent Control pods are running in the `newrelic-agent-control` namespace and the subagent pods are running in a different namespace, such as `newrelic`.


  ```shell
  kubectl get pods -n newrelic-agent-control    # Check Agent Control pods
  kubectl get pods -n newrelic                  # Check subagent pods
  ```

2. Log in to New Relic, and go to **Fleet Control**.
3. Go to the Fleets page and select the fleet you chose during installation.
4. In the **Entities** table, confirm that your Kubernetes cluster appears in the list.
5. Verify that the instrumentation status for your cluster is **healthy**.

### Linux

* Check the status of the `newrelic-agent-control` service:

  ```bash
    sudo systemctl status newrelic-agent-control
  ```

  If the service appears in `Failed` or `Stopped` state, this means the agent got installed but there's an issue preventing its normal operation.
  Check the agent services logs using `journalctl` (or any similar Linux tool):

  ```bash
    journalctl -u newrelic-agent-control
  ```

  If no insights are available, check how to [run the agent in debug mode](/docs/new-relic-agent-control#debug) to access detailed logs to get more insight into why the service cannot be started.
* If the service is not installed, try appending `--debug` at the end of the [install command](#cli) and run it again. This will enable verbose logging for the installation script. See if the verbose output has additional context explaining the error.
* Optionally, answer `yes` when asked to send logs to New Relic to help troubleshooting the installation. Once submitted, logs can be accessed with the following NRQL query:

  ```sql
    SELECT * FROM Log WHERE hostname = `your-host-name`
  ```

### Windows

#### Pre-installation checklist

Before installing Agent Control on Windows, verify these prerequisites:

- [ ] **Administrator privileges** - Right-click PowerShell and select "Run as Administrator"
- [ ] **PowerShell version** - Verify PowerShell 5.0 or higher:
  ```powershell
  $PSVersionTable.PSVersion
  ```
- [ ] **Port availability** - Ensure port 51200 is not in use:
  ```powershell
  netstat -ano | findstr :51200
  ```
  If the command returns no output, the port is available.
- [ ] **Existing agents removed** - Uninstall any existing New Relic agents:
  ```powershell
  Get-Service -Name newrelic-infra -ErrorAction SilentlyContinue
  ```
  If this returns a service, uninstall the Infrastructure Agent first.
- [ ] **Fleet created** - Create a fleet with **"Host - Windows"** type in Fleet Control
- [ ] **Network connectivity** - Test access to New Relic services:
  ```powershell
  Test-NetConnection -ComputerName download.newrelic.com -Port 443
  ```
- [ ] **Antivirus configuration** - Add exclusions (see security software notes below)

<Callout variant="caution" title="Antivirus and Security Software">
  Windows Defender or third-party antivirus software may block Agent Control from running as a service. Before installation, add these directories to your antivirus exclusions:

  * `C:\Program Files\New Relic\newrelic-agent-control\`
  * `C:\ProgramData\New Relic\newrelic-agent-control\`

  If Agent Control fails to start after installation and runs successfully from the command line, this indicates antivirus interference. Work with your security team to configure appropriate exceptions for New Relic executables.
</Callout>

#### Verify Installation

1. Check the status of the `newrelic-agent-control` service:

   Open PowerShell with Administrator privileges and run:

   ```powershell
   Get-Service -Name newrelic-agent-control
   ```

   The service should show status `Running`. If the service appears in `Stopped` state or does not exist, proceed with troubleshooting below.

2. Verify the Agent Control health endpoint:

   ```powershell
   Invoke-WebRequest -Uri "http://localhost:51200/status" -UseBasicParsing
   ```

   A healthy Agent Control should return a JSON response with `"healthy": true`.

3. Log in to New Relic, and go to **Fleet Control**.
4. Go to the Fleets page and select the fleet you chose during installation.
5. In the **Entities** table, confirm that your Windows host appears in the list.
6. Verify that the instrumentation status for your host is **healthy**.

#### What to expect after installation

After running the installation script, Agent Control sets up the supervisor service only. No instrumentation agents are deployed automatically.

**Immediate (0-2 minutes):**
- **0-30 seconds:** Agent Control service registers and starts
- **30-60 seconds:** First connection to Fleet Control established
- **1-2 minutes:** Configuration synchronization completes and host appears in Fleet Control

**Next steps required:**
After Agent Control is installed and connected to Fleet Control, you must manually deploy agents to begin collecting telemetry:

1. Log in to New Relic and navigate to **Fleet Control**
2. Select your fleet and locate your Windows host in the **Entities** table
3. Deploy agents (Infrastructure Agent, NRDOT, etc.) to your host using Fleet Control
4. Wait 5-10 minutes for deployed agents to start and send telemetry to New Relic

<Callout variant="important">
  **No telemetry by default:** Agent Control is a supervisor service that manages agents. It does not collect or send telemetry data itself. To see infrastructure metrics, logs, or other telemetry in New Relic, you must deploy and configure agents (such as the Infrastructure Agent) through Fleet Control after installation.
</Callout>

If the Agent Control service doesn't connect to Fleet Control within 2-3 minutes, check the troubleshooting section below.

#### Service management commands

Manage the Agent Control Windows service with these PowerShell commands (run as Administrator):

**Start the service:**
```powershell
Start-Service -Name newrelic-agent-control
```

**Stop the service:**
```powershell
Stop-Service -Name newrelic-agent-control
```

**Restart the service:**
```powershell
Restart-Service -Name newrelic-agent-control
```

**Check service status:**
```powershell
Get-Service -Name newrelic-agent-control | Format-List Status, StartType
```

Expected output when healthy:
```
Status    : Running
StartType : Automatic
```

**View service configuration:**
```powershell
Get-WmiObject -Class Win32_Service -Filter "Name='newrelic-agent-control'" | Format-List Name, State, StartMode, StartName
```

#### Directory structure

Agent Control creates the following directory structure on Windows:

**Program Files (Executables):**
```
C:\Program Files\New Relic\newrelic-agent-control\
├── newrelic-agent-control.exe       # Main service executable
├── uninstall.ps1                     # Uninstallation script
└── local-data\
    └── agent-control\
        └── local_config.yaml         # Local configuration file
```

**Program Data (Runtime data):**
```
C:\ProgramData\New Relic\newrelic-agent-control\
├── fleet-data\
│   └── agent-control\
│       └── remote_config.yaml        # Configuration synced from Fleet Control
├── logs\
│   └── newrelic-agent-control.log    # Service logs
├── filesystem\                       # Managed agent configurations and data
└── packages\                         # Downloaded agent packages (cached)
```

<Callout variant="tip" title="Log Location">
  **Find Agent Control logs at:**
  `C:\ProgramData\New Relic\newrelic-agent-control\logs\newrelic-agent-control.log`

  View recent logs:
  ```powershell
  Get-Content "C:\ProgramData\New Relic\newrelic-agent-control\logs\newrelic-agent-control.log" -Tail 100
  ```
</Callout>

#### Windows-specific features

**Log collection:**
Windows hosts can collect logs through the Infrastructure Agent's integrated Fluent Bit. The Infrastructure Agent package includes Fluent Bit binaries for Windows, enabling you to configure log forwarding using the `config_logging` parameter in your agent configuration. Log configurations work similarly to Linux hosts but use Windows-specific paths and formats.

**Configuration notes:**
- File paths in Windows configurations use backslashes (`\\`) and Windows-style paths (e.g., `C:\\ProgramData\\...`)
- Environment variables are set using Windows conventions
- Agent binaries use `.exe` extensions
- Configuration files are stored in the locations shown in the directory structure above

#### Configuration parameters

Key configuration parameters for Agent Control on Windows:

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>Parameter</th>
      <th>Description</th>
      <th>Default Location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`license_key`</td>
      <td>Your New Relic license key (required)</td>
      <td>Set in `local_config.yaml`</td>
    </tr>
    <tr>
      <td>`fleet_id`</td>
      <td>Fleet Control fleet identifier (required)</td>
      <td>Set in `local_config.yaml`</td>
    </tr>
    <tr>
      <td>Installation directory</td>
      <td>Agent Control executable location</td>
      <td>`C:\Program Files\New Relic\newrelic-agent-control\`</td>
    </tr>
    <tr>
      <td>Configuration directory</td>
      <td>Local and remote configuration files</td>
      <td>`C:\Program Files\New Relic\newrelic-agent-control\local-data\`</td>
    </tr>
    <tr>
      <td>Data directory</td>
      <td>Runtime data, managed agent files, logs</td>
      <td>`C:\ProgramData\New Relic\newrelic-agent-control\`</td>
    </tr>
    <tr>
      <td>Log directory</td>
      <td>Service log files</td>
      <td>`C:\ProgramData\New Relic\newrelic-agent-control\logs\`</td>
    </tr>
    <tr>
      <td>Health endpoint port</td>
      <td>HTTP endpoint for status checks</td>
      <td>`51200` (not configurable)</td>
    </tr>
    <tr>
      <td>Service name</td>
      <td>Windows service identifier</td>
      <td>`newrelic-agent-control`</td>
    </tr>
    <tr>
      <td>Service account</td>
      <td>Windows account running the service</td>
      <td>`LocalSystem` (required for agent management)</td>
    </tr>
  </tbody>
</table>

**View current configuration:**
```powershell
Get-Content "C:\Program Files\New Relic\newrelic-agent-control\local-data\agent-control\local_config.yaml"
```

**Verify service configuration:**
```powershell
Get-WmiObject -Class Win32_Service -Filter "Name='newrelic-agent-control'" | Format-List PathName, StartName, State
```

<Callout variant="important" title="Security Note">
  Agent Control runs with `LocalSystem` privileges on Windows to manage agent lifecycle operations. Ensure configuration files have appropriate permissions:

  - Program Files directory: Read/Execute for standard users, Write for Administrators only
  - ProgramData directory: Write restricted to Administrators and SYSTEM account

  Only use configurations and agent sources from trusted origins. Agent Control can execute managed agents with elevated privileges.
</Callout>

#### Troubleshooting Windows installation

If Agent Control is not running or healthy, follow these diagnostic steps in order:

**1. Verify service status:**
```powershell
Get-Service -Name newrelic-agent-control
```
Expected: `Status : Running`. If stopped or missing, proceed to step 2.

**2. Check service logs:**

View Windows Event Log entries:
```powershell
Get-EventLog -LogName Application -Source "newrelic-agent-control" -Newest 50 | Format-List TimeGenerated, EntryType, Message
```

Or check the log files directly:
```powershell
Get-Content "C:\ProgramData\New Relic\newrelic-agent-control\logs\newrelic-agent-control.log" -Tail 50
```

**3. Test manual execution:**

Run Agent Control from command line to bypass service-specific issues:
```powershell
cd "C:\Program Files\New Relic\newrelic-agent-control"
.\newrelic-agent-control.exe --config "C:\Program Files\New Relic\newrelic-agent-control\local-data\agent-control\local_config.yaml"
```

If it runs successfully from command line but not as a service, this indicates antivirus or permission issues.

**4. Verify fleet type:**

Ensure the fleet is type **"Host - Windows"**. Using "Host - Linux" will cause failures. Check in Fleet Control UI under fleet details.

**5. Check for port conflicts:**

Agent Control uses port `51200` for its health endpoint:
```powershell
netstat -ano | findstr :51200
```

If another process is using this port, identify it:
```powershell
Get-Process -Id (Get-NetTCPConnection -LocalPort 51200).OwningProcess
```

**6. Verify network connectivity:**

Test connection to Fleet Control:
```powershell
Test-NetConnection -ComputerName fleet-control.newrelic.com -Port 443
Test-NetConnection -ComputerName download.newrelic.com -Port 443
```

Both should show `TcpTestSucceeded : True`.

**7. Review configuration syntax:**

Check for YAML syntax errors:
```powershell
Get-Content "C:\Program Files\New Relic\newrelic-agent-control\local-data\agent-control\local_config.yaml"
```

Look for common issues: incorrect indentation, missing colons, unquoted special characters.

**8. Check for conflicting agents:**

Verify existing New Relic agents are uninstalled:
```powershell
Get-Service -Name newrelic-infra -ErrorAction SilentlyContinue
Get-Process -Name newrelic-infra -ErrorAction SilentlyContinue
```

If either command returns results, uninstall the Infrastructure Agent before proceeding.

**9. Verify Administrator privileges:**

Confirm PowerShell is running as Administrator:
```powershell
([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
```

Should return `True`.

**10. Restart the service:**

After addressing issues, restart the service:
```powershell
Restart-Service -Name newrelic-agent-control
Start-Sleep -Seconds 30
Get-Service -Name newrelic-agent-control
Invoke-WebRequest -Uri "http://localhost:51200/status" -UseBasicParsing
```

##### Common error messages

| Error/Symptom | Likely Cause | Solution |
|---------------|--------------|----------|
| `Error 1067: The process terminated unexpectedly` | Antivirus blocking, configuration error, or missing dependencies | Add antivirus exclusions, verify config syntax, check Event Log for details |
| Service starts then stops immediately | Configuration file error or invalid credentials | Review `local_config.yaml`, verify license key and fleet credentials |
| `Port 51200 already in use` | Port conflict with another application | Identify process using port with `netstat`, stop conflicting service |
| `Failed to connect to Fleet Control` | Network/firewall blocking, or incorrect fleet configuration | Test connectivity with `Test-NetConnection`, verify fleet ID and type |
| `Invalid fleet type` error in logs | Fleet type is not "Host - Windows" | Recreate fleet with correct type in Fleet Control UI |
| Service won't start, runs fine from command line | Antivirus or Windows security policy blocking service | Add exclusions for executables and directories, check with security team |
| `License key validation failed` | Incorrect, expired, or missing license key | Verify license key in config file, ensure it's valid for your account |
| No data appearing in UI after 10+ minutes | Agent not deployed or configuration not synced | Check Fleet Control UI for deployment status, verify fleet configuration |

<Callout variant="tip" title="Getting Additional Help">
  If troubleshooting doesn't resolve your issue:

  1. Enable debug logging by editing `local_config.yaml`:
     ```yaml
     log:
       level: debug
     ```

  2. Restart the service and reproduce the issue

  3. Collect logs for support:
     ```powershell
     Get-Content "C:\ProgramData\New Relic\newrelic-agent-control\logs\newrelic-agent-control.log" | Out-File -FilePath "$env:USERPROFILE\Desktop\agent-control-debug.log"
     Get-EventLog -LogName Application -Source "newrelic-agent-control" -Newest 100 | Format-List | Out-File -Append -FilePath "$env:USERPROFILE\Desktop\agent-control-debug.log"
     ```

  4. Contact New Relic Support with the collected logs
</Callout>

{/* ## Manage Agent Control

### Linux hosts

See the following sections on how to:

* [Start, stop, and restart Agent Control](#start-stop-restart)
* [Upgrade Agent Control](#upgrade)
* [Uninstall Agent Control](#uninstall)

### Start, stop, and restart Agent Control [#start-stop-restart]

Our agent starts automatically after you run the installation script.

For Linux, ensure you use the correct command for your init system. Select `start`, `stop`, `restart`, or `status` as appropriate.

Here's an example for Systemd:

```shell
sudo systemctl <start|stop|restart|status> newrelic-agent-control
``` */}

## Uninstall Agent Control [#uninstall]

### Kubernetes

To uninstall Agent Control from your Kubernetes cluster, run the following commands:

<Steps>
<Step>
  #### View installed releases [#list-releases]

  Run the following command to list all installed releases and identify the one for Agent Control:

  ```shell
  helm list --all-namespaces
  ```
</Step>

  <Step>
    #### Uninstall Agent Control [#uninstall-agent-control]

    - Replace `<RELEASE>` and `<NAMESPACE>` with the appropriate values for your installation and environment:

      ```shell
      helm uninstall <RELEASE> -n <NAMESPACE>
      ```

    - For example:
      ```shell
      helm uninstall agent-control-bootstrap -n newrelic
      ```

 </Step>
</Steps>

### Linux hosts

<Callout variant="important">
  The uninstall process typically leaves configuration and other miscellaneous files. Stopping the service beforehand is unnecessary. The uninstall process may take several minutes.
  Example of assets that might not be deleted as part of the uninstallation:
  * Local or remote configuration files: review and remove `/etc/newrelic-agent-control` and `/var/lib/newrelic-agent-control` folders.
  * New Relic CLI: review and remove `/usr/bin/newrelic-cli` binary.
</Callout>

<Tabs>
  <TabsBar>
    <TabsBarItem id="uninstall-debian">Debian, Ubuntu</TabsBarItem>
    <TabsBarItem id="uninstall-suse">SLES</TabsBarItem>
    <TabsBarItem id="uninstall-redhat">Amazon Linux, CentOS, Debian</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="uninstall-debian">
      Execute the following command as root:

        ```bash
        sudo apt-get remove newrelic-agent-control
        ```
    </TabsPageItem>

    <TabsPageItem id="uninstall-suse">
      Execute the following command as root:

      ```bash
      sudo zypper -n remove newrelic-infra
      ```
    </TabsPageItem>

    <TabsPageItem id="uninstall-redhat">
      Execute the following command as root:

      ```bash
      sudo yum remove newrelic-agent-control
      ```
    </TabsPageItem>
  </TabsPages>
</Tabs>

### Windows hosts

<Callout variant="important">
  The uninstall process removes the Agent Control service and executable. Configuration and other miscellaneous files may remain.
  Example of assets that might not be deleted as part of the uninstallation:
  * Configuration files: review and remove `C:\Program Files\New Relic\newrelic-agent-control` and `C:\ProgramData\New Relic\newrelic-agent-control` folders if needed.
</Callout>

To uninstall Agent Control from your Windows host:

1. Open PowerShell with Administrator privileges.

2. Navigate to the Agent Control installation directory:

   ```powershell
   cd "C:\Program Files\New Relic\newrelic-agent-control"
   ```

3. Run the uninstall script:

   ```powershell
   .\uninstall.ps1
   ```

   This script will:
   - Stop the `newrelic-agent-control` service
   - Remove the service registration
   - Delete the Agent Control executable

4. (Optional) Manually remove configuration directories if you want to completely remove all Agent Control data:

   ```powershell
   Remove-Item -Path "C:\Program Files\New Relic\newrelic-agent-control" -Recurse -Force
   Remove-Item -Path "C:\ProgramData\New Relic\newrelic-agent-control" -Recurse -Force
   ```
