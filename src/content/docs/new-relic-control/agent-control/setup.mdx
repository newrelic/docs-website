---
title: "Setup and Install Agent Control"
metaDescription: "Learn how to install and configure Agent Control on a Kubernetes cluster, Linux host, or Windows host."
freshnessValidatedDate: never
---

<Callout variant="important">
  Agent Control and New Relic Control are now **generally available** for Kubernetes! Support for Linux and Windows hosts is also in **public preview** program, pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

## Overview

Agent Control simplifies the management of your instrumentation agents. This guide will walk you through the process of installing and uninstalling Agent Control on your Kubernetes clusters, Linux hosts, or Windows hosts using different methods.

## Install Agent Control

<Callout title="tip">
For automating Agent Control setup across large-scale infrastructure, see [Set up Agent Control with Terraform](/docs/infrastructure-as-code/terraform/agent-control).
</Callout>

### Guided install
1. Log in to New Relic.
2. Ensure the correct account is selected.

<Callout title="important">
    To install Agent Control, it is mandatory to have a fleet. If you haven't yet created a fleet for this managed entity, you can create a fleet during the instalaltion in the Guided Install or complete the fleet creation process in **New Relic Control**, and then return to this guided installation step.
</Callout>

3. In Integrations & Agents, click **Install Agent Control** or search for **Agent Control**.

   <img
     title="Agent Control guided install"
     alt="Screenshot of the guided install tasks for Agent Control"
     src="/images/agent-control-guided-install.webp"
   />

4. Follow the steps to complete the installation and configuration process.

<Callout title="tip">
    To install Agent Control, it is mandatory to have a fleet. If you haven't yet created a fleet for this managed entity, you can create a fleet during the installation in the Guided Install or complete the fleet creation process in **Fleet Control**, and then return to this guided installation step.
</Callout>

5. Download the generated configuration to your computer and run the provided command in your terminal to install Agent Control. After installation, click **Continue**.
6. Test the connection to confirm the installation was successful. This step may take 5-10 minutes to complete.

<Callout variant="important" title="Windows installation notes">
  **Installation method:** Agent Control for Windows is installed using PowerShell scripts. MSI or MSIX installers are not currently available. You'll need to run the provided PowerShell installation script with Administrator privileges.

  **Fleet type requirement:** For Windows hosts, you must select or create a fleet with the **"Host - Windows"** type during the guided installation. Using a fleet with a different type (such as "Host - Linux") will cause installation or operation issues.

  **Agent version requirements:** Ensure you select compatible agent versions during installation:
  - Infrastructure Agent: version 1.71.0 or higher
  - NRDOT (OpenTelemetry Collector): version 1.5.0 or higher

  Templates and configurations from Linux environments may require adjustments for Windows compatibility.

  **Existing agents:** If you have New Relic agents already installed on your Windows host (Infrastructure Agent, APM agents, etc.), you must uninstall them before installing Agent Control. Agent Control does not support automatic migration of existing agents on Windows. After installing Agent Control, you can reinstall and manage agents through Fleet Control.
</Callout>

### Note about Authentication

New Relic Control requires the use of system identities, which are non-human identities used to authenticate and establish trust between services and applications.

During the Agent Control guided installation process, the first system identity is created using client credentials, which are included in the Helm chart's values. **The credentials for this system identity expire after 12 hours.**
When they expire, the Agent Control Helm chart deployment will fail to authenticate with the Fleet Control service, resulting in the following error:

```
Error getting system identity auth token. The API endpoint returned 400: Expired client secret.
```

In this case, the Helm chart must be updated with new system identity credentials.
```yaml
global:
  cluster: "cluster-name"
  licenseKey: "*************************"
agentControlDeployment:
  chartValues:
    systemIdentity:
      organizationId: "00000000-0000-0000-0000-000000000000"
      parentIdentity:
        clientId: "CLIENT_ID"
        clientSecret: "CLIENT_SECRET"
    config:
      fleet_control:
        fleet_id: "SAMPLE_FLEET_ID"
      agents:
        ...
```

## Verify Installation

Now that Agent Control is installed and running, you're ready to [configure and manage your agents](/docs/new-relic-control/agent-control/configuration) or deploy changes to your agents using Fleet Control](/docs/new-relic-control/fleet-control/overview).

### Kubernetes

1. Run the following commands to check the status of your pods:

  Agent Control installs subagents in a different namespace for security reasons. To verify that everything is working, check that the Agent Control pods are running in the `newrelic-agent-control` namespace and the subagent pods are running in a different namespace, such as `newrelic`.


  ```shell
  kubectl get pods -n newrelic-agent-control    # Check Agent Control pods
  kubectl get pods -n newrelic                  # Check subagent pods
  ```

2. Log in to New Relic, and go to **Fleet Control**.
3. Go to the Fleets page and select the fleet you chose during installation.
4. In the **Entities** table, confirm that your Kubernetes cluster appears in the list.
5. Verify that the instrumentation status for your cluster is **healthy**.

### Linux

* Check the status of the `newrelic-agent-control` service:

  ```bash
    sudo systemctl status newrelic-agent-control
  ```

  If the service appears in `Failed` or `Stopped` state, this means the agent got installed but there's an issue preventing its normal operation.
  Check the agent services logs using `journalctl` (or any similar Linux tool):

  ```bash
    journalctl -u newrelic-agent-control
  ```

  If no insights are available, check how to [run the agent in debug mode](/docs/new-relic-agent-control#debug) to access detailed logs to get more insight into why the service cannot be started.
* If the service is not installed, try appending `--debug` at the end of the [install command](#cli) and run it again. This will enable verbose logging for the installation script. See if the verbose output has additional context explaining the error.
* Optionally, answer `yes` when asked to send logs to New Relic to help troubleshooting the installation. Once submitted, logs can be accessed with the following NRQL query:

  ```sql
    SELECT * FROM Log WHERE hostname = `your-host-name`
  ```

### Windows

1. Check the status of the `newrelic-agent-control` service:

   Open PowerShell with Administrator privileges and run:

   ```powershell
   Get-Service -Name newrelic-agent-control
   ```

   The service should show status `Running`. If the service appears in `Stopped` state or does not exist, proceed with troubleshooting below.

2. Verify the Agent Control health endpoint:

   ```powershell
   Invoke-WebRequest -Uri "http://localhost:51200/status" -UseBasicParsing
   ```

   A healthy Agent Control should return a JSON response with `"healthy": true`.

3. Log in to New Relic, and go to **Fleet Control**.
4. Go to the Fleets page and select the fleet you chose during installation.
5. In the **Entities** table, confirm that your Windows host appears in the list.
6. Verify that the instrumentation status for your host is **healthy**.

#### Windows-specific features

**Log collection:**
Windows hosts can collect logs through the Infrastructure Agent's integrated Fluent Bit. The Infrastructure Agent package includes Fluent Bit binaries for Windows, enabling you to configure log forwarding using the `config_logging` parameter in your agent configuration. Log configurations work similarly to Linux hosts but use Windows-specific paths and formats.

**Configuration notes:**
- File paths in Windows configurations use backslashes (`\\`) and Windows-style paths (e.g., `C:\\ProgramData\\...`)
- Environment variables are set using Windows conventions
- Agent binaries use `.exe` extensions
- Configuration files are stored in `C:\Program Files\New Relic\newrelic-agent-control\` and `C:\ProgramData\New Relic\newrelic-agent-control\`

#### Troubleshooting Windows installation

If Agent Control is not running or healthy, try these troubleshooting steps:

* **Check service logs:**

  View Windows Event Log entries:

  ```powershell
  Get-EventLog -LogName Application -Source "newrelic-agent-control" -Newest 50
  ```

  Or check the log files directly:

  ```powershell
  Get-Content "C:\ProgramData\New Relic\newrelic-agent-control\logs\newrelic-agent-control.log" -Tail 50
  ```

* **Verify fleet type:** Ensure the fleet you selected during installation is of type **"Host - Windows"**. Using a fleet with a different type (like "Host - Linux") will cause Agent Control to fail. You can verify this in Fleet Control by checking the fleet details.

* **Check for port conflicts:** Agent Control uses port `51200` for its health endpoint. Ensure no other application is using this port:

  ```powershell
  netstat -ano | findstr :51200
  ```

* **Verify Administrator privileges:** The installation must be run with Administrator privileges. Right-click PowerShell and select "Run as Administrator" before running the installation script.

* **Review configuration files:** Check that the configuration files were generated correctly:

  ```powershell
  Get-Content "C:\Program Files\New Relic\newrelic-agent-control\local-data\agent-control\local_config.yaml"
  ```

* **Check for conflicting agents:** If you had New Relic agents previously installed, ensure they were completely uninstalled before installing Agent Control. Check for:
  - Infrastructure Agent service: `newrelic-infra`
  - APM agent installations in your application directories

* **Restart the service:** Try restarting the Agent Control service:

  ```powershell
  Restart-Service -Name newrelic-agent-control
  ```

  Then check the service status again and review logs for any error messages.

{/* ## Manage Agent Control

### Linux hosts

See the following sections on how to:

* [Start, stop, and restart Agent Control](#start-stop-restart)
* [Upgrade Agent Control](#upgrade)
* [Uninstall Agent Control](#uninstall)

### Start, stop, and restart Agent Control [#start-stop-restart]

Our agent starts automatically after you run the installation script.

For Linux, ensure you use the correct command for your init system. Select `start`, `stop`, `restart`, or `status` as appropriate.

Here's an example for Systemd:

```shell
sudo systemctl <start|stop|restart|status> newrelic-agent-control
``` */}

## Uninstall Agent Control [#uninstall]

### Kubernetes

To uninstall Agent Control from your Kubernetes cluster, run the following commands:

<Steps>
<Step>
  #### View installed releases [#list-releases]

  Run the following command to list all installed releases and identify the one for Agent Control:

  ```shell
  helm list --all-namespaces
  ```
</Step>

  <Step>
    #### Uninstall Agent Control [#uninstall-agent-control]

    - Replace `<RELEASE>` and `<NAMESPACE>` with the appropriate values for your installation and environment:

      ```shell
      helm uninstall <RELEASE> -n <NAMESPACE>
      ```

    - For example:
      ```shell
      helm uninstall agent-control-bootstrap -n newrelic
      ```

 </Step>
</Steps>

### Linux hosts

<Callout variant="important">
  The uninstall process typically leaves configuration and other miscellaneous files. Stopping the service beforehand is unnecessary. The uninstall process may take several minutes.
  Example of assets that might not be deleted as part of the uninstallation:
  * Local or remote configuration files: review and remove `/etc/newrelic-agent-control` and `/var/lib/newrelic-agent-control` folders.
  * New Relic CLI: review and remove `/usr/bin/newrelic-cli` binary.
</Callout>

<Tabs>
  <TabsBar>
    <TabsBarItem id="uninstall-debian">Debian, Ubuntu</TabsBarItem>
    <TabsBarItem id="uninstall-suse">SLES</TabsBarItem>
    <TabsBarItem id="uninstall-redhat">Amazon Linux, CentOS, Debian</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="uninstall-debian">
      Execute the following command as root:

        ```bash
        sudo apt-get remove newrelic-agent-control
        ```
    </TabsPageItem>

    <TabsPageItem id="uninstall-suse">
      Execute the following command as root:

      ```bash
      sudo zypper -n remove newrelic-infra
      ```
    </TabsPageItem>

    <TabsPageItem id="uninstall-redhat">
      Execute the following command as root:

      ```bash
      sudo yum remove newrelic-agent-control
      ```
    </TabsPageItem>
  </TabsPages>
</Tabs>

### Windows hosts

<Callout variant="important">
  The uninstall process removes the Agent Control service and executable. Configuration and other miscellaneous files may remain.
  Example of assets that might not be deleted as part of the uninstallation:
  * Configuration files: review and remove `C:\Program Files\New Relic\newrelic-agent-control` and `C:\ProgramData\New Relic\newrelic-agent-control` folders if needed.
</Callout>

To uninstall Agent Control from your Windows host:

1. Open PowerShell with Administrator privileges.

2. Navigate to the Agent Control installation directory:

   ```powershell
   cd "C:\Program Files\New Relic\newrelic-agent-control"
   ```

3. Run the uninstall script:

   ```powershell
   .\uninstall.ps1
   ```

   This script will:
   - Stop the `newrelic-agent-control` service
   - Remove the service registration
   - Delete the Agent Control executable

4. (Optional) Manually remove configuration directories if you want to completely remove all Agent Control data:

   ```powershell
   Remove-Item -Path "C:\Program Files\New Relic\newrelic-agent-control" -Recurse -Force
   Remove-Item -Path "C:\ProgramData\New Relic\newrelic-agent-control" -Recurse -Force
   ```
