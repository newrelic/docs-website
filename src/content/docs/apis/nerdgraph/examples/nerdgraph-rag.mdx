---
title: "NerdGraph tutorial: Configure RAG tools and documents"
metaDescription: Enhance New Relic AI with RAG (Retrieval Augmented Generation)
redirects:
  - /docs/agentic-ai/knowledge-integration/apis-and-communication-protocol
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

With New Relic, you can enhance New Relic AI agents with Retrieval Augmented Generation (RAG) by associating your documentation, runbooks, incident retros, and even source code with your services. This process gives New Relic AI better insight into issues with your system. The tutorial outlines how to obtain your organization ID, create a RAG tool, and add your documents to the platform using the Blob API.

After adding your documents, you will create a relationship to associate them with the RAG tool. You can then verify your configuration by querying the relationships between the RAG documents and the RAG tool. The final step is to query the RAG tool itself to retrieve relevant, indexed information.

To learn more about the knowledge connector, refer to [New Relic AI Knowledge connector](/docs/agentic-ai/knowledge-integration/overview).

To start indexing your content and benefit from the knowledge connector with New Relic AI, follow these mentioned steps:

<Steps>
<Step>

<Collapser id ="get-started" title ="Obtain your organization ID">

Organization ID uniquely identifies your account and ensures that any RAG tool you create, documents you upload, or relationships you establish are associated with your organization in New Relic. 

Organization ID is required to perform mutations and queries in NerdGraph when setting up and managing RAG tools and documents. Run the following query and keep the organization ID handy for later steps.

```graphql
{
  actor {
    organization {
      id
    }
  }
}
```
</Collapser>
</Step>

<Step>
<Collapser id = "create-rag-tool" title = "Create a RAG tool">

Before performing this step, ensure you have "Org Product Admin" permissions.

A RAG tool can be thought of as a specialized container or folder within New Relic that helps organize and manage related documents and resources. This makes it easier for the LLM to access the right information when needed. A clear name and accurate description guide the LLM in selecting the right RAG tool for each prompt, which ensures it provides relevant and context-aware responses.

To create a new RAG tool in your New Relic account, you'll use the `entityManagementCreateRagTool` mutation:

1. Make sure to replace `${ORGANIZATION_ID}` with your actual organization ID obtained in the previous step.
2. Run the below mutation.
3. If successful, you'll receive an `id` for your RAG tool. Save this `id` for later steps when associating documents.

```graphql
mutation {
  entityManagementCreateRagTool(
    ragToolEntity: {
      description: "Runbooks for resolving incidents with APIs",
      name: "API Runbooks",
      scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}
    }
  ) {
    entity {
      id
    }
  }
}
```
</Collapser>
</Step>

<Step>
<Collapser id = "upload-document" title = "Upload a document to the Blob API">

<Callout variant="important">
  All indexed documents are visible to all users within your organization. Make sure the documents you index comply with your internal policies, and do not upload sensitive or private data.
</Callout>

### The Blob API and its purpose
The Blob API is a New Relic service designed for uploading files, such as documentation and runbooks, to your account. NerdGraph is optimized for structured data queries and mutations and not for efficient transfer of files, so the Blob API is required for uploading documents.

### Authentication requirements
You need a valid New Relic API key with permissions to upload documents. To get the API key for uploading a document to New Relic using the Blob API:

1. Log in to your [New Relic](https://one.newrelic.com/) account.
2. Create and manage your API keys from the [API keys UI page](https://one.newrelic.com/administration/api-keys).
3. Click **Create a key**, and fill the required details (or use an existing one with the required permissions).
4. Click **Create a key** and copy the generated key (it'll look like NRAK-XXXXXXXXXX).

### Required headers and payload

- `Api-Key`: Your New Relic API key for authentication.
- `NewRelic-Entity`: Metadata about the document, such as its name.
- `Content-Type`: The format of the file being uploaded (for example, `application/json`).
- The payload (`@incidents.json`) should be the file you want to upload. Ensure it contains relevant content and follows your organization’s standards.

Here's an example of how to upload a document using a `curl` `bash` command:

```shell
curl -X POST https://blob-api.one-service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
     -H 'Api-Key: NRAK-XXXXXXXXXX' \
     -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
     -H 'Content-Type: application/json' \
     -d @incidents.json
```

The response will look like this:

```json
{
  "entityGuid": "MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk",
  "blobVersionEntity": null
}
```
### Next steps

After uploading, save the `entityGuid` that you receive in the response. You can use this GUID to create a relationship between the document and your RAG tool in the next step or query the document in NerdGraph to view it.

  </Collapser>
  </Step>

<Step>
<Collapser id = "view-the-rag-document-entity-represented-in-nerdgraph" title = "View the RAG document entity represented in NerdGraph"> 

After uploading your document, you can verify it was successfully indexed by querying its entity in NerdGraph. In the query below, replace the `${RAG_DOCUMENT_GUID}` placeholder with the `entityGuid` you received in the previous step.

This query will return details about your RAG document, including its name, type, and a URL to access the uploaded file.

```graphql
{
  actor {
    entityManagement {
      entity(
        id: `${RAG_DOCUMENT_GUID}`
      ) {
        ... on EntityManagementRagDocumentEntity {
          id
          name
          blob {
            url
          }
          type
        }
      }
    }
  }
}
```
</Collapser>
</Step>

<Step>
<Collapser id = "create-a-relationship-between-the-rag-document-and-the-rag-tool" title = "Create a relationship between the RAG document and the RAG tool">
Now that you have uploaded your document and created a RAG tool, you need to associate them so New Relic AI can use your indexed content for context-aware responses.

This relationship links your RAG document to the RAG tool, making the document searchable and usable by the AI. You’ll use the `entityManagementCreateRelationship` mutation in NerdGraph to do this.

### How to create the relationship

1. Replace `${RAG_DOCUMENT_GUID}` with the GUID of your uploaded document (the `entityGuid` you received after uploading your document in step 3).
2. Replace `${RAG_TOOL_GUID}` with the GUID of your RAG tool (the `id` you received after creating your RAG tool in step 2).
3. Run the following mutation:

```graphql
mutation {
  entityManagementCreateRelationship(
    relationship: {
      source: {
        scope: ORGANIZATION,
        id: `${RAG_DOCUMENT_GUID}`
      },
      target: {
        scope: ORGANIZATION,
        id: `${RAG_TOOL_GUID}`
      },
      type: "INDEXED_FOR"
    }
  ) {
    relationship {
      type
      target {
        id
        type
      }
      source {
        id
        type
      }
    }
  }
}
```
</Collapser>
</Step>

<Step>
<Collapser id="query-to-see-relationships-between-rag-documents-and-rag-tools" title="Query to see relationships between RAG documents and RAG tools">

After creating a relationship between your RAG document and RAG tool, you can verify the association by querying relationships in NerdGraph. This helps ensure your document is properly linked and available for New Relic AI to use.

- Replace `${RAG_DOCUMENT_ID}` with the `entityGuid` of your uploaded document.

```graphql
{
  actor {
    entityManagement {
      relationships(
        filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
      ) {
        items {
          type
          target {
            id
            type
          }
        }
      }
    }
  }
}
```
</Collapser>
</Step>

<Step>
<Collapser id="query-the-rag-tool" title="Query the RAG tool">

After you've set up your RAG tool and indexed documents, you can query the RAG tool to retrieve relevant information based on your prompt. This allows New Relic AI to surface context-aware answers using your organization's documentation.

Use the following query in NerdGraph, replacing `${RAG_TOOL_GUID}` with the GUID of your RAG tool (`id` in the response after you run the `entityManagementCreateRagTool` mutation). The response will include chunked matches from your indexed documents, which you can use directly or summarize with New Relic AI.

```graphql
{
  actor {
    machineLearning {
      ragQueryData(
        prompt: "tell me about the incident", 
        toolId: `${RAG_TOOL_GUID}`
      ) {
        blobId
        chunk
        documentId
        score
        toolId
      }
    }
  }
}
```
</Collapser>
</Step>
</Steps>