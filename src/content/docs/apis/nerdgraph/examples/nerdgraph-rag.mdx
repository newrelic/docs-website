---
title: "NerdGraph tutorial: Configure RAG Tools and Documents"
metaDescription: Enhance New Relic AI with RAG (Retrieval Augmented Generation)
redirects:
  - /docs/agentic-ai/knowledge-integration/apis-and-communication-protocol
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

With New Relic, you can enhance New Relic AI agents with RAG. This means that you can associate documentation, runbooks, incident retros, and even source code with your services, giving New Relic AI better insight into issues with your system.

To learn more about the knowledge connector, refer to [New Relic AI Knowledge connector](/docs/agentic-ai/knowledge-integration/overview).

## Get started with RAG [#get-started]

<Collapser id ="get-org-id" title ="Obtain your organization ID">

Before you begin, you'll need your organization ID to use with the following mutations and queries.

```graphql
{
  actor {
    organization {
      id
    }
  }
}
```
</Collapser>
## Configure your RAG tool
<CollapserGroup>
<Collapser id = "create-rag-tool" title = "Create a RAG tool">

The name and description of your RAG tool help the LLM understand when and how to use it. Provide a clear name and accurate description so that the LLM is more likely to select the right tool for a given prompt and provide relevant, context-aware responses.

```graphql
mutation {
  entityManagementCreateRagTool(
    ragToolEntity: {
      description: "Runbooks for resolving incidents with APIs",
      name: "API Runbooks",
      scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}
    }
  ) {
    entity {
      id
    }
  }
}
```
</Collapser>
<Collapser id = "upload-document" title = "Upload a document to the Blob API">

<Callout variant="important">
  All indexed documents are visible to all users within your organization. Make sure the documents you index comply with your internal policies for use of the services.
</Callout>

NerdGraph is optimized for structured data queries and mutations and not for the efficient transfer of files. In order to upload documents, you will use the Blob API.

Here's an example of how to upload a document using a `curl` `bash` command:

```shell
curl -X POST https://blob-api.one-service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
     -H 'Api-Key: NRAK-XXXXXXXXXX' \
     -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
     -H 'Content-Type: application/json' \
     -d @incidents.json
```

The response will look like this:

```json
{
  "entityGuid": "MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk",
  "blobVersionEntity": null
}
```
</Collapser>
<Collapser id = "view-the-rag-document-entity-represented-in-nerdgraph" title = "View the RAG document entity represented in NerdGraph"> 

You can view the RAG document entity in NerdGraph.

```graphql
{
  actor {
    entityManagement {
      entity(
        id: `${RAG_DOCUMENT_GUID}`
      ) {
        ... on EntityManagementRagDocumentEntity {
          id
          name
          blob {
            url
          }
          type
        }
      }
    }
  }
}
```
</Collapser>
<Collapser id = "create-a-relationship-between-the-rag-document-and-the-rag-tool" title = "Create a relationship between the RAG document and the RAG tool">
Now that you have a RAG tool and a RAG document, you need to associate them with each other. This is done via the Entity Management APIs in NerdGraph.

```graphql
mutation {
  entityManagementCreateRelationship(
    relationship: {
      source: {
        scope: ORGANIZATION,
        id: `${RAG_DOCUMENT_GUID}`
      },
      target: {
        scope: ORGANIZATION,
        id: `${RAG_TOOL_GUID}`
      },
      type: "INDEXED_FOR"
    }
  ) {
    relationship {
      type
      target {
        id
        type
      }
      source {
        id
        type
      }
    }
  }
}
```
</Collapser>
</CollapserGroup>

## Verify your configuration

<CollapserGroup>
<Collapser id="query-to-see-relationships-between-rag-documents-and-rag-tools" title="Query to see relationships between RAG documents and RAG tools">

You can query relationships between RAG documents and RAG tools.

```graphql
{
  actor {
    entityManagement {
      relationships(
        filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
      ) {
        items {
          type
          target {
            id
            type
          }
        }
      }
    }
  }
}
```
</Collapser>
<Collapser id="query-the-rag-tool" title="Query the RAG tool">

You can query your RAG tool and receive chunked matches based on the documents indexed for a given tool. You may use New Relic AI to summarize the returned chunk matches, or you may use the NerdGraph APIs to retrieve the match and use your own AI on your own systems.

```graphql
{
  actor {
    machineLearning {
      ragQueryData(
        prompt: "tell me about the incident", 
        toolId: `${RAG_TOOL_GUID}`
      ) {
        blobId
        chunk
        documentId
        score
        toolId
      }
    }
  }
}
```
</Collapser>
</CollapserGroup>