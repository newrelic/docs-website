---
title: "NerdGraph tutorial: Configure RAG Tools and Documents"
tags:
  - NerdGraph
  - RAG
  - NRAI
  - Agentic AI
metaDescription: Enhance NRAI with RAG (Retrieval Augmented Generation)
redirects:
  - /docs/apis/nerdgraph/examples
  - /docs/agentic-ai/knowledge-integration/apis-and-communication-protocol
freshnessValidatedDate: never
---

With New Relic, you can enhance NRAI agents with RAG. This means that you can associate documentation, runbooks, incident retros and even source code with your services, giving NRAI better insight into issues with your system or even provide suggested changes (coming soon!).

## Get Started with RAG [#get-started]

### Obtain your organization ID [#get-org-id]
```
{
  actor {
    organization {
      id
    }
  }
}
```

### Create a RAG Tool [#create-rag-tool]

It should be noted - the name and description of your RAG Tool are extremely important! The LLM will choose to leveerage a tool when responding to a prompt based on the accuracy of a tool's name and description.

```
mutation {
  entityManagementCreateRagTool(
    ragToolEntity: {
      description: "Runbooks for resolving incidents with APIs",
      name: "API Runbooks",
      scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}}
  ) {
    entity {
      id
    }
  }
}
```

### Upload a document to the Blob API [#upload-document]

* Note that this specific step is not through NerdGraph. This is because NerdGraph does yet support file uploads through it's APIs.

```
curl -X POST https://blob-api.staging-service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
    -H 'Api-Key: NRAK-XXXXXXXXXX' \
    -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
    -H 'Content-Type: application/json' \
    -d @incidents.json
```

The response will look like this:

```
{"entityGuid":"MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk","blobVersionEntity":null}
```

### View the RAG Document entity represented in NerdGraph

```
{
  actor {
    entityManagement {
      entity(
        id: `${RAG_DOCUMENT_GUID}`
      ) {
        ... on EntityManagementRagDocumentEntity {
          id
          name
          blob {
            url
          }
          type
        }
      }
    }
  }
}
```

Now that we have a RAG Tool and a RAG Document, we need to associate them with each other. This is done via the Entity Management APIs in NerdGraph.

### Create a relationship between the RAG Document and the RAG Tool

```
mutation {
  entityManagementCreateRelationship(
    relationship: {
      source: {
        scope: ORGANIZATION,
        id: `${RAG_DOCUMENT_GUID}`
      },
      target: {
        scope: ORGANIZATION,
        id: `${RAG_TOOL_GUID}`
      },
      type: "INDEXED_FOR"}
  ) {
    relationship {
      type
      target {
        id
        type
      }
      source {
        id
        type
      }
    }
  }
}
```

### Query to see relationships between RAG Documents and RAG Tools

```
{
  actor {
    entityManagement {
      relationships(
        filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
      ) {
        items {
          type
          target {
            id
            type
          }
        }
      }
    }
  }
}
```

### Query the RAG Tool

You can query your RAG Tool and receive chunked matches based on the documents indexed for a given tool. While these chunks may not be useful to humans, LLMs can summarize this content and create meaningful conclusions. You may rely on NRAI to do this for you or bring your own LLM to use against the New Relic RAG Platform.

```
{
  actor {
    machineLearning {
      ragQueryData(prompt: "tell me about the incident", toolId: `${RAG_TOOL_GUID}`) {
        blobId
        chunk
        documentId
        score
        toolId
      }
    }
  }
}
```