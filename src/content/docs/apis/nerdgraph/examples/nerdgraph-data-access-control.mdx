---
title: "NerdGraph tutorial: Manage data access policies"
tags:
  - Manage data access policies via NerdGraph
  - Manage data access policies via API
metaDescription: "Use New Relic NerdGraph to create, update, and manage data access policies for controlling access to log partitions."
freshnessValidatedDate: never
---

You can use our [NerdGraph API](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/) to create, query, update, and delete data access policies. Data access policies control which [log partitions](/docs/logs/ui-data/data-partitions/) your users can access, allowing you to restrict access to sensitive log data based on user groups.

## Requirements [#requirements]

To manage data access policies via NerdGraph, you need:

* A [Pro or Enterprise](https://newrelic.com/pricing) edition New Relic account
* [Authentication domain manager](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#admin-settings) role
* User type of [core user or full platform user](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type)
* A [user key](/docs/apis/intro-apis/new-relic-api-keys/#user-key) for authentication.

## Before you begin [#before-you-begin]

Before using the NerdGraph API for data access policies, understand how [data access control](/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control) works, and familiarize yourself with [NerdGraph](https://api.newrelic.com/graphiql).

## Common attributes [#attributes]

The following attributes are commonly used in data access policy queries and mutations:

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Attribute
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>
      <td>
        The ID of the organization associated with the policy. Used to filter policies or scope policy creation.
      </td>
    </tr>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the policy. Required when updating or deleting a specific policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        A user-friendly name for the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        The JSON object that defines the policy's rules. It includes:
        * `rules`: An array of rule objects.
        * `operations`: The operations to allow or deny (e.g., `SELECT`, `*`).
        * `eventTypes`: An object specifying which event types to `allow` (e.g., `["*"]`) or `except` (e.g., `["Log_accessible"]`).
      </td>
    </tr>
    <tr>
      <td>
        `accountId`
      </td>
      <td>
        The account ID the role grants access to.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicyId`
      </td>
      <td>
        The data access policy ID that defines what data in an account is allowed.
      </td>
    </tr>
    <tr>
      <td>
        `roleId`
      </td>
      <td>
        The role ID that defines the access level.
      </td>
    </tr>
  </tbody>
</table>


## Common operations [#operations]

Here are the most common operations for managing data access policies:

<CollapserGroup>

<Collapser
  id="query-grants"
  title="Query data access policies associated with access grants"
>

This query retrieves all access grants in your organization and their associated data access policies. Use this to get which policies are currently assigned to grants.

### Sample query

```graphql
{
  customerAdministration {
    grants(filter: {organizationId: {eq: "YOUR_ORG_ID"}}) {
      items {
        dataAccessPolicy {
          id
          name
        }
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>
      <td>
        **Required.** The organization ID the grants belong to. Use the equals (`eq`) operator to filter.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "customerAdministration": {
      "grants": {
        "items": [
          {
            "dataAccessPolicy": {
              "id": "DATA_ACCESS_POLICY_ID",
              "name": "DATA_ACCESS_POLICY_NAME"
            }
          }
        ]
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `items`
      </td>
      <td>
        List of grants in the organization.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicy`
      </td>
      <td>
        The data access policy associated with each grant.
      </td>
    </tr>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        The name of the data access policy.
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="query-policies"
  title="Query data access policies for an organization"
>

This query retrieves all data access policies in your organization.

### Sample query

```graphql
{
  customerAdministration {
    dataAccessPolicies(
      filter: {organizationId: {eq: "YOUR_ORG_ID"}}
    ) {
      items {
        id
        name
        policy
        status
        version
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>
      <td>
        **Required.** The organization ID the policies belong to. Use the equals (`eq`) operator to filter.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "customerAdministration": {
      "dataAccessPolicies": {
        "items": [
          {
            "id": "ddadbdd2-183b-42d9-8a1a-41ec7692fb4c",
            "name": "Log Operations",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_Operations"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID",
            "version": "1.0-logs"
          },
          {
            "id": "bb8efcf5-3127-4a4d-b25f-114505a0a68d",
            "name": "Restrict Log_Security",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_Sec%"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID",
            "version": "1.0-logs"
          }
        ]
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `items`
      </td>
      <td>
        List of data access policies in the organization.
      </td>
    </tr>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        The name of the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        The JSON object containing the policy rules with `operations` and `eventTypes`.
      </td>
    </tr>
    <tr>
      <td>
        `status`
      </td>
      <td>
        The current status of the policy (e.g., `VALID`).
      </td>
    </tr>
    <tr>
      <td>
        `version`
      </td>
      <td>
        The policy version (currently `1.0-logs`).
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="create-policy"
  title="Create a data access policy"
>

This mutation creates a new data access policy to control access to log partitions.

### Sample mutation

```graphql
mutation createMyPolicy {
  dataAccessPolicyCreate(
    policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_accessible"]}}]}
    name: "Test"
    organizationId: "YOUR_ORG_ID"
  ) {
    dataAccessPolicy {
      id
    }
  }
}
```

You can also use following variables:

```graphql
mutation createMyPolicy($policy: DataAccessPolicyRawDocument!) {
  dataAccessPolicyCreate(
    policy: $policy
    name: "Test"
    organizationId: "YOUR_ORG_ID"
  ) {
    dataAccessPolicy {
      id
    }
  }
}
```

```json
{
  "policy": {
    "rules": [
      {"operations": ["SELECT"], "eventTypes": {"allow": ["*"], "except": []}}
    ]
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>
      <td>
        **Required.** Your New Relic organization ID.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        **Required.** A descriptive name for the policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        **Required.** The JSON object defining the policy rules with `operations` and `eventTypes`.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "dataAccessPolicyCreate": {
      "dataAccessPolicy": {
        "id": "YOUR_DATA_POLICY_ID",
        "name": "Test",
        "policy": {
          "rules": [
            {
              "eventTypes": {
                "allow": [
                  "*"
                ],
                "except": [
                  "Log"
                ]
              },
              "operations": [
                "*"
              ]
            }
          ]
        },
        "status": "VALID"
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the newly created data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        The name of the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        The JSON object containing the policy rules with `operations` and `eventTypes`.
      </td>
    </tr>
    <tr>
      <td>
        `status`
      </td>
      <td>
        The status of the policy (e.g., `VALID`).
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="update-policy"
  title="Update a data access policy"
>

This mutation updates an existing data access policy to modify its rules or name.

### Sample mutation

```graphql
mutation {
  dataAccessPolicyUpdate(
    policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_inaccessible"]}}]}
    name: "Test"
    id: "YOUR_DATA_POLICY_ID"
  ) {
    dataAccessPolicy {
      name
      id
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `id`
      </td>
      <td>
        **Required.** The ID of the policy to update.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        **Optional.** Updated name for the policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        **Optional.** The JSON object defining the updated policy rules with `operations` and `eventTypes`.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "dataAccessPolicyUpdate": {
      "dataAccessPolicy": {
        "assigned": "UNASSIGNED",
        "id": "YOUR_DATA_POLICY_ID",
        "name": "Test",
        "policy": {
          "rules": [
            {
              "eventTypes": {
                "allow": [
                  "*"
                ],
                "except": [
                  "Log_inaccessible"
                ]
              },
              "operations": [
                "SELECT"
              ]
            }
          ]
        },
        "status": "VALID"
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `assigned`
      </td>
      <td>
        Indicates if the policy is assigned to any grants (e.g., `UNASSIGNED`).
      </td>
    </tr>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the updated data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        The name of the data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        The JSON object containing the updated policy rules with `operations` and `eventTypes`.
      </td>
    </tr>
    <tr>
      <td>
        `status`
      </td>
      <td>
        The status of the policy (e.g., `VALID`).
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="delete-policy"
  title="Delete a data access policy"
>

This mutation deletes an existing data access policy.

<Callout variant="important">
Deleting a policy removes it from all assigned grants. Users in groups with those grants will lose the data access restrictions defined by the policy.
</Callout>

### Sample mutation

```graphql
mutation {
  dataAccessPolicyDelete(id: "YOUR_DATA_POLICY_ID") {
    dataAccessPolicy {
      name
      id
      policy
      status
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `id`
      </td>
      <td>
        **Required.** The ID of the policy to delete.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "dataAccessPolicyDelete": {
      "dataAccessPolicy": {
        "id": "YOUR_DATA_POLICY_ID",
        "name": "Test",
        "policy": {
          "rules": [
            {
              "eventTypes": {
                "allow": [
                  "*"
                ],
                "except": [
                  "Log_inaccessible"
                ]
              },
              "operations": [
                "SELECT"
              ]
            }
          ]
        },
        "status": "VALID"
      }
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The unique identifier of the deleted data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `name`
      </td>
      <td>
        The name of the deleted data access policy.
      </td>
    </tr>
    <tr>
      <td>
        `policy`
      </td>
      <td>
        The JSON object containing the policy rules that were deleted.
      </td>
    </tr>
    <tr>
      <td>
        `status`
      </td>
      <td>
        The status of the policy (e.g., `VALID`).
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="grant-access"
  title="Create an access grant with a data access policy"
>

This mutation creates a new access grant that includes a data access policy, assigning it to a specific account and role.

### Sample mutation

```graphql
mutation {
  authorizationManagementGrantAccess(
    grantAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
  ) {
    accessGrants {
      id
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `accountId`
      </td>
      <td>
        **Required.** The account ID to grant access to.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicyId`
      </td>
      <td>
        **Required.** The data access policy ID to apply.
      </td>
    </tr>
    <tr>
      <td>
        `roleId`
      </td>
      <td>
        **Required.** The role ID defining permissions.
      </td>
    </tr>
  </tbody>
</table>

### Response

The response shows the newly created access grant with its ID.

</Collapser>

<Collapser
  id="update-grant"
  title="Update an access grant with a data access policy"
>

This mutation updates an existing access grant to add or change the data access policy.

### Sample mutation

```graphql
mutation {
  authorizationManagementUpdateAccess(
    updateAccessOptions: {accountAccessGrant: {dataAccessPolicyId: "YOUR_DATA_POLICY_ID"}, ids: YOUR_GRANT_ID}
  ) {
    grants {
      dataAccessPolicy {
        id
      }
      id
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `ids`
      </td>
      <td>
        **Required.** The grant ID to update.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicyId`
      </td>
      <td>
        **Required.** The data access policy ID to apply to the grant.
      </td>
    </tr>
  </tbody>
</table>

### Sample response

```json
{
  "data": {
    "authorizationManagementUpdateAccess": {
      "grants": [
        {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID"
          },
          "id": "YOUR_GRANT_ID"
        }
      ]
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Response field
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `grants`
      </td>
      <td>
        List of updated grants.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicy.id`
      </td>
      <td>
        The ID of the data access policy now assigned to the grant.
      </td>
    </tr>
    <tr>
      <td>
        `id`
      </td>
      <td>
        The ID of the updated grant.
      </td>
    </tr>
  </tbody>
</table>

</Collapser>

<Collapser
  id="revoke-grant"
  title="Revoke an access grant with a data access policy"
>

This mutation removes an access grant that includes a data access policy.

### Sample mutation

```graphql
mutation {
  authorizationManagementRevokeAccess(
    revokeAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
  ) {
    accessGrants {
      id
    }
  }
}
```

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Parameter
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        `accountId`
      </td>
      <td>
        **Required.** The account ID of the grant to revoke.
      </td>
    </tr>
    <tr>
      <td>
        `dataAccessPolicyId`
      </td>
      <td>
        **Required.** The data access policy ID of the grant to revoke.
      </td>
    </tr>
    <tr>
      <td>
        `roleId`
      </td>
      <td>
        **Required.** The role ID of the grant to revoke.
      </td>
    </tr>
  </tbody>
</table>

### Response

The response shows the revoked access grant with its ID.

</Collapser>


</CollapserGroup>


## Related topics [#related-topics]

<DocTiles>
  <DocTile title="Data access control UI guide" path="/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control">Learn how to manage data access policies through the New Relic UI.</DocTile>
  <DocTile title="User management concepts" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">Understand user types, roles, and access management.</DocTile>
  <DocTile title="Manage users with NerdGraph" path="/docs/apis/nerdgraph/examples/nerdgraph-manage-users">Use the NerdGraph API to programmatically manage users and access grants.</DocTile>
  <DocTile title="Log partitions" path="/docs/logs/ui-data/data-partitions/">Learn how to organize your log data into partitions.</DocTile>
</DocTiles>
