---
title: 'PHP agent installation: Non-standard PHP (advanced)'
tags:
  - Agents
  - PHP agent
  - Advanced installation
metaDescription: 'Non-standard PHP installations: To install your PHP agent with the newrelic-install script, or to install manually, start here.'
redirects:
  - /docs/php/php-agent-installation-non-standard-php
  - /docs/agents/php-agent/installation/php-agent-installation-non-standard-php
  - /docs/agents/php-agent/installation/php-agent-installation-non-standard-php-advanced
---

If you are using a non-standard PHP installation, follow this procedure to properly install New Relic. This is common in instances where the default installer does not find your PHP installation (for example, if you have self-compiled PHP or a self-contained PHP stack).

<Callout variant="important">
  As part of the installation process, change the default [application name](/docs/site/naming-your-application) to a meaningful name.
</Callout>

## Requirements [#prep]

Use the command line version of PHP (`php -i`) or look at the output of `phpinfo()` to determine:

* The PHP extension version (`20090626`, `20100525`, `20121212`, `20131226`, `20151012`, or `20160303`)
* The extension or module installation directory
* Whether or not your version of PHP has been compiled with ZTS (Zend Thread Safety) support

## Using the command line newrelic-install script (recommended) [#script]

1. Point New Relic at the right directory by using any of these options:

   <CollapserGroup>
     <Collapser
       id="add-php-to-path"
       title={<>Add your PHP location to your <InlineCode>PATH</InlineCode></>}
     >
       The install script needs to be able to find your command line `php` or `php-config`. You can add the directory that contains those programs to your current `PATH`.
     </Collapser>

     <Collapser
       id="nr-install-path"
       title={<>Set the <InlineCode>NR_INSTALL_PATH</InlineCode> variable.</>}
     >
       This can be a colon-separated list of directories in which to look for PHP installations in addition to those in your PATH. These directories should contain `php` or `php-config`. For example:

       ```
       NR_INSTALL_PATH=<var>/u/php/5.3/bin</var>; export NR_INSTALL_PATH
       newrelic-install
       ```
     </Collapser>

     <Collapser
       id="nr-install-phplist"
       title={<>Set the <InlineCode>NR_INSTALL_PHPLIST</InlineCode> variable</>}
     >
       Optional: Use a colon-separated list to set the exact locations (directories) in which to search. This option will ignore `PATH` and `NR_INSTALL_PATH`. For example:

       ```
       NR_INSTALL_PHPLIST=<var>/usr/local/bin:u/php/5.3/bin</var>; export NR_INSTALL_PHPLIST
       newrelic-install
       ```
     </Collapser>
   </CollapserGroup>
2. Invoke the `newrelic-install` script from its directory. Depending on your server and your paths, the install script may find other versions of PHP on your system. Select your specific version from the list.

For more information, see [PHP install script](/docs/agents/php-agent/installation/newrelic-install-script). Or, to resume your installation instructions, see [New Relic for PHP](/docs/agents/php-agent/getting-started/new-relic-php).

## Installing New Relic manually [#manual]

If you do not want to use the install script, you can perform a fully manual installation. You will need to gather information about your PHP installation, as described above, and create and link or copy the files into place manually.

You can review and obtain the appropriate values from your `phpinfo()` yourself.

### Obtaining installation parameters from `phpinfo()`

If this process doesn't work for you, you can obtain the correct information from your `phpinfo()` and pass the appropriate settings to your system as environment variables.

  <table>
    <thead>
      <tr>
        <th width={125}>
          `phpinfo()`
        </th>

        <th>
          Notes
        </th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td>
          `PHPAPI`
        </td>

        <td>
          This is labeled `PHP Extension` in the `phpinfo()` header.
        </td>
      </tr>

      <tr>
        <td>
          `ARCH`
        </td>

        <td>
          This can be determined by executing `file /path/to/php`.

          * If you see a reference to `ELF-32`, then the `ARCH` is `x86`.
          * If you see a reference to `ELF-64`, then the `ARCH` is `x64`.
        </td>
      </tr>

      <tr>
        <td>
          `MODULEDIR`
        </td>

        <td>
          This is labeled `extension_dir` in the PHP Core section.
        </td>
      </tr>

      <tr>
        <td>
          `PHPZTS`
        </td>

        <td>
          To determine whether ZTS is compiled in, look for the `Thread Safety` setting at the top of the `phpinfo()` output.

          * If this is **disabled**, then `PHPZTS` is empty.
          * If this is **enabled**, then `PHPZTS` is the string `-zts`, which includes a leading hyphen as noted.
        </td>
      </tr>

      <tr>
        <td>
          `NRBASEDIR`
        </td>

        <td>
          This is the base directory of the New Relic agent installation directory (`/usr/lib/newrelic-php5` or the directory in which you extracted the tar file for tarball installations).
        </td>
      </tr>
    </tbody>
  </table>

  Use this information to execute the following commands to install the PHP module. Be sure to adjust the example's values to your actual settings.

  ```
  NRBASEDIR=<var>/usr/lib/newrelic-php5</var>; export NRBASEDIR
      MODULEDIR=<var>/usr/lib/php/modules</var>; export MODULEDIR
      ARCH=<var>x64</var>; export ARCH
      PHPAPI=<var>20090626</var>; export PHPAPI
      PHPZTS="<var>-zts</var>"; export PHPZTS
      rm -f $MODULEDIR/newrelic.so
      ln -s $NRBASEDIR/agent/$ARCH/newrelic-${PHPAPI}${PHPZTS}.so \
        $MODULEDIR/newrelic.so
  ```

  The next step is configuration.

  1. Copy the `$NRBASEDIR/scripts/newrelic.ini.template` to the directory from where your PHP installation reads additional config files and rename it `newrelic.ini`.

      To determine the destination, look at your `phpinfo()` output for the item, called **Scan this dir for additional .ini files**. If the directory listed is `(none)`, add settings from this file to your listed php config files (usually `php.ini`).
  2. Replace the license key setting in your `newrelic.ini` file with your license key. Also change any other sessions as needed (for example, `newrelic.appname`).
  3. Copy `$NRBASEDIR/daemon/newrelic-daemon.$architecture` to `/usr/bin/newrelic-daemon`.

    Depending on your system, <var>$architecture</var> will be either x86 or x64.
  4. Restart your dispatcher/webs erver.
  5. Verify that your site is functioning properly. If it is not, remove `newrelic.ini` or the `newrelic.so` you created, and restart your dispatcher/web server again to restore old operation.
  6. Examine your web server/dispatcher (**not** newrelic) logfiles to help determine the issue. If you still need assistance, get support at [support.newrelic.com](https://support.newrelic.com).

  Check that the agent is installed after the restart, by investigating the `phpinfo()` page for a `newrelic` section. If it appears the agent was successfully installed, check your system to verify that two `newrelic-daemon` processes are running:

  * For RedHat based systems:

    ```
    ps -aef | grep newrelic-daemon
    ```
  * For Debian based systems:

    ```
    ps aux | grep newrelic-daemon
    ```

Wait for 3 to 5 minutes for results to arrive in your [APM **Summary** page](/docs/applications-menu/applications-overview).

## For more help

If you need more help, check out these support and learning resources:

* Suggest a change and learn how to [contribute](https://github.com/newrelic/newrelic-php-agent/issues) to our PHP agent open source repository.
* Browse the [Explorers Hub](https://discuss.newrelic.com/) to get help from the community and join in discussions.
* Find [answers on our sites and learn how to use our support portal](https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/get-started/find-help-use-support-portal/).
* Run [New Relic Diagnostics](https://docs.newrelic.com/docs/using-new-relic/cross-product-functions/troubleshooting/new-relic-diagnostics/), our troubleshooting tool for Linux, Windows, and macOS.
* Review New Relic's [data security](https://docs.newrelic.com/docs/security/) and [licenses](https://docs.newrelic.com/docs/licenses/) documentation.