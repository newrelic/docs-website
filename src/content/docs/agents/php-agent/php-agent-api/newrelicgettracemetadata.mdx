---
title: newrelic_get_trace_metadata
type: apiDoc
shortDescription: Returns an associative array containing the identifiers of the current trace and the parent span.
tags:
  - Agents
  - PHP agent
  - PHP agent API
---

## Syntax

```
newrelic_get_trace_metadata()
```

Returns an associative array containing the identifiers of the current trace and the parent span.

## Requirements

Requires PHP agent [version 9.3 or higher](https://docs.newrelic.com/docs/release-notes/agent-release-notes/php-release-notes).

Must be called inside a [transaction](https://docs.newrelic.com/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction).

## Description

Returns an associative array containing the identifiers of the current trace and the parent span. This information is useful for integrating with third party distributed tracing tools, such as Zipkin.

## Return values

An associative array containing the keys:

* `trace.id`: the currently executing trace identifier. An empty value will be returned if the transaction does not support this functionality or distributed tracing is disabled.Returns:
* `span.id`: the currently executing span identifier. An empty value will be returned if the transaction does not support this functionality or distributed tracing is disabled.

## Examples

### Populate B3 Headers for use with Zipkin

Adds necessary distributed tracing metadata to the HTTP headers being sent to a Zipkin consumer:

```
function make_http_request($url) {
  $metadata = newrelic_get_trace_metadata();
  $sampled = newrelic_is_sampled();

  $ch = curl_init($url);

  curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'X-B3-TraceId: ' . $metadata['trace_id'],
    'X-B3-SpanId: ' . substr(uniqid() . uniqid(), 0, 16),
    'X-B3-ParentSpanId: ' . $metadata['span_id'],
    'X-B3-Sampled: ' . $sampled));

  return curl_exec($ch);
}

$status = make_http_request("zipkin-consumer.example");
```

## For more help

If you need more help, check out these support and learning resources:

* Suggest a change and learn how to [contribute](https://github.com/newrelic/newrelic-php-agent/issues) to our PHP agent open source repository.
* Browse the [Explorers Hub](https://discuss.newrelic.com/) to get help from the community and join in discussions.
* Find [answers on our sites and learn how to use our support portal](https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/get-started/find-help-use-support-portal/).
* Run [New Relic Diagnostics](https://docs.newrelic.com/docs/using-new-relic/cross-product-functions/troubleshooting/new-relic-diagnostics/), our troubleshooting tool for Linux, Windows, and macOS.
* Review New Relic's [data security](https://docs.newrelic.com/docs/security/) and [licenses](https://docs.newrelic.com/docs/licenses/) documentation.