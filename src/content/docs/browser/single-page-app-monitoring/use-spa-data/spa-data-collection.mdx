---
title: SPA data collection
tags:
  - Browser
  - Single page app monitoring
  - Use SPA data
metaDescription: How browser stores data from an app that uses a single-page app (SPA) architecture.
redirects:
  - /docs/browser/single-page-app-monitoring/understand-data
  - /docs/browser/single-page-app-monitoring/understand-new-relic-spa-data
  - /docs/browser/single-page-app-monitoring/understand-spa-data-structure
  - /docs/browser/single-page-app-monitoring/browser-ui/understand-spa-data-collection
  - /docs/browser/single-page-app-monitoring/understand-spa-data-collection
  - /docs/browser/single-page-app-monitoring/use-spa-data/understand-spa-data-collection
  - /docs/browser/single-page-app-monitoring/use-spa-data/understand-collection-asynchronous-spa-data
freshnessValidatedDate: never
---
This document explains how browser collects and stores your asynchronous single page app (SPA) data. This will give you a better understanding of the [SPA data you see in the browser UI](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser). This will also help you more easily add custom monitoring with the [SPA API](/docs/browser/single-page-app-monitoring/use-spa-data/use-spa-api).

## Browser interactions [#browser-interaction]

At the heart of SPA monitoring is the concept of the <DNT>**browser interaction**</DNT>. New Relic defines a browser interaction, otherwise called a soft navigation, as the following sequence of events, drawing from [Google's heuristics](https://github.com/WICG/soft-navigations?tab=readme-ov-file#heuristics):

1. An user interaction occurs. We look specifically for `click`, `keydown` or `submit` events. The `popstate` event from the History API will also start an interaction.
2. The URL changes in any way, whether it's the path or hash.
3. Any changes, including to node attributes or text, occurs anywhere on the document DOM tree.

Following these steps, browser interactions are considered finished on the next repaint frame. They will also associate XHR and fetch requests started within their span. v2.1 introduced another step:

4. Monitor for long running callbacks for a period of 5 seconds. If any are detected, extend the interaction and repeat.

In this way, interactions will fully end when there's a silent period for long tasks. For extensions, any AjaxRequest and JavascriptError that occurred during the period up to the end of the observed long task will also become associated with the interaction. The duration of the interaction will not include those last 5 seconds. Step 4 may also be short-circuited or bypassed in some cases.

<Callout variant="tip">
  The `popstate` event trigger is handled in a special way compared to the other UI event triggers because of its peculiarity in the browser. In short, a `popstate` that occurs within 500 ms after an other UI event like click will be merged into that existing interaction, whose trigger remains unchanged (e.g. 'click'). However, two back-to-back popstates will never be merged this way. Popstate-as-trigger interactions typically come from browser actions (back/forward button) and code (programmatic change to URL).
</Callout>

## Types of SPA data reporting [#spa-data]

@@ -39,54 +38,39 @@ Three major categories of single page app data can be reported to New Relic:

Each of these creates a `BrowserInteraction` event. If one or more AJAX requests are part of an interaction, then associated `AjaxRequest` events are also created. These events and their attributes can be queried in the [query builder](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data).

<Callout variant="important">
  Default or non-custom interactions do not wait for network requests to finish or load. They are tied to interactions on an as-is basis, meaning only if they are done before the interaction is harvested by the scheduler. It is entirely possible for slow or long duration requests that started as part of an interaction to miss this time window. Manually holding the interaction open until any cared-about request has return is possible through the API.
</Callout> 

## Initial page loads

An <DNT>**initial page load**</DNT> is a traditional URL change, stemming from a complete load or reload of a URL. This is indicated in the browser when a page load event fires (the `window.onload` event) and also called a hard navigation. Initial page loads appear along with route changes in [the browser UI](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser).

## Route changes

SPA users experience dynamic route changes in a similar way to page loads. Visitors to a site or app generally do not care <DNT>**how**</DNT> a new view was delivered; they simply know that when they perform an action, a new view appears. For this reason, we treat route changes in a similar way to page loads in the UI.

In order to optimally monitor single page applications, we start monitoring any interaction that could theoretically lead to route changes.

* If these interactions do **not** complete the heuristic steps defined above, agent initiates monitoring but then discards them.
* If these interactions <DNT>**do**</DNT> follow all steps, agent saves the sequence as a completed `BrowserInteraction` event.

An interaction is considered a route change and saved as a `BrowserInteraction` event if the URL changes between the start and end. URL changes are tracked in two ways:

* The `popstate` event. Changing the url programmatically, such as setting `window.location.hash` will trigger this event.
* `pushState` or `replaceState` is called. SPAs commonly use these History API methods to update the URL.

Route changes appear along with initial page loads in the [browser UI](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser).

Note that the agent reports hash fragments from route change URLs. If you use hashes to pass private or sensitive data, that data may be visible to your New Relic account users. For more information about data collection and reporting, see [Security for browser](/docs/browser/new-relic-browser/performance-quality/security-new-relic-browser).

## Custom monitoring [#api-custom-events]

All apps are different and have different monitoring needs. You can use the [SPA API](/docs/browser/new-relic-browser/browser-agent-spa-api) to customize your browser interactions or self define the way it's captured.

Custom events are saved as `BrowserInteraction` events and have the following difference in attributes:

* The `category` attribute will have the value `Custom`.
* The `trigger` attribute will have the value `api`. (This is the default value but can be changed with the API.)

The API allows you to dictate when to start such custom interaction and when to end it, if the above heuristic does not fit your user base or app.

## Events and attributes [#event-data-structure]

We save browser interactions that lead to route changes and page loads, or are created through API, as `BrowserInteraction` events, and AJAX requests as `AjaxRequest` events. You can query these events in the [query builder](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data).
