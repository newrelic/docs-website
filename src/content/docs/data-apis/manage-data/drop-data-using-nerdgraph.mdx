---
title: Drop data using NerdGraph
tags:
  - Drop rules
  - Data ingest cost
metaDescription: 'With the New Relic NerdGraph API, you can drop data that meeets certain criteria and have it not count towards ingest and billing.'
redirects:
  - /docs/telemetry-data-platform/manage-data/drop-data-using-nerdgraph
  - /docs/drop-events-attributes
  - /docs/drop-events-nerdgraph
  - /docs/drop-data-using-nerdgraph
  - /telemetry-data-platform/get-started/manage-data/drop-data-using-nerdgraph
  - /docs/accounts/accounts/data-management/drop-data-using-nerdgraph
---

One way to [manage your data ingest](/docs/data-apis/manage-data/manage-data-coming-new-relic) is to set up data dropping rules. For [data that supports data dropping](#requirements), you can:

* Filter out unimportant low-value data
* Filter out potentially sensitive data

## Overview [#overview]

When you set up data dropping rules, only data from that point onward is affected. Existing data that has already been ingested [cannot be edited or deleted](/docs/telemetry-data-platform/ingest-manage-data/manage-data/manage-data-retention#data-deletion). Learn more in this NerdBytes video (7:09 minutes):

<Video
  id="ww0mim4c5jk"
  type="youtube"
/>

Besides using NerdGraph, other ways to drop data include:

* If you're using Prometheus remote write, see [Drop Prometheus remote write data](/docs/integrations/prometheus-integrations/install-configure/remote-write-drop-data/).
* If you're reporting logs, you can [drop log data via the UI](/docs/logs/ui-data/drop-data-drop-filter-rules).
* If you want to drop APM metric timeslice data, you can use [metric normalization rules](/docs/new-relic-one/use-new-relic-one/ui-data/metric-normalization-rules).

## Requirements [#requirements]

The ability to create and edit drop filter rules depends on which user model you're on:

* Newer user model: you must be assigned a role with "NRQL drop rules" [capabilities](/docs/accounts/accounts-billing/new-relic-one-user-management/user-capabilities).
* Original user model: you must have an [Admin role](/docs/accounts/original-accounts-billing/original-users-roles/users-roles-original-user-model/#roles).

The following data types can be targeted for data dropping:

* APM-reported events
* Browser-reported events
* Mobile-reported events
* Synthetics-reported events
* Custom events (like those generated by the [APM agent APIs](/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents) or the [Event API](/docs/insights/insights-data-sources/custom-data/introduction-event-api))
* Log data (you can also [use the UI to drop data](/docs/logs/ui-data/drop-data-drop-filter-rules))
* Distributed tracing spans
* [Default infrastructure monitoring events](/docs/infrastructure/manage-your-data/data-instrumentation/default-infrastructure-monitoring-data) and [infrastructure integrations](/docs/integrations/infrastructure-integrations/get-started/introduction-infrastructure-integrations) events, with these caveats:
  * Downsampled `SystemSample`, `ProcessSample`, `NetworkSample` and `StorageSample` with time windows longer than 59 minutes can't be dropped. This data doesn't count towards your data ingest.
  * Raw infrastructure data is used for alerting, so if you are dropping these events, you will not be able to alert on them even if you see data in charts with time windows longer than 59 minutes (such as alert condition preview charts).
* [Dimensional metrics](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#dimensional-metrics), with these caveats:
  * Billing impacts: for [our usage-based pricing](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing), dropped data is not billable. For [our original pricing model](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing), dropped data is billable.
  * For metrics generated by the [events-to-metrics service](/docs/data-ingest-apis/get-data-new-relic/metric-api/events-metrics-service-create-metrics): drop rules won't work but these metrics can be stopped or attributes pruned by disabling or re-configuring the events-to-metric rule.

Support for additional types are planned for the future.

## Create drop data rule [#how-to]

<Callout variant="caution">
  Use caution when deciding to drop data. The data you drop is not recoverable. Before using this feature, please review [caution information below.](#caution)
</Callout>

To drop data, create a [NerdGraph](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph)-format drop rule that includes:

* A [NRQL](/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql) string that specifies what data types to drop
* An **action** type specifying how to apply the NRQL string

You can form and make the call in the [NerdGraph explorer](https://api.newrelic.com/graphiql).

The limit on nrql query length is 4096 characters. If it exceeds the length the nerdGraph will throw an error `INVALID_NRQL_TOO_LONG`.

There are two ways to drop data:

* **Drop entire data types or a data subset** (with optional filter). This uses the `DROP_DATA` **action** type and uses NRQL of the form:

  ```sql
  SELECT * FROM DATA_TYPE_1, DATA_TYPE_2 (WHERE OPTIONAL_FILTER)
  ```

  For this type of drop rule, you cannot use anything other than `*` in the `SELECT` clause.
* **Drop attributes from data types** (with optional filter). This uses the `DROP_ATTRIBUTES` **action** type and uses NRQL of the form:

  ```sql
  SELECT dropAttr1, dropAttr2 FROM DATA_TYPE (WHERE OPTIONAL_FILTER)
  ```

  For this type of drop rule, you must pass in a non-empty list of raw attributes names.

## NRQL restrictions [#restrictions]

Not all NRQL clauses make sense for generating drop rules. You can provide a [`WHERE`](/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-clauses-functions#sel-where) clause to select data with specific attributes. Other features such as `LIMIT`, `TIMESERIES`, `COMPARE WITH`, `FACET`, and other clauses cannot be used.

`SINCE` and `UNTIL` are not supported in drop rules. If you have time-specific rules (say, drop everything until a time in the future), use `WHERE timestamp < (epoch milliseconds in the future)`. You also can't use `SINCE` to drop historical data: NRQL drop rules only apply to data reported after the drop rule was created. If you need to delete data that has already been reported, contact your New Relic representative.

The two action types have these restrictions:

* `DROP_DATA` can use only `SELECT *`.
* `DROP_ATTRIBUTES` requires use of `SELECT` with "raw" attributes (attributes with no [aggregator function](/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-clauses-functions#functions) applied). This also means you cannot use `SELECT *`. Additionally, there are some attributes that are integral to their data type and **cannot be dropped** (such as `timestamp` on event data). If you include them, registration will fail.

## Example drop rules [#example-rules]

Here are some example drop rules:

<CollapserGroup>
  <Collapser
    id="drop-events"
    title="Drop two event types"
  >
    Let's say you notice you have some event types being sent to New Relic that are not important to you. Also, stopping the source from sending those event types quickly is unrealistic, requiring changes to agents and/or API instrumentation. Using a drop rule is an easier way to accomplish the same goal.

    Here is an example NerdGraph call that drops two event types: `Event1` and `Event2`.

    ```graphql
    mutation {
        nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
            {
                action: DROP_DATA
                nrql: "SELECT * FROM Event1, Event2"
                description: "Drops all data for Event1 and Event2."
            }
        ])
        {
            successes { id }
            failures {
                submitted { nrql }
                error { reason description }
            }
        }
    }
    ```
  </Collapser>

  <Collapser
    id="drop-specific-events"
    title="Drop events meeting certain criteria"
  >
    Let’s say you have a high volume custom event type that arrives from multiple sources. If you don't find all of that data important, you can use a drop rule. Here is an example of a drop rule that filters out events based on specific criteria.

    ```graphql
    mutation {
        nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
            {
                action: DROP_DATA
                nrql: "SELECT * FROM MyCustomEvent WHERE appName='LoadGeneratingApp' AND environment='development'"
                description: "Drops all data for MyCustomEvent that comes from the LoadGeneratingApp in the dev environment, because there is too much and we don’t look at it."
            }
        ])
        {
            successes { id }
            failures {
                submitted { nrql }
                error { reason description }
            }
        }
    }
    ```
  </Collapser>

  <Collapser
    id="drop-sensitive-data"
    title="Drop sensitive attributes while maintaining the rest of the data"
  >
    Let's say you noticed an event has attributes that contain Personally Identifiable Information (PII). You are working to update your services to stop sending the data, but until then, you need to cease storing further PII in New Relic. Although you could drop all of the data as it comes in the door with a `DROP_DATA` rule, the rest of the data still provides value. Therefore, you can register a drop rule to remove only the offending PII from your data:

    ```graphql
    mutation {
        nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
            {
                action: DROP_ATTRIBUTES
                nrql: "SELECT userEmail, userName FROM MyCustomEvent"
                description: "Removes the user name and email fields from MyCustomEvent"
            }
        ])
        {
            successes { id }
            failures {
                submitted { nrql }
                error { reason description }
            }
        }
    }
    ```
  </Collapser>
</CollapserGroup>

## Verify your drop rule works [#verify]

After you create a drop rule, verify that it is working as expected. The rule should take effect quickly after a successful registration, so try running a `TIMESERIES` version of the query you registered to see that the data drops off.

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Drop rule type
      </th>

      <th>
        NRQL
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `DROP_DATA`
      </td>

      <td>
        **Drop rule NRQL:**

        ```sql
        SELECT * FROM MyEvent WHERE foo = bar
        ```

        **Validation NRQL:**

        ```sql
        SELECT count(*) FROM MyEvent WHERE foo = bar TIMESERIES
        ```

        This should drop to 0. To verify that it did not affect any thing else, invert the `WHERE` clause.
      </td>
    </tr>

    <tr>
      <td>
        `DROP_ATTRIBUTES`
      </td>

      <td>
        **Drop rule NRQL:**

        ```sql
        SELECT dropAttr1, dropAttr2 FROM MyEvent WHERE foo = bar
        ```

        **Validation NRQL:**

        ```sql
        SELECT count(dropAttr1), count(dropAttr2) FROM MyEvent WHERE foo = bar TIMESERIES
        ```

        Both lines should drop to 0. To verify that it did not affect events that contained these attributes and still should, invert the `WHERE` clause.
      </td>
    </tr>
  </tbody>
</table>

## View rules [#view]

Here is an example NerdGraph call that returns the drop rules set on an account:

```graphql
{
    actor {
        account(id: YOUR_ACCOUNT_ID) {
            nrqlDropRules {
                list {
                    rules {
                        id
                        nrql
                        accountId
                        action
                        createdBy
                        createdAt
                        description
                    }
                    error { reason description } 
                }
            }
        }
    }
}
```

## Delete drop rules [#delete]

Here is an example NerdGraph call deleting two specific drop rules:

```graphql
mutation {
    nrqlDropRulesDelete(accountId: YOUR_ACCOUNT_ID, ruleIds: ["48", "98"]) {
        successes {
            id
            nrql
            accountId
            action
            description
        }
        failures {
            error { reason description }
            submitted { ruleId accountId }
        }
    }
}
```

## Audit drop rule history [#history]

To see who created and deleted drop rules, query your [account audit logs](/docs/insights/use-insights-ui/manage-account-data/query-account-audit-logs-nrauditevent). The [list endpoint](#list) also includes the user ID of the person who created the rule.

## Cautions when dropping data [#caution]

When creating drop rules, you are responsible for ensuring that the rules accurately identify and discard the data that meets the conditions that you have established. You are also responsible for monitoring the rule, as well as the data you disclose to New Relic.

New Relic cannot guarantee that this functionality will completely resolve data disclosure concerns you may have. New Relic does not review or monitor how effective the rules you develop are.

Creating rules about sensitive data can leak information about what kinds of data you maintain, including the format of your data or systems (for example, through referencing email addresses or specific credit card numbers). Rules you create, including all information in those rules, can be viewed and edited by any user with the relevant role-based access control permissions.

Only new data will be dropped. Existing data [cannot be edited or deleted](/docs/telemetry-data-platform/ingest-manage-data/manage-data/manage-data-retention#data-deletion).

## Drop attributes on dimensional metric rollups

[Dimensional metrics](/docs/data-apis/understand-data/new-relic-data-types/#metrics-conceptual) aggregate metrics into rollups for long term storage and as a way to optimize longer term queries. [Metric cardinality limits](/docs/data-apis/ingest-apis/metric-api/metric-api-limits-restricted-attributes) are applied to this data.

You can use this feature to decide which attributes you don't need for long term storage and query, but would like to maintain for real time queries.

For example, adding `containerId` as an attribute can be useful for live troubleshooting or recent analysis, but may not be needed when querying over longer periods of time for larger trends. Due to how unique something like `containerId` can be, it can quickly drive you towards your [metric cardinality limits](/docs/data-apis/ingest-apis/metric-api/metric-api-limits-restricted-attributes) which when hit stops the synthesis of rollups for the remainder of that UTC day.

This feature also allows you to keep the [high cardinality](/docs/data-apis/ingest-apis/metric-api/NRQL-high-cardinality-metrics/) attributes on the raw data and drop it from rollups which gives you more control over how quickly you approach your cardinaliity limits.

### Usage

**Drop attributes from dimensional metrics rollups** (with optional filter). This uses `DROP_ATTRIBUTES_FROM_METRIC_AGGREGATES` **action** type and uses NRQL of the form:

```sql
SELECT dropAttr1, dropAttr2 FROM Metric (WHERE OPTIONAL_FILTER)
```

Here is an example NerdGraph request:

```graphql
mutation {
    nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
        {
            action: DROP_ATTRIBUTES_FROM_METRIC_AGGREGATES
            nrql: "SELECT containerId FROM Metric WHERE metricName = 'some.metric'"
            description: "Removes the containerId from long term querys."
        }
    ])
    {
        successes { id }
        failures {
            submitted { nrql }
            error { reason description }
        }
    }
}
```

To verify it's working, wait 3 to 5 minutes for the rule to be picked up and for aggregate data to be generated. Then assuming the example NRQL above is your drop rule, run the following queries:

```sql
SELECT count(containerId) FROM Metric WHERE metricName = 'some.metric' TIMESERIES SINCE 2 hours ago
SELECT count(containerId) FROM Metric WHERE metricName = 'some.metric' TIMESERIES SINCE 2 hours ago RAW
```

The first query retrieves metric rollups and should drop to 0 since `containerId` has been dropped per the new drop rule. The second query retrieves metric raws using the `RAW` keyword and should continue to hold steady since raw data is not impacted by the new drop rule. For more information on how to see the impact this will have on your cardinality, check out [Understand and query high cardinality metrics](/docs/data-apis/ingest-apis/metric-api/NRQL-high-cardinality-metrics).

### Restrictions

All restrictions that apply to `DROP_ATTRIBUTES` apply to `DROP_ATTRIBUTES_FROM_METRIC_AGGREGATES` with the additional restriction that you can only target the `Metric` data type. They also do not work on `Metric` queries targeting data created by an [events to metrics](/docs/data-ingest-apis/get-data-new-relic/metric-api/events-metrics-service-create-metrics) rule or on `Metric` queries targeting [timeslice data](/docs/data-apis/understand-data/metric-data/query-apm-metric-timeslice-data-nrql).

## Learn more

Recommendations for learning more:

* [NerdGraph basics and terminology](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph#terminology)
* [NRQL basics](/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql)
* Browse the [Support Forum](https://discuss.newrelic.com/c/telemetry-data-platform/dashboards) for community discussions about NRQL drop rules.
* For a deep dive into managing data ingest for a complex organization, see [Data ingest governance](/docs/new-relic-solutions/observability-maturity/operational-efficiency/intro-data-governance).
