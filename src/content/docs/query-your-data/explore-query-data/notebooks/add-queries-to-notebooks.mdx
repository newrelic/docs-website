---
title: Add queries to notebooks
tags:
  - Query your data
  - Explore and query data
  - Notebooks
  - NRQL
translate:
  - jp
  - kr
metaDescription: 'Learn how to add NRQL queries to your New Relic notebooks, customize query blocks, and visualize your data within notebook documents.'
freshnessValidatedDate: never
---

Query blocks are the core component of notebooks, allowing you to write NRQL queries and visualize the results directly within your document. You can add multiple query blocks to a single notebook to build a comprehensive data story.

## Add a query block

To add a query block to your notebook:

1. Open your notebook in the query console.
2. Click the **+ Query** button or press **Ctrl+Enter** (or **Cmd+Enter** on Mac) to add a new query block.
3. Write your NRQL query in the query editor.
4. Press **Run** or **Enter** to execute the query and display results.

<Callout variant="tip">
  All NRQL queries supported in the standard query builder work in notebook query blocks. You can query any data type including metrics, events, logs, and traces.
</Callout>

## Write NRQL queries

Notebook query blocks support the full range of NRQL (New Relic Query Language) functionality:

### Basic queries

```sql
SELECT count(*) FROM Transaction
WHERE appName = 'MyApp'
SINCE 1 hour ago
```

### Complex aggregations

```sql
SELECT average(duration), percentile(duration, 95)
FROM Transaction
WHERE appName = 'MyApp'
FACET name
SINCE 1 day ago
LIMIT 10
```

### Time series data

```sql
SELECT count(*) FROM Transaction
WHERE appName = 'MyApp'
TIMESERIES 5 minutes
SINCE 6 hours ago
```

## Customize query visualizations

Each query block supports all the visualization options available in the standard query builder:

### Chart types

* **Line charts**: Perfect for time series data and trends
* **Area charts**: Show volume and composition over time
* **Bar charts**: Compare values across categories
* **Pie charts**: Display proportional data
* **Tables**: Show detailed data in rows and columns
* **Billboards**: Highlight single important metrics

### Chart customization

1. Click the **Chart type** dropdown above your query results.
2. Select your preferred visualization.
3. Use the **Chart settings** to customize:
   * Colors and styling
   * Axis labels and ranges
   * Data formatting
   * Thresholds and alerts

## Use variables in queries

Variables make your notebooks dynamic and reusable. You can define variables once and reference them across multiple query blocks.

### Define variables

```sql
-- Define a variable at the top of your notebook
{{timeRange = "1 hour ago"}}
{{appName = "MyApplication"}}
```

### Use variables in queries

```sql
SELECT count(*) FROM Transaction
WHERE appName = '{{appName}}'
SINCE {{timeRange}}
```

<Callout variant="important">
  Variables are scoped to the entire notebook and can be referenced in any query block within the same notebook.
</Callout>

## Query block management

### Duplicate a query block

1. Hover over the query block.
2. Click the **three-dot menu** in the top-right corner.
3. Select **Duplicate**.

### Move query blocks

Reorder your query blocks to improve your narrative flow:

1. Hover over the query block.
2. Click the **three-dot menu**.
3. Select from:
   * **Move up**
   * **Move down**
   * **Move to top**
   * **Move to bottom**

### Delete a query block

1. Hover over the query block.
2. Click the **three-dot menu**.
3. Select **Delete**.
4. Confirm the deletion.

## Query performance tips

To ensure your notebooks load quickly and perform well:

### Optimize query time ranges

* Use specific time ranges instead of open-ended queries
* Consider using `SINCE` and `UNTIL` clauses for historical analysis
* Use `LIMIT` to restrict result sets when appropriate

### Use efficient NRQL patterns

```sql
-- Good: Efficient aggregation
SELECT count(*) FROM Transaction
WHERE appName = 'MyApp' AND duration > 1.0
SINCE 1 hour ago

-- Avoid: Overly broad queries without filters
SELECT * FROM Transaction
SINCE 1 week ago
```

### Cache query results

Query results in notebooks are cached for a short period. If you're iterating on analysis, you can rely on cached results to speed up notebook loading.

## Troubleshooting queries

### Common query errors

**Syntax errors**: Check your NRQL syntax using the [NRQL reference](/docs/nrql/nrql-syntax-clauses-functions).

**Data not found**: Verify:
* Your time range includes data
* Attribute names are spelled correctly
* You have access to the data source

**Performance issues**:
* Add more specific `WHERE` clauses
* Reduce the time range
* Use `LIMIT` to restrict results

### Get help with NRQL

* Browse [NRQL examples](/docs/nrql/nrql-examples) for common patterns
* Check the [NRQL tutorial](/docs/nrql/nrql-tutorials) for learning resources
* Use the [query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder) to build queries visually

## What's next?

* Learn about [visualizations in notebooks](/docs/query-your-data/explore-query-data/notebooks/visualizations-in-notebooks)
* Discover how to [share notebooks](/docs/query-your-data/explore-query-data/notebooks/share-notebooks) with your team
* Explore [notebook examples](/docs/query-your-data/explore-query-data/notebooks/notebooks-examples) for inspiration