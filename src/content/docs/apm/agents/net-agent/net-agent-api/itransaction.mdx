---
title: ITransaction
type: apiDoc
shortDescription: Provides access to transaction-specific methods in the New Relic API.
tags:
  - Agents
  - NET agent
  - NET agent API
metaDescription: 'New Relic .NET agent API: provides transaction-specific methods, including attaching custom attributes.'
redirects:
  - /docs/agents/net-agent/net-agent-api/itransaction
  - /docs/agents/net-agent/net-agent-api/itransaction-net-agent-api
---

## Syntax

```cs
public interface ITransaction
```

Provides access to transaction-specific methods in the New Relic API.

## Description

Provides access to transaction-specific methods in the New Relic .NET agent API. To obtain a reference to `ITransaction`, use the current transaction method available on [`IAgent`](/docs/agents/net-agent/net-agent-api/iagent).

The following methods are available on `ITransaction`:

<table>
  <thead>
    <tr>
      <th>
        Name
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        [AcceptDistributedTraceHeaders](#acceptdistributedtraceheaders)
      </td>

      <td>
        Accepts incoming trace context headers from another service.
      </td>
    </tr>

    <tr>
      <td>
        [InsertDistributedTraceHeaders](#insertdistributedtraceheaders)
      </td>

      <td>
        Adds trace context headers to an outgoing request.
      </td>
    </tr>

    <tr>
      <td>
        [AcceptDistributedTracePayload (obsolete)](#acceptdistributedtracepayload)
      </td>

      <td>
        Accepts an incoming distributed trace payload from another service.
      </td>
    </tr>

    <tr>
      <td>
        [CreateDistributedTracePayload (obsolete)](#createdistributedtracepayload)
      </td>

      <td>
        Creates a distributed trace payload for inclusion in an outgoing request.
      </td>
    </tr>

    <tr>
      <td>
        [AddCustomAttribute](#addcustomattribute)
      </td>

      <td>
        Add contextual information from your application to the current transaction in form of attributes.
      </td>
    </tr>

    <tr>
      <td>
        [CurrentSpan](#currentspan)
      </td>

      <td>
        Provides access to the currently executing [span](/docs/agents/net-agent/net-agent-api/ispan), which provides access to span-specific methods in the New Relic API.
      </td>
    </tr>

    <tr>
      <td>
        [SetUserId](#setuserid)
      </td>

      <td>
        Associates a User Id to the current transaction.
      </td>
    </tr>
  </tbody>
</table>

## AcceptDistributedTraceHeaders

`ITransaction.AcceptDistributedTraceHeaders` is used to instrument the called service for inclusion in a distributed trace. It links the spans in a trace by accepting a payload generated by [`InsertDistributedTraceHeaders`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#transaction-handle-insertDistributedTraceHeaders) or generated by some other W3C Trace Context compliant tracer. This method accepts the headers of an incoming request, looks for W3C Trace Context headers, and if not found, falls back to New Relic distributed trace headers. This method replaces the deprecated [`AcceptDistributedTracePayload`](/docs/agents/net-agent/net-agent-api/itransaction#acceptdistributedtracepayload) method, which only handles New Relic distributed trace payloads.

### Syntax

```cs
void AcceptDistributedTraceHeaders(carrier, getter, transportType)
```

### Parameters

<table>
  <thead>
    <tr>
      <th>
        Name
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `carrier`

        _&lt;T>_
      </td>

      <td>
        Required. Source of incoming Trace Context headers.
      </td>
    </tr>

    <tr>
      <td>
        `getter`

        _Func&lt;T, string, IEnumerable&lt;string>>_
      </td>

      <td>
        Required. Caller-defined function to extract header data from the carrier.
      </td>
    </tr>

    <tr>
      <td>
        `transportType`

        _TransportType enum_
      </td>

      <td>
        Required. Describes the transport of the incoming payload (for example `TransportType.HTTP`).
      </td>
    </tr>
  </tbody>
</table>

### Usage considerations

* [Distributed tracing must be enabled](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing).
* `AcceptDistributedTraceHeaders` will be ignored if `InsertDistributedTraceHeaders` or `AcceptDistributedTraceHeaders` has already been called for this transaction.

### Example

```cs
HttpContext httpContext = HttpContext.Current;
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent();
ITransaction currentTransaction = agent.CurrentTransaction;
currentTransaction.AcceptDistributedTraceHeaders(httpContext, Getter, TransportType.HTTP);
IEnumerable<string> Getter(HttpContext carrier, string key) 
{ 
    string value = carrier.Request.Headers[key];   
    return value == null ? null : new string[] { value }; 
}
```

## InsertDistributedTraceHeaders

`ITransaction.InsertDistributedTraceHeaders` is used to implement distributed tracing. It modifies the carrier object that is passed in by adding W3C Trace Context headers and New Relic Distributed Trace headers. The New Relic headers can be disabled with `<distributedTracing excludeNewrelicHeader="true" />` in the config. This method replaces the deprecated [`CreateDistributedTracePayload`](/docs/agents/net-agent/net-agent-api/itransaction#createdistributedtracepayload) method, which only creates New Relic Distributed Trace payloads.

### Syntax

```cs
void InsertDistributedTraceHeaders(carrier, setter)
```

### Parameters

<table>
  <thead>
    <tr>
      <th>
        Name
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `carrier`

        _&lt;T>_
      </td>

      <td>
        Required. Container where Trace Context headers are inserted..
      </td>
    </tr>

    <tr>
      <td>
        `setter`

        _Action&lt;T, string, string>_
      </td>

      <td>
        Required. Caller-defined Action to insert header data into the carrier.
      </td>
    </tr>
  </tbody>
</table>

### Usage considerations

* [Distributed tracing must be enabled](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing).

### Example

```cs
HttpWebRequest requestMessage = (HttpWebRequest)WebRequest.Create("https://remote-address");
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent();
ITransaction currentTransaction = agent.CurrentTransaction;
var setter = new Action<HttpWebRequest, string, string>((carrier, key, value) => { carrier.Headers?.Set(key, value); });
currentTransaction.InsertDistributedTraceHeaders(requestMessage, setter);
```

## AcceptDistributedTracePayload [#acceptdistributedtracepayload]

<Callout variant="caution">
  This API is not available in the .NET agent v9.0 or higher. Please use [`AcceptDistributedTraceHeaders`](/docs/agents/net-agent/net-agent-api/itransaction/#acceptdistributedtraceheaders) instead.
</Callout>

Accepts an incoming distributed trace payload from an upstream service. Calling this method links the transaction from the upstream service to this transaction.

### Syntax

```cs
void AcceptDistributedPayload(payload, transportType)
```

### Parameters

<table>
  <thead>
    <tr>
      <th>
        Name
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `payload`

        _string_
      </td>

      <td>
        Required. A string representation of the incoming distributed trace payload.
      </td>
    </tr>

    <tr>
      <td>
        `transportType`

        _TransportType_  
                                _enum_
      </td>

      <td>
        Recommended. Describes the transport of the incoming payload (for example, `http`).

        Default `TransportType.Unknown`.
      </td>
    </tr>
  </tbody>
</table>

### Usage considerations

* [Distributed tracing must be enabled](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing).
* The payload can be a Base64-encoded or plain text string.
* `AcceptDistributedTracePayload` will be ignored if `CreateDistributedTracePayload` has already been called for this transaction.

### Example

```cs
//Obtain the information from the request object from the upstream caller.
//The method by which this information is obtain is specific to the transport 
//type being used. For example, in an HttpRequest, this information is
//contained in the 
header.KeyValuePair<string, string> metadata = GetMetaDataFromRequest("requestPayload");
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); 
ITransaction transaction = agent.CurrentTransaction; 
transaction.AcceptDistributedTracePayload(metadata.Value, TransportType.Queue);
```

## CreateDistributedTracePayload (obsolete) [#createdistributedtracepayload]

<Callout variant="caution">
  This API is not available in the .NET agent v9.0 or higher. Please use [`InsertDistributedTraceHeaders`](/docs/agents/net-agent/net-agent-api/itransaction/#insertdistributedtraceheaders) instead.
</Callout>

Creates a distributed trace payload for inclusion in an outgoing request to a downstream system.

### Syntax

```cs
IDistributedTracePayload CreateDistributedTracePayload()
```

### Returns

An object that implements `IDistributedTracePayload` which provides access to the distributed trace payload that was created.

### Usage considerations

* [Distributed tracing must be enabled](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing).
* `CreateDistributedTracePayload` will be ignored if `AcceptDistributedTracePayload` has already been called for this transaction.

### Example

```cs
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent();
ITransaction transaction = agent.CurrentTransaction;
IDistributedTracePayload payload = transaction.CreateDistributedTracePayload();
```

## AddCustomAttribute

Adds contextual information about your application to the current transaction in the form of [attributes](/docs/using-new-relic/welcome-new-relic/get-started/glossary#attribute).

This method requires .NET agent version and .NET agent API [version 8.24.244.0](/docs/release-notes/agent-release-notes/net-release-notes/net-agent-8242440) or higher. It replaced the deprecated [`AddCustomParameter`](/docs/agents/net-agent/net-agent-api/add-custom-parameter).

### Syntax

```cs
ITransaction AddCustomAttribute(string key, object value)
```

### Parameters

<table>
  <thead>
    <tr>
      <th>
        Parameter
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `key`

        _string_
      </td>

      <td>
        Identifies the information being reported. Also known as the name.

        * Empty keys are not supported.
        * Keys are limited to 255-bytes. Attributes with keys larger than 255-bytes will be ignored.
      </td>
    </tr>

    <tr>
      <td>
        `value`

        _object_
      </td>

      <td>
        The value being reported.
      </td>
    </tr>
  </tbody>
</table>

### Returns

A reference to the current transaction.

### Usage considerations

For details about supported data types, see the [Custom Attributes Guide](/docs/agents/net-agent/attributes/custom-attributes).

### Example

```cs
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent();
ITransaction transaction = agent.CurrentTransaction;
transaction.AddCustomAttribute("customerName","Bob Smith")
    .AddCustomAttribute("currentAge",31)
    .AddCustomAttribute("birthday", new DateTime(2000, 02, 14))
    .AddCustomAttribute("waitTime", TimeSpan.FromMilliseconds(93842));
```

## CurrentSpan

Provides access to the currently executing [span](http://docs.newrelic.com/docs/agents/net-agent/net-agent-api/ispan), making [span-specific methods](http://docs.newrelic.com/docs/agents/net-agent/net-agent-api/ispan) available within the New Relic API.

### Example

```cs
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); 
ITransaction transaction = agent.CurrentTransaction; 
ISpan currentSpan = transaction.CurrentSpan;
```

## SetUserId

Associates a User Id with the current transaction.

This method requires .NET agent and .NET agent API [version 10.9.0](/docs/release-notes/agent-release-notes/net-release-notes/net-agent-1090) or higher.

### Syntax

```cs
ITransaction SetUserId(string userId)
```

### Parameters

<table>
  <thead>
    <tr>
      <th>
        Parameter
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `userId`

        _string_
      </td>

      <td>
        The User Id to be associated with this transaction.

        * Null, empty and whitespace values will be ignored.
      </td>
    </tr>

  </tbody>
</table>

### Example

```cs
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); 
ITransaction transaction = agent.CurrentTransaction; 
transaction.SetUserId("BobSmith123");
```
