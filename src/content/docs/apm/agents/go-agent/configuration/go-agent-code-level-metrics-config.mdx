---
title: Go agent code-level metrics configuration
tags:
  - Agents
  - Go agent
  - Configuration
metaDescription: For the New Relic Go language agent, you can add source code context to your application traces, associating the trace data with the specific code being instrumented.
---

When you enable code-level metrics, the Go agent will attach attributes to trace data. These attributes show the location in your application source code responsible for the actions instrumented by those traces. The data you can see includes:
 * Source file name
 * Source file line number
 * Function name
 * Namespace

Take a look at the Go agent configuration settings to help you control the collection of code-level metrics. After you complete the configuration, if you need help finding the data, see [View your metrics](#view-metrics). If you want more control over how the metrics are collected, see [Go agent code-level metrics instrumentation](/docs/apm/agents/go-agent/instrumentation/go-agent-code-level-metrics-instrument).

<Callout variant="important">
    This feature is available for transactions as of Go agent version 3.18.0, and is turned off by default. To enable it, you must add `newrelic.ConfigCodeLevelMetricsEnabled(true)` to your application's configuration as explained below.
</Callout>

## Configuration methods [#config]

When calling `newrelic.NewApplication` to configure the Go agent in your application, you can enable code-level metrics by including the `newrelic.ConfigCodeLevelMetricsEnabled` option, like so:

```go
app, err := newrelic.NewApplication(
   newrelic.ConfigAppName("Your Application Name"),
   newrelic.ConfigLicense(os.Getenv("NEW_RELIC_LICENSE_KEY")),
   newrelic.ConfigCodeLevelMetricsEnabled(true),
)
```

With that simple step, the Go agent will add the source code context information in the following agent attributes on transactions:
<table>
  <thead>
    <tr>
    <th style={{ width: "200px" }}>
      Name
    </th>
    <th>
      Description
    </th>
    </tr>
  </thead>
  <tbody>
    <tr>
    <td>
      `code.function`
    </td>
    <td>
      The name of the function which started the transaction. Note that this may be automatically generated by the Go compiler in some cases.
    </td>
    </tr>
    <tr>
    <td>
      `code.namespace`
    </td>
    <td>
      The package/namespace where the function is located. The combination of `code.namespace` and `code.function`, joined with a delimiter such as
      a dot (`.`), is expected to uniquely identify the function.
    </td>
    </tr>
    <tr>
    <td>
      `code.filepath`
    </td>
    <td>
      The pathname of the source file containing the function being reported. Normally this is the full, absolute pathname; see below for
      a configuration option which allows you to change this to a relative path.
    </td>
    </tr>
    <tr>
    <td>
      `code.lineno`
    </td>
    <td>
      The line number within `code.filepath` where the transaction was started. See [the instrumentation guide](/docs/apm/agents/go-agent/instrumentation/go-agent-code-level-metrics-instrument) for ways to control this.
    </td>
    </tr>
  </tbody>
</table>

There are additional configuration options you may wish to use to further refine the collection of code-level metrics in your application.

<CollapserGroup>
  <Collapser
    id="go-clm-config-ignore-prefix"
    title={<>Identify instrumented packages</>}
  >
  By default, with code-level metrics enabled, the agent will ignore functions in the call stack which it believes to be internal
  to the agent itself, to ensure that the function reported is the one intended, even though functions inside the agent will have
  been called to get into the code-level metrics instrumentation code. By default, it does this by ignoring any functions whose
  package name begins with `github.com/newrelic/go-agent/`. You can change this to any arbitrary list of names by setting your own
  `IgnoredPrefixes` value.

  To accomplish this, do one of the following:

  * If configuring via the `NewApplication` function, add a `ConfigCodeLevelMetricsIgnoredPrefix` option, passing any number of prefix strings as separate string arguments:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigCodeLevelMetricsIgnoredPrefix("github.com/some/other/name/"),
    )
    ```

  * If configuring via environment variables, set `NEW_RELIC_CODE_LEVEL_METRICS_IGNORED_PREFIX` to the desired prefix (or a comma-separated list of prefixes):
    ```
    NEW_RELIC_CODE_LEVEL_METRICS_IGNORED_PREFIX="github.com/some/other/name/"
    ```

    Don't forget to also include the `newrelic.ConfigFromEnvironmet` option when setting up the application:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigFromEnvironment(),
    )
    ```

  * It is also possible to directly set the `CodeLevelMetrics.IgnoredPrefixes` member of the `Config` struct (which is a `[]string` value), but we recommend using one of the above-mentioned methods instead of directly manipulating the `Config` structure.

  </Collapser>
  <Collapser
    id="go-clm-config-path-prefix"
    title={<>Truncate source path prefix</>}
  >
  By default, with code-level metrics enabled, the agent will report the full pathname of each source file. However, this may
  not be desired. For example, you may wish to only report application paths relative to the root of the project source
  tree, allowing data to be correlated between instances regardless of where they are installed in the filesystem.

  To accomplish this, specify a `PathPrefix` string that indicates the start of your local project source path. If that string is found
  in a source file pathname, everything that appears before it will be removed. For example, if the `PathPrefix` parameter
  is set to `myproject/src` then `/usr/local/projects/myproject/src/widget/main.go` would be reported in the code-level metrics
  as `myproject/src/widget/main.go`.

  If `PathPrefix` is empty, or a source file doesn't contain the prefix string at all, the full pathname will be reported.

  Do one of the following:

  * If configuring via the `NewApplication` function, add a `ConfigCodeLevelMetricsPathPrefix` option:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigCodeLevelMetricsPathPrefix("myprojects/src/"),
    )
    ```

  * If configuring via environment variables, set `NEW_RELIC_CODE_LEVEL_METRICS_PATH_PREFIX` to the desired prefix:
    ```
    NEW_RELIC_CODE_LEVEL_METRICS_PATH_PREFIX="myprojects/src/"
    ```

    Don't forget to also include the `newrelic.ConfigFromEnvironment` option when setting up the application:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigFromEnvironment(),
    )
    ```
  </Collapser>
</CollapserGroup>

## View your metrics [#view-metrics]

Once you've configured code-level metrics, you can see your data in the New Relic UI. Here's one way you can see traces for a particular service:

1. Go to **[one.newrelic.com](https://one.newrelic.com/)**.
2. In the left pane, click **APM &amp; services**.
3. Click your entity (service).
4. In the left pane's **Monitor** section, click **Transactions**.
5. Under **Transaction traces**, click on an individual trace.
6. Look under **Agent attributes** for the four attributes beginning with `code.`.
