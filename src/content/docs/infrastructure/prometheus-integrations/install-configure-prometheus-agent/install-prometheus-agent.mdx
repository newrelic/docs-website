---
title: Install and configure the Prometheus agent with New Relic for Kubernetes
tags:
  - Integrations
  - Prometheus integrations
  - Install and configure Prometheus agent
metaDescription: 'How to install, update, or uninstall your New Relic Prometheus agent with New Relic for Kubernetes.'
---

New Relic's Prometheus agent is a thin wrapper (we refer to it as Prometheus Configurator in [its repository](https://github.com/newrelic/newrelic-prometheus-configurator/blob/main/charts/newrelic-prometheus-agent/values.yaml#L184)) on top of Prometheus to run Prometheus in agent mode and its configuration burden. With this integration you can create a YAML configuration file used by Prometheus ready to send the metrics to New Relic.

## Install in Kubernetes [#kubernetes]

See how to [install the Kubernetes integration](/docs/kubernetes-pixie/kubernetes-integration/installation/kubernetes-integration-install-configure), which includes the feature flag for Prometheus Configurator.

Alternatively, we also offer fully manual instructions for [deploying our integration using Helm](/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm).

By default, the New Relic Prometheus agent uses the same annotation as Prometheus to discover targets: `prometheus.io/scrape: true`. For more information, see the [set up New Relic's Prometheus agent](/docs/integrations/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent) documentation.

To ensure the integration has been configured correctly, go to **[one.newrelic.com](https://one.newrelic.com)** > Query builder, and run this NRQL query to see if data has been reported:

```sql
FROM Metric SELECT count(*) WHERE clusterName = 'YOUR_CLUSTER_NAME' since 1 hour ago
```

<Callout variant="tip">
  If you don't see your data right away, wait for a few seconds. Data may take some time to make it to New Relic.
</Callout>

### Configure it in Kubernetes [#kubernetes-config]

To configure the agent when using Helm you should set your `values.yaml` in two ways:

<CollapserGroup>
  <Collapser
    id="nri-bundle"
    title="Installed using out Helm Bundle"
  >
    ```yaml
    global:
      licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
      cluster: _K8S_CLUSTER_NAME_

    newrelic-prometheus-agent:
      enabled: true
      config:
        # YOUR CONFIGURATION GOES HERE. An example:
        static_targets:
          jobs:
            - job_name: self-metrics
              targets:
                - "managed_exporter.your-company.tld:5432"
            - job_name: self-metrics
              targets:
                - "localhost:9090"
              extra_metric_relabel_config:
                - source_labels: [__name__]
                  action: keep
                  regex: "\
                    prometheus_agent_active_series|\
                    prometheus_target_interval_length_seconds|\
                    prometheus_target_scrape_pool_targets|\
                    prometheus_remote_storage_samples_pending|\
                    prometheus_remote_storage_samples_in_total|\
                    prometheus_remote_storage_samples_retried_total|\
                    prometheus_agent_corruptions_total|\
                    prometheus_remote_storage_shards|\
                    prometheus_sd_kubernetes_events_total|\
                    prometheus_agent_checkpoint_creations_failed_total|\
                    prometheus_agent_checkpoint_deletions_failed_total|\
                    prometheus_remote_storage_samples_dropped_total|\
                    prometheus_remote_storage_samples_failed_total|\
                    prometheus_sd_kubernetes_http_request_total|\
                    prometheus_agent_truncate_duration_seconds_sum|\
                    prometheus_build_info|\
                    process_resident_memory_bytes|\
                    process_virtual_memory_bytes|\
                    process_cpu_seconds_total"
    ```
  </Collapser>

  <Collapser
    id="standalone-helm-release"
    title="Standalone Helm release (advanced)"
  >
    ```yaml
    licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
    cluster: _K8S_CLUSTER_NAME_

    config:
      # YOUR CONFIGURATION GOES HERE. An example:
      static_targets:
        jobs:
          - job_name: self-metrics
            targets:
              - "managed_exporter.your-company.tld:5432"
          - job_name: self-metrics
            targets:
              - "localhost:9090"
            extra_metric_relabel_config:
              - source_labels: [__name__]
                action: keep
                regex: "\
                  prometheus_agent_active_series|\
                  prometheus_target_interval_length_seconds|\
                  prometheus_target_scrape_pool_targets|\
                  prometheus_remote_storage_samples_pending|\
                  prometheus_remote_storage_samples_in_total|\
                  prometheus_remote_storage_samples_retried_total|\
                  prometheus_agent_corruptions_total|\
                  prometheus_remote_storage_shards|\
                  prometheus_sd_kubernetes_events_total|\
                  prometheus_agent_checkpoint_creations_failed_total|\
                  prometheus_agent_checkpoint_deletions_failed_total|\
                  prometheus_remote_storage_samples_dropped_total|\
                  prometheus_remote_storage_samples_failed_total|\
                  prometheus_sd_kubernetes_http_request_total|\
                  prometheus_agent_truncate_duration_seconds_sum|\
                  prometheus_build_info|\
                  process_resident_memory_bytes|\
                  process_virtual_memory_bytes|\
                  process_cpu_seconds_total"
    ```
  </Collapser>
</CollapserGroup>
