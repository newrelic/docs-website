---
title: Migrate from Prometheus OpenMetrics to New Relic Prometheus Agent
tags:
  - Integrations
  - Prometheus integrations
  - Install and configure OpenMetrics
metaDescription: Migration guidelines to move from Prometheus OpenMetrics to New Relic Prometheus Agent.
---

This document is intended to help an existing user of New Relic's Prometheus OpenMetrics integration (POMI/nri-prometheus) with the migration to New Relic's Prometheus Agent (newrelic-prometheus-agent) in order to achieve the same monitoring experience.

Since `newrelic-prometheus-agent` is actually running Prometheus Server in agent mode, the configuration file structure has changed to offer more flexibility and the possibility to use any scrape related feature of the Prometheus Server like authorization methods and relabel configs.

We have also added a configurator that will translate our simplified configuration file to a prometheus server configuration in order to provide a better configuration experience. We suggest you to read the documentation on `newrelic-prometheus-agent` configuration options, this document will focus on NR Prometheus OpenMetrics and NR Prometheus Agent differences:

## Metadata [#metadata]

You can find [here](/docs/integrations/prometheus-integrations/install-configure-prometheus-configurator/default-metrics-and-metric-attributes#metric-labels) the full list of labels added by `newrelic-prometheus-agent`.

The following table highlights the metadata changes between `nri-prometheus` and `newrelic-prometheus-agent:

<table>
  <thead>
    <tr>
      <th style={{ width: "280px" }}>
        nri-prometheus
      </th>

      <th style={{ width: "250px" }}>
        newrelic-prometheus-agent
      </th>

      <th>
        Change
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `namespaceName`
      </td>

      <td>
        `namespace`
      </td>

      <td>
        Renamed
      </td>
    </tr>

    <tr>
      <td>
        `nodeName`
      </td>

      <td>
        `node`
      </td>

      <td>
        Renamed
      </td>
    </tr>

    <tr>
      <td>
        `podName`
      </td>

      <td>
        `pod`
      </td>

      <td>
        Renamed
      </td>
    </tr>

    <tr>
      <td>
        `serviceName`
      </td>

      <td>
        `service`
      </td>

      <td>
        Renamed
      </td>
    </tr>

    <tr>
      <td>
        `deploymentName`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `clusterName`
      </td>

      <td>
        `cluster_name`
      </td>

      <td>
        Renamed
      </td>
    </tr>

    <tr>
      <td>
        `integrationName`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `integrationVersion`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `metricName`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `nrMetricType`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `promMetricType`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `label.kubernetesLabel`
      </td>

      <td>
        `kubernetesLabel`
      </td>

      <td>
        Renamed<br/>The `label.` prefix has been removed and the label name sanitized to Prometheus naming standards.
      </td>
    </tr>

    <tr>
      <td>
        `targetName`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `scrapedTargetKind`
      </td>

      <td>
        `job`
      </td>

      <td>
        Renamed<br/>The job can be used to identify the scrape kind.
      </td>
    </tr>

    <tr>
      <td>
        `scrapedTargetName`
      </td>

      <td>
        `-`
      </td>

      <td>
        Removed
      </td>
    </tr>

    <tr>
      <td>
        `scrapedTargetName`
      </td>

      <td>
        `instance`
      </td>

      <td>
        Renamed<br/>`instance` contains the `host:port` for the target
      </td>
    </tr>
  </tbody>
</table>

## Kubernetes target discovery [#K8s-target-discovery]

The target discovery configuration has improved with the introduction of the Jobs and can be easily configured as explained [here](http://link_to_targets/jobs_doc).

Default behaviors have changed between the two solutions. While, by default, `nri-prometheus` scrapes Pods and Services containing `prometheus.io/scrape=true` as a label or annotation, `newrelic-prometheus-agent` scrapes Pods and Endpoints from Services containing `prometheus.io/scrape=true` as an **annotation only**.

Node metrics are no longer scraped by default in `newrelic-prometheus-agent`.

## Metric types [#metric-types]

`nri-prometheus`, as a custom solution, converts Prometheus metrics to New Relic metrics before sending them, applying [mappings](/docs/infrastructure/prometheus-integrations/view-query-data/translate-promql-queries-nrql#compare) according to the metric metadata type read from the scraped data (`# TYPE <metric_type>`).

On `newrelic-prometheus-agent`, which leverages a standard Prometheus Server, metrics are sent directly to the New Relic's Remote Write endpoint which handles this conversion based on metric names. It is possible that some metrics will not be properly converted by the Remote Write endpoint on the following two cases:

 - Prometheus Counter metrics **without** the name suffix `total`, `count`, `sum` or `bucket` will be converted as **Gauge**.
 - Prometheus Gauge metrics **with** the name suffix `total`, `count`, `sum` or `bucket` will be converted as **Counter**.

Metric type mappings relabel configs can be added in order to correct this behavior.

## Transformations [#transformations]

`nri-prometheus` transformations are now replaced with Prometheus relabel configs. [Here](/docs/integrations/prometheus-integrations/install-configure-prometheus-configurator/filter-prometheus-metrics#metric-label-transformations) you can find a list of examples of relabel configs that cover different use cases from `nri-prometheus` transformations.

## Self-instrumentation [#self-instrumentation]

Similar to `nri-prometheus`, `newrelic-prometheus-agent` self-scrapes internal metrics. These metrics have the prefix `prometheus_` and can be used to observe the status of the Prometheus instance. By default, only a reduced set of these metrics are sent. You can find the list of metrics on the default [values.yaml](https://github.com/newrelic/newrelic-prometheus-configurator/blob/main/charts/newrelic-prometheus-agent/values.yaml) of the chart, searching for `job_name: self-metrics`.

New Relic also provides a curated dashboard for self-metrics with not only performance/health information but also metrics volume sent. You can install the dashboard using this [link](http://link_to_quickstart)


