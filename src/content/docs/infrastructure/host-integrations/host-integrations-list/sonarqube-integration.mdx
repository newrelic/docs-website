---
title: SonarQube monitoring integration
tags:
    - New Relic integrations
    - SonarQube
metaDescription: Use New Relic browser monitoring to get a dashboard with metrics from your SonarQube.
redirects: 
---
import SonarQubeDashboard from 'images/infrastructure_screenshot_full-sonarqube-dashboard.webp'

Use the New Relic Infrastructure agent and NRI-Prometheus to the instrument and monitor your SonarQube. Evaluate the data from your project, such as line duplications, flaws, and other mistakes in order to diagnose and optimize the code.

<img
    title="New Relic SonarQube dashboard"
    alt="New Relic SonarQube dashboard"
    src={SonarQubeDashboard}
/>
<figcaption>
After setting up our SonarQube integration, we give you a dashboard for your SonarQube metrics. 
</figcaption>

## Install the infrastructure agent [#infra]

The New Relic infrastructure agent is the foundation for getting your SonarQube data into New Relic. If you haven't already done so, install the agent using one of these options:

You can install the infrastructure agent two different ways:

* Our [guided install](https://one.newrelic.com/nr1-core?state=4f81feab-35f7-e97e-9903-52510f8542bd) is a CLI tool that inspects your system and installs the infrastructure agent alongside the application monitoring agent that best works for your system. To learn more about how our guided install works, check out our [Guided install overview](/docs/infrastructure/host-integrations/installation/new-relic-guided-install-overview).
* If you'd rather install our infrastructure agent manually, you can follow a tutorial for manual installation for [Linux](/docs/infrastructure/install-infrastructure-agent/linux-installation/install-infrastructure-monitoring-agent-linux), [Windows](/docs/infrastructure/install-infrastructure-agent/windows-installation/install-infrastructure-monitoring-agent-windows/), or [macOS](/docs/infrastructure/install-infrastructure-agent/macos-installation/install-infrastructure-monitoring-agent-macos/).

## Install PostgreSQL agent [#postgresql-install] 

If your infrastructure has PostgreSQL configured and running, then PostgreSQL agent will also be installed along with the New Relic infrastructure agent.

If in case this automated installation did not occur, then follow the below steps to install PostgreSQL agent.

Check the PostgreSQL agent installation steps in the [documentation](https://docs.newrelic.com/docs/infrastructure/host-integrations/host-integrations-list/postgresql/postgresql-integration/)

Follow the [PostgreSQL quickstart page](https://newrelic.com/instant-observability/postresql) to install the agent by clicking the `Install now` button.

You can also execute the below command to install PostgreSQL agent by updating the `YOUR_KEY` and the `ACCOUNT_ID` fields.
```
curl -Ls https://download.newrelic.com/install/newrelic-cli/scripts/install.sh | bash && sudo  NEW_RELIC_API_KEY=YOUR_KEY NEW_RELIC_ACCOUNT_ID=ACCOUNT_ID /usr/local/bin/newrelic install -n postgres-open-source-integration

```
## Integrate SonarQube with New Relic [#integrate]

<CollapserGroup>
<Collapser
    id="step1"
    title="Step 1. Creating a User Token on SonarQube Platform"
    >

Please follow the detailed [SonarQube documentation on creating a user token](https://docs.sonarqube.org/9.8/user-guide/user-account/generating-and-using-tokens/#using-a-token).

Follow the below steps to generate a user token on SonarQube

Login into SonarQube > My Account > Security

You will now see a form to create a token. Add the below fields in it.
Name your token
Make sure that you've selected the type as `user token`.

Copy the created token and save it in a file of your desired path.
</Collapser>
<Collapser
    id="step2"
    title="Step 2. Configuring NRI-Prometheus"
    >
First, create a file named `nri-prometheus-config.yml` in the path below:

Path: `/etc/newrelic-infra/integrations.d/nri-prometheus-config.yml`

Then, use our [configuration template](https://github.com/newrelic/nri-prometheus/blob/main/configs/nri-prometheus-config.yml.sample) to update the created file named `nri-prometheus-config.yml`.

Now, update the fields listed below:

1. cluster_name: `YOUR_DESIRED_CLUSTER_NAME`
2. bearer_token_file: `USER_TOKEN_FILE_PATH`
3. urls: `[“https://YOUR_HOST_IP:9000/api/monitoring/metrics”]`
4. Insecure_skip_verify: `true`

Your `nri-prometheus-config.yml` file should look like this:

```yml
integrations:
  - name: nri-prometheus
    config:
    # When standalone is set to false nri-prometheus requires an infrastructure agent to work and send data. Defaults to true
    standalone: false

    # When running with infrastructure agent emitters will have to include infra-sdk
    emitters: infra-sdk

    # The name of your cluster. It's important to match other New Relic products to relate the data.
    cluster_name: "YOUR_DESIRED_CLUSTER_NAME"
    bearer_token_file: "BEARER_TOKEN_FILE_PATH"

    targets:
      - description: Sonarqube metrics list
        urls: ["https://YOUR_HOST_IP:9000/api/monitoring/metrics"]
        bearer_token: true

    #    tls_config:
    #      ca_file_path: "/etc/etcd/etcd-client-ca.crt"
    #      cert_file_path: "/etc/etcd/etcd-client.crt"
    #      key_file_path: "/etc/etcd/etcd-client.key"

    # Whether the integration should run in verbose mode or not. Defaults to false.
    verbose: false

    # Whether the integration should run in audit mode or not. Defaults to false.
    # Audit mode logs the uncompressed data sent to New Relic. Use this to log all data sent.
    # It does not include verbose mode. This can lead to a high log volume, use with care.
    audit: true

    # The HTTP client timeout when fetching data from endpoints. Defaults to 30s.
    # scrape_timeout: "30s"

    # Length in time to distribute the scraping from the endpoints.
    scrape_duration: "30s"

    # Number of worker threads used for scraping targets.
    # For large clusters with many (&gt;400) endpoints, slowly increase until scrape
    # time falls between the desired `scrape_duration`.
    # Increasing this value too much will result in huge memory consumption if too
    # many metrics are being scraped.
    # Default: 4
    # worker_threads: 4

    # Whether the integration should skip TLS verification or not. Defaults to false.
    insecure_skip_verify: true

timeout: 10s
```
</Collapser>
<Collapser
id="step3"
    title="Step 3. Forward SonarQube logs to New Relic"
>
You can use our [log forwarding](https://docs.newrelic.com/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/) to forward SonarQube logs to New Relic.

On Linux machines, your log file named logging.yml should be present in the below path:
Path: `/etc/newrelic-infra/logging.d/`

If you don't see your log file in the above path, then you will need to create a log file by following the above log forwarding documentation.

After creating the log file, add the script below to the `logging.yml` file:

```yml
logs:
  - name: sonar_logs
    file: /opt/sonarqube/logs/sonar.log
    attributes: 
      logtype: sonar_logs
``` 
</Collapser>
<Collapser
id="step4"
    title="Step 4. Restart the New Relic infrastructure agent"
>

Before you can start reading your data, use the instructions in our [infrastructure agent docs](/docs/infrastructure/install-infrastructure-agent/manage-your-agent/start-stop-restart-infrastructure-agent/) to restart your infrastructure agent.

```shell
sudo systemctl restart newrelic-infra.service
```
</Collapser>
</CollapserGroup>

## Monitor your SonarQube

You can choose our pre-built dashboard template named `SonarQube` to monitor your SonarQube server metrics. Follow these steps to use our pre-built dashboard template:

1. Go to **[one.newrelic.com](https://one.newrelic.com/)** and click on **+ Add data**.
2.  Click on the **Dashboards** tab.
3.  In the search box, type `SonarQube`.
4.  When you see our pre-build dashboard, click on it to install it in your account.

Once your SonarQube server is integrated by following the above steps, the dashboard should reflect metrics on it.

To instrument the SonarQube quickstart and to see metrics and alerts, you can also follow our [SonarQube quickstart page](https://newrelic.com/instant-observability/apache-hadoop) that has an **Install now** button.

Run the below example query to see SonarQube metrics.

Below query is to check if SonarQube web is up or not.

```sql
SELECT latest(activeUsers) FROM HadoopResourceManagerSample
```
## See SonarQube metrics in a dashboard [#dash]

With only the infrastructure agent installed and instrumented with your SonarQube, you can view your raw data in our Metrics & events. Our default dashboards transform that raw data into charts and graphs, which provide a bird's eye view of your system's health. To install our default dashboards, go to our SonarQube instant observability page.

## What's next?

To learn more about building NRQL queries and generating dashboards, check out these docs:

* [Introduction to the query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder) to create basic and advanced queries.
* [Introduction to dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards) to customize your dashboard and carry out different actions.
* [Manage your dashboard](/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard) to adjust your dashboards display mode, or to add more content to your dashboard.
