---
title: Monitor self-hosted RabbitMQ with OpenTelemetry
tags:
  - Integrations
  - On-host integrations
  - On-host integrations list
metaDescription: "Install and configure RabbitMQ OpenTelemetry monitoring for Linux hosts."
freshnessValidatedDate: 2024-12-18
---

This guide walks you through installing the RabbitMQ OpenTelemetry integration on Linux hosts.

## Before you begin [#requirements]

Make sure your host meets the following requirements:

* RabbitMQ instance with the [management plugin](https://www.rabbitmq.com/management.html) enabled
* Shell access with sudo privileges to install and manage services
* Outbound HTTPS connectivity to New Relic's OTLP ingest endpoint
* Ability to install the OpenTelemetry Collector Contrib distribution

## Installation [#install]

### Step 1: Enable the RabbitMQ management plugin [#enable-plugin]

The management plugin exposes metrics that the OpenTelemetry Collector will scrape:

```bash
sudo rabbitmq-plugins enable rabbitmq_management
```

Verify it's working:

```bash
curl -I -u admin:password http://localhost:15672/api/overview
```

You should see `HTTP/1.1 200` in the response.

### Step 2: Install the OpenTelemetry Collector [#install-collector]

Choose your Linux distribution:

<CollapserGroup>
  <Collapser
    id="debian-ubuntu"
    title="Debian / Ubuntu"
  >
```bash
VERSION="0.140.0"
ARCH="amd64"
sudo apt-get update
sudo apt-get -y install wget
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v${VERSION}/otelcol-contrib_${VERSION}_linux_${ARCH}.deb
sudo dpkg -i otelcol-contrib_${VERSION}_linux_${ARCH}.deb
sudo systemctl enable --now otelcol-contrib
```

For ARM64 systems, change `ARCH="arm64"`.
  </Collapser>

  <Collapser
    id="rhel-centos"
    title="RHEL / CentOS"
  >
```bash
VERSION="0.140.0"
ARCH="amd64"
sudo yum update -y
sudo yum -y install wget
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v${VERSION}/otelcol-contrib_${VERSION}_linux_${ARCH}.rpm
sudo rpm -ivh otelcol-contrib_${VERSION}_linux_${ARCH}.rpm
sudo systemctl enable --now otelcol-contrib
```

For ARM64 systems, change `ARCH="arm64"`.
  </Collapser>
</CollapserGroup>

### Step 3: Configure the collector [#configure]

Create `/etc/otelcol-contrib/config.yaml` with your RabbitMQ details:

```yaml
receivers:
  rabbitmq:
    endpoint: http://localhost:15672
    username: admin
    password: password
    collection_interval: 30s
    metrics:
      rabbitmq.consumer.count:
        enabled: true
      rabbitmq.connection.count:
        enabled: true
      rabbitmq.queue.consumer.count:
        enabled: true
      rabbitmq.queue.count:
        enabled: true
      rabbitmq.queue.message.count:
        enabled: true
      rabbitmq.queue.message.ready:
        enabled: true
      rabbitmq.queue.message.unacknowledged:
        enabled: true

processors:
  resourcedetection:
    detectors: [system]
    system:
      resource_attributes:
        host.name:
          enabled: true
        host.id:
          enabled: true
  resource:
    attributes:
      - action: upsert
        key: rabbitmq.server.endpoint
        value: http://localhost:15672
      - action: upsert
        key: rabbitmq.deployment.name
        value: my-rabbitmq-server
  batch:
    timeout: 30s
    send_batch_size: 512
  transform/rabbitmq_metrics:
    metric_statements:
      - context: resource
        statements:
          - set(attributes["rabbitmq.display.name"], Concat(["server", attributes["rabbitmq.deployment.name"]], ":"))

exporters:
  otlphttp/newrelic:
    endpoint: ${env:NEWRELIC_OTLP_ENDPOINT}
    headers:
      api-key: ${env:NEWRELIC_LICENSE_KEY}
    compression: gzip

extensions:
  health_check:

service:
  pipelines:
    metrics:
      receivers: [rabbitmq]
      processors: [resourcedetection, resource, batch, transform/rabbitmq_metrics]
      exporters: [otlphttp/newrelic]
```

Update these values:
- `endpoint`: Your RabbitMQ management API URL
- `username` and `password`: Your RabbitMQ credentials
- `rabbitmq.deployment.name`: A unique name for this RabbitMQ server

### Step 4: Set environment variables [#env-vars]

Create a systemd override file:

```bash
sudo mkdir -p /etc/systemd/system/otelcol-contrib.service.d
```

Choose your New Relic region:

<Tabs>
  <TabsBar>
    <TabsBarItem id="us">US Region</TabsBarItem>
    <TabsBarItem id="eu">EU Region</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="us">
```bash
cat <<EOF | sudo tee /etc/systemd/system/otelcol-contrib.service.d/environment.conf
[Service]
Environment="NEWRELIC_OTLP_ENDPOINT=https://otlp.nr-data.net:4318"
Environment="NEWRELIC_LICENSE_KEY=YOUR_LICENSE_KEY"
EOF
```
    </TabsPageItem>

    <TabsPageItem id="eu">
```bash
cat <<EOF | sudo tee /etc/systemd/system/otelcol-contrib.service.d/environment.conf
[Service]
Environment="NEWRELIC_OTLP_ENDPOINT=https://eu-otlp.nr-data.net:4318"
Environment="NEWRELIC_LICENSE_KEY=YOUR_LICENSE_KEY"
EOF
```
    </TabsPageItem>
  </TabsPages>
</Tabs>

Replace `YOUR_LICENSE_KEY` with your [New Relic license key](/docs/apis/intro-apis/new-relic-api-keys/#license-key).

Reload and restart the service:

```bash
sudo systemctl daemon-reload
sudo systemctl restart otelcol-contrib.service
```

### Step 5: Verify the installation [#verify]

Check the service status:

```bash
sudo systemctl status otelcol-contrib
```

Review logs for any errors:

```bash
sudo journalctl -u otelcol-contrib -f
```

Verify data is flowing to New Relic with this NRQL query:

```sql
SELECT count(*) 
FROM Metric 
WHERE metricName LIKE 'rabbitmq.%' 
  AND instrumentation.provider = 'opentelemetry' 
FACET metricName 
SINCE 10 minutes ago
```

## Optional: Forward RabbitMQ logs [#logs]

To forward RabbitMQ logs to New Relic, add a filelog receiver to your configuration.

Update `/etc/otelcol-contrib/config.yaml` to include log forwarding:

```yaml
receivers:
  rabbitmq:
    # ... existing rabbitmq config ...
  filelog:
    include:
      - /var/log/rabbitmq/*.log

processors:
  # ... existing processors ...
  transform/rabbitmq_logs:
    log_statements:
      - context: resource
        statements:
          - set(attributes["rabbitmq.display.name"], Concat(["server", attributes["rabbitmq.deployment.name"]], ":"))

service:
  pipelines:
    metrics:
      receivers: [rabbitmq]
      processors: [resourcedetection, resource, batch, transform/rabbitmq_metrics]
      exporters: [otlphttp/newrelic]
    logs/rabbitmq:
      receivers: [filelog]
      processors: [batch, resource, transform/rabbitmq_logs]
      exporters: [otlphttp/newrelic]
```

Grant the collector permission to read logs:

```bash
sudo usermod -a -G rabbitmq otelcol-contrib
```

Or set permissions explicitly:

```bash
sudo chmod 644 /var/log/rabbitmq/*.log
```

Restart the collector:

```bash
sudo systemctl restart otelcol-contrib
```

## Troubleshooting [#troubleshoot]

### No data appearing

If you don't see data in New Relic:

- Verify the management plugin is enabled: `sudo rabbitmq-plugins list | grep management`
- Check the management API responds: `curl -u admin:password http://localhost:15672/api/overview`
- Review collector logs: `sudo journalctl -u otelcol-contrib -f`
- Confirm the collector service is running: `sudo systemctl status otelcol-contrib`

### Connection refused errors

If you see connection errors:

- Verify the RabbitMQ management API is accessible
- Check firewall rules allow access to port 15672
- Ensure credentials in the collector config are correct

## What's next? [#whats-next]

- [Query your RabbitMQ data](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder)
- [Create custom dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards)
- [Set up alerts](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/introduction-alerts) for queue depths and message backlogs
- Learn about the [metrics collected](/docs/infrastructure/host-integrations/host-integrations-list/rabbitmq-monitoring-integration#metrics)
