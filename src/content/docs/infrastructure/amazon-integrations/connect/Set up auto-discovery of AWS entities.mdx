---
title: Set up auto-discovery of AWS entities
tags:
  - Auto-discovery
  - Discover AWS entities
metaDescription: 'Set up auto-discovery feature for the new and existing AWS integrations.'
redirects:
freshnessValidatedDate: never
---
<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>


Auto-discovery is an Advanced Compute feature that automatically maps your AWS infrastructure, providing insights into the relationships between applications and their underlying resources. By enabling this feature, you gain a comprehensive view of your cloud environment, including current configurations and resource connections. Additionally, Auto-discovery offers a reliability scorecard to assess your infrastructure against AWS best practices, aiding in effective management and optimization.

With Auto-discovery, you can:
* Automatically detect and visualize the relationships between AWS entities on the maps.
* Keep your infrastructure topology updated as changes occur in your AWS environment.
* View the current configuration of your infrastructure resources.
* Assess the reliability of your infrastructure vai the AWS reliability scorecard.

## Set up AWS integration with auto-discovery for your account

<Steps>
<Step>
### Before you begin
To set up AWS integration, ensure you have the following:
* A New Relic [license key](https://one.newrelic.com/api-keys).
* An AWS account with [permissions](https://docs.aws.amazon.com/ARG/latest/userguide/gettingstarted-prereqs-permissions.html) to deploy new AWS resources and [IAM roles](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html).
* A New Relic account with [permissions](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/#infrastructure) for cloud integrations.
</Step>
<Step>
### Select data type

1. Log in to your [New Relic](https://one.newrelic.com/) account and navigate to <DNT>**Infrastructure > AWS**</DNT>.
3. To integrate with AWS, select a New Relic account and continue.
4. Select the data type as <DNT>**Metrics**</DNT>, <DNT>**Logs**</DNT>, or both, and continue.
5. Select <DNT>**Automate AWS with CloudFormation**</DNT> and continue. This is currently the only setup method available for log integration.
</Step>
<Step>
### Select integration method
Automating AWS integration with CloudFormation template is the recommended and the only integration method to enable auto-discovery. This method uses a single CloudFormation template to set up your AWS integration and forward New Relic AWS services metrics, logs, or both. Continue with <DNT>**Automate AWS with CloudFormation (Recommended)**</DNT> .
</Step>
<Step>
### Select integration type

<CollapserGroup>
<Collapser id="metrics-data-type" title="For Metrics data type">
 If you have selected <DNT>**Metrics**</DNT> as data type, to set up integration, preform the following steps:
1. Select metric integration type:
    * <DNT>**[CloudWatch Metric Streams](/install/aws-cloudwatch/)**</DNT> is the recommended method to create a real-time stream of metrics to New Relic.
    * <DNT>**[API Polling](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)**</DNT> is a legacy solution to receive AWS data in New Relic.
  
2. Give a name to the selected integration.
3. <DNT>**CloudWatch Metric Streams**</DNT> doesn't support few AWS services mentioned on the screen. If you want to include those services, select <DNT>**Yes**</DNT> and continue to configure API polling for those.
4. Give a name for the API integration.
5. Select the services you want to include in the integration, and continue.
</Collapser>

<Collapser id="log-data-type" title="For Logs data type">
 If you have selected <DNT>**Logs**</DNT> as data type, then there are multiple ways to send logs from your AWS services to New Relic. Select the path that best suits your needs. Both the integration instructions and the CloudFormation stack adapts to your selections.

1. Select AWS sink(s):
    Most AWS service logs are generated in S3 buckets or CloudWatch log groups. Select one or both AWS sinks.
2. Select log integration path(s):
    <DNT>**Amazon Kinesis Data Firehose**</DNT> is for direct and high-volume data streaming, and the <DNT>**New Relic Lambda Function**</DNT> is for high control over data transformation before forwarding logs.
3. Set up triggers(s):
    Setting up triggers ensures that new logs are sent to New Relic every time an AWS service logs to an S3 bucket or a CloudWatch log group. With a single CloudFormation stack, you can configure up to 40 triggers (S3 buckets and/or CloudWatch log groups).
    * For AWS service logs stored in S3 buckets, specify the **S3 bucket name** and **Prefix** (optional).
    * For AWS service logs stored in CloudWatch log groups, specify the **Log Group** name and **Filter** (optional).
4. Select New Relic logs API endpoint:
    The system automatically sets the endpoint based on the region of your New Relic account.
    * For US account, logs are sent to `https://log-api.newrelic.com/log/v1`
    * For UE account, logs are sent to `https://log-api.eu.newrelic.com/log/v1`
5. Add custom attributes:
    Add custom attributes to organize your logs and make it easier to search, filter, analyze, and parse.
</Collapser>
</CollapserGroup>

</Step>
<Step>
### Enable auto-discovery
Turn on the scan to enable auto-discovery of your AWS entities and continue. It enables the `cloudformation:StartResourceScan` permission in your AWS account to scan your AWS resources and discover the relationships between them.
</Step>
<Step>
### Connect to AWS
1. Click <DNT>**Launch your CloudFormation in AWS**</DNT> to navigate to your AWS Console. The CloudFormation stack includes the configured parameters based on your selections in New Relic One, so no additional editing is necessary unless you want to make changes.
2. Copy and paste your license key into your AWS console.

We recommend you store your New Relic license key in <DNT>**[AWS Secrets Manager](https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html)**</DNT> by keeping the environment variable set to `true` (default value).
</Step>
<Step>
### Deploy the CloudFormation stack
After you customize the CloudFormation stack parameters to meet your requirements, click <DNT>**Create stack**</DNT>.
Creating the stack's resources may take several minutes and may generate multiple stacks, depending on how you configure log and metric forwarding. With a single deployment command, you can create a new stack to forward logs from multiple AWS resources.
If stack creation fails, refer to the [troubleshooting procedure](/docs/logs/troubleshooting/aws-log-integration-issues/stack-creation-fails).
</Step>
<Step>
### Validate the AWS data on New Relic
After the new stack is created, go to <DNT>**[New Relic](https://one.newrelic.com/) > Infrastructure > AWS**</DNT> to view all integrated AWS services. If any New Relic service is connected to AWS entities, you can view its map to see relationships with those AWS entities and the intra-service relationships among them.
</Step>
</Steps>

## Set up auto-discovery for an existing AWS integration

If you have already set up an AWS integration and want to enable auto-discovery, follow these steps:

<Steps>
<Step>
### Before you begin
To set up AWS integration, ensure you have the following:
* An AWS account with [permissions](https://docs.aws.amazon.com/ARG/latest/userguide/gettingstarted-prereqs-permissions.html) to deploy new AWS resources and [IAM roles](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html).
* A New Relic account with [permissions](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/#infrastructure) for cloud integrations.
</Step>
<Step>
### Edit account

1. To enable auto-discovery, log in to your [New Relic](https://one.newrelic.com/) account and navigate to <DNT>**Infrastructure > AWS**</DNT>.
2. Click the <DNT>**Manage Autodiscovery**</DNT> button.
3. A new page which lists the AWS Accounts associated with your New Relic Account will appear, along with the associated Autodiscovery status.
4. Click on the Enable link.
</Step>
<Step>
### Add permissions
1. To enable the <DNT>**Auto Discovery**</DNT> feature, click <DNT>**Launch Cloudformation Template**</DNT>.
2. On the AWS console, acknowledge the CloudFormation stack creation and click <DNT>**Create stack**</DNT>.
3. After the stack is created,return to the confirmation screen of New Relic One.
4. New Relic will scan all regions enabled in your account and scan once a day by default.If you wish to change this, click <DNT>**Which Regions do you want us to scan?**</DNT> and select or remove regions as desired.
5. To change the frequency of the scan, click <DNT>**How often do you want us to scan?**</DNT> and select either Once a Day or Twice a Day as desired.
</Step>
<Step>
### Enable auto-discovery
To enable auto-discovery, On the confirmation screen of New Relic One, click <DNT>**Save**</DNT>.
</Step>

</Steps>