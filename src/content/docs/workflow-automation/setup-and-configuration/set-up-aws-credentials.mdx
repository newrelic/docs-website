---
title: Set up AWS credentials for workflow automation
metaDescription: "Learn how to set up AWS credentials for workflow automation."
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

To integrate your workflow automation with AWS actions, configure your AWS credentials by creating IAM users and roles, and setting up both static and session AWS credentials for integration.

<Callout variant="important">
For enhanced security and simplified permission management within AWS, it is recommended to use IAM roles instead of traditional access keys (long- or short-term credentials), which are also covered here.
</Callout>

## Create an IAM user for managing workflow automation [#create-an-iam-user]

1. Access account settings by logging in to the [AWS console](https://aws.amazon.com/console/) and selecting your account name.
2. For user management, navigate to the **IAM service** and click **Users** in the sidebar.
3. To add a new user, click **Create User**.
4. Specify user details by entering a name in the **User details** field (e.g., `workflow-automation-user`) and click **Next**.
5. Assign permissions by setting the desired permissions for your user and click **Next**.
6. Finalize the user creation by reviewing your settings and click **Create User**.
7. Generate access keys by selecting **Create access key** under the **Security Credentials** tab.

## Generate session credentials [#generate-session-credentials]

To generate temporary credentials based on an IAM role:

1. Set up the **AWS Command Line Interface (CLI)** using the [installation guide](https://aws.amazon.com/cli/).
2. Configure **AWS CLI** with static credentials by running:

   ```bash
   aws configure
   ```

3. Enter your static access credentials: `Access Key`, `Secret Access Key`, `region`, and `output` format.

    <img
      title="Image of the Static Access credentials"
      alt="Image of the Static Access credentials"
      src="/images/static-access.webp"
    />

4. Use **AWS STS (Security Token Service)** to assume the role:

    ```bash
    aws sts assume-role --role-arn "arn:aws:iam::123456789012:role/MyRole" --role-session-name "MySession"
    ```

5. Extract and use the session credentials from the output:

    ```json
    {
      "Credentials": {
          "AccessKeyId": "ASIAxxxxxx",
          "SecretAccessKey": "xxxx/example",
          "SessionToken": "FQoGZXIvYXdzxxxx/...",
          "Expiration": "2023-09-30T12:00:00Z"
      },
      "AssumedRoleUser": {
          "AssumedRoleId": "AROAxxxxxxxxx:MySession",
          "Arn": "arn:aws:sts::123456789012:assumed-role/MyRole/MySession"
      }
    }
    ```

## Create an IAM Role

1. Log in to the [AWS console](https://aws.amazon.com/console/) and select your account name.
2. Navigate to the **IAM service** and select **Roles** from the left navigation pane.
3. Click **Create role**.
4. For the **Trusted entity** type, select **AWS account**.
5. Choose the **Another AWS account** radio button and enter the New Relic AWS [account ID](/docs/accounts/accounts-billing/account-structure/account-id).
6. Enhance security by selecting the **Require external ID** checkbox and entering your New Relic account ID (the one managing your workflows).

<Callout variant="important">

  You'll find New Relic's **AWS account ID** and the necessary external ID in the table below:

    - Specify **AWS account ID** as shown to grant privileges to assume the role.
    - Provide the **external ID** to enhance security, where the external ID is your **New Relic account ID** managing the workflows.

  <CollapserGroup>
    <Collapser
        id="required information at the time of creating an iam role"
        title="Required information at the time of creating an IAM role"
    >
      <table>
        <thead>
          <tr>
            <th>Platform</th>
            <th>AWS Account Id</th>
            <th>External Id (NR Account Id)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>one.newrelic.com</td>
            <td>253490767857</td>
            <td>Newrelic Account Id used for managing workflow automation.</td>
          </tr>
        </tbody>
      </table>
        </Collapser>
</CollapserGroup>
</Callout>

7. Click **Next: Permissions**.
8. Attach the necessary policies to the role and provide a name for the IAM role, such as `NewRelicWorkflowAutomationRole`.
9. Click **Create role**.

Here's a sample trust policy for your role. Replace `<nrAccountID>` with your actual New Relic account ID:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "sts:AssumeRole",
            "Principal": {
                "AWS": "arn:aws:iam::253490767857:root"
            },
            "Condition": {
                "StringEquals": {
                    "sts:ExternalId": "<nrAccountID>"
                }
            }
        }
    ]
}
```

## Configure New Relic

After you've obtained AWS credentials that your workflow will use directly—like static access keys from an IAM user or session tokens you've generated—you will need a secure place to store them. You can use New Relic's secrets management for this. The GraphQL mutation below shows you how. (If you've set up an IAM role for New Relic to assume on your behalf, as described in the 'Create an IAM role' section, typically configure that role ARN directly in your New Relic workflow or service, not by storing the ARN as a secret here.)

```graphql
mutation {
 secretsManagementCreateSecret(
   scope: {type: ACCOUNT id: "12345678"}
   namespace: "aws"
   key: "my-aws-credentials"
   description: "AWS credentials for my workflow"
   value: "****************YIOB"
 ) {
   key
 }
}
```

You'll need to set these fields:

- `id`: This is your New Relic account ID.
- `namespace`: This field is optional. If you decide to use it, provide an alphanumeric string to help you categorize your secret.
- `key`: Use an alphanumeric string here. This key is how you'll reference this secret later.
- `description`: This is also optional. You can add a description for your own records.
- `value`: This is where you'll put the actual AWS credential string (like an access key, secret key, or session token) that you want to store securely.

You can run this mutation using the [GraphQL](https://one.newrelic.com/nerdgraph-graphiql) tool with your New Relic user API key. If your submission is successful, you'll see a result similar to this:

```json
  {
    "data": {
      "secretsManagementCreateSecret": {
        "key": "my-aws-credentials"
      }
  }
```