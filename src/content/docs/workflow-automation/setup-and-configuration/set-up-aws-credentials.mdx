---
title: Set up AWS credentials
metaDescription: "Configure AWS credentials for workflow automation using IAM roles, IAM users, or temporary session tokens."
freshnessValidatedDate: never
---

Authorize New Relic workflow automation to perform actions in your AWS account. You'll configure an authentication method that allows workflows to securely interact with AWS services like EC2, SQS, DynamoDB, and more—without hardcoding credentials or compromising security.

## Prerequisites

Before setting up AWS credentials, ensure you have:
  - An AWS account with permission to create IAM roles or users.
  - Your [New Relic account ID](/docs/accounts/accounts-billing/account-structure/account-id).
  - Admin access to the [AWS IAM Console](https://console.aws.amazon.com/iam/).
  - [AWS CLI installed and configured](https://aws.amazon.com/cli/)
  - An existing IAM role you can assume

## Understand required permissions [#required-permissions]

Before creating credentials, understand what permissions your workflows need. Grant only the permissions your workflows actually use—this follows the principle of least privilege and minimizes security risk.

### Common workflow permissions

<table>
    <thead>
        <tr>
            <th style={{ width: "200px" }}>
                **Workflow type**
            </th>
            <th>
                **Required AWS permissions**
            </th>
            <th>
                **Description**
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
              **EC2 management**
            </td>
            <td>
              <p>
              `ec2:DescribeInstances`
              </p>
              <p>
              `ec2:StopInstances`
              </p>
              <p>
              `ec2:StartInstances`
              </p>
              <p>
              `ec2:ModifyInstanceAttribute`
              </p>
            </td>
            <td>
              Stop, start, or modify EC2 instances in response to alerts
            </td>
        </tr>
        <tr>
            <td>
              **SQS messaging**
            </td>
            <td>
              `sqs:SendMessage`
              <p>
              `sqs:GetQueueAttributes`
              </p>
            </td>
            <td>
              Send messages to SQS queues for downstream processing
            </td>
        </tr>
        <tr>
            <td>
              **API Gateway**
            </td>
            <td>
              `apigateway:GET`
              <p>
              `apigateway:PUT`
              </p>
            </td>
            <td>
              Roll back API Gateway deployments or configurations
            </td>
        </tr>
        <tr>
            <td>
              **Systems Manager**
            </td>
            <td>
              `ssm:CreateDocument`
              <p>
              `ssm:DeleteDocument`
              </p>
              <p>
              `ssm:StartAutomationExecution`
              </p>
              <p>
              `ssm:GetAutomationExecution`
              </p>
            </td>
            <td>
              Execute automation runbooks
            </td>
        </tr>
        <tr>
            <td>
              **DynamoDB**  
            </td>
            <td>
              `dynamodb:Query`
              <p>
              `dynamodb:GetItem`
              </p>
              <p>
              `dynamodb:PutItem`
              </p>
            </td>
            <td>
              Read from or write to DynamoDB tables
            </td>
        </tr>
    </tbody>
</table>

<Callout variant="tip">
  Start with read-only permissions (`Describe*`, `Get*`, `List*`), then add write permissions (`Put*`, `Create*`, `Delete*`) only as needed. This prevents accidental destructive actions during testing.
</Callout>

## Set up authentication

Choose the method that matches your use case from the table above:

<Tabs>
  <TabsBar>
    <TabsBarItem id="iam-role-1">IAM role (recommended)</TabsBarItem>
    <TabsBarItem id="iam-user-1">IAM user with access keys</TabsBarItem>
    <TabsBarItem id="session-tokens-1">Session tokens</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="iam-role-1">
      An IAM role allows New Relic to assume temporary credentials in your AWS account without requiring permanent access keys.

      ### IAM role characteristics:
        - Credentials rotate automatically
        - Access is time-limited by design
        - All actions are logged in AWS CloudTrail
        - Aligns with AWS security best practices

      ### Create the role in AWS

        1. Sign in to the [AWS IAM Console](https://console.aws.amazon.com/iam/)
        2. Navigate to **Roles > Create role > Trusted entity type** and select **AWS account > another AWS account**
        3. In the **Account ID** field, enter: `253490767857`
        4. Under **Options**, check **Require external ID**
        5. In the **External ID** field, enter your New Relic account ID and click **Next**.
            - Don't have it? [Find your account ID here](/docs/accounts/accounts-billing/account-structure/account-id)
        6. On the **Add permissions** page, attach policies based on your workflows:
            - For EC2 workflows: Attach `AmazonEC2ReadOnlyAccess` or create a custom policy
            - For SQS workflows: Attach `AmazonSQSFullAccess` or limit to specific queues
            - For other services: See [Required AWS permissions](#required-aws-permissions)
        7. Click **Next**.
        8. Enter a role name: `NewRelicWorkflowAutomationRole` (or your preferred name)
        9. Optionally add a description: "Allows New Relic workflow automation to perform actions in AWS", and click **Create role**.

          ### Verify the trust policy

          After creating the role, verify the trust relationship:

            1. In the IAM console, select your newly created role
            2. Click the **Trust relationships** tab
            3. Confirm the policy matches this structure (replace `<YOUR_NR_ACCOUNT_ID>` with your actual account ID):

              ```json
                {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": "sts:AssumeRole",
                            "Principal": {
                                "AWS": "arn:aws:iam::253490767857:root"
                            },
                            "Condition": {
                                "StringEquals": {
                                    "sts:ExternalId": "<YOUR_NR_ACCOUNT_ID>"
                                }
                            }
                        }
                    ]
                }
              ```

              ### Copy your role ARN

              You'll need the role ARN to configure workflows:

              1. In the IAM console, select your role
              2. In the **Summary** section, locate the **ARN** field
              3. Copy the full ARN—it looks like: `arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole`
              4. Save this ARN securely—you'll paste it directly into workflow configurations

              <Callout variant="tip">
                **Important:** Role ARNs go directly in workflow inputs—don't store them in [secrets manager](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials). They're not sensitive credentials; they're resource identifiers.
              </Callout>

              The role is now configured. Use the ARN in workflow configurations that require AWS access.
    </TabsPageItem>

    <TabsPageItem id="iam-user-1">
      Use this method for testing environments or when IAM roles aren't supported. Access keys are long-lived credentials that require manual rotation.

      **Use cases:**
        - Testing and development environments
        - AWS configurations that don't support cross-account role assumption
        - Simplified authentication workflows

      <Callout variant="caution">
        Access keys are long-lived credentials. Rotate them regularly (every 90 days) and limit permissions to only what your workflows need.
      </Callout>

      ### Create the IAM user

        1. Sign in to the [AWS IAM Console](https://console.aws.amazon.com/iam/)
        2. Navigate to **Users > Create user** and enter a username: `workflow-automation-user` (or your preferred name)
        3. Click **Next**
        4. On the **Set permissions** page, choose **Attach policies directly**
        5. Search for and select policies based on your workflows:
            - For SQS: Select `AmazonSQSFullAccess`
            - For EC2: Select `AmazonEC2ReadOnlyAccess`
            - Or create a custom policy with limited permissions (recommended)
        6. Click **Next**, then **Create user**

      ### Generate access keys

        1. In the users list, select your newly created user
        2. Click the **Security credentials** tab
        3. In the **Access keys** section, choose **Create access key**
        4. Select **Application running outside AWS** and click **Next**
        5. (Optional) Add a description tag: "New Relic workflow automation"
        6. Choose **Create access key**
        7. Copy both credentials immediately:
            - **Access key ID** (starts with `AKIA...`)
            - **Secret access key** (shown only once)

          <Callout variant="important">
            AWS displays the secret access key only once during creation. If you don't save it, you'll need to generate a new key pair.
          </Callout>

      ### Store credentials securely

        Never hardcode AWS credentials in workflows. Store them in New Relic's [secrets manager](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials) instead.

          1. Open the [NerdGraph GraphiQL explorer](https://one.newrelic.com/nerdgraph-graphiql)
          2. Run this mutation to store your Access Key ID (replace the placeholder values):

            ```yaml
              mutation {
                secretsManagementCreateSecret(
                  scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
                  namespace: "aws"
                  key: "awsAccessKeyId"
                  description: "AWS Access Key ID for workflow automation"
                  value: "YOUR_AWS_ACCESS_KEY_ID"
                ) {
                  key
                }
              }
            ```

          3. Run another mutation for your Secret Access Key:

            ```yaml
              mutation {
                secretsManagementCreateSecret(
                  scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
                  namespace: "aws"
                  key: "awsSecretAccessKey"
                  description: "AWS Secret Access Key for workflow automation"
                  value: "YOUR_AWS_SECRET_ACCESS_KEY"
                ) {
                  key
                }
              }
            ```

          **Reference these secrets in workflows** using the syntax: `${{ :secrets:awsAccessKeyId }}`

            <Callout variant="tip">
              Use the `namespace` field to organize secrets by environment (`aws-prod`, `aws-staging`) or team name.
            </Callout>
    </TabsPageItem>

    <TabsPageItem id="session-tokens-1">
      Session tokens provide temporary credentials with automatic expiration.

      **Use cases:**
        - Local development and testing
        - CI/CD pipelines requiring credential rotation
        - Environments with compliance requirements for time-limited access (typically 1-12 hours)

      ### Generate temporary credentials

        1. Open your terminal and run this command (replace with your role ARN):

          ```yaml
            aws sts assume-role \
              --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/YOUR_ROLE" \
              --role-session-name "WorkflowAutomationSession"
          ```

          If this is your first time using AWS CLI, you may need to configure it with `aws configure` and enter your access credentials:

          <img
            title="Image of the Static Access credentials"
            alt="Image of the Static Access credentials"
            src="/images/static-access.webp"
          />

        2. AWS returns three values—you need all three:

          ```json
            {
              "Credentials": {
                  "AccessKeyId": "ASIAIOSFODNN7EXAMPLE",
                  "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
                  "SessionToken": "FQoGZXIvYXdzEBk...",
                  "Expiration": "2025-01-25T12:00:00Z"
              }
            }
          ```

        3. Store all three credentials in [secrets manager](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials):
          - `AccessKeyId` store as `awsAccessKeyId`
          - `SecretAccessKey` store as `awsSecretAccessKey`
          - `SessionToken` store as `awsSessionToken`

          <Callout variant="caution">
            Session tokens expire (typically after 1 hour). Set a reminder to refresh them before the `Expiration` timestamp, or your workflows will fail with authentication errors.
          </Callout>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Use credentials in workflows [#use-credentials]

  After setting up authentication, reference your credentials in workflow configurations:

### IAM role (recommended)

  Paste the role ARN directly into workflow inputs—no [secrets manager](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials) needed:

  ```yaml
    awsRoleArn: arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole
  ```

  <Callout variant="important">
    Role ARNs are resource identifiers, not sensitive credentials. Don't store them in secrets manager—paste them directly into workflow configurations.
  </Callout>

### IAM user or session tokens

  Reference [secrets manager](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials) for access keys:

  ```yaml
    awsAccessKeyId: ${{ :secrets:awsAccessKeyId }}
    awsSecretAccessKey: ${{ :secrets:awsSecretAccessKey }}
    awsSessionToken: ${{ :secrets:awsSessionToken }}  # Only for session tokens
  ```

  New Relic retrieves secrets at runtime, authenticates with AWS, then discards them. Your credentials never appear in logs or workflow history.

## Policy examples

  Use these complete IAM policy templates for common workflow types. Each follows the principle of least privilege by restricting access to specific resources.

<CollapserGroup>
  <Collapser
    id="sqs-policy"
    title="SQS messaging workflow"
  >
    Restrict access to a specific queue:

    ```json
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sqs:SendMessage",
            "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
          },
          {
            "Effect": "Allow",
            "Action": "sqs:GetQueueAttributes",
            "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
          }
        ]
      }
    ```

    Replace `us-west-2` with your region, `123456789012` with your AWS account ID, and `my-workflow-queue` with your queue name.
      </Collapser>

      <Collapser
        id="ec2-policy"
        title="EC2 management workflow"
      >
    Restrict access to specific instances by tag:

    ```json
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "ec2:DescribeInstances",
              "ec2:DescribeTags"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "ec2:StopInstances",
              "ec2:StartInstances",
              "ec2:ModifyInstanceAttribute"
            ],
            "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/*",
            "Condition": {
              "StringEquals": {
                "aws:ResourceTag/Environment": "production"
              }
            }
          }
        ]
      }
    ```

    This policy allows workflows to *stop/start/modify* only EC2 instances tagged with `Environment=production`.
  </Collapser>

  <Collapser
    id="dynamodb-policy"
    title="DynamoDB workflow"
  >
    Restrict access to a specific table:

    ```json
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "dynamodb:Query",
              "dynamodb:GetItem",
              "dynamodb:PutItem"
            ],
            "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/WorkflowData"
          }
        ]
      }
    ```

    Replace `WorkflowData` with your table name.
    </Collapser>

    <Collapser
      id="ssm-policy"
      title="Systems Manager workflow"
    >
    Restrict access to specific automation documents:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ssm:CreateDocument",
            "ssm:DeleteDocument"
          ],
          "Resource": "arn:aws:ssm:us-east-1:123456789012:document/WorkflowAutomation-*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ssm:StartAutomationExecution",
            "ssm:GetAutomationExecution"
          ],
          "Resource": [
            "arn:aws:ssm:us-east-1:123456789012:automation-definition/WorkflowAutomation-*:*",
            "arn:aws:ssm:us-east-1:123456789012:automation-execution/*"
          ]
        }
      ]
    }
    ```

    This restricts automation documents to those prefixed with `WorkflowAutomation-`.
  </Collapser>

  <Collapser
    id="apigateway-policy"
    title="API Gateway workflow"
  >
    Restrict access to a specific API:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "apigateway:GET",
            "apigateway:PUT"
          ],
          "Resource": "arn:aws:apigateway:us-west-2::/restapis/abc123xyz/*"
        }
      ]
    }
    ```

    Replace `abc123xyz` with your API Gateway ID.
  </Collapser>
</CollapserGroup>

### Additional resources

  For comprehensive AWS permission references:

    - **[AWS integrations managed policies](/docs/infrastructure/amazon-integrations/get-started/integrations-managed-policies/)**: Complete list of AWS permissions by service, plus CloudFormation templates you can adapt
    - **[Set up AWS API polling](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)**: Additional setup patterns

  <Callout variant="important">
    Those resources use account ID `754728514883` for cloud integrations (monitoring). For workflow automation, always use `253490767857`.
  </Callout>

## Related topics [#related-topics]

<DocTiles>
  <DocTile title='AWS actions' path="/docs/workflow-automation/setup-and-configuration/actions-catalog/actions-catalog">Browse EC2, Lambda, S3, SQS, and other AWS actions</DocTile>
  <DocTile title='EC2 management example' path="/docs/workflow-automation/workflow-examples/advanced/ec2-management">See AWS credentials in action with EC2 workflows</DocTile>
  <DocTile title='Create destinations' path="/docs/workflow-automation/setup-and-configuration/create-destinations">Set up Slack and email notifications for workflows</DocTile>
  <DocTile title='Workflow best practices' path="/docs/workflow-automation/limitations-and-faq/workflow-best-practices">Security best practices for credentials and secrets</DocTile>
</DocTiles>