---
title: "AWS Systems Manager actions"
tags:
  - workflow automation
  - workflow
  - workflow automation actions
  - AWS actions
  - AWS Systems Manager actions
metaDescription: "A list of available aws systems manager actions in the actions catalog for workflow definitions"
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

This page provides a comprehensive reference for aws systems manager actions available in the workflow automation actions catalog. These actions enable you to systems manager automation and document operations.

## Prerequisites

Before using AWS actions in workflow automation, ensure you have:

  * An AWS account with appropriate permissions.
  * AWS credentials configured (IAM user credentials, IAM role ARN, or session credentials).
  * The necessary IAM permissions for the specific AWS services you plan to use.

See [Set up AWS credentials](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/) for information on how to create IAM users and IAM roles, and set up static and session AWS credentials for integration with workflow automation AWS actions.

<CollapserGroup>
    <Collapser
        id="aws-systemsmanager.writedocument"
        title="Write SSM doc to AWS"
    >
  Write an SSM document to the AWS account based on the aws credentials passed in the action input. See [AWS Systems Manager Documentation](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway)

  <Tabs>
    <TabsBar>
      <TabsBarItem id="writedocumentinputs">
        Inputs
      </TabsBarItem>

      <TabsBarItem id="writedocumentoutputs">
        Outputs
      </TabsBarItem>

      <TabsBarItem id="writedocumentexample">
        Example
      </TabsBarItem>
    </TabsBar>

    <TabsPages>
      <TabsPageItem id="writedocumentinputs">
      <table>
        <thead>
            <tr>
                <th>Input Field</th>
                <th>Optionality</th>
                <th>Type</th>
                <th>Example</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**awsRoleArn**</td>
                <td>Optional</td>
                <td>String</td>
                <td>`arn:aws:iam::123456789012:role/my-workflow-role`</td>
            </tr>
            <tr>
                <td>**awsAccessKeyId**</td>
                <td>Optional</td>
                <td>String</td>
                <td>`${{ :secrets:<awsAccessKeyId> }}`</td>
            </tr>
            <tr>
                <td>**awsSecretAccessKey**</td>
                <td>Optional</td>
                <td>String</td>
                <td>`${{ :secrets:<awsSecretAccessKey> }}`</td>
            </tr>
            <tr>
                <td>**awsSessionToken**</td>
                <td>Optional</td>
                <td>String</td>
                <td>`${{ :secrets:<awsSessionToken> }}`</td>
            </tr>
            <tr>
                <td>**region**</td>
                <td>Required</td>
                <td>String</td>
                <td>`region: "us-east-2"`</td>
            </tr>
            <tr>
                <td>**documentName**</td>
                <td>Required</td>
                <td>String</td>
                <td>`documentName: "my-ssm-document"`</td>
            </tr>
            <tr>
                <td>**documentType**</td>
                <td>Optional</td>
                <td>String</td>
                <td>
                `documentType: "Command"`
                <p>Check valid values from [here](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).</p>
                </td>
            </tr>
            <tr>
                <td>**documentFormat**</td>
                <td>Optional</td>
                <td>String</td>
                <td>
                `documentFormat: "YAML"`
                <p>Check valid values from [here](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).</p>
                </td>
            </tr>
            <tr>
                <td>**documentContent**</td>
                <td>Required</td>
                <td>String</td>
                <td>Check example</td>
            </tr>
            <tr>
                <td>**override**</td>
                <td>Optional</td>
                <td>Boolean</td>
                <td>
                `override: true (default)`.
                
                <p>When `true`, always write the document with the provided name even if one already exist.</p>

                <p>When `false`, if a document with the provided `documentName` already exist, the action returns `success: false` and `errorMessage: Document already exists. Please enable override if you want to update the existing document.`</p>
                </td>
            </tr>
            <tr>
                <td>**selectors**</td>
                <td>Optional</td>
                <td>list</td>
                <td>`[{\"name\": \"documentName\", \"expression\": \".documentName\"}, {\"name\": \"documentType\", \"expression\": \".documentType\"}, {\"name\": \"documentStatus\", \"expression\": \".documentStatus\"}, {\"name\": \"success\", \"expression\": \".success\"}]`</td>
            </tr>
        </tbody>
    </table>
    </TabsPageItem>

    <TabsPageItem id="writedocumentoutputs">
    <table>
      <thead>
          <tr>
              <th>Output Field</th>
              <th>Type</th>
              <th>Description and example</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>**documentName**</td>
              <td>String</td>
              <td>`documentName: "my-ssm-document"`</td>
      </tr>
          <tr>
              <td>**documentVersion**</td>
              <td>String</td>
              <td>`documentVersion: 1`</td>
          </tr>
          <tr>
              <td>**documentType**</td>
              <td>String</td>
              <td>`documentType: "Command"`</td>
          </tr>
          <tr>
              <td>**documentStatus**</td>
              <td>String</td>
              <td>
              `documentStatus: "Active"`
              
              <p>The value will be one of the statuses from [here](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).</p>
              </td>
          </tr>
          <tr>
              <td>**success**</td>
              <td>Boolean</td>
              <td>`success: true`</td>
          </tr>
          <tr>
              <td>**errorMessage**</td>
              <td>String</td>
              <td>`errorMessage: "Some error message from ssm"`</td>
          </tr>
      </tbody>
    </table>

      <Callout variant="important">
        - In action input, only `awsAccessKeyId` and `awsSecretAccessKey` can be provided but they should be static credentials of an IAM user.
        - If session credentials are to be used, `awsAccessKeyId`, `awsSecretAccessKey` and `awsSessionToken` must be passed to action input.
        - The selectors to get the only specified parameters as output.
        - Refer to [AWS credentials](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials) for instructions.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="writedocumentexample">

    **Example 1**: A simple SSM document to list all lambda function 
    
```yaml
schemaVersion: '0.3'
description: List all Lambda function names.
mainSteps:
  - name: ExecuteAwsApi
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: lambda
      Api: ListFunctions
    outputs:
      - Name: resultFunctionName
        Selector: $..FunctionName
        Type: StringList
outputs:
  - ExecuteAwsApi.resultFunctionName
```

  **Complete autoflows definition with SSM listing lambda functions**

```yaml
name: aws-api

workflowInputs:
  key:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
  access:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
  token:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
  region:
    type: String
    defaultValue: us-east-2

steps:
  - name: createSsmDocument
    type: action
    action: aws.systemsManager.writeDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      selectors:
        - name: documentName
          expression: '.documentName'
        - name: documentType
          expression: '.documentType'
        - name: documentStatus
          expression: '.documentStatus'
        - name: success
          expression: '.success'
      documentName: "LambdaListFunctionNames"
      documentContent: |
        schemaVersion: '0.3'
        description: List all Lambda function names.
        mainSteps:
          - name: ExecuteAwsApi
            action: aws:executeAwsApi
            isEnd: true
            inputs:
              Service: lambda
              Api: ListFunctions
            outputs:
              - Name: resultFunctionName
                Selector: $..FunctionName
                Type: StringList
        outputs:
          - ExecuteAwsApi.resultFunctionName

  - name: generateIdempotencyToken
    type: action
    action: utils.uuid.generate
    version: 1

  - name: start1
    type: action
    action: aws.systemsManager.startAutomation
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

  - name: waitForCompletion
    type: action
    action: aws.systemsManager.waitForAutomationStatus
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
      # Optional, default is Success and Failed
      automationExecutionStatuses:
        - "Success"
        - "Failed"
      timeout: 60

  - name: hasCompleted
    type: switch
    switch:
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
        next: displayError
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
        next: displaySuccess
    next: displayUnexpected

  - name: displayUnexpected
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
    next: cleanupSsmDocument

  - name: displaySuccess
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
    next: cleanupSsmDocument

  - name: displayError
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
    next: cleanupSsmDocument

  - name: cleanupSsmDocument
    type: action
    action: aws.systemsManager.deleteDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
```

   **Example 2: Execute a Python script**

    <Collapser
        id="execute.python.script"
        title="Execute Python Script"
    >
    Using the AWS `SystemsManager` automation and document action, we can define a workflow definition that execute a python script.

    Here is a short example illustrating with a simple Hello World application.

      <Collapser
        id="system.manager.document"
        title="SystemsManager document"
      >
```yaml
schemaVersion: '0.3'
description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
parameters:
  Username:
    type: String
    description: "The username to greet."
    default: "User"
mainSteps:
  - action: aws:executeScript
    name: pythonStep
    inputs:
      Runtime: python3.8
      Handler: script_handler
      Script: |
        def script_handler(event, context):
            username = event['username']
            return f'Hello {username}'
      InputPayload:
        username: "{{ Username }}"
    outputs:
      - Name: scriptOutput
        Type: String
        Selector: $.Payload
outputs:
  - pythonStep.scriptOutput
```
        This can then be used in the workflow below:

        <Collapser
        id="workflow.definition.1"
        title="Workflow definition"
      >
```yaml
name: aws-python-script

workflowInputs:
  key:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
  access:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
  token:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
  region:
    type: String
    defaultValue: us-west-2
  name:
    type: String
    defaultValue: ExecuteHelloPythonScript
  username:
    type: String
    defaultValue: World!

steps:
  - name: generateIdempotencyToken
    type: action
    action: utils.uuid.generate
    version: 1

  - name: createSsmDocument
    type: action
    action: aws.systemsManager.writeDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: ${{ .workflowInputs.name }}
      documentContent: |
        schemaVersion: '0.3'
        description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
        parameters:
          Username:
            type: String
            description: "The username to greet."
            default: "User"
        mainSteps:
          - action: aws:executeScript
            name: pythonStep
            inputs:
              Runtime: python3.8
              Handler: script_handler
              Script: |
                def script_handler(event, context):
                    username = event['username']
                    return f'Hello {username}'
              InputPayload:
                username: "{{ Username }}"
            outputs:
              - Name: scriptOutput
                Type: String
                Selector: $.Payload
        outputs:
          - pythonStep.scriptOutput

  - name: start1
    type: action
    action: aws.systemsManager.startAutomation
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}
      parameters:
        Username: ${{ .workflowInputs.username }}

  - name: waitForCompletion
    type: action
    action: aws.systemsManager.waitForAutomationStatus
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
      # Optional, default is Success and Failed
      automationExecutionStatuses:
        - "Success"
        - "Failed"
      timeout: 300

  - name: hasCompleted
    type: switch
    switch:
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
        next: displayError
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
        next: displaySuccess
    next: displayUnexpected

  - name: displayUnexpected
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
    next: cleanupSsmDocument

  - name: displaySuccess
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "This is the results of the automation that was run on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.pythonStep.scriptOutput | tojson }}"
    next: cleanupSsmDocument

  - name: displayError
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs | tojson }}"
    next: cleanupSsmDocument

  - name: cleanupSsmDocument
    type: action
    action: aws.systemsManager.deleteDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
```

  This can be started with the following NerdGraph mutation, assuming the AWS temporary secrets have been previously stored with the `secretsManagementCreateSecretNerdGraph` mutations.

```yaml
mutation { 
    autoflowsStartWorkflowRun(accountId: 11933347,
    definition: {
        name: "aws-python-script",
    }, workflowInputs: [
        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
        {key: "region" value:"us-west-2"}
        {key: "username" value: "Julien"}
    ]) 
    { runId }
} 
```

  Executing the mutation above, returns a runId, for example `207e8c23-2c89-4af2-a74f-3c9ea2ffd543`. This runId can then be used to query the Logs and see the following output:

  <img
    title="Image of a python script execution output"
    alt="Image of a python script execution output"
    src="/images/python-script.webp"
  />
        </Collapser>
      </Collapser>
    </Collapser>

    **Example 3: A more complex SSM document**

    <Collapser
      id="example3.complex.document"
      title="Complex SSM document example"
    >
      1. Get the list of API gateway rest APIs. Filter my api (`Test API`) and get the rest API id.
      2. Get the list of all resources inside my api (`Test API`). Filter my specific resource based on pathPart(`/test`) and get the resourceID
      3. Get the list of versions for my lambda function (`ApiGwTestFn`). Filter the specific version that I want to rollback to (version: 1) and get the functionArn of that version.
      4. Update the API gateway integration with the lambda functionArn acquired in the above step.
      5. Create a new deployment for my rest API (`Test API`).

      <Collapser id="ssm.document.performing" title="SSM document performing API gateway rollback">
```yaml
schemaVersion: '0.3'
description: Test SSM for API gateway rollback
mainSteps:
  - name: ExecuteAwsApi
    action: aws:executeAwsApi
    nextStep: ExecuteGetApiResources
    inputs:
      Service: apigateway
      Api: GetRestApis
    outputs:
      - Name: resultApiId
        Selector: $.items[?(@.name=='Test API')].id
        Type: String
  - name: ExecuteGetApiResources
    action: aws:executeAwsApi
    nextStep: ExecuteListVersionsByFunction
    inputs:
      Service: apigateway
      Api: GetResources
      restApiId: '{{ ExecuteAwsApi.resultApiId }}'
    outputs:
      - Name: resultResourceId
        Selector: $.items[?(@.pathPart=='test')].id
        Type: String
  - name: ExecuteListVersionsByFunction
    action: aws:executeAwsApi
    nextStep: ExecuteApiGwUpdateIntg
    inputs:
      Service: lambda
      Api: ListVersionsByFunction
      FunctionName: ApiGwTestFn
    outputs:
      - Name: resultLambdaVersionArn
        Selector: $.Versions[?(@.Version=='1')].FunctionArn
        Type: String
  - name: ExecuteApiGwUpdateIntg
    action: aws:executeAwsApi
    nextStep: ExecuteApiGwCreateDeployment
    inputs:
      Service: apigateway
      Api: UpdateIntegration
      restApiId: '{{ ExecuteAwsApi.resultApiId }}'
      resourceId: '{{ ExecuteGetApiResources.resultResourceId }}'
      httpMethod: GET
      patchOperations:
        - op: replace
          path: /uri
          value: arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/{{ ExecuteListVersionsByFunction.resultLambdaVersionArn }}/invocations
  - name: ExecuteApiGwCreateDeployment
    action: aws:executeAwsApi
    inputs:
      Service: apigateway
      Api: CreateDeployment
      restApiId: '{{ ExecuteAwsApi.resultApiId }}'
outputs:
  - ExecuteGetApiResources.resultResourceId
  - ExecuteListVersionsByFunction.resultLambdaVersionArn
```
</Collapser>

      The sample SSM outputs `ExecuteGetApiResources.resultResourceId` and `ExecuteListVersionsByFunction.resultLambdaVersionArn`. These outputs can be used in further steps in the workflow definition.
    </Collapser>
  </TabsPageItem>
  </TabsPages>
</Tabs>
    </Collapser>
</CollapserGroup>

<CollapserGroup>
    <Collapser
        id="aws-systemsmanager.deletedocument"
        title="Delete an AWS SSM doc"
    >
  This action is to delete an AWS SSM document in the AWS account based on the credentials passed in the action input. See [AWS Systems Manager Documentation](https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html)

  <Tabs>
    <TabsBar>
      <TabsBarItem id="systemsmanagerinputs">
        Inputs
      </TabsBarItem>

      <TabsBarItem id="systemsmanageroutputs">
        Outputs
      </TabsBarItem>

      <TabsBarItem id="systemsmanagerexample">
        Example
      </TabsBarItem>
    </TabsBar>

    <TabsPages>
      <TabsPageItem id="systemsmanagerinputs">
        <table>
          <thead>
              <tr>
                <th>Input Field</th>
                <th>Optionality</th>
                <th>Type</th>
                <th>Example</th>
                </tr>
          </thead>
          <tbody>
              <tr>
                  <td>**awsRoleArn**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`arn:aws:iam::123456789012:role/my-workflow-role`</td>
              </tr>
              <tr>
                  <td>**awsAccessKeyId**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsAccessKeyId> }}`</td>
              </tr>
              <tr>
                  <td>**awsSecretAccessKey**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsSecretAccessKey> }}`</td>
              </tr>
              <tr>
                  <td>**awsSessionToken**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsSessionToken> }}`</td>
              </tr>
              <tr>
                  <td>**region**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`region: "us-east-2"`</td>
              </tr>
              <tr>
                  <td>**documentName**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`documentName: "my-ssm-document"`</td>
              </tr>
              <tr>
                  <td>**selectors**</td>
                  <td>Optional</td>
                  <td>List</td>
                  <td>`[{\"name\": \"success\", \"expression\": \".success\"}, {\"name\": \"documentName\", \"expression\": \".documentName\"}]`</td>
              </tr>
          </tbody>
      </table>
    </TabsPageItem>

    <TabsPageItem id="systemsmanageroutputs">
    <table>
      <thead>
          <tr>
              <th>Output Field</th>
              <th>Type</th>
              <th>Example</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>**documentName**</td>
              <td>String</td>
              <td>`documentName: "my-ssm-document"`</td>
          </tr>
          <tr>
              <td>**success**</td>
              <td>Boolean</td>
              <td>`success: true`</td>
          </tr>
          <tr>
              <td>**errorMessage**</td>
              <td>String</td>
              <td>`errorMessage: "Some error message from ssm"`</td>
          </tr>
      </tbody>
    </table>

      <Callout variant="important">
        - In action input, only `awsAccessKeyId` and `awsSecretAccessKey` can be provided but they should be static credentials of an IAM user.
        - If session credentials are to be used, `awsAccessKeyId`, `awsSecretAccessKey` and `awsSessionToken` must be passed to action input.
        - The selectors to get the only specified parameters as output.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="systemsmanagerexample">

    A simple SSM document to list all lambda function

```yaml
schemaVersion: '0.3'
description: List all Lambda function names.
mainSteps:
  - name: ExecuteAwsApi
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: lambda
      Api: ListFunctions
    outputs:
      - Name: resultFunctionName
        Selector: $..FunctionName
        Type: StringList
outputs:
  - ExecuteAwsApi.resultFunctionName
```

  **The complete workflow definition with SSM**:

```yaml
name: aws-api

workflowInputs:
  key:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
  access:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
  token:
    type: String
    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
  region:
    type: String
    defaultValue: us-east-2

steps:
  - name: createSsmDocument
    type: action
    action: aws.systemsManager.writeDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      selectors:
        - name: documentName
          expression: '.documentName'
        - name: documentType
          expression: '.documentType'
        - name: documentStatus
          expression: '.documentStatus'
        - name: success
          expression: '.success'
      documentName: "LambdaListFunctionNames"
      documentContent: |
        schemaVersion: '0.3'
        description: List all Lambda function names.
        mainSteps:
          - name: ExecuteAwsApi
            action: aws:executeAwsApi
            isEnd: true
            inputs:
              Service: lambda
              Api: ListFunctions
            outputs:
              - Name: resultFunctionName
                Selector: $..FunctionName
                Type: StringList
        outputs:
          - ExecuteAwsApi.resultFunctionName

  - name: generateIdempotencyToken
    type: action
    action: utils.uuid.generate
    version: 1

  - name: start1
    type: action
    action: aws.systemsManager.startAutomation
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

  - name: waitForCompletion
    type: action
    action: aws.systemsManager.waitForAutomationStatus
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
      # Optional, default is Success and Failed
      automationExecutionStatuses:
        - "Success"
        - "Failed"
      timeout: 60

  - name: hasCompleted
    type: switch
    switch:
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
        next: displayError
      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
        next: displaySuccess
    next: displayUnexpected

  - name: displayUnexpected
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
    next: cleanupSsmDocument

  - name: displaySuccess
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
    next: cleanupSsmDocument

  - name: displayError
    type: action
    action: newrelic.instrumentation.log
    version: 1
    inputs:
      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
    next: cleanupSsmDocument

  - name: cleanupSsmDocument
    type: action
    action: aws.systemsManager.deleteDocument
    version: 1
    inputs:
      awsAccessKeyId: ${{ .workflowInputs.key }}
      awsSecretAccessKey: ${{ .workflowInputs.access }}
      awsSessionToken: ${{ .workflowInputs.token }}
      region: ${{ .workflowInputs.region }}
      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
```
    </TabsPageItem>
  </TabsPages>
</Tabs>
    </Collapser>
</CollapserGroup>

<CollapserGroup>
    <Collapser
        id="aws-systemsmanager.startautomation"
        title="Start automation with SSM doc"
    >
  Starts an automation using an AWS SSM document. See [AWS Systems Manager Documentation](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartAutomationExecution.html)

  <Tabs>
    <TabsBar>
      <TabsBarItem id="startautomationinputs">
        Inputs
      </TabsBarItem>

      <TabsBarItem id="startautomationoutputs">
        Outputs
      </TabsBarItem>

      <TabsBarItem id="startautomationexample">
        Example
      </TabsBarItem>
    </TabsBar>

    <TabsPages>
      <TabsPageItem id="startautomationinputs">
              <table>
              <thead>
                  <tr>
                    <th>Input Field</th>
                    <th>Optionality</th>
                    <th>Type</th>
                    <th>Example</th>
                </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>**awsRoleArn**</td>
                      <td>Optional</td>
                      <td>String</td>
                      <td>`arn:aws:iam::123456789012:role/my-workflow-role`</td>
                  </tr>
                  <tr>
                      <td>**awsAccessKeyId**</td>
                      <td>Optional</td>
                      <td>String</td>
                      <td>`${{ :secrets:<awsAccessKeyId> }}`</td>
                  </tr>
                  <tr>
                      <td>**awsSecretAccessKey**</td>
                      <td>Optional</td>
                      <td>String</td>
                      <td>`${{ :secrets:<awsSecretAccessKey> }}`</td>
                  </tr>
                  <tr>
                      <td>**awsSessionToken**</td>
                      <td>Optional</td>
                      <td>String</td>
                      <td>`${{ :secrets:<awsSessionToken> }}`</td>
                  </tr>
                  <tr>
                      <td>**region**</td>
                      <td>Required</td>
                      <td>String</td>
                      <td>`region: "us-east-2"`</td>
                  </tr>
                  <tr>
                      <td>**documentName**</td>
                      <td>Required</td>
                      <td>String</td>
                      <td>`documentName: "my-ssm-document"`</td>
                  </tr>
                  <tr>
                      <td>**parameters**</td>
                      <td>Optional</td>
                      <td>Map</td>
                      <td>
```yaml
parameters:
      myKey: myValue
```
                      </td>
                  </tr>
                  <tr>
                      <td>**idempotencyToken**</td>
                      <td>Optional</td>
                      <td>UUID</td>
                      <td>
                      `idempotencyToken: "any token"`
                      <p>This will be passed as client token for idempotency to start aws ssm automation.</p>
                      </td>
                    </tr>
                    <tr>
                      <td>**selectors**</td>
                      <td>Optional</td>
                      <td>List</td>
                      <td>`[{\"name\": \"automationExecutionId\", \"expression\": \".automationExecutionId\"}, {\"name\": \"success\", \"expression\": \".success\"}]`</td>
                  </tr>
              </tbody>
          </table>
    </TabsPageItem>

    <TabsPageItem id="startautomationoutputs">
    <table>
      <thead>
          <tr>
              <th>Output Field</th>
              <th>Type</th>
              <th>Example</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>**automationExecutionId**</td>
              <td>String</td>
              <td>`automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`</td>
          </tr>
          <tr>
              <td>**success**</td>
              <td>Boolean</td>
              <td>`success: true`</td>
          </tr>
          <tr>
              <td>**errorMessage**</td>
              <td>String</td>
              <td>`errorMessage: "Some error message from ssm"`</td>
          </tr>
      </tbody>
    </table>

      <Callout variant="important">
        - In the action input, if `awsAccessKeyId` and `awsSecretAccessKey` are to be provided, make sure they are static credentials of an IAM user.
        - If session credentials are to be used, `awsAccessKeyId`, `awsSecretAccessKey` and `awsSessionToken` must be passed to the action input.
        - Refer to [AWS credentials](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/) for instructions.
        - Use selectors to get only the specified parameters as output.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="startautomationexample">
    <table>
      <thead>
          <tr>
              <th>Workflow definition</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>
```yaml
schemaVersion: '0.3'
description: List all Lambda function names.
mainSteps:
  - name: ExecuteAwsApi
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: lambda
      Api: ListFunctions
    outputs:
      - Name: resultFunctionName
        Selector: $..FunctionName
        Type: StringList
outputs:
  - ExecuteAwsApi.resultFunctionName
```
              </td>
          </tr>
      </tbody>
    </table>
  </TabsPageItem>
  </TabsPages>
</Tabs>
    </Collapser>
</CollapserGroup>

<CollapserGroup>
    <Collapser
        id="aws-systemsmanager.waitforautomationstatus"
        title="Wait for automation status"
    >
  Waits for an automation using an AWS document. See [AWS Systems Manager Documentation](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway) for more information.

  <Tabs>
    <TabsBar>
      <TabsBarItem id="automationstatusinputs">
        Inputs
      </TabsBarItem>

      <TabsBarItem id="automationstatusoutputs">
        Outputs
      </TabsBarItem>

      <TabsBarItem id="automationstatusexample">
        Example
      </TabsBarItem>
    </TabsBar>

    <TabsPages>
      <TabsPageItem id="automationstatusinputs">
      <table>
          <thead>
              <tr>
                  <th>Input Field</th>
                  <th>Optionality</th>
                  <th>Type</th>
                  <th>Example</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td>**awsRoleArn**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`arn:aws:iam::123456789012:role/my-workflow-role`</td>
              </tr>
              <tr>
                  <td>**awsAccessKeyId**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsAccessKeyId> }}`</td>
              </tr>
              <tr>
                  <td>**awsSecretAccessKey**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsSecretAccessKey> }}`</td>
              </tr>
              <tr>
                  <td>**awsSessionToken**</td>
                  <td>Optional</td>
                  <td>String</td>
                  <td>`${{ :secrets:<awsSessionToken> }}`</td>
              </tr>
              <tr>
                  <td>**region**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`region: "us-east-2"`</td>
              </tr>
              <tr>
                  <td>**automationExecutionId**</td>
                  <td>Required</td>
                  <td>String</td>
                  <td>`automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`. The automation `executionId` for which we need to wait for its completion.</td>
              </tr>
              <tr>
                  <td>**automationExecutionStatuses**</td>
                  <td>Optional</td>
                  <td>List</td>
                  <td>
                  `automationExecutionStatuses: ["status1", "status2"]`
                  <p>List of automation execution statuses from [AutomationExecution](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_AutomationExecution.html#AutomationExecutionStatus) that can stop the waiting.</p> <p>Default: `["Success", "Failed"]`</p>
                  </td>
              </tr>
              <tr>
                  <td>**timeout**</td>
                  <td>Optional</td>
                  <td>int</td>
                  <td>
                  `timeout: 180`(default), maximum 600.

                  <p>The duration in seconds we can wait for automation status to be one of the expected `automationExecutionStatuses`.</p>
                  
                  <p>If timeout occurred, the output contains `success: false` and `errorMessag: Timeout waiting for automation status`.</p>
                  </td>
              </tr>
              <tr>
                  <td>**selectors**</td>
                  <td>Optional</td>
                  <td>List</td>
                  <td>`[{\"name\": \"automationExecutionStatus\", \"expression\": \".automationExecutionStatus\"}, {\"name\": \"scriptOutput\", \"expression\": \".automationExecutionOutputs.pythonStep.scriptOutput | tojson\"}]`.</td>
              </tr>
          </tbody>
      </table>
    </TabsPageItem>

    <TabsPageItem id="automationstatusoutputs">
    <table>
      <thead>
          <tr>
              <th>Output Field</th>
              <th>Type</th>
              <th>Example</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>**automationExecutionId**</td>
              <td>String</td>
              <td>`automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`</td>
          </tr>
          <tr>
              <td>**automationExecutionStatus**</td>
              <td>String</td>
              <td>
              `automationExecutionStatus: "Success"`
              
              <p>If action is successful, It will either of the values passed in `automationExecutionStatuses` input field.</p>
              
              <p>Else, this will be null.</p>
              </td>
          </tr>
          <tr>
              <td>**automationExecutionOutputs**</td>
              <td>Map</td>
              <td>
```yaml
"automationExecutionOutputs": {
      "ExecuteGetApiResources": {
        "resultResourceId": [
          "pky3cb"
        ]
      },
      "ExecuteListVersionsByFunction": {
        "resultLambdaVersionArn": [
          "arn:aws:lambda:us-east-2:661945836867:function:ApiGwTestFn:1"
        ]
      }
} 
```
            <p>
            The output will be a map of output values from the document. Any output in the document can be collected using this output field and can be used in subsequent steps of the workflow automation definition.
            </p>
              </td>
          </tr>
          <tr>
              <td>**success**</td>
              <td>Boolean</td>
              <td>`success: true`</td>
          </tr>
          <tr>
              <td>**errorMessage**</td>
              <td>String</td>
              <td>`errorMessage: "Some error message from ssm"`</td>
          </tr>
      </tbody>
    </table>

    <Callout variant="important">
      1. In the action input, only `awsAccessKeyId` and `awsSecretAccessKey` can be provided, but they should be static credentials of an IAM user.
      2. If session credentials are to be used, `awsAccessKeyId`, `awsSecretAccessKey` and `awsSessionToken` must be passed to the action input.
      3. Refer to the instructions to set up [AWS credentials](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials).
      4. Use selectors to get only the specified parameters as output.
  </Callout>
    </TabsPageItem>

    <TabsPageItem id="automationstatusexample">
    <table>
      <thead>
          <tr>
              <th>Workflow definition</th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <td>
```yaml
schemaVersion: '0.3'
description: List all Lambda function names.
mainSteps:
  - name: ExecuteAwsApi
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: lambda
      Api: ListFunctions
    outputs:
      - Name: resultFunctionName
        Selector: $..FunctionName
        Type: StringList
outputs:
  - ExecuteAwsApi.resultFunctionName
```
              </td>
          </tr>
      </tbody>
    </table>
  </TabsPageItem>
  </TabsPages>
</Tabs>
    </Collapser>
</CollapserGroup>