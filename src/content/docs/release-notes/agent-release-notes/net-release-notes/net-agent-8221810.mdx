---
subject: .NET agent
releaseDate: '2019-12-19'
version: 8.22.181.0
downloadLink: 'https://download.newrelic.com/dot_net_agent/latest_release'
---

### New Features

* Enables ability to migrate to Configurable Security Policies (CSP) on a per agent basis for accounts already using High-security mode (HSM). When both HSM and CSP are enabled for an account, an agent (this version or later) can successfully connect with either `high_security: true` or the appropriate `security_policies_token` configured.

### Fixes

* Fixes a number of issues caused when Application Initialization has been enabled in Internet Information Services (IIS) (a.k.a. **AlwaysOn** in Azure App Services). The issues include the inability for the agent to name an app or possibly not instrument an app at all when app pool allow/deny listing has been applied via `newrelic.config`. In an Azure App Services scenario inadvertent instrumentation of the Kudu process could also occur. This was caused by the agent relying on the IIS environment variable `APP_POOL_ID`. When Application Initialization or AlwaysOn are enabled, the `APP_POOL_ID` environment variable is unavailable to the agent. The agent now also attempts to parse the command line of the `w3wp.exe` process to identify the application pool the app is running under.
* Improves the handling of OperationCanceledException errors when trying to connect or send data to New Relic.
* Fixes a problem with instrumenting ASP.NET Core applications that can occur when the Microsoft.AspNetCore.Diagnostics.Abstraction assembly is not available.
* Fixes a problem where WCF Instrumentation may shut-down due to an unexpected error.
* Fixes a problem that can cause the agent to fail to shutdown completely when a shutdown is triggered while the agent is still in its startup process.
* Fixes a problem with the [GetLinkingMetadata](https://docs.newrelic.com/docs/agents/net-agent/net-agent-api/getlinkingmetadata-net-agent-api) API method that could cause an expected KeyValuePair to not be included in the Dictionary.

### Upgrading

* Follow standard procedures to [update the .NET agent](/docs/agents/net-agent/installation-configuration/update-net-agent).
* If you are upgrading from a particularly old agent, review the list of major changes and procedures to [upgrade legacy .NET agents](/docs/agents/net-agent/troubleshooting/upgrade-legacy-net-agents).
