---
title: 구성
metaDescription: Overview of the Agent Control configuration
freshnessValidatedDate: never
translationType: machine
---

<Callout title="시사">
  이 기능은 아직 개발 중이지만 꼭 사용해 보시기 바랍니다!

  이 기능은 현재 [출시 전 정책](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy) 에 따라 미리보기 프로그램의 일부로 제공됩니다.
</Callout>

전통적으로 뉴렐릭 에이전트 설정을 정의했던 [`values-newrelic.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml) 파일에는 이제 에이전트 제어에 대한 설정도 포함되어 있습니다. 이 파일에서 정의한 지표는 에이전트 제어와 해당 관리 에이전트의 작동 방식을 결정합니다. 이 파일은 **로컬 설정** 이라고 합니다.

다음은 설정의 예입니다.

<CollapserGroup>
  <Collapser id="agent-control-config" title="에이전트 Control 설정">
    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"
      userKey: "YOUR_USER_KEY"

    # Values related to the agent control's Helm chart release.
    # `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
    agent-control-deployment:
      identityClientId: ""
      identityClientSecret: ""
      config:
        fleet_control:
          # Optional: Specify a fleet_id (entity guid) to automatically connect to an existing fleet.
          fleet_id: ""
          auth:
            # New Relic organization ID where agent will connect to.
            organizationId: "YOUR_ORGANIZATION_ID"

        # List of managed agents that will be deployed. The key represents the name of the agent and the value holds the configuration.
        subAgents:
          infrastructure:
            type: newrelic/com.newrelic.infrastructure:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
              chart_values:
                newrelic-infrastructure:
                enableProcessMetrics: true
          logs:
            type: newrelic/io.fluentbit:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
              chart_values:
                newrelic-logging:
                  sendMetrics: true
          agent-operator:
            type: com.newrelic.k8s_agent_operator:0.1.0
            content:
              chart_version: "*"
    ```
  </Collapser>
</CollapserGroup>

이 샘플은 두 가지 관리 에이전트( Kubernetes 에이전트 에이전트 및 포워딩용 Fluent Bit 와 함께 에이전트 제어를 구성하는 방법을 보여줍니다. 예를 들어 Fluent Bit 로그 수집기에 대한 상태 지표를 보내지 않으려면 설치 명령을 실행하기 전에 YAML 파일에서 `sendMetrics: false` 설정하기만 하면 됩니다.

클러스터 전체에 구성을 중앙에서 배포하려면 [Fleet Control](/docs/new-relic-control/fleet-control/overview)의 **Configurations** \[구성] 섹션에서 동일한 YAML 콘텐츠를 정의합니다.그런 다음 원격 구현, 배포의 일부로 클러스터의 전체 집합에 설정을 적용할 수 있습니다. 이것을 **원격 설정** 파일이라고 합니다.

원격 설정을 사용하면 환경 전반에서 일관된 에이전트 동작이 보장되고, 변경 관리가 간소화되며, 로컬 YAML 파일을 수동으로 관리하지 않고도 옵저버빌리티를 확장할 수 있습니다.

에이전트 Control은 Kubernetes `ConfigMaps` 를 사용하여 설정 설정을 저장하고 적용합니다. 로컬 및 원격 설정이 모두 있는 경우 기본적으로 **원격 설정이** 우선합니다. 의도적으로 원격 설정을 무시하고 로컬 설정으로 돌아가려면 플릿 취소를 통해 **빈 원격 설정을** 구현하거나 배포할 수 있습니다. 이 변경 사항은 선택한 함대의 **모든 클러스터** 에 적용됩니다.

사용 가능한 모든 구성 설정을 살펴보려면 [`values-newrelic.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml) 을 참조하세요.

## 샘플 설정

다음 예는 다양한 에이전트 세트를 관리하기 위해 에이전트 제어를 구성하는 방법을 보여줍니다. 이 설정은 초기 설치 중이나 플릿위험의 원격 설정의 일부로 사용될 수 있습니다.

### 뉴렐릭 Infrastructure and Fluent Bit

이 예시에서는 배포하다 에이전트 제어를 부하 모니터링 및 Fluent Bit 통해 생성 수집에 사용합니다.

<CollapserGroup>
  <Collapser id="agent-control-config" title="인프라 및 Fluent Bit에 대한 로컬 구성">
    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"
      userKey: "YOUR_USER_KEY"

    # See `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
    agent-control-deployment:
      identityClientId: ""
      identityClientSecret: ""
      config:
        fleet_control:
          # Optional
          # fleet_id: YOUR_FLEET_ENTITY_GUID
          auth:
            organizationId: "YOUR_ORGANIZATION_ID"
        subAgents:
          infrastructure:
            type: newrelic/com.newrelic.infrastructure:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"

              #chart_values:
              #  newrelic-infrastructure:
              #    enableProcessMetrics: true
          logs:
            type: newrelic/io.fluentbit:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"

              #chart_values:
              #  newrelic-logging:
              #    sendMetrics: true
          agent-operator:
            type: com.newrelic.k8s_agent_operator:0.1.0
            chart_version: "*"
    ```
  </Collapser>
</CollapserGroup>

### 사용자 정의 수집기 설정을 갖춘 OpenTelemetry

이 예제는 OpenTelemetry (NRDOT) 수집기의 뉴렐릭 분포를 사용하여 배포하다 에이전트 제어를 수행하고 관리되는 [`nr-k8s-otel-collector` Helm 차트](https://github.com/newrelic/helm-charts/tree/master/charts/nr-k8s-otel-collector#values) 에서 `filelog` 수신기를 비활성화합니다.

<CollapserGroup>
  <Collapser id="otel-config" title="OpenTelemetry 설정">
    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"
    # Values related to the agent control's Helm chart release.
    # `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
    agent-control-deployment:
      identityClientId: ""
      identityClientSecret: ""
      config:
        fleet_control:
          # Optional: Specify a fleet_id (entity guid) to automatically connect to an existing fleet.
          fleet_id: ""
          auth:
            # New Relic organization ID where agent will connect to.
            organizationId: "YOUR_ORGANIZATION_ID"

        # List of managed agents that will be deployed. The key represents the name of the agent and the value holds the configuration.
        subAgents:
          infrastructure:
            type: newrelic/com.newrelic.infrastructure:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle%60
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
          agent-operator:
            type: newrelic/com.newrelic.k8s_agent_operator:0.1.0
            content:
              chart_version: "*"
          fluentbit:
            type: newrelic/io.fluentbit:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
              chart_values:
                global:
                  lowDataMode: true
          prometheus:
            type: newrelic/com.newrelic.prometheus:0.1.0
            content:
              chart_version: "*"
              chart_values:
                global:
                  lowDataMode: true
                newrelic-prometheus-agent:
                  config:
                    kubernetes:
                      integrations_filter:
                        enabled: false
    ```
  </Collapser>
</CollapserGroup>

### 원격 설정: 뉴렐릭 인프라 

이 예에서는 플릿 위험을 사용하여 Kubernetes 용 뉴렐릭 인프라 에이전트를 원격으로 구성하는 방법을 보여줍니다. `enableProcessMetrics: true` 설정하여 프로세스 메트릭 수집을 활성화합니다.

<CollapserGroup>
  <Collapser id="infra-remote-config" title="원격 설정">
    ```yaml
    chart_version: "*"
    chart_values:
      newrelic-infrastructure:
        enableProcessMetrics: true
    ```
  </Collapser>
</CollapserGroup>

### 원격 설정: Fluent Bit

이 예에서는 플로릿 위험을 통해 원격으로 Fluent Bit 구성했습니다. `sendMetrics: true` 설정하여 로그 수집기에서 상태 지표 보고를 활성화합니다.

<CollapserGroup>
  <Collapser id="fluentbit-remote-config" title="Fluent Bit 설정">
    ```yaml
    chart_version: "*"
    chart_values:
      newrelic-logging:
        sendMetrics: true
    ```
  </Collapser>
</CollapserGroup>

### 원격 설정: Prometheus

이 예에서는 플릿위험을 사용하여 원격으로 Prometheus 에이전트를 구성합니다. `low-data mode` 사용하여 Telmetri 볼륨을 줄이고 기본 통합을 비활성화할 수 있습니다.

<CollapserGroup>
  <Collapser id="prometheus-config" title="프로메테우스 설정">
    ```yaml
    chart_version: "*"
    chart_values:
      newrelic-prometheus-agent:
        lowDataMode: true
    ```
  </Collapser>
</CollapserGroup>

### 원격 설정: OpenTelemetry

<CollapserGroup>
  <Collapser id="prometheus-config" title="프로메테우스 설정">
    <Callout variant="important">
      Kubernetes 비밀번호를 생성하여 Newrelrik 라이선스 키를 안전하게 저장하고 `licenseKey` 값을 대체하여 `chart_values` 에서 사용합니다.

      ```yaml
      customSecretName: "your-secret-name"
      customSecretLicenseKey: "your-secret-key"
      ```
    </Callout>

    플릿 전체에 걸쳐 구현하다, 배포하다 OpenTelemetry 설정을 정의하고 구현하려면 플릿 컨트롤을 사용하는 것이 좋습니다. OpenTelemetry 원격으로 구성하려면 아래 표시된 구조를 사용하여 플릿 확률에서 설정을 만듭니다. `lowDataMode` 또는 `receivers.filelog.enabled` 과 같은 값을 조정하고 필요에 따라 다른 관련 Helm 차트 설정을 포함할 수 있습니다.

    ```yaml
    chart_version: "*"
    chart_values:
      newrelic-prometheus-agent:
        lowDataMode: true
    ```
  </Collapser>
</CollapserGroup>

## 프록시 구성

에이전트 Control은 기업 프록시 또는 네트워크 중개자를 통해 트래픽을 라우팅하기 위한 프록시 설정을 지원합니다. 프록시 구성은 환경 변수를 통해 설정하거나 구성 파일에서 직접 설정할 수 있습니다.

### 프록시 우선순위

에이전트 제어는 다음 우선순위에 따라 프록시 설정을 사용합니다.

1. `proxy` 에이전트 Control 설정의 설정 필드
2. `HTTP_PROXY` 환경 변수
3. `HTTPS_PROXY` 환경 변수

<Callout variant="important">
  프록시 설정은 현재 서명 검증을 위한 인증서 가져오기와 호환되지 않습니다. 프록시를 설정해야 하는 경우 다음 옵션을 사용할 수 있습니다.

  * 해당 EndPoint에 대한 requests 프록시를 건너뛸 수 있도록 `https://newrelic.com` 에 예외를 추가합니다(권장).
  * `fleet_control.signature_validation.certificate_pem_file_path` 통해 로컬 인증서를 사용합니다(인증서 순환은 수동으로 처리해야 함)
  * `fleet_control.signature_validation.enabled: false` 설정하여 서명 유효성 검사를 비활성화합니다(보안상의 이유로 권장하지 않음)
</Callout>

### 자체 서명 인증서를 사용한 프록시 설정

자체 서명 인증서를 사용하여 HTTPS 인증을 사용하는 프록시 설정의 경우 CA 인증서 번들을 제공하고 프록시 인증을 구성해야 합니다.

<CollapserGroup>
  <Collapser id="k8s-proxy-config" title="Kubernetes 프록시 설정 예시">
    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"

    agent-control-deployment:
      config:
        agentControl:
          content:
            proxy:
              url: https://proxy-service:8080
        subAgents: {}

      # Mount CA certificate bundle to Agent Control
      extraVolumeMounts:
        - mountPath: /etc/ssl/certs/
          name: ca-certs
      extraVolumes:
        - name: ca-certs
          secret:
            secretName: ca-certs

    # Configure Flux components to use proxy
    agent-control-cd:
      flux2:
        sourceController:
          extraEnv:
            # Configure Flux source-controller to proxy all requests
            - name: HTTPS_PROXY
              value: https://proxy-service:8080
            # Except for in-cluster requests
            - name: "NO_PROXY"
              value: ".cluster.local.,.cluster.local,cluster.local,.svc,127.0.0.0/8,10.0.0.0/8"
          volumeMounts:
            # Mount CA certificate bundle to source-controller trust root store. The bundle should contain the
            # proxy CA cert.
            - mountPath: /etc/ssl/certs/
              name: ca-certs
          volumes:
            - name: ca-certs
              secret:
                secretName: ca-certs


    ```
  </Collapser>
</CollapserGroup>

### 관리형 에이전트에 대한 프록시 설정

<Callout variant="caution">
  에이전트 제어에서 프록시를 구성하면 관리하는 에이전트에 대해 동일한 프록시 설정이 자동으로 구성되지 **않습니다** . 각 에이전트에는 해당 에이전트의 특정 설정 형식 및 요구 사항에 따라 별도로 설정해야 하는 자체 프록시 설정이 있습니다.
</Callout>

프록시를 사용하는 경우 각 관리 에이전트에 대한 프록시 설정도 개별적으로 구성해야 합니다. 프록시 설정 옵션은 각 에이전트의 특정 문서를 참조하세요.

## 비밀 관리

Agent Control provides a robust mechanism for managing sensitive data, such as passwords and API keys, by retrieving them from dedicated secret providers. This ensures that sensitive information is not hard-coded directly into configuration files. The system currently supports the following secret providers:

* HashiCorp Vault: referred to as `nr-vault` in configurations.
* Kubernetes Secrets: referred to as `nr-kubesec` in configurations.

### Defining Secrets in Configuration

To utilize secrets, define them within your Agent-Control configuration YAML file by following these steps:

1. **Define the `secrets_providers` section:** Configure your secret providers centrally in this section. Ensure each entry corresponds to a supported provider.
2. **Configure secret sources:** For each provider, specify one or more sources. A source includes the necessary configuration details (e.g., URL, token) for Agent control to connect to and retrieve a group of secrets.
3. **Use placeholders in agent configurations:** Instead of the actual sensitive data, Use a placeholder string within your agent&apos;s configuration. Agent control automatically replaces these placeholders with the retrieved secrets during the rendering process.

<Callout variant="important">
  If Agent control fails to retrieve a secret, the configuration rendering will fail, and the agent will not be executed. This is a critical security feature to prevent agents from running with incomplete or incorrect configurations.
</Callout>

The following agent-control configuration example demonstrates how to configure for retrieving secrets from two Vault sources within the `secrets_providers` section:

```yaml
secrets_providers:
  vault:
    sources:
      local-instance:
        url: http://localhost:8200/v1/
        token: root
        engine: kv2
      remote:
        url: http://my-remote-server:8200/v1/
        token: root
        engine: kv1

fleet_control:
  ...

agents:
  ...
```

#### Using Secrets in an Agent Configuration

After the sources are defined, in an agent configuration, you can reference the vault using a specific placeholder syntax with the correct path. Agent control retrieves the secret and uses it to render the final configuration file that the agent is going to use.

Example of agent configuration using vault placeholders:

```yaml
config_agent: |+
  enable_process_metrics: true
  custom_attributes:
    username: "${nr-vault:local-instance:secret:my_secret:username}"
    organization: "${nr-vault:remote:my_mount:my_path:organization}"
```

이 예에서:

The placeholder `${nr-vault:local-instance:secret:my_secret:username}` instructs Agent control to retrieve the value associated with the key username from the secret at the path `secret/my_secret` using the local-instance vault source. The placeholder `${nr-vault:remote:my_mount:my_path:organization}` similarly retrieves the value for the organization key from the remote source.

After successful retrieval, Agent control renders these secrets from the specified source and path, storing the result in a K8s secret or private config file for use by the corresponding agent.

### 금고 비밀

Set up the vault sources with the following settings:

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        YAML 키
      </th>

      <th>
        설명
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `url`
      </td>

      <td>
        데이터를 요청할 URL
      </td>
    </tr>

    <tr>
      <td>
        `token`
      </td>

      <td>
        Used to authenticate to the endpoint.
      </td>
    </tr>

    <tr>
      <td>
        `engine`
      </td>

      <td>
        Specify **`kv1`** or **`kv2`**.
      </td>
    </tr>
  </tbody>
</table>

In the configuration file, each secret stored in Vault can be accessed by setting a placeholder with:

* **source\_name**: The name of the Vault source defined in `secrets_providers`.
* **mount**: The name of the secrets engine mount.
* **path**: The specific path to the secret.
* **specific key**: The specific key within the secret to be retrieved.

Example of full placeholder format:

```
"${nr-vault:source_name:my_mount:my_path:my_value}"
```

### Kubernetes secrets

If the agent-control pod has permissions, such as through a Service Account and Role-Based Access Control (RBAC), to access the required secrets and namespaces, Agent control can directly access secrets from the Kubernetes API without needing a separate sources configuration.

In the agent configuration file, retrieve each secret value using a placeholder specifying:

* **namespace**: The Kubernetes namespace where the secret is located.
* **name**: The name of the Kubernetes secret object.
* **specific key**: The specific key within the secret from which to retrieve the value.

For example, use the placeholder format:

```
"${nr-kubesec:my_namespace:my_secret:my_value}"
```

## 비공개 설정

Agent Control은 Agent Control 자체와 관리 에이전트 모두에 구현, 배포에 대한 개인 Helm 렌즈 구성을 지원합니다. 이를 통해 Helm 차트에 직접 접근할 수 있습니다.

<Callout variant="caution">
  개인 Helm 저장소를 사용하는 경우 차트가 호환되어야 하며 차트 내에서 참조된 이미지에 접근할 수 있어야 합니다. 그렇지 않으면 에이전트가 예상대로 작동하지 않습니다.
</Callout>

### 1. 에이전트에 대한 개인 저장소 활성화

보안상의 이유로, 원격 설정에서는 명시적으로 활성화된만 허용됩니다. 특정 이온을 활성화하려면 에이전트 제어 설정을 업데이트해야 합니다:

<CollapserGroup>
  <Collapser id="k8s-private-repository-config" title="개인 저장소 활성화">
    ```yaml
    # values-newrelic.yaml

    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"

    # ...

    agent-control-deployment:
      config:
        allowedChartRepositoryUrl:
          - https://my-private-repository-1
          - https://my-private-repository-2
        # ...
    ```
  </Collapser>
</CollapserGroup>

그런 다음 허용된 클럽 설정을 뉴렐릭 Control 내의 원격 설정에서 사용할 수 있습니다. 예:

```yaml
chart_version: "1.2.3"
chart_repository:
  url: "https://my-private-repository-1"
  name: "my-chart-name" # Optional: use only if the chart name doesn't match New Relic's chart name
```

또한 `agent-control` 차트 자체가 비공개 위치에 있는 경우 비공개 위치를 사용하도록 에이전트 제어의 Helm 설치를 구성해야 합니다. 이는 관리 에이전트의 설정과는 별개입니다. `installationJob` 섹션을 설정하려면 `agent-control` Helm 차트 [값.yaml](https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml) 을 참조하세요. 구체적으로:

* `chartRepositoryUrl` 저장소 URL이 포함되어 있습니다
* `name` 다른 차트 이름을 사용하는 경우
* `repositorySecretReferenceName` 인증을 위한 `repositoryCertificateSecretReferenceName` (자세한 내용은 아래 인증 섹션 참조)

### 2. 개인 저장소에 대한 인증 설정

개인 저장소에 액세스하기 위한 인증을 활성화하려면 추가 리소스를 설정해야 합니다.

<CollapserGroup>
  <Collapser id="k8s-private-repository-basic-auth" title="기본 인증">
    기본 인증(사용자 이름 및 비밀번호)을 사용하여 인증하려면 에이전트 제어 네임스페이스에 `data.username` 및 `data.password` 에 예상 값이 포함된 비밀을 생성해야 합니다.

    예시:

    ```yaml
    apiVersion: v1
    kind: Secret
    metadata:
      name: my-secret
    stringData:
      username: "myUser"
      password: "myPassword"
    ```

    자세한 내용은 [Flux 문서를](https://fluxcd.io/flux/components/source/helmrepositories/#secret-reference) 참조하세요.

    기본 인증을 사용하는 경우 원격 설정은 다음과 같이 구성해야 합니다.

    ```yaml
    chart_repository:
      url: "https://my-private-repository-1"
      secret_reference:
        name: my-secret
    ```
  </Collapser>

  <Collapser id="k8s-private-repository-tls-cert" title="TLS 인증서 인증">
    TLS를 사용하여 인증하려면 다음이 포함된 비밀을 만들어야 합니다.

    * `tls.crt` 및 `tls.key`: TLS 클라이언트 인증에 사용되는 클라이언트 인증서 및 개인 키
    * `ca.crt`: 서버를 검증하는 데 사용되는 CA 인증서(서버가 자체 서명 인증서를 사용하는 경우 필요)

    비밀은 `Opaque` 또는 `kubernetes.io/tls` 유형이어야 합니다. Secret에 있는 모든 파일은 PEM으로 인코딩되어야 합니다.

    예시:

    ```yaml
    apiVersion: v1
    kind: Secret
    metadata:
      name: my-secret
      namespace: newrelic-agent-control
    type: kubernetes.io/tls # or Opaque
    data:
      tls.crt: <BASE64>
      tls.key: <BASE64>
      # NOTE: Can be supplied without the above values
      ca.crt: <BASE64>
    ```

    자세한 내용은 [Flux 문서를](https://fluxcd.io/flux/components/source/helmrepositories/#secret-reference) 참조하세요.

    TLS 인증서 인증을 사용하는 경우 원격 설정은 다음과 같이 구성해야 합니다.

    ```yaml
    chart_repository:
      url: "https://my-private-repository-1"
      certificate_secret_reference:
        name: my-secret
    ```
  </Collapser>
</CollapserGroup>