---
title: OpenTelemetry를 사용하여 Kubernetes에서 NGINX를 모니터링하세요.
metaDescription: Send your NGINX metrics from Kubernetes to New Relic using the OpenTelemetry Collector.
freshnessValidatedDate: never
translationType: machine
---

[OpenTelemetry Collector](https://github.com/open-telemetry/opentelemetry-collector-contrib) 사용하여 쿠버네티스 클러스터에서 실행 중인 NGINX 서버를 모니터링하여 인덱스 및 델메트리 데이터를 뉴렐릭으로 보냅니다.

이 Kubernetes관련 통합은 클러스터에서 NGINX 파드를 자동으로 검색하고 각 항목에 대해 수동 설정 없이 지표를 수집합니다. 이 기능은 OpenTelemetry [nginxreceiver](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/nginxreceiver) 및 [receivercreator를](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator) 활용하여 컨테이너 환경 전반에 걸쳐 모니터 NGINX 성능, 연결 통계 및 서버 상태를 동적으로 모니터링합니다.

## 시작하기 전에 [#prerequisites]

다음 사항을 확인하십시오:

* [뉴렐릭 계정](https://newrelic.com/signup)<InlinePopover type="licenseKey" />
* NGINX에서 [HTTP 스텁 상태](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html) 모듈을 활성화해야 합니다.
* 모니터가 필요한 각 NGINX 파드에 `app` 및 `role` 레이블을 추가합니다.

## OpenTelemetry Collector를 설치하고 구성합니다. [#install-collector]

Helm 사용하여 OpenTelemetry Collector 쿠버네티스 클러스터에 구현합니다. 수집기는 NGINX 파드에서 메트릭을 자동으로 검색하고 수집합니다.

<CollapserGroup>
  <Collapser id="k8s-create-secret" title="자격 증명용 Kubernetes 시크릿을 생성합니다.">
    뉴럴릭 자격 증명을 저장할 Kubernetes 시크릿을 생성하세요. `YOUR_LICENSE_KEY` 과 `YOUR_OTLP_ENDPOINT` 실제 값으로 바꾸세요. 해당 지역에 적합한 엔드포인트를 선택하려면 OTLP 엔드포인트 설정 [문서를](https://docs.newrelic.com/docs/opentelemetry/best-practices/opentelemetry-otlp/#configure-endpoint-port-protocol) 참조하세요.

    ```bash
    kubectl create namespace newrelic
    kubectl create secret generic newrelic-licenses --from-literal=NEWRELIC_LICENSE_KEY=YOUR_LICENSE_KEY --from-literal=NEWRELIC_OTLP_ENDPOINT=YOUR_OTLP_ENDPOINT
    ```
  </Collapser>

  <Collapser id="k8s-values-yaml" title="values.yaml 설정 파일을 생성합니다.">
    OpenTelemetry Collector를 구성하기 위한 `values.yaml` 파일을 생성합니다. 클러스터 이름, NGINX 파드 레이블, 스텁 상태 포트 및 경로에 대한 플레이스홀더를 업데이트하세요.

    ```yaml
    opentelemetry-collector:
      mode: deployment

      image:
        repository: otel/opentelemetry-collector-contrib
        pullPolicy: IfNotPresent

      command:
        name: otelcol-contrib

      resources:
        limits:
          cpu: 500m
          memory: 300Mi
        requests:
          cpu: 100m
          memory: 100Mi

      extraEnvs:
        - name: NEWRELIC_LICENSE_KEY
          valueFrom:
            secretKeyRef:
              name: newrelic-licenses
              key: NEWRELIC_LICENSE_KEY
        - name: NEWRELIC_OTLP_ENDPOINT
          valueFrom:
            secretKeyRef:
              name: newrelic-licenses
              key: NEWRELIC_OTLP_ENDPOINT
        - name: K8S_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: K8S_CLUSTER_NAME
          value: nginx-cluster # Update with your cluster name

      clusterRole:
        create: true
        rules:
          - apiGroups: [""]
            resources: ["pods", "nodes", "nodes/stats", "nodes/proxy"]
            verbs: ["get", "list", "watch"]
          - apiGroups: ["apps"]
            resources: ["replicasets"]
            verbs: ["get", "list", "watch"]
        clusterRoleBinding:
          name: ""

      config:
        extensions:
          health_check:
            endpoint: 0.0.0.0:13133
          k8s_observer:
            auth_type: serviceAccount
            observe_pods: true
            observe_nodes: true

        receivers:
          receiver_creator/nginx:
            watch_observers: [k8s_observer]
            receivers:
              nginx:
                rule: type == "pod" && labels["app"] == "nginx" && labels["role"] == "reverse-proxy" # Update with your labels
                config:
                  endpoint: 'http://`endpoint`:<stub_status_port>/status'
                  metrics:
                    nginx.requests:
                      enabled: true
                    nginx.connections_accepted:
                      enabled: true
                    nginx.connections_handled:
                      enabled: true
                    nginx.connections_current:
                      enabled: true
                  collection_interval: 30s
                resource_attributes:
                  nginx.server.endpoint: 'http://`endpoint`:<stub_status_port>/status'
                  nginx.port: '<stub_status_port>'

        processors:
          batch:
            send_batch_size: 1024
            timeout: 30s

          resource/cluster:
            attributes:
              - key: k8s.cluster.name
                value: "${env:K8S_CLUSTER_NAME}"
                action: insert

          transform/nginx:
            metric_statements:
              - context: resource
                statements:
                  - set(attributes["nginx.display.name"], Concat([
                      "server",
                      "k8s",
                      attributes["k8s.cluster.name"],
                      attributes["k8s.namespace.name"],
                      "pod",
                      attributes["k8s.pod.name"],
                      "nginx",
                      attributes["nginx.port"]
                      ], ":"))
                  - set(attributes["nginx.deployment.name"], attributes["k8s.pod.name"])

        exporters:
          otlphttp:
            endpoint: "${env:NEWRELIC_OTLP_ENDPOINT}"
            headers:
              api-key: "${env:NEWRELIC_LICENSE_KEY}"

        service:
          extensions: [health_check, k8s_observer]
          pipelines:
            metrics/nginx:
              receivers: [receiver_creator/nginx]
              processors: [batch, resource/cluster, transform/nginx]
              exporters: [otlphttp]
    ```
  </Collapser>

  <Collapser id="k8s-install-helm" title="Helm을 사용하여 설치하세요">
    values.yaml 파일을 사용하여 [Helm 차트를](https://github.com/open-telemetry/opentelemetry-helm-charts) 설치하세요.

    ```bash
    helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
    helm repo update
    helm upgrade --install nginx-otel-collector open-telemetry/opentelemetry-collector --namespace newrelic --create-namespace -f values.yaml
    ```
  </Collapser>

  <Collapser id="k8s-verify-deployment" title="구현, 배포 및 데이터 수집 검증">
    1. **파드가 성공적으로 시작되었는지 확인하십시오.**

       ```bash
       kubectl get pods -n newrelic --watch
       ```

       `newrelic` 네임스페이스에서 `Running` 상태에 있는 `nginx-otel-collector-<hash>` 과 같은 이름을 가진 파드를 볼 수 있을 것입니다.

    2. **뉴렐릭에서 NRQL 쿼리를 실행하여 데이터가 도착하는지 확인하세요.** 클러스터 이름을 값 파일에서 설정한 값으로 바꾸십시오.

       ```sql
       FROM Metric
       SELECT *
       WHERE metricName LIKE 'nginx.%'
         AND instrumentation.provider = 'opentelemetry'
         AND k8s.cluster.name = 'nginx-cluster'
       SINCE 10 minutes ago
       ```
  </Collapser>
</CollapserGroup>

## 데이터 찾기 및 사용 [#find-data]

1. **[one.newrelic.com](https://one.newrelic.com) &gt; Integrations &amp; Agents** 로 이동하세요.
2. **Dashboards** 선택하고 **NGINX OTel overview dashboard** \[NGINX OTel 개요 대시보드] 를 클릭합니다.
3. 팝업 창에서 계정을 선택하세요.
4. 대시보드 보기를 클릭하고 뉴렐릭에서 NGINX 데이터를 확인하세요.

NGINX 메트릭은 `Metric` [이벤트 유형](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic) 에 첨부됩니다. 문제 해결, 해결 목적으로 [이 데이터를 쿼리](/docs/using-new-relic/data/understand-data/query-new-relic-data) 하거나 사용자 정의 차트 및 대시보드를 생성할 수 있습니다.

## 지표 및 속성 참조 [#metrics]

이 통합은 클러스터, 지우스페이스 및 패드 식별을 위한 추가 Kubernetes관련 리소스 속성과 함께 호스트 구현, 배포와 동일한 핵심 NGINX 지표를 수집합니다.

**전체 지표 및 속성 참조:** Kubernetes 구현, 배포에 대한 모든 지표, 유형 및 리소스 속성에 대한 자세한 설명은 [NGINX OpenTelemetry 지표 및 속성 참조를](/docs/opentelemetry/nginx/nginx-otel-metrics-reference/) 참조하세요.

## 다음 단계 [#next-steps]

**데이터에 대해 자세히 알아보세요:**

* [NGINX 데이터 찾기 및 쿼리](/docs/opentelemetry/nginx/find-and-query-your-data/) - 대시보드에 액세스하고 사용자 정의 쿼리를 생성하고 알림 설정
* [NGINX OpenTelemetry 메트릭 및 속성 참조](/docs/opentelemetry/nginx/nginx-otel-metrics-reference/) - 설명과 예제를 포함한 전체 메트릭 참조
* [NGINX OpenTelemetry 개요](/docs/opentelemetry/nginx/nginx-otel-overview/) - 수집되는 메트릭, 속성 및 사용 사례 이해하기
* [NGINX 리시버 문서](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/nginxreceiver/documentation.md) - 기술 세부 정보 및 고급 설정

**관련 모니터링 정보를 살펴보세요:**

* [OpenTelemetry사용하여 NGINX Plus 모니터링](/docs/opentelemetry/nginx-plus/nginx-plus-otel/) - 상업용 NGINX Plus 구현, 배포
* [OpenTelemetry사용하여 자체 호스팅 NGINX 모니터링](/docs/opentelemetry/nginx/nginx-otel-host/) - 기존 서버 구현의 경우 배포
* [OpenTelemetry 모범 사례](/docs/opentelemetry/best-practices/opentelemetry-otlp/) - OpenTelemetry 설정 최적화

**Kubernetes 관련 리소스:**

* [OpenTelemetry Collector on Kubernetes](https://opentelemetry.io/docs/kubernetes/) - 고급 수집기 설정