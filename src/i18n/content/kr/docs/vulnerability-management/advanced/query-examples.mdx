---
title: 보안 데이터 쿼리 예시
metaDescription: Ready-to-use NRQL queries for analyzing vulnerability data in Security RX.
freshnessValidatedDate: never
translationType: machine
---

이 가이드는 일반적인 보안 모니터링 및 분석 시나리오에 바로 사용할 수 있는 NRQL 쿼리를 제공합니다. 이러한 쿼리를 쿼리 빌더에 복사하거나 사용자 정의 대시보드에 추가하여 귀하의 인사이트 데이터에 대해 더 깊이 알아보세요.

기본 데이터 구조에 대한 자세한 내용은 [보안 데이터 구조 참조를](/docs/vulnerability-management/advanced/data-structure) 참조하십시오.

## 임원 보고

### 심각도별 전체 공개 취약점 수

취약점 노출 현황을 전체적으로 파악하세요:

```sql
FROM Vulnerability
SELECT count(*) as 'Total Vulnerabilities'
WHERE state = 'OPEN'
FACET severity
SINCE 1 day ago
```

### 심각도 및 중증도 추세

시간이 지남에 따라 주요 취약점이 어떻게 변화하는지 추적하십시오.

```sql
FROM Vulnerability
SELECT count(*) as 'Critical & High Vulnerabilities'
WHERE severity IN ('CRITICAL', 'HIGH')
AND state = 'OPEN'
TIMESERIES AUTO
SINCE 30 days ago
```

### 엔티티별 취약점

어떤 애플리케이션이나 호스트에 가장 많은 취약점이 있는지 파악하십시오.

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerability Count'
WHERE state = 'OPEN'
FACET entity.name
LIMIT 20
SINCE 1 day ago
```

### 포트폴리오 전반에 걸친 취약점 분포

취약점 확산 양상을 파악하십시오:

```sql
FROM Vulnerability
SELECT percentage(count(*), WHERE severity = 'CRITICAL') as 'Critical %',
       percentage(count(*), WHERE severity = 'HIGH') as 'High %',
       percentage(count(*), WHERE severity = 'MEDIUM') as 'Medium %',
       percentage(count(*), WHERE severity = 'LOW') as 'Low %'
WHERE state = 'OPEN'
SINCE 1 day ago
```

## 우선순위 설정 및 위험 평가

### 우선순위가 높은 취약점

악용 가능성이 높은 취약점을 찾으세요:

```sql
FROM Vulnerability
SELECT cveId, affectedPackage, affectedVersion, cvssScore, epssPercentile
WHERE epssPercentile > 90
AND state = 'OPEN'
ORDER BY epssPercentile DESC
LIMIT 50
SINCE 7 days ago
```

### 활성 랜섬웨어 취약점

랜섬웨어 공격에 사용되는 취약점을 식별하십시오:

```sql
FROM Vulnerability
SELECT cveId, affectedPackage, cvssScore, entity.name
WHERE activeRansomware = true
AND state = 'OPEN'
FACET cveId, entity.name
SINCE 30 days ago
```

### 새롭게 발견된 심각한 취약점

새로운 중요 발견 사항을 모니터링하십시오.

```sql
FROM Vulnerability
SELECT cveId, affectedPackage, affectedVersion, entity.name, detectedAt
WHERE severity = 'CRITICAL'
AND state = 'OPEN'
AND detectedAt > ago(24 hours)
ORDER BY detectedAt DESC
```

### 즉각적인 조치가 필요한 취약점

여러 위험 요소를 결합하세요:

```sql
FROM Vulnerability
SELECT cveId, entity.name, affectedPackage, cvssScore, epssPercentile
WHERE (
  (severity = 'CRITICAL' AND epssPercentile > 85) OR
  (activeRansomware = true) OR
  (epssPercentile > 95)
)
AND state = 'OPEN'
FACET cveId, entity.name
SINCE 7 days ago
```

## 노출 및 개선 조치 추적

### 평균 노출 시간

평균 복구 시간(MTTR)을 계산합니다.

```sql
FROM Vulnerability
SELECT average((resolvedAt - detectedAt) / 86400) as 'Avg Days to Resolve'
WHERE state = 'CLOSED'
FACET severity
SINCE 90 days ago
```

### 가장 오랫동안 해결되지 않은 취약점

장기간 열려 있는 취약점을 찾아보세요:

```sql
FROM Vulnerability
SELECT cveId, entity.name, affectedPackage, detectedAt,
       (max(timestamp) - detectedAt) / 86400 as 'Days Open'
WHERE state = 'OPEN'
FACET cveId, entity.name
ORDER BY 'Days Open' DESC
LIMIT 20
SINCE 90 days ago
```

### 교정 속도

취약점 해결 속도를 추적하세요:

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerabilities Resolved'
WHERE state = 'CLOSED'
FACET weekOf(resolvedAt)
SINCE 90 days ago
TIMESERIES 1 week
```

### 연령대별 버킷

취약점을 발생 기간에 따라 그룹화하세요:

```sql
FROM Vulnerability
SELECT count(*) as 'Count'
WHERE state = 'OPEN'
FACET cases(
  WHERE (now() - detectedAt) / 86400 <= 7 as '0-7 days',
  WHERE (now() - detectedAt) / 86400 <= 30 as '8-30 days',
  WHERE (now() - detectedAt) / 86400 <= 90 as '31-90 days',
  WHERE (now() - detectedAt) / 86400 > 90 as '> 90 days'
)
SINCE 180 days ago
```

## 패키지 및 라이브러리 분석

### 가장 취약한 라이브러리

가장 많은 취약점을 유발하는 라이브러리를 식별하십시오.

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerability Count'
WHERE state = 'OPEN'
FACET affectedPackage
ORDER BY count(*) DESC
LIMIT 10
SINCE 30 days ago
```

### 업그레이드가 필요한 라이브러리

수정 사항이 포함된 패키지를 찾으세요:

```sql
FROM Vulnerability
SELECT affectedPackage, affectedVersion, fixedVersion, count(*) as 'Vulnerable Entities'
WHERE state = 'OPEN'
AND fixedVersion IS NOT NULL
FACET affectedPackage, affectedVersion, fixedVersion
ORDER BY count(*) DESC
LIMIT 20
SINCE 7 days ago
```

### 소스별 취약점 탐지

어떤 통합 기능이 취약점을 발견하는지 파악하십시오.

```sql
FROM Vulnerability
SELECT count(*) as 'Detections'
FACET source
SINCE 30 days ago
```

### 의존성/종속성 분석

자바 관련 취약점에 집중하세요:

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerabilities'
WHERE affectedPackage LIKE '%.jar'
OR affectedPackage LIKE '%maven%'
FACET affectedPackage, severity
SINCE 30 days ago
```

## 엔티티별 쿼리

### 애플리케이션 취약점 요약

특정 애플리케이션의 취약점 개수를 확인하세요:

```sql
FROM Vulnerability
SELECT count(*) as 'Total',
       filter(count(*), WHERE severity = 'CRITICAL') as 'Critical',
       filter(count(*), WHERE severity = 'HIGH') as 'High',
       filter(count(*), WHERE severity = 'MEDIUM') as 'Medium',
       filter(count(*), WHERE severity = 'LOW') as 'Low'
WHERE entity.name = 'YOUR_APP_NAME'
AND state = 'OPEN'
SINCE 1 day ago
```

### 호스트 구성 분석

인프라 호스트의 취약점을 분석합니다.

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerabilities'
WHERE entityType = 'HOST'
AND state = 'OPEN'
FACET entity.name, severity
LIMIT 50
SINCE 7 days ago
```

### 최근 스캔 기록이 없는 경우

보고 데이터가 아닐 수 있는 부분을 식별하십시오.

```sql
FROM Vulnerability
SELECT entity.name, max(timestamp) as 'Last Scan'
FACET entity.name
HAVING max(timestamp) < ago(7 days)
SINCE 30 days ago
```

## 규정 준수 및 보고

### 30일 이상 경과된 취약점 (SLA 추적)

취약점 해결 SLA를 초과하는 취약점을 모니터링하세요.

```sql
FROM Vulnerability
SELECT count(*) as 'Overdue Vulnerabilities',
       entity.name,
       severity
WHERE state = 'OPEN'
AND detectedAt < ago(30 days)
FACET entity.name, severity
SINCE 180 days ago
```

### Critical 접속 응답 시간

심각한 취약점이 얼마나 빨리 해결되는지 추적하세요:

```sql
FROM Vulnerability
SELECT percentile((resolvedAt - detectedAt) / 86400, 50, 75, 90, 95) as 'Days to Resolve'
WHERE severity = 'CRITICAL'
AND state = 'CLOSED'
SINCE 90 days ago
```

### 월간 기준

월간 보고서 생성:

```sql
FROM Vulnerability
SELECT count(*) as 'Total Detected',
       uniqueCount(entity.guid) as 'Affected Entities',
       filter(count(*), WHERE severity IN ('CRITICAL', 'HIGH')) as 'High Risk'
FACET monthOf(detectedAt)
SINCE 180 days ago
TIMESERIES 1 month
```

## 고급 분석

### 폭발 반경

많은 부분에 영향을 미치는 부분을 식별합니다.

```sql
FROM Vulnerability
SELECT cveId, count(entity.guid) as 'Affected Entities', max(cvssScore) as 'CVSS'
WHERE state = 'OPEN'
FACET cveId
HAVING count(entity.guid) > 5
ORDER BY count(entity.guid) DESC
LIMIT 20
SINCE 30 days ago
```

### 보안 위생 점수

사용자 지정 보안 점수를 계산합니다.

```sql
FROM Vulnerability
SELECT 100 - (
  filter(count(*), WHERE severity = 'CRITICAL') * 10 +
  filter(count(*), WHERE severity = 'HIGH') * 5 +
  filter(count(*), WHERE severity = 'MEDIUM') * 2 +
  filter(count(*), WHERE severity = 'LOW') * 0.5
) as 'Security Score'
WHERE state = 'OPEN'
FACET entity.name
SINCE 1 day ago
```

### 유형별 취약점 추세

애플리케이션 취약점과 인프라 취약점을 비교하십시오.

```sql
FROM Vulnerability
SELECT count(*) as 'Vulnerabilities'
WHERE state = 'OPEN'
FACET entityType
TIMESERIES AUTO
SINCE 30 days ago
```

## 이러한 쿼리를 사용하여

### 쿼리 빌더에서

1. **[one.newrelic.com &gt; All capabilities](https://one.newrelic.com/all-capabilities) &gt; Query your data**로 이동하세요.
2. 이 페이지의 쿼리를 복사하여 붙여넣으세요.
3. 결과를 보려면 **Run \[실행]을** 클릭하세요.
4. 필요에 따라 시간 범위와 필터를 조정하세요.

### 맞춤형 대시보드

1. 새 대시보드를 만들거나 기존 대시보드를 편집하세요.
2. 위젯을 추가하고 **Query builder** \[쿼리 빌더]를선택하세요.
3. 쿼리를 붙여넣고 시각화를 구성하세요.
4. 위젯을 대시보드에 저장하세요

### 알림에서

1. **Alerts &gt; Create a condition**으로 이동하세요.
2. 조건 유형으로 **NRQL query** \[NRQL 쿼리]를 선택하세요.
3. 개수를 반환하는 쿼리나 기둥값, 관련값을 사용하세요.
4. 공지 청소년 값, 공지 채널 구성

알림에 대한 자세한 내용은 [취약점 알림 설정하기를](/docs/vulnerability-management/advanced/set-up-alerts) 참조하세요.

## 쿼리 사용자 지정 팁

### 교체 플레이스홀더

* `'YOUR_APP_NAME'` - 실제 애플리케이션 이름으로 바꿔주세요
* `'YOUR_ENTITY_GUID'` - 해당 엔티티의 GUID로 바꿔주세요
* 시간 범위(예: `SINCE 30 days ago`) - 필요에 따라 조정하세요

### 다른 데이터와 결합

APM 또는 피규어를 사용하여 데이터 조인:

```sql
FROM Vulnerability, Transaction
SELECT count(Vulnerability.cveId), average(Transaction.duration)
WHERE Vulnerability.entity.guid = Transaction.appId
AND Vulnerability.state = 'OPEN'
FACET Vulnerability.entity.name
SINCE 1 day ago
```

### 결과 내보내기

모든 쿼리 결과는 다음과 같습니다.

* CSV 파일로 다운로드됨
* 대시보드에 추가되었습니다
* API를 통해 내보내기
* 팀원들과 공유했습니다.

## 다음은 뭐지?

<DocTiles>
  <DocTile title="데이터 구조 참조" path="/docs/vulnerability-management/advanced/data-structure">
    이벤트 유형 및 속성에 대해 자세히 알아보세요.
  </DocTile>

  <DocTile title="알림 설정" path="/docs/vulnerability-management/advanced/set-up-alerts">
    이러한 쿼리를 기반으로 알림을 생성하세요.
  </DocTile>

  <DocTile title="NRQL 문서" path="/docs/nrql/get-started/introduction-nrql-new-relics-query-language">
    NRQL 구문에 대해 자세히 알아보세요.
  </DocTile>
</DocTiles>