---
title: NGINX監視インテグレーション
tags:
  - Integrations
  - On-host integrations
  - On-host integrations list
metaDescription: 'New Relics NGINX monitoring integration: how to install it, configure it, and details about the data it reports.'
translationType: human
---

import ecs from './images/ecs.png';

import kubernetes from './images/kubernetes-k8.png';

NGINX[インテグレーション](/docs/integrations/host-integrations/getting-started/introduction-host-integrations)では、NGINXデータベースからインベントリとメトリクスを収集して当社のプラットフォームに送信します。このプラットフォームで、接続やクライアントのリクエストについてのデータを確認し、問題の原因を見つけることができます。

NGINXモニタリングインテグレーションをインストールするには、以下の手順を実行する必要があります。

1. [NGINXサーバーを有効にします](#enable-instance)。
2. [インテグレーションの設定](#config)。
3. [インテグレーションのインストールとアクティブ化](#install)。
4. [データの検索と使用](#find-and-use)。
5. 必要に応じて、[高度な構成設定](https://docs-preview.newrelic.com/docs/integrations/nginx/nginx-advanced-config)を参照してください。

<Callout variant="important">
  最善の結果を得るため、[インテグレーションパッケージの更新](/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package)と[Infrastructureエージェントの更新](/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent)を定期的に実施してください。
</Callout>

## 互換性および要件 [#req]

当社のインテグレーションは、NGINX Open SourceとNGINX Plusの両方と互換性があります。インテグレーションをインストールする前に、以下の要件を満たしていることを確認してください。

* New Relicアカウント。アカウントをお持ちでない場合[無料サインアップ](https://newrelic.com/signup)クレジットカードは不要です。

* [インテグレーションの設定](#config)セクションで説明しているとおり、NGINXエクステンションが有効になっています。

* NGINXが、KubernetesまたはAmazon ECSで実行されていない場合、[Infrastructureエージェント](/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic)が、NGINXを実行しているLinux OSホストにインストールされている必要があります。その他の場合：

  * <ImageSizing width="32px" height="32px">![Kubernetes](./images/kubernetes-k8.png "Kubernetes")</ImageSizing>

    Kubernetesで実行されている場合は、[これらの要件](/docs/monitor-service-running-kubernetes#requirements)をご覧ください。

  * <ImageSizing width="32px" height="32px">![ECS](./images/ecs.png "ECS")</ImageSizing>

    Amazon ECSで実行されている場合は、[これらの要件](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)をご覧ください。

## NGINXサーバーの有効化 [#enable-instance]

NGINXインテグレーションからデータを取得するには、まず該当する拡張モジュールを有効化し、設定する必要があります。

* NGINX Open Sourceの場合、[HTTPスタブステータスモジュール](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html)を参照してください。
* NGINX Plusの場合、[HTTPステータスモジュール](https://nginx.org/en/docs/http/ngx_http_status_module.html)および[HTTP APIモジュール](http://nginx.org/en/docs/http/ngx_http_api_module.html)を参照してください。

## インテグレーションの設定 [#config]

インストールの方法により、インテグレーションの設定方法はいくつかあります。

* <ImageSizing width="32px" height="32px">![Kubernetes](./images/kubernetes-k8.png "Kubernetes")</ImageSizing>

  Kubernetesで有効化した場合、[Kubernetes上で実行中のサービスの監視](/docs/monitor-service-running-kubernetes)を参照してください。

* <ImageSizing width="32px" height="32px">![ECS](./images/ecs.png "ECS")</ImageSizing>

  Amazon ECSで有効化した場合、[ECS上で実行中のサービスの監視](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)を参照してください。

* オンホストにインストールする場合、インテグレーション`nginx-config.yml`設定ファイルを編集します。インテグレーションのYAML形式設定では、必要なログインクレデンシャルやデータの収集方法を設定できます。変更するオプションは、設定とプリファレンスにより異なります。設定ファイルには、`間隔`、`タイムアウト`、`inventory_source`など、すべてのインテグレーションに適用される共通設定があります。これらの共通設定については、[YAML設定形式](/docs/create-integrations/infrastructure-integrations-sdk/specifications/host-integrations-newer-configuration-format/#configuration-basics)を参照してください。

<Callout variant="important">
  レガシー設定および定義ファイルを引き続き使用する場合は、この[ドキュメント](/docs/create-integrations/infrastructure-integrations-sdk/specifications/host-integrations-standard-configuration-format/)を参照してください。
</Callout>

設定ファイルの`env`セクションを使用して、NGINXに関連する特定の設定を定義します。これらの設定は、NGINXインスタンスへの接続、およびその他のセキュリティ設定と機能を制御します。有効な設定のリストについては、このドキュメントの次のセクションで説明します。

## インテグレーションのインストールとアクティブ化 [#install]

NGINXインテグレーションをインストールするには、環境の指示に従います。

### Linuxへのインストレーション [#linux-install]

1. [Infrastructureエージェント](/docs/integrations/host-integrations/installation/install-infrastructure-host-integrations/#install)をインストールし、ファイル名に`nri-nginx`を使用します。

2. 以下を実行して、ディレクトリをインテグレーションの設定フォルダーに変更します。

   ```shell
   cd /etc/newrelic-infra/integrations.d
   ```

3. 以下を実行して、サンプルの設定ファイルをコピーします。

   ```shell
   sudo cp nginx-config.yml.sample nginx-config.yml
   ```

4. お気に入りのエディターで、`nginx-config.yml`設定ファイルを編集します。[優れた設定ファイルの例](#examples)をいくつかご覧ください。

5. Infrastructureエージェントを再起動します。[さまざまなLinux環境でInfrastructureエージェントを再起動する](/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status/#linux)方法を参照してください。

### その他の環境 [#other-env-install]

<CollapserGroup>
  <Collapser
    id="ecs-install"
    title={<><img src={ecs} title="Amazon ECS installation" alt="Amazon ECS installation" style={{ height: '32px', width: '32px', verticalAlign: 'middle' }}/>Amazon ECSへのインストレーション</>}
  >
    [ECSで実行しているサービスを監視する](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)をご覧ください。
  </Collapser>

  <Collapser
    id="k8s-install"
    title={<><img src={kubernetes} title="Kubernetes installation" alt="Kubernetes installation" style={{ height: '32px', width: '32px', verticalAlign: 'middle' }}/>Kubernetesへのインストレーション</>}
  >
    [Kubernetesで実行しているサービスを監視する](/docs/monitor-service-running-kubernetes)をご覧ください。
  </Collapser>
</CollapserGroup>

追加の注：

* **アドバンスト：**インテグレーションは[tarball書式](/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball)で使用すると、パッケージマネージャ以外にもインストールできます。
* **オンホストインテグレーションは、自動的にアップデートしません。**最善の結果を得るため、[インテグレーションパッケージの更新](/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package)と[Infrastructureエージェントの更新](/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent)を定期的に実施してください。

## nginx-config.ymlサンプルファイル [#examples]

<CollapserGroup>
  <Collapser
    id="example1"
    title="基本設定"
  >
    これは、ローカルホストからメトリクスとインベントリを収集するための非常に基本的な設定です。

    ```
    integrations:
      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: http://127.0.0.1/status
          STATUS_MODULE: discover
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer

      - name: nri-nginx
        env:
          INVENTORY: "true"
          STATUS_URL: http://127.0.0.1/status
          CONFIG_PATH: /etc/nginx/nginx.conf
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/nginx
    ```
  </Collapser>

  <Collapser
    id="example2"
    title="HTTP基本認証"
  >
    この設定は、基本認証で保護されたローカルホストからメトリクスとインベントリを収集します。STATUS_URLの`ユーザー名`と`パスワード`を認証情報に置き換えます。

    ```
    integrations:
      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: http://username:password@127.0.0.1/status
          STATUS_MODULE: discover
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer

      - name: nri-nginx
        env:
          INVENTORY: "true"
          STATUS_URL: http://username:password@127.0.0.1/status
          CONFIG_PATH: /etc/nginx/nginx.conf
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/nginx
    ```
  </Collapser>

  <Collapser
    id="example3"
    title="自己署名証明書が1つだけのメトリクス"
  >
    この設定では、メトリクスのみを収集するための`METRICS: true`を含むインテグレーションブロックが1つだけあり、`VALIDATE_CERTS: false`を追加して、自己署名証明書の使用時にサーバーのSSL証明書の検証を防止します。

    ```
    integrations:
      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: https://my_nginx_host/status
          STATUS_MODULE: discover
          VALIDATE_CERTS: false
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>

  <Collapser
    id="example4"
    title="環境変数の置換"
  >
    この設定では、環境変数`NGINX_STATUS`を使用して、インテグレーションのSTATUS_URL設定を入力します。

    ```
    integrations:
      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: {{NGINX_STATUS}}
          STATUS_MODULE: discover
          VALIDATE_CERTS: false
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>

  <Collapser
    id="example5"
    title="マルチインスタンス監視"
  >
    この設定では、同じインテグレーションから複数のNGINXサーバーを監視しています。最初のインスタンス（`STATUS_URL：https://1st_nginx_host/status`）ではメトリクスとインベントリを収集し、2番目のインスタンス（`STATUS_URL：https://2nd_nginx_host/status`）ではメトリクスのみを収集します。

    ```
    integrations:
      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: https://1st_nginx_host/status
          STATUS_MODULE: discover
          VALIDATE_CERTS: false
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer
      - name: nri-nginx
        env:
          INVENTORY: "true"
          STATUS_URL: https://1st_nginx_host/status
          CONFIG_PATH: /etc/nginx/nginx.conf
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/nginx

      - name: nri-nginx
        env:
          METRICS: "true"
          STATUS_URL: http://2nd_nginx_host/status
          STATUS_MODULE: discover
          VALIDATE_CERTS: false
          REMOTE_MONITORING: true
        interval: 30s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>
</CollapserGroup>

## データの検索と使用 [#find-and-use]

インテグレーションを設定してインストールすると、モニタリングを開始できます。

* このサービスからのデータは、[インテグレーションダッシュボード](/docs/infrastructure/infrastructure-integrations/get-started/use-integration-data-new-relic-dashboards/#nrql)にレポートされます。
* `NginxSample`[イベントタイプ](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic)に関連付けられているメトリクス。トラブルシューティング目的で、またはカスタムのチャートとダッシュボードを作成するために、[このデータのクエリ](/docs/using-new-relic/data/understand-data/query-new-relic-data)を行えます。

データの検索および使用方法の詳細については、以下を参照してください。

* [NGINXの高度な設定](/docs/infrastructure/host-integrations/host-integrations-list/nginx/nginx-advanced-config)
* [インテグレーションデータの理解](/docs/infrastructure/integrations/find-use-infrastructure-integration-data)