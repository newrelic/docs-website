---
title: "Tutoriel NerdGraph\_: Configurer l'intégration RAG"
metaDescription: Enhance New Relic AI with RAG (Retrieval Augmented Generation)
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Avec New Relic, vous pouvez améliorer les agents New Relic AI avec la génération augmentée de récupération (RAG) en associant votre documentation, vos runbooks, vos rétroactions incident et même votre source de code à vos services. Ce processus donne à New Relic AI des informations plus détaillées sur les problèmes liés à votre système. Le didacticiel explique comment obtenir l&apos;ID de votre organisation, créer un outil RAG et ajouter vos documents à la plateforme à l&apos;aide de l&apos;API Blob.

Après avoir ajouté vos documents, vous créerez une relation pour les associer à l&apos;outil RAG. Vous pouvez ensuite vérifier votre configuration en interrogeant les relations entre les documents RAG et l’outil RAG. L’étape finale consiste à interroger l’outil RAG lui-même pour récupérer des informations pertinentes et indexées.

Pour en savoir plus sur le connecteur de connaissances, reportez-vous à [New Relic AI Connecteur de connaissances](/docs/agentic-ai/knowledge-integration/overview).

<Callout variant="important">
  Avant d&apos;effectuer les étapes suivantes, assurez-vous que vous disposez des autorisations « Administrateur de produit d&apos;organisation ».
</Callout>

Pour commencer à indexer votre contenu et bénéficier du connecteur de connaissances avec New Relic AI, suivez les étapes mentionnées :

## Tâche 1 : Créez votre outil RAG [#create-your-rag-tool]

<CollapserGroup>
  <Collapser id="get-started" title="Obtenez l'identifiant de votre organisation">
    L&apos;ID d&apos;organisation identifie de manière unique votre compte et garantit que tout outil RAG que vous créez, les documents que vous téléchargez ou les relations que vous établissez sont associés à votre organisation dans New Relic.

    L&apos;ID d&apos;organisation est requis pour effectuer des mutations et des requêtes dans NerdGraph lors de la configuration et de la gestion des outils et documents RAG. Exécutez la requête suivante et conservez l’ID de l’organisation à portée de main pour les étapes ultérieures.

    ### Exemple de requête

    ```graphql
    {
      actor {
        organization {
          id
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="create-rag-tool" title="Créer un outil RAG">
    Un outil RAG agit comme un conteneur spécialisé pour organiser les documents et ressources associés dans New Relic. Un nom clair et une description précise de vos outils RAG aident le LLM à sélectionner le bon outil pour chaque prompt, garantissant des réponses pertinentes et contextuelles.

    Pour créer un nouvel outil RAG dans votre compte New Relic, exécutez la mutation `entityManagementCreateRagTool` suivante :

    1. Assurez-vous de remplacer `${ORGANIZATION_ID}` par votre identifiant d’organisation réel obtenu à l’étape précédente.
    2. En cas de succès, vous recevrez un `id` pour votre outil RAG.

    ### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ragToolEntity`
          </td>

          <td>
            Objet
          </td>

          <td>
            Oui
          </td>

          <td>
            L&apos;objet d&apos;entrée qui contient la configuration du nouvel outil RAG.
          </td>
        </tr>

        <tr>
          <td>
            `description`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Une description claire et précise de l’objectif de l’outil RAG.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le nom unique de votre outil RAG.
          </td>
        </tr>

        <tr>
          <td>
            `scope`
          </td>

          <td>
            Objet
          </td>

          <td>
            Oui
          </td>

          <td>
            Un objet définissant le contexte dans lequel l&apos;outil sera créé.
          </td>
        </tr>

        <tr>
          <td>
            `scope.id`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            L&apos;ID unique de votre organisation (

            `${ORGANIZATION_ID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `scope.type`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le type de portée, qui doit être 

            `ORGANIZATION`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      entityManagementCreateRagTool(
        ragToolEntity: {
          description: "Runbooks for resolving incidents with APIs",
          name: "API Runbooks",
          scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}
        }
      ) {
        entity {
          id
        }
      }
    }
    ```

    Vous devez enregistrer le `id` renvoyé car vous en aurez besoin dans les étapes ultérieures pour lier des documents à l&apos;outil, vérifier les relations et interroger l&apos;outil pour obtenir des informations pertinentes dans New Relic.
  </Collapser>
</CollapserGroup>

## Tâche 2 : Indexez vos documents [#index-your-documents]

<CollapserGroup>
  <Collapser id="upload-document" title="Télécharger un document via l'API Blob">
    <Callout variant="important">
      Tous les documents indexés sont visibles par tous les utilisateurs de votre organisation. Assurez-vous que les documents que vous indexez sont conformes à vos politiques internes et ne téléchargez pas de données sensibles ou privées.
    </Callout>

    ### L&apos;API Blob et son objectif

    L&apos;API Blob est un service New Relic conçu pour télécharger des fichiers, tels que de la documentation et des runbooks, sur votre compte. NerdGraph est optimisé pour les requêtes de données structurées et les mutations et non pour le transfert efficace de fichiers, donc l&apos;API Blob est requise pour le téléchargement de documents.

    ### Exigences d&apos;authentification

    Vous avez besoin d’une clé API New Relic valide avec des autorisations pour télécharger des documents. Pour obtenir la clé API permettant de télécharger un document sur New Relic à l&apos;aide de l&apos;API Blob :

    1. Connectez-vous à votre compte [New Relic](https://one.newrelic.com/).
    2. Créez et gérez votre clé API à partir de la [page d&apos;interface utilisateur de la clé API](https://one.newrelic.com/administration/api-keys).
    3. Cliquez sur **Create a key** et remplissez les détails requis (ou utilisez une clé existante avec les autorisations requises).
    4. Cliquez sur **Create a key** et copiez la clé générée (elle ressemblera à NRAK-XXXXXXXXXX).

    Voici un exemple de la manière de télécharger un document à l&apos;aide d&apos;une commande `curl` `bash` :

    ### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `Api-Key`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Votre clé API New Relic pour l&apos;authentification.
          </td>
        </tr>

        <tr>
          <td>
            `NewRelic-Entity`
          </td>

          <td>
            Objet JSON
          </td>

          <td>
            Oui
          </td>

          <td>
            métadonnées sur le document, comme son nom.
          </td>
        </tr>

        <tr>
          <td>
            `Content-Type`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le format du fichier en cours de téléchargement (par exemple, 

            `application/json`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `payload`

             (

            `@incidents.json`

            )
          </td>

          <td>
            Déposer
          </td>

          <td>
            Oui
          </td>

          <td>
            Le fichier de document que vous téléchargez, spécifié par son chemin de fichier.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de requête

    ```shell
    curl -X POST https://blob-api.service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
         -H 'Api-Key: NRAK-XXXXXXXXXX' \
         -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
         -H 'Content-Type: application/json' \
         -d @incidents.json
    ```

    ### Exemple de réponse

    <table>
      <thead>
        <tr>
          <th>
            Réponse
          </th>

          <th>
            Type de données
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `entityGuid`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            L&apos;identifiant unique du document RAG téléchargé.
          </td>
        </tr>

        <tr>
          <td>
            `blobVersionEntity`
          </td>

          <td>
            Objet
          </td>

          <td>
            Représente la version du blob téléchargé.
          </td>
        </tr>
      </tbody>
    </table>

    ```json
    {
      "entityGuid": "MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk",
      "blobVersionEntity": null
    }
    ```

    ### Prochaines étapes

    Après avoir téléchargé votre document, il est indexé et devient disponible pour que New Relic AI puisse le rechercher et le récupérer. Vous devez enregistrer le `entityGuid` de la réponse pour créer une relation avec votre outil RAG ou pour interroger le document dans NerdGraph.
  </Collapser>

  <Collapser id="view-the-rag-document-entity-represented-in-nerdgraph" title="Afficher l'entité de document RAG représentée dans NerdGraph">
    Une fois qu&apos;un document est téléchargé via l&apos;API Blob, l&apos;exécution de cette requête confirme que le téléchargement a réussi et que le document a été correctement enregistré en tant qu&apos;entité de document RAG avec son propre identifiant et ses propres propriétés uniques.

    #### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le GUID unique du document RAG à récupérer.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de requête

    Dans la requête ci-dessous, remplacez l&apos;espace réservé `${RAG_DOCUMENT_GUID}` par le `entityGuid` que vous avez reçu à l&apos;étape précédente.

    ```graphql
    {
      actor {
        entityManagement {
          entity(
            id: `${RAG_DOCUMENT_GUID}`
          ) {
            ... on EntityManagementRagDocumentEntity {
              id
              name
              blob {
                url
              }
              type
            }
          }
        }
      }
    }
    ```

    Cette requête renverra les détails suivants sur votre document RAG :

    * `id`: L&apos;ID unique du document RAG.
    * `name`: Le nom du document RAG.
    * `blob { url }`: L&apos;URL pour accéder au document téléchargé.
    * `type`: Le type de l&apos;entité, qui dans ce cas est `EntityManagementRagDocumentEntity`.
  </Collapser>

  <Collapser id="create-a-relationship-between-the-rag-document-and-the-rag-tool" title="Créer une relation entre l'outil RAG et le document RAG">
    Maintenant que vous avez créé un outil RAG, téléchargé votre document et vérifié que le téléchargement a réussi, l&apos;étape suivante consiste à associer l&apos;outil RAG et le document RAG, rendant ainsi votre document consultable et utilisable par New Relic AI. Pour ce faire, exécutez la mutation `entityManagementCreateRelationship` :

    1. Remplacez `${RAG_DOCUMENT_GUID}` par le `entityGuid` de la réponse du téléchargement du document via l&apos;API Blob.
    2. Remplacez `${RAG_TOOL_GUID}` par le `id` de la réponse de la mutation de création de l&apos;outil RAG.

    ### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationship`
          </td>

          <td>
            Objet
          </td>

          <td>
            Oui
          </td>

          <td>
            L&apos;objet d&apos;entrée qui contient les détails de la relation.
          </td>
        </tr>

        <tr>
          <td>
            `source`
          </td>

          <td>
            Objet
          </td>

          <td>
            Oui
          </td>

          <td>
            L&apos;entité source de la relation, qui est le document RAG.
          </td>
        </tr>

        <tr>
          <td>
            `source.scope`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            La portée de l&apos;entité source, qui doit être 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `source.id`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le GUID unique du document RAG (

            `${RAG_DOCUMENT_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `target`
          </td>

          <td>
            Objet
          </td>

          <td>
            Oui
          </td>

          <td>
            L&apos;entité cible de la relation, qui est l&apos;outil RAG.
          </td>
        </tr>

        <tr>
          <td>
            `target.scope`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            La portée de l&apos;entité cible, qui doit être 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `target.id`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le GUID unique de l&apos;outil RAG (

            `${RAG_TOOL_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `type`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le type de relation, qui doit être 

            `"INDEXED_FOR"`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      entityManagementCreateRelationship(
        relationship: {
          source: {
            scope: ORGANIZATION,
            id: `${RAG_DOCUMENT_GUID}`
          },
          target: {
            scope: ORGANIZATION,
            id: `${RAG_TOOL_GUID}`
          },
          type: "INDEXED_FOR"
        }
      ) {
        relationship {
          type
          target {
            id
            type
          }
          source {
            id
            type
          }
        }
      }
    }
    ```
  </Collapser>
</CollapserGroup>

## Tâche 3 : Récupérer les informations pertinentes [#retrieve-relevant-information]

<CollapserGroup>
  <Collapser id="query-to-see-relationships-between-rag-documents-and-rag-tools" title="requête pour voir les relations entre les documents RAG et les outils RAG">
    Après avoir créé une relation entre votre document RAG et l’outil RAG, vous pouvez vérifier l’association en interrogeant les relations dans NerdGraph. Cela permet de garantir que votre document est correctement lié et disponible pour l&apos;utilisation par New Relic AI.

    * Remplacez `${RAG_DOCUMENT_ID}` par le `entityGuid` de votre document téléchargé.

    ### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationships`
          </td>

          <td>
            Qequête
          </td>

          <td>
            Oui
          </td>

          <td>
            La requête pour récupérer les relations entre entités.
          </td>
        </tr>

        <tr>
          <td>
            `filter`
          </td>

          <td>
            Objet
          </td>

          <td>
            Non
          </td>

          <td>
            Un objet utilisé pour filtrer les relations en fonction de l&apos;attribut.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId`
          </td>

          <td>
            Objet
          </td>

          <td>
            Non
          </td>

          <td>
            Un objet à filtrer par l&apos;identifiant unique de l&apos;entité source.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId.eq`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Non
          </td>

          <td>
            Le GUID unique du document RAG à faire correspondre.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de requête

    ```graphql
    {
      actor {
        entityManagement {
          relationships(
            filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
          ) {
            items {
              type
              target {
                id
                type
              }
            }
          }
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="query-the-rag-tool" title="interroger l'outil RAG">
    Après avoir configuré votre outil RAG et indexé les documents, vous pouvez interroger l&apos;outil RAG pour récupérer les informations pertinentes en fonction de votre prompt. Cela permet à New Relic AI de faire apparaître des réponses contextuelles à l&apos;aide de la documentation de votre organisation.

    ### Paramètres d&apos;entrée

    <table>
      <thead>
        <tr>
          <th>
            Nom du paramètre
          </th>

          <th>
            Type de données
          </th>

          <th>
            Est-ce obligatoire ?
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `prompt`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            La requête en langage naturel que vous souhaitez que l’outil RAG traite.
          </td>
        </tr>

        <tr>
          <td>
            `toolId`
          </td>

          <td>
            Chaîne
          </td>

          <td>
            Oui
          </td>

          <td>
            Le GUID unique de l&apos;outil RAG à interroger.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de requête

    ```graphql
    {
      actor {
        machineLearning {
          ragQueryData(
            prompt: "tell me about the incident", 
            toolId: `${RAG_TOOL_GUID}`
          ) {
            blobId
            chunk
            documentId
            score
            toolId
          }
        }
      }
    }
    ```

    La réponse inclura des correspondances fragmentées à partir de vos documents indexés, que vous pouvez utiliser directement ou résumer avec New Relic AI.
  </Collapser>
</CollapserGroup>