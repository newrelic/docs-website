---
title: "Tutoriel NerdGraph\_: Gérer les politiques d’accès aux données"
tags:
  - Manage data access policies via NerdGraph
  - Manage data access policies via API
metaDescription: 'Use New Relic NerdGraph to create, update, and manage data access policies for controlling access to log partitions.'
freshnessValidatedDate: never
translationType: machine
---

Vous pouvez utiliser notre [API NerdGraph](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/) pour créer, interroger, mettre à jour et supprimer des politiques d&apos;accès aux données. Les politiques d&apos;accès aux données contrôlent [les partitionslog ](/docs/logs/ui-data/data-partitions/)auxquelles vos utilisateurs peuvent accéder, vous permettant ainsi de restreindre l&apos;accès aux données log sensibles en fonction des groupes d&apos;utilisateurs.

## Exigences [#requirements]

Pour gérer les politiques d&apos;accès aux données via NerdGraph, vous avez besoin de :

* Un compte New Relic [Pro ou Enterprise](https://newrelic.com/pricing)
* Rôle [de gestionnaire de domaine d&apos;authentification](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#admin-settings)
* utilisateur type de [core utilisateur ou plateforme utilisateur complète](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type)
* Une [clé utilisateur](/docs/apis/intro-apis/new-relic-api-keys/#user-key) pour l&apos;authentification.

## Avant de commencer [#before-you-begin]

Avant d’utiliser l’API NerdGraph pour les politiques d’accès aux données, comprenez comment fonctionne [le contrôle d’accès aux données](/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control) et familiarisez-vous avec [NerdGraph](https://api.newrelic.com/graphiql).

## Attribut commun [#attributes]

Les attributs suivants sont couramment utilisés dans les requêtes et les mutations de politiques d&apos;accès aux données :

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Attribut
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>

      <td>
        L&apos;identifiant de l&apos;organisation associée à la police d&apos;assurance. Utilisé pour filtrer les politiques ou définir la portée de la création de politiques.
      </td>
    </tr>

    <tr>
      <td>
        `id`
      </td>

      <td>
        L&apos;identifiant unique de la police d&apos;assurance. Requis lors de la mise à jour ou de la suppression d&apos;une politique spécifique.
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        Un nom convivial pour la politique d&apos;accès aux données.
      </td>
    </tr>

    <tr>
      <td>
        `policy`
      </td>

      <td>
        L&apos;objet JSON qui définit les règles de la politique. Il comprend :

        * `rules`: Un éventail d&apos;objets de règles.
        * `operations`: Les opérations pour autoriser ou refuser (par exemple, `SELECT`, `*`).
        * `eventTypes`: Un objet spécifiant quels types d&apos;événements `allow` (par exemple, `["*"]`) ou `except` (par exemple, `["Log_accessible"]`).
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        L&apos;identifiant du compte auquel le rôle donne accès.
      </td>
    </tr>

    <tr>
      <td>
        `dataAccessPolicyId`
      </td>

      <td>
        L&apos;identifiant de la politique d&apos;accès aux données qui définit quelles données d&apos;un compte sont autorisées.
      </td>
    </tr>

    <tr>
      <td>
        `roleId`
      </td>

      <td>
        L&apos;identifiant du rôle qui définit le niveau d&apos;accès.
      </td>
    </tr>
  </tbody>
</table>

## Opérations communes [#operations]

Voici les opérations les plus courantes pour la gestion des politiques d&apos;accès aux données :

<CollapserGroup>
  <Collapser id="query-grants" title="politiques d'accès aux données de requête associées aux autorisations d'accès">
    Cette requête récupère tous les droits d&apos;accès au sein de votre organisation et leurs politiques d&apos;accès aux données associées. Utilisez cette fonction pour obtenir la liste des politiques actuellement associées aux autorisations.

    ### Exemple de requête

    ```graphql
    {
      customerAdministration {
        grants(filter: {organizationId: {eq: "YOUR_ORG_ID"}}) {
          items {
            dataAccessPolicy {
              id
              name
            }
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requis.** Identifiant de l&apos;organisation à laquelle appartiennent les subventions. Utilisez l&apos;opérateur égal (`eq`) pour filtrer.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "customerAdministration": {
          "grants": {
            "items": [
              {
                "dataAccessPolicy": {
                  "id": "DATA_ACCESS_POLICY_ID",
                  "name": "DATA_ACCESS_POLICY_NAME"
                }
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Liste des subventions de l&apos;organisation.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy`
          </td>

          <td>
            La politique d&apos;accès aux données associée à chaque subvention.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant unique de la politique d&apos;accès aux données.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Le nom de la politique d&apos;accès aux données.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="query-policies" title="politiques d'accès aux données de requête pour une organisation">
    Cette requête récupère toutes les politiques d&apos;accès aux données de votre organisation.

    ### Exemple de requête

    ```graphql
    {
      customerAdministration {
        dataAccessPolicies(
          filter: {organizationId: {eq: "YOUR_ORG_ID"}}
        ) {
          items {
            id
            name
            policy
            status
            version
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requis.** L&apos;identifiant de l&apos;organisation à laquelle appartiennent les polices. Utilisez l&apos;opérateur égal (`eq`) pour filtrer.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "customerAdministration": {
          "dataAccessPolicies": {
            "items": [
              {
                "id": "ddadbdd2-183b-42d9-8a1a-41ec7692fb4c",
                "name": "Log Operations",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Operations"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              },
              {
                "id": "bb8efcf5-3127-4a4d-b25f-114505a0a68d",
                "name": "Restrict Log_Security",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Sec%"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Liste des politiques d&apos;accès aux données au sein de l&apos;organisation.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant unique de la politique d&apos;accès aux données.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Le nom de la politique d&apos;accès aux données.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            L&apos;objet JSON contenant les règles de politique avec `operations` et `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            L&apos;état actuel de la politique (par exemple, `VALID`).
          </td>
        </tr>

        <tr>
          <td>
            `version`
          </td>

          <td>
            La version de la politique (actuellement `1.0-logs`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="create-policy" title="Créer une politique d'accès aux données">
    Cette mutation crée une nouvelle politique d&apos;accès aux données pour contrôler l&apos;accès aux partitions log.

    ### Mutation d&apos;échantillon

    ```graphql
    mutation createMyPolicy {
      dataAccessPolicyCreate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_accessible"]}}]}
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    Vous pouvez également utiliser les variables suivantes :

    ```graphql
    mutation createMyPolicy($policy: DataAccessPolicyRawDocument!) {
      dataAccessPolicyCreate(
        policy: $policy
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    ```json
    {
      "policy": {
        "rules": [
          {"operations": ["SELECT"], "eventTypes": {"allow": ["*"], "except": []}}
        ]
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requis.** Votre identifiant d&apos;organisation New Relic.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Requis.** Un nom descriptif pour cette politique.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Requis.** L&apos;objet JSON définissant les règles de politique avec `operations` et `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "dataAccessPolicyCreate": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant unique de la politique d&apos;accès aux données nouvellement créée.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Le nom de la politique d&apos;accès aux données.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            L&apos;objet JSON contenant les règles de politique avec `operations` et `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            L&apos;état de la politique (par exemple, `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="update-policy" title="Mettre à jour une politique d'accès aux données">
    Cette mutation met à jour une politique d&apos;accès aux données existante afin d&apos;en modifier les règles ou le nom.

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      dataAccessPolicyUpdate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_inaccessible"]}}]}
        name: "Test"
        id: "YOUR_DATA_POLICY_ID"
      ) {
        dataAccessPolicy {
          name
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la police à mettre à jour.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Facultatif.** Nouveau nom pour cette police d&apos;assurance.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Facultatif.** L&apos;objet JSON définissant les règles de politique mises à jour avec `operations` et `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "dataAccessPolicyUpdate": {
          "dataAccessPolicy": {
            "assigned": "UNASSIGNED",
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `assigned`
          </td>

          <td>
            Indique si la politique est attribuée à des subventions (par exemple, `UNASSIGNED`).
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant unique de la politique d&apos;accès aux données mise à jour.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Le nom de la politique d&apos;accès aux données.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            L&apos;objet JSON contenant les règles de politique mises à jour avec `operations` et `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            L&apos;état de la politique (par exemple, `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="delete-policy" title="Supprimer une politique d'accès aux données">
    Cette mutation supprime une politique d&apos;accès aux données existante.

    <Callout variant="important">
      La suppression d&apos;une politique la retire de toutes les autorisations attribuées. Les utilisateurs appartenant à des groupes bénéficiant de ces autorisations perdront les restrictions d&apos;accès aux données définies par la politique.
    </Callout>

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      dataAccessPolicyDelete(id: "YOUR_DATA_POLICY_ID") {
        dataAccessPolicy {
          name
          id
          policy
          status
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la politique à supprimer.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "dataAccessPolicyDelete": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant unique de la politique d&apos;accès aux données supprimées.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Nom de la politique d&apos;accès aux données supprimée.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            L&apos;objet JSON contenant les règles de stratégie qui ont été supprimées.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            L&apos;état de la politique (par exemple, `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="grant-access" title="Créer une autorisation d'accès avec une politique d'accès aux données">
    Cette mutation crée une nouvelle autorisation d&apos;accès qui inclut une politique d&apos;accès aux données, en l&apos;attribuant à un compte et à un rôle spécifiques.

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      authorizationManagementGrantAccess(
        grantAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Requis.** L&apos;identifiant du compte auquel accorder l&apos;accès.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la politique d&apos;accès aux données à appliquer.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Requis.** L&apos;identifiant du rôle définissant les autorisations.
          </td>
        </tr>
      </tbody>
    </table>

    ### Réponse

    La réponse affiche le nouveau droit d&apos;accès créé avec son identifiant.
  </Collapser>

  <Collapser id="update-grant" title="Mettre à jour une autorisation d'accès avec une politique d'accès aux données">
    Cette mutation met à jour une autorisation d&apos;accès existante afin d&apos;ajouter ou de modifier la politique d&apos;accès aux données.

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      authorizationManagementUpdateAccess(
        updateAccessOptions: {accountAccessGrant: {dataAccessPolicyId: "YOUR_DATA_POLICY_ID"}, ids: YOUR_GRANT_ID}
      ) {
        grants {
          dataAccessPolicy {
            id
          }
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ids`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la subvention à mettre à jour.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la politique d&apos;accès aux données à appliquer à la subvention.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemple de réponse

    ```json
    {
      "data": {
        "authorizationManagementUpdateAccess": {
          "grants": [
            {
              "dataAccessPolicy": {
                "id": "YOUR_DATA_POLICY_ID"
              },
              "id": "YOUR_GRANT_ID"
            }
          ]
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Champ de réponse
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `grants`
          </td>

          <td>
            Liste des subventions mises à jour.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy.id`
          </td>

          <td>
            L&apos;identifiant de la politique d&apos;accès aux données désormais attribuée à l&apos;autorisation.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            L&apos;identifiant de la subvention mise à jour.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="revoke-grant" title="Révoquer une autorisation d'accès avec une politique d'accès aux données">
    Cette mutation supprime une autorisation d&apos;accès qui inclut une politique d&apos;accès aux données.

    ### Mutation d&apos;échantillon

    ```graphql
    mutation {
      authorizationManagementRevokeAccess(
        revokeAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            paramètres
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Requis.** L&apos;identifiant du compte de l&apos;autorisation à révoquer.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requis.** L&apos;identifiant de la politique d&apos;accès aux données de l&apos;autorisation à révoquer.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Requis.** L&apos;identifiant du rôle de l&apos;autorisation à révoquer.
          </td>
        </tr>
      </tbody>
    </table>

    ### Réponse

    La réponse affiche l&apos;autorisation d&apos;accès révoquée avec son identifiant.
  </Collapser>
</CollapserGroup>

## Sujets connexes [#related-topics]

<DocTiles>
  <DocTile title="Guide d'utilisation du contrôle d'accès aux données" path="/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control">
    Découvrez comment gérer les politiques d&apos;accès aux données via l&apos;interface utilisateur de New Relic.
  </DocTile>

  <DocTile title="Concepts de gestion des utilisateurs" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">
    Comprendre les types d&apos;utilisateurs, leurs rôles et la gestion des accès.
  </DocTile>

  <DocTile title="Gérer les utilisateurs avec NerdGraph" path="/docs/apis/nerdgraph/examples/nerdgraph-manage-users">
    Utilisez l&apos;API NerdGraph pour gérer par programmation les droits d&apos;accès et les autorisations des utilisateurs.
  </DocTile>

  <DocTile title="Partitions de logs" path="/docs/logs/ui-data/data-partitions/">
    Apprenez à organiser vos données log en partitions.
  </DocTile>
</DocTiles>