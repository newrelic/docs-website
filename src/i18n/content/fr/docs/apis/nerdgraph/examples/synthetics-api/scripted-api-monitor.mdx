---
title: Gérer le moniteur d'API scripté
tags:
  - Synthetics
  - APIs
  - NerdGraph
  - Examples
metaDescription: How to use New Relic NerdGraph API to create and update scripted API monitors for synthetic monitoring.
freshnessValidatedDate: never
translationType: machine
---

New Relic vous permet d&apos;utiliser NerdGraph pour créer [un moniteur d&apos;API scripté](/docs/synthetics/synthetic-monitoring/scripting-monitors/write-synthetic-api-tests). Le moniteur d&apos;API scripté exécute du code JavaScript personnalisé pour tester les API et les services backend sans navigateur, en effectuant requests HTTP et en validant les réponses par programmation. Ce tutoriel fournit des exemples d&apos;utilisation de l&apos;API NerdGraph pour automatiser la création d&apos;un moniteur d&apos;API scripté.

## Créer un moniteur API scripté [#create-scripted-api]

Vous pouvez créer un moniteur d&apos;API scripté en utilisant la mutation `syntheticsCreateScriptApiMonitor`. Cette mutation vous permet de configurer des tests d&apos;API personnalisés qui exécutent votre code JavaScript pour valider les points de terminaison d&apos;API.

### Paramètres d&apos;entrée

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Type de données
      </th>

      <th>
        Est-ce obligatoire ?
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `accountId`
      </td>

      <td>
        Entier
      </td>

      <td>
        Oui
      </td>

      <td>
        Votre 

        [identifiant de compte](/docs/accounts/accounts-billing/account-structure/account-id)

         New Relic sur lequel le moniteur sera créé.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Array
      </td>

      <td>
        Oui
      </td>

      <td>
        éventail d&apos;identifiants 

        [publics d&apos;emplacement](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         où le moniteur effectuera des vérifications (par exemple, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Nom d&apos;affichage de votre moniteur d&apos;API scripté.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Énumération
      </td>

      <td>
        Oui
      </td>

      <td>
        Fréquence d&apos;exécution du moniteur. Options : 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le type d&apos;exécution utilisé par votre moniteur. 

        `NODE_API`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        La version du type d&apos;exécution utilisée par votre moniteur. 

        `16.10`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        La langue utilisée par votre moniteur. 

        `JAVASCRIPT`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le code JavaScript exécuté par le moniteur. Il doit s&apos;agir de texte brut, et non d&apos;un encodage en base64. Le script peut utiliser l&apos;objet $http pour effectuer requests HTTP et réaliser des tests d&apos;API.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Énumération
      </td>

      <td>
        Oui
      </td>

      <td>
        État du moniteur. Options : 

        `ENABLED`

         (le moniteur est actif et effectue des vérifications), 

        `DISABLED`

         (le moniteur est inactif).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Virgule flottante
      </td>

      <td>
        Non
      </td>

      <td>
        L&apos;Apdex cible du moniteur en secondes, utilisé pour alimenter les rapports SLA. Par défaut, 7,0 secondes.
      </td>
    </tr>
  </tbody>
</table>

### Demande d&apos;échantillon

```graphql
mutation {
  syntheticsCreateScriptApiMonitor(
    accountId: ACCOUNT_ID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Exemple de réponse

Une réponse positive renvoie `null` en cas d&apos;erreur :

```json
{
  "data": {
    "syntheticsCreateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

En cas de problème lors de la création du moniteur, le éventail `errors` contiendra des objets avec des champs `description` et `type` expliquant ce qui s&apos;est mal passé.

## Mettre à jour un moniteur d&apos;API scripté [#update-scripted-api]

Vous pouvez mettre à jour un moniteur d&apos;API scripté existant en utilisant la mutation `syntheticsUpdateScriptApiMonitor`. Cela vous permet de modifier la configuration d&apos;un moniteur d&apos;API scripté qui a déjà été créé.

### Paramètres d&apos;entrée

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Type de données
      </th>

      <th>
        Est-ce obligatoire ?
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        L&apos;identifiant unique 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de l&apos;entité du moniteur que vous souhaitez mettre à jour.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Array
      </td>

      <td>
        Non
      </td>

      <td>
        éventail d&apos;identifiants 

        [publics d&apos;emplacement](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         où le moniteur effectuera des vérifications (par exemple, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Non
      </td>

      <td>
        Nom d&apos;affichage mis à jour pour votre moniteur d&apos;API scripté.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Énumération
      </td>

      <td>
        Non
      </td>

      <td>
        Fréquence d&apos;exécution du moniteur. Options : 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Non
      </td>

      <td>
        Le type d&apos;exécution utilisé par votre moniteur. 

        `NODE_API`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Non
      </td>

      <td>
        La version du type d&apos;exécution utilisée par votre moniteur. 

        `16.10`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Non
      </td>

      <td>
        La langue utilisée par votre moniteur. 

        `JAVASCRIPT`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Non
      </td>

      <td>
        Le code JavaScript exécuté par le moniteur. Il doit s&apos;agir de texte brut, et non d&apos;un encodage en base64.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Énumération
      </td>

      <td>
        Non
      </td>

      <td>
        État du moniteur. Options : 

        `ENABLED`

         (le moniteur est actif et effectue des vérifications), 

        `DISABLED`

         (le moniteur est inactif).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Virgule flottante
      </td>

      <td>
        Non
      </td>

      <td>
        L&apos;Apdex cible du moniteur en secondes, utilisé pour alimenter les rapports SLA. Par défaut, 7,0 secondes.
      </td>
    </tr>
  </tbody>
</table>

### Demande d&apos;échantillon

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: ENTITY_GUID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Exemple de réponse

Une réponse positive renvoie `null` en cas d&apos;erreur :

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

En cas de problème lors de la mise à jour du moniteur, le éventail `errors` contiendra des objets avec des champs `description` et `type` expliquant ce qui s&apos;est mal passé.

## Mettre à niveau l&apos;environnement d&apos;exécution d&apos;un moniteur d&apos;API scripté [#upgrade-monitor-runtime]

Vous pouvez mettre à niveau un moniteur d&apos;API scripté pour utiliser le nouvel environnement d&apos;exécution Node.js 16.10. Cela garantit que votre système de monitoring utilise les dernières fonctionnalités et mises à jour de sécurité Node.js

### Paramètres d&apos;entrée

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Type de données
      </th>

      <th>
        Est-ce obligatoire ?
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        L&apos;identifiant unique 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de l&apos;entité du moniteur que vous souhaitez mettre à niveau.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le type d&apos;exécution. 

        `NODE_API`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        La version d&apos;exécution. 

        `16.10`

         est la seule valeur acceptée.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le langage de script. 

        `JAVASCRIPT`

         est la seule valeur acceptée.
      </td>
    </tr>
  </tbody>
</table>

### Demande d&apos;échantillon

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "NODE_API",
        runtimeTypeVersion: "16.10",
        scriptLanguage: "JAVASCRIPT"
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Exemple de réponse

Une réponse positive renvoie `null` en cas d&apos;erreur :

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

En cas de problème lors de la mise à niveau de l&apos;environnement d&apos;exécution du moniteur, le éventail `errors` contiendra des objets avec des champs `description` et `type` expliquant ce qui s&apos;est mal passé.

## Rétrograder la durée d&apos;exécution d&apos;un moniteur d&apos;API scripté [#downgrade-monitor-runtime]

Vous pouvez rétrograder un moniteur d&apos;API scripté pour utiliser un environnement d&apos;exécution legacy. Cela peut s&apos;avérer nécessaire pour des raisons de compatibilité, mais veuillez noter que legacy environnements d&apos;exécution ne seront plus pris en charge le 22 octobre 2024.

<Callout variant="important">
  Les environnements d&apos;exécution hérités sont obsolètes et leur fin de vie est prévue pour le 22 octobre 2024. Le retour à des environnements d&apos; legacy n&apos;est pas recommandé, sauf pour des besoins de compatibilité temporaires.
</Callout>

### Paramètres d&apos;entrée

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Type de données
      </th>

      <th>
        Est-ce obligatoire ?
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        L&apos;identifiant unique 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de l&apos;entité du moniteur que vous souhaitez rétrograder.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Définissez la valeur sur une chaîne vide 

        `""`

         pour utiliser l&apos;ancien environnement d&apos; legacy.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Définissez la valeur sur une chaîne vide 

        `""`

         pour utiliser l&apos;ancien environnement d&apos; legacy.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Définissez la valeur sur une chaîne vide 

        `""`

         pour utiliser l&apos;ancien environnement d&apos; legacy.
      </td>
    </tr>
  </tbody>
</table>

### Demande d&apos;échantillon

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "",
        runtimeTypeVersion: "",
        scriptLanguage: ""
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Exemple de réponse

Une réponse positive renvoie `null` en cas d&apos;erreur :

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

En cas de problème lors de la rétrogradation de l&apos;environnement d&apos;exécution du moniteur, le éventail `errors` contiendra des objets avec des champs `description` et `type` expliquant ce qui s&apos;est mal passé.

## Déplacer un moniteur d&apos;API scripté entre un site privé compatible VSE [#move-monitor]

Vous pouvez déplacer un moniteur d&apos;API scripté entre un site privé compatible VSE. Lors du déplacement du moniteur entre sites privés avec l&apos;exécution script vérifiée (VSE) activée, vous devez inclure le script pour régénérer les HMAC pour la validation de sécurité.

### Paramètres d&apos;entrée

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Type de données
      </th>

      <th>
        Est-ce obligatoire ?
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        L&apos;identifiant unique 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de l&apos;entité du moniteur que vous souhaitez déplacer.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private`
      </td>

      <td>
        Array
      </td>

      <td>
        Oui
      </td>

      <td>
        éventail de configuration de site privé. Chaque emplacement nécessite un 

        `guid`

         et 

        `vsePassword`

         pour les emplacements compatibles VSE.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.guid`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le GUID de l’entité du site cible privé.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.vsePassword`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le mot de passe VSE pour le site cible privé.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Chaîne
      </td>

      <td>
        Oui
      </td>

      <td>
        Le code JavaScript exécuté par le moniteur. Il est indispensable d&apos;inclure cette fonctionnalité pour régénérer les HMAC lors du déplacement entre des emplacements compatibles VSE.
      </td>
    </tr>
  </tbody>
</table>

### Demande d&apos;échantillon

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID"
    monitor: {
      locations: {
        private: [{
          guid: "LOCATION_GUID",
          vsePassword: "YOUR_VSE_PASSWORD"
        }]
      },
      script: "SCRIPT_CONTENT"
    }
  ) {
    errors {
      description
      type
    }
    monitor {
      status
    }
  }
}
```

### Exemple de réponse

Une réponse positive renvoie `null` en cas d&apos;erreur et inclut l&apos;état du moniteur :

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null,
      "monitor": {
        "status": "ENABLED"
      }
    }
  }
}
```

En cas de problème lors du déplacement du moniteur, le éventail `errors` contiendra des objets avec des champs `description` et `type` expliquant ce qui s&apos;est mal passé.

## Supprimer un moniteur d&apos;API scripté [#delete-monitor]

Lorsqu&apos;un moniteur d&apos;API scripté n&apos;est plus nécessaire, vous pouvez le supprimer définitivement à l&apos;aide de la mutation `syntheticsDeleteMonitor`.

Pour supprimer un moniteur, référez-vous à la section [Supprimer un moniteur Synthétique](/docs/apis/nerdgraph/examples/synthetics-api/ping-monitor/#delete-monitor).