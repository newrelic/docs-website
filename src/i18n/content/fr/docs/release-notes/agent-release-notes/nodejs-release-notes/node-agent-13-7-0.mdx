---
subject: Node.js agent
releaseDate: '2025-12-08'
version: 13.7.0
downloadLink: 'https://www.npmjs.com/package/newrelic'
security: []
bugs:
  - Fixed normalization of OTEL hrtime
features:
  - Updated `koa` instrumentation to properly wrap `Router` when using `@koa/router@15.0.0`+
  - Added ability to configure a ratio based sampler
  - 'Updated configuration to allow `adaptive.sampling_target` to be set for `config.distributed_tracing.sampler.root`, `config.distributed_tracing.sampler.remote_parent_sampled`, and `config.distributed_tracing.sampler.remote_parent_not_sampled`'
  - Added support for OTEL span links
  - Replaced `default` with `adaptive` as the default for samplers
  - Preliminary support for partial granularity traces (Not available for production use)
translationType: machine
---

## Remarques

#### Caractéristiques

* Instrumentation `koa` mise à jour pour encapsuler correctement `Router` lors de l&apos;utilisation `@koa/router@15.0.0`+ ([#3550](https://github.com/newrelic/node-newrelic/pull/3550)) ([f1e08ad](https://github.com/newrelic/node-newrelic/commit/f1e08ad9fe200138ab9ed32e423517f64e41af49))

* Ajout de la possibilité de configurer un échantillonneur basé sur un ratio ([#3501](https://github.com/newrelic/node-newrelic/pull/3501)) ([f300bd5](https://github.com/newrelic/node-newrelic/commit/f300bd5eacf9d6509b56484e7ad36d5c0725b497))

  * Pour attribuer un échantillonneur basé sur un ratio, définissez `config.distributed_tracing.sampler.root`, `config.distributed_tracing.sampler.remote_parent_sampled` ou `config.distributed_tracing.sampler.remote_parent_not_sampled` sur `{ trace_id_ratio_based: { ratio: <float between 0 and 1> }}`
  * Pour assigner via des variables d&apos;environnement, définissez `NEW_RELIC_DISTRIBUTED_TRACING_SAMPLER_<TYPE>='trace_id_ratio_based'` et `NEW_RELIC_DISTRIBUTED_TRACING_SAMPLER_<TYPE>_RATIO=<float between 0 and 1>` où `<TYPE>` est l&apos;une des valeurs suivantes : `ROOT`, `REMOTE_PARENT_SAMPLED` ou `REMOTE_PARENT_NOT_SAMPLED`

* configuration mise à jour pour permettre la définition de `adaptive.sampling_target` pour `config.distributed_tracing.sampler.root`, `config.distributed_tracing.sampler.remote_parent_sampled` et `config.distributed_tracing.sampler.remote_parent_not_sampled` ([#3532](https://github.com/newrelic/node-newrelic/pull/3532)) ([44f51dd](https://github.com/newrelic/node-newrelic/commit/44f51dd5583e74aef1e2d0ee9483d51d5ff786c3))

* Ajout de la prise en charge des liaisons OTEL ([#3528](https://github.com/newrelic/node-newrelic/pull/3528)) ([e840690](https://github.com/newrelic/node-newrelic/commit/e8406903dd0c92cd003fac69770785489e1bba85))

* Remplacement de `default` par `adaptive` comme valeur par défaut pour les échantillonneurs ([#3543](https://github.com/newrelic/node-newrelic/pull/3543)) ([3f03162](https://github.com/newrelic/node-newrelic/commit/3f0316285fdde6d3c38ce819aa41221a71bd4fcb))

* Prise en charge préliminaire des traes à granularité partielle (non disponible pour une utilisation en production)

  * Ajout du type `essential` pour les traces à granularité partielle ([#3547](https://github.com/newrelic/node-newrelic/pull/3547)) ([3d85fb5](https://github.com/newrelic/node-newrelic/commit/3d85fb5fa16d411892eb4a23067e66669461ada0))
  * Ajout du type `reduced` pour les traces à granularité partielle. ([#3540](https://github.com/newrelic/node-newrelic/pull/3540)) ([cfa8f41](https://github.com/newrelic/node-newrelic/commit/cfa8f41618595cc5ffb3e3b5574673721c64580c))
  * Ajout d&apos;échantillonneurs à granularité partielle et attribution des transactions avec `isPartialTrace` lorsque des décisions d&apos;échantillonnage à granularité partielle ont été prises ([#3544](https://github.com/newrelic/node-newrelic/pull/3544)) ([1535a82](https://github.com/newrelic/node-newrelic/commit/1535a82331ce40d7c96e0c6746ec70bcdbd6e4f6))
  * refactorisation des échantillonneurs en classes et stockage sur `agent.sampler.*` ([#3527](https://github.com/newrelic/node-newrelic/pull/3527)) ([ad63441](https://github.com/newrelic/node-newrelic/commit/ad634411a0d91240c0c16c7a372b00b36651589f))
  * Classe `Samplers` mise à jour pour normaliser les messages de l&apos;enregistreur, court-circuiter le cas échéant et supprimer les vérifications de chaîne optionnelles ([#3546](https://github.com/newrelic/node-newrelic/pull/3546)) ([4f7684c](https://github.com/newrelic/node-newrelic/commit/4f7684cb4c64a89545704c70c110d2fd13815197))
  * Mise à jour des échantillonneurs pour attribuer une priorité entre 0 et 1 lorsque DT est désactivé ou lorsque la granularité complète et partielle est désactivée ([#3559](https://github.com/newrelic/node-newrelic/pull/3559)) ([7a1c37e](https://github.com/newrelic/node-newrelic/commit/7a1c37e3e04fef0538a8af15fa690915bce65262))
  * transaction mise à jour pour stocker l&apos;indicateur de granularité partielle comme `.partialType` ([#3561](https://github.com/newrelic/node-newrelic/pull/3561)) ([a7f20d8](https://github.com/newrelic/node-newrelic/commit/a7f20d8e83b44556434bae90bd3924c54af9f587))
  * Mise à jour lorsque des règles de granularité partielles sont appliquées ([#3553](https://github.com/newrelic/node-newrelic/pull/3553)) ([a4bdf4f](https://github.com/newrelic/node-newrelic/commit/a4bdf4fbbbdac102519020c5ca4d3dc92eeff844))
  * Ajout `toString` et `get [Symbol.toStringTag]()` à la classe Sampler par défaut ([#3562](https://github.com/newrelic/node-newrelic/pull/3562)) ([771168d](https://github.com/newrelic/node-newrelic/commit/771168dcd927240b6efc703f238046e9a7f7766b))

#### Débogage

* Normalisation corrigée de l&apos;heure OTEL ([#3564](https://github.com/newrelic/node-newrelic/pull/3564)) ([707fe7d](https://github.com/newrelic/node-newrelic/commit/707fe7d6395f0e15b5e6c6195f93df1c27540423))

#### Documentation

* Rapport de compatibilité mis à jour ([#3551](https://github.com/newrelic/node-newrelic/pull/3551)) ([02268a4](https://github.com/newrelic/node-newrelic/commit/02268a4e3fe7b2f2f5c2fd035bcb337fd7b2bfc2))
* Ajout d&apos;un document interne pour l&apos;attribut ([#3539](https://github.com/newrelic/node-newrelic/pull/3539)) ([68543b6](https://github.com/newrelic/node-newrelic/commit/68543b606fc53e59e9a6fcb08173e423bc6437a9))

#### Tâches diverses

* Logging améliorée autour de la charge utile `preconnect`

  * Ajout de logging concernant l&apos;attribution du nom d&apos;hôte pendant `preconnect` ([#3568](https://github.com/newrelic/node-newrelic/pull/3568)) ([3ee4d38](https://github.com/newrelic/node-newrelic/commit/3ee4d383cd7d9e7bf16e9da5e7f130fc2a103ca4))
  * Logging améliorée de l&apos;utilisation de GCP ([#3552](https://github.com/newrelic/node-newrelic/pull/3552)) ([e6c4141](https://github.com/newrelic/node-newrelic/commit/e6c4141b55860b5f1fe5cd14049abb9eca9b3859))

* La résolution de l&apos;utilisation est désormais effectuée simultanément ([#3556](https://github.com/newrelic/node-newrelic/pull/3556)) ([8386360](https://github.com/newrelic/node-newrelic/commit/8386360fe7fb4b7278e001dac8c8293581654069))

* Collecte des métadonnées des scopes d&apos;instrumentation OTEL sur toutes les travées OTEL. ([#3554](https://github.com/newrelic/node-newrelic/pull/3554)) ([75703c4](https://github.com/newrelic/node-newrelic/commit/75703c41a8db1d204a1500b8b43dff0d04a5b286))

* Amélioration du traitement des heures de séjour OTEL ([#3557](https://github.com/newrelic/node-newrelic/pull/3557)) ([8f187b1](https://github.com/newrelic/node-newrelic/commit/8f187b11eac96f78d9743cadb2302001ed94412a))

* Configuration renommée `opentelemetry_bridge` en `opentelemetry` ([#3565](https://github.com/newrelic/node-newrelic/pull/3565)) ([c9d156f](https://github.com/newrelic/node-newrelic/commit/c9d156fe302ffb99b262ffd3e256d953301f08f2))

### Déclaration de soutien :

Nous vous recommandons de mettre à jour vers la dernière version de l&apos;agent dès qu&apos;elle est disponible. Si vous ne pouvez pas effectuer la mise à niveau vers la dernière version, mettez à jour vos agents vers une version datant de moins de 90 jours. En savoir plus sur la façon de tenir les agents informés. ([https://docs.newrelic.com/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/](https://docs.newrelic.com/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/))

Consultez la politique EOL de l&apos;agent New Relic Node.js pour obtenir des informations sur la sortie de l&apos;agent et les dates de support. ([https://docs.newrelic.com/docs/apm/agents/nodejs-agent/getting-started/nodejs-agent-eol-policy/](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/getting-started/nodejs-agent-eol-policy/))