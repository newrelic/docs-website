---
subject: Ruby agent
releaseDate: '2026-01-14'
version: 10.0.0
downloadLink: 'https://rubygems.org/downloads/newrelic_rpm-10.0.0.gem'
features:
  - Remove support for Ruby 2.4 and 2.5
  - Removal of Cross Application Tracing (CAT)
  - Rename ActiveJob metrics and segments
  - Rename `bin/newrelic` command to `bin/newrelic_rpm`
  - Remove the `newrelic deployments` CLI command
  - 'Remove the NewRelic::Agent::SqlSampler#notice_sql method'
  - 'Remove unused arguments from various NewRelic::Agent::Datastores APIs'
  - Remove experimental feature Configurable Security Policies (CSP)
  - Remove support for Puma versions below 3.9.0
  - Improve configuration validation and coercion
  - Replace 'default' option with 'adaptive' for distributed tracing remote parent samplers
  - Add `logger` as a dependency
  - Add Active Support notification allowlist configuration option
  - Use Ruby's built-in Gzip compression
  - 'Add argument validation for the `NewRelic::Agent#record_custom_event` API'
  - Add root sampling configuration options
  - Add Trace ID Ratio Based sampling options
  - Add Entity GUID to Agent Control health check files
bugs:
  - Resolve a `NoMethodError` in GCP utilization detection.
security: []
translationType: machine
---

<Callout variant="important">
  **Mise à jour de version majeure :** Cette version de l’agent Ruby est une mise à jour SemVer MAJOR et contient des modifications importantes. Les versions MAJOR peuvent abandonner la prise en charge des runtimes de langage qui ont atteint la fin de vie selon le mainteneur. De plus, les versions MAJOR peuvent abandonner la prise en charge et supprimer certaines instrumentations. Pour plus de détails sur ces modifications, veuillez consulter le guide de migration [ici](/docs/apm/agents/ruby-agent/getting-started/migration-10x-guide/).
</Callout>

<Callout variant="important">
  Nous vous recommandons de mettre à jour vers la dernière version de l&apos;agent dès qu&apos;elle est disponible. Si vous ne pouvez pas effectuer la mise à niveau vers la dernière version, mettez à jour vos agents vers une version datant de moins de 90 jours. En savoir plus sur [la façon de tenir les agents informés](/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/).

  Consultez la [politique EOL](/docs/apm/agents/ruby-agent/getting-started/ruby-agent-eol-policy/) de l&apos;agent New Relic Ruby pour obtenir des informations sur la sortie de l&apos;agent et les dates de support.
</Callout>

## v10.0.0

* **Changement radical : Suppression de la prise en charge de Ruby 2.4 et 2.5**

  La prise en charge des versions Ruby 2.4 et 2.5 a été supprimée. La nouvelle version minimale requise de Ruby est désormais la 2.6. [PR#3314](https://github.com/newrelic/newrelic-ruby-agent/pull/3314)

* **Changement important : Suppression du Cross Application Tracing (CAT)**

  Auparavant, le suivi inter-applications (CAT) était obsolète au profit du suivi distribué. La fonctionnalité CAT a maintenant été supprimée. L&apos;option de configuration `cross_application_tracer.enabled` a été supprimée. Les méthodes d&apos;API publiques `NewRelic::Agent::External.process_request_metadata`, `NewRelic::Agent::External.get_response_metadata`, `NewRelic::Agent::Transaction::ExternalRequestSegment#process_response_metadata`, `NewRelic::Agent::Transaction::ExternalRequestSegment#get_request_metadata` et `NewRelic::Agent::Transaction::ExternalRequestSegment#read_response_headers` ont également été supprimées. [PR#3333](https://github.com/newrelic/newrelic-ruby-agent/pull/3333)

* **Modification importante : Renommer les métriques et segments ActiveJob**

  Les métriques ActiveJob ont été mises à jour pour inclure le nom de la classe du job pour des rapports plus spécifiques. Il s&apos;agit d&apos;un changement radical qui peut nécessiter la mise à jour des tableaux de bord ou des alertes personnalisés. [PR#3370](https://github.com/newrelic/newrelic-ruby-agent/pull/3370) [PR#3320](https://github.com/newrelic/newrelic-ruby-agent/pull/3320)

  * Ancien format : `Ruby/ActiveJob/<QueueName>/<Method>`
  * Nouveau format : `Ruby/ActiveJob/<QueueName>/<ClassName>/<Method>`

  De plus, les segments créés pour les actions de mise en file d’attente Active Job incluent désormais la classe de travail.

  * Ancien format : `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>`
  * Nouveau format : `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>/<ClassName>`

* **Changement important : renommer la commande `bin/newrelic` en `bin/newrelic_rpm`**

  Le fichier exécutable pour l&apos;interface de ligne de commande (CLI) de l&apos;agent a été renommé de `bin/newrelic` en `bin/newrelic_rpm`. Ce changement résout un conflit de noms avec l&apos;outil CLI New Relic autonome. [PR#3323](https://github.com/newrelic/newrelic-ruby-agent/pull/3323)

* **Changement radical : supprimer la commande CLI `newrelic deployments`**

  La commande CLI `newrelic deployments` obsolète a été supprimée. Pour suivre les changements et les déploiements dans New Relic, veuillez consulter notre guide sur [Suivi des changements](https://docs.newrelic.com/docs/change-tracking/change-tracking-introduction/) pour une liste des options disponibles. [PR#3299](https://github.com/newrelic/newrelic-ruby-agent/pull/3299)

* **Changement radical : Supprimer la méthode NewRelic::Agent::SqlSampler#notice\_sql**

  Les utilisateurs doivent appeler `NewRelic::Agent::Datastores.notice_sql` à la place. [PR#3338](https://github.com/newrelic/newrelic-ruby-agent/pull/3338)

* **Modification importante : Supprimer les arguments inutilisés de diverses API NewRelic::Agent::Datastores**

  Les API suivantes de la classe `NewRelic::Agent::Datastores` ont vu leurs arguments de méthode supprimés :

  * `NewRelic::Agent::Datastores.notice_sql`, avait auparavant trois arguments de position, `query`, `scoped_metric` et `elapsed`. Maintenant, il n&apos;en a que `query`.
  * `NewRelic::Agent::Datastores.notice_statement`, avait auparavant deux arguments positionnels `query` et `elapsed`. Maintenant, il n’a que `query`.
  * `NewRelic::Agent::Datastores.wrap` nécessite une proc. Auparavant, la proc recevait trois arguments : le résultat du yield, le nom de métrique le plus spécifique et le temps écoulé de l&apos;appel. Désormais, elle n&apos;en reçoit qu&apos;un seul : le résultat du yield.

  Les valeurs des arguments supprimés sont dérivées du segment actuel au moment de l&apos;appel. [PR#3347](https://github.com/newrelic/newrelic-ruby-agent/pull/3347)

* **Changement radical : Supprimer la fonctionnalité expérimentale Configurable Security Policies (CSP)**

  La fonctionnalité expérimentale, Configurable Security Policies (CSP), n&apos;est plus prise en charge et a été supprimée. [PR#3292](https://github.com/newrelic/newrelic-ruby-agent/pull/3292)

* **Changement radical : supprimer la prise en charge des versions de Puma &apos;&lt;&apos; 3.9.0**

  La version minimale de Puma désormais prise en charge est 3.9.0 ou supérieure. [PR#3326](https://github.com/newrelic/newrelic-ruby-agent/pull/3326)

* **Changement important : améliorer la validation et la coercition de la configuration**

  Les éléments internes utilisés pour contraindre et valider les valeurs fournies pour la configuration de l’agent sont désormais plus performants et plus précis.

  * Les messages d&apos;avertissement seront désormais enregistrés dans le fichier newrelic\_agent.log lorsque la valeur nil est fournie comme valeur de configuration pour un paramètre qui ne le prend pas en charge.
  * Les valeurs entières sont autorisées pour les types de configuration Float
  * Les valeurs flottantes sont autorisées pour les types de configuration Integer
  * Les interruptions fatales sont évitées lorsqu&apos;une valeur par défaut peut être trouvée pour remplacer une valeur d&apos;entrée non valide [PR#3341](https://github.com/newrelic/newrelic-ruby-agent/pull/3341)

* **Changement important : remplacer l&apos;option &apos;default&apos; par &apos;adaptive&apos; pour les échantillonneurs parents distants de tracing distribué**

  Auparavant, l’option par défaut pour `distributed_tracing.sampler.remote_parent_sampled` et `distributed_tracing.sampler.remote_parent_not_sampled` était `default`, qui utilisait l’échantillonneur adaptatif préexistant. L’option `default` a été renommée `adaptive`. [PR#3363](https://github.com/newrelic/newrelic-ruby-agent/pull/3363)

* **Fonctionnalité : Ajouter `logger` en tant que dépendance**

  La gemme `logger` est désormais répertoriée comme dépendance de l&apos;agent pour assurer la continuité de la fonctionnalité de logging et la prise en charge de Ruby 4.0.0 et des versions plus récentes. [PR#3293](https://github.com/newrelic/newrelic-ruby-agent/pull/3293)

* **Fonctionnalité : Ajouter une option de configuration de liste d&apos;autorisation de notification de support actif**

  Une nouvelle option de configuration, `instrumentation.active_support_notifications.active_support_events`, permet aux utilisateurs de définir une liste d’autorisation des noms d’événements de notifications Active Support auxquels l’agent doit s’abonner. Par défaut, l’agent s’abonne à tous les événements [Active Support : Mise en cache](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-caching) et [Active Support : Messages](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-messages). [PR#3327](https://github.com/newrelic/newrelic-ruby-agent/pull/3327)

* **Fonctionnalité : Utiliser la compression Gzip intégrée de Ruby**

  L’agent utilise désormais la méthode `Zlib.gzip` intégrée de la bibliothèque standard Ruby pour la compression, remplaçant l’implémentation personnalisée précédente. [PR#3332](https://github.com/newrelic/newrelic-ruby-agent/pull/3332)

* **Fonctionnalité : Ajouter la validation des arguments pour l’API `NewRelic::Agent#record_custom_event`**

  L&apos;API `NewRelic::Agent#record_custom_event` déclenche désormais une `ArgumentError` lorsqu&apos;un `event_type` non valide est fourni. Un type d&apos;événement valide doit être composé uniquement de caractères alphanumériques, de traits de soulignement (`_`), de deux-points (`:`) ou d&apos;espaces (` `). [PR#3319](https://github.com/newrelic/newrelic-ruby-agent/pull/3319)

* **Fonctionnalité : ajouter des options de configuration d&apos;échantillonnage racine**

  Vous pouvez désormais configurer le comportement d&apos;échantillonnage des traces provenant du service actuel à l&apos;aide de `distributed_tracing.sampler.root`. [PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330)

  Quatre modes sont disponibles :

  | Mode                   | Description                                                                                                                                                                                               |
  | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | `adaptive`             | Utilise l&apos;algorithme d&apos;échantillonneur adaptatif existant                                                                                                                                       |
  | `always_off`           | Marque 0 % des traces racines comme échantillonnées                                                                                                                                                       |
  | `always_on`            | Marque 100 % des traces racines comme échantillonnées                                                                                                                                                     |
  | `trace_id_ratio_based` | Échantillonne les traces en fonction d&apos;un ratio défini dans `distributed_tracing.sampler.root.trace_id_ratio_based.ratio`. Le ratio doit être un nombre à virgule flottante compris entre 0,0 et 1,0 |

* **Fonctionnalité : ajouter des options d&apos;échantillonnage basées sur le ratio d&apos;ID de trace**

  L&apos;agent peut désormais échantillonner les traces à l&apos;aide de l&apos;algorithme d&apos;échantillonneur basé sur le ratio d&apos;ID de trace OpenTelemetry. [PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330) Cela échantillonne les traces en fonction d&apos;une probabilité comprise entre 0,0 et 1,0 basée sur l&apos;ID de trace.

  Pour utiliser cette option, vous devez d&apos;abord définir votre configuration d&apos;échantillonneur de suivi distribué sur `trace_id_ratio_based`, puis définir l&apos;échantillonneur `distributed_tracing.sampler.*.trace_id_ratio_based.ratio` correspondant sur un nombre à virgule flottante compris entre 0,0 et 1,0.

  Par exemple:

  ```yaml
    distributed_tracing.sampler.remote_parent_sampled: 'trace_id_ratio_based'
    distributed_tracing.sampler.remote_parent_sampled.trace_id_ratio_based.ratio': 0.5
  ```

  Cette configuration échantillonnerait environ 50 % de vos traces pour toutes les traces où le parent distant est échantillonné.

  Cette option est disponible pour :

  * `distributed_tracing.sampler.root`
  * `distributed_tracing.sampler.remote_parent_sampled`
  * `distributed_tracing.sampler.remote_parent_not_sampled`

* **Fonctionnalité : Ajouter l&apos;ID d&apos;entité aux fichiers de contrôle de l&apos;état de l&apos;agent**

  Lorsque l&apos;agent est démarré dans un environnement de [contrôle de l&apos;agent](https://docs-preview.newrelic.com/docs/new-relic-agent-control), un fichier de vérification de l&apos;état est créé à l&apos;emplacement de fichier configuré pour chaque processus d&apos;agent. Ce fichier inclut désormais le guid de l&apos;entité liée à l&apos;agent lorsqu&apos;il est disponible. [PR#3371](https://github.com/newrelic/newrelic-ruby-agent/pull/3371)

* **Correction de bug : Résoudre un `NoMethodError` dans la détection d&apos;utilisation de GCP.**

  La logique de découverte des métadonnées GCP gérera désormais avec élégance `nil` ou des valeurs inattendues, empêchant les plantages d&apos;initialisation du service. [PR#3388](https://github.com/newrelic/newrelic-ruby-agent/pull/#3388)