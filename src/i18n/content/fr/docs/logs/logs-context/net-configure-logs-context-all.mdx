---
title: Logs en contexte de l'agent .NET
tags:
  - Logs
  - Enable log management in New Relic
  - Configure logs in context
metaDescription: 'For apps monitored by .NET, learn how to link log data with related data across the rest of the New Relic platform.'
freshnessValidatedDate: never
translationType: machine
---

Avec notre agent .NET <InlinePopover type="apm" />, vous pouvez obtenir <DNT>**logs in context**</DNT>, qui vous permet de voir le log de votre application dans le contexte de vos autres données New Relic. Pour des informations générales sur cette fonctionnalité, consultez [Logs en contexte APM](/docs/apm/new-relic-apm/getting-started/get-started-logs-context).

<Callout variant="tip">
  Vous avez beaucoup de logs .Net ? Consultez notre [tutoriel pour savoir comment les optimiser et les gérer](/docs/tutorial-large-logs/get-started-managing-large-logs/).
</Callout>

## Options de logs en contexte automatiques [#automatic]

Vous avez trois options pour configurer <InlinePopover type="apm" />logs en contexte pour envoyer automatiquement le log de votre application et les métadonnées de liaison à New Relic. Les frameworks pris en charge pour les logs en contexte automatiques utilisant la redirection d&apos;agent incluent :

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Frameworks
      </th>

      <th>
        Version minimale du framework
      </th>

      <th>
        Version minimale de l&apos;agent
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Log4Net
      </td>

      <td>
        Pour .NET Framework : v1.2.10

        Pour .NET Core : v2.0.10
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        Sérilog
      </td>

      <td>
        Pour .NET Framework : v2.0.0

        Pour .NET Core : v2.5.0
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        NLog
      </td>

      <td>
        Pour .NET Framework : v4.1.0

        Pour .NET Core : v4.5.0
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        Microsoft.Extensions.Logging
      </td>

      <td>
        v3.0.0
      </td>

      <td>
        Pour .NET Framework : Agent v9.7.0

        Pour .NET Core : Agent v10.0.0
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  De nombreuses versions de Sitecore utilisent Sitecore.Logging, qui est basé sur un fork de log4net, mais indépendant. La prise en charge de cette bibliothèque a été ajoutée dans la version 10.14.0 de l&apos;agent .NET.
</Callout>

<CollapserGroup>
  <Collapser id="1-agent" title="Option 1 (la plus simple) : laissez l'agent transmettre les messages de votre log.">
    Il s&apos;agit de l&apos;approche la plus simple et constitue un excellent choix pour les développeurs qui n&apos;ont peut-être pas l&apos;accès ou l&apos;intérêt de configurer un redirecteur de log , ou pour les comptes qui souhaitent voir la puissance des logs et autres liens métadonnées dans le contexte de leurs applications, sans beaucoup de frais généraux.

    En utilisant cette option, votre log inclut `span.id`, `trace.id`, `hostname`, `entity.guid` et `entity.name`. [Renseignez-vous sur les limites du transfert de log .](/docs/logs/logs-context/get-started-logs-context#forwarding-details)

    Il vous suffit d&apos;installer une version d&apos;agent avec des capacités de transfert de log ([agent .NET 9.7.0 ou supérieur](/docs/release-notes/agent-release-notes/net-release-notes)). Si le transfert est désactivé, vous pouvez l&apos;activer en ajoutant les éléments suivants à votre fichier de configuration d&apos;agent :

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000" />
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <Callout variant="important">
      La valeur de la variable d&apos;environnement, si elle est présente, a priorité sur la valeur du fichier de configuration.
    </Callout>

    À partir de la version 9.8.0 de l&apos;agent, cette fonctionnalité est activée par défaut.

    À partir de la version 10.4.0 de l&apos;agent, l&apos;agent prend également en charge la capture et la transmission des données de contexte (attribut personnalisé) à partir de l&apos;événement de log. Cette sous-fonctionnalité est désactivée par défaut. Pour l&apos;activer, utilisez la configuration suivante :

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000">
        <contextData enabled="true" include="" exclude="" />
      </forwarding>
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    New Relic utilise des données contextuelles préfixées par « contexte ». Par exemple, un attribut log personnalisé nommé `myKey` avec la valeur `myValue` pour New Relic est `context.myKey : myValue`.

    La bibliothèque de logging .NET que nous instrumentons stocke généralement les paires de données de contexte valeur clé sur chaque événement de log sous la forme d&apos;un `Dictionary<string,object>`. Pour convertir les valeurs en chaînes avant d&apos;être envoyées à New Relic, nous essayons d&apos;abord d&apos;utiliser `Newtonsoft.Json.JsonConvert.SerializeObject`. Si cela échoue, nous essayons d&apos;appeler `.ToString()` sur l&apos;objet ; en dernier recours, nous enverrons le nom du type.

    Vous pouvez filtrer les données contextuelles à l&apos;aide des options de configuration `include` et `exclude` . Il s&apos;agit de listes de noms d&apos;attributs séparés par des virgules. Les valeurs par défaut pour les deux sont des chaînes vides ; un champ `include` vide signifie « tout inclure ». Ces options d&apos;inclusion/exclusion suivent les mêmes règles que les autres [options configuration d&apos;attributs d&apos;agent](/docs/apm/agents/net-agent/attributes/enable-disable-attributes-net/#attruls).

    Par exemple, pour inclure tous les attributs commençant par « a » sauf « pomme » et exclure tous les attributs commençant par « b » sauf « banane », utilisez la configuration suivante :

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000">
        <contextData enabled="true" include="a*, banana" exclude="b*, apple" />
      </forwarding>
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_INCLUDE="a*, banana"
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_EXCLUDE="b*, apple"
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <DNT>
      **Optional adjustments:**
    </DNT>

    Une fois le transfert de logactivé, vous avez également le contrôle sur le nombre maximum de logs envoyés à New Relic chaque minute. La valeur par défaut est 10 000. Si plus de 10 000 logs sont reçus dans une fenêtre de 60 secondes, votre log commencera à être échantillonné.

    Réglez-le sur un nombre plus élevé pour recevoir plus de logs. Réglez-le sur un nombre inférieur pour recevoir moins de logs. Tout entier est valide.

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000" />
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <Callout variant="important">
      La valeur de la variable d&apos;environnement, si elle est présente, a priorité sur la valeur du fichier de configuration.
    </Callout>

    Si vous disposez déjà d&apos;une solution de transfert de loget que vous mettez à jour votre agent pour utiliser les logs automatiques dans ce contexte, assurez-vous de <DNT>**disable your manual log forwarder**</DNT>. Sinon, votre application enverra des lignes log en double. Selon votre compte, cela peut entraîner une double facturation. Pour plus d&apos;informations, suivez les procédures pour désactiver votre [redirecteur de logspécifique](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
  </Collapser>

  <Collapser id="2-decorate" title="Option 2 : Laissez l'agent décorer votre log.">
    Vous avez déjà un redirecteur de logqui vous plaît ? Nous sommes là pour vous ! Les agents linguistiques peuvent décorer votre log avec les liens métadonnées nécessaires pour fournir l&apos;accès aux logs automatiques en contexte de fonctionnalité.

    Cette option ne doit pas être utilisée avec le transfert interne à l&apos;agent. L&apos;utilisation d&apos;un [redirecteur de logexterne](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding) pour envoyer le log à New Relic alors que le transfert interne à l&apos;agent est activé entraînera l&apos;envoi de votre log deux fois à New Relic. Selon votre compte, cela peut entraîner une double facturation.

    <Callout variant="important">
      La décoration log local pour l&apos;agent .NET ne modifie pas directement le message de log. de votre configuration de framework de logging devra être mise à jour pour écrire le `NR-LINKING` jeton dans les messages. Pour la sortie JSON dans log4net et Serilog, une configuration ou un code supplémentaire sera requis.
    </Callout>

    1. Si vous souhaitez utiliser cette option, assurez-vous que l’option de configuration de transfert dans l’agent est désactivée.

    2. Activez la décoration log dans votre configuration, puis relancez l&apos;agent pour commencer à décorer votre log.

       ```xml
       <applicationLogging enabled="true">
         <forwarding enabled="false" />
         <localDecorating enabled="true" />
       </applicationLogging>
       ```

       Variables d&apos;environnement :

       ```ini
       NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
       NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=false
       NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=true
       ```

       <Callout variant="important">
         La valeur de la variable d&apos;environnement, si elle est présente, a priorité sur la valeur du fichier de configuration.
       </Callout>

       Notre décorateur ajoute cinq attributs à chaque log `message` (texte brut) : `entity.guid`, `entity.name`, `hostname`, `trace.id` et `span.id`. Exemple:

       ```
       This is my log message. NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}
       ```

       <Callout variant="important">
         Pour JSON, les données `NR-LINKING` doivent être dans la propriété `message` .
       </Callout>

       Si le message de log est vide ou vierge, le message de sortie sera également vide. Exemple:

       ```
       NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}|.
       ```

       Le message de sortie du log sera une chaîne vide.

       Certains attributs peuvent être vides si le log s&apos;est produit en dehors d&apos;une transaction ou s&apos;ils ne sont pas applicables au contexte de votre application. Nous recommandons cette option plutôt que le processus manuel consistant à utiliser un formatteur de décoration.

       <Callout variant="important">
         La clé utilisée pour lire le jeton `NR-LINKING` à partir d&apos;un framework de logging est `NR_LINKING` et non `NR-LINKING` afin de prendre en charge les frameworks de logging qui n&apos;autorisent pas les tirets dans les noms de clé.
       </Callout>

       ### Configuration de log4net

       Pour log4net, l&apos;agent .NET stocke le jeton `NR-LINKING` comme une propriété appelée `NR_LINKING` dans l&apos;objet événement de log . Les exemples de disposition courants suivants montrent comment configurer log4net pour écrire le jeton `NR-LINKING` . D&apos;autres dispositions sont prises en charge, mais ne sont pas répertoriées ci-dessous. SimpleLayout n&apos;est pas pris en charge car il ne peut pas être modifié.

       <DNT>**`PatternLayout`/`DynamicPatternLayout`**</DNT>: Mettez à jour le `conversionPattern` pour inclure la propriété `NR_LINKING` à la fin de la ligne.

       ```xml
       <layout type="log4net.Layout.PatternLayout">
         <conversionPattern value="%date %5level %logger.%method [%line] - MESSAGE: %message %property{NR_LINKING}%newline %exception" />
       </layout>
       ```

       <DNT>**`log4net.Ext.Json`**</DNT>: Mettez à jour la mise en page pour inclure un membre appelé `NR_LINKING` dans la propriété JSON du message.

       <DNT>**`log4net.Appender.AdoNetAppender`**</DNT>:Cet appender a une configuration légèrement différente des autres mises en page. Vous devrez mettre à jour le paramètre `message` pour inclure les métadonnées. L&apos;exemple suivant le démontre en utilisant un `PatternLayout`.

       ```xml
       <parameter>
         <parameterName value="@message" />
         <dbType value="String" />
         <size value="4000" />
         <layout type="log4net.Layout.PatternLayout">
           <conversionPattern value="%message %property{NR_LINKING}" />
         </layout>
       </parameter>
       ```

       ### Configuration de Serilog

       Pour Serilog, l&apos;agent .NET stocke le jeton `NR-LINKING` en tant que propriété appelée `NR_LINKING` dans l&apos;objet événement de log . Les exemples de formateur et de récepteur courants suivants montrent comment configurer Serilog pour écrire le jeton `NR-LINKING` . D&apos;autres récepteurs et formateurs sont pris en charge, mais ne sont pas répertoriés ci-dessous.

       <DNT>**Plain text using an `outputTemplate`**</DNT>: Mettez à jour le `outputTemplate` pour inclure la propriété `NR_LINKING` à la fin de la ligne.

       ```csharp
       Log.Logger = new LoggerConfiguration()
           .MinimumLevel.Override("Microsoft", LogEventLevel.Information)
           .Enrich.FromLogContext()
           .WriteTo.File(
               path: @"plaintext_log.txt",
               fileSizeLimitBytes: 1_000_000,
               rollOnFileSizeLimit: true,
               shared: true,
               flushToDiskInterval: TimeSpan.FromSeconds(1),
               outputTemplate: "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] {Message:lj} {NR_LINKING} {NewLine}{Exception}"
           )
           .CreateLogger();
       ```

       <DNT>**JSON Formatter with automatic property output**</DNT>: Le JsonFormatter par défaut n&apos;écrira pas les métadonnées `NR_LINKING` dans la propriété du message ; à la place, il écrit chaque propriété dans son propre objet JSON. Vous devrez créer un formateur JSON personnalisé pour écrire les données `NR_LINKING` à la fin de la propriété `message` avant que les logs en contexte ne fonctionnent.

       ### Configuration de Microsoft.Extensions.Logging

       Pour Microsoft.Extensions.Logging, l’agent .NET stocke le jeton `NR-LINKING` avec le message dans une étendue nouvellement créée. Étant donné que Microsoft.Extensions.Logging s&apos;appuie sur un autre framework pour la sortie, veuillez consulter la configuration log4net ou Serilog ci-dessus pour plus de détails.

       ### Configuration de NLog

       Pour NLog, l&apos;agent .NET est capable d&apos;ajouter automatiquement le jeton `NR-LINKING` directement à la fin du message, aucune configuration supplémentaire n&apos;est donc requise.
  </Collapser>

  <Collapser id="3-old-formatter" title="Option 3 : Utilisez le processus manuel pour transférer et décorer le log.">
    Avant que les agents linguistiques aient la possibilité de transmettre et de décorer les logs, vous pouviez activer les logs en contexte en mettant à jour votre application pour envoyer des liens mémorisables.

    Cette option est toujours prise en charge, mais n&apos;est plus encouragée. Pour obtenir des instructions sur l&apos;utilisation de cette approche, consultez [l&apos;option logs en contexte manuels](#enable-logs-net).

    De plus, cette méthode nécessite que vous installiez un redirecteur de logavant d&apos;activer les logs dans ce contexte. Si vous ne disposez pas d&apos;un redirecteur de log , l&apos;interface utilisateur de New Relic vous prompt d&apos;utiliser notre [agent infrastructure ](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/).

    Si vous décidez d&apos;utiliser votre solution de transfert de log existante et que vous décidez ultérieurement de mettre à jour votre agent pour utiliser les logs en contexte automatiques, assurez-vous de <DNT>**disable your manual log forwarder**</DNT>. Sinon, votre application enverra des lignes log en double. Selon votre compte, cela peut entraîner une double facturation. Pour plus d&apos;informations, suivez les procédures pour désactiver votre [redirecteur de logspécifique](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
  </Collapser>
</CollapserGroup>

<InstallFeedback />

## Sécurisez vos données [#obfuscation]

Votre log peut inclure des informations sensibles protégées par la loi HIPAA ou d’autres protocoles de conformité. Par défaut, nous masquons les modèles de numéros qui semblent correspondre à des éléments tels que des cartes de crédit ou des numéros de sécurité sociale, mais vous devrez peut-être hacher ou masquer des informations supplémentaires.

Pour plus d&apos;informations, voir [expression d&apos;obfuscation et règles](/docs/logs/ui-data/obfuscation-ui/). Vous pouvez hacher ou masquer vos données log en utilisant l&apos;interface utilisateur de New Relic ou en utilisant NerdGraph, notre API GraphQL .

## Explorez vos données [#view-ui]

Pour tirer le meilleur parti de vos données de logging :

* Sur la [page APM <DNT>**Summary**</DNT> ](/docs/apm/apm-ui-pages/monitoring/apm-summary-page-view-transaction-apdex-usage-data), cliquez sur votre graphique <DNT>**Web transaction time**</DNT> pour afficher le log associé à un moment précis.
* Vérifiez [<DNT>**Errors inbox**</DNT>](/docs/errors-inbox/errors-inbox) de votre application pour afficher le log associé à vos erreurs.
* Utilisez [le tracing distribué](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui) pour voir le log associé à une trace individuelle.
* Explorez davantage de données de logging sur votre plateforme avec notre [interface utilisateur de logs](/docs/logs/log-management/ui-data/use-logs-ui/).
* Configurez [des alertes](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/) en fonction de la sortie log et de la gravité.
* [Interrogez vos données](/docs/logs/ui-data/query-syntax-logs/) à l&apos;aide de notre interface utilisateur spécialisée pour les données de log et [créez des dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/) avec les résultats.

## Conseils de dépannage [#troubleshooting]

En règle générale, votre log commencera à apparaître moins d&apos;une minute après avoir activé les logs APM dans le contexte. Vérifiez la section <DNT>**Triage &gt; Logs**</DNT> de votre application. Vous commencerez également à voir [log patterns](/docs/logs/ui-data/find-unusual-logs-log-patterns) liés à l’erreur.

Si vous ne voyez aucun log d&apos;erreurs ou de trace, il se peut qu&apos;il n&apos;y en ait pas pour votre application. Essayez d&apos;actualiser la page de l&apos;interface utilisateur ou de modifier la [période sélectionnée](/docs/new-relic-one/ui-data/basic-ui-features/#data-analysis).

## Désactiver le logging automatique [#disable-automatic]

Les logs APM dans le contexte transmettent automatiquement <InlinePopover type="apm" />, log les données l&apos;agent et sont activés par défaut. Cela peut avoir un impact négatif sur votre sécurité, votre conformité, votre facturation ou les performances de votre système. Pour plus d&apos;informations, ou si vous devez ajuster le paramètre par défaut, suivez les procédures pour [désactiver le logging automatique](/docs/logs/logs-context/disable-automatic-logging).

## Option logs en contexte manuels [#enable-logs-net]

Si vous devez utiliser le processus manuel pour configurer les logs en contexte pour .NET, suivez ces étapes :

1. Assurez-vous d&apos;avoir déjà [configuré le logging dans New Relic](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/). Cela inclut la configuration d&apos;un redirecteur de logpris en charge qui collecte votre log d&apos;application et étend les métadonnées qui sont transmises à New Relic.
2. [Installez](/install/dotnet) ou [mettez à jour](/docs/agents/net-agent/installation/update-net-agent) vers la dernière version de l&apos;agent .NET et [activez le tracing distribué](/docs/distributed-tracing/enable-configure/quick-start/). Utilisez [l&apos;agent .NET version 8.21 ou supérieure](/docs/release-notes/agent-release-notes/net-release-notes/) et l&apos; [API d&apos;agent .NET New Relic version 8.21 ou supérieure](/docs/agents/net-agent/net-agent-api) pour les logs en contexte.
3. Installez ou mettez à jour vers Microsoft [.NET Framework 4.5 ou supérieur](https://dotnet.microsoft.com/download/dotnet-framework) ou [.NET Core 2.0 ou supérieur](https://dotnet.microsoft.com/download/dotnet-core).
4. Installez et configurez l’une des extensions de logging suivantes pour enrichir vos données log , notamment :

* [log4net](#log4net)
* [NLog](#nlog)
* [Sérilog](#serilog)

5. Vérifiez vos données log dans l&apos;interface utilisateur de New Relic.

### Configurer l&apos;extension log4net [#log4net]

Vous pouvez utiliser l&apos;extension [Apache log4net version 2.0.8 ou supérieure](https://logging.apache.org/log4net/) pour lier vos données log aux données associées sur le reste de la plateforme New Relic.

<CollapserGroup>
  <Collapser id="example-log4net" title="Diagramme workflow de log4net">
    Le diagramme suivant illustre le flux de messages de log via Apache log4net, mettant en évidence les composants spécifiques de l&apos;extension New Relic log4net. De nombreux redirecteurs de logsont disponibles. Cet exemple utilise [Fluentd](https://www.fluentd.org/).

    <img title="log4net extension for logs in context with New Relic's .NET agent" alt="Logs In Context - Log4Net" src="/images/logs_diagram_dotnet-logs-in-context.webp" />

    <DNT>**Appender:**</DNT> Le `NewRelicAppender` ajoute des informations contextuelles de l&apos;agent .NET (en utilisant l&apos;API) à l&apos;événement de log généré par l&apos;application. Ces informations contextuelles, appelées métadonnées de liaison, sont utilisées par New Relic pour lier les messages de log aux transactions et aux étendues à partir desquelles ils ont été créés. Cet appender transmettra l&apos;événement de log enrichi aux appenders en aval pour un traitement ultérieur.

    Étant donné que `NewRelicAppender` est de type `ForwardingAppender` , il doit être le premier appender de la chaîne. Il nécessite également un autre appender capable d&apos;écrire sur une destination de sortie réelle en tant qu&apos;enfant pour fonctionner.

    <DNT>**Layout:**</DNT> Le `NewRelicLayout` formate l&apos;événement de log enrichi au format JSON attendu par New Relic. L&apos;appender, auquel cette mise en page est attribuée, demande à log4net de générer le JSON dans un fichier à l&apos;emplacement attendu par le redirecteur de logs.

    <DNT>**Log Forwarder**</DNT>:Le redirecteur de log monitore un dossier de sortie et envoie de manière incrémentielle les informations log correctement formatées et enrichies au point de terminaison de logging New Relic.
  </Collapser>

  <Collapser id="config-log4net" title="Configuration de log4net 2.0.8 ou supérieure">
    Log4net utilise `appender` et `layout` pour stocker et formater les messages de log. [`NewRelicAppender`](https://github.com/newrelic/newrelic-logenricher-dotnet/tree/master/src/Log4Net) enrichit le message de log avec des informations contextuelles de l&apos;agent .NET New Relic s&apos;il est attaché à votre application. L&apos;appender transmet le message de log enrichi aux appenders en aval pour gérer des cas d&apos;utilisation spécifiques pour le message de log.

    Pour plus d&apos;informations sur le logging avec log4net, consultez la documentation [de démarrage](https://logging.apache.org/log4net/) d&apos;Apache log4net.

    Pour configurer les logs en contexte avec l&apos;extension log4net :

    1. À l’aide du [gestionnaire de paquets Visual](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio) Studio NuGet , recherchez et installez le [`NewRelic.LogEnrichers.Log4Net`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Log4Net/) package.

    2. Dans votre fichier de configuration log4net, mettez à jour votre configuration de logging pour utiliser `NewRelicAppender` comme appender de premier niveau et référencez vos appenders existants comme ses enfants. Remplacez également la disposition de l&apos;appender qui écrit le message de log vers une destination de sortie par `NewRelicLayout`.

       L&apos;exemple configuration log4net suivant enrichit l&apos;événement de log avec les métadonnées de liaison New Relic. En plus du fichier de log existant, il génère un nouveau fichier de log dans un format JSON spécifique à `C:\logs\log4netExample.log.json` pour consommation par les redirecteurs de log :

       ```xml
       <log4net>
         <root>
           <level value="ALL" />
           <appender-ref ref="NewRelicAppender" />
         </root>

         <appender name="NewRelicAppender" type="NewRelic.LogEnrichers.Log4Net.NewRelicAppender, NewRelic.LogEnrichers.Log4Net" >
           <threshold value="ALL"/>
           <appender-ref ref="FileAppender" />
         </appender>

         <appender name="FileAppender" type="log4net.Appender.FileAppender">
           <file value="C:\logs\log4netExample.log.json" />
           <param name="AppendToFile" value="true" />
           <layout type="NewRelic.LogEnrichers.Log4Net.NewRelicLayout, NewRelic.LogEnrichers.Log4Net">
           </layout>
         </appender>
       </log4net>
       ```

       Après avoir configuré l&apos;extension log4net et mis à jour votre fichier de logging, vous pouvez configurer votre extension pour envoyer des données à New Relic. Il existe [plusieurs options](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) pour transférer vos logs. Voici un exemple configuration utilisant l&apos;agent infrastructure pour les logs en contexte :

       ```yml
       logs:
         - name: application-log
           file: C:\logs\log4netExample.log.json # Path to a single log file
       ```

       [Documentation pour l&apos;utilisation de l&apos;agent d&apos;infrastructure forwarder](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>
</CollapserGroup>

### Configurer l&apos;extension NLog [#nlog]

Vous pouvez utiliser notre extension [NLog 4.5 ou supérieure](https://nlog-project.org/) pour créer un lien entre vos données log et les données associées sur le reste de la plateforme New Relic.

<CollapserGroup>
  <Collapser id="example-nlog" title="Diagramme workflow NLog">
    L&apos; [extension New Relic NLog](https://github.com/newrelic/newrelic-logenricher-dotnet) fournit un `NewRelicJsonLayout` qui formate un événement de log de la manière requise par le point de terminaison de logging New Relic. Ensuite, il ajoute des informations contextuelles à partir de l’agent .NET lorsqu’il est attaché à votre application. Ensuite, une cible peut être configurée pour écrire les données de logging dans un dossier de sortie. Le redirecteur de log peut monitorer ce dossier et envoyer de manière incrémentielle les informations log à New Relic.

    Le diagramme suivant illustre le flux de messages de log via NLog, mettant en évidence les composants spécifiques de l&apos;extension New Relic NLog.

    <img title="NLog extension for logs in context with New Relic's .NET agent" alt="Logs In Context - NLog" src="/images/logs_diagram_dotnet-logs-in-context.webp" />

    <DNT>**New Relic JSON Layout**</DNT>: Le `NewRelicJsonLayout` ajoute des informations contextuelles de l&apos;agent .NET (à l&apos;aide de l&apos;API) à l&apos;événement de log généré par l&apos;application et génère un message de log au format JSON attendu par New Relic. Ces informations contextuelles, appelées métadonnées de liaison, sont utilisées par New Relic pour lier les messages de log aux transactions et aux étendues où ils ont été créés.

    Étant donné que `NewRelicAppender` est de type `ForwardingAppender` , il doit être le premier appender de la chaîne. Il nécessite également un autre appender capable d&apos;écrire sur une destination de sortie réelle en tant qu&apos;enfant pour fonctionner.

    <DNT>**File Target**</DNT>: Un `FileTarget` définit un fichier sur le disque où les messages de log sont écrits. L&apos;ajout de `NewRelicJsonLayout` à cette cible permet à la sortie d&apos;être formatée correctement pour la transmission à New Relic.

    <DNT>**Log Forwarder**</DNT>: Le redirecteur de logs est configuré pour envoyer les données log correctement formatées et enrichies de la sortie `FileTarget` au point de terminaison de logging New Relic.

    Pour plus d&apos;informations sur le logging avec NLog, consultez la [documentation nlog-project.org](https://nlog-project.org/download/).
  </Collapser>

  <Collapser id="config-nlog" title="Configuration NLog 4.5 ou supérieure">
    Utilisez notre extension [NLog 4.5 ou supérieure](https://nlog-project.org/) pour créer un lien entre vos données log et les données associées sur le reste de la plateforme New Relic.

    1. À l’aide du [gestionnaire de paquets Visual](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio) Studio NuGet , recherchez et installez le [`NewRelic.LogEnrichers.NLog`](https://www.nuget.org/packages/NewRelic.LogEnrichers.NLog/) package.

    2. Dans votre code d&apos;application, mettez à jour votre configuration de logging pour ajouter le `NewRelicJsonLayout` et décidez si vous souhaitez collecter les données MappedDiagnosticsContext (<DNT>**MDC**</DNT>) ou MappedDiagnosticsLogicalContext (<DNT>**MDLC**</DNT>).

       Les exemples de configuration suivants génèrent de nouveaux fichiers JSON qui sont écrits sur le disque. Certaines de ces [options de configuration](https://github.com/nlog/NLog/wiki/File-target) peuvent être utiles pour gérer la quantité d’espace disque utilisé et/ou les performances de la cible.

    * `archiveAboveSize`

    * `maxArchiveFiles`

    * `bufferSize`

    * `enableArchiveFileCompression`

    * `autoFlush`

    * `concurrentWrites`

      Bien que la [cible NLog AsyncWrapper](https://github.com/nlog/NLog/wiki/AsyncWrapper-target) ne soit pas requise, elle peut aider à améliorer les performances en effectuant le formatage et la sortie du fichier log sur un thread différent.

      <DNT>
        **Don&apos;t collect MDC or the MDLC data (default):**
      </DNT>

      L&apos;exemple de code suivant enrichit l&apos;événement de log avec la liaison New Relic des métadonnées, mais pas avec MDC ou les données MDLC. En plus du fichier de log existant, il génère un nouveau fichier de log dans un format JSON spécifique à `C:\logs\NLogExample.log.json` pour consommation par les redirecteurs de log :

      ```cs
      var loggerConfig = new LoggingConfiguration();
      var newRelicFileTarget = new FileTarget("NewRelicFileTarget");
      newRelicFileTarget.Layout = new NewRelicJsonLayout();
      newRelicFileTarget.FileName = "C:\logs\NLogExample.json";
      loggerConfig.AddTarget(newRelicFileTarget);
      loggerConfig.AddRuleForAllLevels("NewRelicFileTarget");
      LogManager.Configuration = loggerConfig;
      var logger = LogManager.GetLogger("Example");
      ```

      <DNT>
        **Collect MDC or the MDLC data:**
      </DNT>

      Si votre application utilise le MDC ou le MDLC, vous pouvez configurer le `NewRelicJsonLayout` pour inclure des éléments dans ces collections. L&apos;exemple de code suivant ajoute la configuration supplémentaire pour permettre la collecte de données MDC et MDLC. Comme dans l&apos;exemple précédent, il génère un nouveau fichier de log dans un format JSON spécifique à `C:\logs\NLogExample.log.json` pour consommation par les redirecteurs de log :

      ```cs
      var loggerConfig = new LoggingConfiguration();
      var newRelicFileTarget = new FileTarget("NewRelicFileTarget");
      var newRelicLayout = new NewRelicJsonLayout
      {
          IncludeScopeProperties = true
      };

      newRelicFileTarget.Layout = newRelicLayout;
      newRelicFileTarget.FileName = @"C:\logs\NLogExample.json";
      loggerConfig.AddTarget(newRelicFileTarget);
      loggerConfig.AddRuleForAllLevels("NewRelicFileTarget");
      LogManager.Configuration = loggerConfig;
      var logger = LogManager.GetLogger("Example");
      ```

      Une fois que vous avez configuré l&apos;extension NLog et mis à jour votre fichier de logging, vous pouvez configurer votre extension pour envoyer des données à New Relic. Il existe [plusieurs options](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) pour transférer vos logs. Voici un exemple configuration utilisant l&apos;agent infrastructure pour les logs en contexte :

      ```yml
      logs:
        - name: application-log
          file: C:\logs\log4netExample.log.json # Path to a single log file
      ```

      [Documentation pour l&apos;utilisation de l&apos;agent d&apos;infrastructure forwarder](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>

  <Collapser id="nlog-file" title="Configuration basée sur le fichier NLog">
    Vous pouvez également configurer l’extension New Relic NLog avec des fournisseurs de configuration basés sur des fichiers. L&apos;exemple de code suivant crée un enregistreur basé sur les paramètres contenus dans un fichier `App.config` .

    <DNT>
      **Instantiating Logger using `.config` file**
    </DNT>

    ```cs
    var logger = LogManager.GetLogger("NewRelicLog");
    logger.Info("Hello, New Relic!");
    ```

    <DNT>
      **Sample `App.config` file**
    </DNT>

    ```xml
    <?xml version="1.0" encoding="utf-8" ?>
    <configuration>
      <configSections>
        <section name="nlog" type="NLog.Config.ConfigSectionHandler, NLog"/>
      </configSections>
      <startup>
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5" />
      </startup>
      <nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <extensions>
          <add assembly="NewRelic.LogEnrichers.NLog" />
        </extensions>
        <targets>
          <target name="NewRelicLogFile" xsi:type="File" fileName="C:/path/to/NewRelicLog.json">
            <layout xsi:type="newrelic-jsonlayout">
            </layout>
          </target>
        </targets>
        <rules>
          <logger name="NewRelicLog" minlevel="Info" writeTo="newRelicLogFile" />
        </rules>
      </nlog>
    </configuration>
    ```
  </Collapser>
</CollapserGroup>

### Configurer l&apos;extension Serilog 2.5 ou supérieure [#serilog]

Vous pouvez utiliser notre extension [Serilog](https://serilog.net/) pour relier vos données log aux données associées sur le reste de la plateforme New Relic. Cela nécessite :

* [Serilog 2.5 ou supérieur](https://serilog.net/)
* [Serilog File Sinks v4.0 ou supérieur](https://www.nuget.org/packages/Serilog.Sinks.File/)

<CollapserGroup>
  <Collapser id="example-serilog" title="Diagramme workflow Serilog">
    Serilog est un framework de logging structuré qui enregistre les messages du log de votre application et crée un `LogEvent` pour stocker les données du message. En utilisant [les Enrichisseurs](https://github.com/serilog/serilog/wiki/Enrichment), vous pouvez ajouter des informations supplémentaires à l&apos;événement de log. [Les récepteurs](https://github.com/serilog/serilog/wiki/Provided-Sinks) et [les formateurs](https://github.com/serilog/serilog/wiki/Formatting-Output) vous permettent de formater et de générer ces événements de log pour une consommation et une visualisation en aval.

    Le diagramme suivant illustre le flux de messages de log via Serilog, mettant en évidence les composants spécifiques de l&apos;extension New Relic Serilog. De nombreux redirecteurs de logsont disponibles. Cet exemple utilise [Fluentd](https://www.fluentd.org/).

    <img title="Serilog extension for logs in context with New Relic's .NET agent" alt="Logs-in-context Serilog" src="/images/logs_diagram_dotnet-logs-in-context-serilog.webp" />

    <DNT>**New Relic Enricher**</DNT>: Le `NewRelicEnricher` ajoute des informations contextuelles de l&apos;agent .NET (à l&apos;aide de l&apos;API) à l&apos;événement de log généré par l&apos;application. Ces informations contextuelles, appelées métadonnées de liaison, sont utilisées par New Relic pour lier les messages de log aux transactions et aux spans où ils ont été créés.

    <DNT>**New Relic Formatter**</DNT>: Le `NewRelicFormatter` traduit l&apos;événement de log enrichi au format JSON attendu par New Relic. Un sink demande à Serilog de générer le JSON dans un fichier à l&apos;emplacement attendu par le redirecteur de logs.

    <DNT>**New Relic Log Forwarder**</DNT>: Le redirecteur de logs est configuré pour envoyer les données log correctement formatées et enrichies de la sortie `FileTarget` au point de terminaison de logging New Relic.

    Pour plus d&apos;informations sur Serilog événement de log, consultez la [documentation Serilog sur GitHub](https://github.com/serilog/serilog/wiki/Getting-Started).
  </Collapser>

  <Collapser id="config-serilog" title="Configuration Serilog 2.5 ou supérieure">
    Pour configurer les logs en contexte avec l&apos;extension Serilog :

    1. Utilisez le [gestionnaire de paquets Visual](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio) Studio NuGet pour localiser et installer le [`NewRelic.LogEnrichers.Serilog`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Serilog) package.

    2. Dans votre code d’application, mettez à jour votre configuration de logging pour ajouter `NewRelicEnricher` et `NewRelicFormatter`.

       L&apos;exemple de code suivant enrichit l&apos;événement de log avec les métadonnées de liaison New Relic. En plus du fichier de log existant, il génère un nouveau fichier de log dans un format JSON spécifique à `C:\logs\SerilogExample.log.json` pour consommation par les redirecteurs de log :

       ```cs
       var loggerConfig = new LoggerConfiguration();

       loggerConfig
           .Enrich.WithThreadName()
           .Enrich.WithThreadId()
           .Enrich.WithNewRelicLogsInContext()
           .WriteTo.File( path: @"C:\logs\ExistingLoggingOutput.txt")
           .WriteTo.File(
               formatter: new NewRelicFormatter(),
               path: @"C:\logs\SerilogExample.log.json");

       var log = loggerConfig.CreateLogger();
       ```

       Cette configuration génère de nouveaux fichiers JSON qui sont écrits sur le disque. Certaines de ces [options de configuration](https://github.com/serilog/serilog-sinks-file) peuvent être utiles pour gérer la quantité d’espace disque utilisé et/ou les performances du récepteur.

    * `restrictedToMinimumLevel`

    * `buffered`

    * `rollingInterval`

    * `rollOnFileSizeLimit`

    * `retainedFileCountLimit`

      Bien que cela ne soit pas obligatoire, l&apos;utilisation du [Serilog asynchrone Sink Wrapper](https://www.nuget.org/packages/Serilog.Sinks.Async) peut aider à améliorer les performances en effectuant le formatage et la sortie du fichier de log sur un thread différent.

    3. Une fois que vous avez configuré l&apos;extension Serilog et mis à jour votre fichier de logging, [plusieurs options](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) s&apos;offrent à vous pour transférer vos logs. Voici un exemple configuration utilisant l&apos;agent infrastructure pour les logs en contexte :

       ```yml
       logs:
         - name: application-log
           file: C:\logs\log4netExample.log.json # Path to a single log file
       ```

       [Documentation pour l&apos;utilisation de l&apos;agent d&apos;infrastructure forwarder](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>

  <Collapser id="serilog-file" title="Configuration basée sur les fichiers Serilog">
    Vous pouvez également configurer l&apos;extension New Relic Serilog avec des fournisseurs configuration basés sur des fichiers. Le package NuGet supplémentaire suivant est requis :

    * [Microsoft.Extensions.Configuration](https://www.nuget.org/packages/Microsoft.Extensions.Configuration/)

    * [Serilog.Settings.Configuration](https://www.nuget.org/packages/Serilog.Settings.Configuration)

      L&apos;exemple de code suivant crée un enregistreur basé sur les paramètres contenus dans un fichier `appSettings.json` .

      <DNT>
        **Instantiating logger using `appsettings.json`**
      </DNT>

      ```cs
      var builder = new ConfigurationBuilder()
          .AddJsonFile("appsettings.json");

      var configuration = builder.Build();

      var logger = new LoggerConfiguration()
          .ReadFrom.Configuration(configuration)
          .CreateLogger();
      ```

      <DNT>
        **Sample `appsettings.json` file**
      </DNT>

      ```json
      {
          "Serilog": {
              "Using": [
                  "Serilog.Sinks.Console",
                  "Serilog.Sinks.File",
                  "NewRelic.LogEnrichers.Serilog"
              ],
              "MinimumLevel": "Debug",
              "Enrich": [
                  "WithNewRelicLogsInContext"
              ],
              "WriteTo": [
                  {
                      "Name": "File",
                      "Args": {
                          "path": "C:\\Logs\\SerilogExample.log.json",
                          "formatter": "NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog"
                      }
                  }
              ],
              "Properties": {
                  "Application": "NewRelic Logging Serilog Example"
              }
          }
      }
      ```

      L&apos;exemple de code suivant crée un enregistreur basé sur les paramètres contenus dans un fichier `web.config` . Le package NuGet [Serilog.Settings.AppSettings](https://www.nuget.org/packages/Serilog.Settings.AppSettings) est requis.

      <DNT>
        **Instantiating logger using `.config` file**
      </DNT>

      ```cs
      var logger = new LoggerConfiguration()
          .ReadFrom.AppSettings()
          .CreateLogger();
      ```

      <DNT>
        **Sample `web.config` file**
      </DNT>

      ```xml
      <?xml version="1.0" encoding="utf-8"?>
      <configuration>
        <appSettings>
          <add key="serilog:using:NewRelic" value="NewRelic.LogEnrichers.Serilog" />
          <add key="serilog:using:File" value="Serilog.Sinks.File" />
          <!--Add other enrichers here-->
          <add key="serilog:enrich:WithNewRelicLogsInContext" />
          <add key="serilog:write-to:File.path" value="C:\logs\SerilogExample.log.json" />
          <add key="serilog:write-to:File.formatter" value="NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog" />
        </appSettings>
      ```
  </Collapser>
</CollapserGroup>