---
title: Logs en contexte de l'agent Java
tags:
  - Logs
  - Enable log management in New Relic
  - Configure logs in context
metaDescription: 'For apps monitored by Java, learn how to link log data with related data across the rest of the New Relic platform.'
freshnessValidatedDate: never
translationType: machine
---

Avec notre agent Java <InlinePopover type="apm" />, vous pouvez obtenir <DNT>**logs in context**</DNT>, qui vous permet de voir le log de votre application dans le contexte de vos autres données New Relic. Pour des informations générales sur cette fonctionnalité, consultez [Logs en contexte APM](/docs/apm/new-relic-apm/getting-started/get-started-logs-context).

<Callout variant="tip">
  Vous avez beaucoup de logs Java ? Consultez notre [tutoriel pour savoir comment les optimiser et les gérer](/docs/tutorial-large-logs/get-started-managing-large-logs/).
</Callout>

## Options de logs en contexte automatiques [#automatic]

Si vous utilisez un framework pris en charge, vous avez deux options pour configurer les logs APM afin d&apos;envoyer automatiquement le log de votre application et les métadonnées de liaison à New Relic. Une option consiste à configurer manuellement une extension log qui décorera vos logs et vous pourrez ensuite les transmettre à vous-même. L’autre option est de laisser l’agent Java gérer automatiquement la décoration et la transmission de vos logs. Les frameworks pris en charge pour les logs automatiques dans le contexte incluent :

* Log4j1 1.2.17 ou supérieur
* Log4j2 2.6 ou supérieur
* Logback 1.1 ou supérieur
* JUL (java.util.logging) JDK 8+
* JBoss Logging 1.3.0.Final vers 2.x
* Logging Dropwizard (capturée via l&apos;instrumentation Logback, voir le problème connu ci-dessous)

<Callout variant="important">
  Logging JBoss

  JBoss Logging délègue la fonctionnalité de décoration locale à l&apos;instrumentation JUL et peut donc être entièrement contrôlé par les deux modules d&apos;instrumentation suivants :

  ```yml
  class_transformer:
    com.newrelic.instrumentation.java.logging-jdk8:
      enabled: true

    com.newrelic.instrumentation.jboss.logging:
      enabled: true
  ```
</Callout>

<Callout variant="important">
  Problème connu avec le logging de Dropwizard

  Par défaut, Dropwizard utilise Logback pour son backend de logging. Il achemine également tous les java.util.logging, Utilisation de Log4j et Apache Commons Logging via Logback. Ce comportement de routage peut conduire à ce que des logs en double soient signalés à New Relic si l&apos;agent Java instrumente l&apos;une de ces autres bibliothèques de logging en plus de l&apos;instrumenté Logback.

  Pour éviter de signaler un log en double lors de l&apos;utilisation du logging Dropwizard, il est recommandé de désactiver toute l&apos;instrumentation de logging de framework, à l&apos;exception de Logback. Vous pouvez le faire dans la section `class_transformer` du fichier de configuration de l&amp;apos;agent :

  ```yml
  class_transformer:
    com.newrelic.instrumentation.logback-classic-1.2:
      enabled: true

    com.newrelic.instrumentation.apache-log4j-1:
      enabled: false

    com.newrelic.instrumentation.apache-log4j-2:
     enabled: false

    com.newrelic.instrumentation.java.logging-jdk8:
     enabled: false

    com.newrelic.instrumentation.jboss.logging:
     enabled: false
  ```
</Callout>

<Callout variant="important">
  l&apos;agent sortie 7.7.0 et les versions supérieures ont cette fonctionnalité activée dans le agent configuration fichier par défaut.

  L&apos;agent de transfert de logentraînera une augmentation de la consommation de données lorsqu&apos;un [framework pris en charge](/docs/logs/logs-context/java-configure-logs-context-all#automatic) est détecté. Le montant dépend de l&amp;apos;application et de la quantité de logs produits. Cette fonctionnalité peut être désactivée. Consultez [Désactiver le logging automatique](/docs/logs/logs-context/disable-automatic-logging/) pour plus d’informations sur vos options.

  Si vous disposez déjà d&apos;une solution de transfert de log , vous devez désactiver cette fonctionnalité.
</Callout>

Si vous préférez utiliser votre propre redirecteur de log , plutôt que de laisser l&apos;agent Java transférer les logs, alors notre solution de [logs en contexte manuels](#enable-logs-java) serait la bonne solution pour décorer votre log avec un contexte de trace cryptée.

<CollapserGroup>
  <Collapser id="1-agent" title="Option 1 (recommandée) : laissez l'agent transmettre votre log.">
    Il s&apos;agit de l&apos;approche la plus simple et constitue un excellent choix pour les développeurs qui n&apos;ont peut-être pas l&apos;accès ou l&apos;intérêt de configurer un redirecteur de log , ou pour les comptes qui souhaitent voir la puissance des logs et autres liens métadonnées dans le contexte de leurs applications, sans beaucoup de frais généraux.

    En utilisant cette option, l&apos;agent ajoute `span.id`, `trace.id`, `hostname`, `entity.guid` et `entity.name`. [Renseignez-vous sur les limites du transfert de log .](/docs/logs/logs-context/get-started-logs-context#forwarding-details)

    Cette fonctionnalité est activée par défaut.

    Il vous suffit d&apos;installer une version d&apos;agent avec des capacités de transfert de log ([agent Java 7.6.0 ou supérieur](/docs/release-notes/agent-release-notes/java-release-notes/)). Si le transfert est désactivé, vous pouvez utiliser cette configuration :

    Fichier de configuration (`newrelic.yml`), en retrait de 2 espaces sous la section commune :

    ```yml
    application_logging:
      enabled: true
      forwarding:
        enabled: true
        max_samples_stored: 10000
      local_decorating:
        enabled: false
    ```

    Variable d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    Propriété du système :

    ```ini
    -Dnewrelic.config.application_logging.enabled=true
    -Dnewrelic.config.application_logging.forwarding.enabled=true
    -Dnewrelic.config.application_logging.forwarding.max_samples_stored=10000
    -Dnewrelic.config.application_logging.local_decorating.enabled=false
    ```

    <DNT>
      **Optional adjustments (`max_samples_stored`):**
    </DNT>

    Une fois cette fonctionnalité activée, vous avez également le contrôle sur le nombre maximal de lignes log envoyées à New Relic chaque minute. La valeur par défaut est 10 000. Si plus de 10 000 lignes log sont vues par l&apos;agent dans une fenêtre de 60 secondes, votre log commencera à être échantillonné.

    Réglez-le sur un nombre plus élevé pour recevoir plus de logs. Réglez-le sur un nombre inférieur pour recevoir moins de logs. Tout entier non négatif est valide.

    <Callout variant="tip">
      Cela fait référence au nombre de logs envoyés *par minute*. La définition `max_samples_stored` sur une valeur inférieure à 12 aura pour effet de ne pas envoyer de log.
    </Callout>

    Fichier de configuration (`newrelic.yml`):

    ```yml
    application_logging:
      enabled: true
      forwarding:
        enabled: true
        max_samples_stored: 10000
      local_decorating:
        enabled: false
    ```

    Variable d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    Propriété du système :

    ```ini
    -Dnewrelic.config.application_logging.enabled=true
    -Dnewrelic.config.application_logging.forwarding.enabled=true
    -Dnewrelic.config.application_logging.forwarding.max_samples_stored=10000
    -Dnewrelic.config.application_logging.local_decorating.enabled=false
    ```

    <Callout variant="important">
      Si vous disposez déjà d&apos;une solution de transfert de loget que vous mettez à jour votre agent pour utiliser les logs automatiques dans ce contexte, assurez-vous de <DNT>**disable your manual log forwarder**</DNT>. Sinon, votre application enverra des lignes log en double. Selon votre compte, cela peut entraîner une double facturation. Pour plus d&amp;apos;informations, suivez les procédures pour désactiver votre [redirecteur de logspécifique](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
    </Callout>
  </Collapser>

  <Collapser id="2-decorate" title="Option 2 : Utilisez votre propre redirecteur de log .">
    Vous avez déjà un redirecteur de logqui vous plaît ? Nous sommes là pour vous ! L&apos;agent Java peut décorer votre log avec les métadonnées de liaison nécessaires pour fournir l&apos;accès aux logs automatiques dans le contexte de la fonctionnalité, et vous pouvez les envoyer à New Relic en utilisant votre redirecteur de logmanuel.

    <Callout variant="tip">
      Cette option remplace notre décorateur [de logs en contexte manuels](#enable-logs-java) .
    </Callout>

    <Callout variant="important">
      Cette option ne doit pas être utilisée avec le transfert interne à l&apos;agent. L&apos;utilisation d&apos;un [redirecteur de logexterne](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding) pour envoyer le log à New Relic alors que le transfert interne à l&amp;apos;agent est activé entraînera l&amp;apos;envoi de votre log deux fois à New Relic. Selon votre compte, cela peut entraîner une double facturation.
    </Callout>

    Mettez à jour configuration de votre agent pour désactiver le transfert de loget activer la décoration locale, puis redémarrez l&apos;agent pour commencer à décorer votre log.

    Fichier de configuration (`newrelic.yml`), en retrait de 2 espaces sous la section commune :

    ```yml
    application_logging:
      enabled: true
      local_decorating:
        enabled: true
      forwarding:
        enabled: false
    ```

    Variable d&apos;environnement :

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=false
    ```

    Propriété du système :

    ```ini
    -Dnewrelic.config.application_logging.enabled=true
    -Dnewrelic.config.application_logging.local_decorating.enabled=true
    -Dnewrelic.config.application_logging.forwarding.enabled=false
    ```

    Notre décorateur ajoute cinq attributs à chaque message de log dans votre fichier log d&apos;application : `entity.guid`, `hostname`, `trace.id`, `span.id` et `entity.name`. Exemple:

    ```
    This is my log message. NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}|
    ```

    Si le message de log est vide ou vierge, le message de sortie sera également vide. Exemple:

    ```
    NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}|.
    ```

    Le message de sortie du log sera une chaîne vide.

    Certains attributs peuvent être vides si le log s&apos;est produit en dehors d&apos;une transaction ou s&apos;ils ne sont pas applicables au contexte de votre application.
  </Collapser>
</CollapserGroup>

<InstallFeedback />

## Sécurisez vos données [#obfuscation]

Votre log peut inclure des informations sensibles protégées par la loi HIPAA ou d’autres protocoles de conformité. Par défaut, nous masquons les modèles de numéros qui semblent correspondre à des éléments tels que des cartes de crédit ou des numéros de sécurité sociale, mais vous devrez peut-être hacher ou masquer des informations supplémentaires.

Pour plus d&apos;informations, consultez notre documentation sur [l&apos;expression d&apos;obfuscation et les règles](/docs/logs/ui-data/obfuscation-ui/). Vous pouvez hacher ou masquer vos données log en utilisant l&amp;apos;interface utilisateur de New Relic ou en utilisant NerdGraph, notre API GraphQL .

## Explorez vos données [#view-ui]

Pour tirer le meilleur parti de vos données de logging :

* Sur la [page APM <DNT>**Summary**</DNT> ](/docs/apm/apm-ui-pages/monitoring/apm-summary-page-view-transaction-apdex-usage-data), cliquez sur votre graphique <DNT>**Web transaction time**</DNT> pour afficher le log associé à un moment précis.
* Vérifiez [<DNT>**Errors inbox**</DNT>](/docs/errors-inbox/errors-inbox) de votre application pour afficher le log associé à vos erreurs.
* Utilisez [le tracing distribué](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui) pour voir le log associé à une trace individuelle.
* Explorez davantage de données de logging sur votre plateforme avec notre [interface utilisateur de logs](/docs/logs/log-management/ui-data/use-logs-ui/).
* Configurez [des alertes](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/) en fonction de la sortie log et de la gravité.
* [Interrogez vos données](/docs/logs/ui-data/query-syntax-logs/) à l&amp;apos;aide de notre interface utilisateur spécialisée pour les données de log et [créez des dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/) avec les résultats.

## Conseils de dépannage [#troubleshooting]

En règle générale, votre log commencera à apparaître moins d&apos;une minute après avoir activé <InlinePopover type="apm" />logs dans ce contexte. Vérifiez la section <DNT>**Triage &gt; Logs**</DNT> de votre application. Vous commencerez également à voir [log patterns](/docs/logs/ui-data/find-unusual-logs-log-patterns) liés à l’erreur.

Si vous ne voyez aucun log d&apos;erreurs ou de trace, il se peut qu&apos;il n&apos;y en ait pas pour votre application. Essayez d&apos;actualiser la page de l&apos;interface utilisateur ou de modifier la [période sélectionnée](/docs/new-relic-one/ui-data/basic-ui-features/#data-analysis).

## Désactiver le logging automatique [#disable-automatic]

Les logs APM dans le contexte transmettent automatiquement <InlinePopover type="apm" />log les données l&amp;apos;agent et sont activés par défaut. Cela peut avoir un impact négatif sur votre sécurité, votre conformité, votre facturation ou les performances de votre système. Pour désactiver les logs automatiques :

1. Dans le [menu utilisateur](/docs/accounts/accounts-billing/general-account-settings/intro-account-settings) de l’interface utilisateur de New Relic, cliquez sur <DNT>**Manage your data &gt; Log settings**</DNT>.
2. Cliquez sur le menu à points de suspension <DNT>**...**</DNT> situé à droite de la ligne du compte.
3. Cliquez sur le bouton de confirmation pour activer ou désactiver et verrouiller ou déverrouiller le logging automatique (comptes parents) ou activer ou désactiver uniquement (comptes enfants).

Pour plus d&apos;informations, ou si vous devez ajuster le paramètre par défaut, suivez les procédures pour [désactiver le logging automatique](/docs/logs/logs-context/disable-automatic-logging).

## Option logs en contexte manuels [#enable-logs-java]

Avant que les agents linguistiques n&apos;aient la possibilité de transmettre et de décorer les logs, vous pouviez utiliser nos solutions manuelles pour envoyer des métadonnées de liaison.

Cette option est toujours prise en charge, mais n&apos;est plus encouragée. De plus, cette méthode nécessite que vous installiez un redirecteur de logavant d&apos;activer les logs dans ce contexte. Si vous ne disposez pas d&apos;un redirecteur de log , l&apos;interface utilisateur de New Relic vous prompt d&apos;utiliser notre [agent infrastructure ](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/).

Si vous décidez d&apos;utiliser votre solution de transfert de log existante et que vous décidez ultérieurement de mettre à jour votre agent pour utiliser les logs en contexte automatiques, assurez-vous de <DNT>**disable your manual log forwarder**</DNT>. Sinon, votre application enverra des lignes log en double. Selon votre compte, cela peut entraîner une double facturation. Pour plus d&amp;apos;informations, suivez les procédures pour désactiver votre [redirecteur de logspécifique](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).

Si vous devez utiliser le processus manuel pour configurer les logs en contexte pour Java, suivez ces étapes :

1. Assurez-vous d&apos;avoir déjà [configuré le logging dans New Relic](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/). Cela inclut la configuration d&amp;apos;un redirecteur de logpris en charge qui collecte votre log d&amp;apos;application et étend les métadonnées qui sont transmises à New Relic.
2. [Installez](/docs/agents/java-agent/installation/install-java-agent/) ou [mettez à jour](/docs/agents/java-agent/installation/update-java-agent/) vers la dernière version de l&amp;apos;agent Java. Utilisez [l&apos;agent Java version 5.6.0 ou supérieure](/docs/release-notes/agent-release-notes/java-release-notes/) pour les logs en contexte.
3. Activez l&apos; [argumentJVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument) et [activez le tracing distribué](/docs/distributed-tracing/enable-configure/quick-start/).
4. Configurez les logs en contexte pour Java pour enrichir vos données log , en utilisant l&apos;une des extensions suivantes selon le cas. Si vous utilisez Spring ou Spring Boot et que vous n&apos;êtes pas sûr de l&apos;extension dont vous avez besoin, consultez notre documentation [Spring](#spring) .

<CollapserGroup>
  <Collapser id="java-dropwizard" title="Dropwizard 1.3 ou supérieur">
    Nous proposons une extension [Dropwizard](https://dropwizard.readthedocs.io/en/release-1.3.x/manual/core.html#logging) pour les logs en contexte avec l&amp;apos;agent Java. Pour commencer, consultez le [code](https://github.com/newrelic/java-log-extensions/tree/main/dropwizard) et un [exemple d’application](https://github.com/newrelic/java-log-extensions/tree/main/examples/dropwizard-app) sur GitHub.

    Pour configurer les logs en contexte pour votre application Java avec l&apos;extension DropWizard :

    1. Assurez-vous que le package [Dropwizard 1.3 ou supérieur](https://dropwizard.readthedocs.io/en/release-1.3.x/manual/core.html#logging) est installé et fonctionne sur votre application. Utilisez les appenders Dropwizard d&amp;apos;origine et l&amp;apos;usine de logging installés et fonctionnant sur l&amp;apos;application.

    2. Assurez-vous que l&apos;agent Java New Relic version 5.6.0 ou supérieure est installé sur votre application et que vous avez activé l&apos; [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument).

    3. Mettez à jour les dépendances de votre projet pour inclure l&apos;extension Dropwizard 1.3, le cas échéant :

       <DNT>**Gradle:**</DNT> Ajoutez ce qui suit à votre fichier `build.gradle` :

       ```groovy
       dependencies {
         implementation("com.newrelic.logging:dropwizard:2.0")
       }
       ```

       <DNT>**Maven:**</DNT> Ajoutez ce qui suit à votre fichier `pom.xml` :

       ```xml
       <dependencies>
         <dependency>
           <groupId>com.newrelic.logging</groupId>
           <artifactId>dropwizard</artifactId>
           <version>2.0</version>
         </dependency>
       </dependencies>
       ```

    4. Mettez à jour votre fichier de configuration Dropwizard `.yaml` avec une disposition `newrelic-json` , en remplaçant le `type: console` ou `type: file` actuellement utilisé par `type: newrelic-console` ou `type: newrelic-file` selon le cas. Par exemple:

       ```yml
       logging:
         appenders:
           - type: newrelic-console
             # Add the two lines below if you don't have a layout specified on the appender.
             # If you have a layout, remove all parameters to the layout and set the type.
             layout:
               type: newrelic-json
       ```

       L&apos;extension New Relic Dropwizard prend également en charge un type de mise en page `log-format` qui utilise le logging Dropwizard standard. À des fins de test, vous pouvez modifier le type de mise en page avec une modification d&amp;apos;une seule ligne :

       ```yml
       logging:
         appenders:
           - type: newrelic-file
             # This format will be ignored by the newrelic-json layout, but used by the log-format layout.
             logFormat: "%date{ISO8601} %c %-5p: %m trace.id=%mdc{trace.id} span.id=%mdc{span.id}%n"
             layout:
               # type: newrelic-json
               type: log-format
       ```
  </Collapser>

  <Collapser id="java-util-logging" title="java.util.logging">
    Nous proposons une extension [java.util.logging](https://docs.oracle.com/javase/7/docs/api/java/util/logging/package-summary.html) pour les logs en contexte avec l&amp;apos;agent Java . Pour commencer, consultez le [code](https://github.com/newrelic/java-log-extensions/tree/main/jul) et un [exemple d’application](https://github.com/newrelic/java-log-extensions/tree/main/examples/jul-app) sur GitHub.

    Pour configurer les logs en contexte pour votre application Java avec l&apos;extension `java.util.logging` :

    1. Assurez-vous que le package [`java.util.logging`](https://docs.oracle.com/javase/7/docs/api/java/util/logging/package-summary.html) est installé et fonctionne sur l&amp;apos;application.

    2. Assurez-vous que l&apos;agent Java New Relic version 5.6.0 ou supérieure est installé sur votre application et que vous avez activé l&apos; [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument).

    3. Mettez à jour la dépendance de votre projet pour inclure l&apos;extension `java.util.logging` le cas échéant. Si vous ne pouvez pas modifier ces fichiers, vous pouvez à la place [ajouter les fichiers jar directement à l&apos;application `classpath`](#java-adding-classpath).

       <DNT>**Gradle:**</DNT> Ajoutez ce qui suit à votre fichier `build.gradle` :

       ```groovy
       dependencies {
         implementation("com.newrelic.logging:jul:2.0")
       }
       ```

       <DNT>**Maven:**</DNT> Ajoutez ce qui suit à votre fichier `pom.xml` :

       ```xml
       <dependencies>
         <dependency>
           <groupId>com.newrelic.logging</groupId>
           <artifactId>jul</artifactId>
           <version>2.0</version>
         </dependency>
       </dependencies>
       ```

    4. Vérifiez si la propriété `handlers` de votre fichier de logging est définie sur autre chose que `NewRelicMemoryHandler`. Recherchez une ligne répertoriant les gestionnaires de l&amp;apos;enregistreur racine, comme ceci :

       ```ini
       handlers = java.util.logging.FileHandler
       ```

    5. Mettez à jour votre fichier de propriétés de logging pour définir le gestionnaire de l&apos;enregistreur racine sur `NewRelicMemoryHandler` afin qu&amp;apos;il intercepte les messages destinés à un autre gestionnaire :

       ```ini
       handlers = com.newrelic.logging.jul.NewRelicMemoryHandler
       ```

    6. Configurez le `NewRelicMemoryHandler` en définissant la cible sur le gestionnaire qui a été précédemment assigné à l&amp;apos;enregistreur racine, afin qu&amp;apos;il capture les données dont New Relic a besoin sur le thread d&amp;apos;où provient le message de log :

       ```ini
       com.newrelic.logging.jul.NewRelicMemoryHandler.target = java.util.logging.FileHandler
       ```

    7. Utilisez un `NewRelicFormatter` pour le gestionnaire final. Mettez à jour votre fichier de propriétés de logging pour définir la propriété `formatter` comme dans l&amp;apos;exemple suivant. Assurez-vous que le gestionnaire dans lequel vous définissez le formateur est le gestionnaire `target` de l’étape précédente (`java.util.logging.FileHandler` dans cet exemple).

       ```ini
       java.util.logging.FileHandler.formatter = com.newrelic.logging.jul. NewRelicFormatter
       ```

       Le format des logs New Relic est JSON avec télémétrie mémorisée que nous utilisons pour corréler les transactions et les connecter ensemble. Actuellement, nous ne prenons en charge aucune personnalisation de ce format.

       Une fois terminé, JSON est un log au lieu d&apos;un texte. Le JSON doit être formaté sous forme d&apos;objets uniques, un par ligne, et doit contenir des champs tels que `log.level` et `thread.name`. Le `trace.id`, qui est requis pour les logs en contexte, ne devrait avoir une valeur que pour les messages de log qui se produisent dans une transaction.
  </Collapser>

  <Collapser id="java-adding-classpath" title="Ajouts au chemin de classe java.util.logging">
    Le moyen le plus direct d&apos;obtenir les extensions de logs en contexte est d&apos;ajouter ces dépendances à `pom.xml` de Maven ou `build.gradle` de Gradle. Cela permet aux outils d&amp;apos;emballage de détecter la dépendance correcte.

    Si vous ne pouvez pas modifier ces fichiers, vous pouvez à la place ajouter les fichiers jar directement à l&apos;application `classpath` pour de votre de framework configuration logging.

    Avant de modifier le classpath :

    1. Activez l’ [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument/) sur l’agent Java de votre application.
    2. Vérifiez quel framework de logging l’application utilise.
    3. Assurez-vous que vous êtes en mesure de modifier de votre framework de configuration logging.
    4. Ajoutez les trois fichiers JAR suivants au classpath s’ils ne sont pas déjà présents. En règle générale, nous recommandons de prendre les dernières versions publiées sur Maven Central.

    * ID de groupe `com.newrelic.logging` et ID d&amp;apos;artefact : sélectionnez l&amp;apos;artefact nommé d&amp;apos;après [le framework de logging de votre application dans Maven](https://search.maven.org/search?q=g:com.newrelic.logging).
    * ID de groupe `com.fasterxml.jackson.core` et ID d&amp;apos;artefact : utilisez [`jackson-core`](https://search.maven.org/search?q=g:com.fasterxml.jackson.core%20a:jackson-core).
    * ID de groupe `com.newrelic.agent.java` et ID d&amp;apos;artefact : utilisez [`newrelic-api`](https://search.maven.org/search?q=g:com.newrelic.agent.java%20a:newrelic-api).
  </Collapser>

  <Collapser id="java-log4j-1x" title="Log4j 1.x">
    <Callout variant="tip">
      Profitez de notre solution de [logs en contexte automatiques](#automatic) pour Java. Pas besoin d’utiliser ce processus manuel !
    </Callout>

    Nous proposons une extension [Log4j 1.x](https://logging.apache.org/log4j/1.2/) pour les logs en contexte manuels avec l&amp;apos;agent Java . Pour commencer, consultez le [code](https://github.com/newrelic/java-log-extensions/tree/main/log4j1) et un [exemple d’application](https://github.com/newrelic/java-log-extensions/tree/main/examples/log4j1-app) sur GitHub.

    Pour configurer les logs manuels en contexte pour votre application Java avec l&apos;extension Log4j 1.x, vous devez configurer l&apos;extension Log4j dans le code ou via XML. Les fichiers de propriétés ne sont pas pris en charge car l&apos;instance `AsyncAppender` ne peut être configurée automatiquement que via XML.

    1. Assurez-vous que le package [Log4j 1.x](https://logging.apache.org/log4j/1.2/) est installé et fonctionne sur l&amp;apos;application.

    2. Assurez-vous que l&apos;agent Java New Relic version 5.6.0 ou supérieure est installé sur votre application et que vous avez activé l&apos; [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument).

    3. Mettez à jour les dépendances de votre projet pour inclure l&apos;extension Log4j 1.x le cas échéant.

       <DNT>**Gradle:**</DNT> Ajoutez ce qui suit à votre fichier `build.gradle` :

       ```groovy
       dependencies {
         implementation("com.newrelic.logging:log4j1:2.0")
       }
       ```

       <DNT>**Maven:**</DNT> Ajoutez ce qui suit à votre fichier `pom.xml` :

       ```xml
       <dependencies>
         <dependency>
           <groupId>com.newrelic.logging</groupId>
           <artifactId>log4j1</artifactId>
           <version>2.0</version>
         </dependency>
       </dependencies>
       ```

    4. Dans votre fichier XML de configuration de logging, mettez à jour votre élément `<appender>` avec un `NewRelicLayout`, en ajoutant `<layout class="com.newrelic.logging.log4j1.NewRelicLayout"/>`:

       ```xml
       <appender name="TypicalFile" class="org.apache.log4j.FileAppender">
         <param name="file" value="logs/log4j1-app.log"/>
         <param name="append" value="false"/>
         <layout class="com.newrelic.logging.log4j1.NewRelicLayout"/> <!-- only this line needs to be added -->
       </appender>
       ```

    5. Utilisez `NewRelicAsyncAppender` pour encapsuler tous les appenders qui cibleront le redirecteur de logde New Relic. Par exemple:

       ```xml
       <appender name="NewRelicFile"
                 class="com.newrelic.logging.log4j1.NewRelicAsyncAppender">
         <appender-ref ref="TypicalFile" />
       </appender>
       ```

    6. Utilisez l&apos;appender asynchrone sur l&apos;enregistreur racine. Par exemple:

       ```xml
       <root>
         <appender-ref ref="NewRelicFile" />
       </root>
       ```

       <DNT>
         **Example configuration file for the Log4j 1.x extension:**
       </DNT>

       ```xml
       <?xml version="1.0" encoding="UTF-8" ?>
       <!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">
       <log4j:configuration debug="false">
         <appender name="TypicalFile" class="org.apache.log4j.FileAppender">
           <param name="file" value="logs/log4j1-app.log"/>
           <param name="append" value="false"/>
           <!-- layout has been replaced -->
           <layout class="com.newrelic.logging.log4j1.NewRelicLayout"/>
         </appender>

           <!-- this appender was added -->
         <appender name="NewRelicFile"
                   class="com.newrelic.logging.log4j1.NewRelicAsyncAppender">
           <appender-ref ref="TypicalFile" />
         </appender>

         <appender name="TypicalConsole" class="org.apache.log4j.ConsoleAppender">
           <layout class="org.apache.log4j.PatternLayout">
             <param name="ConversionPattern" value="%-5p %c{1} - %m%n"/>
           </layout>
         </appender>

         <root>        ​
           <!-- the new appender was used here -->​​
           <appender-ref ref="NewRelicFile" />
           <appender-ref ref="TypicalConsole" />
         </root>

       </log4j:configuration>
       ```
  </Collapser>

  <Collapser id="java-log4j-2x" title="Log4j 2.x">
    <Callout variant="tip">
      Profitez de notre solution de [logs en contexte automatiques](#automatic) pour Java. Pas besoin d’utiliser ce processus manuel !
    </Callout>

    Nous proposons une extension [Log4j 2.x](https://logging.apache.org/log4j/2.x/log4j-slf4j-impl.html) pour les logs en contexte avec l&amp;apos;agent Java. Pour commencer, consultez le [code](https://github.com/newrelic/java-log-extensions/tree/main/log4j2) et un [exemple d’application](https://github.com/newrelic/java-log-extensions/tree/main/examples/log4j2-app) sur GitHub.

    Pour configurer les logs en contexte pour votre application Java avec l&apos;extension Log4j 2.x :

    1. Assurez-vous que le package de liaison [Log4j 2.13.2 ou supérieur](https://logging.apache.org/log4j/2.x/index.html) ou [Logs4j 2](https://logging.apache.org/log4j/2.x/log4j-slf4j-impl/) est installé et fonctionne sur votre application.

    2. Assurez-vous que l&apos;agent Java New Relic version 5.6.0 ou supérieure est installé sur votre application et que vous avez activé l&apos; [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument).

    3. Mettez à jour la dépendance de votre projet pour inclure l&apos;extension Log4j 2.x, le cas échéant :

       <DNT>**Gradle:**</DNT> Ajoutez la section en surbrillance à votre fichier `build.gradle` :

       ```groovy
       dependencies {
         implementation("com.newrelic.logging:log4j2:2.0")
       }
       ```

       <DNT>**Maven:**</DNT> Ajoutez la section en surbrillance à votre fichier `pom.xml` :

       ```xml
       <dependencies>
         <dependency>
           <groupId>com.newrelic.logging</groupId>
           <artifactId>log4j2</artifactId>
           <version>2.0</version>
         </dependency>
       </dependencies>
       ```

    4. Dans votre fichier XML de configuration de logging, mettez à jour votre élément `<configuration>` en ajoutant la section en surbrillance :

       ```xml
       <Configuration xmlns="http://logging.apache.org/log4j/2.0/config"
             packages="com.newrelic.logging.log4j2"
       >
       ```

       Si vous utilisez un fichier de propriétés, ajoutez `packages=com.newrelic.logging.log4j2`.

    5. Ajoutez `<NewRelicLayout/>` pour utiliser un élément `NewRelicLayout` dans l’un des appenders. Par exemple:

       ```xml
       <File name="MyFile" fileName="logs/app-log-file.log">
         <NewRelicLayout/>
       </File>
       ```

       Si vous utilisez un fichier de propriétés, modifiez uniquement le `layout.type`:

       ```ini
       appender.console.type = Console
       appender.console.name = STDOUT
       appender.console.layout.type = NewRelicLayout
       ```

    6. Si vous avez uniquement modifié un appender existant, ignorez cette étape. Si vous avez ajouté un nouvel appender, ajoutez `<AppenderRef/>` dans `<Root>` pour utiliser cet appender. Utilisez l’attribut `ref` pour faire référence à l’appender `name` que vous avez créé à l’étape précédente. Par exemple:

       ```xml
       <Root level="info">
         <AppenderRef ref="MyFile"/>
       </Root>
       ```

       Si vous utilisez un fichier de propriétés et que vous avez ajouté un nouvel appender, ajoutez :

       ```ini
       rootLogger.level = info
       rootLogger.appenderRef.stdout.ref = STDOUT
       ```
  </Collapser>

  <Collapser id="java-logback" title="Version Logback 1.2.0 ou supérieure">
    <Callout variant="tip">
      Profitez de notre solution de [logs en contexte automatiques](#automatic) pour Java. Pas besoin d’utiliser ce processus manuel !
    </Callout>

    Nous proposons une extension [Logback](https://logback.qos.ch/documentation.html) pour les logs en contexte avec l&amp;apos;agent Java. Pour commencer, consultez le [code](https://github.com/newrelic/java-log-extensions/tree/main/logback) et un [exemple d’application](https://github.com/newrelic/java-log-extensions/tree/main/examples/logback-app) sur GitHub.

    Pour configurer les logs en contexte pour votre application Java avec Logback :

    1. Assurez-vous que vous disposez de [la version 1.2.0 ou supérieure de Logback](https://logback.qos.ch/documentation.html) et de la version 5.6.0 ou supérieure de l&amp;apos;agent Java New Relic installée et fonctionnelle sur votre application.

    2. Assurez-vous que l&apos;agent Java New Relic version 5.6.0 ou supérieure est installé sur votre application et que vous avez activé l&apos; [argument JVM `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument).

    3. Mettez à jour les dépendances de votre projet pour inclure l&apos;extension Logback, le cas échéant :

       <DNT>**Gradle:**</DNT> Ajoutez la section en surbrillance à votre fichier `build.gradle` :

       ```groovy
       dependencies {
         implementation("com.newrelic.logging:logback:2.0")
       }
       ```

       <DNT>**Maven:**</DNT> Ajoutez la section en surbrillance à votre fichier `pom.xml` :

       ```xml
       <dependencies>
         <dependency>
           <groupId>com.newrelic.logging</groupId>
           <artifactId>logback</artifactId>
           <version>2.0</version>
         </dependency>
       </dependencies>
       ```

    4. Mettez à jour votre configuration de logging `xml` pour remplacer tout élément `<encoder>` existant.

       Si vous vous connectez à la console (`stdout/stderr`), recherchez `ConsoleAppender` et remplacez :

       ```sml
       <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
         <encoder class="com.newrelic.logging.logback.NewRelicEncoder"/>
       </appender>
       ```

       Si vous vous connectez à un fichier, recherchez `FileAppender` et remplacez `<encoder>`:

       ```xml
       <appender name="LOG_FILE" class="ch.qos.logback.core.FileAppender">
         <file>logs/app-log-file.log</file>
         <encoder class="com.newrelic.logging.logback.NewRelicEncoder"/>
       </appender>
       ```

    5. Mettez à jour votre configuration de logging `xml` avec le `NewRelicAsyncAppender`. Pour garantir que `NewRelicAsyncAppender` encapsule tous les appenders qui cibleront les redirecteurs de logde New Relic, ajoutez la section suivante. Remplacez `"LOG_FILE"` par le nom de l’appender que vous avez mis à jour à l’étape précédente.

       ```xml
       <appender name="ASYNC" class="com.newrelic.logging.logback.NewRelicAsyncAppender">
         <appender-ref ref="LOG_FILE" />
       </appender>
       ```

    6. Assurez-vous que `NewRelicAsyncAppender` est le premier appender utilisé dans votre enregistreur. Remplacez les appenders de votre enregistreur racine par l&amp;apos;appender `ASYNC` créé à l&amp;apos;étape précédente. Ensuite, répertoriez tous les autres appenders après le `NewRelicAsyncAppender` dans la liste `<root>` .

       ```xml
       <root>
         <appender-ref ref="ASYNC" />
       </root>
       ```

       Voici quelques exemples d&apos;un fichier de logging `.xml` mis à jour pour l&amp;apos;extension Logback. Vous pouvez également voir un [exemple fonctionnel sur GitHub](https://github.com/newrelic/java-log-extensions/blob/master/examples/logback-app/src/main/resources/logback.xml).

       <DNT>
         **Single console appender example**
       </DNT>

       Exemple de fichier de configuration après l&apos;ajout des informations d&apos;extension de logging :

       ```xml
       <configuration>
         <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">

           <!-- changed the encoder -->
           <encoder class="com.newrelic.logging.logback.NewRelicEncoder"/>

         </appender>

         <!-- added the ASYNC appender -->
         <appender name="ASYNC" class="com.newrelic.logging.logback.NewRelicAsyncAppender">
           <appender-ref ref="STDOUT" />
         </appender>

         <root level="debug">

           <!-- changed the root logger -->
           <appender-ref ref="ASYNC" />

         </root>
       </configuration>
       ```

       <DNT>
         **Two console appenders example**
       </DNT>

       Cet exemple envoie le logging New Relic vers un fichier, mais envoie toujours le logging standard à la console :

       ```xml
       <configuration>
         <appender name="FILE" class="ch.qos.logback.core.FileAppender">
           <file>myApp.log</file>
           <!-- encoder changed -->
           <encoder class="com.newrelic.logging.logback.NewRelicEncoder"/>
         </appender>

         <!-- this appender does normal console logging -->
         <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
           <encoder>
             <pattern>%msg%n</pattern>
           </encoder>
         </appender>

         <!-- The required New Relic ASYNC appender wraps the FILE appender -->
         <appender name="ASYNC" class="com.newrelic.logging.logback.NewRelicAsyncAppender">
           <appender-ref ref="FILE" />
         </appender>

         <root level="debug">
           <!-- ASYNC is one of the main appenders -->
           <appender-ref ref="ASYNC" />

           <!-- Send every message to normal console logging, as well. -->
           <appender-ref ref="STDOUT" />
         </root>
       </configuration>
       ```
  </Collapser>

  <Collapser id="spring" title="Printemps et Springboot">
    Nous proposons des extensions pour les versions actuelles de [Spring](https://spring.io/) et [Spring Boot](https://spring.io/projects/spring-boot). Si vous connaissez déjà la bibliothèque de logging, vous pouvez passer directement à cette documentation :

    * [java.util.logging](#java-util-logging)

    * [log4j 1](#java-log4j-1x)

    * [log4j 2](#java-log4j-2x)

    * [se connecter](#java-logback)

      Les extensions prennent en charge la configuration par défaut uniquement sur Spring Boot 2.0 et supérieur.

      <DNT>
        **With Spring Boot:**
      </DNT>

      Voici quelques conseils pour déterminer quelle bibliothèque de logging vous possédez :

    * Si vous avez `spring-boot-starter-log4j2` dans votre dépendance, vous utilisez <DNT>**log4j 2.x**</DNT>. Reportez-vous à la [documentation Spring Boot log4j 2.x](https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto-configure-log4j-for-logging) pour la configuration de base et à l&amp;apos; [extension New Relic log4j 2](#java-log4j-2x) pour personnaliser votre configuration.

    * Si vous utilisez Spring Boot mais **pas** `starter-log4j2`, vous utilisez <DNT>**logback**</DNT> par défaut. Reportez-vous à [la documentation de Spring Boot logback](https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto-configure-logback-for-logging) pour la configuration de base et à l&amp;apos; [extension New Relic logback](#logback) pour personnaliser votre configuration.

      <DNT>
        **With Spring (but not Spring Boot):**
      </DNT>

      Printemps 5 ou supérieur :

      Spring implémente un [pont](https://docs.spring.io/spring/docs/current/javadoc-api/org/apache/commons/logging/LogFactory.html) vers d&amp;apos;autres bibliothèques de logging qui les trouveront automatiquement. Cependant, ces bibliothèques individuelles doivent être configurées et explicitement incluses dans les dépendances de votre projet.

      Pour identifier votre dépendance de logging, consultez l&apos;arbre de dépendances de votre [Gradle](https://docs.gradle.org/current/userguide/viewing_debugging_dependencies.html), [Maven](https://maven.apache.org/plugins/maven-dependency-plugin/examples/resolving-conflicts-using-the-dependency-tree.html) ou autre outil de construction. Suivez ensuite les procédures pour configurer les logs en contexte pour votre application Java avec cette extension.

      Ressort 4 ou inférieur :

      La version Spring 4 et inférieure utilise [Apache Commons Logging](https://commons.apache.org/proper/commons-logging/guide.html) pour son pont. Reportez-vous à la [documentation Spring](https://docs.spring.io/spring/docs/4.3.12.RELEASE/spring-framework-reference/html/overview.html#overview-logging) pour plus d&amp;apos;informations sur la configuration de son pont.
  </Collapser>
</CollapserGroup>