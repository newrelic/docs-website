---
title: règles de normalisation métrique
tags:
  - New Relic
  - Use New Relic
  - UI and data
metaDescription: How to create and manage rules in New Relic to deal with noise from high cardinality metrics and prevent metric grouping issues (MGIs).
freshnessValidatedDate: never
translationType: machine
---

Les règles de normalisation des métriques vous aident à gérer les [problèmes de regroupement de métriques](/docs/using-new-relic/cross-product-functions/troubleshooting/metric-grouping-issues) (MGI). Cela permet de garantir que les données de performance des applications restent pertinentes. La normalisation des métriques s&apos;applique uniquement aux [données de métriques timeslice](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data).

Vous pouvez créer et gérer des règles de normalisation des métriques pour :

* Grouper ou filtrer les [données de tranches de temps de métriques](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data)
* Gérez les métriques à haute cardinalité envoyées à New Relic
* Éviter les MGI
* Empêcher la création automatique de règles `DENY_NEW_METRICS`
* Réduire le nombre de noms de métriques uniques envoyés à New Relic

<Callout variant="important">
  Chaque fois que des MGI avec un nombre très élevé de métriques sont détectés, une règle `DENY_NEW_METRICS` est créée automatiquement pour protéger la plateforme contre la dégradation des performances. Cette règle `DENY_NEW_METRICS` n&apos;affecte aucune métrique précédemment rapportée à New Relic.
</Callout>

<Callout variant="tip">
  Vous pouvez également créer une règle de normalisation des métriques à l&apos;aide de [NerdGraph](/docs/apis/nerdgraph/examples/nerdgraph-metric-normalization-rule/).
</Callout>

## Agents transmettant des données à plusieurs applications [#multi-app-agents]

Lorsqu&apos;un agent transmet des données à plusieurs applications, les règles de normalisation de toutes les applications sont appliquées aux données métriques.

Prenons le scénario suivant :

* Un agent fait rapport à `app1` et `app2`
* La règle `r1` est définie pour `app1`
* La règle `r2` est définie pour `app2`

`r1` et `r2` sont tous deux appliqués à toutes les données métriques envoyées par l&apos;agent.

Que se passe-t-il si la configuration de l&apos;agent est modifiée pour envoyer des rapports uniquement à `app2`? Dans ce cas, seule la règle `r2` sera appliquée, car c&apos;est la seule règle définie pour l&apos;application à laquelle l&apos;agent rapporte.

## Gérer la normalisation des métriques [#manage-rules]

Vous pouvez créer et gérer de nouvelles règles de normalisation des métriques pour une entité à l&apos;aide de la page <DNT>**Metric normalization rules**</DNT>.

<CollapserGroup>
  <Collapser id="access-rules" title="Voir les règles de normalisation des métriques">
    Pour afficher la page <DNT>**Metric normalization rules**</DNT>, allez à <DNT>[https://one.newrelic.com](https://one.newrelic.com) &gt; **All Entities**</DNT> &gt; Sélectionnez une entité &gt; <DNT>**Settings** &gt; **Metric normalization** </DNT>.

    <img title="View details" alt="View MGI details" src="/images/Access_metric_rules.webp" />
  </Collapser>

  <Collapser id="create-metric-normalization-rule" title="Créer une règle de normalisation de métrique">
    Pour créer une règle de normalisation de métrique :

    1. Sur la page <DNT>**Metric normalization rules**</DNT>, cliquez sur **+ Create a new rule**.
    2. Fournissez les détails suivants :

    <table>
      <thead>
        <tr>
          <th>
            Champ
          </th>

          <th>
            Description
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            **Plage horaire**
          </td>

          <td>
            Sélectionnez la plage de temps requise dans le menu déroulant pour la règle.
          </td>
        </tr>

        <tr>
          <td>
            **Expression régulière**
          </td>

          <td>
            Saisissez un motif d&apos;

            [expression régulière](https://regexone.com/)

             correspondant aux métriques à normaliser. Ce champ doit commencer par un 

            `^`

             et se terminer par un 

            `$`

            . Il définit un motif pour identifier les métriques qui doivent être affectées par la règle de normalisation. Par exemple : 

            `^WebTransaction/Uri/RESTfulExample/users/username/[a-zA-Z0-9]+$`

             Le motif 

            `^[a-zA-Z0-9]+$`

             correspond à toute chaîne composée de caractères minuscules 

            `(a-z)`

            , de caractères majuscules 

            `(A-Z)`

             et de chiffres 

            `(0-9)`

            .
          </td>
        </tr>

        <tr>
          <td>
            **Correspondances de l&apos;expression régulière**
          </td>

          <td>
            Prévisualisez les métriques correspondant au champ 

            **Regular expression**

            .
          </td>
        </tr>

        <tr>
          <td>
            **Que voulez-vous faire avec les correspondances ?**
          </td>

          <td>
            Sélectionnez l&apos;une des actions suivantes à effectuer sur les métriques correspondant au champ **Regular expression** :

            * **Remplacer**: remplacer les métriques correspondantes par la valeur du champ <DNT>Replacement</DNT>.
            * **Ignorer**: Bloquez l&apos;envoi de toutes les métriques correspondantes vers la plateforme New Relic.
            * **Ignorer les nouvelles métriques**: empêchez la création de nouveaux noms de métriques, tout en permettant aux noms de métriques existants de continuer à être rapportés.
          </td>
        </tr>

        <tr>
          <td>
            **Remplacement**
          </td>

          <td>
            Le champ Remplacement est obligatoire uniquement si vous sélectionnez l&apos;option 

            **Replace**

             dans le champ précédent. Saisissez la métrique de remplacement pour remplacer la métrique correspondante définie dans le champ 

            **Regular expression**

            .
          </td>
        </tr>

        <tr>
          <td>
            **Ordre de la règle dans la séquence**
          </td>

          <td>
            Spécifiez l&apos;ordre dans lequel la règle est appliquée par rapport aux autres règles. Plus le nombre est bas, plus la priorité évaluée est élevée. La valeur recommandée est 

            `2000`
          </td>
        </tr>

        <tr>
          <td>
            **Mettre fin**
          </td>

          <td>
            Si cette option est activée, aucune règle supplémentaire ne sera appliquée aux métriques après que cette règle a correspondu avec succès à une métrique.
          </td>
        </tr>

        <tr>
          <td>
            **Actif**
          </td>

          <td>
            Basculez pour activer ou désactiver la règle.
          </td>
        </tr>

        <tr>
          <td>
            **Remarques**
          </td>

          <td>
            Notes sur la règle pour référence.
          </td>
        </tr>
      </tbody>
    </table>

    3. Cliquez sur **Save**.
  </Collapser>

  <Collapser id="update-metric-normalization-rule" title="Mettre à jour une règle de normalisation de métrique">
    ### Mettre à jour une règle de normalisation de métrique [#update-rule]

    1. Sur la page <DNT>**Metric normalization rules**</DNT>, sélectionnez la règle et cliquez sur l&apos;icône <Icon name="fe-more-horizontal" />, puis sélectionnez **Edit**.
    2. Mettez à jour les détails nécessaires.
    3. Cliquez sur **Save**.
  </Collapser>
</CollapserGroup>

## Désactiver une règle de normalisation de métrique [#disable-rule]

Vous ne pouvez pas supprimer une règle de normalisation de métrique, mais vous pouvez la désactiver. La règle désactivée n&apos;affectera aucune métrique transmise à New Relic. Vous pouvez désactiver une règle `DENY_NEW_METRICS` depuis la page **MGI details**, lorsque le `Denied rate (minute)` est inférieur au `resolution rate (minute)` de 1000.

Pour désactiver une règle :

1. Sur la page <DNT>**Metric normalization rules**</DNT>, sélectionnez la règle requise, cliquez sur l&apos;icône <Icon name="fe-more-horizontal" />, puis cliquez sur **MGI details**.
2. Cliquez sur **Deactivate**.

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

## Page de détails MGI [#mgi-details]

La page **<DNT>MGI details</DNT>** fournit un aperçu complet des règles de normalisation des métriques appliquées à vos métriques. Cela vous permet d&apos;analyser l&apos;impact de ces règles sur vos données de métriques et de prendre des décisions éclairées concernant la gestion des métriques à haute cardinalité.

Sur la page **MGI details**, vous pouvez consulter les informations suivantes :

* **Blocked Metrics Overview**: Affiche le nombre de métriques affectées par la règle `DENY_NEW_METRICS`, y compris le taux de blocage des métriques. Des insights similaires sont disponibles pour les actions `REPLACE` et `IGNORE`.
* **Time Picker Functionality**: permet de visualiser les rapports de métriques avant l&apos;activation de la règle, ventilés par préfixe de métrique. Cette fonctionnalité permet d&apos;identifier la source de la croissance des métriques.
* **NRQL Query Integration**: offre un bouton « view in query builder » pour voir la requête NRQL illustrant l&apos;explosion des métriques juste avant l&apos;application d&apos;une règle. Cela cible les données Metric Timeslice, permettant une analyse rétrospective jusqu&apos;à trois mois.
* **Metric Pattern Identification** : Permet d&apos;identifier les motifs de métriques explosifs et de créer de nouvelles règles regex pour les gérer efficacement.
* **Real-Time Status Indicators**: Inclut des widgets affichant l&apos;état actuel des règles de normalisation, avec des indicateurs passant de « Actif » à « Atténué » à mesure que les règles gèrent la croissance des métriques.
* **Rule Modification Capability**: Permet aux utilisateurs de désactiver leurs propres règles `DENY_NEW_METRICS` directement depuis la page Détails MGI, ainsi que de modifier les règles `REPLACE` et `IGNORE` sans ticket de support. Pour plus d&apos;informations, reportez-vous à [Désactiver une règle](#disable-rule).

### Accéder à la page de détails MGI [#access-mgi]

Sur la page <DNT>**Metric normalization rules**</DNT>, sélectionnez la règle et cliquez sur l&apos;icône <Icon name="fe-more-horizontal" />, puis sélectionnez **MGI details**.

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

### Exemple d&apos;utilisation [#example-use-case]

Dans l&apos;exemple ci-dessus, la page de détails MGI indique que 1,1 million de noms de métriques uniques sont bloqués par la règle `DENY_NEW_METRICS` à un taux de 738 métriques par minute. La majeure partie de cette croissance provient de l&apos;espace de noms `WebTransaction/Uri/RESTfulExample/users/username/`. En consultant la requête NRQL, vous pouvez identifier la source de l&apos;explosion, ce qui vous permet de créer une nouvelle règle pour gérer efficacement les métriques.