---
title: Exécutez l'interface de ligne de commande de diagnostic (nrdiag)
tags:
  - Using New Relic
  - Cross-product functions
  - Diagnostics CLI (nrdiag)
metaDescription: How to run the New Relic Diagnostics CLI (nrdiag) and upload results to a support ticket.
freshnessValidatedDate: never
translationType: machine
---

<ButtonLink role="button" to="https://one.newrelic.com/launcher/diagnostics?pane=eyJuZXJkbGV0SWQiOiJkaWFnbm9zdGljcy5jbGktb3V0cHV0IiwgInNob3dJbnN0YWxsUnVuTW9kYWwiOiB0cnVlfQ==" variant="primary">
  Exécuter la CLI
</ButtonLink>

## Installer et exécuter l&apos;interface de ligne de commande de diagnostic

L&apos;interface de ligne de commande de diagnostic peut être installée et exécutée avec une seule commande sous Linux et Windows. Cette méthode d&apos;installation téléchargera le binaire Diagnostics CLI dans le répertoire de travail actuel. L&apos;interface de ligne de commande de diagnostic recherche automatiquement dans son répertoire racine et ses sous-répertoires les fichiers de configuration de l&apos;agent et d&apos;autres données pertinentes.

<CollapserGroup>
  <Collapser id="linux-install-run" title="Linux">
    1. Changez de répertoire vers le répertoire racine de l&apos;application.
    2. Exécutez les actions suivantes :
       ```shell
       curl -Ls https://download.newrelic.com/nrdiag/scripts/install.sh | bash && sudo ./nrdiag CLI_OPTIONS
       ```
       Recommandation : définissez votre dépannage avec une [suite de tâches](#suites) (`-suites`) et téléchargez les fichiers pertinents sur votre compte New Relic avec l&apos;[indicateur de pièce jointe](#automatic) (`-attach`).
  </Collapser>

  <Collapser id="windows-install-run" title="Windows">
    1. Changez de répertoire vers le répertoire racine de l&apos;application.
    2. Exécutez les actions suivantes :
       ```powershell
       [Net.ServicePointManager]::SecurityProtocol = 'tls12, tls'; (New-Object System.Net.WebClient).DownloadFile("https://download.newrelic.com/nrdiag/scripts/install.ps1", "$env:TEMP\install.ps1"); & PowerShell.exe -ExecutionPolicy Bypass -File $env:TEMP\install.ps1; & '.\nrdiag.exe' CLI_OPTIONS
       ```
       Recommandation : définissez votre dépannage avec une [suite de tâches](#suites) (`-suites`) et téléchargez les fichiers pertinents sur votre compte New Relic avec l&apos;[indicateur de pièce jointe](#automatic) (`-attach`).
  </Collapser>
</CollapserGroup>

## Procédures d&apos;installation manuelle spécifiques à la plateforme [#platform]

Pour installer et exécuter manuellement l&apos;interface de ligne de commande de diagnostic, suivez les procédures correspondant à votre plateforme :

<CollapserGroup>
  <Collapser id="linux-run" title="Linux">
    1. Assurez-vous que vous disposez de l&apos;interface de ligne de commande de diagnostic :

       * À partir de la ligne de commande, changez le répertoire vers le répertoire racine de votre application et assurez-vous que le fichier `nrdiag.zip` est présent.

         OU

       * [Téléchargez manuellement la dernière version](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. Décompressez `nrdiag.zip` si nécessaire.

    3. Depuis le répertoire `nrdiag_1.2.3/linux` , déplacez `nrdiag` dans le répertoire racine de l&apos;application.

    4. Exécutez `nrdiag` (avec toutes [les options CLI)](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)

       ```shell
       ./nrdiag CLI_OPTIONS
       ```

       L&apos;interface de ligne de commande de diagnostic génère tous les problèmes qu&apos;elle détecte et télécharge les fichiers pertinents sur votre compte New Relic si vous incluez l&apos;indicateur `-attach` .
  </Collapser>

  <Collapser id="windows-run" title="Windows">
    1. Assurez-vous que vous disposez de l&apos;interface de ligne de commande de diagnostic :

       * À partir de la ligne de commande, changez de répertoire vers le répertoire racine de l&apos;application et assurez-vous que le fichier `nrdiag.zip` est présent.

         OU

       * [Téléchargez manuellement la dernière version](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. Décompressez `nrdiag.zip` si nécessaire.

    3. Depuis le répertoire `nrdiag_1.2.3/win` , déplacez `nrdiag.exe` ou `nrdiag_x64.exe` dans le répertoire racine de l&apos;application.

    4. Pour les applications Web de dépannage, assurez-vous que vous exécutez l&apos;exécutable à partir du répertoire <DNT>**parent**</DNT> de votre projet ou spécifiez l&apos;emplacement de votre fichier de configuration avec l&apos;option `-c` .

    5. Exécutez l’exécutable (avec toutes [les options CLI](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag) du répertoire dans lequel vous avez placé le binaire). Étant donné que certains contrôles nécessitent des autorisations élevées, pour de meilleurs résultats, exécutez-les à partir d&apos;un shell d&apos;administration.

       Exécutez via PowerShell si vous ajoutez un `CLI_OPTIONS`:

       ```shell
       ./nrdiag.exe CLI_OPTIONS
       ```

       <DNT>**OR**</DNT>, pour les systèmes x64 :

       ```shell
       ./nrdiag_x64.exe CLI_OPTIONS
       ```

       L&apos;interface de ligne de commande de diagnostic génère tous les problèmes qu&apos;elle détecte et télécharge les fichiers pertinents sur le compte New Relic si vous incluez l&apos;indicateur `-attach` .
  </Collapser>

  <Collapser id="macos-run" title="macOS">
    1. Assurez-vous que vous disposez de l&apos;interface de ligne de commande de diagnostic :

       * À partir de la ligne de commande, changez de répertoire vers le répertoire racine de l&apos;application et assurez-vous que le fichier `nrdiag.zip` est présent.

         OU

       * [Téléchargez manuellement la dernière version](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. Décompressez `nrdiag.zip` si nécessaire.

    3. Depuis le répertoire `nrdiag_1.2.3/mac` , déplacez `nrdiag` dans le répertoire racine de l&apos;application.

    4. Exécutez `nrdiag` (avec toutes [les options CLI)](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)

       ```shell
       ./nrdiag CLI_OPTIONS
       ```

       L&apos;interface de ligne de commande de diagnostic génère tous les problèmes qu&apos;elle détecte et télécharge les fichiers pertinents sur votre compte New Relic si vous incluez l&apos;indicateur `-attach` .
  </Collapser>

  <Collapser id="browser-run" title="Monitoring de navigateurs">
    1. Assurez-vous que vous disposez de la dernière version de l&apos;interface de ligne de commande de diagnostic. Si nécessaire, [téléchargez manuellement la dernière version](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. Décompressez `nrdiag.zip` si nécessaire.

    3. Depuis le répertoire du système d&apos;exploitation `nrdiag_1.2.3/` , exécutez `nrdiag` (avec toutes [les options CLI](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag):

       ```shell
       ./nrdiag -browser-url WEBSITE_URL CLI_OPTIONS
       ```

       L&apos;interface de ligne de commande de diagnostic génère tous les problèmes qu&apos;elle détecte et télécharge les fichiers pertinents sur votre compte New Relic si vous incluez l&apos;indicateur `-attach` .
  </Collapser>

  <Collapser id="docker" title="Conteneur Docker">
    Pour dépanner votre application instrumentée New Relic exécutée dans un conteneur Docker , utilisez la commande `docker exec` :

    1. [Téléchargez](https://download.newrelic.com/nrdiag/nrdiag_latest.zip) et décompressez le fichier `nrdiag_latest.zip` .

    2. Copiez le binaire dans le conteneur. Remplacez `IMAGE_NAME` par le nom de votre conteneur Docker :

       ```shell
       docker cp nrdiag/linux/nrdiag IMAGE_NAME:/bin
       ```

    3. Exécutez la commande `nrdiag` dans le conteneur Docker. Remplacez `IMAGE_NAME` comme ci-dessus et remplacez `APPLICATION_ROOT` par le répertoire racine de votre application, où vous avez installé l&apos;agent New Relic :

       ```shell
       docker exec -it -w APPLICATION_ROOT IMAGE_NAME nrdiag
       ```

    4. (Facultatif) Supprimez le binaire `nrdiag` lorsque vous avez terminé :

       ```shell
       docker exec IMAGE_NAME rm /bin/nrdiag
       ```
  </Collapser>
</CollapserGroup>

## Drapeau Suites (option CLI fortement recommandée) [#suites]

Une suite est un ensemble de contrôles de santé ciblant des produits ou des problèmes spécifiques. L’utilisation d’une suite peut aider à réduire la portée du dépannage et à réduire l’occurrence de faux positifs.

Pour consulter la liste des suites disponibles, exécutez l&apos;interface de ligne de commande de diagnostic avec l&apos;option `-help suites` :

```shell
./nrdiag -help suites
```

Pour exécuter des suites avec `nrdiag`, fournissez l&apos;indicateur `-suites` et un ou plusieurs noms de suites (par exemple, `java`) à exécuter comme arguments.

<DNT>
  **Linux and macOS:**
</DNT>

* Pour les systèmes 64 bits :

  ```shell
  ./nrdiag_x64 -suites SUITE NAMES
  ```

* Pour les systèmes ARM64 :

  ```shell
  ./nrdiag_arm64 -suites SUITE NAMES
  ```

<DNT>
  **Windows:**
</DNT>

Pour exécuter à partir de PowerShell, ajoutez `./` au début de `cmd`.

* Pour les systèmes 32 bits :

  ```shell
  nrdiag.exe -suites SUITE NAMES
  ```

* Pour les systèmes 64 bits :

  ```shell
  nrdiag_x64.exe -suites SUITE NAMES
  ```

* Pour les systèmes ARM64 :

  ```shell
  nrdiag_arm64.exe -suites SUITE NAMES
  ```

## scénario [#scripts]

le script fournit une source de données supplémentaire pour les informations qui ne sont pas collectées par une tâche. Le catalogue des scripts disponibles se trouve dans [le référentiel github du Diagnostic CLI](https://github.com/newrelic/newrelic-diagnostics-cli/tree/main/scriptcatalog).

### Sortie du script

la sortie du script est imprimée à l&apos;écran et enregistrée dans un fichier basé sur le nom du script (par exemple, `name-of-script.out`). Ceci est enregistré dans le répertoire spécifié par `-output-path`, par défaut le répertoire actuel.

le script peut également générer des fichiers, soit dans le répertoire de travail actuel, soit dans le répertoire spécifié par `-output-path`. Tous les fichiers de sortie sont inclus dans le zip des résultats dans le répertoire `ScriptOutput/` .

### Résultats du script

Les résultats de l&apos;exécution d&apos;un script peuvent être trouvés dans le fichier `nrdiag-output.json` avec le schéma suivant :

```json
"Script": {
  "Name": "example",
  "Description": "Example Description",
  "Output": "example output",
  "OutputFiles": [
    "/path/to/example.out",
    "/path/to/another-file.out"
  ],
  "OutputTruncated": false
}
```

Le champ `Output` contient la sortie stdout. S&apos;il comporte plus de 20 000 caractères, il est tronqué et le champ `OutputTruncated` est défini sur `true`. Même si elle est tronquée, la sortie complète est toujours disponible dans le répertoire `ScriptOutput/` du fichier zip.

Une liste des fichiers créés par le script peut être trouvée dans le champ `Outputfiles` .

### Lister, afficher et exécuter un script [#list-view-run-script]

<CollapserGroup>
  <Collapser id="list-available-scripts" title="Liste des scripts disponibles">
    Pour afficher la liste des scripts disponibles pour exécution, utilisez `-list-scripts`:

    ```shell
    ./nrdiag -list-scripts
    ```
  </Collapser>

  <Collapser id="view-script" title="Voir un script">
    Pour afficher un script sans l’exécuter :

    ```shell
    ./nrdiag -script SCRIPT_NAME
    ```
  </Collapser>

  <Collapser id="run-script" title="Exécuter un script">
    Pour exécuter un script :

    ```shell
    ./nrdiag -script SCRIPT_NAME -run
    ```
  </Collapser>

  <Collapser id="run-script-with-args" title="Exécuter un script avec des arguments">
    Pour exécuter un script avec des arguments :

    ```shell
    ./nrdiag -script SCRIPT_NAME -run -script-flags "-foo bar"
    ```
  </Collapser>

  <Collapser id="run-script-and-suites" title="Exécuter un script avec des suites">
    Pour exécuter un script et des suites en même temps :

    ```shell
    ./nrdiag -script SCRIPT_NAME -run -s SUITE NAMES"
    ```
  </Collapser>
</CollapserGroup>

## Inclure des fichiers supplémentaires dans le zip [#include-additional-files]

Si vous avez des fichiers supplémentaires que vous souhaitez partager avec le support, vous pouvez les inclure dans le fichier `nrdiag-output.zip` à l&apos;aide de l&apos;indicateur de ligne de commande `-include` . Cela peut être utilisé avec un seul fichier ou un répertoire. Si un répertoire est fourni, tous ses sous-répertoires sont inclus. La limite de taille totale des fichiers inclus est de 4 Go.

Utilisez ceci en combinaison avec `-attach` pour [télécharger les fichiers](#attach-account-results) sur votre compte New Relic.

<DNT>
  **Linux and macOS:**
</DNT>

* Pour les systèmes 64 bits :

  ```shell
  ./nrdiag_x64 -include /entire/directory/ -attach
  ```

* Pour les systèmes ARM64 :

  ```shell
  ./nrdiag_arm64 -include /entire/directory/ -attach
  ```

<DNT>
  **Windows:**
</DNT>

Pour exécuter à partir de PowerShell, ajoutez `./` au début de `cmd`.

* Pour les systèmes 32 bits :

  ```shell
  nrdiag.exe -include Path\To\File -attach
  ```

* Pour les systèmes 64 bits :

  ```shell
  nrdiag_x64.exe -include \Entire\Directory\ -attach
  ```

* Pour les systèmes ARM64 :

  ```shell
  nrdiag_arm64.exe -include \Entire\Directory\ -attach
  ```

## Télécharger les résultats sur un compte New Relic [#attach-account-results]

<Callout variant="important">
  Si votre système **n&apos;est pas** configuré pour se connecter à des adresses IP externes, cette méthode ne fonctionnera pas. Au lieu de cela, joignez les [fichiers de sortie](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/interpret-nrdiag-output) dans un e-mail au support New Relic.
</Callout>

### Téléchargement automatique du compte [#automatic]

Pour télécharger automatiquement vos résultats sur un compte New Relic lorsque l&apos;interface de ligne de commande de diagnostic est exécutée, utilisez les indicateurs de ligne de commande `-attach` ou `-api-key` . L&apos;indicateur `-attach` validera toute clé de licence New Relic trouvée dans votre environnement et téléchargera l&apos;exécution sur le compte associé à la clé de licence. Alternativement, l&apos;indicateur `-api-key` utilisera le <InlinePopover type="userKey" />fourni pour télécharger l&apos;exécution, quelle que soit la présence d&apos;une clé de licence valide.

Le téléchargement de vos résultats sur un compte téléchargera automatiquement le contenu des `nrdiag-output.json` et `nrdiag-output.zip`.

<CollapserGroup>
  <Collapser id="linux-attach-examples" title="Linux et macOS">
    * Pour les systèmes 64 bits :

      ```shell
      ./nrdiag_x64 -attach
      ```

      OU

      ```shell
      ./nrdiag_x64 -api-key ${API_KEY}
      ```

    * Pour les systèmes ARM64 :

      ```shell
      ./nrdiag_arm64 -attach
      ```

      OU

      ```shell
      ./nrdiag_arm64 -api-key ${API_KEY}
      ```
  </Collapser>

  <Collapser id="windows-attach-examples" title="Windows">
    Pour exécuter à partir de PowerShell, ajoutez `./` au début de `cmd`.

    * Pour les systèmes 32 bits :

      ```shell
      nrdiag.exe -attach
      ```

      OU

      ```shell
      nrdiag.exe -api-key ${API_KEY}
      ```

    * Pour les systèmes 64 bits :

      ```shell
      nrdiag_x64.exe -attach
      ```

      OU

      ```shell
      nrdiag_x64.exe -api-key ${API_KEY}
      ```

    * Pour les systèmes ARM64 :

      ```shell
      nrdiag_arm64.exe -attach
      ```

      OU

      ```shell
      nrdiag_arm64.exe -api-key ${API_KEY}
      ```
  </Collapser>
</CollapserGroup>

### Sélection de la région [#region]

Par défaut, l&apos;interface de ligne de commande de diagnostic télécharge les résultats vers les comptes New Relic hébergés dans le data center américain. Si votre compte est hébergé dans le data center de l&apos;UE, assurez-vous d&apos;ajouter `-region eu` à la commande.

```shell
./nrdiag -region eu ...
```