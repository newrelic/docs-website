---
title: Mettre à niveau vers l'expérience APM
metaDescription: Learn how to upgrade your Lambda monitoring to the New Relic APM experience.
freshnessValidatedDate: never
translationType: machine
---

Vous pouvez mettre à niveau vos fonctions Lambda existantes vers la nouvelle expérience de monitoring unifiée avec un minimum d&apos;effort. Cette transition vous permet de monitorer vos fonctions Lambda avec les capacités d&apos;observabilité améliorées de New Relic. Vous pouvez instrumenter toutes vos fonctions Lambda existantes en masse, ou vous pouvez choisir de les mettre à niveau une par une. Le processus de mise à niveau est non intrusif et ne nécessite aucune modification de code de vos fonctions existantes.

**Prérequis**

* Vos fonctions Lambda sont déjà instrumentées dans New Relic.
* Vos fonctions Lambda s&apos;exécutent sur l&apos;un des runtimes `python`, `nodejs`, `ruby`, `go` ou `.NET`. Pour afficher la liste des versions prises en charge de ces runtimes, reportez-vous à la [documentation sur la compatibilité et les exigences](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring/).

## Méthodes d&apos;instrumentation

Vous pouvez mettre à niveau vos fonctions Lambda existantes en utilisant l&apos;une des méthodes suivantes :

* [UI de New Relic](#ui)
* [Mettre à jour à l&apos;aide des CLI](#cli)

<Callout variant="tip">
  New Relic recommande d&apos;intégrer votre compte AWS à New Relic en utilisant l&apos; [intégration AWS](/docs/infrastructure/amazon-integrations/get-started/introduction-aws-integrations/) pour découvrir et monitorer automatiquement votre fonction Lambda. Cela vous permet d&apos;exploiter pleinement la puissance de New Relic APM pour votre serveur de fonctions.
</Callout>

#### UI de New Relic [#ui]

Vous pouvez mettre à niveau vos fonctions Lambda existantes à l&apos;aide de l&apos;interface utilisateur de New Relic.

**Pour mettre à niveau vos fonctions Lambda existantes à partir de la plateforme New Relic, procédez comme suit :**

1. Accédez à [one.newrelic.com &gt; All capabilities &gt; Serverless Functions](https://one.newrelic.com/nr1-core?state=23b04845-da13-2b11-5826-9c20326276d9) &gt; sélectionnez votre entité de fonction Lambda.
2. Sur la page Summary, cliquez sur **Instrument for APM**.
3. Sur la page Fonction Lambda pour APM, fournissez la clé API, puis cliquez sur **Continue**.
4. Par défaut, l&apos;entité Lambda actuelle est sélectionnée pour la mise à niveau. Vous pouvez également sélectionner d&apos;autres fonctions Lambda à mettre à niveau. Cliquez sur **Generate New Relic CLI command**.
5. Copiez la commande et exécutez-la dans votre terminal ou dans votre terminal AWS. La commande installera la couche Lambda New Relic sur les fonctions sélectionnées.
6. Cliquez sur **Continue** pour tester l&apos;installation. Le test vérifiera si la couche Lambda New Relic est correctement installée et si la fonction envoie des données à New Relic.
7. Si le test réussit, vous verrez un message de réussite. Pour afficher votre fonction Lambda dans l&apos;interface APM de New Relic, cliquez sur **See your data in APM**.

#### Mettre à jour à l&apos;aide des CLI [#cli]

<CollapserGroup>
  <Collapser id="nr-cli" title="Interface de ligne de commande New Relic">
    <Callout variant="important">
      Assurez-vous que votre version de l&apos;interface de ligne de commande (CLI) New Relic est `0.9.8` ou ultérieure. Vous pouvez vérifier votre version de l&apos;interface de ligne de commande (CLI) en exécutant `newrelic-lambda --version`. Si vous devez mettre à jour votre interface de ligne de commande (CLI), mettez à jour l&apos;interface de ligne de commande (CLI). Par exemple, si vous avez installé l&apos;interface de ligne de commande (CLI) à l&apos;aide de `pip3`, vous pouvez la mettre à jour avec la commande suivante :

      ```bash
          pip3 install --upgrade newrelic-lambda
      ```
    </Callout>

    1. Pour mettre à niveau votre fonction Lambda, utilisez le démarrage rapide de l&apos;interface de ligne de commande (CLI) `newrelic-lambda`, comme indiqué ici.

       ```bash
       newrelic-lambda layers install --nr-account-id YOUR_NEW_RELIC_ACCOUNT_ID --function my-function --upgrade --apm
       ```

       <Callout variant="tip">
         Cette commande recherche automatiquement la couche la plus récente disponible pour la région et l&apos;environnement d&apos;exécution de votre Lambda.
       </Callout>

    2. Pour migrer les alertes de vos fonctions Lambda existantes vers APM, exécutez la commande suivante :

       ```bash
       newrelic-lambda apm alerts-migrate \
           --nr-account-id <YOUR_NEW_RELIC_ACCOUNT_ID> \
           --nr-api-key <YOUR_NEW_RELIC_API_KEY>
           --function <YOUR_LAMBDA_FUNCTION_NAME>
       ```
  </Collapser>

  <Collapser id="cdk" title="Pour AWS CDK, AWS SAM ou Terraform">
    1. Mettez à jour vers la [dernière couche Lambda New Relic](https://layers.newrelic-external.com/) pour votre projet à l&apos;aide de [AWS CDK](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#cdk), [AWS SAM](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#cloudformation) ou [Terraform](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#terraform).
    2. Définissez la [variable d&apos;environnement](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/env-variables-lambda/) `NEW_RELIC_APM_LAMBDA_MODE` sur `true` dans la configuration de votre fonction Lambda. Cela active le mode APM pour la couche Lambda New Relic.
    3. Déployez votre fonction Lambda avec la configuration mise à jour.
    4. Dans l&apos;onglet <DNT>Configuration</DNT> de votre <DNT>AWS Management Console</DNT>, ajoutez la balise `NR.Apm.Lambda.Mode: true` à votre fonction Lambda.
    5. Si vous n&apos;utilisez pas d&apos;[intégration cloud AWS](/docs/infrastructure/amazon-integrations/get-started/introduction-aws-integrations/) (Metric Stream ou API Polling) pour synchroniser les tags CloudWatch, définissez la variable d&apos;environnement `NR_TAGS` sur `NR.Apm.Lambda.Mode:true`. Cela permet à l&apos;extension New Relic Lambda d&apos;envoyer les métadonnées requises directement à New Relic.
  </Collapser>
</CollapserGroup>

## Mettre à jour les alertes et les dashboards Lambda existants [#alerts-dashboards]

Après avoir mis à niveau vos fonctions Lambda existantes vers `APM + Serverless Convergence`, il est essentiel de mettre à jour les requêtes NRQL dans vos conditions d&apos;alerte et vos widgets de dashboard. Cette nouvelle mise à niveau modifie les chemins de métriques pour vos données Lambda. La modification de vos requêtes est nécessaire pour garantir que vos alertes et vos dashboards utilisent ces nouveaux chemins et continuent de fournir un monitoring et des notifications précises. Ceci est requis pour toutes les fonctions Lambda existantes que vous avez migrées vers `APM + Serverless Convergence`.

* Pour les alertes, examinez vos conditions d&apos;alerte Lambda existantes. Mettez à jour toutes les requêtes NRQL qui utilisent des métriques provenant de couches avec les nouvelles métriques. Pour plus d&apos;informations sur la mise à jour de vos conditions d&apos;alerte, reportez-vous à la section [Mettre à jour une alerte](https://docs.newrelic.com/docs/alerts/create-alert/create-alert-condition/alert-conditions/#edit-existing-alert-condition).

* Pour les dashboards, examinez vos widgets de dashboard Lambda existants. Mettez à jour toutes les requêtes NRQL qui utilisent des métriques provenant de couches avec les nouvelles métriques. Pour plus d&apos;informations sur la mise à jour de vos widgets de dashboard, reportez-vous à la section [gérer le dashboard](https://docs.newrelic.com/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard/).

## Rechercher et utiliser des données [#find-data]

Une fois votre fonction AWS Lambda instrumentée, vous pouvez trouver et utiliser les données dans l&apos;interface New Relic APM. Les données sont organisées en plusieurs domaines clés, chacun fournissant des informations différentes détaillées sur les performances et l&apos;état de votre fonction Lambda.

Dans l&apos;interface APM, vous pouvez explorer différents aspects de votre fonction Lambda, notamment [le tracing distribué](/docs/distributed-tracing/concepts/introduction-distributed-tracing/), [les cartes de services](/docs/new-relic-solutions/new-relic-one/ui-data/service-maps/service-maps/), [les transactions](/docs/apm/transactions/intro-transactions/transactions-new-relic-apm/), [l&apos;analyse des erreurs](/docs/errors-inbox/getting-started/) et bien plus encore. Chacune de ces zones fournit des informations détaillées sur les performances, la latence et le taux d&apos;erreur de votre fonction Lambda, vous permettant d&apos;identifier et de résoudre rapidement les problèmes.

<Callout variant="tip">
  L&apos;expérience d&apos;invocation est désormais intégrée à la trace de transaction APM. Cela vous permet d&apos;utiliser un `AWS RequestId` spécifique pour explorer en détail une trace de transaction APM afin d&apos;obtenir des informations détaillées sur cette exécution Lambda particulière.
</Callout>

Pour afficher votre fonction Lambda dans l&apos;interface New Relic APM :

1. Allez à <DNT>[https://one.newrelic.com](https://one.newrelic.com) &gt; APM &amp; Services</DNT>.
2. Définissez les critères de recherche comme `isLambdaFunction = true`.
3. Dans la liste affichée, sélectionnez votre fonction Lambda pour visualiser les données.

<Callout variant="tip">
  L&apos;interface utilisateur APM de New Relic n&apos;affiche pas les données historiques des fonctions Lambda qui ont été instrumentées avant la mise à niveau `APM + Serverless Convergence`. Pour afficher les données historiques, cliquez sur l&apos;option **see serverless functions** dans la page <DNT>APM Summary</DNT>.
</Callout>

### Retour en arrière [#rollback]

Si vous devez ramener vos fonctions Lambda à l&apos;expérience de monitoring serverless précédente, vous pouvez le faire en définissant la variable d&apos;environnement `NEW_RELIC_APM_LAMBDA_MODE` sur `false`.

## Articles connexes [#related-docs]

<DocTiles>
  <DocTile title="Compatibilité et exigence" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring">
    En savoir plus sur les environnements d&apos;exécution pris en charge et les prérequis
  </DocTile>

  <DocTile title="Dépannage" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/troubleshooting/troubleshoot-enabling-serverless-monitoring-aws-lambda">
    Apprenez à résoudre les problèmes liés à l&apos;installation
  </DocTile>
</DocTiles>