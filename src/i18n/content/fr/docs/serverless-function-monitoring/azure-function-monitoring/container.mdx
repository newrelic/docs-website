---
title: Instrumentation conteneurisée
metaDescription: Configure your Azure Functions with New Relic for Linux
tags:
  - Azure Functions
  - Linux
  - Instrumentation
  - Configuration
  - New Relic .NET Agent
  - New Relic Python Agent
  - New Relic Node.js Agent
  - New Relic Azure Websites Extension
  - Environment Variables
  - Dockerfile
  - Containerized Functions
freshnessValidatedDate: never
translationType: machine
---

Si vous utilisez une fonction Azure conteneurisée, vous pouvez monitorer vos fonctions Azure avec l&apos;agent .NET New Relic, l&apos;agent Python ou l&apos;agent Node.js. Cela vous permet de monitorer les performances et l&apos;état de vos fonctions Azure en temps réel.

<Steps>
  <Step>
    ## Prérequis [#begin]

    * Assurez-vous que votre Azure Function répond à nos [exigences de compatibilité](/docs/serverless-function-monitoring/azure-function-monitoring/compatibility-requirement-azure-monitoring).
    * Liez votre compte Azure à New Relic. Pour plus d’informations, consultez [l’intégration Azure](/docs/infrastructure/microsoft-azure-integrations/azure-integrations-list/azure-functions-monitoring-integration/#polling).
  </Step>

  <Step>
    ## Configurer Azure Functions monitoring

    Vous pouvez configurer le monitoring des fonctions Azure pour différents environnements et diverses combinaisons de runtimes et de méthodes de déploiement. Les instructions suivantes expliquent comment configurer New Relic pour les applications de fonction Azure conteneurisées.

    <Tabs>
      <TabsBar>
        <TabsBarItem id="node">Node.js</TabsBarItem> <TabsBarItem id="python">Python</TabsBarItem> <TabsBarItem id="net">.NET</TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="node">
          1. Modifiez votre fichier de fonction pour ajouter le code suivant en haut de votre fichier d&apos;application :

          ```dockerfile
          ENV NEW_RELIC_LICENSE_KEY="YOUR_NEW_RELIC_LICENSE_KEY"
          ENV NEW_RELIC_APP_NAME="YOUR_APPLICATION_NAME"
          # ENV NEW_RELIC_HOST='staging-collector.newrelic.com'
          # Uncomment the previous line if using staging
          # Inject the agent in NODE_OPTIONS

          ENV NODE_OPTIONS="-r newrelic"
          # Install New Relic without bin links

          ARG AGENT_VERSION=latest
          RUN npm install newrelic@$AGENT_VERSION --no-bin-links
          ```

          2. Générez votre image Docket selon les exigences de votre plateforme en exécutant :

          ```bash
          docker buildx build --platform=YOUR_PLATFORM_ARCHITECTURE --tag YOUR_DOCKER_ID/azurefunctionsimage:v1.0.0 --push
          ```

          <Callout variant="important">
            Assurez-vous de remplacer `YOUR_PLATFORM_ARCHITECTURE` par l&apos;architecture appropriée pour votre fonction Azure. Par exemple, utilisez `linux/amd64` pour Linux 64 bits ou `linux/arm64` pour l&apos;architecture ARM.
          </Callout>

          3. Publiez votre image dans Azure Container Registry (ACR) en exécutant :

             1. Authentifiez votre Azure Container Registry :

             ```bash
             az acr login --name YOUR_CONTAINER_REGISTRY_NAME
             ```

             2. Taguez votre image créée localement avec le serveur de connexion ACR en exécutant :

             ```bash
             docker tag YOUR_DOCKER_ID/azurefunctionsimage:v1.0.0 YOUR_LOGIN_SERVER/azurefunctionsimage:v1.0.0
             ```

             3. Envoyez l&apos;image taguée vers votre ACR en exécutant :

             ```bash
             docker push YOUR_LOGIN_SERVER/azurefunctionsimage:v1.0.0
             ```

             4. Créez les ressources Azure requises pour votre application de fonction Azure à l&apos;aide de la [documentation Azure.](https://learn.microsoft.com/en-us/azure/azure-functions/functions-deploy-container-apps?tabs=acr%2Cbash&pivots=programming-language-javascript#create-supporting-azure-resources-for-your-function).

             5. Créez et configurez l&apos;application de fonction Azure à l&apos;aide de l&apos;image que vous avez envoyée à l&apos;ACR à l&apos;étape précédente. Pour plus d&apos;informations, consultez la [documentation Azure](https://learn.microsoft.com/en-us/azure/azure-functions/functions-deploy-container-apps?tabs=acr%2Cbash&pivots=programming-language-javascript#create-and-configure-a-function-app-on-azure-with-the-image).

             6. Récupérez l&apos;URL de l&apos;application de fonction Azure après le déploiement en exécutant :

             ```bash
             az functionapp show --name YOUR_APPLICATION_NAME --resource-group NAME_OF_THE_APPS_RESOURCE_GROUP
             ```
        </TabsPageItem>

        <TabsPageItem id="python">
          Pour installer l&apos;agent Python New Relic, ajoutez les lignes suivantes à la dernière étape de votre `Dockerfile`:

          ```dockerfile
          FROM mcr.microsoft.com/azure-functions/python:4-python3.11

          # These commands will not be required once the 
          # New Relic Python Agent releases this feature
          RUN apt-get update
          RUN apt-get -y install git 

          ENV AzureWebJobsScriptRoot=/home/site/wwwroot \
              AzureFunctionsJobHost__Logging__Console__IsEnabled=true

          RUN pip install newrelic

          # Install any other dependencies
          COPY requirements.txt /
          RUN pip install -r /requirements.txt
          COPY . /home/site/wwwroot
          ```

          <Callout variant="tip">
            L&apos;exemple ci-dessus concerne une fonction Azure Python 3.11. Vous pouvez modifier la version de Python pour qu&apos;elle corresponde à vos besoins.
          </Callout>

          Après avoir généré l&apos;image Docker, publiez l&apos;image dans Azure Container Registry. Pour plus d&apos;informations, consultez la [documentation Azure](https://learn.microsoft.com/en-us/azure/azure-functions/functions-deploy-container?tabs=acr%2Cbash%2Cazure-cli&pivots=programming-language-python#publish-the-container-image-to-a-registry).
        </TabsPageItem>

        <TabsPageItem id="net">
          Pour installer l&apos;agent .NET New Relic, ajoutez les lignes suivantes à la dernière étape de votre fichier Docker :

          ```dockerfile
          # Install the latest New Relic .NET agent using the apt-get package manager
          # To install a specific version of the .NET agent, add the version number to the apt-get install line (i.e. apt-get install -y newrelic-dotnet-agent=10.38.0)
          RUN apt-get update && apt-get install -y wget ca-certificates gnupg \
              && echo 'deb http://apt.newrelic.com/debian/ newrelic non-free' | tee /etc/apt/sources.list.d/newrelic.list \
              && wget https://download.newrelic.com/548C16BF.gpg \
              && apt-key add 548C16BF.gpg \
              && apt-get update \
              && apt-get install -y newrelic-dotnet-agent \
              && rm -rf /var/lib/apt/lists/*
          ```

          Lorsque vous déployez votre application, l&apos;agent .NET est installé dans le dossier `/usr/local/newrelic-dotnet-agent` .
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ## Configurer les variables d’environnement

    Après avoir publié l’application Azure Function, [configurez les variables d’environnement](/docs/serverless-function-monitoring/azure-function-monitoring/env-variables-azure):

    1. Accédez à votre Azure Function dans le portail Azure .
    2. Sous **Settings** , cliquez sur **Environment variables** , puis sur **Advanced edit** .
    3. En fonction de votre environnement d’exécution de déploiement, collez les valeurs suivantes :

    <Callout variant="important">
      Assurez-vous d&apos;ajouter une virgule à la fin de la dernière ligne existante et de mettre à jour votre clé de licence dans la configuration suivante.
    </Callout>

    <Tabs>
      <TabsBar>
        <TabsBarItem id="nodejs">Node.js</TabsBarItem> <TabsBarItem id="py">Python</TabsBarItem> <TabsBarItem id=".net">.NET</TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="nodejs">
          ```json
          {
            "NODE_OPTIONS": "-r newrelic",
            "NEW_RELIC_LICENSE_KEY": "YOUR_NEW_RELIC_LICENSE_KEY",
            "NEW_RELIC_APP_NAME": "NAME_OF_YOUR_AZURE_FUNCTION_APP"
          }
          ```
        </TabsPageItem>

        <TabsPageItem id="py">
          ```json
          {
            "name": "PYTHON_ENABLE_WORKER_EXTENSIONS",
            "value": "1",
            "slotSetting": false
          },
          {
            "name": "FUNCTIONS_WORKER_RUNTIME",
            "value": "python",
            "slotSetting": false
          }, 
          {
            "name": "PYTHONPATH",
            "value": "${PYTHONPATH}:/home/site/wwwroot:/home/site/wwwroot/.python_packages/lib/site-packages",
            "slotSetting": false
          },
          {
            "name": "NEW_RELIC_APP_NAME",
            "value": "YOUR_NEW_RELIC_APP_NAME",
            "slotSetting": false
          },
          {
            "name": "NEW_RELIC_LICENSE_KEY",
            "value": "YOUR_NEW_RELIC_LICENSE_KEY",
            "slotSetting": false
          }
          ```
        </TabsPageItem>

        <TabsPageItem id=".net">
          ```json
          {
            "name": "CORECLR_ENABLE_PROFILING",
            "value": "1",
            "slotSetting": false
          },
          {
            "name": "CORECLR_NEW_RELIC_HOME",
            "value": "/home/site/wwwroot/newrelic",
            "slotSetting": false
          },
          {
            "name": "CORECLR_PROFILER",
            "value": "{36032161-FFC0-4B61-B559-F6C5D41BAE5A}",
            "slotSetting": false
          }, 
          {
            "name": "CORECLR_PROFILER_PATH",
            "value": "/home/site/wwwroot/newrelic/libNewRelicProfiler.so",
            "slotSetting": false
          },
          {
            "name": "NEW_RELIC_LOG_DIRECTORY",
            "value": "/home/LogFiles/NewRelic",
            "slotSetting": false
          },
          {
            "name": "NEW_RELIC_LICENSE_KEY",
            "value": "YOUR_NEW_RELIC_LICENSE_KEY",
            "slotSetting": false
          }
          ```
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ## Redémarrez votre Azure Function

    Après avoir ajouté les variables d’environnement, redémarrez votre Azure Function pour appliquer les modifications.
  </Step>

  <Step>
    ## Rechercher et utiliser des données [#find-data]

    Après avoir configuré votre Azure Function, vous pouvez rechercher et utiliser les données dans l’interface utilisateur de New Relic.

    1. Accédez à [https://one.newrelic.com](https://one.newrelic.com) &gt; **APM &amp; Services**.

    2. Dans la bannière de recherche, définissez les critères de recherche sur `isAzureFunction = true`:

       <img title="Azure Function Search" alt="A screenshot showing the Azure Function search" src="/images/azure_filters.webp" />

    3. Dans la liste affichée, sélectionnez votre Azure Function pour afficher les données.
  </Step>
</Steps>

## Articles connexes [#related-docs]

<DocTiles>
  <DocTile title="Compatibilité et exigences" path="/docs/serverless-function-monitoring/azure-function-monitoring/compatibility-requirement-azure-monitoring">
    Exigences pour vos Azure Functions
  </DocTile>

  <DocTile title="Instrumentation Linux" path="/docs/serverless-function-monitoring/azure-function-monitoring/linux">
    Découvrez comment configurer vos Azure Functions pour Linux afin de les monitorer dans New Relic.
  </DocTile>

  <DocTile title="Instrumentation Windows" path="/docs/serverless-function-monitoring/azure-function-monitoring/windows">
    Découvrez comment configurer vos Azure Functions pour Windows afin de les monitorer dans New Relic.
  </DocTile>
</DocTiles>