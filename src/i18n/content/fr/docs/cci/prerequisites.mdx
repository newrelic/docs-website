---
title: Prérequis pour AWS CCI
metaDescription: 'Set up AWS for CCI with consolidated billing, CUR, IAM roles, and region activation to optimize cost analysis in New Relic.'
redirect:
  - /docs/cci/getting-started/prerequisites
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

## Présentation

Préparez votre environnement AWS pour l&apos;intégration d&apos;Intelligence Coûts du cloud (CCI) en suivant ces prérequis, notamment la configuration de la facturation consolidée, l&apos;activation des rapports de coûts et d&apos;utilisation, la configuration des rôles et des politiques IAM pour un accès sécurisé et l&apos;activation des régions AWS nécessaires. Assurez-vous que votre configuration permette une analyse et une gestion efficaces des coûts au sein de la plateforme New Relic.

## Prérequis

<CollapserGroup>
  <Collapser id="aws-account-permissions" title="Compte AWS avec les autorisations appropriées">
    Assurez-vous que la [facturation Consolidation est configurée pour l&apos;organisation AWS](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html). Cela permet de consolider la facturation de tous les comptes de votre organisation pour une gestion unifiée des coûts.
  </Collapser>

  <Collapser id="s3-bucket-creation" title="Compartiment S3 pour les rapports de coûts et d'utilisation">
    Les rapports de coûts et d&apos;utilisation AWS (CUR) seront stockés dans un compartiment S3. Nous recommandons de créer le compartiment S3 dans la région `us-east-2`. Suivez ces étapes pour créer un compartiment dédié :

    1. Connectez-vous à la **console de gestion AWS (AWS Management Console)**.

    2. Accédez au service S3.

    3. Cliquez sur **Create bucket**.

    4. Entrez un nom de compartiment unique (par exemple `<your-company-name>-billing`).

    5. Configurer les paramètres du compartiment :

       * Activer le versionnage
       * Désactiver l&apos;accès public (recommandé)
       * Activer le chiffrement par défaut (recommandé)

    6. **Étiquette (facultatif)**: Ajoutez toute étiquette nécessaire à la gestion des ressources de votre organisation.

    7. Cliquez sur **Create bucket**.

    <Callout variant="important">
      N&apos;oubliez pas le nom du compartiment, car vous en aurez besoin dans les étapes suivantes et lors des étapes d&apos;installation sur CCI.
    </Callout>
  </Collapser>

  <Collapser id="s3-bucket-creation" title="configurationdes rapports de coûts et d'utilisation AWS">
    Créez un rapport de coûts et d&apos;utilisation à envoyer à votre compartiment S3 :

    1. Connectez-vous à la **console de gestion AWS (AWS Management Console)**.

    2. Accédez au **Billing Dashboard**.

    3. Dans le volet de navigation de gauche, cliquez sur **Cost &amp; Usage Analysis**.

    4. Cliquez sur **Data Exports**, puis sur **Create**.

    5. Configurer les paramètres du rapport :

       <table>
         <thead>
           <tr>
             <th width={250}>
               **Paramètre**
             </th>

             <th>
               **Valeur**
             </th>

             <th>
               **Description**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               Type d&apos;exportation
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               Fournit des informations détaillées sur l&apos;utilisation et les coûts, adaptées à la plupart des cas d&apos;utilisation liés à la facturation et à l&apos;analyse des coûts.
             </td>
           </tr>

           <tr>
             <td>
               Nom d&apos;exportation
             </td>

             <td>
               `Name`
             </td>

             <td>
               Nom d&apos;exportation fournissant le contexte du rapport CUR. (`eg-<company name-billing-cci>`)&gt;
             </td>
           </tr>

           <tr>
             <td>
               Tableau de données
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               CUR 2.0 prend en charge la structure de tableau au format FOCUS le plus récent.
             </td>
           </tr>

           <tr>
             <td>
               Inclure les identifiants de ressources
             </td>

             <td>
               `ON`
             </td>

             <td>
               Permet un suivi détaillé des coûts associés à chaque ressource AWS, facilitant ainsi l&apos;analyse et la facturation précises.
             </td>
           </tr>

           <tr>
             <td>
               Données de répartition des coûts fractionnés
             </td>

             <td>
               `OFF`
             </td>

             <td>
               Si cela n&apos;est pas absolument nécessaire, désactiver cette option simplifie la structure des données. Cela évite de séparer les données en fonction de catégories ou de répartitions de coûts personnalisées. Vous pouvez omettre cette partie, sauf si votre analyse nécessite une répartition détaillée des coûts.
             </td>
           </tr>

           <tr>
             <td>
               granularité temporelle
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               Définit la granularité temporelle à l&apos;heure. Ce paramètre est essentiel pour permettre une analyse détaillée des coûts et de l&apos;utilisation, ce qui soutient la fonctionnalité de la plateforme.
             </td>
           </tr>

           <tr>
             <td>
               Type de compression
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               Un format de fichier de stockage en colonnes qui améliore les performances des requêtes et réduit l&apos;espace de stockage, avantageux pour le traitement efficace de grands volumes de données.
             </td>
           </tr>

           <tr>
             <td>
               Gestion des versions de fichiers
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               Chaque mise à jour du CUR crée une nouvelle version. Cela permet de conserver les rapports historiques, utiles pour l&apos;audit et le suivi de l&apos;évolution des coûts au fil du temps.
             </td>
           </tr>

           <tr>
             <td>
               Paramètres d&apos;actualisation des données
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               Garantit que les données CUR sont tenues à jour avec les dernières informations sur l&apos;utilisation et les coûts sans intervention manuelle.
             </td>
           </tr>

           <tr>
             <td>
               Paramètres d&apos;exportation de données du compartiment S3
             </td>

             <td>
               `Existing (Select the bucket created in Step 1)`
             </td>

             <td>
               Le fichier CUR créé sera enregistré dans le compartiment S3 à l&apos;emplacement défini ci-dessous. Accepter de remplacer la politique (nous la remplacerons par une nouvelle à l&apos;étape suivante)
             </td>
           </tr>

           <tr>
             <td>
               Préfixe de chemin S3
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               Garantit que vos rapports de coûts et d&apos;utilisation (CUR) sont organisés et stockés correctement dans le compartiment S3, facilitant ainsi l&apos;accès et la gestion efficaces.
             </td>
           </tr>
         </tbody>
       </table>

    6. Cliquez sur **Next**, puis sur **Create report**.

    <Callout variant="important">
      N&apos;oubliez pas le nom d&apos;exportation, car vous en aurez besoin lors de l&apos;étape d&apos;intégration sur CCI. Vérifiez également que le préfixe du chemin S3 est bien « cost-and-usage-reports ».
    </Callout>

    <Callout variant="caution" title="Note">
      Le premier rapport CUR sera livré dans les 24 heures. Des rapports ultérieurs sont transmis périodiquement.
    </Callout>
  </Collapser>

  <Collapser id="iam-policy-cci-access" title="Politique IAM pour l'accès CCI">
    Créez une stratégie IAM qui accorde à CCI les autorisations nécessaires pour accéder à vos données CUR :

    1. Connectez-vous à **la console de gestion AWS (AWS Management Console)**.
    2. Accédez au **IAM service**.
    3. Cliquez sur **Policies** dans le volet de navigation de gauche.
    4. Cliquez sur **Create policy**.
    5. Passez à l&apos; **éditeur JSON (JSON editor)** et collez la politique suivante :

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      Remplacez bucket-name par le nom réel du compartiment S3 que vous avez créé à l&apos;étape **S3 bucket for Cost and Usage reports**.
    </Callout>

    6. Cliquez sur **Next**.
    7. Nommez la politique `CCI-Access-Policy` (ou le nom de votre choix).
    8. Ajouter une description.
    9. Cliquez sur **Create policy**.
  </Collapser>

  <Collapser id="iam-role-cci-access" title="Rôle IAM pour CCI à assumer">
    Créez un rôle IAM que CCI assumera pour accéder à vos données CUR :

    1. Connectez-vous à **la console de gestion AWS (AWS Management Console)**.
    2. Accédez au service IAM.
    3. Cliquez sur **Roles** dans le panneau de navigation de gauche.
    4. Cliquez sur **Create role**.
    5. Sélectionnez **Custom Trust Policy** dans la section « Type d&apos;entité de confiance ».
    6. Collez la définition de rôle suivante dans l&apos;éditeur :
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="caution" title="Note">
      L&apos;externalId est un identifiant unique dynamique du service d&apos;intégration CCI, il est généré une fois que nous revenons à CCI pour démarrer l&apos;intégration.
    </Callout>

    7. Cliquez sur **Next**.
    8. Joignez la stratégie créée dans [la stratégie IAM pour l&apos;étape d&apos;accès CCI](#iam-policy-cci-access).
    9. Cliquez sur **Next**.
    10. Nom du rôle : `CCI-Access-Role` (ou le nom que vous préférez).
    11. Ajouter une description (facultatif).
    12. Cliquez sur **Create role**.
    13. Après la création du rôle, notez l&apos;ARN du rôle (affiché sur la page de résumé du rôle).

    <Callout variant="important">
      Vous devrez fournir l&apos;ARN du rôle à CCI lors du processus d&apos;intégration.
    </Callout>
  </Collapser>
</CollapserGroup>

## Conditions préalables à l&apos;estimation des coûts en temps réel

Pour activer la visualisation en temps réel des coûts estimés dans CCI, assurez-vous de respecter les prérequis spécifiques associés à votre méthode d&apos;instrumentation :

<table>
  <thead>
    <tr>
      <th>
        Méthode
      </th>

      <th>
        Description
      </th>

      <th>
        Quand choisir
      </th>

      <th>
        Prérequis
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        agent d&apos;infrastructure et intégration
      </td>

      <td>
        Utilise l&apos;agent New Relic Infrastructure pour monitoring détaillée.
      </td>

      <td>
        Choisissez cette option pour une visibilité et un contrôle approfondis, idéale pour les configurations EC2, EKS/EC2 ou ECS/EC2 autonomes.
      </td>

      <td>
        * Si vous disposez d&apos;une instance EC2 autonome, installez l&apos;agent New Relic Infrastructure.
        * Si vous utilisez EKS/EC2, installez l&apos;intégration Kubernetes.
        * Si vous utilisez ECS/EC2, installez l&apos;intégration ECS. Cette méthode n&apos;est pas prise en charge par AWS Fargate.
      </td>
    </tr>

    <tr>
      <td>
        intégration cloud (métriques)
      </td>

      <td>
        Utilise les métriques AWS CloudWatch pour monitoring en temps réel.
      </td>

      <td>
        Optez pour cette option lorsque les données en temps réel sont essentielles. Convient aux environnements dynamiques nécessitant des informations détaillées et à jour.
      </td>

      <td>
        Configurez 

        [Amazon flux de métriques CloudWatch](/install/aws-cloudwatch/)

        .
      </td>
    </tr>

    <tr>
      <td>
        intégration cloud (polling) - legacy
      </td>

      <td>
        Collecte des données en interrogeant les services AWS à intervalles réguliers.
      </td>

      <td>
        Convient aux environnements tolérant des mises à jour moins fréquentes. Option héritée utilisée lorsque l&apos;approche basée sur des métriques est moins réalisable.
      </td>

      <td>
        Configurez 

        [l&apos;intégration des sondages AWS](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        .
      </td>
    </tr>
  </tbody>
</table>

## Prérequis pour l&apos;allocation des coûts Kubernetes

* [Installez l&apos;intégration Kubernetes](https://docs.newrelic.com/install/kubernetes/). L&apos;intégration AWS Fargate n&apos;est pas prise en charge pour cette fonctionnalité.
* Au-delà des étiquettes Kubernetes standard (`app.kubernetes.io/name`, `app.kubernetes.io/instance`, `app.kubernetes.io/component`, et `app.kubernetes.io/part-of`), envisagez d&apos;ajouter deux étiquettes personnalisées telles que `environment` et `team` pour indiquer l&apos;environnement de déploiement et l&apos;équipe responsable. Envisagez également d&apos;ajouter deux balises de ressources personnalisées telles que `project` et `costCenter`. Ces étiquettes et balises de ressources vous aideront à mieux segmenter et analyser vos données d&apos;allocation des coûts Kubernetes.

## Recommandations

* Configurez [les balises d&apos;allocation des coûts](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html) dans votre compte AWS. L&apos;étiquette facilite une catégorisation des coûts détaillée et pertinente. Assurez-vous qu&apos;au moins deux balises de ressources personnalisées soient appliquées de manière cohérente à vos ressources AWS pour un filtrage et un regroupement efficaces des coûts.
* Utilisez un compartiment S3 situé dans la région `us-east-2` pour des performances optimales et une rentabilité accrue.

## Avis relatif au contrôle d&apos;accès

Tous les utilisateurs ayant accès au compte/à l&apos;organisation New Relic désigné peuvent consulter vos données de coûts cloud AWS dans Intelligence Coûts du cloud. Nous vous encourageons à sélectionner avec soin le compte/l&apos;organisation New Relic approprié(e) qui correspond à vos politiques internes de contrôle d&apos;accès afin de garantir une gestion sécurisée et conforme des données relatives aux coûts du cloud.

<Callout variant="important">
  **accès au compartiment S3**

  New Relic exige uniquement un accès en lecture à votre compartiment S3, et cet accès est limité à un seul rôle IAM du côté de New Relic. Veillez à maintenir ce niveau d&apos;accès afin de protéger vos données tout en facilitant les opérations nécessaires.
</Callout>