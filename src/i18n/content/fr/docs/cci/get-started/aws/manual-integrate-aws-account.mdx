---
title: Intégrer manuellement votre compte AWS
tags:
  - cloud cost intelligence
  - aws
  - amazon web services
  - aws cost management
  - cloud cost optimization
  - cci aws
  - manual aws setup
metaDescription: Manually integrate your AWS account with Cloud Cost Intelligence by configuring required AWS resources and settings.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Intégrez manuellement votre compte AWS à Cloud Cost Intelligence en configurant les ressources et les paramètres AWS requis. Cette méthode offre un contrôle total sur chaque étape de configuration.

## Instructions de configuration

<Callout variant="important">
  Pour les étapes suivantes, connectez-vous à la **console de gestion AWS** et restez connecté tout au long du processus.
</Callout>

<Steps>
  <Step>
    ### Créer un compartiment S3 pour les rapports de coûts et d&apos;utilisation [#create-s3-bucket]

    Créez un compartiment S3 pour stocker les rapports AWS Cost and Usage Reports (CUR). Nous recommandons d&apos;utiliser la région `us-east-2`.

    1. Accédez au **S3 service** et cliquez sur **Create bucket**.

    2. Saisissez un nom de bucket unique (par exemple, `<your-company-name>-billing`).

    3. Configurer les paramètres du compartiment :

       * Activer le versionnage
       * Désactiver l&apos;accès public (recommandé)
       * Activer le chiffrement par défaut (recommandé)

    4. **Balises (Facultatif)**: Ajoutez les balises nécessaires à la gestion des ressources de votre organisation et cliquez sur **Create bucket**.

    <Callout variant="important">
      N&apos;oubliez pas le nom du bucket pour les étapes suivantes.
    </Callout>
  </Step>

  <Step>
    ### Configurer les rapports de coûts et d&apos;utilisation AWS [#create-cur]

    Créez un **Cost and Usage Report** à remettre à votre compartiment S3 :

    1. Accédez au **Billing Dashboard** &gt; **Cost &amp; Usage Analysis** &gt; **Data Exports**, puis cliquez sur **Create**.

    2. Configurer les paramètres du rapport :

       <table>
         <thead>
           <tr>
             <th width={250}>
               **Paramètre**
             </th>

             <th>
               **Valeur**
             </th>

             <th>
               **Description**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               Type d&apos;exportation
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               Informations détaillées sur l&apos;utilisation et les coûts pour la facturation et l&apos;analyse des coûts.
             </td>
           </tr>

           <tr>
             <td>
               Nom d&apos;exportation
             </td>

             <td>
               `Name`
             </td>

             <td>
               Nom du rapport CUR (par exemple, `<company-name>-billing-cci`).
             </td>
           </tr>

           <tr>
             <td>
               Tableau de données
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               Prend en charge la dernière structure de tableau au format FOCUS.
             </td>
           </tr>

           <tr>
             <td>
               Inclure les identifiants de ressources
             </td>

             <td>
               `ON`
             </td>

             <td>
               Permet un suivi détaillé des coûts par ressource AWS individuelle.
             </td>
           </tr>

           <tr>
             <td>
               Données de répartition des coûts fractionnés
             </td>

             <td>
               `OFF`
             </td>

             <td>
               Simplifie la structure des données. Ne pas inclure, sauf si des répartitions détaillées de l&apos;allocation des coûts sont nécessaires.
             </td>
           </tr>

           <tr>
             <td>
               granularité temporelle
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               Requis pour une analyse détaillée des coûts et de l&apos;utilisation.
             </td>
           </tr>

           <tr>
             <td>
               Type de compression
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               Format de stockage en colonnes qui améliore les performances des requêtes et réduit l&apos;espace de stockage.
             </td>
           </tr>

           <tr>
             <td>
               Gestion des versions de fichiers
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               Crée une nouvelle version à chaque mise à jour, conservant les rapports historiques à des fins d&apos;audit.
             </td>
           </tr>

           <tr>
             <td>
               Paramètres d&apos;actualisation des données
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               Maintient automatiquement les données CUR à jour.
             </td>
           </tr>

           <tr>
             <td>
               Paramètres d&apos;exportation de données du compartiment S3
             </td>

             <td>
               Sélectionnez le bucket que vous avez créé dans [Créer un bucket S3 pour les rapports de coûts et d&apos;utilisation](#create-s3-bucket)
             </td>

             <td>
               Les fichiers CUR sont enregistrés dans le compartiment S3. Acceptez d&apos;écraser la politique.
             </td>
           </tr>

           <tr>
             <td>
               Préfixe de chemin S3
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               Organise les rapports de coûts et d&apos;utilisation dans le bucket S3.
             </td>
           </tr>
         </tbody>
       </table>

    3. Cliquez sur **Next**, puis sur **Create report**.

    <Callout variant="important">
      N&apos;oubliez pas le nom d&apos;exportation pour l&apos;intégration CCI. Assurez-vous que le préfixe du chemin S3 est `cost-and-usage-reports`. Le premier rapport est livré dans les 24 heures ; les rapports suivants sont livrés périodiquement.
    </Callout>
  </Step>

  <Step>
    ### Créer une politique IAM pour l&apos;accès CCI [#create-iam-policy]

    Créez une stratégie Identity and Access Management (IAM) qui accorde à CCI les autorisations d&apos;accéder à vos données CUR :

    1. Accédez à**IAM service** &gt; **Policies** et cliquez sur **Create policy**.
    2. Passez à l&apos; **éditeur JSON (JSON editor)** et collez la politique suivante :

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      Remplacez `bucket-name` par le nom de votre compartiment S3 à partir de [Créer un compartiment S3 pour les rapports de coûts et d&apos;utilisation](#create-s3-bucket).
    </Callout>

    3. Cliquez sur **Next**.
    4. Nommez la politique `CCI-Access-Policy` (ou votre nom préféré), ajoutez une description et cliquez sur **Create policy**.
  </Step>

  <Step>
    ### Créer un rôle IAM pour que CCI l&apos;assume [#create-iam-role]

    Créez un rôle IAM que CCI assumera pour accéder à vos données CUR :

    1. Accédez à **IAM service** &gt; **Roles** et cliquez sur **Create role**.
    2. Sélectionnez **Custom Trust Policy** dans la section type d&apos;entité approuvée et collez la définition de rôle suivante :
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="important" title="Note">
      Le `externalId` est généré lorsque vous démarrez l&apos;intégration CCI.
    </Callout>

    3. Cliquez sur **Next**.
    4. Joignez la politique créée dans [Créer une politique IAM pour l&apos;accès CCI](#create-iam-policy) et cliquez sur **Next**.
    5. Nommez le rôle `CCI-Access-Role` (ou votre nom préféré), ajoutez une description (facultatif) et cliquez sur **Create role**.
    6. Notez l&apos;ARN (Amazon Resource Name) du rôle sur la page de résumé du rôle.

    <Callout variant="important">
      Vous aurez besoin de l&apos;ARN du rôle lors de l&apos;intégration de CCI.
    </Callout>
  </Step>

  <Step>
    ### Intégrer manuellement votre compte AWS [#access-integration]

    1. Accédez à <DNT>[**one.newrelic.com**](https://one.newrelic.com/) &gt; **Integrations &amp; Agents** &gt; **Cloud Cost Intelligence - AWS**</DNT>.
    2. Sélectionnez **Manually integrate your AWS account** et cliquez sur **Continue**.
  </Step>

  <Step>
    ### Fournir les détails de connexion [#provide-connection-details]

    Saisissez les informations requises :

    * **Nom de la connexion**: Nom par défaut fourni. Modifier pour un nom personnalisé.
    * **ARN du rôle IAM inter-compte**: Saisissez l&apos;ARN du rôle IAM (Amazon Resource Name) pour autoriser Cloud Cost Intelligence à accéder à votre bucket S3 (format : `arn:aws:iam::<account-id>:role/<role-name>`).
    * **ID externe**: Copiez l&apos;ID externe et ajoutez-le à la stratégie de confiance de votre rôle IAM dans AWS.
    * **Nom de l&apos;export de données**: Saisissez le nom du fichier d&apos;export de données. Pour le rapport `cci-ingestion-test`, le chemin est `cost-and-usage-reports/cci-ingestion-test/data`.
    * **Nom du bucket S3**: Saisissez le nom exact du bucket. Utilisez la région `us-east-2` pour des performances optimales.
  </Step>

  <Step>
    ### Configurer la politique d&apos;approbation [#configure-trust-policy]

    Ajoutez l&apos;utilisateur global New Relic (`arn:aws:iam::207192125115:user/cci_global_user`) à votre stratégie d&apos;approbation de rôle IAM :

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": {
            "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
          },
          "Action": "sts:AssumeRole",
          "Condition": {
            "StringEquals": {
              "sts:ExternalId": "<externalID>"
            }
          }
        }
      ]
    }
    ```

    <Callout variant="important">
      Définissez `sts:ExternalId` sur l&apos;ID externe de [Fournir les détails de connexion](#provide-connection-details). Activez AWS Security Token Service (STS) pour les régions où il n&apos;est pas activé par défaut (par exemple, `ap-east-1`, `eu-south-1`).
    </Callout>
  </Step>

  <Step>
    ### Tester la connexion [#test-connection]

    Cliquez sur **Test connection** pour vérifier la connexion à votre environnement AWS.

    <Callout variant="important">
      Le traitement initial des données prend quelques heures une fois la configuration terminée.
    </Callout>
  </Step>
</Steps>

## Facultatif : activer les fonctionnalités avancées

Activez ces fonctionnalités facultatives pour améliorer votre analyse des coûts AWS.

### Estimation des coûts en temps réel [#real-time-cost-estimation]

Pour activer l&apos;affichage des coûts estimés en temps réel dans CCI, remplissez les conditions préalables pour votre méthode d&apos;instrumentation :

<table>
  <thead>
    <tr>
      <th>
        Méthode
      </th>

      <th>
        Description
      </th>

      <th>
        Quand choisir
      </th>

      <th>
        Prérequis
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        agent d&apos;infrastructure et intégration
      </td>

      <td>
        Utilise l&apos;agent New Relic Infrastructure pour monitoring détaillée.
      </td>

      <td>
        Pour une visibilité/un contrôle approfondis, idéal pour les configurations EC2, EKS/EC2 ou ECS/EC2 autonomes.
      </td>

      <td>
        * EC2 autonome : Installez l&apos;agent d&apos;infrastructure New Relic.
        * EKS/EC2 : Installez l&apos;intégration Kubernetes.
        * ECS/EC2 : Installez l&apos;intégration ECS. Non pris en charge pour AWS Fargate.
      </td>
    </tr>

    <tr>
      <td>
        intégration cloud (métriques)
      </td>

      <td>
        Utilise les métriques AWS CloudWatch pour monitoring en temps réel.
      </td>

      <td>
        Lorsque les données en temps réel sont essentielles pour les environnements dynamiques.
      </td>

      <td>
        Configurez 

        [Amazon flux de métriques CloudWatch](/install/aws-cloudwatch/)

        .
      </td>
    </tr>

    <tr>
      <td>
        intégration cloud (polling) - legacy
      </td>

      <td>
        Collecte des données en interrogeant les services AWS à intervalles réguliers.
      </td>

      <td>
        Pour les environnements tolérant des mises à jour moins fréquentes.
      </td>

      <td>
        Configurez 

        [l&apos;intégration des sondages AWS](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        .
      </td>
    </tr>
  </tbody>
</table>

### Répartition des coûts de Kubernetes [#k8s-cost-allocation]

* [Installer l&apos;intégration Kubernetes](https://docs.newrelic.com/install/kubernetes/). L&apos;intégration AWS Fargate n&apos;est pas prise en charge.
* Au-delà des labels Kubernetes standards (`app.kubernetes.io/name`, `app.kubernetes.io/instance`, `app.kubernetes.io/component` et `app.kubernetes.io/part-of`), ajoutez des labels personnalisés tels que `environment` et `team`, et des tags de ressources personnalisés tels que `project` et `costCenter` pour une meilleure segmentation et analyse des coûts.

## Recommandations

* Configurez les [balises d&apos;allocation des coûts](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html) dans votre compte AWS. Appliquez au moins deux balises de ressources personnalisées de manière cohérente sur les ressources AWS pour un filtrage et un regroupement efficaces des coûts.
* Utilisez un compartiment S3 dans la région `us-east-2` pour des performances et une rentabilité optimales.

## Avis relatif au contrôle d&apos;accès

Tous les utilisateurs ayant accès au compte/à l&apos;organisation New Relic désigné peuvent afficher vos données de coût cloud AWS. Sélectionnez le compte/l&apos;organisation New Relic approprié qui correspond à vos stratégies de contrôle d&apos;accès internes.

<Callout variant="important">
  **accès au compartiment S3**

  New Relic ne nécessite qu&apos;un accès en lecture à votre bucket S3, limité à un seul rôle IAM. Conservez ce niveau d&apos;accès pour protéger vos données.
</Callout>

<DocTiles numbered>
  <DocTile title="Overview of Cloud Cost Intelligence - AWS" path="/docs/cci/get-started/aws/aws-cci" />

  <DocTile title="Automate AWS with CloudFormation" path="/docs/cci/get-started/aws/automated-setup-cloudformation" />

  <DocTile title="Manually integrate your AWS account" label={{text: 'You are here', color: '#FCD672'}} path="/docs/cci/get-started/aws/manual-integrate-aws-account" />
</DocTiles>