---
title: Mode privilégié vs mode non privilégié
metaDescription: 'Understand why the New Relic Kubernetes integration defaults to privileged mode, what metrics are affected by disabling it, and how to configure it.'
template: GuideTemplate
freshnessValidatedDate: never
translationType: machine
---

L&apos;intégration Kubernetes de New Relic s&apos;exécute en **mode privilégié** par défaut, permettant à l&apos;agent Infrastructure (s&apos;exécutant en tant que sidecar DaemonSet) d&apos;accéder directement aux informations de l&apos;hôte sous-jacent.

Bien que cela fournisse la télémétrie la plus complète, certaines politiques de sécurité (telles que les Pod Security Standards ou les SCC OpenShift) peuvent exiger l&apos;exécution de charges de travail en **mode non privilégié**.

## Pourquoi le mode privilégié est requis

L&apos;agent New Relic Infrastructure est inclus dans le pod Kubelet et nécessite un accès de bas niveau au système d&apos;exploitation du nœud pour collecter des métriques système approfondies.

Bien que la valeur par défaut pour `privileged` dans la [bibliothèque commune](https://github.com/newrelic/helm-charts/blob/master/library/common-library/README.md) soit `false`, ce chart la définit à `true` par défaut (voir [`values.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/nri-bundle/values.yaml)) pour garantir que l&apos;agent puisse :

* Lire les systèmes de fichiers `/proc` et `/sys` de l&apos;hôte.
* Collectez des statistiques précises sur le processeur, la mémoire, le stockage et le réseau de l&apos;**hôte sous-jacent**.
* Collectez des listes complètes de processus et des métadonnées qui corrèlent la santé de l&apos;infrastructure avec vos objets Kubernetes.

### Exécution en mode non privilégié

Si la politique de sécurité de votre cluster n&apos;autorise pas `privileged` dans le contexte de sécurité de vos pods, vous pouvez le désactiver en définissant `privileged` sur `false`.

### Impact sur la collecte de données

<Callout variant="important">
  La désactivation du mode privilégié entraînera la perte des **métriques de l&apos;hôte** et des métadonnées.
</Callout>

Lorsqu&apos;il est non privilégié, l&apos;Agent d&apos;infrastructure ne peut pas voir l&apos;utilisation des ressources de l&apos;hôte. Vous perdrez l&apos;accès aux métriques d&apos;hôte standard, notamment :

* **SystemSample :** CPU, mémoire et charges moyennes au niveau de l&apos;hôte.
* **StorageSample :** Utilisation du disque et E/S pour le système de fichiers du nœud.
* **NetworkSample :** Statistiques de l&apos;interface réseau physique.
* **ProcessSample :** Données sur les processus s&apos;exécutant en dehors du conteneur New Relic.

Pour une liste détaillée des attributs et métriques indisponibles en mode non privilégié, veuillez consulter la [documentation sur les modes d&apos;exécution de l&apos;agent Linux](/docs/infrastructure/infrastructure-agent/linux-installation/linux-agent-running-modes/#mode-metrics).

### Comment le configurer

Mettez à jour votre fichier de valeurs personnalisées pour définir l&apos;indicateur global privilégié sur `false`:

```yaml
global:
  privileged: false
```

### Windows en mode non privilégié

Les conteneurs Windows standard ne peuvent pas accéder directement à l&apos;infrastructure de l&apos;hôte en raison de l&apos;isolation des conteneurs. Les conteneurs HostProcess pourraient fournir cet accès mais introduisent des risques de sécurité supplémentaires et ne sont actuellement pas utilisés par l&apos;intégration Kubernetes New Relic. Par conséquent, les DaemonSets Windows s&apos;exécutent uniquement en mode non privilégié ; le mode privilégié n&apos;est pas pris en charge pour les nœuds Windows.

Pour plus de détails sur les métriques collectées dans ce mode, consultez [Limites de l&apos;intégration Kubernetes pour Windows](/docs/kubernetes-pixie/kubernetes-integration/troubleshooting/troubleshooting-windows/#k8-windows-limitations).