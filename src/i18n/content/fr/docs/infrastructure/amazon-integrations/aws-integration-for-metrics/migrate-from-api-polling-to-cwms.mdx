---
title: Migrer des interrogations API vers les flux de métriques CloudWatch
tags:
  - API polling to CWMS migration
metaDescription: Migrate your New Relic and AWS services integration type from API Polling to CloudWatch Metric Streams.
freshnessValidatedDate: never
translationType: machine
---

Pour une intégration transparente de votre compte AWS avec New Relic, [l&apos;intégration via CloudFormation et flux de métriques CloudWatch](/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation) est l&apos;approche la plus recommandée. Cependant, si vous avez déjà intégré votre compte AWS à New Relic à l&apos;aide d&apos;API Polling, reportez-vous à la procédure suivante pour migrer d&apos;API Polling vers flux de métriques CloudWatch.

## Prérequis [#prerequisites]

Avant de commencer à intégrer votre compte AWS à New Relic, assurez-vous de remplir les conditions préalables suivantes :

* **Une [clé de licence New Relic Ingest et une clé utilisateur](https://one.newrelic.com/api-keys)**: vous aurez besoin de ces clés pour connecter vos services AWS à votre compte New Relic.
* **[Autorisations](https://docs.aws.amazon.com/ARG/latest/userguide/gettingstarted-prereqs-permissions.html)** pour déployer de nouvelles ressources AWS et **[rôles IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html)**: vous aurez besoin de cette autorisation pour votre compte AWS.
* **[Autorisations](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/#infrastructure)** pour l&apos;intégration cloud: vous aurez besoin de ces autorisations pour votre compte New Relic.
* Pour les utilisateurs qui gèrent plusieurs comptes AWS, [connectez chaque compte à un seul compte New Relic](/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account).
* Pour les utilisateurs qui gèrent plusieurs régions au sein de ces comptes, vous devez créer un Kinesis Data Firehose distinct qui pointe vers New Relic pour chaque région.

<Steps>
  <Step>
    ## Migrer vers l&apos;intégration flux de métriques CloudWatch [#migrate]

    Vous pouvez migrer à partir de l&apos;interrogation API en créant un modèle CloudFormation ou en rajoutant votre compte AWS et en suivant nos procédures guidées d&apos;installation dans l&apos;application. Nous vous recommandons d&apos;utiliser la méthode de modèle CloudFormation, car c&apos;est le moyen le plus efficace de migrer. Ces intégrations ne sont pas supportées par flux de métriques CloudWatch et ne peuvent pas être migrées vers notre intégration :

    * AWS CloudTrail
    * AWS Health
    * AWS Trusted Advisor
    * AWS X-Ray

    Si vous utilisez ces intégrations, vous devez toujours utiliser la méthode d’interrogation API.

    <CollapserGroup>
      <Collapser id="with-template" title="Migrer avec le modèle CloudFormation (recommandé)">
        Le modèle CloudFormation vous permet de mettre à jour un modèle avec un espace de nommage préconfiguré en fonction de votre configuration d&apos;interrogation.

        1. Accédez à **[one.newrelic.com &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**, puis cliquez sur **<DNT>Migrate to CloudWatch Metric stream</DNT>**.
        2. Suivez les procédures. Vous téléchargerez le modèle, puis répliquerez l&apos;espace de nommage à partir du sondage API. Assurez-vous d&apos;ajouter les détails de votre compte au modèle téléchargé.
        3. Depuis AWS Console, accédez à <DNT>**Cloud Formation &gt; Create Stack &gt; Upload a template file**</DNT>. Téléchargez votre modèle CloudFormation mis à jour.
      </Collapser>

      <Collapser id="without-template" title="Migrer sans modèle CloudFormation">
        Si vous ne souhaitez pas utiliser la méthode CloudFormation, vous devez rajouter votre compte AWS même si vous avez déjà lié votre compte AWS à l&apos;intégration d&apos;interrogation. Ces procédures peuvent vous amener à quitter ce document, mais n&apos;oubliez pas de revenir pour désactiver votre intégration d&apos;interrogation.

        1. Allez à <DNT>**[one.newrelic.com &gt; All capabilities &gt;Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT>, puis cliquez sur <DNT>**Add AWS account**</DNT>. Choisissez votre méthode.
        2. Suivez les étapes AWS Console à partir du [fluxAWS Console ](/install/aws-cloudwatch/?task=console)dans ce document.
        3. [Désactivez toutes les intégrations d’interrogation inutiles](/docs/infrastructure/amazon-integrations/connect/uninstall-aws/) dans le compte de fournisseur AWS précédent.

        Lors de la désactivation, gardez à l&apos;esprit que [certaines intégrations ne sont pas prises en charge par flux de métriques CloudWatch](/docs/infrastructure/amazon-integrations/connect/connect-aws-new-relic-infrastructure-monitoring/).
      </Collapser>
    </CollapserGroup>

    Notre intégration de flux de métriques CloudWatch utilise l&apos;API métrique pour pousser les métriques au format [métrique dimensionnel](/docs/data-apis/understand-data/new-relic-data-types/#dimensional-metrics). Notre méthode d&apos;interrogation API, quant à elle, envoie des métriques basées sur [l&apos;événement](/docs/data-apis/understand-data/new-relic-data-types/#events-new-relic).

    * Pour faciliter la transition, nous fournissons un mécanisme de calage qui vous permet d&apos;écrire de manière transparente des requêtes dans n&apos;importe quel format. Ces requêtes sont traitées comme prévu en fonction de la source disponible, soit d&apos;événement à métriques, soit de métriques à événement.
    * Nous vous recommandons de revoir [certaines limitations](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/query-infrastructure-dimensional-metrics-nrql/#known-limitations) concernant le mécanisme de shimming qui vous permet d&apos;utiliser une requête basée sur des événements avec l&apos;intégration de flux de métriques CloudWatch.

    Après la migration, certaines fonctionnalités de New Relic qui dépendent de vos données d&apos;interrogation API peuvent se comporter différemment :

    * <DNT>**Dashboards**</DNT>: le tableau de bord personnalisé qui utilise un événement d&apos;intégration AWS basé sur des sondages fonctionnera toujours comme prévu.
    * <DNT>**Alerts**</DNT>: condition d&apos;alerte selon laquelle l&apos;utilisation d&apos;un événement AWS basé sur un sondage fonctionnera toujours. Nous vous recommandons de les adapter au format de métrique dimensionnelle qui utilise NRQL comme source.
    * <DNT>**Entities**</DNT>: votre liste d&apos;entités monitorées peut afficher des entités dupliquées pendant 24 heures maximum.
    * <DNT>**Attributes**</DNT>: l&apos;intégration AWS basée sur les sondages préfixe la balise de ressource collectée avec `label.`, tandis que l&apos;intégration AWS CloudWatch Metric Streams préfixe la balise de ressource collectée avec `tags.`. Si les deux intégrations sont activées pour le même compte AWS, la balise de ressource apparaîtra sous les deux préfixes lors de l&apos;utilisation du format événement.
  </Step>

  <Step>
    ## Validez vos données [#validate-data]

    Pour confirmer que vous recevez des données des flux métriques, suivez ces étapes :

    1. Aller à <DNT>**[one.newrelic.com &gt; All capabilities &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT>. Recherchez le compte AWS que vous avez connecté à New Relic. <DNT>**Stream**</DNT> comptes.
    2. Vérifiez le dashboard l’état du compte et confirmez que New Relic reçoit les données métriques. Cela peut inclure des erreurs et le nombre d&apos;espaces de nommage et de métriques ingérés.
    3. Explorez vos données en écrivant des requêtes pour des ensembles spécifiques de métriques.

    Il faudra peut-être quelques minutes à New Relic pour détecter de nouvelles ressources et les synthétiser en tant qu&apos;entité.

    <Callout variant="tip">
      Les métriques AWS CloudWatch pour les services mondiaux, tels qu&apos;AWS AWS Billing, ne sont disponibles que dans la région <DNT>**us-east-1**</DNT>. Assurez-vous qu’un flux de métriques CloudWatch actif est configuré dans cette région.
    </Callout>
  </Step>
</Steps>

## Sujets connexes [#related-topics]

<DocTiles>
  <DocTile title="Collecter des données à partir de plusieurs comptes AWS" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account/">
    Découvrez comment collecter des données à partir de plusieurs comptes AWS.
  </DocTile>

  <DocTile title="Métriques d'intégration AWS" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-integrations-metrics/">
    Explorez et utilisez les métriques du flux de métriques CloudWatch.
  </DocTile>

  <DocTile title="Intégration AWS via CloudFormation et CWMS" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-cwms">
    Intégrez les services AWS avec New Relic en utilisant CloudFormation et les flux de métriques CloudWatch.
  </DocTile>

  <DocTile title="Intégration AWS via CloudFormation et API Polling" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-and-api-polling">
    Intégrez les services AWS à New Relic à l’aide de CloudFormation et d’API Polling.
  </DocTile>

  <DocTile title="Intégration AWS via Terraform" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/terraform">
    Intégrez les services AWS avec New Relic à l’aide de Terraform.
  </DocTile>

  <DocTile title="Intégration manuelle depuis la console AWS" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/manual">
    Intégrez manuellement les services AWS avec New Relic depuis la console AWS.
  </DocTile>
</DocTiles>