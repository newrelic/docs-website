---
title: Paramètres de configuration de l'intégration PostgreSQL
tags:
  - Integrations
  - On-host integrations
  - Advanced configuration
metaDescription: New Relic's PostgreSQL monitoring integration's advanced configuration
freshnessValidatedDate: never
translationType: machine
---

Cette intégration est un logiciel open source. Cela signifie que vous pouvez [parcourir son code source](https://github.com/newrelic/nri-postgresql) et envoyer des améliorations, ou créer votre propre fork et le construire.

### Paramètres de l&apos;instance PostgreSQL [#instance-settings]

L&apos;intégration PostgreSQL collecte à la fois les informations Métriques (<DNT>**M**</DNT>) et Inventaire (<DNT>**I**</DNT>). La colonne <DNT>**Applies To**</DNT> du tableau suivant indique les paramètres qui peuvent être utilisés pour chaque collection spécifique :

<table>
  <thead>
    <tr>
      <th>
        Paramètre
      </th>

      <th>
        Description
      </th>

      <th style={{ width: '150px' }}>
        S&apos;applique à
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `HOSTNAME`
      </td>

      <td>
        Le nom d&apos;hôte pour la connexion PostgreSQL. La valeur par défaut est localhost.
      </td>

      <td style={{ "text-align": "center" }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `PORT`
      </td>

      <td>
        Le port sur lequel PostgreSQL s&apos;exécute. La valeur par défaut est 5432.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `USERNAME`
      </td>

      <td>
        Le nom d&apos;utilisateur pour la connexion PostgreSQL. <DNT>**Required.**</DNT>
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `PASSWORD`
      </td>

      <td>
        Le mot de passe pour la connexion PostgreSQL. <DNT>**Required.**</DNT>
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `COLLECTION_LIST`
      </td>

      <td>
        Éventail JSON, un objet JSON ou la chaîne littérale `ALL` qui spécifie l&amp;apos;entité à collecter. L&amp;apos;utilisateur PostgreSQL ne peut collecter que les métriques de table et d&amp;apos;index des tables pour lesquelles il dispose des autorisations `SELECT` .

        Obligatoire, sauf pour `PgBouncer`.

        <Callout variant="important">
          Ceci ne s&apos;applique pas aux requêtes personnalisées configurées avec `CUSTOM_METRICS_QUERY` ou `CUSTOM_METRICS_CONFIG`.
        </Callout>

        Pour obtenir de l’aide, consultez ces [exemples](/docs/infrastructure/host-integrations/host-integrations-list/postgresql/postgresql-integration#examples).
      </td>

      <td style={{ "text-align": "center" }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECTION_IGNORE_DATABASE_LIST`
      </td>

      <td>
        Éventail JSON de noms de bases de données qui seront ignorés pour la collecte des métriques. Généralement utile dans les cas où `COLLECTION_LIST` est défini sur `ALL` et certaines bases de données doivent être ignorées. La valeur par défaut est `[]`.

        <Callout variant="important">
          Ceci ne s&apos;applique pas aux requêtes personnalisées configurées avec `CUSTOM_METRICS_QUERY` ou `CUSTOM_METRICS_CONFIG`.
        </Callout>
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `PGBOUNCER`
      </td>

      <td>
        Collectez `pgbouncer` métriques. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `ENABLE_SSL`
      </td>

      <td>
        Détermine si SSL est activé. Si `true`, `ssl_cert_location` et `ssl_key_location` sont obligatoires. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `TRUST_SERVER_CERTIFICATE`
      </td>

      <td>
        Si `true`, le certificat du serveur n&amp;apos;est pas vérifié pour SSL. Si `false`, le certificat du serveur identifié dans `ssl_root_cert_location` est vérifié. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_ROOT_CERT_LOCATION`
      </td>

      <td>
        Chemin absolu vers le fichier de certificat racine codé PEM. Obligatoire si `trust_server_certificate` est `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_CERT_LOCATION`
      </td>

      <td>
        Chemin absolu vers le fichier de certificat client codé en PEM. Obligatoire si `enable_ssl` est `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_KEY_LOCATION`
      </td>

      <td>
        Chemin absolu vers le fichier de clé client codé en PEM. Obligatoire si `enable_ssl` est `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `TIMEOUT`
      </td>

      <td>
        Temps d&apos;attente maximal pour la connexion, en secondes. Définissez sur `0` pour aucun délai d&amp;apos;expiration. La valeur par défaut est 10.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `DATABASE`
      </td>

      <td>
        La base de données PostgreSQL à laquelle se connecter. La valeur par défaut est `postgres`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `CUSTOM_METRICS_QUERY`
      </td>

      <td>
        La requête SQL qui nécessite `columns metric_name`, `metric_type` et `metric_value.metric_type` peut être `gauge`, `rate`, `delta` ou `attribute`. Les colonnes supplémentaires collectées avec la requête sont ajoutées à l&amp;apos;ensemble métrique en tant qu&amp;apos;attribut.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `CUSTOM_METRICS_CONFIG`
      </td>

      <td>
        Un chemin vers un fichier YAML avec une liste de requêtes personnalisées, ainsi que leur type métrique, leur base de données et leurs remplacements de nom d&apos;échantillon. Voir les [exemples](/docs/infrastructure/host-integrations/host-integrations-list/postgresql/postgresql-integration#examples) pour plus de détails.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECT_DB_LOCK_METRICS`
      </td>

      <td>
        Activez la collecte des métriques de verrouillage de la base de données, ce qui peut nécessiter beaucoup de performances. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECT_BLOAT_METRICS`
      </td>

      <td>
        Activez les métriques de gonflement de l&apos;espace table, qui peuvent être gourmandes en performances. La valeur par défaut est `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `METRICS`
      </td>

      <td>
        Définissez sur `true` pour activer la collecte Métriques uniquement. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }} />
    </tr>

    <tr>
      <td>
        `INVENTORY`
      </td>

      <td>
        Définissez sur `true` pour activer la collecte d’inventaire uniquement. La valeur par défaut est `false`.
      </td>

      <td style={{ 'text-align': 'center' }} />
    </tr>
  </tbody>
</table>

Les valeurs de ces paramètres peuvent être définies de plusieurs manières :

* Ajout de la valeur directement dans le fichier de configuration. C&apos;est la manière la plus courante.

* Remplacement des valeurs des variables d’environnement à l’aide de la notation `{{ }}` . En savoir plus sur [l&apos;utilisation des passthroughs de variables d&apos;environnement avec l&apos;intégration sur hôte](/docs/infrastructure/install-infrastructure-agent/configuration/configure-infrastructure-agent/#passthrough) ou voir l&amp;apos;exemple de [remplacement des variables d&apos;environnement](/docs/infrastructure/host-integrations/host-integrations-list/elasticsearch/elasticsearch-integration#envvar-replacement). <Callout variant="important">Cela nécessite l&apos;agent d&apos;infrastructure v1.14.0+.</Callout>

* Utilisation de la gestion des secrets. Utilisez ceci pour protéger les informations sensibles, telles que les mots de passe qui seraient exposés en texte brut dans le fichier de configuration. Pour plus d&apos;informations, voir [gestion des secrets](/docs/integrations/host-integrations/installation/secrets-management).

### Libellés et attribut personnalisé [#labels]

Les variables d&apos;environnement peuvent être utilisées pour contrôler les paramètres de configuration, tels que votre <InlinePopover type="licenseKey" />, et sont ensuite transmises à l&amp;apos;agent d&amp;apos;infrastructure. Pour obtenir des instructions sur l’utilisation de cette fonctionnalité, consultez [Configurer l’agent d’infrastructure](/docs/infrastructure/install-infrastructure-agent/configuration/configure-infrastructure-agent).

Vous pouvez également décorer vos métriques à l’aide d’étiquettes. Les étiquettes vous permettent d&apos;ajouter des paires valeur-clé à vos métriques que vous pouvez ensuite utiliser pour interroger, filtrer ou regrouper vos métriques.

Notre fichier de configuration par défaut inclut des exemples d&apos;étiquettes mais, comme elles ne sont pas obligatoires, vous pouvez supprimer, modifier ou en ajouter de nouvelles de votre choix :

```yml
 labels:
   env: production
   role: postgresql
```

## Données d&apos;inventaire [#inventory]

L&apos;intégration PostgreSQL collecte chaque paramètre de `pg_settings` ainsi que ses `boot_val` et `reset_val`. Les [données d’inventaire de l’infrastructure](/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data) apparaissent sur la [page Inventaire](/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-inventory-page-search-your-entire-infrastructure), sous la source `config/postgresql` .

## Dépannage [#troubleshooting]

Voici quelques conseils de dépannage pour l’intégration PostgreSQL :

* Si vous rencontrez des problèmes de connexion, assurez-vous que vous pouvez vous connecter au cluster depuis la même box avec `psql`.
* Si vous rencontrez des problèmes lors de la collecte des métriques `PgBouncer` , assurez-vous d&amp;apos;être connecté à l&amp;apos;instance via `PgBouncer`. Le port par défaut est `6432`.
* Si vous obtenez le message d&apos;erreur `Error creating list of entities to collect: pq: unsupported startup parameter: extra_float_digits`, définissez `ignore_startup_parameters = extra_float_digits` dans le fichier de configuration `PgBouncer` .