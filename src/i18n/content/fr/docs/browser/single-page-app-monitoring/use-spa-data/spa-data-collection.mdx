---
title: Collecte de données SPA
tags:
  - Browser
  - Single page app monitoring
  - Use SPA data
metaDescription: How browser stores data from an app that uses a single-page app (SPA) architecture.
freshnessValidatedDate: never
translationType: machine
---

Ce document explique comment le navigateur collecte et stocke les données de votre application monopage asynchrone (SPA). Cela vous donnera une meilleure compréhension des [données SPA que vous voyez dans l&apos;UIdu navigateur](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser). Cela vous aidera également à ajouter plus facilement un monitoring personnalisé avec l&apos; [API SPA](/docs/browser/single-page-app-monitoring/use-spa-data/use-spa-api).

## Interaction Browser [#browser-interaction]

Au cœur de monitoring des SPA se trouve le concept de <DNT>**browser interaction**</DNT>. New Relic définit une interaction avec le navigateur, autrement appelée navigation douce, comme la séquence d&apos;événements suivante, s&apos;inspirant de [l&apos;heuristique de Google](https://github.com/WICG/soft-navigations?tab=readme-ov-file#heuristics):

1. Une interaction utilisateur se produit. Nous recherchons spécifiquement `click`, `keydown` ou `submit` événement. L&apos;événement `popstate` de l&apos;API Historique lancera également une interaction.
2. L&apos;URL change de quelque manière que ce soit, que ce soit le chemin ou le hacher.
3. Toutes les modifications, y compris celles apportées à l’attribut ou au texte du nœud, se produisent n’importe où dans l’arborescence DOM du document.

En suivant ces étapes, l&apos;interaction avec le navigateur est considérée comme terminée lors de la prochaine image de repeinture. Ils associeront également requests XHR et de récupération démarrées dans leur intervalle. La v2.1 a introduit une autre étape :

4. Pour les nouveaux SPA (agent v1.298.0 et versions ultérieures), le moniteur vérifie les descentes en rappel de longue durée pendant un maximum de 5 secondes. Si une descente en rappel de longue durée est identifiée, le système prolonge l&apos; interaction en cours et relance le moniteur.

l&apos;interaction sera complètement terminée lorsqu&apos;il y aura une période de 5 secondes sans aucune tâche longue. Pendant la période d&apos;extension précédant la fin de la dernière tâche longue observée, toute AjaxRequest et JavascriptError qui se produisent seront également associées à l&apos;interaction. Il est important de noter que la durée de l’interaction n’inclura pas les 5 dernières secondes d’inactivité.

Notez que l’étape quatre peut être court-circuitée ou contournée dans certains scénarios.

<Callout variant="tip">
  Le déclencheur d&apos;événement `popstate` est géré de manière unique par rapport aux autres déclencheurs d&apos;événement d&apos;interface utilisateur en raison de son comportement spécifique dans les navigateurs. Lorsqu&apos;un événement `popstate` se produit dans les 500 millisecondes suivant un autre événement d&apos;interface utilisateur comme un clic, il sera fusionné dans l&apos;interaction existante initiée par cet événement, sans modifier le déclencheur d&apos;origine de l&apos;interaction (par exemple, « clic »). Cependant, deux événements `popstate` consécutifs ne seront jamais fusionnés de cette manière.

  L&apos;interaction avec `popstate` comme déclencheur provient généralement d&apos;actions du navigateur, telles que l&apos;utilisation du bouton Précédent ou Suivant, ou d&apos;actions liées au code, telles que la modification programmatique de l&apos;URL.
</Callout>

## Types de reporting SPA des données [#spa-data]

Trois grandes catégories de données d’application à page unique peuvent être signalées à New Relic :

Chacun d’entre eux crée un événement `BrowserInteraction` . Si une ou plusieurs requests AJAX font partie d&apos;une interaction, les événements `AjaxRequest` associés sont également créés. Ces événements et leurs attribut peuvent être requêtes dans le [générateur de requêtes](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data).

<Callout variant="important">
  L&apos;interaction par défaut ou non personnalisée n&apos;attend pas que requests réseau soient terminées. Ils sont associés à l&apos;interaction sur une base telle quelle, ce qui signifie que seules requests terminées avant que l&apos; interaction ne soit récoltée par le planificateur y sont liées. Si une demande réseau a une durée lente ou longue et démarre dans le cadre d&apos;une interaction, elle peut se situer en dehors de cette fenêtre temporelle et ne pas être associée à l&apos;interaction.

  Vous pouvez également prolonger manuellement la durée d&apos;une interaction pour vous assurer qu&apos;elle reste ouverte jusqu&apos;au retour d&apos;une demande réseau importante à l&apos;aide de l&apos;API.
</Callout>

## Chargement initial de la page

Un <DNT>**initial page load**</DNT> est un changement d&apos;URL traditionnel, résultant d&apos;un chargement ou d&apos;un rechargement complet d&apos;une URL. Ceci est indiqué dans le navigateur lorsqu&apos;un événement de chargement de page se déclenche (l&apos;événement `window.onload` ) et est également appelé navigation matérielle. Les chargements de page initiaux apparaissent avec les changements d&apos;itinéraire dans [l&apos;interface utilisateur du navigateur](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser).

## Modifications d&apos;itinéraire

Les utilisateurs de SPA expérimentent des changements d&apos;itinéraire dynamiques de manière similaire aux chargements de pages. Les visiteurs d&apos;un site ou d&apos;une application ne se soucient généralement pas de savoir <DNT>**how**</DNT> une nouvelle vue leur a été fournie ; ils savent simplement que lorsqu&apos;ils effectuent une action, une nouvelle vue apparaît. Pour cette raison, nous traitons les changements d&apos;itinéraire de la même manière que les chargements de pages dans l&apos;UI.

Afin de monitorer de manière optimale les applications monopages, nous commençons monitoring toute interaction qui pourrait théoriquement conduire à des changements d&apos;itinéraire.

* Si ces interactions ne terminent **pas** les étapes heuristiques définies ci-dessus, l&apos;agent lance monitoring mais les abandonne ensuite.
* Si ces interactions <DNT>**do**</DNT> suivent toutes les étapes, l&apos;agent enregistre la séquence comme un événement `BrowserInteraction` terminé.

Une interaction est considérée comme un changement d&apos;itinéraire et enregistrée en tant qu&apos;événement `BrowserInteraction` si l&apos;URL change entre le début et la fin. Les modifications d’URL sont suivies de deux manières :

* L&apos;événement `popstate`. La modification de l&apos;URL par programmation, par exemple en définissant `window.location.hash`, déclenchera cet événement.
* `pushState` ou `replaceState` est appelé. Les SPA utilisent généralement ces méthodes API d’historique pour mettre à jour l’URL.

Les modifications d&apos;itinéraire apparaissent avec les chargements de page initiaux dans l&apos; [UIdu navigateur](/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser).

Notez que l&apos;agent signale des fragments de hachage à partir des URL de changement d&apos;itinéraire. Si vous utilisez hacher pour transmettre des données privées ou sensibles, ces données peuvent être visibles par l&apos;utilisateur de votre compte New Relic. Pour plus d&apos;informations sur la collecte et la création de rapports de données, consultez [Sécurité du navigateur](/docs/browser/new-relic-browser/performance-quality/security-new-relic-browser).

## monitoringpersonnalisé [#api-custom-events]

Toutes les applications sont différentes et ont des besoins monitoring différents. Vous pouvez utiliser l&apos; [API SPA](/docs/browser/new-relic-browser/browser-agent-spa-api) pour personnaliser l&apos;interaction de votre navigateur ou définir vous-même la manière dont elle est capturée.

événement personnalisé est enregistré sous `BrowserInteraction` événement et présente la différence d&apos;attribut suivante :

* L&apos;attribut `category` aura la valeur `Custom`.
* L&apos;attribut `trigger` aura la valeur `api`. (Il s&apos;agit de la valeur par défaut mais peut être modifiée avec l&apos;API.)

L&apos;API vous permet de déterminer quand démarrer et arrêter une telle interaction personnalisée, si l&apos;heuristique ci-dessus ne correspond pas à votre base d&apos;utilisateurs ou à votre application.

## événement et attribut [#event-data-structure]

Nous enregistrons les interactions du navigateur qui conduisent à des changements d&apos;itinéraire et à des chargements de pages, ou qui sont créées via l&apos;API, sous la forme d&apos;événement `BrowserInteraction` et requests AJAX sous la forme d&apos;événement `AjaxRequest`. Vous pouvez requêter ces événements dans le [générateur de requêtes](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data).