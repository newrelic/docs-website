---
title: register_application (Python API d'agent)
type: apiDoc
shortDescription: Enregistre immédiatement l'agent Python. Utilisé pour l'initialisation manuelle de l'agent.
tags:
  - Agents
  - Python agent
  - Python agent API
metaDescription: 'Python agent API: Registers the Python agent immediately, instead of allowing it to be done more passively.'
freshnessValidatedDate: never
translationType: machine
---

## Syntaxe

```py
newrelic.agent.register_application(name=None, timeout=None)
```

Enregistre immédiatement l'agent Python. Utilisé pour l'initialisation manuelle de l'agent.

## Description

Lorsque [`initialize`](/docs/agents/python-agent/python-agent-api/initialize) est appelé, il configure l&amp;apos;agent Python mais n&amp;apos;enregistre pas l&amp;apos;agent auprès du [collecteur](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector). Cet appel enregistre l&amp;apos;agent auprès du collecteur.

Ceci est principalement utilisé pour [les transactions d'arrière-plan](/docs/agents/python-agent/python-agent-api/background_task) non Web instrumentées à l&amp;apos;aide de l&amp;apos; API. Lorsqu&amp;apos;il est utilisé avec une transaction non Web, appelez `register_application` dès que possible après l&amp;apos;appel `initialize` .

Pour les transactions Web, l' agent s'enregistre normalement automatiquement lorsque la première requête Web ou tâche d'arrière-plan se produit, l' agent reçoit sa [configuration côté serveur](/docs/agents/manage-apm-agents/configuration/configure-agent#ssc) du collecteur. Étant donné que l’enregistrement peut prendre une seconde environ, les détails des premières transactions sont généralement perdus. Vous pouvez collecter toutes ces données en forçant l&amp;apos;enregistrement avec `register_application`, bien que cela signifie que votre application peut attendre que l&amp;apos;enregistrement soit terminé avant de répondre à des requests Web ou d&amp;apos;exécuter des tâches en arrière-plan.

Si le script lui-même exécute le serveur WSGI, appelez `register_application` à partir du thread du programme principal dans le fichier de script principal. Si vous utilisez Apache/mod\_wsgi ou uWSGI, effectuez l&amp;apos;appel à partir du fichier de script WSGI et placez l&amp;apos;appel immédiatement après `initialize`<DNT>**.**</DNT>

Cet appel renvoie l'objet d'application, de la même manière que [`application`](/docs/agents/python-agent/python-agent-api/application) . L&amp;apos;objet est utilisé pour obtenir une référence à l&amp;apos;application agent-monitorer actuelle application et est utilisé par certains Python API agent appels d&amp;apos; de .

### Évitez d'appeler pendant le verrouillage global de l'importation [#globl-lock]

N'appelez pas `register_application` avec un délai d&amp;apos;expiration différent de zéro lorsque le verrou d&amp;apos;importation global Python sera maintenu. En d’autres termes, ne l’appelez pas dans un fichier de module à portée globale pendant que le module est en cours d’importation. Cela peut entraîner un blocage temporaire avec le thread d’arrière-plan créé par cet appel (le blocage ne sera pas rompu tant que le délai d’attente n’aura pas expiré).

Notez que de nombreux serveurs WSGI importent le module contenant l'application WSGI via les mécanismes d'importation de module Python standard. Dans ces cas, le verrou d'importation global sera maintenu et le problème de blocage décrit ci-dessus peut se produire.

Pour Gunicorn : le problème de blocage qui vient d’être décrit peut également se produire lors de l’utilisation de Gunicorn. Le problème est que le déclenchement de `register_application` à partir du module WSGI n’est pas sûr, car il précharge le module dans le processus parent. Pour utiliser `register_application` avec Gunicorn (avec ou sans délai d&amp;apos;attente), appelez-le à partir d&amp;apos;un rappel `post_fork()` . Ce n&amp;apos;est pas un problème avec Apache/mod\_wsgi, puisque ces outils ont été conçus pour ne pas faire cela, il est donc sûr de créer des threads d&amp;apos;arrière-plan lorsque l&amp;apos;application WSGI est chargée.

### Appel après le fork du processus de travail [#worker-processes]

Si vous enregistrez des transactions dans un processus de travail enfant, n'appelez pas `register_application` dans le processus parent avant que les processus de travail enfants ne soient dupliqués. Si vous appelez `register_application` avant de forker, le thread de l&amp;apos;agent d&amp;apos;arrière-plan sera tué lorsque le processus sera forker. Étant donné que le thread parent signale des données au collecteur, l&amp;apos;agent ne pourra pas signaler de données à partir du processus de travail enfant.

## Paramètres

<table>
  <thead>
    <tr>
      <th width="25%">
        paramètres
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `name`

        *chaîne*
      </td>

      <td>
        Facultatif. Le nom de l'application. Si défini, cela remplace le nom de l'application défini dans la configuration de l'agent Python.
      </td>
    </tr>

    <tr>
      <td>
        `timeout`

        *int* ou *virgule flottante*
      </td>

      <td>
        Le nombre de secondes pendant lesquelles l'application tentera de s'enregistrer avant d'abandonner et d'envoyer une réponse ; ce qui signifie que cette ligne se bloquera jusqu'à ce que New Relic démarre ou que le délai d'attente soit dépassé. Une valeur de `0` signifie que l&amp;apos; application n&amp;apos;attendra pas l&amp;apos;enregistrement avant de traiter requests. La valeur par défaut est `0`. Si vous exécutez une application Web, il n&amp;apos;est pas recommandé de définir cette valeur car elle bloquera et retardera l&amp;apos;application pendant le démarrage de New Relic. Si vous utilisez une seule exécution de programme ou une seule tâche, où le processus s&amp;apos;exécute une fois et se termine immédiatement, il est recommandé de définir cette option, car sinon New Relic ne démarrera pas à temps pour capturer les informations.

        Cette valeur indique le nombre maximal de secondes pendant lesquelles l'appelant doit être bloqué avant que le contrôle ne soit rendu et que l'appelant soit autorisé à continuer. Sans valeur, l'appel utilise le paramètre [`startup_timeout`](/docs/agents/python-agent/installation-configuration/python-agent-configuration#startup-timeout) configuré globalement dans la configuration de l&amp;apos;agent, qui est `0.0` par défaut.
      </td>
    </tr>
  </tbody>
</table>

## Valeurs de retour

Renvoie un application objet qui peut être utilisé par Python API d'autresagent appels d' .

## Exemples

### Enregistrement d'une tâche en arrière-plan [#register-example]

Cet exemple enregistre une tâche d’arrière-plan non Web avec un délai d’expiration long. En règle générale, pour une application Web, vous disposez d'un délai d'expiration très court (la valeur par défaut est 0), mais vous pouvez définir un délai d'expiration plus long pour une tâche non Web peu fréquente afin de garantir que l'initialisation et l'enregistrement ont lieu.

```py
import newrelic.agent

newrelic.agent.initialize('newrelic.ini')
newrelic.agent.register_application(timeout=10.0)

@newrelic.agent.background_task()
def main():
    pass

if __name__ == '__main__':
    main()
```