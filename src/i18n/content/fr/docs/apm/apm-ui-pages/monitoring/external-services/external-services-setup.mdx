---
title: Configuration des services externes
metaDescription: Here are steps to enable and configure external services
freshnessValidatedDate: never
translationType: machine
---

La fonctionnalité de services externes est disponible pour les agents New Relic APM et [OpenTelemetry](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/introduction-opentelemetry-new-relic).

Si vous souhaitez être opérationnel le plus rapidement possible, nous vous recommandons de faire appel à nos agents APM.

Cliquer sur un logo vous envoie vers la plateforme New Relic où vous serez guidé dans l&apos;installation et la configuration de l&apos;agent.

<TechTileGrid>
  <TechTile name="Go agent" icon="logo-go" to="https://one.newrelic.com/nr1-core?state=985d4005-ba90-a8c7-1da1-2af34539b03b" />

  <TechTile name="Java agent" icon="logo-java" to="https://one.newrelic.com/nr1-core?state=80d18bcb-4919-1fcb-2b77-9406838eb916" />

  <TechTile name=".NET agent" icon="logo-dotnet" to="https://one.newrelic.com/nr1-core?state=30e93090-6dfa-6b70-8e75-472f54414355" />

  <TechTile name="Node.js agent" icon="logo-nodejs" to="https://one.newrelic.com/marketplace/install-data-source?state=be2e62fa-cc3b-c428-27c4-8d662c9e80a1" />

  <TechTile name="PHP agent" icon="logo-php" to="https://one.newrelic.com/nr1-core?state=aa633b41-72d4-009c-3abf-55dcf64894fe" />

  <TechTile name="Python agent" icon="logo-python" to="https://one.newrelic.com/nr1-core?state=20fda75b-58fb-a92a-f9e1-7b052035c6e8" />

  <TechTile name="Ruby agent" icon="logo-ruby" to="https://one.newrelic.com/nr1-core?state=d69143ab-605c-579b-25bf-cc6e5fee5b80" />
</TechTileGrid>

## Mettre en place des services externes

Les instructions suivantes vous guideront dans la configuration des services externes.

<Steps>
  <Step>
    ### Commencer à envoyer des données

    La configuration des services externes varie selon que vous utilisez des agents APM ou OpenTelemetry. Sélectionnez l&apos;onglet correspondant à l&apos;option d&apos;installation qui convient à votre système :

    <Tabs>
      <TabsBar>
        <TabsBarItem id="send-data-apm">
          Agent APM
        </TabsBarItem>

        <TabsBarItem id="send-data-otel">
          OpenTelemetry
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="send-data-apm">
          Complétez les éléments suivants pour chaque service que vous souhaitez afficher dans les services externes :

          1. Si vous ne l’avez pas déjà fait, installez l’ [agent](/docs/distributed-tracing/enable-configure/quick-start) New Relic APM approprié.

          2. Assurez-vous que le tracing distribué est activé dans l&apos;agent :

             * Si vous avez installé un nouvel agent, le tracing distribué standard est activé par défaut. Si votre service communique avec d’autres services qui utilisent Infinite Tracing, consultez la documentation de votre agent pour obtenir de l’aide sur Infinite Tracing.
             * Si vous disposez d&apos;un agent plus ancien, suivez les étapes configuration pour activer le tracing distribué standard ou le Infinite Tracing. Lorsque vous activez le tracing distribué, il remplace l’ancien tracing inter-applications.

          3. Vérifiez si votre agent nécessite des étapes de configuration supplémentaires :

             <table>
               <thead>
                 <tr>
                   <th style={{ width: "200px" }}>
                     Agent
                   </th>

                   <th>
                     Version minimale
                   </th>

                   <th>
                     Installation
                   </th>
                 </tr>
               </thead>

               <tbody>
                 <tr>
                   <td>
                     Go
                   </td>

                   <td>
                     3.6.0
                   </td>

                   <td>
                     Consultez la documentation sur l&apos;utilisation [`NewRoundTripper()`](/docs/apm/agents/go-agent/instrumentation/instrument-go-segments/).
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Java
                   </td>

                   <td>
                     5.13.0
                   </td>

                   <td>
                     Consultez la documentation sur l&apos;utilisation de l&apos;[API d&apos;agent Java](/docs/apm/agents/java-agent/api-guides/java-agent-api-instrument-external-calls-messaging-datastore-web-frameworks/) pour instrumenter les appels externes.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     .NET
                   </td>

                   <td>
                     8.29.0
                   </td>

                   <td>
                     L’agent .NET et l’agent .NET dans Azure instrumentent automatiquement les appels externes, mais ils n&apos;instrumentent pas les méthodes pour les transactions. Pour voir les transactions, vous devez utiliser une combinaison des éléments suivants :

                     * [Transactions personnalisées](/docs/agents/net-agent/instrumentation/net-custom-transactions/)
                     * [rôles des travailleurs instrumentés](/docs/apm/agents/net-agent/azure-installation/install-net-agent-azure-cloud-services/#requirements)
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Node.js
                   </td>

                   <td>
                     6.9.0
                   </td>

                   <td>
                     Consultez la documentation sur l&apos;utilisation de l&apos;[API d&apos;agent Node.js](/docs/apm/agents/nodejs-agent/api-guides/guide-using-nodejs-agent-api/#external-services).
                   </td>
                 </tr>

                 <tr>
                   <td>
                     PHP
                   </td>

                   <td>
                     9.12.0.268
                   </td>

                   <td>
                     Consultez la documentation sur l&apos;utilisation de l&apos;[API d&apos;agent PHP](/docs/apm/agents/php-agent/php-agent-api/guide-using-php-agent-api/#datastore) pour instrumenter les appels externes.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Python
                   </td>

                   <td>
                     5.14.0.142
                   </td>

                   <td>
                     Aucune étape supplémentaire n&apos;est nécessaire : les appels externes sont instrumentés automatiquement.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Ruby
                   </td>

                   <td>
                     6.12.0.367
                   </td>

                   <td>
                     Consultez la documentation sur l&apos;utilisation de l&apos;[API d&apos;agent Ruby](/docs/apm/agents/ruby-agent/api-guides/guide-using-ruby-agent-api/#externals) pour instrumenter les appels externes.
                   </td>
                 </tr>
               </tbody>
             </table>

          <Callout variant="tip">
            La version classique des services externes est toujours disponible si vous devez ajouter un nouveau service à une chaîne d&apos;agents utilisant déjà des services externes classiques. Pour installer des services externes classiques, activez [le tracing inter-applications](/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces) au lieu du tracing distribué dans les étapes ci-dessous.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="send-data-otel">
          L&apos;UI de New Relic affiche les détails des services externes une fois que vous avez terminé les étapes de configuration de l&apos;instrumentation OpenTelemetry pour votre service et les [appels](https://opentelemetry.io/docs/java/manual_instrumentation/#span-attributes) qu&apos;elle effectue vers d&apos;autres services. La fonctionnalité de services externes affiche les appels entre vos services, répartis par point de terminaison de transaction dans chaque service. Le nom de chaque transaction est dérivé de l&apos;étendue d&apos;entrée du processus (`span.kind = "server"`).

          Si votre service APM est connecté à un service OpenTelemetry (en amont ou en aval), ce service OpenTelemetry n&apos;apparaîtra pas dans la vue de ce service APM. Cela est dû au fait que, lors de la visualisation d’un service APM, cette fonctionnalité utilise des métriques qui ne sont signalées que par les agents APM. Lorsque vous visualisez un service OpenTelemetry, le service APM apparaîtra comme une connexion.

          La qualité des informations que vous voyez dépend de la stratégie d&apos;échantillonnage que vous utilisez dans Collector. Consultez la section suivante sur l’utilisation de l’échantillonnage pour contrôler ce que vous voyez dans l’ UI.

          <Callout variant="tip">
            Si vous envoyez 100 % de vos données OpenTelemetry à notre API de trace, nous stockons 100 % de ces données, sauf si vous avez une limite de débit spécifique pour votre organisation, ou si vous envoyez suffisamment de données pour déclencher notre limite de débit par défaut.
          </Callout>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ### Ajuster l&apos;échantillonnage pour voir plus de données UI [#adjust-sampling]

    Si vous utilisez un agent APM et que vous voyez peu ou pas de données lorsque vous commencez à explorer au-delà de la page initiale de la carte, vous devrez peut-être ajuster le réservoir de portée pour échantillonner davantage de données. Cela est dû au fait que les données au niveau des transactions sont renseignées par des données de trace échantillonnées.

    Pour OpenTelemetry, la page initiale et toutes les pages d&apos;exploration sont renseignées par des données échantillonnées. Vous devrez donc peut-être effectuer quelques ajustements dans l&apos;échantillonnage pour obtenir les données dont vous avez besoin.

    Voici quelques informations sur les différentes routines d&apos;ajustement du réservoir pour les agents APM, ainsi que des conseils pour ajuster l&apos;échantillonnage pour OpenTelemetry :

    <Tabs>
      <TabsBar>
        <TabsBarItem id="agent-sample">
          Échantillonnage d&apos;agent APM
        </TabsBarItem>

        <TabsBarItem id="otel-sample">
          Échantillonnage OpenTelemetry
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="agent-sample">
          Tous les agents APM disposent d&apos;un réservoir qui stocke les étendues, et la plupart de ces réservoirs d&apos;agents sont configurables. La taille de ce réservoir affecte la probabilité qu&apos;un agent soit en mesure d&apos;envoyer toutes les portées qu&apos;il crée. Voir [la trace fragmentée](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui/#fragmented-traces) pour plus de détails.

          Les données de cette fonctionnalité sont dérivées des étendues de clients et de serveurs adjacentes où des appels externes sont effectués d&apos;un service à un autre. Lorsqu&apos;un agent atteint sa limite de réservoir de portée, il y a un risque qu&apos;il abandonne certaines portées représentant ces appels.

          La valeur configuration de l&apos;agent par défaut de 2000 définit le nombre maximal d&apos;événements que l&apos;agent collecte par minute. S&apos;il y a plus d&apos;étendues que ce nombre, l&apos;agent collecte un échantillonnage statistique, dégradant ainsi essentiellement la quantité de données utilisées dans la carte des services externes.

          Si vous ne voyez pas le type de détails souhaité dans l&apos;UI, vous pouvez augmenter la taille du réservoir jusqu&apos;à 10 000. Passez en revue les éléments suivants pour ajuster les réservoirs d’agent :

          <table>
            <thead>
              <tr>
                <th style={{ width: "200px" }}>
                  Agent APM
                </th>

                <th>
                  Documentation
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  Go
                </td>

                <td>
                  Le réservoir n&apos;est actuellement pas configurable
                </td>
              </tr>

              <tr>
                <td>
                  Java
                </td>

                <td>
                  [Java configuration](/docs/apm/agents/java-agent/configuration/java-agent-configuration-config-file/#cfg-span-events-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  .NET
                </td>

                <td>
                  [Configuration .NET](/docs/apm/agents/net-agent/configuration/net-agent-configuration/#paragrp-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  Node.js
                </td>

                <td>
                  [Node.js configuration](/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#span-events-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  PHP
                </td>

                <td>
                  Le réservoir n&apos;est actuellement pas configurable
                </td>
              </tr>

              <tr>
                <td>
                  Python
                </td>

                <td>
                  [Configuration Python](/docs/apm/agents/python-agent/configuration/python-agent-configuration/#environment-variables) (Voir `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED`)
                </td>
              </tr>

              <tr>
                <td>
                  Ruby
                </td>

                <td>
                  [Ruby configuration](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#span_events-max_samples_stored)
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="otel-sample">
          <Callout variant="tip">
            Cette section s&apos;applique uniquement si vos services envoient des données à New Relic via un OpenTelemetry Collector. Cela est dû au fait que les données ne sont pas échantillonnées dans un OpenTelemetry Collector.
          </Callout>

          Pour OpenTelemetry, toutes les vues de services externes sont renseignées par une trace échantillonnée, ce qui signifie que vous ne verrez peut-être pas suffisamment de données utiles. Pour résoudre ce problème, vous pouvez modifier l’échantillonnage dans le Collector pour autoriser davantage de données dans New Relic.

          Voir [Échantillonnage](https://opentelemetry.io/docs/concepts/sampling/) pour plus d&apos;informations.
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>
</Steps>

## Quelle est la prochaine étape ? [#next]

* Découvrez comment utiliser des services externes pour [résoudre les problèmes d&apos;API](/docs/tutorial-external-services/respond-external)
* En savoir plus sur [la navigation dans l’ UIdes services externes](/docs/apm/apm-ui-pages/monitoring/external-services/external-services-ui).
* Si vous avez des questions sur la façon de comprendre l&apos;UI, consultez nos [conseils](/docs/apm/apm-ui-pages/monitoring/external-services/external-services-ui).