---
title: Exemples de workflow
tags:
  - workflow automation
  - workflow
  - automation
  - examples
metaDescription: 'Common workflow automation scenarios and examples for incident response, infrastructure management, and integrations.'
freshnessValidatedDate: never
translationType: machine
---

Cette page présente des scénarios d&apos;automatisation courants que vous pouvez créer avec l&apos;automatisation des workflows. Utilisez ces exemples comme points de départ pour votre propre workflow, ou explorez la [bibliothèque de modèles](/docs/workflow-automation/create-a-workflow-automation/use-a-template) pour trouver des solutions prêtes à être déployées.

## Réponse aux incidents et remédiation

### Restauration du gateway API

Rétablissez la configuration du Gateway API à un état antérieur afin de pouvoir corriger les erreurs et les mauvaises configurations.

**Ce que fait ce workflow :**

* Détecte les déploiements récents liés à un problème en utilisant New Relic suivi des changements
* Envoie une notification Slack avec des boutons d&apos;approbation (:+1: ou :-1:)
* Après approbation, un document AWS Systems Manager est créé pour automatiser la restauration.
* Rétablit la version précédente de l&apos;intégration API Gateway avec Lambda.
* Crée un nouveau déploiement pour appliquer la restauration.
* Envoie une notification de succès ou d&apos;échec à Slack
* Nettoie le document SSM après son achèvement

**Exigences:**

* Identifiants AWS avec autorisations pour API Gateway et système Manager
* Une application Slack configurée pour recevoir les notifications et les approbations
* monitoring de l&apos;entité New Relic avec suivi des changements

**Actions clés**: `newrelic.nerdgraph.execute`, `slack.chat.postMessage`, `slack.chat.getReactions`, `aws.systemsManager.writeDocument`, `aws.systemsManager.startAutomation`, `aws.systemsManager.waitForAutomationStatus`, `aws.systemsManager.deleteDocument`

### Gestion des instances EC2

Automatisez le provisionnement, la mise à l&apos;échelle et la suppression des instances EC2 pour des performances et des coûts optimaux.

**Ce que fait ce workflow :**

* Reçoit des alertes de forte utilisation du processeur de la part de New Relic
* Récupère les détails de l&apos;alerte et identifie l&apos; instanceEC2 concernée.
* Envoie notification Slack contenant les détails instance et requests l&apos;approbation pour le redimensionnement.
* Après approbation, un document SSM est créé pour automatiser le redimensionnement instance.
* Arrête l&apos; instance, modifie le type d&apos;instance et la redémarre.
* Envoie des mises à jour de progression à Slack pendant le processus de redimensionnement
* Attend la fin de l&apos;opération et envoie un statut de succès ou d&apos;échec
* Nettoie le document SSM et envoie la confirmation finale

**Exigences:**

* Identifiants AWS avec autorisations pour EC2 et système Manager
* Une condition d&apos;alerte New Relic active pour les métriques EC2
* Une application Slack configurée pour recevoir les notifications et les approbations

**Actions clés**: `newrelic.nerdgraph.execute`, `newrelic.nrdb.query`, `slack.chat.postMessage`, `slack.chat.getReactions`, `aws.systemsManager.writeDocument`, `aws.systemsManager.startAutomation`, `aws.systemsManager.waitForAutomationStatus`, `aws.systemsManager.deleteDocument`, `utils.datetime.fromEpoch`, `utils.uuid.generate`

### Restauration du déploiement

Annuler le déploiement si l&apos;entité devient défaillante et notifier par AWS SQS ou HTTP.

**Ce que fait ce workflow :**

* Monitorer la gravité des alertes d&apos;une entité pendant une durée spécifiée (30 minutes par défaut).
* Vérifie l&apos;état de l&apos;entité toutes les minutes
* Si l&apos;entité passe à l&apos;état CRITIQUE ou AVERTISSEMENT, consignez l&apos;état d&apos;anomalie.
* Envoie une notification de restauration via AWS SQS (si configuré) avec les détails de l&apos;entité.
* Envoie une notification de restauration via webhook HTTP (si configuré).
* Si l&apos;entité reste saine pendant toute la durée, consigner le succès
* monitoring s&apos;interrompt si l&apos;entité est introuvable.

**Exigences:**

* Entité New Relic avec monitoringde la gravité des alertes
* (Facultatif) File d&apos;attente AWS SQS et rôle pour recevoir les notifications de restauration
* (Facultatif) Point de terminaison HTTP pour recevoir notificationde restauration

**Actions clés**: `newrelic.nerdgraph.execute`, `newrelic.ingest.sendLogs`, `aws.execute.api` (sqs.send\_message), `http.post`

## traitement des données et reporting

### Envoyer un rapport à Slack

Envoyer le résultat d&apos;une requête NRQL sous forme de fichier CSV sur Slack.

**Ce que fait ce workflow :**

* Exécute une requête NRQL sur le(s) compte(s) New Relic spécifié(s).
* Génère un fichier CSV à partir des résultats de la requête
* Publie le fichier CSV sur un canal Slack spécifié avec un message

**Exigences:**

* Une authentification New Relic et une requête NRQL fonctionnelle
* Une application Slack configurée avec un jeton et un canal cible

**Actions clés**: `newrelic.nrdb.query`, `utils.transform.toCSV`, `slack.chat.postMessage`

### Analyse JSON

Analyse l&apos;API d&apos;état public JSON (HTTP) de New Relic et enregistre éventuellement les composants opérationnels et non opérationnels.

**Ce que fait ce workflow :**

* Récupère des données JSON à partir de l&apos;API d&apos;état de New Relic
* Extrait et catégorise les composants selon leur état opérationnel
* Enregistrement conditionnel des composants opérationnels (si activée)
* Enregistrement conditionnel des composants non opérationnels (si activée)
* Gère les erreurs HTTP et consigne les messages d&apos;erreur.

**Exigences:**

* Accès à l&apos;API d&apos;état de New Relic (summary.json)
* Autorisations pour envoyer des logs via newrelic.ingest.sendLogs

**Actions clés**: `http.get`, `newrelic.ingest.sendLogs`

## Modèle de workflow disponible

Les modèles énumérés ci-dessus sont disponibles directement dans l&apos;interface utilisateur d&apos;automatisation des workflows de New Relic. Pour y accéder :

1. Accédez à **[one.newrelic.com](https://one.newrelic.com) &gt; All Capabilities &gt; Workflow Automation**
2. Cliquez sur **Create workflow**
3. Sélectionnez **Use a template**
4. Parcourez la bibliothèque de modèles et choisissez un workflow qui correspond à votre cas d&apos;utilisation.

Chaque modèle comprend :

* Étapes et logique workflow préconfigurées
* Exemple de paramètres d&apos;entrée
* Identifiants et intégration requis
* Documentation des résultats attendus

Vous pouvez utiliser les modèles tels quels ou les personnaliser pour les adapter à vos besoins spécifiques.

## Transmission de données entre les étapes

Tous les workflows peuvent faire référence aux résultats des étapes précédentes en utilisant la syntaxe de modèle. Cela vous permet d&apos;enchaîner des actions et de construire une logique d&apos;automatisation complexe.

### Transmission de données de base

Cet exemple de requête signale les problèmes d&apos;alerte de New Relic et envoie une notification à Slack pour chaque problème actif.

```yaml
name: alertSlack
description: "query Alert Issues and send notifications to Slack"

workflowInputs:
  accountId:
    type: Int

steps:
  - name: getAlert
    type: action
    action: newrelic.nerdgraph.execute
    version: 1
    inputs:
      graphql: |
        query GetAlertIssues($accountId: Int!) {
          actor {
            account(id: $accountId) {
              aiIssues {
                issues(filter: {states: ACTIVATED}) {
                  issues {
                    issueId
                    priority
                    state
                    title
                  }
                }
              }
            }
          }
        }
      variables:
        accountId: ${{ .workflowInputs.accountId }}

  - name: loopStep
    type: loop
    for:
      in: ${{ .steps.getAlert.outputs.data.actor.account.aiIssues.issues.issues }}
      steps:
        - name: sendToSlack
          type: action
          action: slack.chat.postMessage
          version: 1
          inputs:
            token: ${{ :secrets:your_slack_token }}
            channel: incident-channel
            text: >
              issueId: ${{ .steps.loopStep.loop.element.issueId }}
              priority: ${{ .steps.loopStep.loop.element.priority }}
              state: ${{ .steps.loopStep.loop.element.state }}
              title: ${{ .steps.loopStep.loop.element.title | tostring }}
```

### Utilisation des données dans les boucles

```yaml
steps:
  - name: listInstances
    type: action
    action: aws.ec2.describeInstances
    version: 1
    inputs:
      filters:
        - name: "tag:Environment"
          values: ["production"]

  - name: checkEachInstance
    type: loop
    for:
      in: "${{ .steps.listInstances.outputs.reservations }}"
      steps:
        - name: getInstanceMetrics
          type: action
          action: newrelic.nerdgraph.execute
          version: 1
          inputs:
            query: "SELECT average(cpuPercent) FROM SystemSample WHERE instanceId = '${{ .steps.checkEachInstance.loop.element.instanceId }}'"
```

### Logique conditionnelle avec données

```yaml
steps:
  - name: checkCPU
    type: action
    action: newrelic.nerdgraph.execute
    version: 1
    # ... query configuration

  - name: decideAction
    type: switch
    switch:
      - condition: "${{ .steps.checkCPU.outputs.data.actor.account.nrql.results[0].average > 90 }}"
        next: resizeInstance
      - condition: "${{ .steps.checkCPU.outputs.data.actor.account.nrql.results[0].average > 70 }}"
        next: sendWarning
    next: normalOperation

  - name: resizeInstance
    type: action
    action: aws.ec2.modifyInstanceAttribute
    version: 1
    # ... resize configuration

  - name: sendWarning
    type: action
    action: slack.chat.postMessage
    version: 1
    # ... warning message

  - name: normalOperation
    type: action
    action: newrelic.ingest.sendLogs
    version: 1
    # ... log normal status
```

## Et ensuite ?

* **[Dépannage](/docs/workflow-automation/troubleshooting)** : Correction des erreurs d&apos;identification, des problèmes d&apos;intégration et des échecs workflow.
* **[Bonnes pratiques](/docs/workflow-automation/limitations-and-faq/workflow-best-practices)**: Gestion des erreurs, optimisation des performances, stratégies de tests.
* **[Limites du workflow](/docs/workflow-automation/limitations-and-faq/workflow-limits)** : Comprendre les délais d’expiration, les limites de débit et les contraintes.