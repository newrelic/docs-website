---
title: Actions AWS Systems Manager
tags:
  - workflow automation
  - workflow
  - workflow automation actions
  - AWS actions
  - AWS Systems Manager actions
metaDescription: A list of available aws systems manager actions in the actions catalog for workflow definitions
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Cette page fournit une référence complète des actions AWS Systems Manager disponibles dans le catalogue des actions d&apos;automatisation des workflows. Ces actions vous permettent d&apos;automatiser Systems Manager et d&apos;effectuer des opérations de documents.

## Prérequis

Avant d&apos;utiliser AWS Actions dans l&apos;automatisation workflow, assurez-vous de disposer des éléments suivants :

* Un compte AWS disposant des autorisations appropriées.
* Informations d&apos;identification AWS configurées (informations d&apos;identification de l&apos;utilisateur IAM, ARN du rôle IAM ou informations d&apos;identification de session).
* Les autorisations IAM nécessaires pour les services AWS spécifiques que vous prévoyez d&apos;utiliser.

Consultez [la section Configurer les informations d&apos;identification AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/) pour savoir comment créer un utilisateur IAM et des rôles IAM, et comment configurer les informations d&apos;identification AWS statiques et de session pour l&apos;intégration avec les actions AWS d&apos;automatisation workflow.

<CollapserGroup>
  <Collapser id="aws-systemsmanager.writedocument" title="Écrire un document SSM vers AWS">
    Écrivez un document SSM sur le compte AWS en fonction des informations d&apos;identification AWS transmises dans l&apos;entrée d&apos;action. Consultez la [Documentation AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="writedocumentinputs">
          Entrées
        </TabsBarItem>

        <TabsBarItem id="writedocumentoutputs">
          Sorties
        </TabsBarItem>

        <TabsBarItem id="writedocumentexample">
          Exemple
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="writedocumentinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de saisie
                </th>

                <th>
                  optionnalité
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **région**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentType: "Command"`

                  Vérifiez les valeurs valides à partir de [ici](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **documentFormat**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentFormat: "YAML"`

                  Vérifiez les valeurs valides à partir de [ici](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **documentContent**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  Voir l&apos;exemple
                </td>
              </tr>

              <tr>
                <td>
                  **override**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Booléen
                </td>

                <td>
                  `override: true (default)`.

                  Lorsque `true`, écrivez toujours le document avec le nom fourni, même s&apos;il en existe déjà un.

                  Lorsque `false`, si un document avec le `documentName` fourni existe déjà, l&apos;action renvoie `success: false` et `errorMessage: Document already exists. Please enable override if you want to update the existing document.`
                </td>
              </tr>

              <tr>
                <td>
                  **sélecteurs**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  liste
                </td>

                <td>
                  `[{\"name\": \"documentName\", \"expression\": \".documentName\"}, {\"name\": \"documentType\", \"expression\": \".documentType\"}, {\"name\": \"documentStatus\", \"expression\": \".documentStatus\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="writedocumentoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de sortie
                </th>

                <th>
                  Type
                </th>

                <th>
                  Description et exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentVersion**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentVersion: 1`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentType: "Command"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentStatus**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentStatus: "Active"`

                  La valeur sera l&apos;un des statuts de [ici](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **succès**
                </td>

                <td>
                  Booléen
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **message d&apos;erreur**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Dans l&apos;entrée d&apos;action, seuls `awsAccessKeyId` et `awsSecretAccessKey` peuvent être fournis, mais il doit s&apos;agir d&apos;informations d&apos;identification statiques d&apos;un utilisateur IAM.
            * Si des informations d&apos;identification de session doivent être utilisées, `awsAccessKeyId`, `awsSecretAccessKey` et `awsSessionToken` doivent être transmises à l&apos;entrée d&apos;action.
            * Les sélecteurs permettant d&apos;obtenir uniquement les paramètres spécifiés en sortie.
            * Reportez-vous à [Informations d&apos;identification AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials) pour obtenir des instructions.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="writedocumentexample">
          **Exemple 1**: Un simple document SSM pour répertorier toutes les fonctions lambda

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **Définition complète des flux automatiques avec les fonctions lambda de la liste SSM**

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```

          **Exemple 2 : Exécuter un script Python**

          <Collapser id="execute.python.script" title="Exécuter un script Python">
            En utilisant l&apos;automatisation et l&apos;action de document AWS `SystemsManager`, nous pouvons définir une définition de workflow qui exécute un script python.

            Voici un bref exemple illustrant une simple application Hello World.

            <Collapser id="system.manager.document" title="Document SystemsManager">
              ```yaml
              schemaVersion: '0.3'
              description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
              parameters:
                Username:
                  type: String
                  description: "The username to greet."
                  default: "User"
              mainSteps:
                - action: aws:executeScript
                  name: pythonStep
                  inputs:
                    Runtime: python3.8
                    Handler: script_handler
                    Script: |
                      def script_handler(event, context):
                          username = event['username']
                          return f'Hello {username}'
                    InputPayload:
                      username: "{{ Username }}"
                  outputs:
                    - Name: scriptOutput
                      Type: String
                      Selector: $.Payload
              outputs:
                - pythonStep.scriptOutput
              ```

              Ceci peut ensuite être utilisé dans le workflow ci-dessous :

              <Collapser id="workflow.definition.1" title="définition du flux de travail">
                ```yaml
                name: aws-python-script

                workflowInputs:
                  key:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
                  access:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
                  token:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
                  region:
                    type: String
                    defaultValue: us-west-2
                  name:
                    type: String
                    defaultValue: ExecuteHelloPythonScript
                  username:
                    type: String
                    defaultValue: World!

                steps:
                  - name: generateIdempotencyToken
                    type: action
                    action: utils.uuid.generate
                    version: 1

                  - name: createSsmDocument
                    type: action
                    action: aws.systemsManager.writeDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .workflowInputs.name }}
                      documentContent: |
                        schemaVersion: '0.3'
                        description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
                        parameters:
                          Username:
                            type: String
                            description: "The username to greet."
                            default: "User"
                        mainSteps:
                          - action: aws:executeScript
                            name: pythonStep
                            inputs:
                              Runtime: python3.8
                              Handler: script_handler
                              Script: |
                                def script_handler(event, context):
                                    username = event['username']
                                    return f'Hello {username}'
                              InputPayload:
                                username: "{{ Username }}"
                            outputs:
                              - Name: scriptOutput
                                Type: String
                                Selector: $.Payload
                        outputs:
                          - pythonStep.scriptOutput

                  - name: start1
                    type: action
                    action: aws.systemsManager.startAutomation
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}
                      parameters:
                        Username: ${{ .workflowInputs.username }}

                  - name: waitForCompletion
                    type: action
                    action: aws.systemsManager.waitForAutomationStatus
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                      # Optional, default is Success and Failed
                      automationExecutionStatuses:
                        - "Success"
                        - "Failed"
                      timeout: 300

                  - name: hasCompleted
                    type: switch
                    switch:
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                        next: displayError
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                        next: displaySuccess
                    next: displayUnexpected

                  - name: displayUnexpected
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
                    next: cleanupSsmDocument

                  - name: displaySuccess
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "This is the results of the automation that was run on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.pythonStep.scriptOutput | tojson }}"
                    next: cleanupSsmDocument

                  - name: displayError
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs | tojson }}"
                    next: cleanupSsmDocument

                  - name: cleanupSsmDocument
                    type: action
                    action: aws.systemsManager.deleteDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
                ```

                Ceci peut être démarré avec la mutation NerdGraph suivante, en supposant que les secrets temporaires AWS ont été précédemment stockés avec les mutations `secretsManagementCreateSecretNerdGraph`.

                ```yaml
                mutation { 
                    autoflowsStartWorkflowRun(accountId: 11933347,
                    definition: {
                        name: "aws-python-script",
                    }, workflowInputs: [
                        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
                        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
                        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
                        {key: "region" value:"us-west-2"}
                        {key: "username" value: "Julien"}
                    ]) 
                    { runId }
                } 
                ```

                L&apos;exécution de la mutation ci-dessus renvoie un runId, par exemple `207e8c23-2c89-4af2-a74f-3c9ea2ffd543`. Ce runId peut ensuite être utilisé pour interroger les logs et voir la sortie suivante :

                <img title="Image of a python script execution output" alt="Image of a python script execution output" src="/images/python-script.webp" />
              </Collapser>
            </Collapser>
          </Collapser>

          **Exemple 3 : Un document SSM plus complexe**

          <Collapser id="example3.complex.document" title="Exemple de document SSM complexe">
            **Document SSM effectuant un retour arrière de l&apos;API Gateway :**

            1. Obtenir la liste des API REST du gateway API. Filtrer mon API (`Test API`) et obtenir l&apos;ID de l&apos;API REST.
            2. Obtenez la liste de toutes les ressources à l&apos;intérieur de mon API (`Test API`). Filtrez ma ressource spécifique en fonction de pathPart(`/test`) et obtenez l&apos;ID de la ressource
            3. Obtenez la liste des versions de ma fonction lambda (`ApiGwTestFn`). Filtrez la version spécifique vers laquelle je souhaite revenir (version : 1) et obtenez le functionArn de cette version.
            4. Mettre à jour l&apos;intégration du gateway API avec la fonction lambdaArn acquise à l&apos;étape ci-dessus.
            5. Créer un nouveau déploiement pour mon API REST (`Test API`).

            ```yaml
            schemaVersion: '0.3'
            description: Test SSM for API gateway rollback
            mainSteps:
              - name: ExecuteAwsApi
                action: aws:executeAwsApi
                nextStep: ExecuteGetApiResources
                inputs:
                  Service: apigateway
                  Api: GetRestApis
                outputs:
                  - Name: resultApiId
                    Selector: $.items[?(@.name=='Test API')].id
                    Type: String
              - name: ExecuteGetApiResources
                action: aws:executeAwsApi
                nextStep: ExecuteListVersionsByFunction
                inputs:
                  Service: apigateway
                  Api: GetResources
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
                outputs:
                  - Name: resultResourceId
                    Selector: $.items[?(@.pathPart=='test')].id
                    Type: String
              - name: ExecuteListVersionsByFunction
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwUpdateIntg
                inputs:
                  Service: lambda
                  Api: ListVersionsByFunction
                  FunctionName: ApiGwTestFn
                outputs:
                  - Name: resultLambdaVersionArn
                    Selector: $.Versions[?(@.Version=='1')].FunctionArn
                    Type: String
              - name: ExecuteApiGwUpdateIntg
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwCreateDeployment
                inputs:
                  Service: apigateway
                  Api: UpdateIntegration
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
                  resourceId: '\{{ ExecuteGetApiResources.resultResourceId }}'
                  httpMethod: GET
                  patchOperations:
                    - op: replace
                      path: /uri
                      value: arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/\{{ ExecuteListVersionsByFunction.resultLambdaVersionArn }}/invocations
              - name: ExecuteApiGwCreateDeployment
                action: aws:executeAwsApi
                inputs:
                  Service: apigateway
                  Api: CreateDeployment
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
            outputs:
              - ExecuteGetApiResources.resultResourceId
              - ExecuteListVersionsByFunction.resultLambdaVersionArn
            ```

            Les exemples de sorties SSM `ExecuteGetApiResources.resultResourceId` et `ExecuteListVersionsByFunction.resultLambdaVersionArn`. Ces sorties peuvent être utilisées dans d&apos;autres étapes de la définition du workflow.
          </Collapser>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.deletedocument" title="Supprimer un document AWS SSM">
    Cette action permet de supprimer un document AWS SSM dans le compte AWS en fonction des identifiants passés dans l&apos;entrée d&apos;action. Voir [Documentation AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="systemsmanagerinputs">
          Entrées
        </TabsBarItem>

        <TabsBarItem id="systemsmanageroutputs">
          Sorties
        </TabsBarItem>

        <TabsBarItem id="systemsmanagerexample">
          Exemple
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="systemsmanagerinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de saisie
                </th>

                <th>
                  optionnalité
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **région**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **sélecteurs**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  List
                </td>

                <td>
                  `[{\"name\": \"success\", \"expression\": \".success\"}, {\"name\": \"documentName\", \"expression\": \".documentName\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="systemsmanageroutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de sortie
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **succès**
                </td>

                <td>
                  Booléen
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **message d&apos;erreur**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Dans l&apos;entrée d&apos;action, seuls `awsAccessKeyId` et `awsSecretAccessKey` peuvent être fournis, mais il doit s&apos;agir d&apos;informations d&apos;identification statiques d&apos;un utilisateur IAM.
            * Si des informations d&apos;identification de session doivent être utilisées, `awsAccessKeyId`, `awsSecretAccessKey` et `awsSessionToken` doivent être transmises à l&apos;entrée d&apos;action.
            * Les sélecteurs permettant d&apos;obtenir uniquement les paramètres spécifiés en sortie.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="systemsmanagerexample">
          Un document SSM simple pour répertorier toutes les fonctions lambda

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **La définition complète du workflow avec SSM**:

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.startautomation" title="Démarrer l'automatisation avec le document SSM">
    Démarre une automatisation à l&apos;aide d&apos;un document AWS SSM. Consultez [Documentation AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartAutomationExecution.html)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="startautomationinputs">
          Entrées
        </TabsBarItem>

        <TabsBarItem id="startautomationoutputs">
          Sorties
        </TabsBarItem>

        <TabsBarItem id="startautomationexample">
          Exemple
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="startautomationinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de saisie
                </th>

                <th>
                  optionnalité
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **région**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **paramètres**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Carte
                </td>

                <td>
                  ```yaml
                  parameters:
                        myKey: myValue
                  ```
                </td>
              </tr>

              <tr>
                <td>
                  **idempotencyToken**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  UUID
                </td>

                <td>
                  `idempotencyToken: "any token"`

                  Ceci sera transmis en tant que jeton client pour l&apos;idempotence afin de démarrer l&apos;automatisation AWS SSM.
                </td>
              </tr>

              <tr>
                <td>
                  **sélecteurs**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  List
                </td>

                <td>
                  `[{\"name\": \"automationExecutionId\", \"expression\": \".automationExecutionId\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="startautomationoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de sortie
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **succès**
                </td>

                <td>
                  Booléen
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **message d&apos;erreur**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Dans l&apos;entrée d&apos;action, si `awsAccessKeyId` et `awsSecretAccessKey` doivent être fournis, assurez-vous qu&apos;il s&apos;agit d&apos;informations d&apos;identification statiques d&apos;un utilisateur IAM.
            * Si des informations d&apos;identification de session doivent être utilisées, `awsAccessKeyId`, `awsSecretAccessKey` et `awsSessionToken` doivent être transmises à l&apos;entrée d&apos;action.
            * Reportez-vous à [Informations d&apos;identification AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/) pour obtenir des instructions.
            * Utilisez des sélecteurs pour obtenir uniquement les paramètres spécifiés en sortie.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="startautomationexample">
          <table>
            <thead>
              <tr>
                <th>
                  définition du flux de travail
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.waitforautomationstatus" title="Attendez l'état de l'automatisation">
    En attente d&apos;une automatisation utilisant un document AWS. Consultez [la documentation AWS système Manager](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway) pour plus d&apos;informations.

    <Tabs>
      <TabsBar>
        <TabsBarItem id="automationstatusinputs">
          Entrées
        </TabsBarItem>

        <TabsBarItem id="automationstatusoutputs">
          Sorties
        </TabsBarItem>

        <TabsBarItem id="automationstatusexample">
          Exemple
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="automationstatusinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de saisie
                </th>

                <th>
                  optionnalité
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **région**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Requis
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`

                  . L&apos;automatisation 

                  `executionId`

                   pour laquelle nous devons attendre son achèvement.
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatuses**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  List
                </td>

                <td>
                  `automationExecutionStatuses: ["status1", "status2"]`

                  Liste des statuts d&apos;exécution de l&apos;automatisation à partir de [AutomationExecution](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_AutomationExecution.html#AutomationExecutionStatus) qui peuvent arrêter l&apos;attente.

                  Défaut: `["Success", "Failed"]`
                </td>
              </tr>

              <tr>
                <td>
                  **temps mort**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  int
                </td>

                <td>
                  `timeout: 180`(par défaut), maximum 600.

                  La durée en secondes pendant laquelle nous pouvons attendre que l&apos;état de l&apos;automatisation soit l&apos;un des `automationExecutionStatuses` attendus.

                  Si le délai d&apos;attente est dépassé, la sortie contient `success: false` et `errorMessag: Timeout waiting for automation status`.
                </td>
              </tr>

              <tr>
                <td>
                  **sélecteurs**
                </td>

                <td>
                  Facultatif
                </td>

                <td>
                  List
                </td>

                <td>
                  `[{\"name\": \"automationExecutionStatus\", \"expression\": \".automationExecutionStatus\"}, {\"name\": \"scriptOutput\", \"expression\": \".automationExecutionOutputs.pythonStep.scriptOutput | tojson\"}]`

                  .
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="automationstatusoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Champ de sortie
                </th>

                <th>
                  Type
                </th>

                <th>
                  Exemple
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatus**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `automationExecutionStatus: "Success"`

                  Si l&apos;action réussit, elle prendra l&apos;une des valeurs transmises dans le champ de saisie `automationExecutionStatuses`.

                  Sinon, ce sera nul.
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionOutputs**
                </td>

                <td>
                  Carte
                </td>

                <td>
                  ```yaml
                  "automationExecutionOutputs": {
                        "ExecuteGetApiResources": {
                          "resultResourceId": [
                            "pky3cb"
                          ]
                        },
                        "ExecuteListVersionsByFunction": {
                          "resultLambdaVersionArn": [
                            "arn:aws:lambda:us-east-2:661945836867:function:ApiGwTestFn:1"
                          ]
                        }
                  } 
                  ```

                  Le résultat sera une carte des valeurs de sortie du document. Toute donnée de sortie du document peut être collectée à l&apos;aide de ce champ de sortie et utilisée dans les étapes suivantes de la définition de l&apos;automatisation workflow.
                </td>
              </tr>

              <tr>
                <td>
                  **succès**
                </td>

                <td>
                  Booléen
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **message d&apos;erreur**
                </td>

                <td>
                  Chaîne
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            1. Dans l&apos;entrée d&apos;action, seuls `awsAccessKeyId` et `awsSecretAccessKey` peuvent être fournis, mais il doit s&apos;agir d&apos;informations d&apos;identification statiques d&apos;un utilisateur IAM.
            2. Si des informations d&apos;identification de session doivent être utilisées, `awsAccessKeyId`, `awsSecretAccessKey` et `awsSessionToken` doivent être transmises à l&apos;entrée d&apos;action.
            3. Consultez les instructions pour configurer [les identifiants AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials).
            4. Utilisez des sélecteurs pour obtenir uniquement les paramètres spécifiés en sortie.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="automationstatusexample">
          <table>
            <thead>
              <tr>
                <th>
                  définition du flux de travail
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>