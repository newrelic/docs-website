---
title: Configurer les identifiants AWS
metaDescription: 'Configure AWS credentials for workflow automation using IAM roles, IAM users, or temporary session tokens.'
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Autorisez l&apos;automatisation workflow New Relic à effectuer des actions dans votre compte AWS. Vous configurerez une méthode d&apos;authentification permettant au workflow d&apos;interagir en toute sécurité avec les services AWS tels que EC2, SQS, DynamoDB et bien plus encore, sans intégrer en dur les informations d&apos;identification ni compromettre la sécurité.

## Prérequis

Avant de configurer vos identifiants AWS, assurez-vous d&apos;avoir :

* Un compte AWS disposant de l&apos;autorisation de créer des rôles IAM ou des utilisateurs.
* Votre [identifiant de compte New Relic](/docs/accounts/accounts-billing/account-structure/account-id).
* Accès administrateur à la [console AWS IAM](https://console.aws.amazon.com/iam/).

## Comprendre les autorisations requises [#required-permissions]

Avant de créer des identifiants, assurez-vous de bien comprendre les autorisations nécessaires à votre workflow. N’accordez que les autorisations réellement utilisées par votre workflow – cela respecte le principe du moindre privilège et minimise les risques de sécurité.

### Autorisations workflow communes

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        **Type de workflow**
      </th>

      <th>
        **Autorisations AWS requises**
      </th>

      <th>
        **Description**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **Gestion EC2**
      </td>

      <td>
        `ec2:DescribeInstances`<br />`ec2:StopInstances`<br />`ec2:StartInstances`<br />`ec2:ModifyInstanceAttribute`
      </td>

      <td>
        Arrêter, démarrer ou modifier les instances EC2 en réponse aux alertes
      </td>
    </tr>

    <tr>
      <td>
        **Messagerie SQS**
      </td>

      <td>
        `sqs:SendMessage`<br />`sqs:GetQueueAttributes`
      </td>

      <td>
        Envoyer des messages aux files d&apos;attente SQS pour traitement en aval
      </td>
    </tr>

    <tr>
      <td>
        **Passerelle API**
      </td>

      <td>
        `apigateway:GET`<br />`apigateway:PUT`
      </td>

      <td>
        Rétablir le déploiement ou la configuration du Gateway API
      </td>
    </tr>

    <tr>
      <td>
        **Gestionnaire de systèmes**
      </td>

      <td>
        `ssm:CreateDocument`<br />`ssm:DeleteDocument`<br />`ssm:StartAutomationExecution`<br />`ssm:GetAutomationExecution`
      </td>

      <td>
        Exécuter les manuels d&apos;exécution automatisés
      </td>
    </tr>

    <tr>
      <td>
        **DynamoDB**
      </td>

      <td>
        `dynamodb:Query`<br />`dynamodb:GetItem`<br />`dynamodb:PutItem`
      </td>

      <td>
        Lire ou écrire dans des tables DynamoDB
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Commencez par des permissions de lecture seule (`Describe*`, `Get*`, `List*`), puis ajoutez des permissions d&apos;écriture (`Put*`, `Create*`, `Delete*`) uniquement lorsque cela est nécessaire. Cela permet d&apos;éviter les actions destructives accidentelles lors des tests.
</Callout>

Consultez [les exemples de politiques](#policy-examples) ci-dessous pour obtenir des modèles de politiques IAM complets.

## Configurer l&apos;authentification

Choisissez la méthode qui correspond à votre cas d&apos;utilisation dans le tableau ci-dessus :

<Tabs>
  <TabsBar>
    <TabsBarItem id="iam-role-1">Rôle IAM (recommandé)</TabsBarItem> <TabsBarItem id="iam-user-1">Utilisateur IAM avec clés d&apos;accès</TabsBarItem> <TabsBarItem id="session-tokens-1">Session jeton</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="iam-role-1">
      Un rôle IAM permet à New Relic d&apos;utiliser des informations d&apos;identification temporaires dans votre compte AWS sans nécessiter de clés d&apos;accès permanentes.

      ### Caractéristiques du rôle IAM :

      * Les identifiants sont renouvelés automatiquement.
      * L&apos;accès est limité dans le temps par conception.
      * Toutes les actions sont enregistrées dans AWS CloudTrail
      * Conforme aux bonnes pratiques de sécurité AWS

      ### Créez le rôle dans AWS

      1. Connectez-vous à la [console AWS IAM](https://console.aws.amazon.com/iam/)

      2. Accédez à **Roles &gt; Create role &gt; Trusted entity type** et sélectionnez **AWS account &gt; another AWS account**

      3. Dans le champ **Account ID**, saisissez : `253490767857`

      4. Dans **Options**, cochez la case **Require external ID.**

      5. Dans le champ **External ID**, saisissez l&apos;ID de votre compte New Relic et cliquez sur **Next**.
         * Vous ne l&apos;avez pas ? [Trouvez votre identifiant de compte ici](/docs/accounts/accounts-billing/account-structure/account-id)

      6. Sur la page **Add permissions**, associez des stratégies en fonction de votre workflow :

         * Pour le workflow EC2 : Attachez `AmazonEC2ReadOnlyAccess` ou créez une stratégie personnalisée
         * Pour le workflow SQS : Attachez `AmazonSQSFullAccess` ou limitez-le à des files d’attente spécifiques.
         * Pour les autres services : consultez [la section Autorisations AWS requises](#required-aws-permissions)

      7. Cliquez sur **Next**.

      8. Saisissez un nom de rôle : `NewRelicWorkflowAutomationRole` (ou le nom de votre choix)

      9. Ajoutez éventuellement une description : « Permet à l’automatisation de workflows de New Relic d’effectuer des actions dans AWS », puis cliquez sur **Create role**.

      ### Vérifiez la politique de fiducie

      Après avoir créé le rôle, vérifiez la relation de confiance :

      1. Dans la console IAM, sélectionnez le rôle que vous venez de créer.
      2. Cliquez sur l&apos;onglet **Trust relationships**
      3. Veuillez vérifier que la politique correspond à cette structure (remplacez `<YOUR_NR_ACCOUNT_ID>` par votre identifiant de compte réel) :

      ```json
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Action": "sts:AssumeRole",
                  "Principal": {
                      "AWS": "arn:aws:iam::253490767857:root"
                  },
                  "Condition": {
                      "StringEquals": {
                          "sts:ExternalId": "<YOUR_NR_ACCOUNT_ID>"
                      }
                  }
              }
          ]
      }
      ```

      ### Copiez votre ARN de rôle

      Vous aurez besoin de l&apos;ARN du rôle pour configurer le workflow :

      1. Dans la console IAM, sélectionnez votre rôle
      2. Dans la section **Summary**, repérez le champ **ARN**
      3. Copiez l&apos;ARN complet ; il ressemble à ceci : `arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole`
      4. Enregistrez cet ARN en lieu sûr ; vous le collerez directement dans la configuration workflow.

      <Callout variant="tip">
        **Important :** Les ARN des rôles doivent être directement intégrés aux entrées workflow ; ne les stockez pas dans le gestionnaire de secrets. Ce ne sont pas des identifiants sensibles ; ce sont des identifiants de ressource.
      </Callout>

      Le rôle est maintenant configuré. Utilisez l&apos;ARN dans la configuration workflow qui nécessite un accès AWS.
    </TabsPageItem>

    <TabsPageItem id="iam-user-1">
      Utilisez cette méthode pour les environnements de test ou lorsque les rôles IAM ne sont pas pris en charge. Les clés d&apos;accès sont des identifiants à longue durée de vie qui nécessitent une rotation manuelle.

      **Cas d&apos;utilisation :**

      * Environnements de test et de développement
      * Configurations AWS ne prenant pas en charge l&apos;attribution de rôles entre comptes
      * Flux d&apos;authentification simplifié

      <Callout variant="caution">
        Les clés d&apos;accès sont des identifiants à longue durée de vie. Faites-les tourner régulièrement (tous les 90 jours) et limitez les autorisations à ce dont votre workflow a besoin.
      </Callout>

      ### Créer l&apos;utilisateur IAM

      1. Connectez-vous à la [console AWS IAM](https://console.aws.amazon.com/iam/)

      2. Accédez à **Users &gt; Create user** et saisissez un nom d&apos;utilisateur : `workflow-automation-user` (ou le nom de votre choix)

      3. Cliquez sur **Next**

      4. Sur la page **Set permissions**, choisissez **Attach policies directly**

      5. Recherchez et sélectionnez les politiques en fonction de votre workflow :

         * Pour SQS : Sélectionnez `AmazonSQSFullAccess`
         * Pour EC2 : sélectionnez `AmazonEC2ReadOnlyAccess`
         * Ou créez une politique personnalisée avec des autorisations limitées (recommandé).

      6. Cliquez sur **Next**, puis sur **Create user**

      ### Générer des clés d&apos;accès

      1. Dans la liste des utilisateurs, sélectionnez votre utilisateur nouvellement créé.

      2. Cliquez sur l&apos;onglet **Security credentials**

      3. Dans la section **Access keys**, choisissez **Create access key**

      4. Sélectionnez **Application running outside AWS** et cliquez sur **Next**.

      5. (Facultatif) Ajouter une tag de description : « Automatisation workflow New Relic »

      6. Choisissez **Create access key**

      7. Copiez immédiatement les deux identifiants :

         * **Identifiant de la clé d&apos;accès** (commence par `AKIA...`)
         * **Clé d&apos;accès secrète** (affichée une seule fois)

      <Callout variant="important">
        AWS n&apos;affiche la clé d&apos;accès secrète qu&apos;une seule fois, lors de la création. Si vous ne l&apos;enregistrez pas, vous devrez générer une nouvelle paire de clés.
      </Callout>

      ### Stockez vos identifiants en toute sécurité

      Ne jamais intégrer en dur les identifiants AWS dans un workflow. Stockez-les plutôt dans [le gestionnaire de secrets](/docs/infrastructure/host-integrations/installation/secrets-management/) de New Relic.

      1. Ouvrez l&apos; [explorateur GraphiQL de NerdGraph](https://one.newrelic.com/nerdgraph-graphiql)
      2. Exécutez cette mutation pour enregistrer votre ID de clé d&apos;accès (remplacez les valeurs d&apos;espace réservé) :

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsAccessKeyId"
          description: "AWS Access Key ID for workflow automation"
          value: "YOUR_AWS_ACCESS_KEY_ID"
        ) {
          key
        }
      }
      ```

      3. Exécutez une autre mutation pour votre clé d&apos;accès secrète :

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsSecretAccessKey"
          description: "AWS Secret Access Key for workflow automation"
          value: "YOUR_AWS_SECRET_ACCESS_KEY"
        ) {
          key
        }
      }
      ```

      **Référencez ces secrets dans votre workflow** en utilisant la syntaxe suivante : `${{ :secrets:awsAccessKeyId }}`

      <Callout variant="tip">
        Utilisez le champ `namespace` pour organiser les secrets par environnement (`aws-prod`, `aws-staging`) ou par nom d&apos;équipe.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="session-tokens-1">
      Session Jeton fournit des identifiants temporaires avec expiration automatique.

      **Cas d&apos;utilisation :**

      * Développement et tests locaux
      * pipeline CI/CD nécessitant une rotation des identifiants
      * Environnements soumis à des exigences de conformité en matière d&apos;accès limité dans le temps (généralement de 1 à 12 heures)

      ### Prérequis

      * [AWS CLI installé et configuré](https://aws.amazon.com/cli/)
      * Un rôle IAM existant que vous pouvez assumer

      ### Générer des identifiants temporaires

      1. Ouvrez votre terminal et exécutez cette commande (remplacez par l&apos;ARN de votre rôle) :

      ```bash
      aws sts assume-role \
        --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/YOUR_ROLE" \
        --role-session-name "WorkflowAutomationSession"
      ```

      Si vous utilisez AWS CLI pour la première fois, vous devrez peut-être la configurer avec `aws configure` et saisir vos informations d&apos;identification :

      <img title="Image of the Static Access credentials" alt="Image of the Static Access credentials" src="/images/static-access.webp" />

      2. AWS renvoie trois valeurs ; vous avez besoin des trois :

      ```json
      {
        "Credentials": {
            "AccessKeyId": "ASIAIOSFODNN7EXAMPLE",
            "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
            "SessionToken": "FQoGZXIvYXdzEBk...",
            "Expiration": "2025-01-25T12:00:00Z"
        }
      }
      ```

      3. Stockez les trois identifiants dans le gestionnaire de secrets :

      * `AccessKeyId` stocker comme `awsAccessKeyId`
      * `SecretAccessKey` stocker comme `awsSecretAccessKey`
      * `SessionToken` stocker comme `awsSessionToken`

      <Callout variant="caution">
        La session expire (généralement après 1 heure). Programmez un rappel pour les actualiser avant l&apos;horodatage `Expiration`, sinon votre workflow échouera avec des erreurs d&apos;authentification.
      </Callout>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Utiliser les informations d&apos;identification dans le workflow [#use-credentials]

Après avoir configuré l&apos;authentification, indiquez vos informations d&apos;identification dans la configuration workflow :

### Rôle IAM (recommandé)

Collez directement l&apos;ARN du rôle dans les entrées workflow ; aucun gestionnaire de secrets n&apos;est nécessaire :

```yaml
awsRoleArn: arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole
```

<Callout variant="tip">
  Les ARN de rôle sont des identifiants de ressource, et non des informations d&apos;identification sensibles. Ne les stockez pas dans le gestionnaire de secrets ; collez-les directement dans la configuration workflow.
</Callout>

### IAM utilisateur ou session jeton

Gestionnaire de secrets de référence pour les clés d&apos;accès :

```yaml
awsAccessKeyId: ${{ :secrets:awsAccessKeyId }}
awsSecretAccessKey: ${{ :secrets:awsSecretAccessKey }}
awsSessionToken: ${{ :secrets:awsSessionToken }}  # Only for session tokens
```

New Relic récupère les secrets lors de l&apos;exécution, s&apos;authentifie auprès d&apos;AWS, puis les supprime. Vos identifiants n&apos;apparaissent jamais dans les logs ou l&apos;historique workflow.

## Exemples de politiques [#policy-examples]

Utilisez ces modèles de stratégie IAM complets pour les types workflow courants. Chacune applique le principe du moindre privilège en limitant l&apos;accès à des ressources spécifiques.

<CollapserGroup>
  <Collapser id="sqs-policy" title="workflowde messagerie SQS">
    Restreindre l&apos;accès à une file d&apos;attente spécifique :

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": "sqs:SendMessage",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        },
        {
          "Effect": "Allow",
          "Action": "sqs:GetQueueAttributes",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        }
      ]
    }
    ```

    Remplacez `us-west-2` par votre région, `123456789012` par l&apos;ID de votre compte AWS et `my-workflow-queue` par le nom de votre file d&apos;attente.
  </Collapser>

  <Collapser id="ec2-policy" title="workflowde gestion EC2">
    Restreindre l&apos;accès à une instance spécifique par tag:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ec2:DescribeInstances",
            "ec2:DescribeTags"
          ],
          "Resource": "*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ec2:StopInstances",
            "ec2:StartInstances",
            "ec2:ModifyInstanceAttribute"
          ],
          "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/*",
          "Condition": {
            "StringEquals": {
              "aws:ResourceTag/Environment": "production"
            }
          }
        }
      ]
    }
    ```

    Cette politique permet au flux de travail d&apos; *arrêter/démarrer/modifier* uniquement les instances EC2 étiquetées avec `Environment=production`.
  </Collapser>

  <Collapser id="dynamodb-policy" title="workflowDynamoDB">
    Restreindre l&apos;accès à une table spécifique :

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "dynamodb:Query",
            "dynamodb:GetItem",
            "dynamodb:PutItem"
          ],
          "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/WorkflowData"
        }
      ]
    }
    ```

    Remplacez `WorkflowData` par le nom de votre table.
  </Collapser>

  <Collapser id="ssm-policy" title="workflowdu gestionnaire de système">
    Limiter l&apos;accès à certains documents d&apos;automatisation :

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ssm:CreateDocument",
            "ssm:DeleteDocument"
          ],
          "Resource": "arn:aws:ssm:us-east-1:123456789012:document/WorkflowAutomation-*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ssm:StartAutomationExecution",
            "ssm:GetAutomationExecution"
          ],
          "Resource": [
            "arn:aws:ssm:us-east-1:123456789012:automation-definition/WorkflowAutomation-*:*",
            "arn:aws:ssm:us-east-1:123456789012:automation-execution/*"
          ]
        }
      ]
    }
    ```

    Cela limite les documents d&apos;automatisation à ceux préfixés par `WorkflowAutomation-`.
  </Collapser>

  <Collapser id="apigateway-policy" title="Workflow du Gateway API">
    Restreindre l&apos;accès à une API spécifique :

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "apigateway:GET",
            "apigateway:PUT"
          ],
          "Resource": "arn:aws:apigateway:us-west-2::/restapis/abc123xyz/*"
        }
      ]
    }
    ```

    Remplacez `abc123xyz` par votre ID de Gateway API.
  </Collapser>
</CollapserGroup>

### Ressources supplémentaires

Pour une documentation complète sur les autorisations AWS :

* **[Politiques d&apos;intégration AWS gérées](/docs/infrastructure/amazon-integrations/get-started/integrations-managed-policies/)**: liste complète des autorisations AWS par service, ainsi que des modèles CloudFormation adaptables.
* **[Configurer l&apos;interrogation d&apos;API AWS](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)**: Modèles de configuration supplémentaires

<Callout variant="important">
  Ces ressources utilisent l&apos;ID de compte `754728514883` pour l&apos;intégration cloud (monitoring). Pour l&apos;automatisation workflow, utilisez toujours `253490767857`.
</Callout>

## Et ensuite ?

* **[Créer des destinations](/docs/workflow-automation/setup-and-configuration/create-destinations)** : Configurer les notifications Slack, par e-mail ou par webhook.
* **[Catalogue des actions](/docs/workflow-automation/setup-and-configuration/actions-catalog/actions-catalog)** : Consultez toutes les actions AWS, New Relic et d’intégration disponibles.