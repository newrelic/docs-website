---
title: Démarrer et planifier le workflow
tags:
  - workflow automation
  - workflow
  - start a workflow automation
  - start workflow automation on demand
  - schedule workflows
metaDescription: Trigger workflows manually or schedule them to run automatically at specified times using NerdGraph APIs.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un programme d&apos;aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Une fois que vous avez créé un workflow, vous pouvez le déclencher de trois manières : à partir d&apos;alertes, manuellement à la demande ou selon un calendrier.

## Choisissez votre méthode de déclenchement

Choisissez l&apos;approche la plus adaptée à votre cas d&apos;utilisation :

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        **Déclencher à partir d&apos;alertes**
      </th>

      <th>
        **Déclencher à partir d&apos;alertes**
      </th>

      <th>
        **Exécuter selon un calendrier**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Réponse automatisée aux incidents
      </td>

      <td>
        Test d&apos;un nouveau workflow
      </td>

      <td>
        bilans de santé réguliers
      </td>
    </tr>

    <tr>
      <td>
        Auto-remédiation (redimensionnement EC2, restauration)
      </td>

      <td>
        Opérations manuelles
      </td>

      <td>
        Traitement périodique des données
      </td>
    </tr>

    <tr>
      <td>
        Notifications d&apos;alerte enrichies
      </td>

      <td>
        Maintenance ad hoc
      </td>

      <td>
        Rapports quotidiens ou hebdomadaires
      </td>
    </tr>

    <tr>
      <td>
        **Configuration**: [Configurer comme destination d&apos;alerte](/docs/workflow-automation/setup-and-configuration/create-destinations#trigger-from-alerts)
      </td>

      <td>
        **API**: [StartWorkflowRun](/docs/workflow-automation/workflow-automation-apis/start-workflow-run)
      </td>

      <td>
        **API**: [CreateSchedule](/docs/workflow-automation/workflow-automation-apis/create-schedule)
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Lorsque les conditions d&apos;alerte sont violées, New Relic peut déclencher automatiquement des workflows en configurant l&apos;automatisation des workflows comme destination. Les `issueId` et `accountId` sont transmis automatiquement. Consultez [Envoyer des notifications à partir des workflows](/docs/workflow-automation/setup-and-configuration/create-destinations#trigger-from-alerts) pour les instructions de configuration.
</Callout>

## Avant de commencer

Avant de déclencher le workflow, assurez-vous d&apos;avoir :

* **Workflow créé**: une définition de workflow déjà déployée dans votre compte à partir d&apos;un [modèle](/docs/workflow-automation/create-a-workflow-automation/use-a-template) ou [personnalisé](/docs/workflow-automation/create-a-workflow-automation/create-your-own).
* **ID de compte**: Votre ID de compte New Relic se trouve dans [Paramètres du compte](/docs/accounts/accounts-billing/account-structure/account-id).
* **Nom du workflow**: Le nom exact figurant dans votre définition workflow.
* **Entrées requises**: Valeurs de tous les paramètres attendus par votre workflow.
* **Secrets configurés**: identifiants AWS, jetons Slack ou autres secrets stockés dans le [gestionnaire de secrets](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials).

<Callout variant="tip">
  **Vous débutez dans le monde du workflow ?** Créez votre premier workflow avant de tenter de le déclencher. Commencez par [utiliser un modèle](/docs/workflow-automation/create-a-workflow-automation/use-a-template) pour les workflows prédéfinis.
</Callout>

## Exécuter le workflow à la demande [#on-demand]

Déclenchez manuellement des workflows à l&apos;aide de l&apos; [API StartWorkflowRun](/docs/workflow-automation/workflow-automation-apis/start-workflow-run). Cela exécute immédiatement le workflow avec les données que vous fournissez.

### Exemple : Appeler une fonction AWS Lambda

La définition workflow suivante invoque une fonction AWS Lambda et enregistre la sortie. Remplacez `12345678` par votre identifiant de compte New Relic.

```yaml
  name: lambda1

  workflowInputs:
    username:
      type: String
      defaultValue: "User"
    key:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_ACCESS_KEY_ID }}"
    access:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_SECRET_ACCESS_KEY }}"
    token:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_SESSION_TOKEN }}"
    region:
      type: String
      defaultValue: us-east-1

  steps:
    - name: invoke1
      type: action
      action: aws.lambda.invoke
      version: 1
      inputs:
        awsAccessKeyId: ${{ .workflowInputs.key }}
        awsSecretAccessKey: ${{ .workflowInputs.access }}
        awsSessionToken: ${{ .workflowInputs.token }}
        region: ${{ .workflowInputs.region }}
        functionName: hello-you
        payload:
          user: ${{ .workflowInputs.username }}

    - name: logOutput
      type: action
      action: newrelic.ingest.sendLogs
      version: 1
      inputs:
        logs:
          - message: 'The lambda function message output is:${{ .steps.invoke1.outputs.payload.body }}'
```

Pour démarrer ce workflow, utilisez la mutation NerdGraph suivante. Avant d&apos;exécuter cette mutation, assurez-vous d&apos;avoir stocké vos informations d&apos;identification AWS à l&apos;aide de la mutation `secretsManagementCreateSecret`. Pour plus d&apos;informations, consultez le [gestionnaire de secrets](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials).

```yaml
  mutation {
    workflowAutomationStartWorkflowRun(
      # Specify the account where the workflow is defined
      scope: { type: ACCOUNT id: "12345678" }

      # Reference the workflow definition by name
      definition: { name: "lambda1" }

      # Provide input values for the workflow
      workflowInputs: [
        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
        {key: "region" value:"us-east-2"}
        {key: "username" value: "Julien"}
      ]
    ) {
      runId
    }
  }
```

**Explication des paramètres :**

* `scope`: L&apos;identifiant du compte où est stockée votre définition workflow
* `definition`: Le nom du workflow à exécuter (doit correspondre au champ `name` dans votre définition workflow )
* `workflowInputs`: paires clé-valeur qui remplacent les valeurs par défaut dans la section `workflowInputs` de votre définition workflow

La mutation renvoie un `runId` (par exemple, `7bd25287-2af8-42e1-b783-80f4e760a40b`). Utilisez cet identifiant pour interroger les logs et afficher le résultat :

<img title="Workflow automation logs" alt="Workflow automation logs showing the Lambda function output" src="/images/autoflow-all-logs-2.webp" />

## Planifier le workflow [#scheduled]

Planifiez l&apos;exécution automatique des workflows à des heures spécifiques à l&apos;aide de l&apos;API [CreateSchedule API](/docs/workflow-automation/workflow-automation-apis/create-schedule). Les workflows planifiés exécutent des tâches récurrentes sans intervention manuelle.

**Quand planifier le workflow :**

* bilans de santé réguliers
* Traitement périodique des données
* Rapports quotidiens/hebdomadaires
* Fenêtres de maintenance programmées
* Sauvegardes ou nettoyages récurrents

### Référence d&apos;expression Cron

Les planifications utilisent des expressions cron pour définir le moment d&apos;exécution des workflows. Format: `minute hour day month weekday`

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Modèle
      </th>

      <th>
        Description
      </th>

      <th>
        Exemple d&apos;utilisation
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `0 9 * * *`
      </td>

      <td>
        Tous les jours à 9h00
      </td>

      <td>
        bilans de santé quotidiens du matin
      </td>
    </tr>

    <tr>
      <td>
        `0 9 * * 1-5`
      </td>

      <td>
        Tous les jours de la semaine à 9h00
      </td>

      <td>
        opérations en journée
      </td>
    </tr>

    <tr>
      <td>
        `0 */6 * * *`
      </td>

      <td>
        Toutes les 6 heures
      </td>

      <td>
        Opérations de synchronisation régulières
      </td>
    </tr>

    <tr>
      <td>
        `0 0 1 * *`
      </td>

      <td>
        Premier jour du mois à minuit
      </td>

      <td>
        Rapports mensuels
      </td>
    </tr>

    <tr>
      <td>
        `*/10 * * * *`
      </td>

      <td>
        Toutes les 10 minutes (intervalle minimum)
      </td>

      <td>
        Interrogation fréquente, contrôles d&apos;intégrité
      </td>
    </tr>

    <tr>
      <td>
        `0 0 * * 0`
      </td>

      <td>
        Tous les dimanches à minuit
      </td>

      <td>
        Tâches de nettoyage hebdomadaires
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="important">
  **Intervalle de planification minimum :** Les planifications doivent être espacées d&apos;au moins 10 minutes. Vous ne pouvez pas planifier l&apos;exécution des workflows plus fréquemment que toutes les 10 minutes. Pour les intervalles inférieurs à 10 minutes, envisagez de planifier toutes les 10 minutes et d&apos;utiliser une [étape d&apos;attente](/docs/workflow-automation/workflow-automation-apis/definition-schema#wait) dans votre workflow. Consultez la section [Limites du workflow](/docs/workflow-automation/limitations-and-faq/workflow-limits) pour toutes les contraintes de planification.
</Callout>

<Callout variant="tip">
  **Syntaxe Cron :** `*` signifie `every`, `/` signifie `every nth`, `-` signifie `range`. Exemple : `0 9 * * 1-5 = At minute 0, hour 9, every day, every month, Monday through Friday`.
</Callout>

### Exemple : Planifier un bilan de santé quotidien

L&apos;exemple suivant planifie l&apos;exécution workflow `lambda1` tous les jours à 9 h, heure de l&apos;Est :

```yaml
  mutation {
    workflowAutomationCreateSchedule(
      # Specify the account where the workflow is defined
      scope: { type: ACCOUNT id: "12345678" }

      # Reference the workflow definition by name
      definition: { name: "lambda1" }

      # Configure the schedule
      schedule: {
        # Cron expression: minute hour day month weekday
        # "0 9 * * *" = every day at 9:00 AM
        cronExpression: "0 9 * * *"

        # Timezone for the schedule
        timezone: "America/New_York"

        # Optional: Schedule name for identification
        name: "daily-lambda-health-check"

        # Optional: Add a description
        description: "Runs Lambda health check every morning at 9 AM"
      }

      # Provide input values for the workflow
      workflowInputs: [
        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
        {key: "region" value:"us-east-2"}
        {key: "username" value: "HealthCheckBot"}
      ]
    ) {
      scheduleId
    }
  }
```

**Ce que vous obtenez :** `scheduleId`, Identifiant unique de la planification (utilisez-le pour mettre à jour ou supprimer la planification ultérieurement)

### Solution de contournement : intervalles inférieurs à 10 minutes

Si vous devez vérifier quelque chose plus fréquemment que toutes les 10 minutes, planifiez votre workflow à l&apos;intervalle minimum de 10 minutes et utilisez une étape d&apos;attente dans la définition du workflow pour créer des intervalles d&apos;interrogation supplémentaires.

**Exemple de workflow avec un sondage de 5 minutes :**

```yaml
  name: frequent-health-check

  steps:
    # First check happens immediately when scheduled
    - name: firstCheck
      type: action
      action: newrelic.nrdb.query
      version: 1
      inputs:
        query: "FROM Transaction SELECT count(*) WHERE appName = 'MyApp' SINCE 5 minutes ago"

    # Wait 5 minutes
    - name: waitStep
      type: wait
      seconds: 300

    # Second check happens 5 minutes after the workflow started
    - name: secondCheck
      type: action
      action: newrelic.nrdb.query
      version: 1
      inputs:
        query: "FROM Transaction SELECT count(*) WHERE appName = 'MyApp' SINCE 5 minutes ago"
```

Planifiez l&apos;exécution de ce workflow toutes les 10 minutes à l&apos;aide de `*/10 * * * *`. Cela vous donne une interrogation efficace de 5 minutes :

* 0:00 - Le workflow démarre, exécute firstCheck
* 0:05 - secondCheck s&apos;exécute (après l&apos;étape d&apos;attente)
* 0:10 - Le prochain workflow planifié démarre, exécute firstCheck
* 0:15 - secondCheck s&apos;exécute (après l&apos;étape d&apos;attente)

<Callout variant="tip">
  **Limite de durée du workflow :** N&apos;oubliez pas que les workflows ont une durée maximale de 7 jours. Concevez vos étapes d&apos;attente et la fréquence d&apos;interrogation en conséquence. Consultez la section [Limites du workflow](/docs/workflow-automation/limitations-and-faq/workflow-limits) pour plus de détails.
</Callout>

### Gérer les horaires

Après avoir créé un planning :

* **Afficher les planifications actives**: Consultez toutes les exécutions planifiées dans le [dashboardworkflow.](/docs/workflow-automation/create-a-workflow-automation/managing-workflow#monitor-runs)
* **Mise à jour du planning**: Utilisez l’API UpdateSchedule pour modifier la fréquence ou les entrées.
* **Supprimer une planification**: utilisez l’API DeleteSchedule pour arrêter les exécutions récurrentes.

Pour une documentation complète de l&apos;API, consultez [API d&apos;automatisation des workflows](/docs/workflow-automation/workflow-automation-apis/using-workflow-automation-api).

## Et ensuite ?

* **[Gérer les workflows](/docs/workflow-automation/create-a-workflow-automation/managing-workflow)** : modifier, dupliquer et monitorer l’historique d’exécution.