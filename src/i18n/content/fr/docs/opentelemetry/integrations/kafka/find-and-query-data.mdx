---
title: Trouver et interroger les données Kafka dans New Relic
tags:
  - Integrations
  - OpenTelemetry
  - Kafka
  - Query data
metaDescription: Learn how to find your Kafka metrics in New Relic UI and write NRQL queries to analyze your data.
freshnessValidatedDate: never
translationType: machine
---

Une fois votre monitoring Kafka configuré avec OpenTelemetry, vos métriques apparaîtront à plusieurs endroits dans New Relic. Ce guide vous montre où trouver vos données et comment les interroger efficacement.

## Accéder à vos données Kafka [#find-data]

Vos métriques Kafka apparaissent à plusieurs endroits sur la plateforme New Relic, chacune étant optimisée pour différents cas d&apos;utilisation :

### 1. Explorateur d&apos;entités

Idéal pour : Contrôles de santé rapides et relations d&apos;entités

1. Aller à <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; On host integrations**</DNT>
2. Afficher les types d&apos;entités des brokers, des clusters et des sujets Kafka

<img title="OTel Kafka Entity Explorer" alt="Entity explorer showing Kafka broker, cluster, and topics entity types" src="/images/otel-kafka-entityexplorer.webp" />

### 2. Files d&apos;attente et flux

Idéal pour : Monitoring axé sur la file d&apos;attente de messages

1. Aller à <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; Queues &amp; Streams**</DNT>
2. Filtrez par `provider=opentelemetry` et cliquez sur la ligne du compte où vous avez instrumenté Kafka pour afficher vos données.

<img title="OTel Kafka Queues & Streams" alt="Queues & Streams view showing Kafka data filtered by OpenTelemetry provider" src="/images/otel-kafka-queues-streams.webp" />

/\* ### 3. Third-party services Best for: Integration-focused monitoring 1. Go to &lt;DNT&gt;\*\*\[one.newrelic.com]\(https\://one.newrelic.com) &gt; All capabilities &gt; Infrastructure &gt; Third-party services\*\*&lt;/DNT&gt; 2. Select &lt;DNT&gt;\*\*Kafka (OpenTelemetry)\*\*&lt;/DNT&gt; &gt; &lt;DNT&gt;\*\*OpenTelemetry Kafka\*\*&lt;/DNT&gt; &lt;img title=&quot;OTel Kafka Third-party Services&quot; alt=&quot;Third-party services view showing Kafka (OpenTelemetry) integration&quot; src=&quot;/images/infrastructure\_screenshot-crop\_otel-kafka-third-party-integrations.webp&quot; /&gt; \*/

### 3. Dashboards de bord pré-construits

Idéal pour : Monitoring et visualisation complets

1. Aller à <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Dashboards &gt; Recommended dashboards (View all)**</DNT>
2. Rechercher <DNT>**&quot;OpenTelemetry Kafka&quot;**</DNT>

<img title="OpenTelemetry Kafka" alt="Pre-built dashboard showing Kafka cluster health, network throughput, and broker metrics" src="/images/otel-kafka-prebuilt-dashboards.webp" />

## Interrogez les données Kafka avec NRQL [#query-data]

Utilisez [NRQL](/docs/nrql/get-started/introduction-nrql-new-relics-query-language) pour créer des requêtes et des dashboards personnalisés pour vos données Kafka.

<CollapserGroup>
  <Collapser id="basic-queries" title="Requêtes de base">
    **Afficher toutes les métriques Kafka :**

    ```sql
    FROM Metric SELECT *
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name IS NOT NULL
    LIMIT 100
    ```

    **Monitorer un cluster spécifique :**

    ```sql
    FROM Metric SELECT *
    WHERE kafka.cluster.name = 'production-cluster'
    AND instrumentation.provider='opentelemetry'
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Monitoring du retard du consommateur">
    **Retard du consommateur par groupe :**

    ```sql
    FROM Metric SELECT latest(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    FACET group, topic
    SINCE 1 hour ago TIMESERIES
    ```

    **Alerte de retard de consommateur élevé :**

    ```sql
    FROM Metric SELECT max(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    AND group = 'your-consumer-group'
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="Requêtes d'intégrité du broker">
    **Nombre de brokers actifs :**

    ```sql
    FROM Metric SELECT latest(kafka.brokers)
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name = 'your-cluster'
    TIMESERIES
    ```

    **Partitions sous-répliquées :**

    ```sql
    FROM Metric SELECT latest(kafka.partition.under_replicated)
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id SINCE 1 hour ago
    ```
  </Collapser>

  <Collapser id="performance-queries" title="Monitoring des performances">
    **Débit de messages par sujet :**

    ```sql
    FROM Metric SELECT rate(sum(kafka.prod.msg.count), 1 minute) as 'Messages/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET topic SINCE 1 hour ago TIMESERIES
    ```

    **E/S réseau par broker :**

    ```sql
    FROM Metric SELECT rate(sum(kafka.network.io), 1 minute) as 'Bytes/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id, direction SINCE 1 hour ago TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Requêtes avancées [#advanced-queries]

Pour des exemples de requêtes plus complets, organisés par domaine de monitoring :

<CollapserGroup>
  <Collapser id="cluster-overview-queries" title="Aperçu du cluster">
    Get high-level cluster statistics and health:

    ```sql
    FROM Metric SELECT
      max(kafka.brokers) AS 'Active Brokers',
      max(kafka.cluster.topic.count) AS 'Total Topics',
      max(kafka.cluster.partition.count) AS 'Total Partitions',
      latest(kafka.partition.offline) AS 'Offline Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="État de santé du broker">
    Monitorez l&apos;état de santé et le leadership de chaque broker :

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_replicated) AS 'Under-replicated Partitions',
      latest(kafka.broker.leader.count) AS 'Leader Count',
      latest(kafka.partition.count) AS 'Total Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="topic-throughput-queries" title="Débit et E/S des sujets">
    Monitorez les débits de messages et le débit de données par rubrique :

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.prod.msg.count), 1 minute) AS 'Messages/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'in'), 1 minute) AS 'Bytes In/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'out'), 1 minute) AS 'Bytes Out/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET topic
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Retard du consommateur">
    Suivre le retard du groupe de consommateurs et les délais de traitement :

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum) AS 'Total Lag'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="request-latency-queries" title="Latence des requêtes">
    Monitorer les temps de traitement des requêtes et les performances :

    ```sql
    FROM Metric SELECT
      latest(kafka.request.time.avg) AS 'Avg Latency',
      latest(`kafka.request.time.99p`) AS '99th Percentile'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="jvm-health-queries" title="Santé JVM">
    Monitorer les métriques JVM pour les brokers Kafka :

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100 AS 'Heap Usage %',
      rate(sum(jvm.gc.collections.count), 1 minute) AS 'GC Count/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Créer des dashboards personnalisés [#custom-dashboards]

Combinez plusieurs requêtes pour créer des dashboards de monitoring Kafka complets :

1. Accédez à [one.newrelic.com](https://one.newrelic.com) &gt; Dashboards

2. Cliquez sur « Create a dashboard »

3. Ajouter des widgets à l&apos;aide des requêtes NRQL ci-dessus

4. Organiser les widgets par domaine d&apos;intérêt :

   * État du cluster : Nombre de brokers, partitions sous-répliquées, état du contrôleur
   * Performances du consommateur : Retard, débit, appartenance au groupe
   * Métriques de rubrique : Débits de messages, nombres de partitions, état de la réplication
   * Utilisation des ressources : E/S réseau, métriques JVM, utilisation du disque

## Configurer des alertes [#alerts]

<Callout variant="tip">
  New Relic fournit des alertes de métriques dorées préconfigurées pour Kafka. Lors de la création d&apos;une nouvelle condition d&apos;alerte, sélectionnez **Guided mode** → **Host integrations** → **Kafka** (brokers, cluster ou topics) pour afficher les modèles d&apos;alerte recommandés.
</Callout>

Vous pouvez également créer des alertes personnalisées à l&apos;aide de requêtes NRQL :

<CollapserGroup>
  <Collapser id="consumer-lag-alert" title="Retard élevé du consommateur">
    Alerte lorsque le retard du consommateur dépasse votre seuil acceptable :

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    ```

    **Seuil recommandé**: Alerte lorsque le retard &gt; 10 000 messages pour les groupes de consommateurs critiques.
  </Collapser>

  <Collapser id="under-replicated-alert" title="Partitions sous-répliquées">
    Alerte lorsque les partitions perdent la réplication :

    ```sql
    FROM Metric SELECT
      sum(kafka.partition.under_replicated)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Seuil recommandé**: Alerter lorsque des partitions deviennent sous-répliquées (&gt; 0).
  </Collapser>

  <Collapser id="offline-partitions-alert" title="Partitions hors ligne">
    Alerter immédiatement lorsque les partitions sont hors ligne :

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.offline)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Seuil recommandé**: Alerte immédiatement lorsque des partitions sont hors ligne (&gt; 0).
  </Collapser>

  <Collapser id="min-isr-alert" title="Partitions sous ISR minimum">
    Alerte lorsque les partitions tombent en dessous du nombre minimal de répliques synchronisées :

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_min_isr)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Seuil recommandé**: Alertez lorsque des partitions tombent en dessous du ISR minimum (&gt; 0).
  </Collapser>

  <Collapser id="jvm-memory-alert" title="Utilisation élevée de la mémoire JVM">
    Alerte lorsque l&apos;utilisation du tas est critique :

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Seuil recommandé**: alertez lorsque l&apos;utilisation du tas est &gt; 85 % pendant des périodes prolongées.
  </Collapser>

  <Collapser id="request-failures-alert" title="Échecs de requêtes">
    Alerter en cas de taux d&apos;échec de requêtes élevé :

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.request.failed), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    ```

    **Seuil recommandé**: Alerte lorsque le taux d&apos;échec est &gt; 1 % du total des requêtes.
  </Collapser>

  <Collapser id="unclean-elections-alert" title="Élections de leader non propres">
    Alerte sur les élections de leader non propres (indique des défaillances de broker) :

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.unclean.election.rate), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Seuil recommandé**: Alertez sur les élections de leader non propres (&gt; 0).
  </Collapser>
</CollapserGroup>

## Prochaines étapes [#next-steps]

* **[Référence des métriques Kafka](/docs/opentelemetry/integrations/kafka/metrics-reference)** - Liste complète des métriques disponibles avec des descriptions
* **[Créer des conditions d&apos;alerte NRQL](/docs/alerts/create-alert/create-alert-condition/create-nrql-alert-conditions/)** - Mettre en place un monitoring proactif
* **[Tutoriel NRQL](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language)** - Apprenez des techniques de requête avancées