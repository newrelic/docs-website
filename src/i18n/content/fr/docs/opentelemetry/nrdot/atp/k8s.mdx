---
title: Configurer ATP pour Kubernetes
metaDescription: Step-by-step guide to install and configure the Adaptive Telemetry Processor (ATP) with NRDOT Collector in Kubernetes environments.
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Kubernetes
  - Helm
  - Manifests
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Aperçu">
  Nous travaillons toujours sur cette fonctionnalité, mais nous aimerions que vous l&apos;essayiez !

  Cette fonctionnalité est actuellement fournie dans le cadre d&apos;un aperçu conformément à nos [politiques de pré-sortie](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/).
</Callout>

Apprenez à installer et configurer l&apos;Adaptive Telemetry Processor (ATP) avec le NRDOT Collector dans les environnements Kubernetes. ATP réduit le volume de données de télémétrie tout en conservant une visibilité critique sur vos applications.

<Callout variant="important">
  ATP pour Kubernetes utilise une version expérimentale. L&apos;ensemble de ce build est expérimental pour l&apos;installation de Kubernetes, et pas seulement la fonctionnalité ATP qui est en préversion.
</Callout>

## Méthodes d&apos;installation [#installation-methods]

Vous pouvez installer l&apos;OpenTelemetry Collector avec ATP en utilisant Helm (recommandé) ou des manifestes Kubernetes :

<Tabs>
  <TabsBar>
    <TabsBarItem id="helm">Installation Helm (recommandée)</TabsBarItem> <TabsBarItem id="manifest">Installation via manifeste</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="helm">
      La méthode d&apos;installation Helm est l&apos;approche recommandée pour déployer des collecteurs compatibles ATP dans Kubernetes.

      <Steps>
        <Step>
          ### Avant de commencer [#helm-prereq]

          Assurez-vous d&apos;avoir :

          * Votre clé de licence New Relic
          * kubectl configuré pour accéder à votre cluster
          * Permissions d&apos;administrateur de cluster
        </Step>

        <Step>
          ### Télécharger et personnaliser values.yaml [#helm-values]

          1. Télécharger le fichier `values.yaml` du chart Helm :

             ```bash
             curl -o values.yaml https://raw.githubusercontent.com/newrelic/helm-charts/master/charts/nr-k8s-otel-collector/values.yaml
             ```

          2. Modifiez le fichier `values.yaml` avec votre configuration spécifique :

             ```yaml
             # Required: Set your cluster name and license key
             cluster: "YOUR_CLUSTER_NAME"
             licenseKey: "YOUR_NEW_RELIC_LICENSE_KEY"

             # Enable ATP
             enable_atp: true

             # IMPORTANT: Use experimental collector image for ATP
             images:
               collector:
                 repository: "newrelic/nrdot-collector"  # Changed from nrdot-collector-k8s
                 tag: "<NRDOT_COLLECTOR_LATEST_VERSION>"  # Use latest version from releases page
             ```

          3. Trouvez la dernière version de NRDOT Collector sur la [page des versions](https://github.com/newrelic/nrdot-collector-releases/releases) et mettez à jour la valeur `tag`.

          4. Pour des options de configuration supplémentaires, voir les [paramètres de configuration](/docs/kubernetes-pixie/k8s-otel/install/#config-params).
        </Step>

        <Step>
          ### Installer le chart Helm [#helm-install]

          1. Ajouter le dépôt Helm New Relic :

             ```bash
             helm repo add newrelic https://helm-charts.newrelic.com
             helm repo update
             ```

          2. Installez le chart à l&apos;aide de votre fichier `values.yaml` personnalisé :

             ```bash
             helm upgrade nr-k8s-otel-collector newrelic/nr-k8s-otel-collector \
               -f values.yaml \
               -n newrelic \
               --create-namespace \
               --install
             ```
        </Step>

        <Step>
          ### Vérifier l&apos;installation [#helm-verify]

          1. Vérifiez que les pods sont en cours d&apos;exécution :

             ```bash
             kubectl get pods -n newrelic --watch
             ```

             Vous devriez voir des pods avec des noms tels que `nr-k8s-otel-collector-<hash>` dans l&apos;espace de noms `newrelic`.

          2. Vérifiez que New Relic reçoit des données de processus en exécutant ces requêtes dans le [générateur de requêtes](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Accédez aux données ATP dans New Relic [#access-data]

          Une fois l&apos;ATP configuré, il commence à collecter des données depuis votre cluster Kubernetes. Vous pouvez accéder à ces données dans l&apos;interface utilisateur New Relic OpenTelemetry. Pour plus d&apos;informations sur l&apos;interface utilisateur New Relic OpenTelemetry, consultez [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Pour afficher les données de métriques du processus ATP dans New Relic :**

          1. Allez à **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             OU

             Allez à <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Recherchez l&apos;entité sur laquelle vous avez installé le collecteur NRDOT avec ATP.

          3. Sélectionnez l&apos;entité, puis cliquez sur **<DNT>Process</DNT>** dans le volet de gauche.

             Sur la page <DNT>Process</DNT>, vous pouvez visualiser tous les processus en cours d&apos;exécution, ainsi que leurs ID et les métriques d&apos;utilisation du CPU et de la mémoire. Il affiche également la relation parent-enfant entre les processus si un processus génère d&apos;autres processus.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>

    <TabsPageItem id="manifest">
      La méthode d&apos;installation par manifeste permet de configurer OpenTelemetry pour Kubernetes sans utiliser Helm. Cette méthode convient aux utilisateurs qui préfèrent une approche plus pratique ou qui ont des exigences spécifiques nécessitant une configuration manuelle.

      <Steps>
        <Step>
          ### Avant de commencer [#manifest-prereq]

          Assurez-vous d&apos;avoir :

          * Votre clé de licence New Relic
          * kubectl configuré pour accéder à votre cluster
          * Permissions d&apos;administrateur de cluster
        </Step>

        <Step>
          ### Télécharger et préparer les fichiers manifestes [#manifest-download]

          1. Copiez le contenu du répertoire d&apos;exemples rendus de `nr-k8s-otel-collector` dans votre espace de travail local :

             ```bash
             git clone https://github.com/newrelic/helm-charts.git
             cd helm-charts/charts/nr-k8s-otel-collector/examples/k8s-with-atp/rendered
             ```

          2. Mettez à jour l&apos;image du collecteur dans les fichiers `daemonset.yaml` et `deployment.yaml` :

             Modification de :

             ```yaml
             image: docker.io/newrelic/nrdot-collector-k8s
             ```

             À :

             ```yaml
             image: docker.io/newrelic/nrdot-collector:<NRDOT_COLLECTOR_LATEST_VERSION>
             ```

             <Callout variant="important">
               Ceci est une version expérimentale pour l&apos;installation de Kubernetes. Retrouvez la dernière version sur la [page des versions](https://github.com/newrelic/nrdot-collector-releases/releases).
             </Callout>
        </Step>

        <Step>
          ### Configurer la clé de licence et le nom du cluster [#manifest-config]

          1. Mettez à jour le fichier `secret.yaml` avec votre clé de licence New Relic encodée en Base64 :

             ```yaml
             data:
               licenseKey: <YOUR_BASE64_ENCODED_LICENSE_KEY>
             ```

             Pour encoder votre clé de licence :

             * **Linux/macOS :** `echo -n "<YOUR_LICENSE_KEY>" | base64`
             * **Windows (PowerShell) :** `[System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes("<YOUR_LICENSE_KEY>"))`

          2. Mettez à jour le nom de votre cluster dans les fichiers `daemonset-configmap.yaml` et `deployment-configmap.yaml` :

             Localisez les instances de `k8s.cluster.name` et remplacez `<YOUR_CLUSTER_NAME>` par le nom de cluster souhaité :

             ```yaml
             - key: k8s.cluster.name
               action: upsert
               value: YOUR_CLUSTER_NAME  # Replace with your cluster name
             ```
        </Step>

        <Step>
          ### Déployer les manifestes [#manifest-deploy]

          1. Créez l&apos;espace de noms `newrelic` et appliquez les manifestes :

             ```bash
             kubectl create namespace newrelic
             kubectl apply -n newrelic -R -f .
             ```

          2. Vérifiez que les pods sont en cours d&apos;exécution :

             ```bash
             kubectl get pods -n newrelic --watch
             ```

          3. Vérifiez que New Relic reçoit des données de processus en exécutant ces requêtes dans le [générateur de requêtes](https://docs.newrelic.com/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Accédez aux données ATP dans New Relic [#access-data]

          Une fois l&apos;ATP configuré, il commence à collecter des données depuis votre cluster Kubernetes. Vous pouvez accéder à ces données dans l&apos;interface utilisateur New Relic OpenTelemetry. Pour plus d&apos;informations sur l&apos;interface utilisateur New Relic OpenTelemetry, consultez [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Pour afficher les données de métriques du processus ATP dans New Relic :**

          1. Allez à **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             OU

             Allez à <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Recherchez l&apos;entité sur laquelle vous avez installé le collecteur NRDOT avec ATP.

          3. Sélectionnez l&apos;entité, puis cliquez sur **<DNT>Process</DNT>** dans le volet de gauche.

             Sur la page <DNT>Process</DNT>, vous pouvez visualiser tous les processus en cours d&apos;exécution, ainsi que leurs ID et les métriques d&apos;utilisation du CPU et de la mémoire. Il affiche également la relation parent-enfant entre les processus si un processus génère d&apos;autres processus.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Options de configuration ATP [#atp-config]

Lorsque ATP est activé, la configuration suivante est automatiquement appliquée :

<table>
  <thead>
    <tr>
      <th>
        paramètres
      </th>

      <th>
        Description
      </th>

      <th>
        Valeur par défaut
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `enable_atp`
      </td>

      <td>
        Activer/désactiver la fonctionnalité ATP. Définir sur 

        `true`

         pour activer ATP.
      </td>

      <td>
        `false`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.repository`
      </td>

      <td>
        Doit être modifié en 

        `newrelic/nrdot-collector`

         pour utiliser ATP.
      </td>

      <td>
        `newrelic/nrdot-collector-k8s`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.tag`
      </td>

      <td>
        Tag d&apos;image pour le collecteur compatible ATP.
      </td>

      <td>
        `<TO_BE_CONFIRMED>`
      </td>
    </tr>
  </tbody>
</table>

/\* ## Dépannage d&apos;ATP \[#troubleshooting] ### ATP ne filtre pas les métriques \*\*Problème\*\* : Toutes les métriques de processus sont envoyées, non filtrées. \*\*Solutions\*\* : 1. \*\*Vérifiez que l&apos;ATP est activé\*\* : \`\`\`bash kubectl get configmap -n newrelic nr-k8s-otel-collector-daemonset-config -o yaml | grep adaptivetelemetry \`\`\` 2. \*\*Vérifiez que l&apos;ATP est dans le pipeline\*\* : Recherchez \`adaptivetelemetry\` dans le pipeline \`metrics/nr\`. 3. \*\*Vérifiez que vous utilisez la bonne image de collecteur\*\* : \`\`\`bash kubectl get daemonset -n newrelic nr-k8s-otel-collector-daemonset -o yaml | grep &quot;image:&quot; \`\`\` Attendu : \`newrelic/nrdot-collector:1.11.0\` (ou version ultérieure) \*\*NON\*\* : \`newrelic/nrdot-collector-k8s:1.11.0\` 4. \*\*Vérifiez que \`enable\_atp\` est défini sur \`true\`\*\* dans votre \`values.yaml\` ou ConfigMap. ### Les pods ne démarrent pas \*\*Problème\*\* : Les pods du collecteur ne parviennent pas à démarrer. \*\*Solutions\*\* : 1. \*\*Vérifier les logs du pod\*\* : \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector \`\`\` 2. \*\*Vérifiez que la clé de licence est correctement encodée\*\* : \`\`\`bash kubectl get secret -n newrelic nr-k8s-otel-collector-config -o yaml \`\`\` 3. \*\*Vérifiez les limites de ressources\*\* : Assurez-vous que votre cluster dispose de ressources suffisantes pour les pods du collecteur. ### Pas de données dans New Relic \*\*Problème\*\* : Aucune métrique n&apos;apparaît dans New Relic après l&apos;installation. \*\*Solutions\*\* : 1. \*\*Patientez 2 à 5 minutes\*\* pour que les données apparaissent dans l&apos;interface New Relic. 2. \*\*Vérifiez que le nom du cluster\*\* correspond à celui défini dans votre configuration. 3. \*\*Vérifiez les logs du collecteur\*\* pour détecter des erreurs de connexion : \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector | grep -i error \`\`\` \*/

## Ressources connexes [#related-resources]

<DocTiles>
  <DocTile title="Dépannage" path="/docs/opentelemetry/nrdot/atp/troubleshooting">
    Apprenez à résoudre les problèmes ATP dans votre environnement.
  </DocTile>

  <DocTile title="Interrogez vos données" path="/docs/opentelemetry/nrdot/atp/query">
    Apprenez à interroger les données ATP dans New Relic à l&apos;aide de NRQL.
  </DocTile>

  <DocTile title="Fonctionnalités-avancées" path="/docs/opentelemetry/nrdot/atp/advanced-features">
    Découvrez comment activer les fonctionnalités avancées de votre déploiement ATP.
  </DocTile>
</DocTiles>