---
title: Monitorer NGINX sur Kubernetes avec OpenTelemetry
metaDescription: Send your NGINX metrics from Kubernetes to New Relic using the OpenTelemetry Collector.
freshnessValidatedDate: never
translationType: machine
---

Monitorez vos serveurs NGINX fonctionnant dans les clusters Kubernetes en utilisant l&apos;[OpenTelemetry Collector](https://github.com/open-telemetry/opentelemetry-collector-contrib) pour envoyer des métriques et des données de télémétrie à New Relic.

Cette intégration spécifique à Kubernetes découvre automatiquement les pods NGINX dans votre cluster et collecte des métriques sans configuration manuelle pour chaque instance. Elle exploite le [nginxreceiver](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/nginxreceiver) et le [receivercreator](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator) OpenTelemetry pour monitorer dynamiquement les métriques de performance NGINX, les statistiques de connexion et l&apos;état de santé du serveur dans votre environnement conteneurisé.

## Avant de commencer [#prerequisites]

Assurez-vous d&apos;avoir :

* Un [compte New Relic](https://newrelic.com/signup) avec un<InlinePopover type="licenseKey" />
* Activez le module [HTTP stub status](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html) sur le pod NGINX qui doit être monitoré
* Ajoutez les étiquettes `app` et `role` à chaque pod NGINX qui doit être monitoré

## Installez et configurez OpenTelemetry Collector [#install-collector]

Déployez le collecteur OpenTelemetry sur votre cluster Kubernetes à l&apos;aide de Helm. Le collecteur découvrira et extraira automatiquement les métriques de vos pods NGINX.

<CollapserGroup>
  <Collapser id="k8s-create-secret" title="Créer un secret Kubernetes pour les identifiants">
    Créez un secret Kubernetes pour stocker vos identifiants New Relic. Remplacez `YOUR_LICENSE_KEY` et `YOUR_OTLP_ENDPOINT` par vos valeurs réelles. Reportez-vous à la [documentation](https://docs.newrelic.com/docs/opentelemetry/best-practices/opentelemetry-otlp/#configure-endpoint-port-protocol) de configuration du point de terminaison OTLP pour sélectionner le point de terminaison approprié pour votre région.

    ```bash
    kubectl create namespace newrelic
    kubectl create secret generic newrelic-licenses --from-literal=NEWRELIC_LICENSE_KEY=YOUR_LICENSE_KEY --from-literal=NEWRELIC_OTLP_ENDPOINT=YOUR_OTLP_ENDPOINT
    ```
  </Collapser>

  <Collapser id="k8s-values-yaml" title="Créer une configuration values.yaml">
    Créez un fichier `values.yaml` pour configurer l&apos;OpenTelemetry Collector. Mettez à jour les espaces réservés pour le nom de votre cluster, les étiquettes de pod NGINX, le port et le chemin de l&apos;état du stub.

    ```yaml
    opentelemetry-collector:
      mode: deployment

      image:
        repository: otel/opentelemetry-collector-contrib
        pullPolicy: IfNotPresent

      command:
        name: otelcol-contrib

      resources:
        limits:
          cpu: 500m
          memory: 300Mi
        requests:
          cpu: 100m
          memory: 100Mi

      extraEnvs:
        - name: NEWRELIC_LICENSE_KEY
          valueFrom:
            secretKeyRef:
              name: newrelic-licenses
              key: NEWRELIC_LICENSE_KEY
        - name: NEWRELIC_OTLP_ENDPOINT
          valueFrom:
            secretKeyRef:
              name: newrelic-licenses
              key: NEWRELIC_OTLP_ENDPOINT
        - name: K8S_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: K8S_CLUSTER_NAME
          value: nginx-cluster # Update with your cluster name

      clusterRole:
        create: true
        rules:
          - apiGroups: [""]
            resources: ["pods", "nodes", "nodes/stats", "nodes/proxy"]
            verbs: ["get", "list", "watch"]
          - apiGroups: ["apps"]
            resources: ["replicasets"]
            verbs: ["get", "list", "watch"]
        clusterRoleBinding:
          name: ""

      config:
        extensions:
          health_check:
            endpoint: 0.0.0.0:13133
          k8s_observer:
            auth_type: serviceAccount
            observe_pods: true
            observe_nodes: true

        receivers:
          receiver_creator/nginx:
            watch_observers: [k8s_observer]
            receivers:
              nginx:
                rule: type == "pod" && labels["app"] == "nginx" && labels["role"] == "reverse-proxy" # Update with your labels
                config:
                  endpoint: 'http://`endpoint`:<stub_status_port>/status'
                  metrics:
                    nginx.requests:
                      enabled: true
                    nginx.connections_accepted:
                      enabled: true
                    nginx.connections_handled:
                      enabled: true
                    nginx.connections_current:
                      enabled: true
                  collection_interval: 30s
                resource_attributes:
                  nginx.server.endpoint: 'http://`endpoint`:<stub_status_port>/status'
                  nginx.port: '<stub_status_port>'

        processors:
          batch:
            send_batch_size: 1024
            timeout: 30s

          resource/cluster:
            attributes:
              - key: k8s.cluster.name
                value: "${env:K8S_CLUSTER_NAME}"
                action: insert

          transform/nginx:
            metric_statements:
              - context: resource
                statements:
                  - set(attributes["nginx.display.name"], Concat([
                      "server",
                      "k8s",
                      attributes["k8s.cluster.name"],
                      attributes["k8s.namespace.name"],
                      "pod",
                      attributes["k8s.pod.name"],
                      "nginx",
                      attributes["nginx.port"]
                      ], ":"))
                  - set(attributes["nginx.deployment.name"], attributes["k8s.pod.name"])

        exporters:
          otlphttp:
            endpoint: "${env:NEWRELIC_OTLP_ENDPOINT}"
            headers:
              api-key: "${env:NEWRELIC_LICENSE_KEY}"

        service:
          extensions: [health_check, k8s_observer]
          pipelines:
            metrics/nginx:
              receivers: [receiver_creator/nginx]
              processors: [batch, resource/cluster, transform/nginx]
              exporters: [otlphttp]
    ```
  </Collapser>

  <Collapser id="k8s-install-helm" title="Installer avec Helm">
    Installez le [graphique Helm](https://github.com/open-telemetry/opentelemetry-helm-charts) en utilisant votre fichier values.yaml.

    ```bash
    helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
    helm repo update
    helm upgrade --install nginx-otel-collector open-telemetry/opentelemetry-collector --namespace newrelic --create-namespace -f values.yaml
    ```
  </Collapser>

  <Collapser id="k8s-verify-deployment" title="Vérifier le déploiement et la collecte de données">
    1. **Assurez-vous que les pods ont démarré avec succès :**

       ```bash
       kubectl get pods -n newrelic --watch
       ```

       Vous devriez voir des pods avec des noms tels que `nginx-otel-collector-<hash>` dans un état `Running` dans l&apos;espace de noms `newrelic`.

    2. **Exécutez une requête NRQL dans New Relic pour confirmer que les données arrivent.** Remplacez le nom du cluster par la valeur que vous avez définie dans le fichier de valeurs :

       ```sql
       FROM Metric
       SELECT *
       WHERE metricName LIKE 'nginx.%'
         AND instrumentation.provider = 'opentelemetry'
         AND k8s.cluster.name = 'nginx-cluster'
       SINCE 10 minutes ago
       ```
  </Collapser>
</CollapserGroup>

## Rechercher et utiliser des données [#find-data]

1. Accédez à **[one.newrelic.com](https://one.newrelic.com) &gt; Integrations &amp; Agents**.
2. Sélectionnez **Dashboards**, puis cliquez sur **NGINX OTel overview dashboard**.
3. Dans la fenêtre contextuelle, sélectionnez votre compte.
4. Cliquez sur \[View dashboard] et consultez vos données NGINX dans New Relic.

Les métriques NGINX sont attachées au `Metric` [type d&apos;événement](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic). Vous pouvez [interroger ces données](/docs/using-new-relic/data/understand-data/query-new-relic-data) à des fins de dépannage ou pour créer des graphiques et des dashboards personnalisés.

## Référence des métriques et des attributs [#metrics]

Cette intégration collecte les mêmes métriques NGINX de base que le déploiement sur l&apos;hôte, avec des attributs de ressource spécifiques à Kubernetes supplémentaires pour l&apos;identification du cluster, de l&apos;espace de noms et du pod.

**Pour une référence complète des métriques et des attributs :** Consultez [Référence des métriques et des attributs NGINX OpenTelemetry](/docs/opentelemetry/nginx/nginx-otel-metrics-reference/) pour des descriptions détaillées de toutes les métriques, types et attributs de ressources pour les déploiements Kubernetes.

## Prochaines étapes [#next-steps]

**En savoir plus sur vos données :**

* [Trouvez et interrogez vos données NGINX](/docs/opentelemetry/nginx/find-and-query-your-data/) - Accédez aux dashboards, créez des requêtes personnalisées et configurez des alertes
* [Référence des métriques et attributs NGINX OpenTelemetry](/docs/opentelemetry/nginx/nginx-otel-metrics-reference/) - Référence complète des métriques avec descriptions et exemples
* [Présentation d&apos;NGINX OpenTelemetry](/docs/opentelemetry/nginx/nginx-otel-overview/) - Comprendre les métriques, les attributs et les cas d&apos;utilisation collectés
* [Documentation du récepteur NGINX](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/nginxreceiver/documentation.md) - Détails techniques et configuration avancée

**Explorer le monitoring connexe :**

* [Monitorer NGINX Plus avec OpenTelemetry](/docs/opentelemetry/nginx-plus/nginx-plus-otel/) - Pour les déploiements commerciaux NGINX Plus
* [Monitorer NGINX auto-hébergé avec OpenTelemetry](/docs/opentelemetry/nginx/nginx-otel-host/) - Pour les déploiements de serveurs traditionnels
* [Meilleures pratiques OpenTelemetry](/docs/opentelemetry/best-practices/opentelemetry-otlp/) - Optimisez votre configuration OpenTelemetry

**Ressources spécifiques à Kubernetes :**

* [OpenTelemetry Collector sur Kubernetes](https://opentelemetry.io/docs/kubernetes/) - Configurations avancées du collecteur