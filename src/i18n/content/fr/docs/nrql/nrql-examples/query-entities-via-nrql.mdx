---
title: exemples d'entités et de relations via NRQL (E&R via NRQL)
metaDescription: Examples of NRQL queries for entities & relationships
freshnessValidatedDate: '2024-03-19T00:00:00.000Z'
translationType: machine
---

Rationalisez l&apos;analyse de votre système en utilisant le langage de requête New Relic (NRQL) pour requêter directement les données d&apos;entité et de relation. Cette approche remplace les processus manuels fastidieux pour des tâches cruciales telles que la corrélation des performances du processeur avec les attributs de l&apos;hôte, la consultation des états passés des entités ou le suivi des modifications configuration, offrant ainsi des informations plus rapides et détaillées sur vos environnements complexes.

Pour interroger ces données, vous aurez besoin Advanced Compute; utilisez le type d&apos;événement d&apos;entité (et Relationships ou entityRelationships pour une requête spécifique à la relation).

<Callout variant="tip">
  Vous débutez dans l&apos;interrogation des entités et des relations avec NRQL? Avant d&apos;explorer ces exemples, familiarisez-vous avec les [concepts et les avantages de l&apos;E&amp;R via NRQL](/docs/nrql/get-started/query-entities-and-relationships-via-nrql).
</Callout>

Explorez ci-dessous les solutions pratiques NRQL qui pourront vous aider :

<CollapserGroup>
  <Collapser id="total-tx" title="Corréler l'utilisation du processeur avec l'attribut hôte">
    * **Objectif**: Une équipe d&apos;exploitation doit analyser l&apos;utilisation du processeur pour tous les hôtes de production situés dans une région AWS spécifique (par exemple, &apos;eu-central-1&apos;) afin d&apos;identifier les goulots d&apos;étranglement potentiels des performances.
    * **Défi**: Cela nécessitait souvent d&apos;exporter séparément les données de l&apos;hôte et les indicateurs de performance, puis d&apos;utiliser des outils externes ou des scripts complexes pour les fusionner et les analyser.
    * **Solution NRQL**:

    ```sql
    FROM SystemSample
    JOIN (FROM Entity SELECT id, name WHERE type = 'INFRA-HOST' AND `tags.aws.awsRegion` = 'eu-central-1')
    ON entityGuid = id
    SELECT average(cpuPercent) FACET name
    ```
  </Collapser>

  <Collapser id="total-tx" title="Afficher l'état de l'entité à un moment précis.">
    * **Objectif**: Un développeur enquête sur un événement d&apos;alerte survenu il y a plusieurs heures et a besoin de connaître la configuration ou l&apos;état exact d&apos;un hôte spécifique (ou d&apos;un conteneur, d&apos;une application, etc.) à ce moment précis.

    * **Problème**: Obtenir un instantané des attributs d&apos;une entité à partir d&apos;une période passée spécifique était souvent impossible ou nécessitait de parcourir des logs de configuration volumineux, lorsqu&apos;il était disponible.

    * **SolutionNRQL **: Cette requête récupère tous les attributs disponibles pour une entité spécifique (identifiée par son id) dans une fenêtre temporelle étroite d&apos;une heure à partir de sept heures auparavant.

    ```sql
    FROM Entity
    SELECT *
    WHERE id = '<your_entity_id>'
    SINCE 7 hours ago UNTIL 6 hours ago
    LIMIT 1
    ```
  </Collapser>

  <Collapser id="total-tx" title="Suivi des changements d'état de l'entité">
    * **Objectif**: Un SRE souhaite comprendre comment configuration ou un attribut clé d&apos;une entité a évolué au cours des dernières heures, afin de vérifier si un déploiement ou un processus automatisé a modifié son état comme prévu.

    * **Défi**: Suivre les changements subtils de l&apos;état d&apos;une entité au fil du temps était difficile et impliquait souvent des comparaisons manuelles ou des scripts monitoring personnalisés.

    * **Solution NRQL**: Cette requête récupère tous les états enregistrés pour une entité particulière au cours des trois dernières heures, permettant ainsi un audit de toute modification.

    ```sql
      SELECT *
      FROM Entity
      WHERE id = '<your_entity_id>'
      SINCE 3 hours ago
    ```
  </Collapser>

  <Collapser id="total-tx" title="Recherche d'applications liées aux hôtes">
    * **Objectif**: Identifier les applications exécutées sur des hôtes spécifiques

    * **Défi**: Il est difficile de corréler les applications aux hôtes.

    * **Solution NRQL**:

    ```sql
    FROM EntityRelationship SELECT sourceEntityGuid, targetEntityGuid, sourceEntityType, targetEntityType, relationshipType   where (sourceEntityType like '%HOST%' and targetEntityType='APPLICATION') or (targetEntityType LIKE '%HOST%' and sourceEntityType='APPLICATION')
    ```
  </Collapser>
</CollapserGroup>