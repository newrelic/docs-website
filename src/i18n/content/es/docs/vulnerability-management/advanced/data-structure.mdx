---
title: Estructura de datos de seguridad (referencia NRQL)
metaDescription: Learn about the data structure and entity types used to store security data in New Relic.
freshnessValidatedDate: never
translationType: machine
---

Security RX almacena datos de vulnerabilidades y configuraciones incorrectas en la base de datos de New Relic (NRDB), lo que permite realizar consultas mediante NRQL. Esta guía de referencia explica los tipos de entidades, atributos y estructuras de datos que puede emplear para crear consultas, dashboards y alertas personalizados.

## tipos entidad y evento

Security RX emplea los siguientes tipos de entidades y eventos para almacenar datos de seguridad:

### Entidad de SecurityFinding (recomendado)

`SECURITY_FINDING` es un tipo de entidad especializada que sirve como contenedor genérico para todos los problemas de seguridad detectados por Security RX. Esta es la forma recomendada de consultar datos de seguridad en New Relic.

**Importante:** SecurityFinding se consulta como un tipo de entidad, no como un evento tradicional:

```sql
FROM Entity
SELECT * WHERE type = 'SECURITY_FINDING'
```

#### Entendiendo el tipo de hallazgo

El atributo `findingType` es el campo clave para distinguir la fuente de datos:

* **`findingType = 'VULNERABILITY'`**: Indica un hallazgo de vulnerabilidades de fuentes como agente APM, agente de infraestructura o escáneres de terceros (Snyk, Trivy, FOSSA).
* **`findingType = 'MISCONFIGURATION'`**: Indica un hallazgo de gestión de la postura de seguridad cloud (CSPM) de Security RX Cloud (por ejemplo, de AWS Security Hub, GuardDuty o Config)

Otros valores de findingType incluyen: `LIBRARY_VULNERABILITY`, `INFRASTRUCTURE_VULNERABILITY`, `APPLICATION_VULNERABILITY`, `SYSTEM_VULNERABILITY`, `SECURITY_EVENT` y `OTHER`.

#### Campos de entidad principal

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Ejemplo
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `id`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Identificador único global para este SecurityFinding (objetivo específico CVE y entidad impactada)
      </td>

      <td>
        &quot;ABC123...&quot;
      </td>
    </tr>

    <tr>
      <td>
        `type`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de entidad: siempre &quot;SECURITY_FINDING&quot;
      </td>

      <td>
        &quot;SECURITY_FINDING&quot;
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Título de las vulnerabilidades o mala configuración
      </td>

      <td>
        &quot;CVE-2024-12345: Inyección SQL en nombre-biblioteca&quot;
      </td>
    </tr>

    <tr>
      <td>
        `scope.id`
      </td>

      <td>
        Cadena
      </td>

      <td>
        ID de cuenta donde se detectó este hallazgo
      </td>

      <td>
        &quot;1234567&quot;
      </td>
    </tr>

    <tr>
      <td>
        `scope.type`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de alcance: normalmente &quot;ACCOUNT&quot;
      </td>

      <td>
        &quot;ACCOUNT&quot;
      </td>
    </tr>

    <tr>
      <td>
        `metadata.createdAt`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuando se creó esta entidad
      </td>

      <td>
        Timestamp de Unix
      </td>
    </tr>

    <tr>
      <td>
        `metadata.updatedAt`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuando se actualizó esta entidad por última vez
      </td>

      <td>
        Timestamp de Unix
      </td>
    </tr>

    <tr>
      <td>
        `tags`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Lista de etiquetas aplicables a la entidad (normalmente vacía para SecurityFinding)
      </td>

      <td>
        \[]
      </td>
    </tr>
  </tbody>
</table>

#### Campos de clasificación

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Ejemplo
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `vulnerabilityIdentifier`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Identificador para agregar SecurityFindings (normalmente CVE ID)
      </td>

      <td>
        &quot;CVE-2024-12345&quot;
      </td>
    </tr>

    <tr>
      <td>
        `findingType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de hallazgo de nivel superior
      </td>

      <td>
        &quot;VULNERABILITY&quot;, &quot;MISCONFIGURATION&quot;
      </td>
    </tr>

    <tr>
      <td>
        `findingSubType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Subtipo (lenguaje para vulnerabilidades de APM, INFRA_OS_VULNERABILITY o INFRA_PACKAGE_VULNERABILITY para infraestructura)
      </td>

      <td>
        &quot;java&quot;, &quot;INFRA_PACKAGE_VULNERABILITY&quot;
      </td>
    </tr>

    <tr>
      <td>
        `source`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Fuente del hallazgo
      </td>

      <td>
        &quot;New Relic&quot;, &quot;Snyk&quot;, &quot;AWS Security Hub&quot;
      </td>
    </tr>
  </tbody>
</table>

#### Campos de estado y gravedad

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Valores
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `severity`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Gravedad informada del hallazgo
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;, &quot;UNKNOWN&quot;, &quot;INFO&quot;
      </td>
    </tr>

    <tr>
      <td>
        `status`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Estado actual del hallazgo
      </td>

      <td>
        &quot;AFFECTED&quot;, &quot;IGNORED&quot;, &quot;NO_LONGER_DETECTED&quot;, &quot;UNKNOWN&quot;
      </td>
    </tr>

    <tr>
      <td>
        `remediation.remediationExists`
      </td>

      <td>
        Booleano
      </td>

      <td>
        Si existe una remediación
      </td>

      <td>
        true, false
      </td>
    </tr>

    <tr>
      <td>
        `remediation.upgradeAction`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Actualización sugerida por Security RX
      </td>

      <td>
        &quot;Actualizar a la versión 2.17.1&quot;
      </td>
    </tr>

    <tr>
      <td>
        `remediation.remediationDetails`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Breve texto de remediación de la fuente
      </td>

      <td>
        &quot;Actualizar la biblioteca a la versión parcheada&quot;
      </td>
    </tr>

    <tr>
      <td>
        `remediation.url`
      </td>

      <td>
        Cadena
      </td>

      <td>
        URL de la documentación de la fuente
      </td>

      <td>
        &quot;

        [https://example.com/security-advisory](https://example.com/security-advisory)

        &quot;
      </td>
    </tr>
  </tbody>
</table>

#### Campos de referencia CVE

Para los hallazgos de vulnerabilidades, el objeto `cve` contiene información CVE detallada:

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `cve.id`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Identificador CVE
      </td>
    </tr>

    <tr>
      <td>
        `cve.description`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Descripción de CVE
      </td>
    </tr>

    <tr>
      <td>
        `cve.cvssScore`
      </td>

      <td>
        Número
      </td>

      <td>
        Puntaje CVSS
      </td>
    </tr>

    <tr>
      <td>
        `cve.cvssVector`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Cadena vectorial CVSS
      </td>
    </tr>

    <tr>
      <td>
        `cve.epssScore`
      </td>

      <td>
        Número
      </td>

      <td>
        Puntaje de probabilidad de explotación del EPSS
      </td>
    </tr>

    <tr>
      <td>
        `cve.epssPercentile`
      </td>

      <td>
        Número
      </td>

      <td>
        Clasificación percentil del EPSS
      </td>
    </tr>

    <tr>
      <td>
        `cve.exploitKnown`
      </td>

      <td>
        Booleano
      </td>

      <td>
        Si existe un exploit conocido
      </td>
    </tr>

    <tr>
      <td>
        `cve.disclosureUrl`
      </td>

      <td>
        Cadena
      </td>

      <td>
        URL donde se divulgó CVE
      </td>
    </tr>

    <tr>
      <td>
        `cve.disclosedAt`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuando se reveló el CVE
      </td>
    </tr>
  </tbody>
</table>

#### Campos de configuración incorrecta (hallazgos en la nube)

Para los hallazgos de configuración incorrecta, el objeto `misconfiguration` contiene información específica de la nube:

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `misconfiguration.cloudProvider`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Proveedor de nube
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.issueTitle`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Título de la configuración incorrecta
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.misconfigurationType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de hallazgo sin procesar de la fuente
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.normalizedResourceType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de recurso simplificado (por ejemplo, &quot;S3&quot;, &quot;EC2&quot;, &quot;RDS&quot;)
      </td>
    </tr>
  </tbody>
</table>

#### Campos de entidad impactados

El objeto `impactedEntity` identifica qué entidad de New Relic está afectada:

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `impactedEntity.id`
      </td>

      <td>
        Cadena
      </td>

      <td>
        GUID de entidad
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.name`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Nombre de la entidad
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.type`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de entidad (APM-APPLICATION, INFRA-HOST, etc.)
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.scope.id`
      </td>

      <td>
        Cadena
      </td>

      <td>
        ID de la cuenta
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.scope.type`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de alcance
      </td>
    </tr>
  </tbody>
</table>

#### campos de marca de tiempo

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `firstDetected`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuando se detectó el hallazgo por primera vez
      </td>
    </tr>

    <tr>
      <td>
        `findingUpdatedAt`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuándo se actualizó por última vez el hallazgo
      </td>
    </tr>

    <tr>
      <td>
        `lastSeen`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuándo se supo por última vez que el hallazgo estaba activo
      </td>
    </tr>
  </tbody>
</table>

#### UI y campos internos

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `vulnerabilityUILinks.detailsUrl`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Enlace a la página de detalles en UI Security RX
      </td>
    </tr>

    <tr>
      <td>
        `vulnerabilityUILinks.tabUrl`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Enlace a la vista de entidad en UI Security RX
      </td>
    </tr>

    <tr>
      <td>
        `internalState.status`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Campo de estado interno
      </td>
    </tr>

    <tr>
      <td>
        `internalState.active`
      </td>

      <td>
        Booleano
      </td>

      <td>
        Bandera activa interna (usada en cloud Consulta)
      </td>
    </tr>

    <tr>
      <td>
        `entityLookupValue`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Campo interno (estará oculto en producción)
      </td>
    </tr>

    <tr>
      <td>
        `issueInstanceKey`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Campo interno (estará oculto en producción)
      </td>
    </tr>

    <tr>
      <td>
        `additionalInfo`
      </td>

      <td>
        matriz de objetos
      </td>

      <td>
        Metadatos adicionales con pares principales de valor (empleados para ID de cuentas cloud, etc.)
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Los campos marcados como &quot;internos&quot; están actualmente visibles en NRDB, pero pueden estar ocultos en el lanzamiento final. El campo `internalState.active` se usa comúnmente en consultas de configuración incorrecta cloud para filtrar hallazgos activos.
</Callout>

#### ejemplos de consulta para vulnerabilidades

**Contar vulnerabilidades críticas activas por entidad:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND severity = 'CRITICAL'
FACET impactedEntity.name
```

**Buscar entidad afectada por un CVE específico:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND cve.id = 'CVE-2024-23944'
FACET impactedEntity.name
```

**Encuentre CVE con campañas de ransomware activas:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.exploitKnown IS true
FACET impactedEntity.name, cve.id
```

**Encuentre vulnerabilidades que puedan explotar (puntaje EPSS alta):**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.epssPercentile > '0.95'
FACET cve.id
```

**Encuentre fuentes de información para sus hallazgos:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
FACET source
```

**entidad con alto umbral de vulnerabilidades:**

```sql
SELECT impactedEntity
FROM (
  SELECT count(*) AS vulnerableCount
  FROM Entity
  WHERE type = 'SECURITY_FINDING'
    AND severity IN ('CRITICAL', 'HIGH')
  FACET impactedEntity.name AS impactedEntity, severity
)
WHERE (severity = 'HIGH' AND vulnerableCount > 10)
   OR (severity = 'CRITICAL' AND vulnerableCount > 5)
```

#### Consulta ejemplos de configuraciones incorrectas cloud

**Contar configuraciones erróneas únicas por estado:**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET status
```

**Los 10 tipos de configuración incorrecta más comunes:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.issueTitle
LIMIT 10
```

**Encuentre las cuentas de AWS más riesgosas:**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity IN ('CRITICAL', 'HIGH')
FACET aparse(additionalInfo, '%"key":"cloudProviderAccountId","values":["*"]%') AS 'AWS Account ID'
LIMIT 10
```

**Contar configuraciones erróneas por tipo de recurso:**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.normalizedResourceType
```

**Encuentre recursos críticos y expuestos públicamente:**

```sql
FROM Entity
SELECT name, impactedEntity.name, misconfiguration.misconfigurationType
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity = 'CRITICAL'
  AND misconfiguration.misconfigurationType LIKE 'Effects/Data Exposure'
SINCE 1 day ago
```

### NrAiIncident (legado)

Tipo de evento heredado que almacena los hallazgos de vulnerabilidades y su estado actual. Este tipo de evento aún se admite por compatibilidad con versiones anteriores, pero recomendamos usar `SecurityFinding` para nuevas consultas.

**Uso principal:** consulta de vulnerabilidades que afectan a su entidad

**Atributo clave:**

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Ejemplo
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `title`
      </td>

      <td>
        Cadena
      </td>

      <td>
        título de vulnerabilidades
      </td>

      <td>
        &quot;CVE-2024-12345: Inyección SQL en nombre-biblioteca&quot;
      </td>
    </tr>

    <tr>
      <td>
        `priority`
      </td>

      <td>
        Cadena
      </td>

      <td>
        calcular el rango de prioridad
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;
      </td>
    </tr>

    <tr>
      <td>
        `state`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Estado actual de vulnerabilidades
      </td>

      <td>
        &quot;OPEN&quot;, &quot;CLOSED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `acknowledged`
      </td>

      <td>
        Booleano
      </td>

      <td>
        Si se revisó vulnerabilidades
      </td>

      <td>
        `true`, `false`
      </td>
    </tr>

    <tr>
      <td>
        `conditionName`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Fuente/condición de detección
      </td>

      <td>
        &quot;Security RX - Detección de vulnerabilidades&quot;
      </td>
    </tr>

    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        entidad GUID afectada por vulnerabilidades
      </td>

      <td>
        &quot;ABC123...&quot;
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Nombre de la entidad
      </td>

      <td>
        &quot;my-application&quot;
      </td>
    </tr>

    <tr>
      <td>
        `entityType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de entidad afectada
      </td>

      <td>
        &quot;APPLICATION&quot;, &quot;HOST&quot;
      </td>
    </tr>
  </tbody>
</table>

**Ejemplo de consulta:**

```sql
FROM NrAiIncident
SELECT count(*)
WHERE conditionName LIKE '%Security RX%'
FACET priority, state
```

### Vulnerabilidades (evento personalizado)

Almacena metadatos detallados sobre vulnerabilidades, incluida información CVE, puntajes de gravedad y orientación para su remediación.

**Uso principal:** Profundizar en los detalles de las vulnerabilidades y los metadatos.

**Atributo clave:**

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Ejemplo
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `cveId`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Identificador CVE
      </td>

      <td>
        &quot;CVE-2024-12345&quot;
      </td>
    </tr>

    <tr>
      <td>
        `severity`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Gravedad basada en CVSS
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;
      </td>
    </tr>

    <tr>
      <td>
        `cvssScore`
      </td>

      <td>
        Número
      </td>

      <td>
        Puntaje numérico del CVSS
      </td>

      <td>
        9.8
      </td>
    </tr>

    <tr>
      <td>
        `epssScore`
      </td>

      <td>
        Número
      </td>

      <td>
        Probabilidad de explotación del EPSS
      </td>

      <td>
        0,95
      </td>
    </tr>

    <tr>
      <td>
        `epssPercentile`
      </td>

      <td>
        Número
      </td>

      <td>
        Clasificación percentil del EPSS
      </td>

      <td>
        98.5
      </td>
    </tr>

    <tr>
      <td>
        `activeRansomware`
      </td>

      <td>
        Booleano
      </td>

      <td>
        Empleado en campañas de ransomware conocidas
      </td>

      <td>
        `true`, `false`
      </td>
    </tr>

    <tr>
      <td>
        `affectedPackage`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Nombre de biblioteca/paquete vulnerable
      </td>

      <td>
        &quot;log4j-core&quot;
      </td>
    </tr>

    <tr>
      <td>
        `affectedVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Versión del paquete vulnerable
      </td>

      <td>
        &quot;2.14.0&quot;
      </td>
    </tr>

    <tr>
      <td>
        `fixedVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Versión con corrección
      </td>

      <td>
        &quot;2.17.1&quot;
      </td>
    </tr>

    <tr>
      <td>
        `entityGuid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        GUID de la entidad afectada
      </td>

      <td>
        &quot;ABC123...&quot;
      </td>
    </tr>

    <tr>
      <td>
        `source`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Fuente de detección
      </td>

      <td>
        &quot;APM\_AGENT&quot;, &quot;SNYK&quot;, &quot;AWS\_SECURITY\_HUB&quot;
      </td>
    </tr>
  </tbody>
</table>

**Ejemplo de consulta:**

```sql
FROM Vulnerability
SELECT count(*)
WHERE severity = 'CRITICAL'
AND activeRansomware = true
FACET affectedPackage
```

### NrAiIncidentTimeline

Realiza un seguimiento de los cambios de estado y los eventos del ciclo de vida en busca de vulnerabilidades.

**Uso principal:** Auditar el historial del estado de las vulnerabilidades y realizar un seguimiento del progreso de la remediación.

**Atributo clave:**

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Tipo
      </th>

      <th>
        Descripción
      </th>

      <th>
        Ejemplo
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `incidentId`
      </td>

      <td>
        Cadena
      </td>

      <td>
        ID de incidentes/vulnerabilidades relacionados
      </td>

      <td>
        &quot;INC-123&quot;
      </td>
    </tr>

    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        Timestamp
      </td>

      <td>
        Cuando el estado cambió
      </td>

      <td>
        Timestamp de Unix
      </td>
    </tr>

    <tr>
      <td>
        `event`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Tipo de cambio
      </td>

      <td>
        &quot;STATUS\_CHANGED&quot;, &quot;DETECTED&quot;, &quot;RESOLVED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `previousState`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Estado antes del cambio
      </td>

      <td>
        &quot;AFFECTED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `newState`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Estado luego del cambio
      </td>

      <td>
        &quot;IGNORED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `changedBy`
      </td>

      <td>
        Cadena
      </td>

      <td>
        usuario que realizó el cambio
      </td>

      <td>
        &quot;[user@example.com](mailto:user@example.com)&quot;
      </td>
    </tr>

    <tr>
      <td>
        `reason`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Motivo del cambio de estado
      </td>

      <td>
        &quot;Falso positivo: no se emplea la ruta de código vulnerable&quot;
      </td>
    </tr>
  </tbody>
</table>

**Ejemplo de consulta:**

```sql
FROM NrAiIncidentTimeline
SELECT timestamp, event, previousState, newState, changedBy
WHERE event = 'STATUS_CHANGED'
SINCE 7 days ago
```

## Atributo común entre los tipos de eventos

Estos atributos aparecen en múltiples tipos de eventos:

### Identificación de la entidad

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        Identificador único de la entidad afectada
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        Nombre de entidad legible para humanos
      </td>
    </tr>

    <tr>
      <td>
        `entity.type`
      </td>

      <td>
        tipo de entidad (APPLICATION, HOST, SERVICE)
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        ID de cuenta de New Relic
      </td>
    </tr>
  </tbody>
</table>

### Marca de tiempo

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        Cuando ocurrió el evento
      </td>
    </tr>

    <tr>
      <td>
        `detectedAt`
      </td>

      <td>
        Cuando se detectó por primera vez la vulnerabilidad
      </td>
    </tr>

    <tr>
      <td>
        `updatedAt`
      </td>

      <td>
        timestampde la última actualización
      </td>
    </tr>

    <tr>
      <td>
        `resolvedAt`
      </td>

      <td>
        Cuando vulnerabilidades fue marcada como resuelta
      </td>
    </tr>
  </tbody>
</table>

### Seguimiento de la fuente

<table>
  <thead>
    <tr>
      <th>
        Atributo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `source`
      </td>

      <td>
        Fuente de datos (APM\_AGENT, INFRASTRUCTURE, SNYK, etc.)
      </td>
    </tr>

    <tr>
      <td>
        `sourceId`
      </td>

      <td>
        ID única del sistema de origen
      </td>
    </tr>

    <tr>
      <td>
        `integrationName`
      </td>

      <td>
        integración que proporcionó datos
      </td>
    </tr>
  </tbody>
</table>

## Relaciones de datos

Comprender cómo se relacionan los tipos de datos entre sí:

### Enfoque moderno (recomendado)

```
SecurityFinding Entity (type = 'SECURITY_FINDING')
    ↓ contains
    ├─ findingType (VULNERABILITY or MISCONFIGURATION)
    ├─ cve (CVE details for vulnerabilities)
    ├─ misconfiguration (Cloud security details)
    └─ impactedEntity (Affected New Relic entity)
```

### Enfoque heredado (compatibilidad con versiones anteriores)

```
Entity (Application/Host)
    ↓ has many
NrAiIncident (Active vulnerabilities)
    ↓ references
Vulnerability (CVE details)
    ↓ has many
NrAiIncidentTimeline (Status history)
```

## Patrones de consulta

<Callout variant="tip">
  **Recomendado:** emplee `SecurityFinding` entidad consulta (que se muestra en la sección SecurityFinding anterior) para nuevas implementaciones. Los patrones a continuación emplean tipos de eventos legacy y se proporcionan únicamente para compatibilidad con versiones anteriores.
</Callout>

### Patrones de consulta modernos

Para conocer los patrones de consulta modernos que emplean la entidad SecurityFinding, consulte las [secciones de ejemplos de consulta anteriores](#query-examples-for-vulnerabilities).

### Patrones de consulta heredados

Estos patrones emplean los tipos de eventos legacy :

#### Unir datos de entidad con vulnerabilidades (legacy)

```sql
FROM NrAiIncident
SELECT entity.name, count(*) as 'Vulnerability Count'
WHERE conditionName LIKE '%Security RX%'
AND state = 'OPEN'
FACET entity.name
SINCE 1 day ago
```

**Equivalente moderno:**

```sql
FROM Entity
SELECT impactedEntity.name, count(*) as 'Vulnerability Count'
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
FACET impactedEntity.name
SINCE 1 day ago
```

#### Calcular ventanas de exposición (heredadas)

```sql
FROM Vulnerability
SELECT entity.name,
       cveId,
       (max(timestamp) - min(timestamp)) / 86400 as 'Days Exposed'
WHERE severity IN ('CRITICAL', 'HIGH')
FACET entity.name, cveId
SINCE 30 days ago
```

**Equivalente moderno:**

```sql
FROM Entity
SELECT impactedEntity.name,
       cve.id,
       (max(findingUpdatedAt) - min(firstDetected)) / 86400 as 'Days Exposed'
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
FACET impactedEntity.name, cve.id
SINCE 30 days ago
```

#### Velocidad de remediación de la pista (heredada)

```sql
FROM NrAiIncidentTimeline
SELECT count(*) as 'Vulnerabilities Resolved'
WHERE event = 'STATUS_CHANGED'
AND newState = 'CLOSED'
FACET weekOf(timestamp)
SINCE 90 days ago
```

<Callout variant="important">
  Para rastrear los cambios de estado con la entidad SecurityFinding, monitoree los cambios en el campo `status` a lo largo del tiempo o use las alertas New Relic para recibir notificaciones cuando ocurran cambios de estado.
</Callout>

## Tipos y formatos de atributos

### Valores de gravedad

```
CRITICAL - CVSS 9.0-10.0
HIGH     - CVSS 7.0-8.9
MEDIUM   - CVSS 4.0-6.9
LOW      - CVSS 0.1-3.9
INFO     - CVSS 0.0
```

### Valores estatales

```
OPEN      - Vulnerability currently active
CLOSED    - Vulnerability resolved or fixed
AFFECTED  - Entity is confirmed affected
IGNORED   - Marked as not applicable
NO_LONGER_DETECTED - No longer seen in scans
```

### Valores fuente

```
APM_AGENT            - Detected by New Relic APM agent
INFRASTRUCTURE       - Detected by Infrastructure agent
SNYK                 - Imported from Snyk
AWS_SECURITY_HUB     - Imported from AWS Security Hub
DEPENDABOT           - Imported from GitHub Dependabot
FOSSA                - Imported from FOSSA
TRIVY                - Imported from Trivy
SECURITY_DATA_API    - Sent via API
```

## Consejos para realizar consultas

### Filtrar por gravedad (enfoque moderno)

Los hallazgos se priorizan según su gravedad:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
  AND status = 'AFFECTED'
FACET impactedEntity.name
```

### Filtrar por tipo de búsqueda

Separe las vulnerabilidades de las configuraciones incorrectas:

```sql
-- Vulnerabilities only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'VULNERABILITY'
FACET impactedEntity.type

-- Misconfigurations only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET misconfiguration.normalizedResourceType
```

### Filtrar por tipo de entidad

Separar las vulnerabilidades de la aplicación de la infraestructura:

```sql
-- Application vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%APPLICATION%'
FACET impactedEntity.name

-- Infrastructure vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%HOST%'
FACET impactedEntity.name
```

### Filtrar por fuente de detección

resultados de la consulta de integración específica:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND source = 'Snyk'
FACET severity
```

### Filtrado basado en el tiempo

Encuentre hallazgos detectados recientemente:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND firstDetected > ago(7 days)
FACET cve.id, severity
```

## Creación de dashboards personalizados

Emplee la entidad SecurityFinding para crear un dashboard de seguridad completo:

1. **Dashboard ejecutivo** : métrica de seguridad de alto nivel en todos los tipos de hallazgos

   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET severity, findingType
   ```

2. **Tendencias de vulnerabilidades** : seguimiento de la detección de vulnerabilidades a lo largo del tiempo.

   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'VULNERABILITY'
   FACET weekOf(firstDetected)
   SINCE 90 days ago
   ```

3. **Postura de seguridad en la nube** : Monitorear las configuraciones incorrectas cloud

   ```sql
   FROM Entity
   SELECT uniqueCount(misconfiguration.issueTitle)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'MISCONFIGURATION'
   FACET misconfiguration.cloudProvider, severity
   ```

4. **Postura de seguridad de la entidad** - Vistas de seguridad por entidad

   ```sql
   FROM Entity
   SELECT count(*) AS 'Findings'
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET impactedEntity.name, severity
   ```

Para obtener más ejemplos de consulta, consulte [Ejemplos de consulta de datos de seguridad](/docs/vulnerability-management/advanced/query-examples).

### Enfoques dashboards heredados

Para mantener la compatibilidad con versiones anteriores, aún puede usar los tipos de eventos legacy (`NrAiIncident`, `Vulnerability`, `NrAiIncidentTimeline`), pero recomendamos migrar a la entidad SecurityFinding para el nuevo dashboard.

## ¿Que sigue?

<DocTiles>
  <DocTile title="Ejemplos de consulta" path="/docs/vulnerability-management/advanced/query-examples">
    Consulta NRQL lista para usar para escenarios de seguridad comunes
  </DocTile>

  <DocTile title="Configurar alerta" path="/docs/vulnerability-management/advanced/set-up-alerts">
    Crear alertas basadas en NRQL para vulnerabilidades
  </DocTile>

  <DocTile title="Gestionar el estado de vulnerabilidades" path="/docs/vulnerability-management/advanced/manage-vulnerability-status">
    Cambiar el estado de las vulnerabilidades y realizar un seguimiento de su remediación
  </DocTile>
</DocTiles>