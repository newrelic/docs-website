---
title: El agente .NET logs en el contexto
tags:
  - Logs
  - Enable log management in New Relic
  - Configure logs in context
metaDescription: 'For apps monitored by .NET, learn how to link log data with related data across the rest of the New Relic platform.'
freshnessValidatedDate: never
translationType: machine
---

Con nuestro <InlinePopover type="apm" />agente .NET, puede obtener <DNT>**logs in context**</DNT>, que le permite ver el registro de su aplicación en el contexto de sus otros datos New Relic . Para obtener información general sobre esta característica, consulte [logs en el contexto APM ](/docs/apm/new-relic-apm/getting-started/get-started-logs-context).

<Callout variant="tip">
  ¿Tienes muchos registros .Net? Consulte nuestro [tutorial sobre cómo optimizarlos y administrarlos](/docs/tutorial-large-logs/get-started-managing-large-logs/).
</Callout>

## Opciones de logs en el contexto automático [#automatic]

Tienes tres opciones para configurar <InlinePopover type="apm" />el logs en el contexto para enviar el registro de tu aplicación y vincular metadatos automáticamente a New Relic. El marco admitido para el inicio de logs en el contexto automático utilizando el reenvío de agentes incluye:

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Frameworks
      </th>

      <th>
        Versión mínima framework
      </th>

      <th>
        Versión mínima del agente
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Log4Net
      </td>

      <td>
        Para framework.NET: v1.2.10

        Para .NET Core: v2.0.10
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        Serilog
      </td>

      <td>
        Para framework.NET: v2.0.0

        Para .NET Core: v2.5.0
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        NLog
      </td>

      <td>
        Para framework.NET: v4.1.0

        Para .NET Core: v4.5.0
      </td>

      <td>
        v9.7.0
      </td>
    </tr>

    <tr>
      <td>
        Microsoft.Extensions.Logging
      </td>

      <td>
        v3.0.0
      </td>

      <td>
        Para .NET framework: agente v9.7.0

        Para ..NET Core: agente v10.0.0
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Muchas versiones de Sitecore utilizan Sitecore.Logging, que se basa en una bifurcación de log4net, pero es independiente. Se agregó soporte para esta biblioteca en la versión 10.14.0 del agente .NET.
</Callout>

<CollapserGroup>
  <Collapser id="1-agent" title="Opción 1 (la más simple): dejar que el agente reenvíe los mensajes de su log.">
    Este es el enfoque más simple y es una excelente opción para desarrolladores que quizás no tengan acceso o interés en configurar un reenviador de registros, o para cuentas que quieran ver el poder de los registros y otros metadatos de enlace en el contexto de sus aplicaciones. sin muchos gastos generales.

    Al utilizar esta opción, su registro incluye `span.id`, `trace.id`, `hostname`, `entity.guid` y `entity.name`. [Obtenga más información sobre las limitaciones del reenvío de registros.](/docs/logs/logs-context/get-started-logs-context#forwarding-details)

    Todo lo que necesita hacer es instalar una versión del agente con capacidades de reenvío de registros ([.NET agente 9.7.0 o superior](/docs/release-notes/agent-release-notes/net-release-notes)). Si el reenvío está deshabilitado, puede habilitarlo agregando lo siguiente al archivo de configuración de su agente:

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000" />
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables de entorno:

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <Callout variant="important">
      El valor de la variable de entorno, si está presente, tiene prioridad sobre el valor del archivo de configuración.
    </Callout>

    A partir de la versión 9.8.0 del agente, esta característica está habilitada de forma predeterminada.

    A partir de la versión 10.4.0 del agente, el agente también admite la captura y reenvío de datos de contexto (atributo personalizado) desde el registro de eventos. Esta subcaracterística está deshabilitada por defecto. Para habilitarlo, utilice la siguiente configuración:

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000">
        <contextData enabled="true" include="" exclude="" />
      </forwarding>
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables de entorno:

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    New Relic utiliza datos de contexto con el prefijo &quot;contexto&quot;. Por ejemplo, un atributo log personalizado denominado `myKey` con valor `myValue` para New Relic es `context.myKey : myValue`.

    La biblioteca de registro .NET que utilizamos generalmente almacena pares principales de valores de datos de contexto en cada registro de evento como `Dictionary<string,object>`. Para convertir los valores en cadenas antes de enviarlos a New Relic, primero intentamos usar `Newtonsoft.Json.JsonConvert.SerializeObject`. Si eso falla, intentamos llamar `.ToString()` en el objeto; como último recurso enviaremos el nombre del tipo.

    Puede filtrar datos de contexto utilizando las opciones de configuración `include` y `exclude` . Estas son listas de nombres de atributos separados por comas. Los valores predeterminados para ambos son cadenas vacías; un campo `include` vacío significa &quot;incluir todo&quot;. Estas opciones de inclusión/exclusión siguen las mismas reglas que otras [opciones de configuración de atributos de agente](/docs/apm/agents/net-agent/attributes/enable-disable-attributes-net/#attruls).

    Por ejemplo, para incluir todos los atributos que comienzan con &quot;a&quot; excepto &quot;apple&quot; y excluir todos los atributos que comienzan con &quot;b&quot; excepto &quot;banana&quot;, use la siguiente configuración:

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000">
        <contextData enabled="true" include="a*, banana" exclude="b*, apple" />
      </forwarding>
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables de entorno:

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_INCLUDE="a*, banana"
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_EXCLUDE="b*, apple"
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <DNT>
      **Optional adjustments:**
    </DNT>

    Una vez habilitado el reenvío de registros, también tendrá control sobre la cantidad máxima de registros enviados a New Relic cada minuto. El valor predeterminado es 10.000. Si se reciben más de 10 000 registros en un período de 60 segundos, se comenzará a muestrear su registro.

    Configúrelo en un número más alto para recibir más registros. Configúrelo en un número más bajo para recibir menos registros. Cualquier número entero es válido.

    ```xml
    <applicationLogging enabled="true">
      <forwarding enabled="true" maxSamplesStored="10000" />
      <localDecorating enabled="false" />
    </applicationLogging>
    ```

    Variables de entorno:

    ```ini
    NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
    NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
    NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
    ```

    <Callout variant="important">
      El valor de la variable de entorno, si está presente, tiene prioridad sobre el valor del archivo de configuración.
    </Callout>

    Si ya tiene una solución de reenvío de logs y está actualizando su agente para usar el logs en el contexto automático, asegúrese de <DNT>**disable your manual log forwarder**</DNT>. De lo contrario, su aplicación enviará líneas log dobles. Dependiendo de su cuenta, esto podría resultar en una doble facturación. Para obtener más información, siga los procedimientos para desactivar su [reenviador de logs específico](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
  </Collapser>

  <Collapser id="2-decorate" title="Opción 2: deja que el agente decore tu tronco.">
    ¿Ya tienes un reenviador de logs que te gusta? ¡Te tenemos cubierto! Language Agent puede decorar su registro con los metadatos de enlace necesarios para proporcionar acceso a la característica de contexto de inicio de sesión automático.

    Esta opción no debe usarse con el reenvío dentro del agente. El uso de un [reenviador de registros externo](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding) para enviar registros a New Relic mientras el reenvío en el agente está habilitado hará que su registro se envíe dos veces a New Relic. Dependiendo de su cuenta, esto puede resultar en una facturación doble.

    <Callout variant="important">
      La decoración log local para el agente .NET no altera directamente el mensaje de registro. Será necesario actualizar la configuración de su framework de registro para escribir el token `NR-LINKING` en los mensajes. Para la salida JSON en log4net y Serilog, se requerirá configuración o código adicional.
    </Callout>

    1. Si desea utilizar esta opción, asegúrese de tener desactivada la opción de configuración de reenvío en el agente.

    2. Habilite la decoración log en su configuración, luego reinicie el agente para comenzar a decorar su tronco.

       ```xml
       <applicationLogging enabled="true">
         <forwarding enabled="false" />
         <localDecorating enabled="true" />
       </applicationLogging>
       ```

       Variables de entorno:

       ```ini
       NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
       NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=false
       NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=true
       ```

       <Callout variant="important">
         El valor de la variable de entorno, si está presente, tiene prioridad sobre el valor del archivo de configuración.
       </Callout>

       Nuestro decorador agrega cinco atributos a cada log `message` (texto sin formato): `entity.guid`, `entity.name`, `hostname`, `trace.id` y `span.id`. Ejemplo:

       ```
       This is my log message. NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}
       ```

       <Callout variant="important">
         Para JSON, los datos `NR-LINKING` deben estar en la propiedad `message` .
       </Callout>

       Si el mensaje de log está vacío o en blanco, el mensaje de salida también estará vacío. Ejemplo:

       ```
       NR-LINKING|{entity.guid}|{hostname}|{trace.id}|{span.id}|{entity.name}|.
       ```

       El mensaje de log de salida será una cadena vacía.

       Algunos atributos pueden estar vacíos si el log ocurrió fuera de una transacción o si no son aplicables al contexto de su aplicación. Recomendamos esta opción en lugar del proceso manual para utilizar un formateador decorativo.

       <Callout variant="important">
         La clave utilizada para leer el token `NR-LINKING` de un framework de registro es `NR_LINKING` y no `NR-LINKING` para admitir un marco de registro que no permite guiones en los nombres de las claves.
       </Callout>

       ### Configuración de log4net

       Para log4net, el agente .NET almacena el token `NR-LINKING` como una propiedad llamada `NR_LINKING` en el objeto de registro de eventos. Los siguientes ejemplos de diseño común demuestran cómo configurar log4net para escribir el token `NR-LINKING` . Se admiten otros diseños, pero no se enumeran a continuación. SimpleLayout no es compatible porque no se puede modificar.

       <DNT>**`PatternLayout`/`DynamicPatternLayout`**</DNT>: actualice `conversionPattern` para incluir la propiedad `NR_LINKING` al final de la línea.

       ```xml
       <layout type="log4net.Layout.PatternLayout">
         <conversionPattern value="%date %5level %logger.%method [%line] - MESSAGE: %message %property{NR_LINKING}%newline %exception" />
       </layout>
       ```

       <DNT>**`log4net.Ext.Json`**</DNT>: actualice el diseño para incluir un miembro llamado `NR_LINKING` en la propiedad JSON del mensaje.

       <DNT>**`log4net.Appender.AdoNetAppender`**</DNT>: este apéndice tiene una configuración ligeramente diferente a la de otros diseños. Deberá actualizar el parámetro `message` para incluir los metadatos. El siguiente ejemplo demuestra esto usando un `PatternLayout`.

       ```xml
       <parameter>
         <parameterName value="@message" />
         <dbType value="String" />
         <size value="4000" />
         <layout type="log4net.Layout.PatternLayout">
           <conversionPattern value="%message %property{NR_LINKING}" />
         </layout>
       </parameter>
       ```

       ### Configuración de Serilog

       Para Serilog, el agente .NET almacena el token `NR-LINKING` como una propiedad llamada `NR_LINKING` en el objeto de registro de eventos. Los siguientes ejemplos comunes de formateador y receptor demuestran cómo configurar Serilog para escribir el token `NR-LINKING` . Se admiten otros receptores y formateadores, pero no se enumeran a continuación.

       <DNT>**Plain text using an `outputTemplate`**</DNT>: actualice `outputTemplate` para incluir la propiedad `NR_LINKING` al final de la línea.

       ```csharp
       Log.Logger = new LoggerConfiguration()
           .MinimumLevel.Override("Microsoft", LogEventLevel.Information)
           .Enrich.FromLogContext()
           .WriteTo.File(
               path: @"plaintext_log.txt",
               fileSizeLimitBytes: 1_000_000,
               rollOnFileSizeLimit: true,
               shared: true,
               flushToDiskInterval: TimeSpan.FromSeconds(1),
               outputTemplate: "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] {Message:lj} {NR_LINKING} {NewLine}{Exception}"
           )
           .CreateLogger();
       ```

       <DNT>**JSON Formatter with automatic property output**</DNT>: El JsonFormatter predeterminado no escribirá los metadatos `NR_LINKING` en la propiedad del mensaje; en cambio, escribe cada propiedad en su propio objeto JSON. Deberá crear un formateador JSON personalizado para escribir los datos `NR_LINKING` al final de la propiedad `message` antes de que funcione el logs en el contexto.

       ### Configuración de Microsoft.Extensions.Logging

       Para Microsoft.Extensions.Logging, el agente .NET almacena el token `NR-LINKING` con el mensaje en un ámbito recién creado. Dado que Microsoft.Extensions.Logging depende de otro marco para la salida, consulte la configuración de log4net o Serilog anterior para obtener más detalles.

       ### Configuración de registro N

       Para NLog, el agente .NET puede agregar automáticamente el token `NR-LINKING` directamente al final del mensaje, por lo que no se requiere configuración adicional.
  </Collapser>

  <Collapser id="3-old-formatter" title="Opción 3: utilizar el proceso manual para reenviar y decorar el registro.">
    Antes de que Language Agent tuviera la capacidad de reenviar y decorar registros, podía habilitar el logs en el contexto actualizando su aplicación para enviar metadatos de enlace.

    Esta opción todavía se admite, pero ya no se recomienda. Para obtener instrucciones sobre cómo utilizar este enfoque, consulte [Opción de logs en el contexto manual](#enable-logs-net).

    Además, este método requiere que instale un reenviador de registros antes de habilitar el logs en el contexto. Si no tiene un reenviador de registros, la New Relic UI le indicará que utilice nuestro [agente de infraestructura](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/).

    Si decide utilizar su solución de reenvío de registros existente y luego decide actualizar su agente para usar el logs en el contexto automático, asegúrese de <DNT>**disable your manual log forwarder**</DNT>. De lo contrario, su aplicación enviará líneas log dobles. Dependiendo de su cuenta, esto podría resultar en una doble facturación. Para obtener más información, siga los procedimientos para desactivar su [reenviador de registros específico](/docs/logs/forward-logs/enable-log-management-new-relic#log-forwarding).
  </Collapser>
</CollapserGroup>

<InstallFeedback />

## Asegure sus datos [#obfuscation]

Su registro puede incluir información confidencial protegida por HIPAA u otros protocolos de cumplimiento. De forma predeterminada, ofuscamos los patrones numéricos que parecen corresponder a elementos como tarjetas de crédito o números de Seguro Social, pero es posible que deba aplicar hash o enmascarar información adicional.

Para más información, véase [expresión de ofuscación y reglas](/docs/logs/ui-data/obfuscation-ui/). Puede hash o enmascarar sus log datos utilizando la New Relic UI o utilizando NerdGraph, nuestra GraphQL.API

## Explora tus datos [#view-ui]

Para aprovechar al máximo sus datos de registro:

* En la [páginaAPM <DNT>**Summary**</DNT> ](/docs/apm/apm-ui-pages/monitoring/apm-summary-page-view-transaction-apdex-usage-data), haga clic en su gráfico <DNT>**Web transaction time**</DNT> para ver el registro asociado con un momento específico.
* Verifique [<DNT>**Errors inbox**</DNT>](/docs/errors-inbox/errors-inbox) de su aplicación para ver el registro asociado con sus errores.
* Utilice [rastreo distribuido](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui) para ver el registro asociado a la traza individual.
* Explore más datos de registro en su plataforma con nuestra [UI de logs](/docs/logs/log-management/ui-data/use-logs-ui/).
* Configure [alertas](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/) basadas en la salida log y la gravedad.
* [consulte sus datos](/docs/logs/ui-data/query-syntax-logs/) utilizando nuestra UI especializada para registrar datos y [cree un panel](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/) con los resultados.

## Consejos de resolución de problemas [#troubleshooting]

Normalmente, su registro comenzará a aparecer menos de un minuto después de habilitar el logs en el contexto APM. Consulta la sección <DNT>**Triage &gt; Logs**</DNT> de tu aplicación. Allí también comenzará a ver [patrones de registros](/docs/logs/ui-data/find-unusual-logs-log-patterns) relacionados con el error.

Si no ve ningún registro de errores o traza, es posible que no haya ninguno para su aplicación. Intente actualizar la página UI o cambie el [período de tiempo seleccionado](/docs/new-relic-one/ui-data/basic-ui-features/#data-analysis).

## Deshabilitar el registro automático [#disable-automatic]

El logs en el contexto APM reenvía automáticamente <InlinePopover type="apm" />datos log del agente y está habilitado de forma predeterminada. Esto puede tener un impacto negativo en su seguridad, cumplimiento, facturación o rendimiento del sistema. Para obtener más información, o si necesita ajustar la configuración predeterminada, siga los procedimientos para [desactivar el registro automático](/docs/logs/logs-context/disable-automatic-logging).

## Opción de logs en el contexto manual [#enable-logs-net]

Si necesita utilizar el proceso manual para configurar el logs en el contexto para .NET, siga estos pasos:

1. Asegúrate de haber [configurado el inicio de sesión en New Relic](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/). Esto incluye la configuración de un reenviador de registros compatible que recopile su registro de aplicación y extienda los metadatos que se reenvían a New Relic.
2. [Instale](/install/dotnet) o [actualice](/docs/agents/net-agent/installation/update-net-agent) a la última versión de .NET agente y [habilite rastreo distribuido](/docs/distributed-tracing/enable-configure/quick-start/). Utilice [.NET agente versión 8.21 o superior](/docs/release-notes/agent-release-notes/net-release-notes/) y [New Relic .NET API del agente versión 8.21 o superior](/docs/agents/net-agent/net-agent-api) para logs en el contexto.
3. Instale o actualice a Microsoft [.NET Framework 4.5 o superior](https://dotnet.microsoft.com/download/dotnet-framework) o [.NET Core 2.0 o superior](https://dotnet.microsoft.com/download/dotnet-core).
4. Instale y configure cualquiera de las siguientes extensiones de registro para enriquecer sus datos log , incluidas:

* [log4net](#log4net)
* [NLog](#nlog)
* [Serilog](#serilog)

5. Verifique sus log datos en la New Relic UI.

### Configurar la extensión log4net [#log4net]

Puede utilizar la extensión [Apache log4net versión 2.0.8 o superior](https://logging.apache.org/log4net/) para vincular sus datos log con datos relacionados en el resto de la plataforma New Relic .

<CollapserGroup>
  <Collapser id="example-log4net" title="Diagrama de flujo de trabajo de log4net">
    El siguiente diagrama ilustra el flujo de mensajes de registro a través de Apache log4net, destacando componentes específicos de la extensión New Relic log4net. Hay muchos reenviadores de logs disponibles. Este ejemplo utiliza [Fluentd](https://www.fluentd.org/).

    <img title="log4net extension for logs in context with New Relic's .NET agent" alt="Logs In Context - Log4Net" src="/images/logs_diagram_dotnet-logs-in-context.webp" />

    <DNT>**Appender:**</DNT> El `NewRelicAppender` agrega información contextual del agente .NET (usando la API) al registro de eventos generado por la aplicación. New Relic utiliza esta información contextual, conocida como metadatos de enlace, para vincular el mensaje de registro con la transacción y los tramos a partir de los cuales se crearon. Este agregador pasará el registro de eventos enriquecido a los agregadores posteriores para su posterior procesamiento.

    Dado que `NewRelicAppender` es del tipo `ForwardingAppender` , debe ser el primer agregado de la cadena. También requiere otro apéndice que pueda escribir en un destino de salida real como su hijo para poder funcionar.

    <DNT>**Layout:**</DNT> `NewRelicLayout` formatea el registro de eventos enriquecido en el formato JSON esperado por New Relic. El adjunto, al que está asignado este diseño, indica a log4net que envíe el JSON a un archivo en la ubicación que espera el reenviador de registros.

    <DNT>**Log Forwarder**</DNT>: El reenviador de registros monitorea una carpeta de salida y envía incrementalmente la información log enriquecida y formateada correctamente al extremo de registro New Relic .
  </Collapser>

  <Collapser id="config-log4net" title="Configuración log4net 2.0.8 o superior">
    Log4net utiliza `appender` y `layout` para almacenar y formatear mensajes de registro. [`NewRelicAppender`](https://github.com/newrelic/newrelic-logenricher-dotnet/tree/master/src/Log4Net) enriquece el mensaje de registro con información contextual del agente .NET New Relic si está adjunto a su aplicación. El agregador pasa el mensaje de registro enriquecido a los agregadores posteriores para manejar casos de uso específicos para el mensaje de registro.

    Para obtener más información sobre cómo iniciar sesión con log4net, consulte la documentación [de introducción a](https://logging.apache.org/log4net/) Apache log4net.

    Para configurar el logs en el contexto con la extensión log4net:

    1. Usando el [administrador de paquetes de Visual Studio NuGet](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), ubique e instale el paquete [`NewRelic.LogEnrichers.Log4Net`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Log4Net/) .

    2. En su archivo de configuración de log4net, actualice su configuración de registro para usar `NewRelicAppender` como agregador de primer nivel y haga referencia a sus agregados existentes como sus hijos. También reemplace el diseño del apéndice que escribe el mensaje de registro en un destino de salida con `NewRelicLayout`.

       El siguiente ejemplo de configuración de log4net enriquece el registro de eventos con metadatos de enlace New Relic . Además del archivo de registro existente, genera un nuevo archivo de registro en un formato JSON específico en `C:\logs\log4netExample.log.json` para que lo consuma el reenviador de registros:

       ```xml
       <log4net>
         <root>
           <level value="ALL" />
           <appender-ref ref="NewRelicAppender" />
         </root>

         <appender name="NewRelicAppender" type="NewRelic.LogEnrichers.Log4Net.NewRelicAppender, NewRelic.LogEnrichers.Log4Net" >
           <threshold value="ALL"/>
           <appender-ref ref="FileAppender" />
         </appender>

         <appender name="FileAppender" type="log4net.Appender.FileAppender">
           <file value="C:\logs\log4netExample.log.json" />
           <param name="AppendToFile" value="true" />
           <layout type="NewRelic.LogEnrichers.Log4Net.NewRelicLayout, NewRelic.LogEnrichers.Log4Net">
           </layout>
         </appender>
       </log4net>
       ```

       Después de configurar la extensión log4net y actualizar su archivo de registro, puede configurar su extensión para enviar datos a New Relic. Hay [varias opciones](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) para reenviar sus registros. Aquí hay un ejemplo de configuración usando el agente de infraestructura para logs en el contexto:

       ```yml
       logs:
         - name: application-log
           file: C:\logs\log4netExample.log.json # Path to a single log file
       ```

       [Documentación para utilizar el reenviador del agente de infraestructura](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>
</CollapserGroup>

### Configurar la extensión NLog [#nlog]

Puede utilizar nuestra extensión [NLog 4.5 o superior](https://nlog-project.org/) para vincular sus datos log con datos relacionados en el resto de la plataforma New Relic .

<CollapserGroup>
  <Collapser id="example-nlog" title="Diagrama de flujo de trabajo NLog">
    La [extensión New Relic NLog](https://github.com/newrelic/newrelic-logenricher-dotnet) proporciona un `NewRelicJsonLayout` que formatea un registro de eventos de la forma requerida por el extremo de registro New Relic . A continuación, agrega información contextual del agente .NET cuando se adjunta a su aplicación. Luego, se puede configurar un objetivo para escribir datos de registro en una carpeta de salida. El reenviador de registros puede monitor esta carpeta y enviar incrementalmente información log a New Relic.

    El siguiente diagrama ilustra el flujo de mensajes de registro a través de NLog, destacando componentes específicos de la extensión New Relic NLog.

    <img title="NLog extension for logs in context with New Relic's .NET agent" alt="Logs In Context - NLog" src="/images/logs_diagram_dotnet-logs-in-context.webp" />

    <DNT>**New Relic JSON Layout**</DNT>: `NewRelicJsonLayout` agrega información contextual del agente .NET (usando la API) al registro de eventos generado por la aplicación y genera un mensaje de registro en el formato JSON esperado por New Relic. New Relic utiliza esta información contextual, conocida como metadatos de enlace, para vincular el mensaje de registro con la transacción y los tramos donde se crearon.

    Dado que `NewRelicAppender` es del tipo `ForwardingAppender` , debe ser el primer agregado de la cadena. También requiere otro apéndice que pueda escribir en un destino de salida real como su hijo para poder funcionar.

    <DNT>**File Target**</DNT>: Un `FileTarget` define un archivo en el disco donde se escriben los mensajes de registro. Agregar el `NewRelicJsonLayout` a ese objetivo permite que la salida se formatee correctamente para reenviarla a New Relic.

    <DNT>**Log Forwarder**</DNT>: El reenviador de registros está configurado para enviar los datos log enriquecidos y formateados correctamente desde la salida `FileTarget` al extremo de registro New Relic .

    Para obtener más información sobre cómo iniciar sesión con NLog, consulte la [documentación de nlog-project.org](https://nlog-project.org/download/).
  </Collapser>

  <Collapser id="config-nlog" title="Configuración NLog 4.5 o superior">
    Utilice nuestra extensión [NLog 4.5 o superior](https://nlog-project.org/) para vincular sus datos log con datos relacionados en el resto de la plataforma New Relic .

    1. Usando el [administrador de paquetes de Visual Studio NuGet](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), ubique e instale el paquete [`NewRelic.LogEnrichers.NLog`](https://www.nuget.org/packages/NewRelic.LogEnrichers.NLog/) .

    2. En el código de su aplicación, actualice su configuración de registro para agregar `NewRelicJsonLayout` y decida si desea recopilar datos de MappedDiagnosticsContext (<DNT>**MDC**</DNT>) o MappedDiagnosticsLogicalContext (<DNT>**MDLC**</DNT>).

       Los siguientes ejemplos de configuración dan como resultado nuevos archivos JSON que se escriben en el disco. Algunas de estas [opciones de configuración](https://github.com/nlog/NLog/wiki/File-target) pueden ser útiles para administrar la cantidad de espacio en disco utilizado y/o el rendimiento del objetivo.

    * `archiveAboveSize`

    * `maxArchiveFiles`

    * `bufferSize`

    * `enableArchiveFileCompression`

    * `autoFlush`

    * `concurrentWrites`

      Aunque el [objetivo NLog AsyncWrapper](https://github.com/nlog/NLog/wiki/AsyncWrapper-target) no es necesario, puede ayudar a mejorar el rendimiento al realizar el formateo y la salida del archivo de registro en un subproceso diferente.

      <DNT>
        **Don&apos;t collect MDC or the MDLC data (default):**
      </DNT>

      El siguiente ejemplo de código enriquece el registro de eventos con metadatos de enlace New Relic , pero no con datos MDC o MDLC. Además del archivo de registro existente, genera un nuevo archivo de registro en un formato JSON específico en `C:\logs\NLogExample.log.json` para que lo consuma el reenviador de registros:

      ```cs
      var loggerConfig = new LoggingConfiguration();
      var newRelicFileTarget = new FileTarget("NewRelicFileTarget");
      newRelicFileTarget.Layout = new NewRelicJsonLayout();
      newRelicFileTarget.FileName = "C:\logs\NLogExample.json";
      loggerConfig.AddTarget(newRelicFileTarget);
      loggerConfig.AddRuleForAllLevels("NewRelicFileTarget");
      LogManager.Configuration = loggerConfig;
      var logger = LogManager.GetLogger("Example");
      ```

      <DNT>
        **Collect MDC or the MDLC data:**
      </DNT>

      Si su aplicación utiliza MDC o MDLC, puede configurar `NewRelicJsonLayout` para incluir elementos en esas colecciones. El siguiente ejemplo de código agrega la configuración adicional para permitir la recopilación de datos MDC y MDLC. Como en el ejemplo anterior, genera un nuevo archivo de registro en un formato JSON específico en `C:\logs\NLogExample.log.json` para que lo consuma el reenviador de registros:

      ```cs
      var loggerConfig = new LoggingConfiguration();
      var newRelicFileTarget = new FileTarget("NewRelicFileTarget");
      var newRelicLayout = new NewRelicJsonLayout
      {
          IncludeScopeProperties = true
      };

      newRelicFileTarget.Layout = newRelicLayout;
      newRelicFileTarget.FileName = @"C:\logs\NLogExample.json";
      loggerConfig.AddTarget(newRelicFileTarget);
      loggerConfig.AddRuleForAllLevels("NewRelicFileTarget");
      LogManager.Configuration = loggerConfig;
      var logger = LogManager.GetLogger("Example");
      ```

      Una vez que haya configurado la extensión NLog y haya actualizado su archivo de registro, puede configurar su extensión para enviar datos a New Relic. Hay [varias opciones](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) para reenviar sus registros. Aquí hay un ejemplo de configuración usando el agente de infraestructura para logs en el contexto:

      ```yml
      logs:
        - name: application-log
          file: C:\logs\log4netExample.log.json # Path to a single log file
      ```

      [Documentación para utilizar el reenviador del agente de infraestructura](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>

  <Collapser id="nlog-file" title="Configuración basada en archivos NLog">
    También puede configurar la extensión New Relic NLog con proveedores de configuración basados en archivos. El siguiente código de ejemplo crea un logger basado en la configuración contenida en un archivo `App.config`.

    <DNT>
      **Instantiating Logger using `.config` file**
    </DNT>

    ```cs
    var logger = LogManager.GetLogger("NewRelicLog");
    logger.Info("Hello, New Relic!");
    ```

    <DNT>
      **Sample `App.config` file**
    </DNT>

    ```xml
    <?xml version="1.0" encoding="utf-8" ?>
    <configuration>
      <configSections>
        <section name="nlog" type="NLog.Config.ConfigSectionHandler, NLog"/>
      </configSections>
      <startup>
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5" />
      </startup>
      <nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <extensions>
          <add assembly="NewRelic.LogEnrichers.NLog" />
        </extensions>
        <targets>
          <target name="NewRelicLogFile" xsi:type="File" fileName="C:/path/to/NewRelicLog.json">
            <layout xsi:type="newrelic-jsonlayout">
            </layout>
          </target>
        </targets>
        <rules>
          <logger name="NewRelicLog" minlevel="Info" writeTo="newRelicLogFile" />
        </rules>
      </nlog>
    </configuration>
    ```
  </Collapser>
</CollapserGroup>

### Configurar Serilog 2.5 o extensión superior [#serilog]

Puede utilizar nuestra extensión [Serilog](https://serilog.net/) para vincular sus datos log con datos relacionados en el resto de la plataforma New Relic . Esto requiere:

* [Serilog 2.5 o superior](https://serilog.net/)
* [Serilog File Sinks v4.0 o superior](https://www.nuget.org/packages/Serilog.Sinks.File/)

<CollapserGroup>
  <Collapser id="example-serilog" title="Diagrama de flujo de trabajo de Serilog">
    Serilog es un framework de registro estructurado que registra el mensaje de registro de su aplicación y crea un `LogEvent` para almacenar los datos del mensaje. Usando [Enrichers](https://github.com/serilog/serilog/wiki/Enrichment), puedes agregar información adicional al registro de eventos. [Los receptores](https://github.com/serilog/serilog/wiki/Provided-Sinks) y [formateadores](https://github.com/serilog/serilog/wiki/Formatting-Output) le permiten formatear y generar esos registros de eventos para su consumo y visualización posteriores.

    El siguiente diagrama ilustra el flujo de mensaje de registro a través de Serilog, destacando componentes específicos de la extensión New Relic Serilog. Hay muchos reenviadores de logs disponibles. Este ejemplo utiliza [Fluentd](https://www.fluentd.org/).

    <img title="Serilog extension for logs in context with New Relic's .NET agent" alt="Logs-in-context Serilog" src="/images/logs_diagram_dotnet-logs-in-context-serilog.webp" />

    <DNT>**New Relic Enricher**</DNT>: El `NewRelicEnricher` agrega información contextual del agente .NET (usando la API) al registro de eventos generado por la aplicación. New Relic utiliza esta información contextual, llamada metadatos de enlace, para vincular el mensaje de registro con la transacción y los tramos donde se crearon.

    <DNT>**New Relic Formatter**</DNT>: `NewRelicFormatter` traduce el registro de eventos enriquecido al formato JSON esperado por New Relic. Un receptor le indica a Serilog que envíe el JSON a un archivo en la ubicación que espera el reenviador de registros.

    <DNT>**New Relic Log Forwarder**</DNT>: El reenviador de registros está configurado para enviar los datos log enriquecidos y formateados correctamente desde la salida `FileTarget` al extremo de registro New Relic .

    Para obtener más información sobre el registro de eventos de Serilog, consulte la [documentación de Serilog en GitHub](https://github.com/serilog/serilog/wiki/Getting-Started).
  </Collapser>

  <Collapser id="config-serilog" title="Configuración de Serilog 2.5 o superior">
    Para configurar el logs en el contexto con la extensión Serilog:

    1. Utilice el [administrador de paquetes de Visual Studio NuGet](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio) para localizar e instalar el paquete [`NewRelic.LogEnrichers.Serilog`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Serilog) .

    2. En el código de su aplicación, actualice su configuración de registro para agregar `NewRelicEnricher` y `NewRelicFormatter`.

       El siguiente ejemplo de código enriquece el registro de eventos con metadatos de enlace New Relic . Además del archivo de registro existente, genera un nuevo archivo de registro en un formato JSON específico en `C:\logs\SerilogExample.log.json` para que lo consuma el reenviador de registros:

       ```cs
       var loggerConfig = new LoggerConfiguration();

       loggerConfig
           .Enrich.WithThreadName()
           .Enrich.WithThreadId()
           .Enrich.WithNewRelicLogsInContext()
           .WriteTo.File( path: @"C:\logs\ExistingLoggingOutput.txt")
           .WriteTo.File(
               formatter: new NewRelicFormatter(),
               path: @"C:\logs\SerilogExample.log.json");

       var log = loggerConfig.CreateLogger();
       ```

       Esta configuración da como resultado nuevos archivos JSON que se escriben en el disco. Algunas de estas [opciones de configuración](https://github.com/serilog/serilog-sinks-file) pueden ser útiles para administrar la cantidad de espacio en disco utilizado y/o el rendimiento del disipador.

    * `restrictedToMinimumLevel`

    * `buffered`

    * `rollingInterval`

    * `rollOnFileSizeLimit`

    * `retainedFileCountLimit`

      Aunque no es necesario, el uso del [Serilog Asynchronous Sink Wrapper](https://www.nuget.org/packages/Serilog.Sinks.Async) puede ayudar a mejorar el rendimiento al realizar el formateo y la salida del archivo de registro en un subproceso diferente.

    3. Una vez que haya configurado la extensión Serilog y haya actualizado su archivo de registro, existen [varias opciones](/docs/logs/forward-logs/enable-log-management-new-relic/#log-forwarding) para reenviar sus registros. Aquí hay un ejemplo de configuración usando el agente de infraestructura para logs en el contexto:

       ```yml
       logs:
         - name: application-log
           file: C:\logs\log4netExample.log.json # Path to a single log file
       ```

       [Documentación para utilizar el reenviador del agente de infraestructura](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#file)
  </Collapser>

  <Collapser id="serilog-file" title="Configuración basada en archivos Serilog">
    También puede configurar la extensión New Relic Serilog con proveedores de configuración basados en archivos. Se requieren los siguientes paquetes NuGet adicionales:

    * [Microsoft.Extensions.Configuration](https://www.nuget.org/packages/Microsoft.Extensions.Configuration/)

    * [Serilog.Settings.Configuration](https://www.nuget.org/packages/Serilog.Settings.Configuration)

      El siguiente código de ejemplo crea un logger basado en la configuración contenida en un archivo `appSettings.json`.

      <DNT>
        **Instantiating logger using `appsettings.json`**
      </DNT>

      ```cs
      var builder = new ConfigurationBuilder()
          .AddJsonFile("appsettings.json");

      var configuration = builder.Build();

      var logger = new LoggerConfiguration()
          .ReadFrom.Configuration(configuration)
          .CreateLogger();
      ```

      <DNT>
        **Sample `appsettings.json` file**
      </DNT>

      ```json
      {
          "Serilog": {
              "Using": [
                  "Serilog.Sinks.Console",
                  "Serilog.Sinks.File",
                  "NewRelic.LogEnrichers.Serilog"
              ],
              "MinimumLevel": "Debug",
              "Enrich": [
                  "WithNewRelicLogsInContext"
              ],
              "WriteTo": [
                  {
                      "Name": "File",
                      "Args": {
                          "path": "C:\\Logs\\SerilogExample.log.json",
                          "formatter": "NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog"
                      }
                  }
              ],
              "Properties": {
                  "Application": "NewRelic Logging Serilog Example"
              }
          }
      }
      ```

      El siguiente código de ejemplo crea un logger basado en la configuración contenida en un archivo `web.config`. Se requiere el paquete NuGet [Serilog.Settings.AppSettings](https://www.nuget.org/packages/Serilog.Settings.AppSettings) .

      <DNT>
        **Instantiating logger using `.config` file**
      </DNT>

      ```cs
      var logger = new LoggerConfiguration()
          .ReadFrom.AppSettings()
          .CreateLogger();
      ```

      <DNT>
        **Sample `web.config` file**
      </DNT>

      ```xml
      <?xml version="1.0" encoding="utf-8"?>
      <configuration>
        <appSettings>
          <add key="serilog:using:NewRelic" value="NewRelic.LogEnrichers.Serilog" />
          <add key="serilog:using:File" value="Serilog.Sinks.File" />
          <!--Add other enrichers here-->
          <add key="serilog:enrich:WithNewRelicLogsInContext" />
          <add key="serilog:write-to:File.path" value="C:\logs\SerilogExample.log.json" />
          <add key="serilog:write-to:File.formatter" value="NewRelic.LogEnrichers.Serilog.NewRelicFormatter, NewRelic.LogEnrichers.Serilog" />
        </appSettings>
      ```
  </Collapser>
</CollapserGroup>