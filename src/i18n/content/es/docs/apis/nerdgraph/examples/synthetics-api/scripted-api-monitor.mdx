---
title: Gestionar monitores de API con scripts
tags:
  - Synthetics
  - APIs
  - NerdGraph
  - Examples
metaDescription: How to use New Relic NerdGraph API to create and update scripted API monitors for synthetic monitoring.
freshnessValidatedDate: never
translationType: machine
---

New Relic te permite usar NerdGraph para crear [monitores API con scripts](/docs/synthetics/synthetic-monitoring/scripting-monitors/write-synthetic-api-tests). Los monitores API con script ejecutan código JavaScript personalizado para probar API y servicios backend sin un navegador, realizando requests HTTP y validando respuestas mediante programación. Este tutorial proporciona ejemplos de cómo emplear la API NerdGraph para automatizar la creación de monitores de API con scripts.

## Crear un monitor API con script [#create-scripted-api]

Puede crear un monitor de API con script empleando la mutación `syntheticsCreateScriptApiMonitor`. Esta mutación le permite configurar pruebas API personalizadas que ejecutan su código JavaScript para validar extremos de API.

### parámetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Tipo de datos
      </th>

      <th>
        ¿Es obligatorio?
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `accountId`
      </td>

      <td>
        Entero
      </td>

      <td>
        Sí
      </td>

      <td>
        [ID de su cuenta de](/docs/accounts/accounts-billing/account-structure/account-id)

         New Relic donde se creará el monitor.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Sí
      </td>

      <td>
        matriz de 

        [ubicación pública](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         identificador donde el monitor ejecutará comprobaciones (por ejemplo, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El nombre para mostrar de su monitor de API con script.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Enumeración
      </td>

      <td>
        Sí
      </td>

      <td>
        Con qué frecuencia se ejecuta el monitor. Opciones: 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El tipo de tiempo de ejecución empleado por su monitor. 

        `NODE_API`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        La versión del tipo de tiempo de ejecución empleada por su monitor. 

        `16.10`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El idioma empleado en su monitor. 

        `JAVASCRIPT`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El código JavaScript que ejecuta el monitor. Debe ser texto simple, no codificado en base64. El script puede usar el objeto $http para realizar requests HTTP y realizar pruebas API.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Enumeración
      </td>

      <td>
        Sí
      </td>

      <td>
        El estado del monitor. Opciones: 

        `ENABLED`

         (el monitor está activo y realizando comprobaciones), 

        `DISABLED`

         (el monitor está inactivo).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Flotante
      </td>

      <td>
        No
      </td>

      <td>
        Objetivo Apdex del monitor en segundos, empleado para completar reportes SLA. El valor predeterminado es 7,0 segundos.
      </td>
    </tr>
  </tbody>
</table>

### Solicitud de muestra

```graphql
mutation {
  syntheticsCreateScriptApiMonitor(
    accountId: ACCOUNT_ID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Ejemplo de respuesta

Una respuesta exitosa devuelve `null` para los errores:

```json
{
  "data": {
    "syntheticsCreateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Si hay algún problema al crear el monitor, la matriz `errors` contendrá objetos con campos `description` y `type` que explican qué salió mal.

## Actualizar un monitor de API con script [#update-scripted-api]

Puede actualizar un monitor de API con script existente empleando la mutación `syntheticsUpdateScriptApiMonitor`. Esto le permite modificar la configuración de un monitor de API con script que ya se creó.

### parámetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Tipo de datos
      </th>

      <th>
        ¿Es obligatorio?
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de entidad única del monitor que desea actualizar.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Matriz
      </td>

      <td>
        No
      </td>

      <td>
        matriz de 

        [ubicación pública](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         identificador donde el monitor ejecutará comprobaciones (por ejemplo, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Cadena
      </td>

      <td>
        No
      </td>

      <td>
        El nombre para mostrar actualizado para su monitor de API con script.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Enumeración
      </td>

      <td>
        No
      </td>

      <td>
        Con qué frecuencia se ejecuta el monitor. Opciones: 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        No
      </td>

      <td>
        El tipo de tiempo de ejecución empleado por su monitor. 

        `NODE_API`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        No
      </td>

      <td>
        La versión del tipo de tiempo de ejecución empleada por su monitor. 

        `16.10`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Cadena
      </td>

      <td>
        No
      </td>

      <td>
        El idioma empleado en su monitor. 

        `JAVASCRIPT`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Cadena
      </td>

      <td>
        No
      </td>

      <td>
        El código JavaScript que ejecuta el monitor. Debe ser texto simple, no codificado en base64.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Enumeración
      </td>

      <td>
        No
      </td>

      <td>
        El estado del monitor. Opciones: 

        `ENABLED`

         (el monitor está activo y realizando comprobaciones), 

        `DISABLED`

         (el monitor está inactivo).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Flotante
      </td>

      <td>
        No
      </td>

      <td>
        Objetivo Apdex del monitor en segundos, empleado para completar reportes SLA. El valor predeterminado es 7,0 segundos.
      </td>
    </tr>
  </tbody>
</table>

### Solicitud de muestra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: ENTITY_GUID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Ejemplo de respuesta

Una respuesta exitosa devuelve `null` para los errores:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Si hay algún problema al actualizar el monitor, la matriz `errors` contendrá objetos con campos `description` y `type` que explican qué salió mal.

## Actualizar el tiempo de ejecución de un monitor de API con script [#upgrade-monitor-runtime]

Puede actualizar un monitor de API con script para emplear el nuevo entorno de ejecución Node.js 16.10. Esto garantiza que su monitor emplee las últimas actualizaciones de seguridad y características Node.js

### parámetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Tipo de datos
      </th>

      <th>
        ¿Es obligatorio?
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de entidad única del monitor que desea actualizar.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El tipo de tiempo de ejecución. 

        `NODE_API`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        La versión de tiempo de ejecución. 

        `16.10`

         es el único valor aceptado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El lenguaje de script. 

        `JAVASCRIPT`

         es el único valor aceptado.
      </td>
    </tr>
  </tbody>
</table>

### Solicitud de muestra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "NODE_API",
        runtimeTypeVersion: "16.10",
        scriptLanguage: "JAVASCRIPT"
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Ejemplo de respuesta

Una respuesta exitosa devuelve `null` para los errores:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Si hay algún problema al actualizar el entorno de ejecución del monitor, la matriz `errors` contendrá objetos con campos `description` y `type` que explican qué salió mal.

## Reducir el tiempo de ejecución de un monitor de API con script [#downgrade-monitor-runtime]

Puede degradar un monitor API con script para emplear un entorno de ejecución legacy. Esto puede ser necesario por razones de compatibilidad, pero tenga en cuenta que los entornos de ejecución legacy finalizarán su vida útil el 22 de octubre de 2024.

<Callout variant="important">
  Los tiempos de ejecución heredados están obsoletos y finalizarán su vida útil el 22 de octubre de 2024. No se recomienda cambiar a entornos de ejecución legacy, excepto por necesidades de compatibilidad temporales.
</Callout>

### parámetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Tipo de datos
      </th>

      <th>
        ¿Es obligatorio?
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de entidad única del monitor que desea degradar.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        Establezca la cadena vacía 

        `""`

         para emplear el tiempo de ejecución legacy.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        Establezca la cadena vacía 

        `""`

         para emplear el tiempo de ejecución legacy.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        Establezca la cadena vacía 

        `""`

         para emplear el tiempo de ejecución legacy.
      </td>
    </tr>
  </tbody>
</table>

### Solicitud de muestra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "",
        runtimeTypeVersion: "",
        scriptLanguage: ""
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Ejemplo de respuesta

Una respuesta exitosa devuelve `null` para los errores:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Si hay algún problema al degradar el tiempo de ejecución del monitor, la matriz `errors` contendrá objetos con campos `description` y `type` que explican qué salió mal.

## Mover un monitor API con script entre una ubicación privada habilitada para VSE [#move-monitor]

Puede mover un monitor API con script entre una ubicación privada habilitada para VSE. Al mover monitores entre ubicaciones privadas con la ejecución script verificados (VSE) habilitada, debe incluir el script para regenerar HMAC para la validación de seguridad.

### parámetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Tipo de datos
      </th>

      <th>
        ¿Es obligatorio?
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         de entidad única del monitor que desea mover.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Sí
      </td>

      <td>
        matriz de configuración de ubicación privada. Cada ubicación requiere un 

        `guid`

         y 

        `vsePassword`

         para las ubicaciones habilitadas para VSE.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.guid`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El GUID de entidad de la ubicación privada de destino.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.vsePassword`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        La contraseña de VSE para la ubicación privada del objetivo.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Cadena
      </td>

      <td>
        Sí
      </td>

      <td>
        El código JavaScript que ejecuta el monitor. Esto debe incluir para regenerar HMAC al mover entre ubicaciones habilitadas para VSE.
      </td>
    </tr>
  </tbody>
</table>

### Solicitud de muestra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID"
    monitor: {
      locations: {
        private: [{
          guid: "LOCATION_GUID",
          vsePassword: "YOUR_VSE_PASSWORD"
        }]
      },
      script: "SCRIPT_CONTENT"
    }
  ) {
    errors {
      description
      type
    }
    monitor {
      status
    }
  }
}
```

### Ejemplo de respuesta

Una respuesta exitosa devuelve `null` en caso de errores e incluye el estado del monitor:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null,
      "monitor": {
        "status": "ENABLED"
      }
    }
  }
}
```

Si hay algún problema al mover el monitor, la matriz `errors` contendrá objetos con campos `description` y `type` que explican qué salió mal.

## Eliminar un monitor de API con script [#delete-monitor]

Cuando ya no se necesita un monitor de API con script, puedes eliminarlo de forma permanente empleando la mutación `syntheticsDeleteMonitor`.

Para eliminar un monitor, consulte la sección [Eliminar monitor Sintético](/docs/apis/nerdgraph/examples/synthetics-api/ping-monitor/#delete-monitor).