---
title: 'Tutorial de NerdGraph: Configurar la integración de RAG'
metaDescription: Enhance New Relic AI with RAG (Retrieval Augmented Generation)
freshnessValidatedDate: never
translationType: machine
---

<Callout title="avance">
  Todavía estamos trabajando en esta característica, ¡pero nos encantaría que la probaras!

  Esta característica se proporciona actualmente como parte de un programa de vista previa de conformidad con nuestras [políticas de prelanzamiento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Con New Relic, puede mejorar el agente New Relic AI con generación aumentada por recuperación (RAG) asociando su documentación, runbooks, retrospectivas de incidentes e incluso código fuente con sus servicios. Este proceso proporciona a New Relic AI información mejor y más valiosa sobre los problemas con su sistema. El tutorial describe cómo obtener el ID de su organización, crear una herramienta RAG y agregar sus documentos a la plataforma mediante la API Blob.

Luego de agregar sus documentos, creará una relación para asociarlos con la herramienta RAG. Luego puede verificar su configuración consultando las relaciones entre los documentos RAG y la herramienta RAG. El paso final es consultar la propia herramienta RAG para recuperar información relevante e indexada.

Para obtener más información sobre el conector de conocimiento, consulte [Conector de conocimiento de New Relic AI](/docs/agentic-ai/knowledge-integration/overview).

<Callout variant="important">
  Antes de realizar los siguientes pasos, cerciorar de tener licencias de &quot;Administrador de producto de la organización&quot;.
</Callout>

Para comenzar a indexar su contenido y beneficiarse del conector de conocimiento con New Relic AI, siga estos pasos mencionados:

## Tarea 1: Crea tu herramienta RAG [#create-your-rag-tool]

<CollapserGroup>
  <Collapser id="get-started" title="Obtenga el ID de su organización">
    El ID de organización identifica de forma única su cuenta y garantiza que cualquier herramienta RAG que usted cree, documentos que cargue o relaciones que establezca estén asociados con su organización en New Relic.

    Se requiere la identificación de la organización para realizar mutaciones y consultas en NerdGraph al configurar y gestionar herramientas y documentos de RAG. Ejecute la siguiente consulta y conserve el ID de la organización a mano para los pasos posteriores.

    ### Consulta de muestra

    ```graphql
    {
      actor {
        organization {
          id
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="create-rag-tool" title="Crear una herramienta RAG">
    Una herramienta RAG actúa como un contenedor especializado para organizar documentos y recursos relacionados en New Relic. Un nombre claro y una descripción precisa de sus herramientas RAG ayudan al LLM a seleccionar la herramienta adecuada para cada símbolo, lo que garantiza respuestas relevantes y conscientes del contexto.

    Para crear una nueva herramienta RAG en su cuenta de New Relic, ejecute la siguiente mutación `entityManagementCreateRagTool` :

    1. Cerciorar de reemplazar `${ORGANIZATION_ID}` con su ID de organización real obtenida en el paso anterior.
    2. Si tiene éxito, recibirá un `id` para su herramienta RAG.

    ### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ragToolEntity`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sí
          </td>

          <td>
            El objeto de entrada que contiene la configuración de la nueva herramienta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `description`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            Una descripción clara y precisa del propósito de la herramienta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El nombre único para su herramienta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `scope`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sí
          </td>

          <td>
            Un objeto que define el contexto en el que se creará la herramienta.
          </td>
        </tr>

        <tr>
          <td>
            `scope.id`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El ID único de su organización (

            `${ORGANIZATION_ID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `scope.type`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El tipo del ámbito, que debe ser 

            `ORGANIZATION`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutación de muestra

    ```graphql
    mutation {
      entityManagementCreateRagTool(
        ragToolEntity: {
          description: "Runbooks for resolving incidents with APIs",
          name: "API Runbooks",
          scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}
        }
      ) {
        entity {
          id
        }
      }
    }
    ```

    Debe almacenar el `id` devuelto ya que lo necesitará en pasos posteriores para vincular documentos a la herramienta, verificar relaciones y consultar la herramienta para obtener información relevante en New Relic.
  </Collapser>
</CollapserGroup>

## Tarea 2: Indexar sus documentos [#index-your-documents]

<CollapserGroup>
  <Collapser id="upload-document" title="Subir un documento a través de la API de Blob">
    <Callout variant="important">
      Todos los documentos indexados son visibles para todos los usuarios dentro de su organización. Cerciorar de que los documentos que indexe cumplan con sus políticas internas y no carguen datos confidenciales o privados.
    </Callout>

    ### La API de Blob y su propósito

    Blob API es un servicio de New Relic diseñado para cargar archivos, como documentación y libros de ejecución, a su cuenta. NerdGraph está optimizado para la consulta y mutación de datos estructurados y no para la transferencia eficiente de archivos, por lo que se requiere la API Blob para cargar documentos.

    ### Requisitos de autenticación

    Necesita una clave de API de New Relic válida con licencias para cargar documentos. Para obtener la clave de API para cargar un documento en New Relic usando la API Blob:

    1. Inicie sesión en su cuenta [de New Relic](https://one.newrelic.com/).
    2. Crea y gestiona tu clave de API desde la [página UI de clave de API ](https://one.newrelic.com/administration/api-keys).
    3. Haga clic en **Create a key** y complete los detalles requeridos (o emplee una existente con las licencias necesarias).
    4. Haga clic en **Create a key** y copie la clave generada (se verá como NRAK-XXXXXXXXXX).

    A continuación se muestra un ejemplo de cómo cargar un documento mediante el comando `curl` `bash` :

    ### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `Api-Key`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            Su clave de API de New Relic para autenticación.
          </td>
        </tr>

        <tr>
          <td>
            `NewRelic-Entity`
          </td>

          <td>
            Objeto JSON
          </td>

          <td>
            Sí
          </td>

          <td>
            metadatos sobre el documento, como su nombre.
          </td>
        </tr>

        <tr>
          <td>
            `Content-Type`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El formato del archivo que se va a cargar (por ejemplo, 

            `application/json`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `payload`

             (

            `@incidents.json`

            )
          </td>

          <td>
            Archivo
          </td>

          <td>
            Sí
          </td>

          <td>
            El archivo del documento que estás cargando, especificado por su ruta de archivo.
          </td>
        </tr>
      </tbody>
    </table>

    ### Consulta de muestra

    ```shell
    curl -X POST https://blob-api.one-service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
         -H 'Api-Key: NRAK-XXXXXXXXXX' \
         -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
         -H 'Content-Type: application/json' \
         -d @incidents.json
    ```

    ### Ejemplo de respuesta

    <table>
      <thead>
        <tr>
          <th>
            Respuesta
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `entityGuid`
          </td>

          <td>
            Cadena
          </td>

          <td>
            El identificador único del documento RAG cargado.
          </td>
        </tr>

        <tr>
          <td>
            `blobVersionEntity`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Representa la versión del blob cargado.
          </td>
        </tr>
      </tbody>
    </table>

    ```json
    {
      "entityGuid": "MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk",
      "blobVersionEntity": null
    }
    ```

    ### Próximos pasos

    Luego de cargar su documento, este se indexa y queda disponible para que New Relic AI lo busque y lo recupere. Debes almacenar el `entityGuid` de la respuesta para crear una relación con tu herramienta RAG o para consultar el documento en NerdGraph.
  </Collapser>

  <Collapser id="view-the-rag-document-entity-represented-in-nerdgraph" title="Ver la entidad del documento RAG representada en NerdGraph">
    Luego de cargar un documento a través de la API Blob, ejecutar esta consulta confirma que la carga fue exitosa y que el documento se registró correctamente como una entidad de documento RAG con su propio identificador y propiedades únicos.

    #### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El GUID único del documento RAG que se recuperará.
          </td>
        </tr>
      </tbody>
    </table>

    ### Consulta de muestra

    En la consulta a continuación, reemplace el marcador de posición `${RAG_DOCUMENT_GUID}` con el `entityGuid` que recibió en el paso anterior.

    ```graphql
    {
      actor {
        entityManagement {
          entity(
            id: `${RAG_DOCUMENT_GUID}`
          ) {
            ... on EntityManagementRagDocumentEntity {
              id
              name
              blob {
                url
              }
              type
            }
          }
        }
      }
    }
    ```

    Esta consulta devolverá los siguientes detalles sobre su documento RAG:

    * `id`:El ID único del documento RAG.
    * `name`:El nombre del documento RAG.
    * `blob { url }`:La URL para acceder al documento cargado.
    * `type`:El tipo de entidad, que en este caso es `EntityManagementRagDocumentEntity`.
  </Collapser>

  <Collapser id="create-a-relationship-between-the-rag-document-and-the-rag-tool" title="Crear una relación entre la herramienta RAG y el documento RAG">
    Ahora que creó una herramienta RAG, cargó su documento y verificó que la carga se realizó correctamente, el siguiente paso es asociar la herramienta RAG y el documento RAG, lo que hará que New Relic AI pueda buscar y emplear su documento. Para ello, ejecute la mutación `entityManagementCreateRelationship` :

    1. Reemplace `${RAG_DOCUMENT_GUID}` con `entityGuid` de la respuesta de la carga del documento a través de la API Blob.
    2. Reemplace `${RAG_TOOL_GUID}` con `id` de la respuesta de la mutación de creación de la herramienta RAG.

    ### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationship`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sí
          </td>

          <td>
            El objeto de entrada que contiene los detalles de la relación.
          </td>
        </tr>

        <tr>
          <td>
            `source`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sí
          </td>

          <td>
            La entidad de origen de la relación, que es el documento RAG.
          </td>
        </tr>

        <tr>
          <td>
            `source.scope`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El alcance de la entidad de origen, que debe ser 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `source.id`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El GUID único del documento RAG (

            `${RAG_DOCUMENT_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `target`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sí
          </td>

          <td>
            La entidad objetivo de la relación, que es la herramienta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `target.scope`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El alcance de la entidad objetivo, que debe ser 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `target.id`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El GUID único de la herramienta RAG (

            `${RAG_TOOL_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `type`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El tipo de relación, que debe ser 

            `"INDEXED_FOR"`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutación de muestra

    ```graphql
    mutation {
      entityManagementCreateRelationship(
        relationship: {
          source: {
            scope: ORGANIZATION,
            id: `${RAG_DOCUMENT_GUID}`
          },
          target: {
            scope: ORGANIZATION,
            id: `${RAG_TOOL_GUID}`
          },
          type: "INDEXED_FOR"
        }
      ) {
        relationship {
          type
          target {
            id
            type
          }
          source {
            id
            type
          }
        }
      }
    }
    ```
  </Collapser>
</CollapserGroup>

## Tarea 3: Recuperar información relevante [#retrieve-relevant-information]

<CollapserGroup>
  <Collapser id="query-to-see-relationships-between-rag-documents-and-rag-tools" title="Consulta para ver las relaciones entre los documentos RAG y las herramientas RAG">
    Luego de crear una relación entre su documento RAG y la herramienta RAG, puede verificar la asociación consultando las relaciones en NerdGraph. Esto ayuda a garantizar que su documento esté correctamente vinculado y disponible para que New Relic AI lo use.

    * Reemplace `${RAG_DOCUMENT_ID}` con el `entityGuid` de su documento cargado.

    ### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationships`
          </td>

          <td>
            Consultar
          </td>

          <td>
            Sí
          </td>

          <td>
            La consulta para recuperar relaciones entre entidades.
          </td>
        </tr>

        <tr>
          <td>
            `filter`
          </td>

          <td>
            Objeto
          </td>

          <td>
            No
          </td>

          <td>
            Un objeto empleado para filtrar las relaciones según el atributo.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId`
          </td>

          <td>
            Objeto
          </td>

          <td>
            No
          </td>

          <td>
            Un objeto para filtrar por el identificador único de la entidad de origen.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId.eq`
          </td>

          <td>
            Cadena
          </td>

          <td>
            No
          </td>

          <td>
            El GUID único del documento RAG que debe coincidir.
          </td>
        </tr>
      </tbody>
    </table>

    ### Consulta de muestra

    ```graphql
    {
      actor {
        entityManagement {
          relationships(
            filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
          ) {
            items {
              type
              target {
                id
                type
              }
            }
          }
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="query-the-rag-tool" title="Consulta la herramienta RAG">
    Luego de configurar su herramienta RAG e indexar los documentos, puede consultar la herramienta RAG para recuperar información relevante en función de su símbolo. Esto permite que New Relic AI muestre respuestas sensibles al contexto empleando la documentación de su organización.

    ### parámetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nombre del parámetro
          </th>

          <th>
            Tipo de datos
          </th>

          <th>
            ¿Es obligatorio?
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `prompt`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            La consulta en lenguaje natural que desea que la herramienta RAG procese.
          </td>
        </tr>

        <tr>
          <td>
            `toolId`
          </td>

          <td>
            Cadena
          </td>

          <td>
            Sí
          </td>

          <td>
            El GUID único de la herramienta RAG a consultar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Consulta de muestra

    ```graphql
    {
      actor {
        machineLearning {
          ragQueryData(
            prompt: "tell me about the incident", 
            toolId: `${RAG_TOOL_GUID}`
          ) {
            blobId
            chunk
            documentId
            score
            toolId
          }
        }
      }
    }
    ```

    La respuesta incluirá coincidencias fragmentadas de sus documentos indexados, que puede usar directamente o resumir con New Relic AI.
  </Collapser>
</CollapserGroup>