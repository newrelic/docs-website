---
title: 'Tutorial de NerdGraph: Gestionar las políticas de acceso a datos'
tags:
  - Manage data access policies via NerdGraph
  - Manage data access policies via API
metaDescription: 'Use New Relic NerdGraph to create, update, and manage data access policies for controlling access to log partitions.'
freshnessValidatedDate: never
translationType: machine
---

Puede emplear nuestra [APINerdGraph](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/) para crear, consultar, actualizar y eliminar políticas de acceso a datos. Las políticas de acceso a datos controlan a qué [particiones de log](/docs/logs/ui-data/data-partitions/) puede acceder su usuario, lo que le permite restringir el acceso a datos de log confidenciales en función de los grupos de usuarios.

## Requisitos [#requirements]

Para gestionar las políticas de acceso a datos mediante NerdGraph, necesitas:

* Una cuenta de New Relic edición [Pro o Enterprise](https://newrelic.com/pricing)
* Rol [de administrador de dominio de autenticación](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#admin-settings)
* tipo de usuario de [usuario principal o usuario de plataforma completa](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type)
* [Clave de usuario](/docs/apis/intro-apis/new-relic-api-keys/#user-key) para la autenticación.

## Antes de que empieces [#before-you-begin]

Antes de emplear la API de NerdGraph para las políticas de acceso a datos, comprenda cómo funciona [el control de acceso a datos](/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control) y familiarizar con [NerdGraph](https://api.newrelic.com/graphiql).

## atributo común [#attributes]

Los siguientes atributos se emplean comúnmente en las consultas y mutaciones de políticas de acceso a datos:

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Atributo
      </th>

      <th>
        Descripción
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>

      <td>
        El identificador de la organización asociada a la póliza. Se emplea para filtrar políticas o delimitar la creación de políticas.
      </td>
    </tr>

    <tr>
      <td>
        `id`
      </td>

      <td>
        El identificador único de la póliza. Requerido al actualizar o eliminar una política específica.
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        Un nombre fácil de usar para la política de acceso a datos.
      </td>
    </tr>

    <tr>
      <td>
        `policy`
      </td>

      <td>
        El objeto JSON que define las reglas de la política. Incluye:

        * `rules`: Una matriz de objetos de reglas.
        * `operations`: Las operaciones para permitir o denegar (ej., `SELECT`, `*`).
        * `eventTypes`: Un objeto que especifica qué tipos de eventos corresponden a `allow` (por ejemplo, `["*"]`) o `except` (por ejemplo, `["Log_accessible"]`).
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        El ID de la cuenta a la que el rol otorga acceso.
      </td>
    </tr>

    <tr>
      <td>
        `dataAccessPolicyId`
      </td>

      <td>
        El ID de la política de acceso a datos que define qué datos de una cuenta están permitidos.
      </td>
    </tr>

    <tr>
      <td>
        `roleId`
      </td>

      <td>
        El ID del rol que define el nivel de acceso.
      </td>
    </tr>
  </tbody>
</table>

## Operaciones comunes [#operations]

Estas son las operaciones más comunes para gestionar las políticas de acceso a los datos:

<CollapserGroup>
  <Collapser id="query-grants" title="Consultar las políticas de acceso a datos asociadas con las concesiones de acceso.">
    Esta consulta recupera todas las licencias de acceso de su organización y sus políticas de acceso a datos asociadas. Emplee esta herramienta para saber qué políticas están actualmente asignadas a las subvenciones.

    ### Consulta de muestra

    ```graphql
    {
      customerAdministration {
        grants(filter: {organizationId: {eq: "YOUR_ORG_ID"}}) {
          items {
            dataAccessPolicy {
              id
              name
            }
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requerido.** El ID de la organización a la que pertenecen las subvenciones. Emplee el operador igual (`eq`) para filtrar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "customerAdministration": {
          "grants": {
            "items": [
              {
                "dataAccessPolicy": {
                  "id": "DATA_ACCESS_POLICY_ID",
                  "name": "DATA_ACCESS_POLICY_NAME"
                }
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Lista de subvenciones de la organización.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy`
          </td>

          <td>
            La política de acceso a los datos asociada a cada subvención.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            El identificador único de la política de acceso a los datos.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            El nombre de la política de acceso a los datos.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="query-policies" title="consultar políticas de acceso a datos para una organización">
    Esta consulta recupera todas las políticas de acceso a datos de su organización.

    ### Consulta de muestra

    ```graphql
    {
      customerAdministration {
        dataAccessPolicies(
          filter: {organizationId: {eq: "YOUR_ORG_ID"}}
        ) {
          items {
            id
            name
            policy
            status
            version
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requerido.** El ID de la organización a la que pertenecen las políticas. Emplee el operador igual (`eq`) para filtrar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "customerAdministration": {
          "dataAccessPolicies": {
            "items": [
              {
                "id": "ddadbdd2-183b-42d9-8a1a-41ec7692fb4c",
                "name": "Log Operations",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Operations"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              },
              {
                "id": "bb8efcf5-3127-4a4d-b25f-114505a0a68d",
                "name": "Restrict Log_Security",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Sec%"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Lista de políticas de acceso a datos en la organización.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            El identificador único de la política de acceso a los datos.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            El nombre de la política de acceso a los datos.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            El objeto JSON que contiene las reglas de política con `operations` y `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            El estado actual de la política (por ejemplo, `VALID`).
          </td>
        </tr>

        <tr>
          <td>
            `version`
          </td>

          <td>
            La versión de la política (actualmente `1.0-logs`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="create-policy" title="Cree una política de acceso a datos.">
    Esta mutación crea una nueva política de acceso a datos para controlar el acceso a las particiones de log.

    ### Mutación de muestra

    ```graphql
    mutation createMyPolicy {
      dataAccessPolicyCreate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_accessible"]}}]}
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    También puedes emplear las siguientes variables:

    ```graphql
    mutation createMyPolicy($policy: DataAccessPolicyRawDocument!) {
      dataAccessPolicyCreate(
        policy: $policy
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    ```json
    {
      "policy": {
        "rules": [
          {"operations": ["SELECT"], "eventTypes": {"allow": ["*"], "except": []}}
        ]
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Requerido.** Su ID de organización de New Relic.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Requerido.** Un nombre descriptivo para la póliza.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Requerido.** El objeto JSON que define las reglas de política con `operations` y `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "dataAccessPolicyCreate": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            El identificador único de la política de acceso a datos recién creada.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            El nombre de la política de acceso a los datos.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            El objeto JSON que contiene las reglas de política con `operations` y `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            El estado de la política (ej., `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="update-policy" title="Actualizar la política de acceso a datos">
    Esta mutación actualiza una política de acceso a datos existente para modificar sus reglas o su nombre.

    ### Mutación de muestra

    ```graphql
    mutation {
      dataAccessPolicyUpdate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_inaccessible"]}}]}
        name: "Test"
        id: "YOUR_DATA_POLICY_ID"
      ) {
        dataAccessPolicy {
          name
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Requerido.** El ID de la política que se va a actualizar.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Opcional.** Nombre actualizado de la póliza.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Opcional.** El objeto JSON que define las reglas de política actualizadas con `operations` y `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "dataAccessPolicyUpdate": {
          "dataAccessPolicy": {
            "assigned": "UNASSIGNED",
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `assigned`
          </td>

          <td>
            Indica si la política está asignada a alguna subvención (por ejemplo, `UNASSIGNED`).
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            El identificador único de la política de acceso a datos actualizada.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            El nombre de la política de acceso a los datos.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            El objeto JSON que contiene las reglas de política actualizadas con `operations` y `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            El estado de la política (ej., `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="delete-policy" title="Eliminar una política de acceso a datos">
    Esta mutación elimina una política de acceso a datos existente.

    <Callout variant="important">
      Eliminar una política la elimina de todas las concesiones asignadas. Los usuarios que pertenezcan a grupos con esas licencias perderán las restricciones de acceso a datos definidas por la política.
    </Callout>

    ### Mutación de muestra

    ```graphql
    mutation {
      dataAccessPolicyDelete(id: "YOUR_DATA_POLICY_ID") {
        dataAccessPolicy {
          name
          id
          policy
          status
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Requerido.** El ID de la política que se va a eliminar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "dataAccessPolicyDelete": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            El identificador único de la política de acceso a datos eliminados.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Nombre de la política de acceso a datos eliminados.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            El objeto JSON que contiene las reglas de política que fueron eliminadas.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            El estado de la política (ej., `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="grant-access" title="Cree una concesión de acceso con una política de acceso a datos.">
    Esta mutación crea una nueva concesión de acceso que incluye una política de acceso a datos, asignándola a una cuenta y un rol específicos.

    ### Mutación de muestra

    ```graphql
    mutation {
      authorizationManagementGrantAccess(
        grantAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Requerido.** El ID de la cuenta a la que se concederá acceso.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requerido.** El ID de la política de acceso a datos que se aplicará.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Requerido.** El ID del rol que define las licencias.
          </td>
        </tr>
      </tbody>
    </table>

    ### Respuesta

    La respuesta muestra la concesión de acceso recién creada con su ID.
  </Collapser>

  <Collapser id="update-grant" title="Actualizar una concesión de acceso con una política de acceso a datos">
    Esta mutación actualiza una concesión de acceso existente para agregar o modificar la política de acceso a los datos.

    ### Mutación de muestra

    ```graphql
    mutation {
      authorizationManagementUpdateAccess(
        updateAccessOptions: {accountAccessGrant: {dataAccessPolicyId: "YOUR_DATA_POLICY_ID"}, ids: YOUR_GRANT_ID}
      ) {
        grants {
          dataAccessPolicy {
            id
          }
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ids`
          </td>

          <td>
            **Requerido.** El ID de la subvención que se va a actualizar.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requerido.** El ID de la política de acceso a datos que se aplicará a la subvención.
          </td>
        </tr>
      </tbody>
    </table>

    ### Ejemplo de respuesta

    ```json
    {
      "data": {
        "authorizationManagementUpdateAccess": {
          "grants": [
            {
              "dataAccessPolicy": {
                "id": "YOUR_DATA_POLICY_ID"
              },
              "id": "YOUR_GRANT_ID"
            }
          ]
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de respuesta
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `grants`
          </td>

          <td>
            Lista de subvenciones actualizadas.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy.id`
          </td>

          <td>
            El ID de la política de acceso a datos ahora asignada a la concesión.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            El ID de la subvención actualizada.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="revoke-grant" title="Revocar una concesión de acceso con una política de acceso a datos">
    Esta mutación elimina una concesión de acceso que incluye una política de acceso a datos.

    ### Mutación de muestra

    ```graphql
    mutation {
      authorizationManagementRevokeAccess(
        revokeAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parámetro
          </th>

          <th>
            Descripción
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Requerido.** El ID de la cuenta de la autorización que se va a revocar.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Requerido.** El ID de la política de acceso a datos de la autorización que se va a revocar.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Requerido.** El ID del rol de la subvención a revocar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Respuesta

    La respuesta muestra la concesión de acceso revocada con su ID.
  </Collapser>
</CollapserGroup>

## Temas relacionados [#related-topics]

<DocTiles>
  <DocTile title="Guía UI para el control de acceso a datos" path="/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control">
    Aprenda a gestionar las políticas de acceso a datos a través de la UI New Relic.
  </DocTile>

  <DocTile title="Conceptos de gestión de usuarios" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">
    Comprender los tipos de usuario, los roles y la gestión de accesos.
  </DocTile>

  <DocTile title="Gestiona usuarios con NerdGraph" path="/docs/apis/nerdgraph/examples/nerdgraph-manage-users">
    Emplee la API de NerdGraph para gestionar mediante programación las licencias de usuario y de acceso.
  </DocTile>

  <DocTile title="Particiones de log" path="/docs/logs/ui-data/data-partitions/">
    Aprende a organizar tus datos de log en particiones.
  </DocTile>
</DocTiles>