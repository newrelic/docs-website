---
duration: 30
title: Mapear vistas de p√°ginas por regi√≥n en una aplicaci√≥n personalizada
metaDescription: Build a New Relic app showing page view data on a world map.
freshnessValidatedDate: never
translationType: machine
---

New Relic tiene herramientas poderosas y flexibles para crear aplicaciones personalizadas y completarlas con datos. Esta gu√≠a le muestra c√≥mo crear una aplicaci√≥n personalizada y completarla con datos de vistas de p√°gina empleando el lenguaje de consulta de New Relic (NRQL, pronunciado &apos;nurkle&apos;). Luego haces que tus datos sean interactivos. Y por √∫ltimo, si tiene un poco m√°s de tiempo y desea instalar una biblioteca React de terceros, puede mostrar los datos de vista de p√°gina que recopila en un mapa del mundo.

En esta gu√≠a, crear√° una aplicaci√≥n para mostrar datos de vistas de p√°gina de dos maneras:

* en una mesa
* En un mapa

Revise la secci√≥n **Before you begin** para cerciorar de tener todo lo que necesita y no quedar atascado a la mitad.

## Antes de que empieces [#begin]

Para aprovechar al m√°ximo esta gu√≠a, debe tener:

* Una cuenta New Relic , clave de API y la herramienta de l√≠nea de comando.
* New Relic Browser para completar la aplicaci√≥n. Sin estos datos, no podr√°s completar esta gu√≠a.

Para agregar sus datos a un mapa mundial en la segunda mitad de la gu√≠a:

* npm, que usar√° durante esta secci√≥n de la gu√≠a para instalar [Leaflet](https://www.npmjs.com/package/leaflet), una biblioteca JavaScript React de terceros empleada para crear mapas interactivos. Si eres nuevo en React y npm, puedes ir aqu√≠ para [instalar Node.js y npm](https://nodejs.org/en/download/).

## Terminolog√≠a New Relic [#terminology]

Los siguientes son algunos t√©rminos empleados en esta gu√≠a:

* Aplicaci√≥n New Relic : el producto terminado donde los datos se representan en New Relic. Esto podr√≠a parecer a un serial de gr√°ficos interactivos o un mapa del mundo.
* Nerdpack: la colecci√≥n est√°ndar de New Relic de JavaScript, JSON, CSS y otros archivos que controlan la funcionalidad y el aspecto de su aplicaci√≥n. Para obtener m√°s informaci√≥n, consulte [Estructura de archivos de Nerdpack](/docs/new-relic-solutions/build-nr-ui/nerdpack-file-structure).
* P√≠cher: El bot√≥n en New Relic que lanza tu aplicaci√≥n.
* Nerdlets: New Relic React empleados para crear su aplicaci√≥n. Los tres archivos predeterminados son `index.js`, `nr1.json` y `styles.scss`, pero puedes personalizarlos y agregar los tuyos propios.

## Cree una aplicaci√≥n personalizada con un gr√°fico de tabla [#build-app-table-chart]

<Steps>
  <Step>
    ### Consulta tus datos del browser [#query-data]

    Emplee el generador de consultas para escribir una consulta NRQL para ver los datos de visualizaci√≥n de su p√°gina, de la siguiente manera.

    En New Relic, selecciona **Query your data** (en la esquina superior derecha). Eso te pone en modo **NRQL** . Emplear√° NRQL para probar su consulta antes de colocar los datos en su tabla.

    Copie y pegue esta consulta en un campo de consulta claro y luego seleccione **Run**.

    ```sql
    FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000
    ```

    Si tiene datos de PageView, esta consulta muestra una semana de visitas promedio a la p√°gina desglosadas por pa√≠s y limitadas a mil elementos. La tabla tendr√° todo el ancho y emplear√° la clase &quot;gr√°fico&quot; definida en el CSS.

    Si no tiene ning√∫n resultado en este momento, cerciorar de que su consulta no tenga ning√∫n error. Si tu consulta es correcta, es posible que no tengas instalado el [agente del navegador](/docs/browser/browser-monitoring/installation/install-browser-monitoring-agent/) .
  </Step>

  <Step>
    ### Crear y servir un nuevo Nerdpack [#create-nerdpack]

    Para comenzar, cree un nuevo Nerdpack y env√≠elo a New Relic desde su entorno de desarrollo local:

    1. Actualiza `nr1` y crea un nuevo Nerdpack para esta aplicaci√≥n:

    ```bash
    nr1 update
    nr1 create --type nerdpack --name pageviews-app
    [output] {success}‚úî  {plain}Component created successfully!
    [output]    {purple}nerdpack {blue}pageviews-app {plain}is available at {green}"./pageviews-app"
    ```

    2. Entregue el proyecto hasta New Relic:

    ```bash animate
    cd pageviews-app && nr1 nerdpack:serve
    [output] Found and loaded {green}2 {plain}nr1.json files on PageviewsApp ({purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45{plain}) Nerdpack.
    [output]
    [output] {purple}Nerdpack:
    [output] {success}‚úî  PageviewsApp {purple}(00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45) {blue}nr1.json
    [output]
    [output] {purple}Launchers:
    [output] {success}‚úî  {green}pageviews-app-launcher {blue}launchers/pageviews-app-launcher/nr1.json
    [output]
    [output] {purple}Nerdlets:
    [output] {success}‚úî  {green}pageviews-app-nerdlet {blue}nerdlets/pageviews-app-nerdlet/nr1.json
    [output]
    [output] üõ†  Built artifact files for:
    [output] {yellow}‚Åé  {purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45--pageviews-app-nerdlet {plain}built {success}‚úî
    [output]
    [output] {success}‚úî  {plain}Nerdpack built successfully!
    [output] {yellow}‚òÖ  {plain}Starting as orchestrator...
    [output]
    [output] {success}‚úî  {plain}Server ready! Test it at: https://staging-one.newrelic.com/?nerdpacks=local
    [output] {blue}‚Ü©  Server will reload automatically if you modify any file!
    [output]
    [output] üõ†  Built artifact files for:
    [output] {yellow}‚Åé  {purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45--pageviews-app-nerdlet {plain}built {success}‚úî
    [output]
    [output] {success}‚úî  {plain}Nerdpack built successfully!
    ```
  </Step>

  <Step>
    ### Revise los archivos de su aplicaci√≥n y vea su aplicaci√≥n localmente [#review-files]

    1. Navega hasta tu `pageviews-app` para ver c√≥mo est√° estructurado. Contiene una carpeta de inicio, donde puedes personalizar la descripci√≥n y el √≠cono que se mostrar√° en el iniciador de la aplicaci√≥n en New Relic. Tambi√©n contiene `nerdlets`, cada uno de los cuales contiene tres archivos predeterminados: `index.js`, `nr1.json` y `styles.scss`. Editar√°s algunos de estos archivos como parte de esta gu√≠a. Para obtener m√°s informaci√≥n, consulte [Estructura de archivos de Nerdpack](/docs/new-relic-solutions/build-nr-ui/nerdpack-file-structure).

    2. Ahora en tu browser, abre `https://one.newrelic.com/?nerdpacks=local` y luego haz clic en **Apps** para ver el `pageview-apps` Nerdpack que presentaste.

    Cuando selecciona el iniciador, ve un mensaje `Hello` .
  </Step>

  <Step>
    ### Codifique su ID de cuenta [#account-id]

    Para los fines de este ejercicio y para su comodidad, codifique su ID de cuenta. En el directorio `pageview-app-nerdlet` , en el archivo `index.js` , agregue este c√≥digo entre las l√≠neas `import` y `export` . ([Lea c√≥mo encontrar su ID de cuenta aqu√≠](/docs/accounts/install-new-relic/account-setup/account-id)).

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return <h1>Hello, pageview-app-nerdlet Nerdlet!</h1>;
      }
    }
    ```
  </Step>

  <Step>
    ### Importar el `TableChart` [#import-table-component]

    Para mostrar sus datos en un gr√°fico de tabla, importe el componente `TableChart` de New Relic. Para hacerlo, en `index.js`, agregue este c√≥digo debajo de `import React`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return <h1>Hello, pageview-app-nerdlet Nerdlet!</h1>;
      }
    }
    ```
  </Step>

  <Step>
    ### Agregar una tabla con una sola fila [#add-single-row-table]

    Para agregar una tabla con una sola fila, en el archivo `index.js` , reemplace esta l√≠nea con este c√≥digo `export` :

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row"></div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Personaliza el aspecto de tu mesa (opcional) [#customize-table]

    Puede emplear CSS est√°ndar para personalizar el aspecto de sus componentes.

    En el archivo `styles.scss` , agregue este CSS. Si√©ntete libre de personalizar este CSS a tu gusto.

    ```css fileName=pageview-app-nerdlet/styles.scss
    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }
    ```
  </Step>

  <Step>
    ### Obtenga sus datos en esa tabla [#add-data-table]

    Ahora que tiene una tabla, puede colocar un `TableChart` lleno de datos de la consulta NRQL que escribi√≥ al principio de esta gu√≠a.

    Coloque este c√≥digo en el div `row` .

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Vaya a New Relic y haga clic en su aplicaci√≥n para ver sus datos en la tabla. (Es posible que tengas que enviar tu aplicaci√≥n a New Relic nuevamente).

    ¬°Felicidades! ¬°Hiciste tu aplicaci√≥n! Contin√∫e para hacerlo interactivo y mostrar sus datos en un mapa.
  </Step>
</Steps>

## Haga que su aplicaci√≥n sea interactiva con un campo de texto [#app-text-field]

Una vez que confirmes que los datos llegan a New Relic desde tu aplicaci√≥n, puedes comenzar a personalizarlos y hacerlos interactivos. Para hacer esto, agrega un campo de texto para filtrar sus datos. Posteriormente, emplea una biblioteca de terceros llamada `Leaflet` para mostrar esos datos en un mapa mundial.

<Steps>
  <Step>
    ### Importar el `TextField` [#import-textfield]

    Al igual que hizo con el componente `TableChart` , debe importar un [componente`TextField` ](/docs/new-relic-solutions/build-nr-ui/sdk-component/controls/TextField/)desde New Relic.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Agregue una fila para su campo de texto [#add-row-textfield]

    Para agregar un filtro de campo de texto encima de la tabla, coloque este c√≥digo encima del div `TableChart` . El campo de texto tendr√° un valor predeterminado de &quot;EE.UU.&quot;

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Construir el objeto de campo de texto [#build-text-field]

    Encima de la funci√≥n `render()` , agregue un `constructor` para crear el objeto de campo de texto.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Arriba de `return`, agregue:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Ahora agregue `countryCode` a su consulta de gr√°fico de tabla.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from "react";
    import { TableChart, TextField } from "nr1";

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ""
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Vuelve a cargar tu aplicaci√≥n para probar el campo de texto.
  </Step>
</Steps>

## Obtenga sus datos en un mapa [#add-data-map]

Para crear el mapa, usa npm para instalar `Leaflet`.

<Steps>
  <Step>
    ### Instalar `Leaflet` [#install-leaflet]

    En tu terminal escribe:

    ```bash
    npm install --save leaflet react-leaflet
    ```

    En su archivo nerdlets `styles.scss` , importe el CSS `Leaflet` :

    ```css fileName=pageview-app-nerdlet/styles.scss
    @import `~leaflet/dist/leaflet.css`;

    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }
    ```

    Mientras est√©s en `styles.scss`, corrige el ancho y el alto de tu mapa:

    ```css fileName=pageview-app-nerdlet/styles.scss
    @import `~leaflet/dist/leaflet.css`;

    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }

    .containerMap {
      width: 100%;
      z-index: 0;
      height: 70vh;
    }
    ```
  </Step>

  <Step>
    ### Agregue un archivo de configuraci√≥n de paquete sitio web para `Leaflet`

    Agregue un archivo de configuraci√≥n del paquete sitio web `.extended-webpackrc.js` a la carpeta de nivel superior de su nerdpack. Esto admite el uso de datos de informaci√≥n de mosaico de mapas de `Leaflet`.

    ```jsx fileName=.extended-webpackrc.js
    module.exports = {
      module: {
        rules: [
          {
            test: /\.(png|jpe?g|gif)$/,
            use: [
              {
                loader: 'file-loader',
                options: {},
              },
              {
                loader: 'url-loader',
                options: { limit: 25000 },
              },
            ],
          },
        ],
      },
    };
    ```
  </Step>

  <Step>
    ### Importar m√≥dulos desde `Leaflet`

    En `index.js`, importe m√≥dulos desde `Leaflet`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Importar m√≥dulos adicionales desde New Relic

    Necesita varios m√≥dulos m√°s de New Relic para que el mapa `Leaflet` funcione bien. Importarlos con este c√≥digo:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    `NerdGraphQuery` le permite realizar m√∫ltiples consultas NRQL a la vez y es lo que llenar√° el mapa con datos. `Spinner` agrega un control giratorio de carga. `Button` te proporciona los componentes del bot√≥n. `BlockText` te proporciona componentes de texto en bloque.
  </Step>

  <Step>
    ### Obtener datos para el mapa. [#get-data-map]

    Usando latitud y longitud con c√≥digos de pa√≠s, puede colocar datos de New Relic en un mapa.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) AS 'x', average(duration) AS 'y', sum(asnLatitude)/count(*) AS 'lat', sum(asnLongitude)/count(*) AS 'lng' FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Personaliza los colores de los marcadores del mapa. [#customize-map-colors]

    Encima de la funci√≥n `mapData` , agregue este c√≥digo para personalizar los colores del marcador del mapa.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) AS 'x', average(duration) AS 'y', sum(asnLatitude)/count(*) AS 'lat', sum(asnLongitude)/count(*) AS 'lng' FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Sentir libre de cambiar los valores del c√≥digo de color HTML a su gusto. En este ejemplo, `#11A600` es verde, `#FFD966` es una especie de amarillo y `#BF0016` es rojo.
  </Step>

  <Step>
    ### Establece el punto central predeterminado de tu mapa

    Establezca un punto central predeterminado para su mapa usando latitud y longitud.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) AS 'x', average(duration) AS 'y', sum(asnLatitude)/count(*) AS 'lat', sum(asnLongitude)/count(*) AS 'lng' FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Agrega una fila para tu mapa [#add-row-map]

    Entre la fila del campo de texto y la fila del gr√°fico de la tabla, inserte una nueva fila para el contenido del mapa usando `NerdGraphQuery`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) AS 'x', average(duration) AS 'y', sum(asnLatitude)/count(*) AS 'lat', sum(asnLongitude)/count(*) AS 'lng' FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <div className="row">
                <NerdGraphQuery query={this.mapData()}>
                  {({ loading, error, data }) => {
                    if (loading) {
                      return <Spinner fillContainer />;
                    }
                    if (error) {
                      return 'Error';
                    }
                    const { results } = data.actor.account.mapData;
                    console.debug(results);
                    return 'Hello';
                  }}
                </NerdGraphQuery>
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Vuelva a cargar su aplicaci√≥n en New Relic para probar que funciona.
  </Step>

  <Step>
    ### Reemplace &quot;Hola&quot; con el c√≥digo del folleto [#replace-hello]

    Reemplace `return "Hello";` con:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) AS 'x', average(duration) AS 'y', sum(asnLatitude)/count(*) AS 'lat', sum(asnLongitude)/count(*) AS 'lng' FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode LIKE '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <div className="row">
                <NerdGraphQuery query={this.mapData()}>
                  {({ loading, error, data }) => {
                    if (loading) {
                      return <Spinner fillContainer />;
                    }
                    if (error) {
                      return 'Error';
                    }
                    const { results } = data.actor.account.mapData;
                    console.debug(results);

                    return (
                      <Map
                        className="containerMap"
                        center={defaultMapCenter}
                        zoom={2}
                        zoomControl
                      >
                        <TileLayer
                          attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                        />
                        {results.map((pt, i) => {
                          const center = [pt.lat, pt.lng];
                          return (
                            <CircleMarker
                              key={`circle-${i}`}
                              center={center}
                              color={this.getMarkerColor(pt.y)}
                              radius={Math.log(pt.x) * 3}
                              onClick={() => {
                                alert(JSON.stringify(pt));
                              }}
                            />
                          );
                        })}
                      </Map>
                    );
                  }}
                </NerdGraphQuery>
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode LIKR '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>
</Steps>

Este c√≥digo crea un mapa mundial centrado en la latitud y longitud que usted eligi√≥ usando los datos `OpenStreetMap` y los colores de su marcador.

¬°Recarga tu aplicaci√≥n para ver los datos de p√°ginas vistas en el mapa!