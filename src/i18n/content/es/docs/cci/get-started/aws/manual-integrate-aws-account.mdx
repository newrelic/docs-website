---
title: Integre manualmente su cuenta de AWS
tags:
  - cloud cost intelligence
  - aws
  - amazon web services
  - aws cost management
  - cloud cost optimization
  - cci aws
  - manual aws setup
metaDescription: Manually integrate your AWS account with Cloud Cost Intelligence by configuring required AWS resources and settings.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="avance">
  Todavía estamos trabajando en esta característica, ¡pero nos encantaría que la probaras!

  Esta característica se proporciona actualmente como parte de un programa de vista previa de conformidad con nuestras [políticas de prelanzamiento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Integre manualmente su cuenta de AWS con Cloud Cost Intelligence configurando los recursos y ajustes de AWS necesarios. Este método proporciona un control total sobre cada paso de configuración.

## Instrucciones de configuración

<Callout variant="important">
  Para los siguientes pasos, inicie sesión en la **Consola de administración de AWS** y mantenga la sesión iniciada durante todo el proceso.
</Callout>

<Steps>
  <Step>
    ### Crea un bucket de S3 para los informes de Costo y Uso [#create-s3-bucket]

    Cree un bucket de S3 para almacenar los informes de costos y uso (CUR) de AWS. Recomendamos usar la región `us-east-2`.

    1. Navegue al **S3 service** y haga clic en **Create bucket**.

    2. Ingrese un nombre de bucket único (por ejemplo, `<your-company-name>-billing`).

    3. Configurar los ajustes del bucket:

       * Habilitar el control de versiones
       * Deshabilitar el acceso público (recomendado)
       * Habilitar el cifrado predeterminado (recomendado)

    4. **Etiquetas (Opcional)**: Agregue cualquier etiqueta si es necesario para la gestión de recursos de su organización y haga clic en **Create bucket**.

    <Callout variant="important">
      Recuerda el nombre del bucket para los siguientes pasos.
    </Callout>
  </Step>

  <Step>
    ### Configure los informes de costos y uso de AWS [#create-cur]

    Cree un **Cost and Usage Report** para que se entregue a su bucket de S3:

    1. Navegue a **Billing Dashboard** &gt; **Cost &amp; Usage Analysis** &gt; **Data Exports** y a continuación, haga clic en **Create**.

    2. Configurar los ajustes del reporte:

       <table>
         <thead>
           <tr>
             <th width={250}>
               **Configuración**
             </th>

             <th>
               **Valor**
             </th>

             <th>
               **Descripción**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               Tipo de exportación
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               Información detallada de uso y costos para el análisis de facturación y costos.
             </td>
           </tr>

           <tr>
             <td>
               Nombre de exportación
             </td>

             <td>
               `Name`
             </td>

             <td>
               Nombre para el informe CUR (por ejemplo, `<company-name>-billing-cci`).
             </td>
           </tr>

           <tr>
             <td>
               Tabla de datos
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               Admite la última estructura de tabla con formato FOCUS.
             </td>
           </tr>

           <tr>
             <td>
               Incluir identificadores de recursos
             </td>

             <td>
               `ON`
             </td>

             <td>
               Permite el seguimiento detallado de los costos por recursos individuales de AWS.
             </td>
           </tr>

           <tr>
             <td>
               Datos de asignación de costos divididos
             </td>

             <td>
               `OFF`
             </td>

             <td>
               Simplifica la estructura de datos. Omita esta opción a menos que se requieran divisiones detalladas de la asignación de costos.
             </td>
           </tr>

           <tr>
             <td>
               detalle temporal
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               Requerido para un análisis detallado de costos y uso.
             </td>
           </tr>

           <tr>
             <td>
               Tipo de compresión
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               Formato de almacenamiento columnar que mejora el rendimiento de las consultas y reduce el espacio de almacenamiento.
             </td>
           </tr>

           <tr>
             <td>
               Control de versiones de archivos
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               Crea una nueva versión con cada actualización, conservando los informes históricos para la auditoría.
             </td>
           </tr>

           <tr>
             <td>
               Configuración de actualización de datos
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               Mantiene los datos de CUR actualizados automáticamente.
             </td>
           </tr>

           <tr>
             <td>
               Configuración de exportación de datos en el bucket S3
             </td>

             <td>
               Seleccione el bucket que creó en [Crear bucket de S3 para informes de costos y uso](#create-s3-bucket)
             </td>

             <td>
               Los archivos CUR se guardan en el bucket de S3. Acepte sobrescribir la política.
             </td>
           </tr>

           <tr>
             <td>
               prefijo de ruta S3
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               Organiza los informes de costos y uso dentro del bucket de S3.
             </td>
           </tr>
         </tbody>
       </table>

    3. Haz clic en **Next** y luego en **Create report**.

    <Callout variant="important">
      Recuerda el nombre de exportación para la integración de CCI. Asegúrate de que el prefijo de la ruta de S3 sea `cost-and-usage-reports`. El primer informe se entrega en 24 horas; los informes posteriores se entregan periódicamente.
    </Callout>
  </Step>

  <Step>
    ### Crear una política de IAM para el acceso a CCI [#create-iam-policy]

    Cree una política de Identity and Access Management (IAM) que otorgue permisos a CCI para acceder a sus datos de CUR:

    1. Navegue a **IAM service** &gt; **Policies** y haga clic en **Create policy**.
    2. Cambie al **editor JSON (JSON editor)** y pegue la siguiente política:

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      Reemplaza `bucket-name` con el nombre de tu bucket de S3 de [Crea un bucket de S3 para los informes de Costo y Uso](#create-s3-bucket).
    </Callout>

    3. Haga clic en **Next**.
    4. Nombre la política `CCI-Access-Policy` (o su nombre preferido), agregue una descripción y haga clic en **Create policy**.
  </Step>

  <Step>
    ### Crear un rol de IAM para que CCI lo asuma [#create-iam-role]

    Crea un rol de IAM que CCI asumirá para acceder a tus datos CUR:

    1. Navegue a **IAM service** &gt; **Roles** y haga clic en **Create role**.
    2. Selecciona **Custom Trust Policy** en la sección de tipo de entidad de confianza y pega la siguiente definición de rol:
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="important" title="Nota">
      El `externalId` se genera cuando inicia la integración de CCI.
    </Callout>

    3. Haga clic en **Next**.
    4. Adjunta la política creada en [Create IAM policy for CCI access](#create-iam-policy) y haz clic en **Next**.
    5. Nombra el rol `CCI-Access-Role` (o tu nombre preferido), agrega una descripción (opcional) y haz clic en **Create role**.
    6. Anote el ARN del rol (Amazon Resource Name) de la página de resumen del rol.

    <Callout variant="important">
      Necesitará el ARN del rol durante la integración de CCI.
    </Callout>
  </Step>

  <Step>
    ### Integre manualmente su cuenta de AWS [#access-integration]

    1. Navegue hasta <DNT>[**one.newrelic.com**](https://one.newrelic.com/) &gt; **Integrations &amp; Agents** &gt; **Cloud Cost Intelligence - AWS**</DNT>.
    2. Seleccione **Manually integrate your AWS account** y haga clic en **Continue**.
  </Step>

  <Step>
    ### Proporcionar detalles de conexión [#provide-connection-details]

    Ingrese los detalles requeridos:

    * **Nombre de la conexión**: Nombre predeterminado proporcionado. Editar para nombre personalizado.
    * **ARN del rol de IAM entre cuentas**: Ingrese el ARN del rol de IAM (Nombre de recurso de Amazon) para permitir que Cloud Cost Intelligence acceda a su bucket de S3 (formato: `arn:aws:iam::<account-id>:role/<role-name>`).
    * **ID externo**: Copie el ID externo y agréguelo a la política de confianza de su rol de IAM en AWS.
    * **Nombre de la exportación de datos**: Ingresa el nombre del archivo de exportación de datos. Para el reporte `cci-ingestion-test`, la ruta es `cost-and-usage-reports/cci-ingestion-test/data`.
    * **Nombre del bucket S3**: Ingresa el nombre exacto del bucket. Utilice la región `us-east-2` para un rendimiento óptimo.
  </Step>

  <Step>
    ### Configurar la política de confianza [#configure-trust-policy]

    Agregue el usuario global de New Relic (`arn:aws:iam::207192125115:user/cci_global_user`) a su política de confianza de rol de IAM:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": {
            "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
          },
          "Action": "sts:AssumeRole",
          "Condition": {
            "StringEquals": {
              "sts:ExternalId": "<externalID>"
            }
          }
        }
      ]
    }
    ```

    <Callout variant="important">
      Establezca `sts:ExternalId` en el ID externo de [Proporcionar detalles de conexión](#provide-connection-details). Active AWS Security Token Service (STS) para las regiones donde no está activo de forma predeterminada (por ejemplo, `ap-east-1`, `eu-south-1`).
    </Callout>
  </Step>

  <Step>
    ### Conexión de prueba [#test-connection]

    Haga clic en **Test connection** para verificar la conexión con su entorno de AWS.

    <Callout variant="important">
      El procesamiento inicial de datos tarda unas horas después de que se complete la configuración.
    </Callout>
  </Step>
</Steps>

## Opcional: Habilitar funciones avanzadas

Habilite estas funciones opcionales para mejorar su análisis de costos de AWS.

### Estimación de costos en tiempo real [#real-time-cost-estimation]

Para habilitar la visualización del costo estimado en tiempo real en CCI, cumpla con los requisitos previos para su método de instrumentación:

<table>
  <thead>
    <tr>
      <th>
        Método
      </th>

      <th>
        Descripción
      </th>

      <th>
        Cuándo elegir
      </th>

      <th>
        Requisitos previos
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        agente de infraestructura e integración
      </td>

      <td>
        Emplea el agente New Relic Infrastructure para una monitorización detallada.
      </td>

      <td>
        Para una visibilidad/control profundos, ideal para configuraciones EC2, EKS/EC2 o ECS/EC2 independientes.
      </td>

      <td>
        * EC2 independiente: Instale el agente de infraestructura de New Relic.
        * EKS/EC2: Instale la integración de Kubernetes.
        * ECS/EC2: Instale la integración de ECS. No es compatible con AWS Fargate.
      </td>
    </tr>

    <tr>
      <td>
        integración en la nube (métrica)
      </td>

      <td>
        Emplea métricas de CloudWatch AWS para monitoreo casi en tiempo real.
      </td>

      <td>
        Cuando los datos en tiempo real son esenciales para entornos dinámicos.
      </td>

      <td>
        Configurar 

        [Amazon CloudWatch Metric Streams](/install/aws-cloudwatch/)

        .
      </td>
    </tr>

    <tr>
      <td>
        integración en la nube (sondeo) - legacy
      </td>

      <td>
        Recopila datos mediante consultas periódicas a los servicios de AWS.
      </td>

      <td>
        Para entornos que toleran actualizaciones menos frecuentes.
      </td>

      <td>
        Configure 

        [la integración de encuestasAWS ](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        .
      </td>
    </tr>
  </tbody>
</table>

### Asignación de costos de Kubernetes [#k8s-cost-allocation]

* [Instale la integración de Kubernetes](https://docs.newrelic.com/install/kubernetes/). La integración de AWS Fargate no es compatible.
* Más allá de las etiquetas estándar de Kubernetes (`app.kubernetes.io/name`, `app.kubernetes.io/instance`, `app.kubernetes.io/component` y `app.kubernetes.io/part-of`), agregue etiquetas personalizadas como `environment` y `team`, y etiquetas de recursos personalizadas como `project` y `costCenter` para una mejor segmentación y análisis de costos.

## Recomendaciones

* Configure las [etiquetas de asignación de costos](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html) en su cuenta de AWS. Aplique al menos dos etiquetas de recursos personalizadas de forma coherente en todos los recursos de AWS para un filtrado y agrupación de costos efectivos.
* Use un bucket de S3 en la región `us-east-2` para un rendimiento y una rentabilidad óptimos.

## Aviso sobre control de acceso

Todos los usuarios con acceso a la cuenta/organización de New Relic designada pueden ver sus datos de costos de la nube de AWS. Seleccione la cuenta/organización de New Relic adecuada que se alinee con sus políticas internas de control de acceso.

<Callout variant="important">
  **Acceso al bucket S3**

  New Relic solo requiere acceso de lectura a su bucket de S3, limitado a un único rol de IAM. Mantenga este nivel de acceso para proteger sus datos.
</Callout>

<DocTiles numbered>
  <DocTile title="Overview of Cloud Cost Intelligence - AWS" path="/docs/cci/get-started/aws/aws-cci" />

  <DocTile title="Automate AWS with CloudFormation" path="/docs/cci/get-started/aws/automated-setup-cloudformation" />

  <DocTile title="Manually integrate your AWS account" label={{text: 'You are here', color: '#FCD672'}} path="/docs/cci/get-started/aws/manual-integrate-aws-account" />
</DocTiles>