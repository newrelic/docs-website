---
title: Configurar las credenciales de AWS
metaDescription: 'Configure AWS credentials for workflow automation using IAM roles, IAM users, or temporary session tokens.'
freshnessValidatedDate: never
translationType: machine
---

<Callout title="avance">
  Todavía estamos trabajando en esta característica, ¡pero nos encantaría que la probaras!

  Esta característica se proporciona actualmente como parte de un programa de vista previa de conformidad con nuestras [políticas de prelanzamiento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Autoriza la automatización del flujo de trabajo de New Relic para que realice acciones en tu cuenta de AWS. Configurarás un método de autenticación que permita a flujo de trabajo interactuar de forma segura con servicios de AWS como EC2, SQS, DynamoDB y más, sin codificar las credenciales ni comprometer la seguridad.

## Requisitos previos

Antes de configurar las credenciales de AWS, cerciorar de tener lo siguiente:

* Una cuenta AWS con licencia para crear roles o usuarios de IAM.
* Su [ID de cuenta de New Relic](/docs/accounts/accounts-billing/account-structure/account-id).
* Acceso de administrador a la [consola de AWS IAM](https://console.aws.amazon.com/iam/).

## Comprender las licencias necesarias [#required-permissions]

Antes de crear las credenciales, comprenda qué licencias necesita su flujo de trabajo. Otorgue únicamente las licencias que su flujo de trabajo realmente emplee; esto sigue el principio de mínimo privilegio y minimiza el riesgo de seguridad.

### Licencias comunes del flujo de trabajo

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        **Tipo de flujo de trabajo**
      </th>

      <th>
        **Licencias de AWS necesarios**
      </th>

      <th>
        **Descripción**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **Gestión de EC2**
      </td>

      <td>
        `ec2:DescribeInstances`<br />`ec2:StopInstances`<br />`ec2:StartInstances`<br />`ec2:ModifyInstanceAttribute`
      </td>

      <td>
        Detener, iniciar o modificar instancias EC2 en respuesta a alertas
      </td>
    </tr>

    <tr>
      <td>
        **Mensajería SQS**
      </td>

      <td>
        `sqs:SendMessage`<br />`sqs:GetQueueAttributes`
      </td>

      <td>
        Enviar mensajes a las colas SQS para su posterior procesamiento.
      </td>
    </tr>

    <tr>
      <td>
        **Puerta de enlace API**
      </td>

      <td>
        `apigateway:GET`<br />`apigateway:PUT`
      </td>

      <td>
        Revertir el despliegue o configuración de API Gateway
      </td>
    </tr>

    <tr>
      <td>
        **Gerente de sistemas**
      </td>

      <td>
        `ssm:CreateDocument`<br />`ssm:DeleteDocument`<br />`ssm:StartAutomationExecution`<br />`ssm:GetAutomationExecution`
      </td>

      <td>
        Ejecutar manuales de automatización
      </td>
    </tr>

    <tr>
      <td>
        **DinamoDB**
      </td>

      <td>
        `dynamodb:Query`<br />`dynamodb:GetItem`<br />`dynamodb:PutItem`
      </td>

      <td>
        Leer o escribir en tablas de DynamoDB
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Comience con licencias de solo lectura (`Describe*`, `Get*`, `List*`), luego agregue licencias de escritura (`Put*`, `Create*`, `Delete*`) solo según sea necesario. Esto evita acciones destructivas accidentales durante las pruebas.
</Callout>

Consulte [los ejemplos de políticas](#policy-examples) a continuación para ver plantillas completas de políticas de IAM.

## Configurar la autenticación

Elija el método que mejor se ajuste a su caso de uso en la tabla anterior:

<Tabs>
  <TabsBar>
    <TabsBarItem id="iam-role-1">Rol de IAM (recomendado)</TabsBarItem> <TabsBarItem id="iam-user-1">Usuario de IAM con claves de acceso</TabsBarItem> <TabsBarItem id="session-tokens-1">Token de sesión</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="iam-role-1">
      Un rol de IAM permite a New Relic asumir credenciales temporales en su cuenta de AWS sin necesidad de claves de acceso permanentes.

      ### Características del rol de IAM:

      * Las credenciales rotan automáticamente
      * El acceso está limitado en el tiempo por diseño.
      * Todas las acciones se registran en AWS CloudTrail.
      * Se alinea con las mejores prácticas de seguridad AWS

      ### Crea el rol en AWS

      1. Inicia sesión en la [consola de AWS IAM](https://console.aws.amazon.com/iam/)

      2. Navegue a **Roles &gt; Crear rol &gt; Tipo de entidad de confianza** y seleccione **Cuenta de AWS &gt; otra cuenta de AWS**

      3. En el campo **Account ID**, introduzca: `253490767857`

      4. En **Options**, marque la casilla **Require external ID**.

      5. En el campo **External ID**, ingrese su ID de cuenta de New Relic y haga clic en **Next**.
         * ¿No lo tienes? [Encuentra tu ID de cuenta aquí.](/docs/accounts/accounts-billing/account-structure/account-id)

      6. En la página **Add permissions**, anexe políticas basadas en su flujo de trabajo:

         * Para flujo de trabajo EC2: anexe `AmazonEC2ReadOnlyAccess` o cree una política personalizada
         * Para flujo de trabajo SQS: anexe `AmazonSQSFullAccess` o limite a colas específicas
         * Para otros servicios: Consulte [las licencias de AWS necesarios.](#required-aws-permissions)

      7. Haga clic en **Next**.

      8. Introduzca un nombre para el rol: `NewRelicWorkflowAutomationRole` (o el nombre que prefiera)

      9. Opcionalmente, agregue una descripción: &quot;Permite que la automatización del flujo de trabajo de New Relic realice acciones en AWS&quot;, y haga clic en **Create role**.

      ### Verifique la política de confianza

      Tras crear el rol, verifique la relación de confianza:

      1. En la consola de IAM, seleccione el rol que acaba de crear.
      2. Haz clic en la pestaña **Trust relationships**
      3. Confirme que la política coincide con esta estructura (reemplace `<YOUR_NR_ACCOUNT_ID>` con su ID de cuenta real):

      ```json
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Action": "sts:AssumeRole",
                  "Principal": {
                      "AWS": "arn:aws:iam::253490767857:root"
                  },
                  "Condition": {
                      "StringEquals": {
                          "sts:ExternalId": "<YOUR_NR_ACCOUNT_ID>"
                      }
                  }
              }
          ]
      }
      ```

      ### Copia tu ARN de rol

      Necesitarás el ARN del rol para configurar el flujo de trabajo:

      1. En la consola de IAM, seleccione su rol.
      2. En la sección **Summary**, localice el campo **ARN**
      3. Copia el ARN completo; tiene el siguiente aspecto: `arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole`
      4. Almacene este ARN de forma segura: lo pegará directamente en la configuración de flujo de trabajo

      <Callout variant="tip">
        **Importante:** Los ARN de rol van directamente en las entradas del flujo de trabajo; no los almacene en el administrador de secretos. No son credenciales confidenciales; son identificadores de recursos.
      </Callout>

      El rol ya está configurado. Emplee el ARN en la configuración de flujo de trabajo que requiera acceso AWS.
    </TabsPageItem>

    <TabsPageItem id="iam-user-1">
      Emplee este método para entornos de prueba o cuando no se admitan roles de IAM. Las claves de acceso son credenciales de larga duración que requieren rotación manual.

      **Casos de uso:**

      * Entornos de prueba y desarrollo
      * Configuración AWS que no admite la asunción de roles entre cuentas
      * Autenticación simplificada flujo de trabajo

      <Callout variant="caution">
        Las claves de acceso son credenciales de larga duración. Rótelos de manera regular (cada 90 días) y limite las licencias solo a lo que su flujo de trabajo necesita.
      </Callout>

      ### Crea el usuario de IAM

      1. Inicia sesión en la [consola de AWS IAM](https://console.aws.amazon.com/iam/)

      2. Navegue a **Users &gt; Create user** e ingrese un nombre de usuario: `workflow-automation-user` (o su nombre preferido)

      3. Haga clic en **Next**

      4. En la página **Set permissions**, seleccione **Attach policies directly**.

      5. Busque y seleccione pólizas en función de su flujo de trabajo:

         * Para SQS: Seleccionar `AmazonSQSFullAccess`
         * Para EC2: Seleccione `AmazonEC2ReadOnlyAccess`
         * O bien, cree una política personalizada con licencias limitadas (recomendado).

      6. Haz clic en **Next** y luego en** Create user**

      ### Generar claves de acceso

      1. En la lista de usuarios, seleccione el usuario que acaba de crear.

      2. Haz clic en la pestaña **Security credentials**

      3. En la sección **Access keys**, seleccione **Create access key**

      4. Seleccione **Application running outside AWS** y haga clic en **Next**.

      5. (Opcional) Agregue una etiqueta de descripción: &quot;Automatización del flujo de trabajo de New Relic&quot;

      6. Seleccione **Create access key**

      7. Copie ambas credenciales inmediatamente:

         * **ID de clave de acceso** (comienza con `AKIA...`)
         * **Clave de acceso secreta** (se muestra solo una vez)

      <Callout variant="important">
        AWS muestra la clave de acceso secreta solo una vez durante la creación. Si no lo almacenas, tendrás que generar un nuevo par de claves.
      </Callout>

      ### Almacena las credenciales de forma segura.

      Nunca codifique las credenciales AWS en el flujo de trabajo. En su lugar, almacénelos en [el administrador de secretos](/docs/infrastructure/host-integrations/installation/secrets-management/) de New Relic.

      1. Abre el [explorador GraphiQL de NerdGraph](https://one.newrelic.com/nerdgraph-graphiql)
      2. Ejecuta esta mutación para almacenar tu ID de clave de acceso (reemplaza los valores de marcador de posición):

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsAccessKeyId"
          description: "AWS Access Key ID for workflow automation"
          value: "YOUR_AWS_ACCESS_KEY_ID"
        ) {
          key
        }
      }
      ```

      3. Ejecuta otra mutación para tu clave de acceso secreta:

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsSecretAccessKey"
          description: "AWS Secret Access Key for workflow automation"
          value: "YOUR_AWS_SECRET_ACCESS_KEY"
        ) {
          key
        }
      }
      ```

      **Haga referencia a estos secretos en el flujo de trabajo** empleando la sintaxis: `${{ :secrets:awsAccessKeyId }}`

      <Callout variant="tip">
        Emplee el campo `namespace` para organizar los secretos por entorno (`aws-prod`, `aws-staging`) o nombre del equipo.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="session-tokens-1">
      El token de sesión proporciona credenciales temporales con caducidad automática.

      **Casos de uso:**

      * Desarrollo y pruebas locales
      * Pipeline de CI/CD que requiere rotación de credenciales
      * Entornos con requisitos de cumplimiento para el acceso limitado en el tiempo (normalmente de 1 a 12 horas).

      ### Requisitos previos

      * [AWS CLI instalado y configurado](https://aws.amazon.com/cli/)
      * Un rol de IAM existente que puedes asumir

      ### Generar credenciales temporales

      1. Abre tu terminal y ejecuta este comando (reemplaza con el ARN de tu rol):

      ```bash
      aws sts assume-role \
        --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/YOUR_ROLE" \
        --role-session-name "WorkflowAutomationSession"
      ```

      Si es la primera vez que emplea la CLI de AWS, es posible que deba configurarla con `aws configure` e ingresar sus credenciales de acceso:

      <img title="Image of the Static Access credentials" alt="Image of the Static Access credentials" src="/images/static-access.webp" />

      2. AWS devuelve tres valores; necesitas los tres:

      ```json
      {
        "Credentials": {
            "AccessKeyId": "ASIAIOSFODNN7EXAMPLE",
            "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
            "SessionToken": "FQoGZXIvYXdzEBk...",
            "Expiration": "2025-01-25T12:00:00Z"
        }
      }
      ```

      3. Almacena las tres credenciales en el administrador de secretos:

      * `AccessKeyId` almacenar como `awsAccessKeyId`
      * `SecretAccessKey` almacenar como `awsSecretAccessKey`
      * `SessionToken` almacenar como `awsSessionToken`

      <Callout variant="caution">
        El token de sesión caduca (normalmente luego de 1 hora). Establece un recordatorio para actualizarlos antes de la timestamp `Expiration`, o tu flujo de trabajo fallará con errores de autenticación.
      </Callout>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Usar credenciales en flujo de trabajo [#use-credentials]

Luego de configurar la autenticación, haga referencia a sus credenciales en la configuración de flujo de trabajo:

### Rol de IAM (recomendado)

Pegue el ARN del rol directamente en las entradas del flujo de trabajo; no se necesita ningún administrador de secretos:

```yaml
awsRoleArn: arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole
```

<Callout variant="tip">
  Los ARN de rol son identificadores de recursos, no credenciales confidenciales. No los almacenes en el administrador de secretos; pégalos directamente en la configuración de flujo de trabajo.
</Callout>

### Usuario o token de sesión de IAM

Gestor de secretos de referencia para claves de acceso:

```yaml
awsAccessKeyId: ${{ :secrets:awsAccessKeyId }}
awsSecretAccessKey: ${{ :secrets:awsSecretAccessKey }}
awsSessionToken: ${{ :secrets:awsSessionToken }}  # Only for session tokens
```

New Relic recupera los secretos en tiempo de ejecución, se autentica con AWS y luego los descarta. Tus credenciales nunca aparecen en los logs ni en el historial del flujo de trabajo.

## Ejemplos de políticas [#policy-examples]

Emplee estas plantillas completas de políticas IAM para tipos de flujo de trabajo comunes. Cada una sigue el principio de mínimo privilegio al restringir el acceso a recursos específicos.

<CollapserGroup>
  <Collapser id="sqs-policy" title="Mensajería SQS flujo de trabajo">
    Restringir el acceso a una cola específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": "sqs:SendMessage",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        },
        {
          "Effect": "Allow",
          "Action": "sqs:GetQueueAttributes",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        }
      ]
    }
    ```

    Reemplace `us-west-2` con su región, `123456789012` con su ID de cuenta de AWS y `my-workflow-queue` con el nombre de su cola.
  </Collapser>

  <Collapser id="ec2-policy" title="EC2 gestión flujo de trabajo">
    Restringir el acceso a una instancia específica mediante etiqueta:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ec2:DescribeInstances",
            "ec2:DescribeTags"
          ],
          "Resource": "*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ec2:StopInstances",
            "ec2:StartInstances",
            "ec2:ModifyInstanceAttribute"
          ],
          "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/*",
          "Condition": {
            "StringEquals": {
              "aws:ResourceTag/Environment": "production"
            }
          }
        }
      ]
    }
    ```

    Esta política permite que el flujo de trabajo *detenga/inicie/modifique* solo instancias de la etiqueta EC2 con `Environment=production`.
  </Collapser>

  <Collapser id="dynamodb-policy" title="Flujo de trabajo de DynamoDB">
    Restringir el acceso a una tabla específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "dynamodb:Query",
            "dynamodb:GetItem",
            "dynamodb:PutItem"
          ],
          "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/WorkflowData"
        }
      ]
    }
    ```

    Reemplace `WorkflowData` con el nombre de su tabla.
  </Collapser>

  <Collapser id="ssm-policy" title="Responsable de sistemas flujo de trabajo">
    Restringir el acceso a documentos de automatización específicos:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ssm:CreateDocument",
            "ssm:DeleteDocument"
          ],
          "Resource": "arn:aws:ssm:us-east-1:123456789012:document/WorkflowAutomation-*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ssm:StartAutomationExecution",
            "ssm:GetAutomationExecution"
          ],
          "Resource": [
            "arn:aws:ssm:us-east-1:123456789012:automation-definition/WorkflowAutomation-*:*",
            "arn:aws:ssm:us-east-1:123456789012:automation-execution/*"
          ]
        }
      ]
    }
    ```

    Esto restringe los documentos de automatización a aquellos que comienzan con `WorkflowAutomation-`.
  </Collapser>

  <Collapser id="apigateway-policy" title="Flujo de trabajo de API Gateway">
    Restringir el acceso a una API específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "apigateway:GET",
            "apigateway:PUT"
          ],
          "Resource": "arn:aws:apigateway:us-west-2::/restapis/abc123xyz/*"
        }
      ]
    }
    ```

    Reemplace `abc123xyz` con su ID de API Gateway.
  </Collapser>
</CollapserGroup>

### Recursos adicionales

Para obtener referencias completas sobre las licencias de AWS:

* **[Políticas gestionadas de integraciónAWS ](/docs/infrastructure/amazon-integrations/get-started/integrations-managed-policies/)**: Lista completa de licencias AWS por servicio, además de plantillas de CloudFormation que puede adaptar.
* **[Configurar sondeo de API de AWS](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)**: Patrones de configuración adicionales

<Callout variant="important">
  Esos recursos emplean el ID de cuenta `754728514883` para la integración en la nube (monitoreo). Para la automatización del flujo de trabajo, emplee siempre `253490767857`.
</Callout>

## Que sigue

* **[Crear destinos](/docs/workflow-automation/setup-and-configuration/create-destinations)**: Configurar notificaciones por Slack, email o webhook.
* **[Catálogo de acciones](/docs/workflow-automation/setup-and-configuration/actions-catalog/actions-catalog)**: Vea todas las acciones disponibles de AWS, New Relic y de integración.