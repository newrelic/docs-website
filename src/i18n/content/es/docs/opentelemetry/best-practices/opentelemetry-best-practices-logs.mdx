---
title: Registro OpenTelemetry en New Relic
tags:
  - Integrations
  - Open source telemetry integrations
  - OpenTelemetry
  - Logs
metaDescription: Details on how New Relic works with OpenTelemetry logs
freshnessValidatedDate: '2024-05-17T00:00:00.000Z'
translationType: machine
---

Esta documentación se centra en cómo New Relic procesa el registro OpenTelemetry recibido a través de su extremo OTLP dedicado.

Hay dos flujos de trabajo típicos para enviar registros OpenTelemetry a New Relic:

* [Directo al recolector](https://opentelemetry.io/docs/specs/otel/logs/#direct-to-collector):

  * La aplicación puede enviar el registro directamente al New Relic OTLP endpoint.
  * Consulte la [documentación del lenguaje OpenTelemetry](https://opentelemetry.io/docs/languages/) relevante para obtener detalles de implementación específicos y [el monitoreo de OpenTelemetry APM](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-intro/) para obtener detalles sobre los servicios de monitoreo con New Relic.

* [A través de archivo o `stdout`](https://opentelemetry.io/docs/specs/otel/logs/#via-file-or-stdout-logs):

  * Este método implica extraer el registro de aplicación escrito en archivos o salida estándar (`stdout`).

  * El recolector OpenTelemetry se emplea normalmente para esta tarea. Luego, los troncos raspados se envían al OTLP New Relic endpoint.

  * Puede encontrar información de configuración detallada en los siguientes recursos de OpenTelemetry:

    * [Recolector OpenTelemetry](https://opentelemetry.io/docs/collector/)
    * [Receptor de registros de archivos con Kubernetes](https://opentelemetry.io/docs/kubernetes/collector/components/#filelog-receiver)
    * [Un ejemplo práctico que demuestra este flujo de trabajo para una aplicación Java usando Log4j2](https://github.com/newrelic/newrelic-opentelemetry-examples/tree/main/other-examples/java/logs-in-context-log4j2)

Independientemente del método de recopilación elegido, una integración exitosa requiere configurar su fuente log para exportar registros a este extremo. Cerciorar de revisar los [requisitos de configuración extrema](/docs/opentelemetry/best-practices/opentelemetry-otlp/#configure-endpoint-port-protocol) antes de continuar.

## Mapeo de registro log OTLP [#otlp-log-mapping]

New Relic asigna log de OTLP al tipo de datos `Log`. La siguiente tabla describe cómo los campos del [mensaje proto`LogRecord` ](https://github.com/open-telemetry/opentelemetry-proto/blob/main/opentelemetry/proto/logs/v1/logs.proto)se asignan a New Relic `Log`:

<table>
  <thead>
    <tr>
      <th>
        Campo OTLP `logs.proto`
      </th>

      <th>
        Campo New Relic `Log`
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `ResourceLogs.Resource.attributes`
      </td>

      <td>
        Cada valor principal es un atributo en el campo `Log` **\[1]**
      </td>
    </tr>

    <tr>
      <td>
        `ScopeLogs.InstrumentationScope.name`
      </td>

      <td>
        `otel.library.name`
      </td>
    </tr>

    <tr>
      <td>
        `ScopeLogs.InstrumentationScope.version`
      </td>

      <td>
        `otel.library.version`
      </td>
    </tr>

    <tr>
      <td>
        `ScopeLogs.InstrumentationScope.attributes`
      </td>

      <td>
        Cada valor principal es un atributo en el campo `Log` **\[1]**
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.time_unix_nanos`
      </td>

      <td>
        `timestamp` **\[2]**
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.severity_number`
      </td>

      <td>
        `severity.number`
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.severity_text`
      </td>

      <td>
        `severity.text`
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.body`
      </td>

      <td>
        `message`, y posiblemente atributo analizado **\[3]**
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.attributes`
      </td>

      <td>
        Cada valor principal es un atributo en el campo `Log` **\[1]**
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.dropped_attribute_count`
      </td>

      <td>
        `otel.dropped_attributes_count`
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.flags`
      </td>

      <td>
        `w3c.flags` (entero)
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.trace_id`
      </td>

      <td>
        `trace.id`
      </td>
    </tr>

    <tr>
      <td>
        `LogRecord.span_id`
      </td>

      <td>
        `span.id`
      </td>
    </tr>
  </tbody>
</table>

### Notas a pie de tabla [#otlp-mapping-notes]

**\[1]** En caso de conflicto en el atributo de recurso, el atributo de alcance, el atributo de registro log , los campos de registro log de nivel superior y el atributo analizado de `LogRecord.body` **\[3]**, el orden del precedente (de mayor a menor) es: atributo analizado de `LogRecord.body` -> campos de nivel superior `LogRecord.*` > `LogRecord.attributes` > `ScopeLogs.InstrumentationScope.attributes` > `ResourceLogs.Resource.attributes`.

**\[2]** Si `LogRecord.time_unix_nanos` no está presente, `timestamp` se establece en la hora en que New Relic recibió los datos.

**\[3]** [El análisis de registros](/docs/logs/ui-data/parsing/) se aplica a `LogRecord.body` para intentar extraer el atributo del texto log sin formato. Por ejemplo, si se emplea un formato log estructurado JSON, el valor principal se convierte en atributo en el log resultante. Esto es particularmente útil cuando se recopilan registros de archivos o `stdout`. En este caso, es común no tener ningún atributo de recurso asociado con el log (requerido para [la correlación del servicioAPM ](#service-correlation)) y ningún valor para `LogRecord.trace_id` / `LogRecord.span_id` (requerido para [la correlación de traza](#trace-correlation)). La correlación funcionará según lo previsto si los campos obligatorios se pueden analizar correctamente.

## Correlación con el servicio OpenTelemetry APM [#service-correlation]

log se correlacionan con una entidad de servicio si incluyen el [atributo requerido](/docs/opentelemetry/best-practices/opentelemetry-best-practices-resources/#required-attributes). Normalmente, estos provienen del atributo de recurso del log, como `ResourceLogs.Resource.attributes`, pero también se pueden analizar desde `LogRecord.body` como se describe en [la nota al pie n.° 3 del mapeo de OTLP](#otlp-mapping-notes).

Para ver el registro de un servicio, navegue hasta la [página de registro](/docs/logs/ui-data/use-logs-ui/) de ese servicio.

## Correlación con trazas [#trace-correlation]

Log se correlacionan con una traza si `trace.id` y `span.id` atributo se pueden resolver. Normalmente, estos provienen de los campos `LogRecord.trace_id` y `LogRecord.span_id` , pero también se pueden analizar desde `LogRecord.body` como se describe en la nota al pie 3 del [mapeo OTLP](#otlp-mapping-notes).

Para ver el registro registrado en el contexto de una traza particular, tiene dos opciones:

* Navegue a la pestaña de **Logs** dentro de la [página de detalles de la traza](/docs/distributed-tracing/ui-data/trace-details/#view-your-logs).
* Navegue a la [página de registro](/docs/logs/ui-data/use-logs-ui/) de un servicio y haga clic en un log para abrir los detalles log. Si está asociado a una traza, podrás navegar desde los **Log details** hasta los **Trace details**.
