---
title: Configurar ATP para Kubernetes
metaDescription: Step-by-step guide to install and configure the Adaptive Telemetry Processor (ATP) with NRDOT Collector in Kubernetes environments.
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Kubernetes
  - Helm
  - Manifests
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Avance">
  Todavía estamos trabajando en esta característica, ¡pero nos encantaría que la probaras!

  Esta función se proporciona actualmente como parte de una vista previa de conformidad con nuestras [políticas de prelanzamiento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/).
</Callout>

Aprenda a instalar y configurar el Adaptive Telemetry Processor (ATP) con el NRDOT Collector en entornos de Kubernetes. ATP reduce el volumen de datos de telemetría mientras mantiene una visibilidad crítica de sus aplicaciones.

<Callout variant="important">
  ATP para Kubernetes utiliza una compilación experimental. Toda esta compilación es experimental para la instalación de Kubernetes, no solo la función ATP que está en vista previa.
</Callout>

## Métodos de instalación [#installation-methods]

Puede instalar el OpenTelemetry Collector con ATP mediante Helm (recomendado) o manifiestos de Kubernetes:

<Tabs>
  <TabsBar>
    <TabsBarItem id="helm">Instalación con Helm (recomendado)</TabsBarItem> <TabsBarItem id="manifest">Instalación con manifiesto</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="helm">
      El método de instalación de Helm es el enfoque recomendado para desplegar colectores habilitados para ATP en Kubernetes.

      <Steps>
        <Step>
          ### Antes de que empieces [#helm-prereq]

          Asegúrese de tener:

          * Su clave de licencia de New Relic
          * kubectl configurado para acceder a su clúster
          * Permisos de administrador del clúster
        </Step>

        <Step>
          ### Descargar y personalizar values.yaml [#helm-values]

          1. Descargue el archivo `values.yaml` del chart de Helm:

             ```bash
             curl -o values.yaml https://raw.githubusercontent.com/newrelic/helm-charts/master/charts/nr-k8s-otel-collector/values.yaml
             ```

          2. Edite el archivo `values.yaml` con su configuración específica:

             ```yaml
             # Required: Set your cluster name and license key
             cluster: "YOUR_CLUSTER_NAME"
             licenseKey: "YOUR_NEW_RELIC_LICENSE_KEY"

             # Enable ATP
             enable_atp: true

             # IMPORTANT: Use experimental collector image for ATP
             images:
               collector:
                 repository: "newrelic/nrdot-collector"  # Changed from nrdot-collector-k8s
                 tag: "<NRDOT_COLLECTOR_LATEST_VERSION>"  # Use latest version from releases page
             ```

          3. Busque la versión más reciente de NRDOT Collector en la [página de lanzamientos](https://github.com/newrelic/nrdot-collector-releases/releases) y actualice el valor `tag`.

          4. Para opciones de configuración adicionales, consulte los [parámetros de configuración](/docs/kubernetes-pixie/k8s-otel/install/#config-params).
        </Step>

        <Step>
          ### Instale el chart de Helm [#helm-install]

          1. Agregue el repositorio Helm de New Relic:

             ```bash
             helm repo add newrelic https://helm-charts.newrelic.com
             helm repo update
             ```

          2. Instale el chart utilizando su archivo `values.yaml` personalizado:

             ```bash
             helm upgrade nr-k8s-otel-collector newrelic/nr-k8s-otel-collector \
               -f values.yaml \
               -n newrelic \
               --create-namespace \
               --install
             ```
        </Step>

        <Step>
          ### Verifique la instalación [#helm-verify]

          1. Verifique que los pods se estén ejecutando:

             ```bash
             kubectl get pods -n newrelic --watch
             ```

             Debería ver pods con nombres como `nr-k8s-otel-collector-<hash>` en el espacio de nombres `newrelic`.

          2. Verifique que New Relic esté recibiendo datos de procesos ejecutando estas consultas en el [generador de consultas](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Acceda a los datos de ATP en New Relic [#access-data]

          Una vez que el ATP está configurado, comienza a recopilar datos de su clúster de Kubernetes. Puede acceder a estos datos en la UI de New Relic OpenTelemetry. Para obtener más información sobre la UI de OpenTelemetry de New Relic, consulte [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Para ver los datos de métricas del proceso ATP en New Relic:**

          1. Vaya a **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             O

             Vaya a <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Busque la entidad donde instaló el colector NRDOT con ATP.

          3. Seleccione la entidad y luego haga clic en **<DNT>Process</DNT>** en el panel izquierdo.

             En la página <DNT>Process</DNT>, puede ver todos los procesos en ejecución, junto con sus ID y las métricas de utilización de CPU y memoria. También muestra la relación padre-hijo entre procesos si un proceso genera otros procesos.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>

    <TabsPageItem id="manifest">
      El método de instalación mediante manifiestos ofrece una forma de configurar OpenTelemetry para Kubernetes sin utilizar Helm. Este método es adecuado para usuarios que prefieren un enfoque más práctico o tienen requisitos específicos que requieren configuración manual.

      <Steps>
        <Step>
          ### Antes de que empieces [#manifest-prereq]

          Asegúrese de tener:

          * Su clave de licencia de New Relic
          * kubectl configurado para acceder a su clúster
          * Permisos de administrador del clúster
        </Step>

        <Step>
          ### Descargar y preparar archivos de manifiesto [#manifest-download]

          1. Copie el contenido del directorio de ejemplos renderizados de `nr-k8s-otel-collector` a su espacio de trabajo local:

             ```bash
             git clone https://github.com/newrelic/helm-charts.git
             cd helm-charts/charts/nr-k8s-otel-collector/examples/k8s-with-atp/rendered
             ```

          2. Actualice la imagen del colector en los archivos `daemonset.yaml` y `deployment.yaml`:

             Cambiar de:

             ```yaml
             image: docker.io/newrelic/nrdot-collector-k8s
             ```

             Para:

             ```yaml
             image: docker.io/newrelic/nrdot-collector:<NRDOT_COLLECTOR_LATEST_VERSION>
             ```

             <Callout variant="important">
               Esta es una compilación experimental para la instalación de Kubernetes. Encuentre la versión más reciente en la [página de lanzamientos](https://github.com/newrelic/nrdot-collector-releases/releases).
             </Callout>
        </Step>

        <Step>
          ### Configurar la clave de licencia y el nombre del clúster [#manifest-config]

          1. Actualice el archivo `secret.yaml` con su clave de licencia de New Relic codificada en Base64:

             ```yaml
             data:
               licenseKey: <YOUR_BASE64_ENCODED_LICENSE_KEY>
             ```

             Para codificar su clave de licencia:

             * **Linux/macOS:** `echo -n "<YOUR_LICENSE_KEY>" | base64`
             * **Windows (PowerShell):** `[System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes("<YOUR_LICENSE_KEY>"))`

          2. Actualice el nombre de su clúster en los archivos `daemonset-configmap.yaml` y `deployment-configmap.yaml`:

             Localice las instancias de `k8s.cluster.name` y reemplace `<YOUR_CLUSTER_NAME>` con el nombre de clúster deseado:

             ```yaml
             - key: k8s.cluster.name
               action: upsert
               value: YOUR_CLUSTER_NAME  # Replace with your cluster name
             ```
        </Step>

        <Step>
          ### Despliegue los manifiestos [#manifest-deploy]

          1. Cree el espacio de nombres `newrelic` y aplique los manifiestos:

             ```bash
             kubectl create namespace newrelic
             kubectl apply -n newrelic -R -f .
             ```

          2. Verifique que los pods se estén ejecutando:

             ```bash
             kubectl get pods -n newrelic --watch
             ```

          3. Verifique que New Relic esté recibiendo datos de procesos ejecutando estas consultas en el [generador de consultas](https://docs.newrelic.com/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Acceda a los datos de ATP en New Relic [#access-data]

          Una vez que el ATP está configurado, comienza a recopilar datos de su clúster de Kubernetes. Puede acceder a estos datos en la UI de New Relic OpenTelemetry. Para obtener más información sobre la UI de OpenTelemetry de New Relic, consulte [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Para ver los datos de métricas del proceso ATP en New Relic:**

          1. Vaya a **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             O

             Vaya a <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Busque la entidad donde instaló el colector NRDOT con ATP.

          3. Seleccione la entidad y luego haga clic en **<DNT>Process</DNT>** en el panel izquierdo.

             En la página <DNT>Process</DNT>, puede ver todos los procesos en ejecución, junto con sus ID y las métricas de utilización de CPU y memoria. También muestra la relación padre-hijo entre procesos si un proceso genera otros procesos.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Opciones de configuración de ATP [#atp-config]

Cuando ATP está habilitado, se aplica automáticamente la siguiente configuración:

<table>
  <thead>
    <tr>
      <th>
        Parámetro
      </th>

      <th>
        Descripción
      </th>

      <th>
        Valor por defecto
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `enable_atp`
      </td>

      <td>
        Habilitar/deshabilitar la funcionalidad de ATP. Establecer en 

        `true`

         para habilitar ATP.
      </td>

      <td>
        `false`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.repository`
      </td>

      <td>
        Debe cambiarse a 

        `newrelic/nrdot-collector`

         para usar ATP.
      </td>

      <td>
        `newrelic/nrdot-collector-k8s`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.tag`
      </td>

      <td>
        Etiqueta de imagen para el colector habilitado para ATP.
      </td>

      <td>
        `<TO_BE_CONFIRMED>`
      </td>
    </tr>
  </tbody>
</table>

/\* ## Solución de problemas de ATP \[#troubleshooting] ### ATP no filtra métricas \*\*Problema\*\*: Se envían todas las métricas de procesos, no se filtran. \*\*Soluciones\*\*: 1. \*\*Verifica que ATP esté habilitado\*\*: \`\`\`bash kubectl get configmap -n newrelic nr-k8s-otel-collector-daemonset-config -o yaml | grep adaptivetelemetry \`\`\` 2. \*\*Verifica que ATP esté en el pipeline\*\*: Busca \`adaptivetelemetry\` en el pipeline \`metrics/nr\`. 3. \*\*Verifique que está utilizando la imagen del collector correcta\*\*: \`\`\`bash kubectl get daemonset -n newrelic nr-k8s-otel-collector-daemonset -o yaml | grep &quot;image:&quot; \`\`\` Esperado: \`newrelic/nrdot-collector:1.11.0\` (o posterior) \*\*NO\*\*: \`newrelic/nrdot-collector-k8s:1.11.0\` 4. \*\*Verifique que \`enable\_atp\` esté establecido en \`true\`\*\* en su \`values.yaml\` o ConfigMap. ### Los pods no inician \*\*Problema\*\*: Los pods del Colector fallan al iniciar. \*\*Soluciones\*\*: 1. \*\*Verificar los logs del pod\*\*: \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector \`\`\` 2. \*\*Verifique que la clave de licencia esté codificada correctamente\*\*: \`\`\`bash kubectl get secret -n newrelic nr-k8s-otel-collector-config -o yaml \`\`\` 3. \*\*Verifique los límites de recursos\*\*: Asegúrese de que su clúster tenga suficientes recursos para los pods del recopilador. ### Sin datos en New Relic \*\*Problema\*\*: No aparecen métricas en New Relic después de la instalación. \*\*Soluciones\*\*: 1. \*\*Espera de 2 a 5 minutos\*\* para que los datos aparezcan en la UI de New Relic. 2. \*\*Verifica que el nombre del clúster\*\* coincida con lo que estableciste en tu configuración. 3. \*\*Verifique los logs del colector\*\* para detectar errores de conexión: \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector | grep -i error \`\`\` \*/

## Recursos relacionados [#related-resources]

<DocTiles>
  <DocTile title="Resolución de problemas" path="/docs/opentelemetry/nrdot/atp/troubleshooting">
    Aprenda a solucionar problemas de ATP para su entorno.
  </DocTile>

  <DocTile title="Consulta tus datos" path="/docs/opentelemetry/nrdot/atp/query">
    Aprenda a consultar datos de ATP en New Relic usando NRQL.
  </DocTile>

  <DocTile title="Características-avanzadas" path="/docs/opentelemetry/nrdot/atp/advanced-features">
    Aprenda a habilitar funciones avanzadas para su implementación de ATP.
  </DocTile>
</DocTiles>