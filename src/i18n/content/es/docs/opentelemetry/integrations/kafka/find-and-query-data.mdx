---
title: Encuentra y consulta datos de Kafka en New Relic
tags:
  - Integrations
  - OpenTelemetry
  - Kafka
  - Query data
metaDescription: Learn how to find your Kafka metrics in New Relic UI and write NRQL queries to analyze your data.
freshnessValidatedDate: never
translationType: machine
---

Una vez que su monitoreo de Kafka esté configurado con OpenTelemetry, sus métricas aparecerán en múltiples ubicaciones en New Relic. Esta guía le muestra dónde encontrar sus datos y cómo consultarlos de manera efectiva.

## Navegue a sus datos de Kafka [#find-data]

Tus métricas de Kafka aparecen en varios lugares de la plataforma New Relic, cada uno optimizado para diferentes casos de uso:

### 1. Explorador de entidades

Ideal para: Verificaciones rápidas de estado y relaciones entre entidades

1. Ir a <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; On host integrations**</DNT>
2. Ver los tipos de entidad de broker, clúster y temas de Kafka

<img title="OTel Kafka Entity Explorer" alt="Entity explorer showing Kafka broker, cluster, and topics entity types" src="/images/otel-kafka-entityexplorer.webp" />

### 2. Colas y Streams

Ideal para: Monitoreo enfocado en cola de mensajes

1. Ir a <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; Queues &amp; Streams**</DNT>
2. Filtre por `provider=opentelemetry` y haga clic en la fila de la cuenta donde instrumentó Kafka para ver sus datos

<img title="OTel Kafka Queues & Streams" alt="Queues & Streams view showing Kafka data filtered by OpenTelemetry provider" src="/images/otel-kafka-queues-streams.webp" />

/\* ### 3. Third-party services Best for: Integration-focused monitoring 1. Go to &lt;DNT&gt;\*\*\[one.newrelic.com]\(https\://one.newrelic.com) &gt; All capabilities &gt; Infrastructure &gt; Third-party services\*\*&lt;/DNT&gt; 2. Select &lt;DNT&gt;\*\*Kafka (OpenTelemetry)\*\*&lt;/DNT&gt; &gt; &lt;DNT&gt;\*\*OpenTelemetry Kafka\*\*&lt;/DNT&gt; &lt;img title=&quot;OTel Kafka Third-party Services&quot; alt=&quot;Third-party services view showing Kafka (OpenTelemetry) integration&quot; src=&quot;/images/infrastructure\_screenshot-crop\_otel-kafka-third-party-integrations.webp&quot; /&gt; \*/

### 3. Dashboards predefinidos

Ideal para: Monitoreo y visualización completos

1. Ir a <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Dashboards &gt; Recommended dashboards (View all)**</DNT>
2. Buscar <DNT>**&quot;OpenTelemetry Kafka&quot;**</DNT>

<img title="OpenTelemetry Kafka" alt="Pre-built dashboard showing Kafka cluster health, network throughput, and broker metrics" src="/images/otel-kafka-prebuilt-dashboards.webp" />

## Consultar datos de Kafka con NRQL [#query-data]

Use [NRQL](/docs/nrql/get-started/introduction-nrql-new-relics-query-language) para crear consultas y dashboards personalizados para sus datos de Kafka.

<CollapserGroup>
  <Collapser id="basic-queries" title="Consultas básicas">
    **Ver todas las métricas de Kafka:**

    ```sql
    FROM Metric SELECT *
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name IS NOT NULL
    LIMIT 100
    ```

    **Monitorear clúster específico:**

    ```sql
    FROM Metric SELECT *
    WHERE kafka.cluster.name = 'production-cluster'
    AND instrumentation.provider='opentelemetry'
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Monitoreo del retraso del consumidor">
    **Retraso del consumidor por grupo:**

    ```sql
    FROM Metric SELECT latest(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    FACET group, topic
    SINCE 1 hour ago TIMESERIES
    ```

    **Alerta de retraso alto del consumidor:**

    ```sql
    FROM Metric SELECT max(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    AND group = 'your-consumer-group'
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="Consultas de estado del broker">
    **Recuento de brokers activos:**

    ```sql
    FROM Metric SELECT latest(kafka.brokers)
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name = 'your-cluster'
    TIMESERIES
    ```

    **Particiones con replicación insuficiente:**

    ```sql
    FROM Metric SELECT latest(kafka.partition.under_replicated)
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id SINCE 1 hour ago
    ```
  </Collapser>

  <Collapser id="performance-queries" title="Monitoreo de desempeño">
    **Rendimiento de mensajes por tema:**

    ```sql
    FROM Metric SELECT rate(sum(kafka.prod.msg.count), 1 minute) as 'Messages/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET topic SINCE 1 hour ago TIMESERIES
    ```

    **E/S de red por broker:**

    ```sql
    FROM Metric SELECT rate(sum(kafka.network.io), 1 minute) as 'Bytes/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id, direction SINCE 1 hour ago TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Consultas avanzadas [#advanced-queries]

Para obtener ejemplos de consultas más completos organizados por área de enfoque de monitoreo:

<CollapserGroup>
  <Collapser id="cluster-overview-queries" title="Descripción general del clúster">
    Get high-level cluster statistics and health:

    ```sql
    FROM Metric SELECT
      max(kafka.brokers) AS 'Active Brokers',
      max(kafka.cluster.topic.count) AS 'Total Topics',
      max(kafka.cluster.partition.count) AS 'Total Partitions',
      latest(kafka.partition.offline) AS 'Offline Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="Estado del broker">
    Monitoree el estado y el liderazgo de cada broker:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_replicated) AS 'Under-replicated Partitions',
      latest(kafka.broker.leader.count) AS 'Leader Count',
      latest(kafka.partition.count) AS 'Total Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="topic-throughput-queries" title="Rendimiento de temas y E/S">
    Supervise las tasas de mensajes y el rendimiento de los datos por tema:

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.prod.msg.count), 1 minute) AS 'Messages/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'in'), 1 minute) AS 'Bytes In/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'out'), 1 minute) AS 'Bytes Out/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET topic
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Retraso del consumidor">
    Rastrear el retraso del grupo de consumidores y los retrasos de procesamiento:

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum) AS 'Total Lag'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="request-latency-queries" title="Latencia de la solicitud">
    Monitorear los tiempos de procesamiento de solicitudes y el rendimiento:

    ```sql
    FROM Metric SELECT
      latest(kafka.request.time.avg) AS 'Avg Latency',
      latest(`kafka.request.time.99p`) AS '99th Percentile'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="jvm-health-queries" title="Estado de JVM">
    Supervisar las métricas de JVM para los brokers de Kafka:

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100 AS 'Heap Usage %',
      rate(sum(jvm.gc.collections.count), 1 minute) AS 'GC Count/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Crea dashboards personalizados [#custom-dashboards]

Combine múltiples consultas para crear dashboards de monitoreo de Kafka completos:

1. Ve a [one.newrelic.com](https://one.newrelic.com) &gt; Dashboards

2. Haga clic en &quot;Create a dashboard&quot;

3. Agregue widgets usando las consultas NRQL anteriores

4. Organiza los widgets por área de enfoque:

   * Estado del clúster: recuento de brokers, particiones con replicación insuficiente, estado del controlador
   * Rendimiento del consumidor: Retraso, rendimiento, membresía del grupo
   * Métricas de temas: tasas de mensajes, recuentos de particiones, estado de replicación
   * Utilización de recursos: E/S de red, métricas de JVM, uso de disco

## Configurar alerta [#alerts]

<Callout variant="tip">
  New Relic proporciona alertas de métricas doradas preconfiguradas para Kafka. Al crear una nueva condición de alerta, seleccione **Guided mode** → **Host integrations** → **Kafka** (brokers, clúster o temas) para ver las plantillas de alerta recomendadas.
</Callout>

También puede crear alertas personalizadas utilizando consultas NRQL:

<CollapserGroup>
  <Collapser id="consumer-lag-alert" title="Alto retraso del consumidor">
    Alerta cuando el retraso del consumidor excede tu umbral aceptable:

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    ```

    **Umbral recomendado**: Alerta cuando el retraso &gt; 10,000 mensajes para grupos de consumidores críticos.
  </Collapser>

  <Collapser id="under-replicated-alert" title="Particiones subreplicadas">
    Alerta cuando las particiones pierden la replicación:

    ```sql
    FROM Metric SELECT
      sum(kafka.partition.under_replicated)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Umbral recomendado**: Alerta cuando alguna partición se vuelve con replicación insuficiente (&gt; 0).
  </Collapser>

  <Collapser id="offline-partitions-alert" title="Particiones sin conexión">
    Alerta inmediatamente cuando las particiones se desconecten:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.offline)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Umbral recomendado**: Alerta inmediatamente cuando alguna partición se desconecta (&gt; 0).
  </Collapser>

  <Collapser id="min-isr-alert" title="Particiones por debajo del ISR mínimo">
    Alerta cuando las particiones caen por debajo del mínimo de réplicas en sincronización:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_min_isr)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Umbral recomendado**: Alerta cuando alguna partición cae por debajo del ISR mínimo (&gt; 0).
  </Collapser>

  <Collapser id="jvm-memory-alert" title="Uso elevado de memoria JVM">
    Alerta cuando el uso del heap es crítico:

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Umbral recomendado**: Alerta cuando el uso del montón es &gt; 85% durante períodos prolongados.
  </Collapser>

  <Collapser id="request-failures-alert" title="Fallos de solicitud">
    Alerta sobre altas tasas de fallas de solicitudes:

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.request.failed), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    ```

    **Umbral recomendado**: Alerta cuando la tasa de fallas &gt; 1% del total de solicitudes.
  </Collapser>

  <Collapser id="unclean-elections-alert" title="Elecciones de líder impuras">
    Alerta sobre elecciones de líder impuras (indica fallas del agente):

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.unclean.election.rate), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Umbral recomendado**: Alerta sobre cualquier elección de líder impura (&gt; 0).
  </Collapser>
</CollapserGroup>

## Próximos pasos [#next-steps]

* **[Referencia de métricas de Kafka](/docs/opentelemetry/integrations/kafka/metrics-reference)**: lista completa de métricas disponibles con descripciones
* **[Crea condiciones de alerta NRQL](/docs/alerts/create-alert/create-alert-condition/create-nrql-alert-conditions/)** - Configura la monitorización proactiva
* **[Tutorial de NRQL](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language)**: aprenda técnicas de consulta avanzadas