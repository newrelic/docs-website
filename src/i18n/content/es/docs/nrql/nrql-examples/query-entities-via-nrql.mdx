---
title: Ejemplos de entidades y relaciones mediante NRQL (E&R mediante NRQL)
metaDescription: Examples of NRQL queries for entities & relationships
freshnessValidatedDate: '2024-03-19T00:00:00.000Z'
translationType: machine
---

Optimice el análisis de su sistema empleando New Relic consulta Language (NRQL) para consultar directamente datos de entidades y relaciones. Este enfoque reemplaza procesos manuales engorrosos para tareas cruciales como correlacionar el rendimiento de la CPU con atributos del host, ver estados de entidades anteriores o rastrear cambios de configuración, ofreciendo información valiosa más rápida en sus entornos complejos.

Para consultar estos datos, necesitará Calcular avanzado; emplee el tipo entidad evento (y Relaciones o entityRelationships para consultas específicas de relaciones).

<Callout variant="tip">
  ¿Es nuevo en la consulta de entidades y relaciones con NRQL? Conozca los [conceptos y beneficios de E&amp;R a través de NRQL](/docs/nrql/get-started/query-entities-and-relationships-via-nrql) antes de explorar estos ejemplos.
</Callout>

Explore las soluciones prácticas de NRQL a continuación para ayudarlo a:

<CollapserGroup>
  <Collapser id="total-tx" title="Correlacionar el uso de la CPU con el atributo del host">
    * **Objetivo**: Un equipo de operaciones necesita analizar la utilización de la CPU para todos los hosts de producción ubicados en una región específica AWS (por ejemplo, &apos;eu-central-1&apos;) para identificar el rendimiento potencial.
    * **Desafío**: Esto a menudo requería exportar datos del host y el rendimiento métrico por separado y luego usar herramientas externas o scripts complejos para unirlos y analizarlos.
    * **Solución NRQL**:

    ```sql
    FROM SystemSample
    JOIN (FROM Entity SELECT id, name WHERE type = 'INFRA-HOST' AND `tags.aws.awsRegion` = 'eu-central-1')
    ON entityGuid = id
    SELECT average(cpuPercent) FACET name
    ```
  </Collapser>

  <Collapser id="total-tx" title="Ver el estado de la entidad en un punto específico en el tiempo">
    * **Objetivo**: Un desarrollador está investigando un incidente que ocurrió hace varias horas y necesita saber la configuración o el estado exacto de un host específico (o contenedor, aplicación, etc.) en ese momento particular.

    * **Desafío**: Obtener una instantánea del atributo de una entidad de un periodo de tiempo pasado específico a menudo no era posible o requería revisar voluminosos logs de configuración, si estaban disponibles.

    * **SoluciónNRQL **: Esta consulta recupera todos los atributos disponibles para una entidad específica (identificada por su id) dentro de una ventana estrecha de una hora desde hace siete horas.

    ```sql
    FROM Entity
    SELECT *
    WHERE id = '<your_entity_id>'
    SINCE 7 hours ago UNTIL 6 hours ago
    LIMIT 1
    ```
  </Collapser>

  <Collapser id="total-tx" title="Seguimiento de cambios de estado de la entidad">
    * **Objetivo**: Una ingeniería de fiabilidad del sitio (SRE) quiere entender cómo cambió la configuración o los atributos clave de una entidad en las últimas horas, quizás para ver si una implementación o un proceso automatizado alteró su estado como se esperaba.

    * **Desafío**: Hacer seguimiento de cambios sutiles en el estado de una entidad a lo largo del tiempo era difícil y a menudo implicaba comparaciones manuales o scripts de monitoreo personalizados.

    * **Solución NRQL**: esta consulta obtiene todos los estados registrados para una entidad particular en las últimas tres horas, lo que permite realizar una auditoría de cualquier cambio.

    ```sql
      SELECT *
      FROM Entity
      WHERE id = '<your_entity_id>'
      SINCE 3 hours ago
    ```
  </Collapser>

  <Collapser id="total-tx" title="Encontrar aplicaciones relacionadas con hosts">
    * **Objetivo**: Identificar la aplicación que se ejecuta en hosts específicos

    * **Desafío**: Es difícil correlacionar la aplicación con los hosts.

    * **Solución NRQL**:

    ```sql
    FROM EntityRelationship SELECT sourceEntityGuid, targetEntityGuid, sourceEntityType, targetEntityType, relationshipType   where (sourceEntityType like '%HOST%' and targetEntityType='APPLICATION') or (targetEntityType LIKE '%HOST%' and sourceEntityType='APPLICATION')
    ```
  </Collapser>
</CollapserGroup>