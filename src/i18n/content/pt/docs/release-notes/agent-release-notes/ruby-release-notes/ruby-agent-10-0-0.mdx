---
subject: Ruby agent
releaseDate: '2026-01-14'
version: 10.0.0
downloadLink: 'https://rubygems.org/downloads/newrelic_rpm-10.0.0.gem'
features:
  - Remove support for Ruby 2.4 and 2.5
  - Removal of Cross Application Tracing (CAT)
  - Rename ActiveJob metrics and segments
  - Rename `bin/newrelic` command to `bin/newrelic_rpm`
  - Remove the `newrelic deployments` CLI command
  - 'Remove the NewRelic::Agent::SqlSampler#notice_sql method'
  - 'Remove unused arguments from various NewRelic::Agent::Datastores APIs'
  - Remove experimental feature Configurable Security Policies (CSP)
  - Remove support for Puma versions below 3.9.0
  - Improve configuration validation and coercion
  - Replace 'default' option with 'adaptive' for distributed tracing remote parent samplers
  - Add `logger` as a dependency
  - Add Active Support notification allowlist configuration option
  - Use Ruby's built-in Gzip compression
  - 'Add argument validation for the `NewRelic::Agent#record_custom_event` API'
  - Add root sampling configuration options
  - Add Trace ID Ratio Based sampling options
  - Add Entity GUID to Agent Control health check files
bugs:
  - Resolve a `NoMethodError` in GCP utilization detection.
security: []
translationType: machine
---

<Callout variant="important">
  **Atualização da Versão Principal:** Esta versão do agente Ruby é uma atualização MAJOR SemVer e contém alterações significativas. As versões MAJOR podem remover o suporte para tempos de execução de linguagem que atingiram o fim da vida útil de acordo com o responsável pela manutenção. Além disso, as versões MAJOR podem remover o suporte e remover certas instrumentações. Para obter mais detalhes sobre essas alterações, consulte o guia de migração [aqui](/docs/apm/agents/ruby-agent/getting-started/migration-10x-guide/).
</Callout>

<Callout variant="important">
  Recomendamos atualizar para a versão mais recente do agente assim que estiver disponível. Se você não puder atualizar para a versão mais recente, atualize seu agente para uma versão com no máximo 90 dias. Saiba mais sobre [como manter o agente atualizado](/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/).

  Consulte a [política de fim de vida útil](/docs/apm/agents/ruby-agent/getting-started/ruby-agent-eol-policy/) do agente Ruby New Relic para obter informações sobre lançamentos de agentes e datas de suporte.
</Callout>

## v10.0.0

* **Alteração significativa: Remover o suporte para Ruby 2.4 e 2.5**

  O suporte para as versões Ruby 2.4 e 2.5 foi removido. A nova versão mínima do Ruby necessária agora é 2.6. [PR#3314](https://github.com/newrelic/newrelic-ruby-agent/pull/3314)

* **Mudança importante: Remoção do Cross Application Tracing (CAT)**

  Anteriormente, o Cross Application Tracing (CAT) foi descontinuado em favor do Distributed Tracing. A funcionalidade CAT foi removida. A opção de configuração `cross_application_tracer.enabled` foi removida. Os métodos da API pública `NewRelic::Agent::External.process_request_metadata`, `NewRelic::Agent::External.get_response_metadata`, `NewRelic::Agent::Transaction::ExternalRequestSegment#process_response_metadata`, `NewRelic::Agent::Transaction::ExternalRequestSegment#get_request_metadata` e `NewRelic::Agent::Transaction::ExternalRequestSegment#read_response_headers` também foram removidos. [PR#3333](https://github.com/newrelic/newrelic-ruby-agent/pull/3333)

* **Mudança radical: Renomear métricas e segmentos do ActiveJob**

  As métricas do ActiveJob foram atualizadas para incluir o nome da classe do trabalho para relatórios mais específicos. Esta é uma alteração significativa e pode exigir a atualização de painéis ou alertas personalizados. [PR#3370](https://github.com/newrelic/newrelic-ruby-agent/pull/3370) [PR#3320](https://github.com/newrelic/newrelic-ruby-agent/pull/3320)

  * Formato antigo: `Ruby/ActiveJob/<QueueName>/<Method>`
  * Novo formato: `Ruby/ActiveJob/<QueueName>/<ClassName>/<Method>`

  Além disso, os segmentos criados para ações de enfileiramento do Active Job agora incluem a classe de trabalho.

  * Formato antigo: `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>`
  * Novo formato: `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>/<ClassName>`

* **Mudança radical: Renomear o comando `bin/newrelic` para `bin/newrelic_rpm`**

  O arquivo executável para a CLI do agente foi renomeado de `bin/newrelic` para `bin/newrelic_rpm`. Essa alteração resolve uma colisão de nomes com a ferramenta CLI autônoma do New Relic. [PR#3323](https://github.com/newrelic/newrelic-ruby-agent/pull/3323)

* **Mudança radical: Remova o comando CLI `newrelic deployments`**

  O comando CLI `newrelic deployments` obsoleto foi removido. Para rastrear alterações e implantações no New Relic, consulte nosso guia sobre [Rastreamento de alterações](https://docs.newrelic.com/docs/change-tracking/change-tracking-introduction/) para obter uma lista de opções disponíveis. [PR#3299](https://github.com/newrelic/newrelic-ruby-agent/pull/3299)

* **Mudança radical: Remover o método NewRelic::Agent::SqlSampler#notice\_sql**

  Os usuários devem chamar `NewRelic::Agent::Datastores.notice_sql` em vez disso. [PR#3338](https://github.com/newrelic/newrelic-ruby-agent/pull/3338)

* **Mudança radical: Remova argumentos não utilizados de várias APIs NewRelic::Agent::Datastores**

  As seguintes APIs da classe `NewRelic::Agent::Datastores` tiveram argumentos de método removidos:

  * `NewRelic::Agent::Datastores.notice_sql`, anteriormente tinha três argumentos posicionais, `query`, `scoped_metric` e `elapsed`. Agora, ele só tem `query`.
  * `NewRelic::Agent::Datastores.notice_statement`, anteriormente tinha dois argumentos posicionais `query` e `elapsed`. Agora ele só tem `query`.
  * `NewRelic::Agent::Datastores.wrap` exige um proc. Anteriormente, o proc recebia três argumentos: o resultado do yield, o nome da métrica com escopo mais específico e o tempo decorrido da chamada. Agora, ele recebe apenas um: o resultado do yield.

  Os valores dos argumentos removidos são derivados do segmento atual no momento da chamada. [PR#3347](https://github.com/newrelic/newrelic-ruby-agent/pull/3347)

* **Mudança radical: Remover o recurso experimental Configurable Security Policies (CSP)**

  O recurso experimental, Configurable Security Policies (CSP), não é mais suportado e foi removido. [PR#3292](https://github.com/newrelic/newrelic-ruby-agent/pull/3292)

* **Mudança radical: Remover o suporte para as versões do Puma &apos;&lt;&apos; 3.9.0**

  A versão mínima do Puma agora suportada é 3.9.0 ou superior. [PR#3326](https://github.com/newrelic/newrelic-ruby-agent/pull/3326)

* **Mudança radical: Melhorar a validação e coerção da configuração**

  Os mecanismos internos usados para forçar e validar os valores fornecidos para a configuração do agente agora são mais eficientes e precisos.

  * Mensagens de aviso agora serão registradas no arquivo newrelic\_agent.log quando nil for fornecido como um valor de configuração para uma configuração que não o suporta.
  * Valores inteiros são permitidos para tipos de configuração Float
  * Valores float são permitidos para tipos de configuração Integer
  * Interrupções fatais são evitadas quando um valor padrão pode ser encontrado para substituir um valor de entrada inválido [PR#3341](https://github.com/newrelic/newrelic-ruby-agent/pull/3341)

* **Mudança radical: Substitua a opção &apos;default&apos; por &apos;adaptive&apos; para amostradores de pais remotos de rastreamento distribuído**

  Anteriormente, a opção padrão para `distributed_tracing.sampler.remote_parent_sampled` e `distributed_tracing.sampler.remote_parent_not_sampled` era `default`, que usava o amostrador adaptável pré-existente. A opção `default` foi renomeada para `adaptive`. [PR#3363](https://github.com/newrelic/newrelic-ruby-agent/pull/3363)

* **Recurso: Adicionar `logger` como uma dependência**

  O gem `logger` agora está listado como uma dependência do agente para garantir a funcionalidade contínua de logging e suporte para as versões Ruby 4.0.0 e mais recentes. [PR#3293](https://github.com/newrelic/newrelic-ruby-agent/pull/3293)

* **Recurso: Adicione a opção de configuração de lista de permissões de notificação do Active Support**

  Uma nova opção de configuração, `instrumentation.active_support_notifications.active_support_events`, permite que os usuários definam uma lista de permissões de nomes de eventos de notificação do Active Support para o agente assinar. Por padrão, o agente se inscreve em todos os eventos [Active Support: Caching](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-caching) e [Active Support: Messages](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-messages). [PR#3327](https://github.com/newrelic/newrelic-ruby-agent/pull/3327)

* **Recurso: Use a compressão Gzip integrada do Ruby**

  O agente agora usa o método `Zlib.gzip` integrado da biblioteca padrão Ruby para compactação, substituindo a implementação personalizada anterior. [PR#3332](https://github.com/newrelic/newrelic-ruby-agent/pull/3332)

* **Recurso: Adicionar validação de argumento para a API `NewRelic::Agent#record_custom_event`**

  A API `NewRelic::Agent#record_custom_event` agora levanta um `ArgumentError` quando um `event_type` inválido é fornecido. Um tipo de evento válido deve consistir apenas em caracteres alfanuméricos, sublinhados (`_`), dois pontos (`:`) ou espaços (` `). [PR#3319](https://github.com/newrelic/newrelic-ruby-agent/pull/3319)

* **Recurso: Adicionar opções de configuração de amostragem raiz**

  Agora você pode configurar o comportamento de amostragem para rastreios que se originam dentro do serviço atual usando `distributed_tracing.sampler.root`. [PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330)

  Há quatro modos disponíveis:

  | Modo                   | Descrição                                                                                                                                                                |
  | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
  | `adaptive`             | Usa o algoritmo de amostragem adaptável existente                                                                                                                        |
  | `always_off`           | Marca 0% dos rastreamentos raiz como amostrados                                                                                                                          |
  | `always_on`            | Marca 100% dos rastreamentos raiz como amostrados                                                                                                                        |
  | `trace_id_ratio_based` | Amostra rastreamentos com base em uma proporção definida em `distributed_tracing.sampler.root.trace_id_ratio_based.ratio`. A proporção deve ser um float entre 0,0 e 1,0 |

* **Recurso: Adicione opções de amostragem baseadas na taxa de ID de rastreamento**

  O agente agora pode amostrar rastreios usando o algoritmo de amostragem baseado na taxa de ID de rastreio OpenTelemetry. [PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330) Isso amostra rastreios com base em uma probabilidade entre 0,0 e 1,0 com base no ID do rastreio.

  Para usar esta opção, você deve primeiro definir sua configuração de amostrador de rastreamento distribuído para `trace_id_ratio_based` e, em seguida, definir o amostrador `distributed_tracing.sampler.*.trace_id_ratio_based.ratio` correspondente para um Float entre 0,0 e 1,0.

  Por exemplo:

  ```yaml
    distributed_tracing.sampler.remote_parent_sampled: 'trace_id_ratio_based'
    distributed_tracing.sampler.remote_parent_sampled.trace_id_ratio_based.ratio': 0.5
  ```

  Essa configuração amostrará aproximadamente 50% de seus rastreamentos para todos os rastreamentos em que o pai remoto for amostrado.

  Esta opção está disponível para:

  * `distributed_tracing.sampler.root`
  * `distributed_tracing.sampler.remote_parent_sampled`
  * `distributed_tracing.sampler.remote_parent_not_sampled`

* **Recurso: Adicionar GUID da entidade aos arquivos de verificação de integridade do Agent Control**

  Quando o agente é iniciado em um ambiente de [Controle do Agente](https://docs-preview.newrelic.com/docs/new-relic-agent-control), um arquivo de verificação de integridade é criado no local configurado do arquivo para cada processo do agente. Este arquivo agora inclui o guid da entidade relacionada ao agente quando disponível. [PR#3371](https://github.com/newrelic/newrelic-ruby-agent/pull/3371)

* **Correção de bug: Resolver um `NoMethodError` na detecção de utilização do GCP.**

  A lógica de descoberta de metadados do GCP agora lidará normalmente com `nil` ou valores inesperados, evitando falhas na inicialização do serviço. [PR#3388](https://github.com/newrelic/newrelic-ruby-agent/pull/#3388)