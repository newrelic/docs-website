---
title: Atualize para a experiência APM
metaDescription: Learn how to upgrade your Lambda monitoring to the New Relic APM experience.
freshnessValidatedDate: never
translationType: machine
---

Você pode atualizar suas funções Lambda existentes para a nova experiência de monitoramento unificado com o mínimo de esforço. Essa transição permite que você monitore suas funções Lambda com recursos aprimorados de observabilidade do New Relic. Você pode instrumentar todas as suas funções Lambda existentes em massa ou pode optar por atualizá-las uma de cada vez. O processo de atualização não é intrusivo e não requer nenhuma alteração de código em suas funções existentes.

**Pré-requisitos**

* Suas funções Lambda já estão instrumentadas no New Relic.
* Suas funções Lambda estão sendo executadas em tempo de execução `python`, `nodejs`, `ruby`, `go` ou `.NET`. Para visualizar a lista de versões compatíveis desses tempos de execução, consulte a [documentação de compatibilidade e requisitos](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring/).

## Métodos de instrumentação

Você pode atualizar suas funções Lambda existentes usando um dos seguintes métodos:

* [Interface New Relic](#ui)
* [Atualize usando CLIs](#cli)

<Callout variant="tip">
  New Relic recomenda integrar sua conta AWS com a New Relic usando a [integraçãoAWS ](/docs/infrastructure/amazon-integrations/get-started/introduction-aws-integrations/)para descobrir e monitorar automaticamente sua função do Lambda. Isso permite que você aproveite todo o poder do New Relic APM para sua função serverless.
</Callout>

#### Interface New Relic [#ui]

Você pode atualizar suas funções Lambda existentes usando a interface do usuário do New Relic.

**Para atualizar suas funções Lambda existentes da plataforma New Relic, siga estas etapas:**

1. Acesse [one.newrelic.com &gt; All capabilities &gt; Serverless Functions](https://one.newrelic.com/nr1-core?state=23b04845-da13-2b11-5826-9c20326276d9) &gt; selecione sua entidade de função Lambda.
2. Na página Summary, clique em **Instrument for APM**.
3. Na página Função Lambda para APM, forneça a chave de API e clique em **Continue**.
4. Por padrão, a entidade Lambda atual é selecionada para atualização. Você também pode selecionar outras funções Lambda para atualizar. Clique em **Generate New Relic CLI command**.
5. Copie o comando e execute-o em seu terminal ou em seu terminal AWS. O comando instalará a camada Lambda do New Relic em suas funções selecionadas.
6. Clique em **Continue** para testar a instalação. O teste verificará se a camada Lambda do New Relic está instalada corretamente e se a função está enviando dados para o New Relic.
7. Se o teste for bem-sucedido, você verá uma mensagem de sucesso. Para visualizar sua função Lambda na interface APM do New Relic, clique em **See your data in APM**.

#### Atualize usando CLIs [#cli]

<CollapserGroup>
  <Collapser id="nr-cli" title="CLI New Relic">
    <Callout variant="important">
      Certifique-se de que sua versão da CLI do New Relic seja `0.9.8` ou posterior. Você pode verificar sua versão da CLI executando `newrelic-lambda --version`. Se você precisar atualizar sua CLI, atualize a CLI. Por exemplo, se você instalou a CLI usando `pip3`, pode atualizá-la com o seguinte comando:

      ```bash
          pip3 install --upgrade newrelic-lambda
      ```
    </Callout>

    1. Para atualizar sua função Lambda, use o quickstart da CLI `newrelic-lambda` conforme mostrado aqui.

       ```bash
       newrelic-lambda layers install --nr-account-id YOUR_NEW_RELIC_ACCOUNT_ID --function my-function --upgrade --apm
       ```

       <Callout variant="tip">
         Este comando encontra automaticamente a camada disponível mais recente para a região e o tempo de execução do seu Lambda.
       </Callout>

    2. Para migrar alertas de suas funções Lambda existentes para APM, execute o seguinte comando:

       ```bash
       newrelic-lambda apm alerts-migrate \
           --nr-account-id <YOUR_NEW_RELIC_ACCOUNT_ID> \
           --nr-api-key <YOUR_NEW_RELIC_API_KEY>
           --function <YOUR_LAMBDA_FUNCTION_NAME>
       ```
  </Collapser>

  <Collapser id="cdk" title="Para AWS CDK, AWS SAM ou Terraform">
    1. Atualize para a [camada Lambda mais recente do New Relic](https://layers.newrelic-external.com/) para seu projeto usando [AWS CDK](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#cdk), [AWS SAM](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#cloudformation) ou [Terraform](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/#terraform).
    2. Defina a [variável de ambiente](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/env-variables-lambda/) `NEW_RELIC_APM_LAMBDA_MODE` como `true` na configuração da sua função Lambda. Isso habilita o modo APM para a camada Lambda do New Relic.
    3. implante sua função do Lambda com a configuração atualizada.
    4. Na guia <DNT>Configuration</DNT> do seu <DNT>AWS Management Console</DNT>, adicione a tag `NR.Apm.Lambda.Mode: true` à sua função Lambda.
    5. Se você não estiver usando uma [integração de nuvem da AWS](/docs/infrastructure/amazon-integrations/get-started/introduction-aws-integrations/) (Metric Stream ou API Polling) para sincronizar tags do CloudWatch, defina a variável de ambiente `NR_TAGS` como `NR.Apm.Lambda.Mode:true`. Isso permite que a extensão do Lambda da New Relic envie os metadados necessários diretamente para a New Relic.
  </Collapser>
</CollapserGroup>

## Atualize alertas e painéis Lambda existentes [#alerts-dashboards]

Após atualizar suas funções Lambda existentes para `APM + Serverless Convergence`, é crucial atualizar as consultas NRQL em suas condições de alerta e widgets do painel. Esta nova atualização altera os caminhos de métricas para seus dados Lambda. Modificar suas consultas é necessário para garantir que seus alertas e painéis usem esses novos caminhos e continuem a fornecer monitoramento e notificações precisos. Isso é necessário para quaisquer funções Lambda existentes que você tenha migrado para `APM + Serverless Convergence`.

* Para alertas, revise suas condições de alerta Lambda existentes. Atualize quaisquer consultas NRQL que usem métricas originadas de camadas com as novas métricas. Para obter mais informações sobre como atualizar suas condições de alerta, consulte [Atualizar um alerta](https://docs.newrelic.com/docs/alerts/create-alert/create-alert-condition/alert-conditions/#edit-existing-alert-condition).

* Para painéis, revise os widgets do painel Lambda existentes. Atualize quaisquer consultas NRQL que usem métricas originadas de camadas com as novas métricas. Para obter mais informações sobre como atualizar os widgets do painel, consulte o [gerenciar painel](https://docs.newrelic.com/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard/).

## Encontre e use dados [#find-data]

Após instrumentar sua função AWS do Lambda, você poderá encontrar e usar os dados na interface do New Relic APM. Os dados estão organizados em diversas áreas principais, cada uma fornecendo diferentes insights sobre o desempenho e a saúde da sua função Lambda.

Na interface APM, você pode explorar vários aspectos da sua função Lambda, incluindo [distributed tracing](/docs/distributed-tracing/concepts/introduction-distributed-tracing/), [mapas de serviço](/docs/new-relic-solutions/new-relic-one/ui-data/service-maps/service-maps/), [transações](/docs/apm/transactions/intro-transactions/transactions-new-relic-apm/), [análise de erros](/docs/errors-inbox/getting-started/) e muito mais. Cada uma dessas áreas fornece insights detalhadas sobre o desempenho, a latência e a taxa de erros da sua função Lambda, permitindo que você identifique e resolva problemas rapidamente.

<Callout variant="tip">
  A experiência de invocação agora está integrada ao rastreamento de transações do APM. Isso permite que você use um `AWS RequestId` específico para detalhar um trace APM de transação para obter informações detalhadas sobre aquela execução Lambda específica.
</Callout>

Para visualizar sua função Lambda na interface do New Relic APM :

1. Vá para <DNT>[https://one.newrelic.com](https://one.newrelic.com) &gt; APM &amp; Services</DNT>.
2. Defina os critérios de pesquisa como `isLambdaFunction = true`.
3. Na lista exibida, selecione sua função Lambda para visualizar os dados.

<Callout variant="tip">
  A interface do usuário APM do New Relic não exibe dados históricos para funções Lambda que foram instrumentadas antes da atualização `APM + Serverless Convergence`. Para visualizar os dados históricos, clique na opção **see serverless functions** na página <DNT>APM Summary</DNT>.
</Callout>

### Reversão [#rollback]

Se você precisar reverter suas funções Lambda para a experiência de monitoramento sem servidor anterior, poderá fazê-lo definindo a variável de ambiente `NEW_RELIC_APM_LAMBDA_MODE` como `false`.

## Artigos relacionados [#related-docs]

<DocTiles>
  <DocTile title="Compatibilidade e requisitos" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring">
    Saiba mais sobre os tempos de execução e pré-requisitos suportados
  </DocTile>

  <DocTile title="Resolução de problemas" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/troubleshooting/troubleshoot-enabling-serverless-monitoring-aws-lambda">
    Aprenda a solucionar problemas relacionados à instalação
  </DocTile>
</DocTiles>