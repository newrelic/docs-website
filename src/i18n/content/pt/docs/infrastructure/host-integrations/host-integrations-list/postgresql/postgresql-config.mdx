---
title: Definições de configuração da integração PostgreSQL
tags:
  - Integrations
  - On-host integrations
  - Advanced configuration
metaDescription: New Relic's PostgreSQL monitoring integration's advanced configuration
freshnessValidatedDate: never
translationType: machine
---

Esta integração é um software de código aberto. Isso significa que você pode [navegar pelo código-fonte](https://github.com/newrelic/nri-postgresql) e enviar melhorias, ou criar seu próprio fork e construí-lo.

### Configurações da instância do PostgreSQL [#instance-settings]

A integração PostgreSQL coleta informações métricas (<DNT>**M**</DNT>) e de inventário (<DNT>**I**</DNT>). A coluna <DNT>**Applies To**</DNT> na tabela a seguir indica quais configurações podem ser usadas para cada coleção específica:

<table>
  <thead>
    <tr>
      <th>
        Contexto
      </th>

      <th>
        Descrição
      </th>

      <th style={{ width: '150px' }}>
        Aplica-se a
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `HOSTNAME`
      </td>

      <td>
        O nome do host da conexão PostgreSQL. O padrão é localhost.
      </td>

      <td style={{ "text-align": "center" }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `PORT`
      </td>

      <td>
        A porta onde o PostgreSQL está sendo executado. O padrão é 5432.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `USERNAME`
      </td>

      <td>
        O nome de usuário para a conexão PostgreSQL. <DNT>**Required.**</DNT>
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `PASSWORD`
      </td>

      <td>
        A senha para a conexão PostgreSQL. <DNT>**Required.**</DNT>
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `COLLECTION_LIST`
      </td>

      <td>
        Matriz JSON, um objeto JSON ou a string literal `ALL` que especifica a entidade a ser coletada. O usuário PostgreSQL só pode coletar métricas de tabelas e índices de tabelas para as quais possui `SELECT` permissões.

        Obrigatório, exceto para `PgBouncer`.

        <Callout variant="important">
          Isso não se aplica a consultas personalizadas configuradas com `CUSTOM_METRICS_QUERY` ou `CUSTOM_METRICS_CONFIG`.
        </Callout>

        Para obter ajuda, veja estes [exemplos](/docs/infrastructure/host-integrations/host-integrations-list/postgresql/postgresql-integration#examples).
      </td>

      <td style={{ "text-align": "center" }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECTION_IGNORE_DATABASE_LIST`
      </td>

      <td>
        Matriz JSON de nomes de bancos de dados que serão ignorados para coleta de métricas. Normalmente útil para casos em que `COLLECTION_LIST` está definido como `ALL` e alguns bancos de dados precisam ser ignorados. O padrão é `[]`.

        <Callout variant="important">
          Isso não se aplica a consultas personalizadas configuradas com `CUSTOM_METRICS_QUERY` ou `CUSTOM_METRICS_CONFIG`.
        </Callout>
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `PGBOUNCER`
      </td>

      <td>
        Colete `pgbouncer` métricas. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `ENABLE_SSL`
      </td>

      <td>
        Determina se o SSL está habilitado. Se `true`, `ssl_cert_location` e `ssl_key_location` forem obrigatórios. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `TRUST_SERVER_CERTIFICATE`
      </td>

      <td>
        Se `true`, o certificado do servidor não será verificado para SSL. Se `false`, o certificado do servidor identificado em `ssl_root_cert_location` será verificado. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_ROOT_CERT_LOCATION`
      </td>

      <td>
        Caminho absoluto para o arquivo de certificado raiz codificado em PEM. Obrigatório se `trust_server_certificate` for `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_CERT_LOCATION`
      </td>

      <td>
        Caminho absoluto para o arquivo de certificado de cliente codificado em PEM. Obrigatório se `enable_ssl` for `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `SSL_KEY_LOCATION`
      </td>

      <td>
        Caminho absoluto para o arquivo de chave do cliente codificado em PEM. Obrigatório se `enable_ssl` for `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `TIMEOUT`
      </td>

      <td>
        Espera máxima pela conexão, em segundos. Defina como `0` para não ter tempo limite. O padrão é 10.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `DATABASE`
      </td>

      <td>
        O banco de dados PostgreSQL ao qual se conectar. O padrão é `postgres`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        MI
      </td>
    </tr>

    <tr>
      <td>
        `CUSTOM_METRICS_QUERY`
      </td>

      <td>
        A consulta SQL que requer `columns metric_name`, `metric_type` e `metric_value.metric_type` pode ser `gauge`, `rate`, `delta` ou `attribute`. Colunas adicionais coletadas com a consulta são adicionadas à métrica definida como atributo.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `CUSTOM_METRICS_CONFIG`
      </td>

      <td>
        Um caminho para um arquivo YAML com uma lista de consultas personalizadas, juntamente com seu tipo de métrica, banco de dados e substituições de nomes de amostra. Veja os [exemplos](/docs/infrastructure/host-integrations/host-integrations-list/postgresql/postgresql-integration#examples) para detalhes.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECT_DB_LOCK_METRICS`
      </td>

      <td>
        Possibilita a coleta de métricas de bloqueio do banco de dados, que podem ser intensivas em desempenho. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `COLLECT_BLOAT_METRICS`
      </td>

      <td>
        Habilite a métrica de inchaço do espaço de tabela, que pode exigir muito desempenho. O padrão é `true`.
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        `METRICS`
      </td>

      <td>
        Defina como `true` para ativar a coleta somente de métricas. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}/>
    </tr>

    <tr>
      <td>
        `INVENTORY`
      </td>

      <td>
        Defina como `true` para ativar a coleta somente de inventário. O padrão é `false`.
      </td>

      <td style={{ 'text-align': 'center' }}/>
    </tr>
  </tbody>
</table>

Os valores para estas configurações podem ser definidos de diversas maneiras:

* Adicionando o valor diretamente no arquivo de configuração. Esta é a forma mais comum.
* Substituindo os valores das variáveis de ambiente usando a notação `{{ }}` . Leia mais sobre como [usar passthroughs de variáveis de ambiente com integração no host](/docs/infrastructure/install-infrastructure-agent/configuration/configure-infrastructure-agent/#passthrough) ou veja o exemplo de [substituição de variáveis de ambiente](/docs/infrastructure/host-integrations/host-integrations-list/elasticsearch/elasticsearch-integration#envvar-replacement). <Callout variant="important">Isso requer o agente de infraestrutura v1.14.0+.</Callout>
* Usando gerenciamento de segredos. Use isto para proteger informações confidenciais, como senhas que seriam expostas em texto simples no arquivo de configuração. Para obter mais informações, consulte [gerenciamento de segredos](/docs/integrations/host-integrations/installation/secrets-management).

### Etiquetas e atributo personalizado [#labels]

Variáveis de ambiente podem ser usadas para controlar definições de configuração, como <InlinePopover type="licenseKey"/>e, em seguida, são passadas para o agente de infraestrutura. Para obter instruções sobre como usar esse recurso, consulte [Configurar o agente de infraestrutura](/docs/infrastructure/install-infrastructure-agent/configuration/configure-infrastructure-agent).

Você pode decorar ainda mais sua métrica usando etiquetas. Os rótulos permitem que você adicione pares de valores principais atributo à sua métrica que você pode usar para consultar, filtrar ou agrupar sua métrica.

Nosso arquivo de configuração de amostra padrão inclui exemplos de rótulos, mas, como não são obrigatórios, você pode remover, modificar ou adicionar novos de sua escolha:

```yml
 labels:
   env: production
   role: postgresql
```

## Dados de inventário [#inventory]

A integração do PostgreSQL coleta cada configuração de `pg_settings` junto com seus `boot_val` e `reset_val`. A [infraestrutura dados de inventário](/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data) aparece na [página Inventário](/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-inventory-page-search-your-entire-infrastructure), na fonte `config/postgresql` .

## Resolução de problemas [#troubleshooting]

Aqui estão algumas dicas de resolução de problemas para a integração PostgreSQL:

* Se você tiver problemas de conexão, certifique-se de poder se conectar ao cluster na mesma caixa com `psql`.
* Se você tiver problemas para coletar a métrica `PgBouncer`, certifique-se de estar conectado à instância através de `PgBouncer`. A porta padrão é `6432`.
* Se você receber a mensagem de erro `Error creating list of entities to collect: pq: unsupported startup parameter: extra_float_digits`, defina `ignore_startup_parameters = extra_float_digits` no arquivo de configuração `PgBouncer` .
