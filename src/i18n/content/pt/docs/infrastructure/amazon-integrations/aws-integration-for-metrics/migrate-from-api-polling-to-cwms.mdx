---
title: Migrar do API Polling para o CloudWatch Metric Streams
tags:
  - API polling to CWMS migration
metaDescription: Migrate your New Relic and AWS services integration type from API Polling to CloudWatch Metric Streams.
freshnessValidatedDate: never
translationType: machine
---

Para uma integração perfeita da sua conta AWS com New Relic, [a integração via CloudFormation e CloudWatch Metric Streams](/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation) é a abordagem mais recomendada. No entanto, se você já integrou sua conta da AWS com o New Relic usando o API Polling, consulte o procedimento a seguir para migrar do API Polling para o CloudWatch Metric Streams.

## Pré-requisitos [#prerequisites]

Antes de começar a integrar sua conta da AWS com o New Relic, certifique-se de atender aos seguintes pré-requisitos:

* **Uma [chave de licença do New Relic Ingest e uma chave de usuário](https://one.newrelic.com/api-keys)**: você precisará dessas chaves para conectar seus serviços da AWS à sua conta do New Relic.
* **[Permissões](https://docs.aws.amazon.com/ARG/latest/userguide/gettingstarted-prereqs-permissions.html)** para implantar novos recursos da AWS e **[funções do IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html)**: você precisará dessa permissão para sua conta da AWS.
* **[Permissões](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/#infrastructure)** para integração na nuvem: Você precisará dessas permissões para sua conta New Relic.
* Para usuários que gerenciam várias contas AWS, [conecte cada conta a uma única conta New Relic ](/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account).
* Para usuários que gerenciam várias regiões dentro dessas contas, é necessário criar um Kinesis Data Firehose separado que aponte para o New Relic para cada região.

<Steps>
  <Step>
    ## Migrar para a integração do CloudWatch Metric Streams [#migrate]

    Você pode migrar da pesquisa de API criando um modelo do CloudFormation ou adicionando novamente sua conta da AWS e seguindo nossos procedimentos de instalação guiada no aplicativo. Recomendamos que você use o método de modelo do CloudFormation, pois é a maneira mais eficiente de migrar. Essas integrações não são suportadas pelo CloudWatch Metric Streams e não podem ser migradas para nossa integração:

    * AWS CloudTrail
    * AWS Health
    * AWS Trusted Advisor
    * AWS X-Ray

    Se você usar essa integração, ainda precisará usar o método de pesquisa API.

    <CollapserGroup>
      <Collapser id="with-template" title="Migrar com o modelo CloudFormation (recomendado)">
        O modelo CloudFormation permite que você atualize um modelo com namespace pré-configurado com base na sua configuração de pesquisa.

        1. Acesse **[one.newrelic.com &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)** e clique em **<DNT>Migrate to CloudWatch Metric stream</DNT>**.
        2. Siga os procedimentos. Você baixará o modelo e replicará o namespace da pesquisa API. Não se esqueça de adicionar os detalhes da sua conta ao modelo baixado.
        3. No AWS Console, acesse <DNT>**Cloud Formation &gt; Create Stack &gt; Upload a template file**</DNT>. Carregue seu modelo CloudFormation atualizado.
      </Collapser>

      <Collapser id="without-template" title="Migrar sem o modelo CloudFormation">
        Se não quiser usar o método CloudFormation, você precisará adicionar novamente sua conta AWS, mesmo que já tenha vinculado sua conta AWS à integração de pesquisa. Esses procedimentos podem fazer com que você saia deste documento, mas lembre-se de retornar para desabilitar sua integração de polling.

        1. Vá para <DNT>**[one.newrelic.com &gt; All capabilities &gt;Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT> e clique em <DNT>**Add AWS account**</DNT>. Escolha seu método.
        2. Siga as etapas AWS Console do [fluxo doAWS Console ](/install/aws-cloudwatch/?task=console)neste documento.
        3. [Desabilite todas as integrações de pesquisa desnecessárias](/docs/infrastructure/amazon-integrations/connect/uninstall-aws/) na conta anterior do provedor AWS.

        Ao desabilitar, tenha em mente que [algumas integrações não são suportadas pelo CloudWatch Metric Streams](/docs/infrastructure/amazon-integrations/connect/connect-aws-new-relic-infrastructure-monitoring/).
      </Collapser>
    </CollapserGroup>

    Nossa integração CloudWatch Metric Streams usa a API métrica para enviar métricas no formato [métrica dimensional](/docs/data-apis/understand-data/new-relic-data-types/#dimensional-metrics). Nosso método de pesquisa de API, por outro lado, envia métrica com base em [evento](/docs/data-apis/understand-data/new-relic-data-types/#events-new-relic).

    * Para auxiliar na transição, fornecemos um mecanismo de shimming que permite que você escreva consultas de forma transparente em qualquer formato. Essas consultas são processadas conforme o esperado com base na fonte disponível, seja de evento para métrica ou de métrica para evento.
    * Recomendamos revisar [algumas limitações](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/query-infrastructure-dimensional-metrics-nrql/#known-limitations) sobre o mecanismo de shimming que permite usar consultas baseadas em eventos com a integração do CloudWatch Metric Streams.

    Após a migração, alguns recursos do New Relic que dependem dos dados de pesquisa da sua API podem se comportar de maneira diferente:

    * <DNT>**Dashboards**</DNT>: o painel personalizado que usa o evento de integração AWS baseado em enquete ainda funcionará conforme o esperado.
    * <DNT>**Alerts**</DNT>: condição do alerta de que usar evento AWS baseado em enquete ainda funcionará. Recomendamos adaptá-los ao formato métrico dimensional que usa NRQL como fonte.
    * <DNT>**Entities**</DNT>: Sua lista de entidade monitora pode apresentar entidade duplicada por até 24 horas.
    * <DNT>**Attributes**</DNT>: As integrações da AWS baseadas em pesquisa prefixam a tag de recurso coletada com `label.`, enquanto a integração do AWS CloudWatch Metric Streams prefixa a tag de recurso coletada com `tags.`. Se ambas as integrações estiverem habilitadas para a mesma conta AWS, a tag do recurso aparecerá em ambos os prefixos ao usar o formato de evento.
  </Step>

  <Step>
    ## Valide se seus dados [#validate-data]

    Para confirmar que você está recebendo dados dos Streams métrica, siga estes passos:

    1. Vá para <DNT>**[one.newrelic.com &gt; All capabilities &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT>. Procure a conta da AWS que você conectou ao New Relic. <DNT>**Stream**</DNT> contas.
    2. Verifique o dashboard de status da conta e confirme se New Relic recebe os dados métricos. Isso pode incluir erros e número de namespace e métrica ingeridos.
    3. Explore seus dados escrevendo consultas para conjuntos específicos de métricas.

    Pode levar alguns minutos para que New Relic detecte novos recursos e os sintetize como entidade.

    <Callout variant="tip">
      As métricas AWS do CloudWatch para serviços globais, como AWS Billing, estão disponíveis somente na região <DNT>**us-east-1**</DNT>. Certifique-se de que haja um CloudWatch Metric Streams ativo configurado nessa região.
    </Callout>
  </Step>
</Steps>

## Tópicos relacionados [#related-topics]

<DocTiles>
  <DocTile title="Coletar dados de várias contas da AWS" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account/">
    Aprenda a coletar dados de várias contas da AWS.
  </DocTile>

  <DocTile title="AWS integração métrica" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-integrations-metrics/">
    Explore e use o métrica do CloudWatch Metric Streams.
  </DocTile>

  <DocTile title="Integração AWS via CloudFormation e CWMS" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-cwms">
    Integre os serviços da AWS com o New Relic usando o CloudFormation e o CloudWatch Metric Streams.
  </DocTile>

  <DocTile title="Integração AWS via CloudFormation e API Polling" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-and-api-polling">
    Integre serviços da AWS com o New Relic usando CloudFormation e API Polling.
  </DocTile>

  <DocTile title="Integração AWS via Terraform" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/terraform">
    Integre serviços da AWS com o New Relic usando o Terraform.
  </DocTile>

  <DocTile title="Integração manual do console AWS" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/manual">
    Integre manualmente os serviços da AWS com o New Relic a partir do console da AWS.
  </DocTile>
</DocTiles>