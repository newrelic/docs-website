---
title: Configure as credenciais da AWS.
metaDescription: 'Configure AWS credentials for workflow automation using IAM roles, IAM users, or temporary session tokens.'
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Autorize a automação de fluxo de trabalho do New Relic a executar ações em sua conta da AWS. Você configurará um método de autenticação que permitirá que o fluxo de trabalho interaja com segurança com serviços da AWS como EC2, SQS, DynamoDB e outros, sem precisar codificar credenciais ou comprometer a segurança.

## Pré-requisitos

Antes de configurar as credenciais da AWS, certifique-se de ter:

* Uma conta AWS com permissão para criar funções ou usuários do IAM.
* Seu [ID de conta New Relic](/docs/accounts/accounts-billing/account-structure/account-id).
* Acesso administrativo ao [Console do AWS IAM](https://console.aws.amazon.com/iam/).

## Compreenda as permissões necessárias [#required-permissions]

Antes de criar credenciais, entenda quais permissões seu fluxo de trabalho precisa. Conceda apenas as permissões que seu fluxo de trabalho realmente utiliza — isso segue o princípio do menor privilégio e minimiza o risco de segurança.

### Permissões comuns de fluxo de trabalho

| **Tipo de fluxo de trabalho** | **Permissões AWS necessárias**                                                                                       | **Descrição**                                                     |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- |
| **Gestão do EC2**             | `ec2:DescribeInstances`<br />`ec2:StopInstances`<br />`ec2:StartInstances`<br />`ec2:ModifyInstanceAttribute`        | Pare, inicie ou modifique instâncias do EC2 em resposta a alertas |
| **Mensagens SQS**             | `sqs:SendMessage`<br />`sqs:GetQueueAttributes`                                                                      | Enviar mensagens para filas SQS para processamento posterior.     |
| **Gateway de API**            | `apigateway:GET`<br />`apigateway:PUT`                                                                               | Reverter implantação ou configuração API Gateway                  |
| **Gerente de Sistemas**       | `ssm:CreateDocument`<br />`ssm:DeleteDocument`<br />`ssm:StartAutomationExecution`<br />`ssm:GetAutomationExecution` | Executar manuais de automação                                     |
| **DynamoDB**                  | `dynamodb:Query`<br />`dynamodb:GetItem`<br />`dynamodb:PutItem`                                                     | Ler ou escrever em tabelas do DynamoDB                            |

<Callout variant="tip">
  Comece com permissões somente de leitura (`Describe*`, `Get*`, `List*`), depois adicione permissões de gravação (`Put*`, `Create*`, `Delete*`) somente conforme necessário. Isso evita ações destrutivas acidentais durante os testes.
</Callout>

Consulte [os exemplos de políticas](#policy-examples) abaixo para obter modelos completos de políticas IAM.

## Configurar autenticação

Escolha o método que melhor se adequa ao seu caso de uso na tabela acima:

<Tabs>
  <TabsBar>
    <TabsBarItem id="iam-role-1">Função IAM (recomendada)</TabsBarItem> <TabsBarItem id="iam-user-1">Usuário IAM com chaves de acesso</TabsBarItem> <TabsBarItem id="session-tokens-1">Token de sessão</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="iam-role-1">
      Uma função do IAM permite que o New Relic assuma credenciais temporárias em sua conta da AWS sem exigir chaves de acesso permanentes.

      **Características da função IAM:**

      * As credenciais são rotacionadas automaticamente.
      * O acesso é limitado no tempo, conforme projetado.
      * Todas as ações são registradas no AWS CloudTrail.
      * Alinha-se com as práticas de segurança recomendadas AWS

      ### Crie a função na AWS.

      1. Faça login no [Console do AWS IAM.](https://console.aws.amazon.com/iam/)
      2. Acesse **Roles &gt; Create role &gt; Trusted entity type** e selecione **AWS account &gt; another AWS account**
      3. No campo **Account ID**, insira: `253490767857`
      4. Em **Options**, marque a **Require external ID**.
      5. No campo **External ID**, insira o ID da sua conta New Relic e clique em **Next**.

      * Não tem? [Encontre seu ID de conta aqui.](/docs/accounts/accounts-billing/account-structure/account-id)

      6. Na página **Add permissions**, anexe políticas com base no seu fluxo de trabalho:

      * Para fluxo de trabalho EC2: anexe `AmazonEC2ReadOnlyAccess` ou crie uma política personalizada
      * Para fluxo de trabalho SQS: Anexe `AmazonSQSFullAccess` ou limite a filas específicas
      * Para outros serviços: consulte [as permissões da AWS necessárias](#required-aws-permissions) abaixo.

      7. Clique em **Next**.
      8. Digite um nome para a função: `NewRelicWorkflowAutomationRole` (ou o nome de sua preferência)
      9. Opcionalmente, adicione uma descrição: &quot;Permite que a automação do fluxo de trabalho do New Relic execute ações na AWS&quot; e clique em **Create role**.

      ### Verifique a política de confiança.

      Após criar a função, verifique a relação de confiança:

      1. No console do IAM, selecione a função recém-criada.
      2. Clique na aba **Trust relationships**.
      3. Confirme se a política corresponde a esta estrutura (substitua `<YOUR_NR_ACCOUNT_ID>` pelo seu ID de conta real):

      ```json
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Action": "sts:AssumeRole",
                  "Principal": {
                      "AWS": "arn:aws:iam::253490767857:root"
                  },
                  "Condition": {
                      "StringEquals": {
                          "sts:ExternalId": "<YOUR_NR_ACCOUNT_ID>"
                      }
                  }
              }
          ]
      }
      ```

      ### Copie o ARN da sua função.

      Você precisará do role ARN para configurar o fluxo de trabalho:

      1. No console do IAM, selecione sua função.
      2. Na seção **Summary**, localize o campo **ARN.**
      3. Copie o ARN completo — ele tem a seguinte aparência: `arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole`
      4. Salve este ARN com segurança – você irá colá-lo diretamente na configuração do fluxo de trabalho

      <Callout variant="tip">
        **Importante:** os ARNs de função devem ser inseridos diretamente nas entradas do fluxo de trabalho — não os armazene no gerenciador de segredos. Não são credenciais confidenciais; são identificadores de recursos.
      </Callout>

      A função já está configurada. Use o ARN na configuração do fluxo de trabalho que requer acesso AWS.
    </TabsPageItem>

    <TabsPageItem id="iam-user-1">
      Utilize este método para ambientes de teste ou quando as funções do IAM não forem suportadas. As chaves de acesso são credenciais de longa duração que exigem rotação manual.

      **Casos de uso:**

      * Ambientes de teste e desenvolvimento
      * Configurações AWS que não suportam a assunção de funções entre contas.
      * Fluxo de trabalho de autenticação simplificado

      <Callout variant="caution">
        As chaves de acesso são credenciais de longa duração. Faça o rodízio regularmente (a cada 90 dias) e limite as permissões apenas ao que seu fluxo de trabalho necessita.
      </Callout>

      ### Criar o usuário do IAM

      1. Faça login no [Console do AWS IAM.](https://console.aws.amazon.com/iam/)
      2. Acesse **Users &gt; Create user** e insira um nome de usuário: `workflow-automation-user` (ou o nome de sua preferência)
      3. Clique em **Next**
      4. Na página **Set permissions**, selecione **Attach policies directly**.
      5. Pesquise e selecione políticas com base no seu fluxo de trabalho:

      * Para SQS: Selecione `AmazonSQSFullAccess`
      * Para EC2: Selecione `AmazonEC2ReadOnlyAccess`
      * Ou crie uma política personalizada com permissões limitadas (recomendado).

      6. Clique em **Next** e, em seguida, em **Create user**.

      ### Gerar chaves de acesso

      1. Na lista de usuários, selecione o usuário que você acabou de criar.
      2. Clique na guia **Security credentials**
      3. Na seção **Access keys**, selecione **Create access key**.
      4. Selecione **Application running outside AWS** e clique em **Next**.
      5. (Opcional) Adicione uma tag de descrição: &quot;Automação de fluxo de trabalho do New Relic&quot;
      6. Selecione **Create access key**
      7. Copie ambas as credenciais imediatamente:

      * **ID da chave de acesso** (começa com `AKIA...`)
      * **Chave de acesso secreta** (mostrada apenas uma vez)

      <Callout variant="important">
        A AWS exibe a chave de acesso secreta apenas uma vez durante a criação. Se você não salvar, precisará gerar um novo par de chaves.
      </Callout>

      ### Armazene suas credenciais com segurança.

      Nunca codifique credenciais AWS no fluxo de trabalho. Em vez disso, armazene-os no [gerenciador de segredos](/docs/infrastructure/host-integrations/installation/secrets-management/) do New Relic.

      1. Abra o [explorador GraphiQL do NerdGraph](https://one.newrelic.com/nerdgraph-graphiql)
      2. Execute esta mutação para armazenar seu ID de chave de acesso (substitua os valores de espaço reservado):

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsAccessKeyId"
          description: "AWS Access Key ID for workflow automation"
          value: "YOUR_AWS_ACCESS_KEY_ID"
        ) {
          key
        }
      }
      ```

      3. Execute outra mutação para sua Chave de Acesso Secreta:

      ```graphql
      mutation {
        secretsManagementCreateSecret(
          scope: {type: ACCOUNT id: "YOUR_NR_ACCOUNT_ID"}
          namespace: "aws"
          key: "awsSecretAccessKey"
          description: "AWS Secret Access Key for workflow automation"
          value: "YOUR_AWS_SECRET_ACCESS_KEY"
        ) {
          key
        }
      }
      ```

      **Faça referência a esses segredos no fluxo de trabalho** usando a sintaxe: `${{ :secrets:awsAccessKeyId }}`

      <Callout variant="tip">
        Use o campo `namespace` para organizar segredos por ambiente (`aws-prod`, `aws-staging`) ou nome da equipe.
      </Callout>
    </TabsPageItem>

    <TabsPageItem id="session-tokens-1">
      O token de sessão fornece credenciais temporárias com expiração automática.

      **Casos de uso:**

      * Desenvolvimento e testes locais
      * pipeline de CI/CD que requer rotação de credenciais
      * Ambientes com requisitos de conformidade para acesso com tempo limitado (normalmente de 1 a 12 horas)

      **Pré-requisitos:**

      * [AWS CLI instalada e configurada](https://aws.amazon.com/cli/)
      * Uma função IAM existente que você pode assumir.

      ### Gerar credenciais temporárias

      1. Abra o terminal e execute este comando (substitua \`\` pelo ARN da sua função):

      ```bash
      aws sts assume-role \
        --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/YOUR_ROLE" \
        --role-session-name "WorkflowAutomationSession"
      ```

      Se esta for a sua primeira vez usando a AWS CLI, talvez seja necessário configurá-la com `aws configure` e inserir suas credenciais de acesso:

      <img title="Image of the Static Access credentials" alt="Image of the Static Access credentials" src="/images/static-access.webp" />

      2. A AWS retorna três valores — você precisa dos três:

      ```json
      {
        "Credentials": {
            "AccessKeyId": "ASIAIOSFODNN7EXAMPLE",
            "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
            "SessionToken": "FQoGZXIvYXdzEBk...",
            "Expiration": "2025-01-25T12:00:00Z"
        }
      }
      ```

      3. Armazene todas as três credenciais no gerenciador de segredos:

      * `AccessKeyId` armazenar como `awsAccessKeyId`
      * `SecretAccessKey` armazenar como `awsSecretAccessKey`
      * `SessionToken` armazenar como `awsSessionToken`

      <Callout variant="caution">
        O token de sessão expira (normalmente após 1 hora). Defina um lembrete para atualizá-los antes do timestamp `Expiration`, ou seu fluxo de trabalho falhará com erros de autenticação.
      </Callout>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Use credenciais no fluxo de trabalho [#use-credentials]

Após configurar a autenticação, referencie suas credenciais na configuração do fluxo de trabalho:

### Função IAM (recomendada)

Cole o ARN da função diretamente nas entradas do fluxo de trabalho — sem necessidade de gerenciador de segredos:

```yaml
awsRoleArn: arn:aws:iam::123456789012:role/NewRelicWorkflowAutomationRole
```

<Callout variant="tip">
  Os ARNs de função são identificadores de recursos, não credenciais confidenciais. Não os armazene no gerenciador de segredos – cole-os diretamente na configuração do fluxo de trabalho.
</Callout>

### Token de usuário ou sessão IAM

Gerenciador de segredos de referência para chaves de acesso:

```yaml
awsAccessKeyId: ${{ :secrets:awsAccessKeyId }}
awsSecretAccessKey: ${{ :secrets:awsSecretAccessKey }}
awsSessionToken: ${{ :secrets:awsSessionToken }}  # Only for session tokens
```

O New Relic recupera segredos em tempo de execução, autentica-se com a AWS e, em seguida, os descarta. Suas credenciais nunca aparecem nos logs ou no histórico do fluxo de trabalho.

## Exemplos de políticas [#policy-examples]

Utilize esses modelos completos de política IAM para tipos de fluxo de trabalho comuns. Cada um segue o princípio do menor privilégio, restringindo o acesso a recursos específicos.

<CollapserGroup>
  <Collapser id="sqs-policy" title="fluxo de trabalho de mensagens SQS">
    Restringir o acesso a uma fila específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": "sqs:SendMessage",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        },
        {
          "Effect": "Allow",
          "Action": "sqs:GetQueueAttributes",
          "Resource": "arn:aws:sqs:us-west-2:123456789012:my-workflow-queue"
        }
      ]
    }
    ```

    Substitua `us-west-2` pela sua região, `123456789012` pelo seu ID de conta AWS e `my-workflow-queue` pelo nome da sua fila.
  </Collapser>

  <Collapser id="ec2-policy" title="fluxo de trabalho de gerenciamento do EC2">
    Restringir o acesso a categorias específicas por meio de tag:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ec2:DescribeInstances",
            "ec2:DescribeTags"
          ],
          "Resource": "*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ec2:StopInstances",
            "ec2:StartInstances",
            "ec2:ModifyInstanceAttribute"
          ],
          "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/*",
          "Condition": {
            "StringEquals": {
              "aws:ResourceTag/Environment": "production"
            }
          }
        }
      ]
    }
    ```

    Esta política permite que o fluxo de trabalho pare/inicie/modifique apenas instâncias da tag EC2 com `Environment=production`.
  </Collapser>

  <Collapser id="dynamodb-policy" title="Fluxo de trabalho do DynamoDB">
    Restringir o acesso a uma tabela específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "dynamodb:Query",
            "dynamodb:GetItem",
            "dynamodb:PutItem"
          ],
          "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/WorkflowData"
        }
      ]
    }
    ```

    Substitua `WorkflowData` pelo nome da sua tabela.
  </Collapser>

  <Collapser id="ssm-policy" title="Fluxo de trabalho do Gerente de Sistemas">
    Restringir o acesso a documentos de automação específicos:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "ssm:CreateDocument",
            "ssm:DeleteDocument"
          ],
          "Resource": "arn:aws:ssm:us-east-1:123456789012:document/WorkflowAutomation-*"
        },
        {
          "Effect": "Allow",
          "Action": [
            "ssm:StartAutomationExecution",
            "ssm:GetAutomationExecution"
          ],
          "Resource": [
            "arn:aws:ssm:us-east-1:123456789012:automation-definition/WorkflowAutomation-*:*",
            "arn:aws:ssm:us-east-1:123456789012:automation-execution/*"
          ]
        }
      ]
    }
    ```

    Isso restringe os documentos de automação àqueles prefixados com `WorkflowAutomation-`.
  </Collapser>

  <Collapser id="apigateway-policy" title="Fluxo de trabalho API Gateway">
    Restringir o acesso a uma API específica:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "apigateway:GET",
            "apigateway:PUT"
          ],
          "Resource": "arn:aws:apigateway:us-west-2::/restapis/abc123xyz/*"
        }
      ]
    }
    ```

    Substitua `abc123xyz` pelo seu ID do API Gateway.
  </Collapser>
</CollapserGroup>

### Recursos adicionais

Para obter informações completas sobre permissões da AWS:

* **[Políticas gerenciadas de integração comAWS ](/docs/infrastructure/amazon-integrations/get-started/integrations-managed-policies/)**: Lista completa de permissões AWS por serviço, além de modelos do CloudFormation que você pode adaptar.
* **[Configurar AWS API polling](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)**: Padrões de configuração adicionais

<Callout variant="important">
  Esses recursos usam o ID da conta `754728514883` para integração na nuvem (monitoramento). Para automação de fluxo de trabalho, use sempre `253490767857`.
</Callout>

## Próximos passos

Após configurar as credenciais AWS, você pode criar o fluxo de trabalho:

**Criar fluxo de trabalho:**

1. **[Navegue pelas ações da AWS](/docs/workflow-automation/setup-and-configuration/actions-catalog/actions-catalog)**: Veja as operações da AWS disponíveis (EC2, SQS, DynamoDB, etc.)
2. **[Use um modelo](/docs/workflow-automation/create-a-workflow-automation/use-a-template)**: implantar fluxo de trabalho pré-configurado para tarefas comuns de automação AWS
3. **[Crie um fluxo de trabalho personalizado](/docs/workflow-automation/create-a-workflow-automation/create-your-own)**: Crie um fluxo de trabalho para seus requisitos específicos

**Configurar notificação:**

* **[Configurar destinos](/docs/workflow-automation/setup-and-configuration/create-destinations)**: configurar Slack, PagerDuty, e-mail ou notificação de webhook para evento de fluxo de trabalho