---
title: Ações do AWS Systems Manager
tags:
  - workflow automation
  - workflow
  - workflow automation actions
  - AWS actions
  - AWS Systems Manager actions
metaDescription: A list of available aws systems manager actions in the actions catalog for workflow definitions
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Esta página fornece uma referência completa para as ações do AWS Systems Manager disponíveis no catálogo de ações de automação de fluxo de trabalho. Essas ações permitem que você automatize o gerenciamento de sistemas e documente as operações.

## Pré-requisitos

Antes de usar as ações AWS na automação do fluxo de trabalho, certifique-se de ter:

* Uma conta da AWS com as permissões apropriadas.
* Credenciais da AWS configuradas (credenciais de usuário do IAM, ARN da função do IAM ou credenciais de sessão).
* As permissões IAM necessárias para os serviços específicos da AWS que você planeja usar.

Consulte [Configurar credenciais AWS ](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/)para obter informações sobre como criar usuários e funções do IAM e configurar credenciais estáticas e de sessão AWS para integração com as ações de automação de fluxo de trabalho AWS.

<CollapserGroup>
  <Collapser id="aws-systemsmanager.writedocument" title="Escrever documento SSM para AWS">
    Crie um documento SSM para a conta AWS com base nas credenciais da AWS fornecidas no campo de entrada da ação. Consulte [a documentação do AWS Systems Manager.](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="writedocumentinputs">
          Entradas
        </TabsBarItem>

        <TabsBarItem id="writedocumentoutputs">
          Saídas
        </TabsBarItem>

        <TabsBarItem id="writedocumentexample">
          Exemplo
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="writedocumentinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de entrada
                </th>

                <th>
                  Opcionalidade
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **região**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentType: "Command"`

                  Verifique os valores válidos [aqui](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **documentFormat**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentFormat: "YAML"`

                  Verifique os valores válidos [aqui](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **documentContent**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  Confira o exemplo
                </td>
              </tr>

              <tr>
                <td>
                  **override**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Boleano
                </td>

                <td>
                  `override: true (default)`.

                  Quando `true`, escreva sempre o documento com o nome fornecido, mesmo que já exista um.

                  Quando `false`, se já existir um documento com o `documentName` fornecido, a ação retorna `success: false` e `errorMessage: Document already exists. Please enable override if you want to update the existing document.`
                </td>
              </tr>

              <tr>
                <td>
                  **seletores**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  list
                </td>

                <td>
                  `[{\"name\": \"documentName\", \"expression\": \".documentName\"}, {\"name\": \"documentType\", \"expression\": \".documentType\"}, {\"name\": \"documentStatus\", \"expression\": \".documentStatus\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="writedocumentoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de saída
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Descrição e exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentVersion**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentVersion: 1`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentType: "Command"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentStatus**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentStatus: "Active"`

                  O valor será um dos status [daqui](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of).
                </td>
              </tr>

              <tr>
                <td>
                  **sucesso**
                </td>

                <td>
                  Boleano
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **mensagem de erro**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Na entrada de ação, somente `awsAccessKeyId` e `awsSecretAccessKey` podem ser fornecidos, mas devem ser credenciais estáticas de um usuário IAM.
            * Se as credenciais da sessão forem usadas, `awsAccessKeyId`, `awsSecretAccessKey` e `awsSessionToken` devem ser passados para a entrada de ação.
            * Os seletores permitem obter como saída apenas o parâmetro especificado.
            * Consulte as [credenciais da AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials) para obter instruções.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="writedocumentexample">
          **Exemplo 1**: Um documento SSM simples para listar todas as funções Lambda.

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **Definição completa de fluxos automáticos com listagem SSM da função Lambda**

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```

          **Exemplo 2: Executar um script Python**

          <Collapser id="execute.python.script" title="Executar script Python">
            Usando a automação AWS `SystemsManager` e a ação de documento, podemos definir uma definição de fluxo de trabalho que execute um script Python.

            Aqui está um breve exemplo ilustrativo com um aplicativo simples &quot;Olá, Mundo!&quot;.

            <Collapser id="system.manager.document" title="Documento do SystemsManager">
              ```yaml
              schemaVersion: '0.3'
              description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
              parameters:
                Username:
                  type: String
                  description: "The username to greet."
                  default: "User"
              mainSteps:
                - action: aws:executeScript
                  name: pythonStep
                  inputs:
                    Runtime: python3.8
                    Handler: script_handler
                    Script: |
                      def script_handler(event, context):
                          username = event['username']
                          return f'Hello {username}'
                    InputPayload:
                      username: "{{ Username }}"
                  outputs:
                    - Name: scriptOutput
                      Type: String
                      Selector: $.Payload
              outputs:
                - pythonStep.scriptOutput
              ```

              Isso pode então ser usado no fluxo de trabalho abaixo:

              <Collapser id="workflow.definition.1" title="Definição de fluxo de trabalho">
                ```yaml
                name: aws-python-script

                workflowInputs:
                  key:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
                  access:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
                  token:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
                  region:
                    type: String
                    defaultValue: us-west-2
                  name:
                    type: String
                    defaultValue: ExecuteHelloPythonScript
                  username:
                    type: String
                    defaultValue: World!

                steps:
                  - name: generateIdempotencyToken
                    type: action
                    action: utils.uuid.generate
                    version: 1

                  - name: createSsmDocument
                    type: action
                    action: aws.systemsManager.writeDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .workflowInputs.name }}
                      documentContent: |
                        schemaVersion: '0.3'
                        description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
                        parameters:
                          Username:
                            type: String
                            description: "The username to greet."
                            default: "User"
                        mainSteps:
                          - action: aws:executeScript
                            name: pythonStep
                            inputs:
                              Runtime: python3.8
                              Handler: script_handler
                              Script: |
                                def script_handler(event, context):
                                    username = event['username']
                                    return f'Hello {username}'
                              InputPayload:
                                username: "{{ Username }}"
                            outputs:
                              - Name: scriptOutput
                                Type: String
                                Selector: $.Payload
                        outputs:
                          - pythonStep.scriptOutput

                  - name: start1
                    type: action
                    action: aws.systemsManager.startAutomation
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}
                      parameters:
                        Username: ${{ .workflowInputs.username }}

                  - name: waitForCompletion
                    type: action
                    action: aws.systemsManager.waitForAutomationStatus
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                      # Optional, default is Success and Failed
                      automationExecutionStatuses:
                        - "Success"
                        - "Failed"
                      timeout: 300

                  - name: hasCompleted
                    type: switch
                    switch:
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                        next: displayError
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                        next: displaySuccess
                    next: displayUnexpected

                  - name: displayUnexpected
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
                    next: cleanupSsmDocument

                  - name: displaySuccess
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "This is the results of the automation that was run on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.pythonStep.scriptOutput | tojson }}"
                    next: cleanupSsmDocument

                  - name: displayError
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs | tojson }}"
                    next: cleanupSsmDocument

                  - name: cleanupSsmDocument
                    type: action
                    action: aws.systemsManager.deleteDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
                ```

                Isso pode ser iniciado com a seguinte mutação NerdGraph, assumindo que os segredos temporários da AWS foram previamente armazenados com as mutações `secretsManagementCreateSecretNerdGraph`.

                ```yaml
                mutation { 
                    autoflowsStartWorkflowRun(accountId: 11933347,
                    definition: {
                        name: "aws-python-script",
                    }, workflowInputs: [
                        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
                        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
                        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
                        {key: "region" value:"us-west-2"}
                        {key: "username" value: "Julien"}
                    ]) 
                    { runId }
                } 
                ```

                Executar a mutação acima retorna um runId, por exemplo `207e8c23-2c89-4af2-a74f-3c9ea2ffd543`. Esse runId pode então ser usado para consultar os logs e visualizar a seguinte saída:

                <img title="Image of a python script execution output" alt="Image of a python script execution output" src="/images/python-script.webp" />
              </Collapser>
            </Collapser>
          </Collapser>

          **Exemplo 3: Um documento SSM mais complexo**

          <Collapser id="example3.complex.document" title="Exemplo de documento SSM complexo">
            **Documento SSM executando rollback do API Gateway:**

            1. Obtenha a lista de APIs REST do gateway de API. Filtre minha API (`Test API`) e obtenha o ID da API REST.
            2. Obtenha a lista de todos os recursos dentro da minha API (`Test API`). Filtrar meu recurso específico com base em pathPart(`/test`) e obter o resourceID
            3. Obtenha a lista de versões para minha função do Lambda (`ApiGwTestFn`). Filtre a versão específica para a qual deseja reverter (versão: 1) e obtenha o functionArn dessa versão.
            4. Atualize a integração do gateway de API com o ARN da função Lambda obtido na etapa anterior.
            5. Crie uma nova implantação para minha API REST (`Test API`).

            ```yaml
            schemaVersion: '0.3'
            description: Test SSM for API gateway rollback
            mainSteps:
              - name: ExecuteAwsApi
                action: aws:executeAwsApi
                nextStep: ExecuteGetApiResources
                inputs:
                  Service: apigateway
                  Api: GetRestApis
                outputs:
                  - Name: resultApiId
                    Selector: $.items[?(@.name=='Test API')].id
                    Type: String
              - name: ExecuteGetApiResources
                action: aws:executeAwsApi
                nextStep: ExecuteListVersionsByFunction
                inputs:
                  Service: apigateway
                  Api: GetResources
                  restApiId: '{{ ExecuteAwsApi.resultApiId }}'
                outputs:
                  - Name: resultResourceId
                    Selector: $.items[?(@.pathPart=='test')].id
                    Type: String
              - name: ExecuteListVersionsByFunction
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwUpdateIntg
                inputs:
                  Service: lambda
                  Api: ListVersionsByFunction
                  FunctionName: ApiGwTestFn
                outputs:
                  - Name: resultLambdaVersionArn
                    Selector: $.Versions[?(@.Version=='1')].FunctionArn
                    Type: String
              - name: ExecuteApiGwUpdateIntg
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwCreateDeployment
                inputs:
                  Service: apigateway
                  Api: UpdateIntegration
                  restApiId: '{{ ExecuteAwsApi.resultApiId }}'
                  resourceId: '{{ ExecuteGetApiResources.resultResourceId }}'
                  httpMethod: GET
                  patchOperations:
                    - op: replace
                      path: /uri
                      value: arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/{{ ExecuteListVersionsByFunction.resultLambdaVersionArn }}/invocations
              - name: ExecuteApiGwCreateDeployment
                action: aws:executeAwsApi
                inputs:
                  Service: apigateway
                  Api: CreateDeployment
                  restApiId: '{{ ExecuteAwsApi.resultApiId }}'
            outputs:
              - ExecuteGetApiResources.resultResourceId
              - ExecuteListVersionsByFunction.resultLambdaVersionArn
            ```

            A amostra SSM produz `ExecuteGetApiResources.resultResourceId` e `ExecuteListVersionsByFunction.resultLambdaVersionArn`. Esses resultados podem ser usados em etapas posteriores na definição do fluxo de trabalho.
          </Collapser>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.deletedocument" title="Excluir um documento do AWS SSM">
    Esta ação tem como objetivo excluir um documento do AWS SSM na conta da AWS com base nas credenciais fornecidas no parâmetro de ação. Consulte [a documentação do AWS Systems Manager.](https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="systemsmanagerinputs">
          Entradas
        </TabsBarItem>

        <TabsBarItem id="systemsmanageroutputs">
          Saídas
        </TabsBarItem>

        <TabsBarItem id="systemsmanagerexample">
          Exemplo
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="systemsmanagerinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de entrada
                </th>

                <th>
                  Opcionalidade
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **região**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **seletores**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Lista
                </td>

                <td>
                  `[{\"name\": \"success\", \"expression\": \".success\"}, {\"name\": \"documentName\", \"expression\": \".documentName\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="systemsmanageroutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de saída
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **sucesso**
                </td>

                <td>
                  Boleano
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **mensagem de erro**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Na entrada de ação, somente `awsAccessKeyId` e `awsSecretAccessKey` podem ser fornecidos, mas devem ser credenciais estáticas de um usuário IAM.
            * Se as credenciais da sessão forem usadas, `awsAccessKeyId`, `awsSecretAccessKey` e `awsSessionToken` devem ser passados para a entrada de ação.
            * Os seletores permitem obter como saída apenas o parâmetro especificado.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="systemsmanagerexample">
          Um documento SSM simples para listar todas as funções do Lambda

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **Definição completa do fluxo de trabalho com SSM**:

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.startautomation" title="Comece a automatizar com o documento SSM">
    Inicia uma automação usando um documento do AWS SSM. Consulte [a documentação do AWS Systems Manager.](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartAutomationExecution.html)

    <Tabs>
      <TabsBar>
        <TabsBarItem id="startautomationinputs">
          Entradas
        </TabsBarItem>

        <TabsBarItem id="startautomationoutputs">
          Saídas
        </TabsBarItem>

        <TabsBarItem id="startautomationexample">
          Exemplo
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="startautomationinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de entrada
                </th>

                <th>
                  Opcionalidade
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **região**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **parâmetro**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Mapa
                </td>

                <td>
                  ```yaml
                  parameters:
                        myKey: myValue
                  ```
                </td>
              </tr>

              <tr>
                <td>
                  **idempotencyToken**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  UUID
                </td>

                <td>
                  `idempotencyToken: "any token"`

                  Isso será passado como token de cliente para idempotência, a fim de iniciar a automação do AWS SSM.
                </td>
              </tr>

              <tr>
                <td>
                  **seletores**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Lista
                </td>

                <td>
                  `[{\"name\": \"automationExecutionId\", \"expression\": \".automationExecutionId\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="startautomationoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de saída
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **sucesso**
                </td>

                <td>
                  Boleano
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **mensagem de erro**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * Na entrada de ação, se `awsAccessKeyId` e `awsSecretAccessKey` forem fornecidos, certifique-se de que sejam credenciais estáticas de um usuário IAM.
            * Se as credenciais da sessão forem usadas, `awsAccessKeyId`, `awsSecretAccessKey` e `awsSessionToken` devem ser passados para a entrada de ação.
            * Consulte as [credenciais da AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/) para obter instruções.
            * Utilize seletores para obter apenas o parâmetro especificado como saída.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="startautomationexample">
          <table>
            <thead>
              <tr>
                <th>
                  Definição de fluxo de trabalho
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.waitforautomationstatus" title="Aguarde o status da automação">
    Aguarda uma automação usando um documento da AWS. Consulte [a documentação do AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway) para obter mais informações.

    <Tabs>
      <TabsBar>
        <TabsBarItem id="automationstatusinputs">
          Entradas
        </TabsBarItem>

        <TabsBarItem id="automationstatusoutputs">
          Saídas
        </TabsBarItem>

        <TabsBarItem id="automationstatusexample">
          Exemplo
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="automationstatusinputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de entrada
                </th>

                <th>
                  Opcionalidade
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **região**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Obrigatório
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`

                  A automação 

                  `executionId`

                   para a qual precisamos aguardar sua conclusão.
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatuses**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Lista
                </td>

                <td>
                  `automationExecutionStatuses: ["status1", "status2"]`

                  Lista de status de execução de automação do [AutomationExecution](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_AutomationExecution.html#AutomationExecutionStatus) que podem interromper a espera.

                  Padrão: `["Success", "Failed"]`
                </td>
              </tr>

              <tr>
                <td>
                  **Tempo esgotado**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  int
                </td>

                <td>
                  `timeout: 180`(padrão), máximo 600.

                  A duração em segundos que podemos esperar para que o status da automação seja um dos esperados `automationExecutionStatuses`.

                  Se ocorrer um tempo limite, a saída conterá `success: false` e `errorMessag: Timeout waiting for automation status`.
                </td>
              </tr>

              <tr>
                <td>
                  **seletores**
                </td>

                <td>
                  Opcional
                </td>

                <td>
                  Lista
                </td>

                <td>
                  `[{\"name\": \"automationExecutionStatus\", \"expression\": \".automationExecutionStatus\"}, {\"name\": \"scriptOutput\", \"expression\": \".automationExecutionOutputs.pythonStep.scriptOutput | tojson\"}]`

                  .
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="automationstatusoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  Campo de saída
                </th>

                <th>
                  Tipo
                </th>

                <th>
                  Exemplo
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatus**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `automationExecutionStatus: "Success"`

                  Se a ação for bem-sucedida, ela retornará um dos valores passados no campo de entrada `automationExecutionStatuses`.

                  Caso contrário, será nulo.
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionOutputs**
                </td>

                <td>
                  Mapa
                </td>

                <td>
                  ```yaml
                  "automationExecutionOutputs": {
                        "ExecuteGetApiResources": {
                          "resultResourceId": [
                            "pky3cb"
                          ]
                        },
                        "ExecuteListVersionsByFunction": {
                          "resultLambdaVersionArn": [
                            "arn:aws:lambda:us-east-2:661945836867:function:ApiGwTestFn:1"
                          ]
                        }
                  } 
                  ```

                  O resultado será um mapa dos valores de saída do documento. Qualquer resultado presente no documento pode ser coletado usando este campo de saída e utilizado nas etapas subsequentes da definição de automação do fluxo de trabalho.
                </td>
              </tr>

              <tr>
                <td>
                  **sucesso**
                </td>

                <td>
                  Boleano
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **mensagem de erro**
                </td>

                <td>
                  Corda
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            1. No campo de entrada de ação, somente `awsAccessKeyId` e `awsSecretAccessKey` podem ser fornecidos, mas devem ser credenciais estáticas de um usuário IAM.
            2. Se as credenciais da sessão forem usadas, `awsAccessKeyId`, `awsSecretAccessKey` e `awsSessionToken` devem ser passados para a entrada de ação.
            3. Consulte as instruções para configurar [as credenciais da AWS](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials).
            4. Utilize seletores para obter apenas o parâmetro especificado como saída.
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="automationstatusexample">
          <table>
            <thead>
              <tr>
                <th>
                  Definição de fluxo de trabalho
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>