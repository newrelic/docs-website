---
title: Iniciar e agendar fluxo de trabalho
tags:
  - workflow automation
  - workflow
  - start a workflow automation
  - start workflow automation on demand
  - schedule workflows
metaDescription: Trigger workflows manually or schedule them to run automatically at specified times using NerdGraph APIs.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Depois de criar um fluxo de trabalho, você pode acioná-lo de três maneiras: por meio de alertas, manualmente sob demanda ou de acordo com um agendamento.

## Escolha seu método de ativação

Selecione a abordagem adequada para o seu caso de uso:

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        **Acionado por alertas**
      </th>

      <th>
        **Acionado por alertas**
      </th>

      <th>
        **Executar conforme o cronograma**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Resposta automatizada a incidentes
      </td>

      <td>
        Testando novo fluxo de trabalho
      </td>

      <td>
        Verificações regulares de saúde
      </td>
    </tr>

    <tr>
      <td>
        Correção automática (redimensionar EC2, reverter)
      </td>

      <td>
        Operações manuais
      </td>

      <td>
        Processamento periódico de dados
      </td>
    </tr>

    <tr>
      <td>
        Alerta enriquecido
      </td>

      <td>
        Manutenção ad hoc
      </td>

      <td>
        Relatórios diários ou semanais
      </td>
    </tr>

    <tr>
      <td>
        **Configuração**: [Configurar como destino de alerta](/docs/workflow-automation/setup-and-configuration/create-destinations#trigger-from-alerts)
      </td>

      <td>
        **API**: [IniciarExecuçãoDoFluxoDeTrabalho](/docs/workflow-automation/workflow-automation-apis/start-workflow-run)
      </td>

      <td>
        **API**: [CreateSchedule](/docs/workflow-automation/workflow-automation-apis/create-schedule)
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  Quando as condições de alerta são violadas, New Relic pode acionar automaticamente o fluxo de trabalho configurando a automação do fluxo de trabalho como destino. Os valores `issueId` e `accountId` são passados automaticamente. Consulte [Enviar notificação do fluxo de trabalho](/docs/workflow-automation/setup-and-configuration/create-destinations#trigger-from-alerts) para obter instruções de configuração.
</Callout>

## Antes de você começar

Antes de acionar o fluxo de trabalho, certifique-se de ter:

* **fluxo de trabalho criado**: Uma definição de fluxo de trabalho já implantada em sua conta a partir de [template](/docs/workflow-automation/create-a-workflow-automation/use-a-template) ou [customizada](/docs/workflow-automation/create-a-workflow-automation/create-your-own).
* **ID da conta**: Você pode encontrar o ID da sua conta New Relic nas [configurações da conta](/docs/accounts/accounts-billing/account-structure/account-id).
* **Nome do fluxo de trabalho**: O nome exato da sua definição de fluxo de trabalho.
* **Entradas obrigatórias**: Valores para qualquer parâmetro que seu fluxo de trabalho espera.
* **Segredos configurados**: credenciais AWS, token do Slack ou outros segredos armazenados no [gerenciador de segredos](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials).

<Callout variant="tip">
  **Novo no fluxo de trabalho?** Crie seu primeiro fluxo de trabalho antes de tentar acioná-lo. Comece com [Use um modelo](/docs/workflow-automation/create-a-workflow-automation/use-a-template) para fluxo de trabalho pré-construído.
</Callout>

## Execute o fluxo de trabalho sob demanda [#on-demand]

Acione o fluxo de trabalho manualmente usando a [APIStartWorkflowRun](/docs/workflow-automation/workflow-automation-apis/start-workflow-run). Isso executa o fluxo de trabalho imediatamente com as entradas que você fornecer.

### Exemplo: invocar uma função AWS do Lambda

A definição de fluxo de trabalho a seguir invoca uma função do Lambda da AWS e registra a saída. Substitua `12345678` pelo seu ID de conta New Relic.

```yaml
  name: lambda1

  workflowInputs:
    username:
      type: String
      defaultValue: "User"
    key:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_ACCESS_KEY_ID }}"
    access:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_SECRET_ACCESS_KEY }}"
    token:
      type: String
      defaultValue: "${{ :secrets:12345678:USERNAME_AWS_SESSION_TOKEN }}"
    region:
      type: String
      defaultValue: us-east-1

  steps:
    - name: invoke1
      type: action
      action: aws.lambda.invoke
      version: 1
      inputs:
        awsAccessKeyId: ${{ .workflowInputs.key }}
        awsSecretAccessKey: ${{ .workflowInputs.access }}
        awsSessionToken: ${{ .workflowInputs.token }}
        region: ${{ .workflowInputs.region }}
        functionName: hello-you
        payload:
          user: ${{ .workflowInputs.username }}

    - name: logOutput
      type: action
      action: newrelic.ingest.sendLogs
      version: 1
      inputs:
        logs:
          - message: 'The lambda function message output is:${{ .steps.invoke1.outputs.payload.body }}'
```

Para iniciar esse fluxo de trabalho, use a seguinte mutação do NerdGraph. Antes de executar esta mutação, certifique-se de ter armazenado suas credenciais da AWS usando a mutação `secretsManagementCreateSecret`. Para obter mais informações, consulte [o gerenciador de segredos](/docs/workflow-automation/limitations-and-faq/workflow-best-practices/#secure-credentials).

```yaml
  mutation {
    workflowAutomationStartWorkflowRun(
      # Specify the account where the workflow is defined
      scope: { type: ACCOUNT id: "12345678" }

      # Reference the workflow definition by name
      definition: { name: "lambda1" }

      # Provide input values for the workflow
      workflowInputs: [
        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
        {key: "region" value:"us-east-2"}
        {key: "username" value: "Julien"}
      ]
    ) {
      runId
    }
  }
```

**parâmetro explicado:**

* `scope`O ID da conta onde a definição do seu fluxo de trabalho está armazenada.
* `definition`: O nome do fluxo de trabalho a ser executado (deve corresponder ao campo `name` na definição do seu fluxo de trabalho)
* `workflowInputs`: pares de valores principais que substituem os valores padrão na seção `workflowInputs` da sua definição de fluxo de trabalho

A mutação retorna um `runId` (por exemplo, `7bd25287-2af8-42e1-b783-80f4e760a40b`). Utilize este ID para consultar os logs e visualizar a saída:

<img title="Workflow automation logs" alt="Workflow automation logs showing the Lambda function output" src="/images/autoflow-all-logs-2.webp" />

## Cronograma de fluxo de trabalho [#scheduled]

Programe fluxos de trabalho para serem executados automaticamente em horários específicos usando a [API CreateSchedule](/docs/workflow-automation/workflow-automation-apis/create-schedule). Fluxos de trabalho agendados executam tarefas recorrentes sem intervenção manual.

**Quando agendar fluxo de trabalho:**

* Verificações regulares de saúde
* Processamento periódico de dados
* Relatórios diários/semanais
* Janelas de manutenção programada
* Cópias de segurança ou limpezas recorrentes

### Referência de expressão Cron

Os agendamentos usam expressões cron para definir quando o fluxo de trabalho será executado. Formatar: `minute hour day month weekday`

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Padrão
      </th>

      <th>
        Descrição
      </th>

      <th>
        Exemplo de caso de uso
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `0 9 * * *`
      </td>

      <td>
        Todos os dias às 9h da manhã.
      </td>

      <td>
        Verificações diárias de saúde pela manhã
      </td>
    </tr>

    <tr>
      <td>
        `0 9 * * 1-5`
      </td>

      <td>
        Todos os dias da semana às 9h00.
      </td>

      <td>
        Operações do dia útil
      </td>
    </tr>

    <tr>
      <td>
        `0 */6 * * *`
      </td>

      <td>
        A cada 6 horas
      </td>

      <td>
        Operações de sincronização regulares
      </td>
    </tr>

    <tr>
      <td>
        `0 0 1 * *`
      </td>

      <td>
        Primeiro dia do mês à meia-noite
      </td>

      <td>
        Relatórios mensais
      </td>
    </tr>

    <tr>
      <td>
        `*/10 * * * *`
      </td>

      <td>
        A cada 10 minutos (intervalo mínimo)
      </td>

      <td>
        Sondagens frequentes, exames de saúde
      </td>
    </tr>

    <tr>
      <td>
        `0 0 * * 0`
      </td>

      <td>
        Todo domingo à meia-noite
      </td>

      <td>
        Tarefas de limpeza semanais
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="important">
  **Intervalo mínimo entre os horários:** Os horários devem ter um intervalo mínimo de 10 minutos. Não é possível programar o fluxo de trabalho para ser executado com uma frequência maior que a cada 10 minutos. Para intervalos inferiores a 10 minutos, considere agendar a cada 10 minutos e usar uma [etapa de espera](/docs/workflow-automation/workflow-automation-apis/definition-schema#wait) em seu fluxo de trabalho. Consulte [os limites do fluxo de trabalho](/docs/workflow-automation/limitations-and-faq/workflow-limits) para todas as restrições de agendamento.
</Callout>

<Callout variant="tip">
  **Sintaxe do Cron:** `*` significa `every`, `/` significa `every nth`, `-` significa `range`. Exemplo: `0 9 * * 1-5 = At minute 0, hour 9, every day, every month, Monday through Friday`.
</Callout>

### Exemplo: Agende uma verificação diária de saúde.

O exemplo a seguir agenda o fluxo de trabalho `lambda1` para ser executado todos os dias às 9h, horário do leste dos EUA:

```yaml
  mutation {
    workflowAutomationCreateSchedule(
      # Specify the account where the workflow is defined
      scope: { type: ACCOUNT id: "12345678" }

      # Reference the workflow definition by name
      definition: { name: "lambda1" }

      # Configure the schedule
      schedule: {
        # Cron expression: minute hour day month weekday
        # "0 9 * * *" = every day at 9:00 AM
        cronExpression: "0 9 * * *"

        # Timezone for the schedule
        timezone: "America/New_York"

        # Optional: Schedule name for identification
        name: "daily-lambda-health-check"

        # Optional: Add a description
        description: "Runs Lambda health check every morning at 9 AM"
      }

      # Provide input values for the workflow
      workflowInputs: [
        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
        {key: "region" value:"us-east-2"}
        {key: "username" value: "HealthCheckBot"}
      ]
    ) {
      scheduleId
    }
  }
```

**O que você recebe como resposta:** `scheduleId`, Identificador único para o agendamento (use isso para atualizar ou excluir o agendamento posteriormente)

### Solução alternativa: intervalos inferiores a 10 minutos

Se você precisar verificar algo com mais frequência do que a cada 10 minutos, programe seu fluxo de trabalho no intervalo mínimo de 10 minutos e use uma etapa de espera dentro da definição do fluxo de trabalho para criar um intervalo de sondagem adicional.

**Exemplo de fluxo de trabalho com sondagem a cada 5 minutos:**

```yaml
  name: frequent-health-check

  steps:
    # First check happens immediately when scheduled
    - name: firstCheck
      type: action
      action: newrelic.nrdb.query
      version: 1
      inputs:
        query: "FROM Transaction SELECT count(*) WHERE appName = 'MyApp' SINCE 5 minutes ago"

    # Wait 5 minutes
    - name: waitStep
      type: wait
      seconds: 300

    # Second check happens 5 minutes after the workflow started
    - name: secondCheck
      type: action
      action: newrelic.nrdb.query
      version: 1
      inputs:
        query: "FROM Transaction SELECT count(*) WHERE appName = 'MyApp' SINCE 5 minutes ago"
```

Agende este fluxo de trabalho para ser executado a cada 10 minutos usando `*/10 * * * *`. Isso permite realizar votações eficazes a cada 5 minutos:

* 0:00 - O fluxo de trabalho inicia e executa a primeira verificação.
* 0:05 - segunda verificação executada (após a etapa de espera)
* 0:10 - O próximo fluxo de trabalho agendado será iniciado e executado primeiro.
* 0:15 - segunda verificação executada (após a etapa de espera)

<Callout variant="tip">
  **limite de duração do fluxo de trabalho:** Lembre-se que o fluxo de trabalho tem duração máxima de 7 dias. Defina as etapas de espera e a frequência de sondagem de acordo com isso. Consulte [os limites do fluxo de trabalho](/docs/workflow-automation/limitations-and-faq/workflow-limits) para obter detalhes.
</Callout>

### Gerenciar agendas

Após criar um cronograma:

* **Veja os horários ativos**: Consulte todas as execuções agendadas no [dashboarddo fluxo de trabalho.](/docs/workflow-automation/create-a-workflow-automation/managing-workflow#monitor-runs)
* **Atualizar programação**: Use a API UpdateSchedule para alterar a frequência ou as entradas.
* **Excluir agendamento**: Use a API DeleteSchedule para interromper execuções recorrentes.

Para obter a documentação completa da API, consulte [APIs de Automação de Fluxo de Trabalho](/docs/workflow-automation/workflow-automation-apis/using-workflow-automation-api).

## Qual é o próximo

* **[Gerencie o workflow](/docs/workflow-automation/create-a-workflow-automation/managing-workflow)**: edite, duplique e monitore o histórico de execução.