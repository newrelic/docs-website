---
title: Criar condição de alerta NRQL
tags:
  - Alerts and applied intelligence
  - Alerts
  - Alert conditions
metaDescription: How to define thresholds that trigger alert notifications based on your NRQL queries.
freshnessValidatedDate: never
translationType: machine
---

import nr1NrqlAlertConditions from 'images/nr1_nrql_alert_conditions.webp'

import inContextDemo from 'images/in-context-demo.gif'

import signalLossUi0 from 'images/signal-loss-ui_0.webp'

import fineTuneSignals from 'images/fine-tune-signals.webp'

Você pode usar [a consulta NRQL](/docs/insights/new-relic-insights/using-new-relic-query-language/using-nrql) para criar condição do alerta. Depois de definir seu sinal, você poderá definir ainda mais seus níveis de aviso e limite crítico. Isso determina quando um incidente de alerta é criado.

Continue lendo para saber mais sobre como fazer isso.

<img
  title="An example NRQL condition and generated results."
  alt="A screenshot of an example NRQL condition and generated results."
  src={nr1NrqlAlertConditions}
/>

<figcaption>
  <DoNotTranslate>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Alerts & AI > Alert conditions (Policies) > (select a policy) > Add a condition**</DoNotTranslate>. Clique em <DoNotTranslate>**NRQL**</DoNotTranslate> e depois em <DoNotTranslate>**Next, define thresholds**</DoNotTranslate>.
</figcaption>

<Callout variant="tip">
  Para obter mais informações sobre os principais conceitos relacionados à condição do alerta NRQL e ao alerta de streaming, consulte [Alerta de streaming: termos e conceitos-chave](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts).
</Callout>

Pronto para começar? Se ainda não o fez, certifique-se de [se inscrever para uma conta New Relic](https://newrelic.com/signup). É grátis, para sempre.

## Crie uma condição de alerta NRQL [#create]

Para criar uma condição do alerta NRQL para uma política:

1. Vá para

   <DoNotTranslate>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Alerts & AI > Alert conditions (policies)**</DoNotTranslate>

   .

2. Selecione uma política existente ou clique em

   <DoNotTranslate>**New alert policy**</DoNotTranslate>

   para [criar uma nova política](/docs/alerts-applied-intelligence/new-relic-alerts/alert-policies/create-edit-or-find-alert-policy).

3. Clique em

   <DoNotTranslate>**Add a condition**</DoNotTranslate>

   .

4. Em

   <DoNotTranslate>**Select a product**</DoNotTranslate>

   clique em

   <DoNotTranslate>**NRQL**</DoNotTranslate>

   e depois clique em

   <DoNotTranslate>**Next, define thresholds**</DoNotTranslate>

   .

Observe que a edição de uma condição existente pode resultar na [redefinição de sua avaliação](#evaluation-resets).

## Crie uma condição a partir de um gráfico [#create-chart]

Você pode usar um gráfico para criar uma condição de alerta NRQL.

<img
  title="Create a NRQL alerts condition from a chart."
  alt="Animated GIF showing how to create a NRQL alerts condition from a chart."
  src={inContextDemo}
/>

<figcaption>
  Para criar uma condição do alerta NRQL a partir de um gráfico, clique no menu do gráfico <Icon name="fe-more-horizontal"/>e clique em <DoNotTranslate>**Create alert condition**</DoNotTranslate>.
</figcaption>

Depois de nomear e personalizar sua condição, você poderá adicioná-la a uma política existente ou criar uma nova.

<Callout variant="caution">
  Um pequeno número de nossos gráficos mais antigos não inclui a opção de criar uma condição do alerta.
</Callout>

## Sintaxe de alerta NRQL [#syntax]

Aqui está a sintaxe básica para criar todas as condições do alerta NRQL.

```
SELECT function(attribute)
	FROM Event
	WHERE attribute [comparison] [AND|OR ...]
```

<table>
  <thead>
    <tr>
      <th style={{ width: "300px" }}>
        <DoNotTranslate>
          **Clause**
        </DoNotTranslate>
      </th>

      <th>
        <DoNotTranslate>
          **Notes**
        </DoNotTranslate>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `SELECT function(attribute)`

        <DoNotTranslate>
          **Required**
        </DoNotTranslate>
      </td>

      <td>
        As funções suportadas que retornam números incluem:

        * `apdex`

        * `average`

        * `count`

        * `latest`

        * `max`

        * `min`

        * `percentage`

        * `percentile`

        * `sum`

        * `uniqueCount`

          <Callout variant="tip">
            Se você usar o agregador `percentile` em uma condição do alerta facetada com muitas facetas, isso poderá fazer com que o seguinte erro apareça:

            `An error occurred while fetching chart data.`

            Se você vir esse erro, use `average` .
          </Callout>
      </td>
    </tr>

    <tr>
      <td>
        `FROM data type`

        <DoNotTranslate>
          **Required**
        </DoNotTranslate>
      </td>

      <td>
        Apenas um tipo de dados pode ser destino.

        Tipos de dados suportados:

        * `Event`
        * `Metric` (Os pontos de dados RAW serão retornados)
      </td>
    </tr>

    <tr>
      <td>
        `WHERE attribute [comparison] [AND|OR ...]`
      </td>

      <td>
        Use a cláusula `WHERE` para especificar uma série de uma ou mais condições. Todos os [operadores](/docs/insights/new-relic-insights/using-new-relic-query-language/nrql-reference#where-operators) são suportados.
      </td>
    </tr>

    <tr>
      <td id="facet">
        `FACET` atributo
      </td>

      <td>
        Inclua uma cláusula `FACET` opcional na sintaxe NRQL dependendo do [tipo de limite](#threshold-types) (estático ou anomalia).

        Use a cláusula [`FACET`](/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions) para separar seus resultados por atributo e alertar cada atributo de forma independente. Nenhuma cláusula `LIMIT` é permitida, mas todas as consultas receberão o máximo de facetas possíveis.

        A consulta facetada pode retornar no máximo 5.000 valores para condições [estáticas e de anomalia](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#threshold-types) .

        <Callout variant="important">
          Se a consulta retornar mais que o número máximo de valores, a condição do alerta não poderá ser criada. Se você criar a condição e a consulta retornar mais que esse número posteriormente, o alerta falhará. Modifique sua consulta para que ela retorne um número menor de valores.
        </Callout>
      </td>
    </tr>
  </tbody>
</table>

## Reformatando NRQL incompatível [#reformatting]

Alguns elementos do NRQL usados nos gráficos não fazem sentido no contexto de streaming do alerta. Aqui está uma lista dos elementos incompatíveis mais comuns e sugestões para reformatar uma consulta de alerta NRQL para obter o mesmo efeito.

<table>
  <thead>
    <tr>
      <th style={{ width: "300px" }}>
        <DoNotTranslate>
          **Element**
        </DoNotTranslate>
      </th>

      <th>
        <DoNotTranslate>
          **Notes**
        </DoNotTranslate>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `SINCE` e `UNTIL`
      </td>

      <td>
        Exemplo:

        ```
        SELECT percentile(largestContentfulPaint, 75) FROM PageViewTiming WHERE (appId = 837807) SINCE yesterday
        ```

        As condições NRQL produzem um fluxo interminável de resultados de consulta em janela, portanto, as palavras-chave `SINCE` e `UNTIL` para definir o escopo da consulta até um momento específico não são compatíveis. Por conveniência, removemos automaticamente `SINCE` e `UNTIL` de uma consulta ao criar uma condição no contexto de um gráfico.
      </td>
    </tr>

    <tr>
      <td>
        `TIMESERIES`
      </td>

      <td>
        Na consulta NRQL, a cláusula `TIMESERIES` é usada para retornar dados como uma série temporal dividida por um período de tempo especificado.

        Para condições NRQL, a propriedade equivalente de um sinal é a janela de duração da agregação.
      </td>
    </tr>

    <tr>
      <td>
        `histogram()`
      </td>

      <td>
        A função de agregação `histogram()` é usada para gerar o histograma.

        `histogram()` não é compatível com alertas NRQL: as agregações do histograma não podem ser formatadas como uma série temporal. Para criar um alerta a partir de uma parte de um histograma (por exemplo, percentil 95), use a função de agregação [`percentile()`](/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions/#functions) .
      </td>
    </tr>

    <tr>
      <td>
        `bytecountestimate()`, `cardinality()`
      </td>

      <td>
        Estas funções ainda não são suportadas para alertas NRQL.
      </td>
    </tr>

    <tr>
      <td>
        Múltiplas funções de agregação
      </td>

      <td>
        Cada condição só pode destinar um único valor agregado. Para alertar sobre vários valores simultaneamente, será necessário decompô-los em condições individuais dentro da mesma política.

        Consulta original:

        ```
        SELECT count(foo), average(bar), max(baz) from Transaction
        ```

        Decomposto:

        ```
        SELECT count(foo) from Transaction

        SELECT average(bar) from Transaction

        SELECT max(baz) from Transaction
        ```
      </td>
    </tr>

    <tr>
      <td>
        `COMPARE WITH`
      </td>

      <td>
        A cláusula `COMPARE WITH` é usada para comparar os valores de dois intervalos de tempo diferentes. Este tipo de consulta é incompatível com alertas NRQL. Recomendamos usar uma [condição de alerta de anomalia](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-anomaly-alert-conditions) para detectar dinamicamente o Desvio para um sinal específico.
      </td>
    </tr>

    <tr>
      <td>
        `SLIDE BY`
      </td>

      <td>
        A cláusula `SLIDE BY` oferece suporte a um recurso conhecido como [janelas deslizantes](#sliding-window-aggregation). Com janelas deslizantes, `SLIDE BY` os dados são reunidos em "janelas" de tempo que se sobrepõem entre si. Essas janelas podem ajudar a suavizar gráficos de linha com muita variação nos casos em que o agregado móvel (como uma média móvel) é mais importante do que agregados de janelas estreitas de tempo.

        Você pode ativar janelas deslizantes na interface. Ao criar ou editar uma condição, vá para <DoNotTranslate>**Fine-tune advanced signal settings > Data aggregation settings > Use sliding window aggregation**</DoNotTranslate>.
      </td>
    </tr>

    <tr>
      <td>
        `LIMIT`
      </td>

      <td>
        Na consulta NRQL, a cláusula LIMIT é usada para controlar a quantidade de dados que uma consulta retorna, seja o número máximo de valores de faceta retornados pela consulta FACET ou o número máximo de itens retornados pela consulta SELECT \*.

        LIMIT não é compatível com alertas NRQL: a avaliação é sempre realizada no conjunto completo de resultados.
      </td>
    </tr>

    <tr>
      <td>
        Subconsultas
      </td>

      <td>
        [As subconsultas](/docs/query-your-data/nrql-new-relic-query-language/get-started/subqueries-in-nrql) não são compatíveis com alerta de streaming porque a execução da subconsulta requer múltiplas passagens pelos dados.
      </td>
    </tr>
  </tbody>
</table>

## Exemplos de limite de alerta NRQL [#examples]

Aqui estão alguns casos de uso comuns para condições NRQL. Estas consultas funcionarão para [tipos de condições](#threshold-types) estáticas e de anomalia.

<CollapserGroup>
  <Collapser
    id="constrained-alerts"
    title="Alerta sobre segmentos específicos de seus dados"
  >
    Crie <InlinePopover type="alerts"/>restritos que destinam um segmento específico dos seus dados, como alguns clientes principais ou um intervalo de dados. Use a cláusula `WHERE` para definir essas condições.

    ```
    SELECT average(duration) FROM Transaction WHERE account_id in (91290, 102021, 20230)
    ```

    ```
    SELECT percentile(duration, 95) FROM Transaction WHERE name LIKE 'Controller/checkout/%'
    ```
  </Collapser>

  <Collapser
    id="nth-percentile"
    title="Alerta sobre o enésimo percentil dos seus dados"
  >
    Crie um alerta quando um enésimo percentil de seus dados atingir um limite especificado; por exemplo, mantendo o nível de serviço do SLA. Como avaliamos a consulta NRQL com base na duração da janela de agregação, o percentil será calculado para cada duração separadamente.

    ```
    SELECT percentile(duration, 95) FROM Transaction
    ```

    ```
    SELECT percentile(databaseDuration, 75) FROM Transaction
    ```
  </Collapser>

  <Collapser
    id="max-min-avg"
    title="Alerta sobre máximo, mínimo, média de seus dados"
  >
    Crie alerta quando seus dados atingirem um determinado máximo, mínimo ou média; por exemplo, garantindo que uma duração ou tempo de resposta não ultrapasse um determinado limite.

    ```
    SELECT max(duration) FROM Transaction
    ```

    ```
    SELECT average(duration) FROM Transaction
    ```
  </Collapser>

  <Collapser
    id="percentage"
    title="Alerta sobre uma porcentagem dos seus dados"
  >
    Crie um alerta quando uma proporção dos seus dados estiver acima ou abaixo de um determinado limite.

    ```
    SELECT percentage(count(*), WHERE duration > 2) FROM Transaction
    ```

    ```
    SELECT percentage(count(*), WHERE http.statusCode = '500') FROM Transaction
    ```
  </Collapser>

  <Collapser
    id="apdex"
    title="Alerta no Apdex com qualquer valor T"
  >
    Crie alerta no [Apdex](/docs/apm/new-relic-apm/apdex/apdex-measuring-user-satisfaction), aplicando seu próprio valor T para determinada transação. Por exemplo, receba uma notificação de alerta quando seu Apdex para um valor T de 500 ms na transação para aplicativos de produção ficar abaixo de 0,8.

    ```
    SELECT apdex(duration, t:0.5) FROM Transaction WHERE appName like '%prod%'
    ```
  </Collapser>
</CollapserGroup>

## Condições NRQL e ordem de operações de consulta [#query-order]

Por padrão, a duração da janela de agregação é de 1 minuto, mas você pode alterar a janela de acordo com suas necessidades. Qualquer que seja a janela de agregação, o New Relic coletará dados para essa janela usando a função na consulta da condição NRQL. A consulta é analisada e executada por nossos sistemas na seguinte ordem:

1. `FROM` cláusula – qual tipo de evento precisa ser capturado?
2. `WHERE` cláusula – o que pode ser filtrado?
3. `SELECT` cláusula – quais informações precisam ser retornadas do conjunto de dados agora filtrado?

### Exemplo: valor nulo retornado [#example-null]

Digamos que esta seja a sua consulta de condição de alerta:

```
SELECT count(*) FROM SyntheticCheck WHERE monitorName = 'My Cool Monitor' AND result = 'FAILURE'
```

Se não houver falhas na janela de agregação:

1. O sistema executará a cláusula `FROM` capturando todos os eventos `SyntheticCheck` da sua conta.
2. Em seguida, ele executará a cláusula `WHERE` para filtrar esses eventos, procurando apenas aqueles que correspondem ao nome do monitor e ao resultado especificado.
3. Se ainda houver eventos para verificar após a conclusão das operações `FROM` e `WHERE` , a cláusula `SELECT` será executada. Se não houver nenhum evento restante, a cláusula `SELECT` não será executada.

Isso significa que agregadores como `count()` e `uniqueCount()` nunca retornarão um valor zero. Quando há uma contagem de 0, a cláusula `SELECT` é ignorada e nenhum dado é retornado, resultando em um valor de `NULL`.

### Exemplo: valor zero retornado [#example-zero]

Se você tiver uma fonte de dados que fornece zeros numéricos legítimos, a consulta retornará valores zero e não valores nulos.

Digamos que esta seja sua consulta de condição do alerta e que `MyCoolEvent` seja um atributo que às vezes pode retornar um valor zero.

```
SELECT average(MyCoolAttribute) FROM MyCoolEvent
```

Se, na janela de agregação que está sendo avaliada, houver pelo menos uma instância de `MyCoolEvent` e se o valor médio de todos os atributos `MyCoolAttribute` dessa janela for igual a zero, então será retornado um valor `0` . Se não houver nenhum evento `MyCoolEvent` durante esse minuto, então um `NULL` será retornado devido à ordem das operações.

### Exemplo: valor nulo vs. valor zero retornado [#example-null-zero]

Para determinar como os valores nulos serão tratados, ajuste as configurações de perda de sinal e preenchimento de lacunas na [condição do alerta interface](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-nrql-alert-conditions/#signal-loss).

Você pode evitar valores `NULL` totalmente com um atalho de ordem de consulta de operações. Para fazer isso, use uma subcláusula `filter` e inclua todos os elementos de filtro dentro dessa subcláusula. O corpo principal da consulta será executado e retornará dados. Nesse ponto, a cláusula `SELECT` será executada e aplicará os elementos de filtro. A consulta retornará um valor `0` se os elementos do filtro não resultarem em dados correspondentes. Aqui está um exemplo:

```
SELECT filter(count(*), WHERE result = 'SUCCESS' AND monitorName = 'My Favorite Monitor') FROM SyntheticCheck
```

Para obter mais informações, confira nossa [postagem no blog](https://discuss.newrelic.com/t/relic-solution-how-can-i-figure-out-when-to-use-gap-filling-and-loss-of-signal/120401) sobre resolução de problemas para valores zero versus valores nulos.

## Alerta NRQL de agregação aninhada [#h2-nested-aggregation-nrql-alerts]

[As consultas de agregação aninhadas](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/nested-aggregation-make-ordered-computations-single-query) são uma forma poderosa de consultar seus dados. No entanto, eles têm algumas restrições que é importante observar.

<CollapserGroup>
  <Collapser
    id="non-faceted_innermost_query"
    title="Consultas aninhadas com uma consulta interna não facetada não são suportadas atualmente"
  >
    Sem `FACET`, a consulta interna produz um único resultado, não fornecendo nada para agregar à consulta externa. Se você estiver usando uma consulta aninhada, certifique-se de que sua consulta interna esteja facetada.

    ```
    SELECT max(cpu) FROM (FROM SystemSample SELECT min(cpuPercent) as 'cpu' FACET hostname) ​​​​​
    ```
  </Collapser>

  <Collapser
    id="aggregation_window_size"
    title="Consulta em todos os níveis deve ter o mesmo tamanho de janela de agregação"
  >
    Com uma janela de agregação de alerta de 1 minuto, a consulta interna produziria duas janelas menores de 30 segundos. Em teoria, essas duas janelas poderiam ser agregadas pela consulta externa. No entanto, isso não é suportado atualmente.

    ```
    SELECT max(cpu) FROM (FROM Event SELECT min(cpuTime) as cpu TIMESERIES 30 seconds)​​
    ```
  </Collapser>

  <Collapser
    id="signal_loss"
    title="A perda de sinal ainda não é compatível com consultas aninhadas"
  >
    Para obter mais informações sobre perda de sinal, consulte [API NerdGraph: Perda de sinal e preenchimento de lacunas](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling).
  </Collapser>

  <Collapser
    id="with_metric_format"
    title="Consultas aninhadas sobre dados de métrica de fração de tempo não são suportadas atualmente"
  >
    A consulta aninhada para [métrica de fração de tempo](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data) não é suportada. Mais especificamente, estes termos não são permitidos na consulta interna do NRQL condição do alerta:

    * `WITH METRIC_FORMAT`
    * `metricTimesliceName`
    * `keyset`, `uniques`, `nativesizeestimate` ou `bytecountestimate` chamado no tipo `Metric`
    * `newrelic.timeslice.value`
    * `apm.service.*`, `apm.browser.*` , `apm.mobile.*`, `apm.key.transaction.*`
  </Collapser>
</CollapserGroup>

## Dicas de criação de condição NRQL [#condition-tips]

Aqui estão algumas dicas para criar e usar uma condição NRQL:

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Tema
      </th>

      <th>
        Pontas
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Tipos de condição
      </td>

      <td>
        Os tipos de condição NRQL incluem [estática e anomalia](#threshold-types).
      </td>
    </tr>

    <tr>
      <td>
        Crie uma descrição
      </td>

      <td>
        Para condições NRQL, você pode criar uma [descrição](/docs/alerts/new-relic-alerts/defining-conditions/alert-condition-descriptions) personalizada para adicionar a cada incidente. As descrições podem ser aprimoradas com substituição de variáveis com base em metadados no incidente específico.

        Para obter detalhes, consulte [Descrição](/docs/alerts/new-relic-alerts/defining-conditions/alert-condition-descriptions)
      </td>
    </tr>

    <tr>
      <td>
        Resultados da consulta
      </td>

      <td>
        Consulta deve retornar um número. A condição avalia o número retornado em relação ao limite que você definiu.
      </td>
    </tr>

    <tr>
      <td>
        Período de tempo
      </td>

      <td>
        As condições NRQL avaliam os dados com base em como eles são agregados, usando janelas de agregação de 30 segundos a 6 horas, em incrementos de 15 segundos. Para obter melhores resultados, recomendamos usar os métodos de agregação de fluxo de eventos ou temporizador de eventos.

        Para o método de agregação de cadência, a cláusula `SINCE ... UNTIL` implícita que especifica qual minuto avaliar é controlada pela configuração [<DoNotTranslate>**delay/timer**</DoNotTranslate>](#time) . Como os dados muito recentes podem estar incompletos, você pode querer consultar os dados de 3 minutos atrás ou mais, especialmente para:

        * Aplicativo que é executado em vários hosts.

        * `SyntheticCheck` dados: os tempos limite podem levar 3 minutos, portanto, 5 minutos ou mais são recomendados.

          Além disso, se uma consulta gerar dados intermitentes, considere usar a opção de sinal avançado [`slide by`](#sliding-window-aggregation) .
      </td>
    </tr>

    <tr>
      <td>
        Limite de sinal perdido (perda de detecção de sinal)
      </td>

      <td>
        Você pode usar a detecção de perda de sinal para alertar quando seus dados (um sinal de telemetria) devem ser considerados perdidos. Uma perda de sinal pode indicar que um serviço ou entidade não está mais online ou que um trabalho periódico falhou na execução. Você também pode usar isso para garantir que os incidentes de dados esporádicos, como contagens de erros, sejam fechados quando nenhum sinal estiver chegando.
      </td>
    </tr>

    <tr>
      <td>
        Configurações avançadas de sinal
      </td>

      <td>
        Essas configurações oferecem opções para lidar melhor com sinais de dados de streaming contínuos que às vezes podem estar faltando. Essas configurações incluem a duração da janela de agregação, o atraso/temporizador e uma opção para preencher lacunas de dados. Para obter mais informações sobre como usá-los, consulte [Configurações avançadas de sinal](#advanced-signal).
      </td>
    </tr>

    <tr>
      <td>
        Configurações de condição
      </td>

      <td>
        Use <DoNotTranslate>**Condition settings**</DoNotTranslate> para:

        * Crie um [nome de condição](/docs/alerts/new-relic-alerts/configuring-alert-policies/define-alert-conditions#rename-condition) conciso e descritivo.
        * Forneça uma [descrição personalizada do incidente para a condição](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/alert-custom-incident-descriptions) que será incluída nos incidentes e na notificação.
        * Adicione a URL do runbook para incluir os procedimentos da sua organização para lidar com incidentes. Você também pode adicionar essas informações à [descrição personalizada do incidente](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/alert-custom-incident-descriptions).
      </td>
    </tr>

    <tr>
      <td>
        Limites de condições
      </td>

      <td>
        Veja os [valores máximos](/docs/alerts/new-relic-alerts/getting-started/minimum-maximum-values).
      </td>
    </tr>

    <tr>
      <td>
        Estado de saúde
      </td>

      <td>
        Para que uma condição de alerta [status de saúde](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/view-entity-health-status-find-entities-without-alert-conditions) do NRQL funcione corretamente, a consulta deve ter como escopo uma única entidade. Para fazer isso, use uma cláusula WHERE (por exemplo, `WHERE appName = 'MyFavoriteApp'`) ou uma cláusula FACET para definir o escopo de cada sinal para uma única entidade (por exemplo, `FACET hostname` ou `FACET appName`).
      </td>
    </tr>

    <tr>
      <td>
        Exemplos
      </td>

      <td>
        Para mais informações, veja:

        * [Sintaxe NRQL esperada](#syntax)
        * [Exemplos de consulta de condição NRQL](#examples)
      </td>
    </tr>
  </tbody>
</table>

## Gerenciando tags em condições [#condition-edit]

Ao editar uma condição NRQL existente, você tem a opção de adicionar ou remover a tag associada à entidade da condição. Para fazer isso, clique no botão <DoNotTranslate>**Manage tags**</DoNotTranslate> abaixo do nome da condição. No menu que aparece, adicione ou exclua uma tag.

## As edições de condições podem redefinir a avaliação de condições [#evaluation-resets]

Ao editar a condição do alerta do NRQL de algumas maneiras específicas (detalhadas abaixo), suas avaliações são redefinidas, o que significa que qualquer avaliação até esse ponto é perdida e a avaliação recomeça a partir desse ponto. As duas maneiras pelas quais isso afetará você são:

* Para o limite "por pelo menos x minutos": como a janela de avaliação foi redefinida, haverá um atraso de pelo menos x minutos antes que qualquer incidente possa ser relatado.
* Para [condições de anomalia](#threshold-types): a condição recomeça e todo o aprendizado da anomalia é perdido.

As ações a seguir causam uma redefinição de avaliação para condições NRQL:

* Alterando a consulta
* Alterar a janela de agregação, o método de agregação ou a configuração de atraso/temporizador de agregação
* Alterando a configuração "Adicionar limite de sinal perdido"
* Alterando quaisquer configurações de preenchimento de lacuna
* Alterar a direção da anomalia (se aplicável) – superior, inferior ou superior/inferior
* Alterar o valor limite, a janela limite ou o operador limite
* Alterar o intervalo de deslizamento (somente em condições [de agregação de janelas deslizantes](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-nrql-alert-conditions/#sliding-window-aggregation) )

As seguintes ações (juntamente com quaisquer outras ações não incluídas na lista acima) **não** redefinirão a avaliação:

* Alteração da janela de tempo de perda de sinal (duração da expiração)

* Alterando a função de tempo (alterando

  <DoNotTranslate>**for at least**</DoNotTranslate>

  para

  <DoNotTranslate>**at least once in**</DoNotTranslate>

  ou vice-versa)

* Configurando o

  <DoNotTranslate>**Add lost signal threshold**</DoNotTranslate>

  .

## Condição do alerta tipos [#threshold-types]

Ao criar um alerta NRQL, você pode escolher entre diferentes tipos de condições:

<table>
  <thead>
    <tr>
      <th style={{ width: "150px" }}>
        Condição NRQL dos tipos de alerta
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Estático
      </td>

      <td>
        Este é o tipo mais simples de condição NRQL. Ele permite criar uma condição baseada em uma consulta NRQL que retorna um valor numérico.

        Opcional: inclua uma cláusula `FACET` .
      </td>
    </tr>

    <tr>
      <td>
        [anomalia](/docs/alerts/new-relic-alerts/defining-conditions/create-anomaly-alert-conditions) (anomalia dinâmica)
      </td>

      <td>
        Usa uma condição autoajustável com base no comportamento anterior dos valores do monitor. Usa o mesmo formulário de consulta NRQL que o tipo estático, incluindo a cláusula opcional `FACET` .
      </td>
    </tr>
  </tbody>
</table>

## Defina o limite de perda de sinal [#signal-loss]

<Callout variant="important">
  O recurso de perda de sinal requer que um sinal esteja presente antes de poder detectar que o sinal foi perdido. Se você ativar uma condição enquanto um sinal não estiver presente, nenhuma perda de sinal será detectada e o recurso de perda de sinal não será ativado.
</Callout>

A perda de sinal ocorre quando nenhum dado corresponde à condição NRQL durante um período específico de tempo. Você pode definir a duração do limite de perda de sinal e também o que acontece quando o limite é ultrapassado.

<img
  title="signal-loss-ui.png"
  alt="signal-loss-ui.png"
  src={signalLossUi0}
/>

<figcaption>
  Vá para <DoNotTranslate>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Alerts & AI > Alert conditions (Policies) > (select a policy)**</DoNotTranslate> e depois <DoNotTranslate>**Add a condition**</DoNotTranslate>. A perda de sinal está disponível apenas para condições NRQL.
</figcaption>

Você também pode gerenciar essas configurações usando a API GraphQL (recomendado) ou a API REST. Clique aqui para obter [exemplos específicos da API GraphQL](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling).

<DoNotTranslate>
  **Loss of signal settings:**
</DoNotTranslate>

As configurações de perda de sinal incluem uma duração de tempo e duas ações possíveis.

* <DoNotTranslate>
    **Signal loss expiration time**
  </DoNotTranslate>

  * Rótulo de interface:

    <DoNotTranslate>**Signal is lost after:**</DoNotTranslate>

  * Nó GraphQL: [expiration.expirationDuration](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling)

  * A duração da expiração é um temporizador que inicia e reinicia quando recebemos um ponto de dados no pipeline de alerta de streaming. Se não recebermos outro ponto de dados antes que o seu 'tempo de expiração' expire, consideramos que o sinal foi perdido. Isso pode ocorrer porque nenhum dado está sendo enviado para o New Relic ou a cláusula `WHERE` da sua consulta NRQL está filtrando esses dados antes de serem transmitidos para o pipeline de alerta. Observe que quando você tem uma consulta facetada, cada faceta é um sinal. Portanto, se qualquer um desses sinais terminar durante o período especificado, isso será considerado uma perda de sinal.

  * O tempo de expiração da perda do sinal é independente da duração do limite e é acionado assim que o temporizador expira.

  * A duração máxima de expiração é de 48 horas. Isto é útil no monitoramento para a execução de trabalhos pouco frequentes. O mínimo é 30 segundos, mas recomendamos usar pelo menos 3 a 5 minutos.

* <DoNotTranslate>
    **Loss of signal actions**
  </DoNotTranslate>

  Depois que um sinal for considerado perdido, você poderá fechar o incidente aberto, abrir o novo incidente ou ambos.

  * Fechar todos os incidentes abertos atuais: Fecha todos os incidentes abertos relacionados a um sinal específico. Não fechará necessariamente todos os incidentes de uma condição. Se você estiver alertando sobre um serviço efêmero ou sobre um sinal esporádico, escolha esta ação para garantir que os incidentes sejam fechados corretamente. O nome do nó GraphQL para isso é ["closeViolationsOnExpiration](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling)"
  * Abrir novos incidentes: abrirá um novo incidente quando o sinal for considerado perdido. Esses incidentes indicarão que são devidos a perda de sinal. Com base nas suas preferências de incidente, isso deverá acionar uma notificação. O nome do nó graphQL para isso [é "openViolationOnExpiration](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling)"
  * Quando você habilita ambas as ações, fecharemos primeiro todos os incidentes abertos e depois abriremos um novo incidente por perda de sinal.

Para criar um alerta NRQL configurado com detecção de perda de sinal na interface:

1. Para uma política, ao criar uma condição, em

   <DoNotTranslate>**Select a product**</DoNotTranslate>

   , clique em

   <DoNotTranslate>**NRQL**</DoNotTranslate>

   e em

   <DoNotTranslate>**Next, define thresholds**</DoNotTranslate>

   .

2. Escreva uma [consulta NRQL](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#syntax) que retorne os valores sobre os quais você deseja alertar.

3. Para

   <DoNotTranslate>**Threshold type**</DoNotTranslate>

   , selecione

   <DoNotTranslate>**Static**</DoNotTranslate>

   ou

   <DoNotTranslate>**Anomaly**</DoNotTranslate>

   .

4. Clique em

   <DoNotTranslate>**+ Add lost signal threshold**</DoNotTranslate>

   e defina o tempo de expiração do sinal em minutos ou segundos no campo

   <DoNotTranslate>**Signal is lost after**</DoNotTranslate>

   .

5. Escolha o que você deseja que aconteça quando o sinal for perdido. Você pode verificar um ou ambos

   <DoNotTranslate>**Close all current open incidents**</DoNotTranslate>

   e

   <DoNotTranslate>**Open new "lost signal" incident**</DoNotTranslate>

   . Eles controlam como o incidente de perda de sinal será tratado para a condição.

6. Certifique-se de nomear sua condição antes de salvá-la.

Incidente aberto por perda de sinal de fechamento quando:

* o sinal volta. O incidente de sinal perdido recém-aberto será fechado imediatamente quando novos dados forem avaliados.

* a condição a que pertencem expira. Por padrão, as condições expiram após 3 dias.

* você fecha manualmente o incidente com a opção

  <DoNotTranslate>**Close all current open incidents**</DoNotTranslate>

  .

<Callout variant="tip">
  A detecção de perda de sinal não funciona em consultas NRQL que usam agregação aninhada ou subconsulta.
</Callout>

## Configurações avançadas de sinal [#advanced-signal]

<img
  title="Screenshot showing advanced signal settings"
  alt="Screenshot showing advanced signal settings"
  src={fineTuneSignals}
/>

<figcaption>
  Ao criar uma condição de alerta NRQL, use as configurações avançadas de sinal para controlar [o streaming de dados de alerta](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts) e evitar alarmes falsos.
</figcaption>

Ao criar uma condição NRQL, existem várias configurações avançadas de sinal:

* Duração da janela de agregação
* Agregação de janela deslizante
* Método de streaming
* Atraso/temporizador
* Preencha lacunas de dados

Para ler uma explicação sobre o que são essas configurações e como elas se relacionam entre si, consulte [Conceitos de alerta de streaming](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts). Abaixo estão instruções e dicas sobre como configurá-los.

### Duração da janela de agregação [#window-duration]

Você pode definir a [duração da janela de agregação](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts#aggregation-window) para escolher por quanto tempo os dados serão acumulados em uma janela de tempo de streaming antes de serem agregados. Você pode configurá-lo para qualquer coisa entre 30 segundos e 120 minutos. O padrão é um minuto.

### Agregação de janela deslizante [#sliding-window-aggregation]

Você pode usar [janelas deslizantes](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/create-smoother-charts-sliding-windows) para criar gráficos mais suaves. Isso é feito criando janelas de dados sobrepostas.

Aprenda como configurar janelas deslizantes neste pequeno vídeo (2:30 minutos):

<Video
  id="-5--8DZynFE"
  type="youtube"
/>

Uma vez ativado, defina o "intervalo de deslizamento" para controlar quanto tempo de sobreposição suas janelas agregadas têm. O intervalo deve ser menor que a janela de agregação e, ao mesmo tempo, dividir-se igualmente nela.

<Callout variant="important">
  Imediatamente após você criar uma nova janela deslizante condição do alerta ou executar qualquer ação que possa causar uma [redefinição de avaliação](#evaluation-resets), sua condição precisará de tempo para criar um "buffer agregado" durante a primeira janela de agregação. Durante esse período, nenhum incidente será desencadeado. Depois que essa única janela de agregação tiver passado, um "buffer" completo terá sido construído e a condição funcionará normalmente.
</Callout>

### Método de streaming [#streaming]

Escolha entre [três métodos de agregação de streaming](/docs/alerts-applied-intelligence/new-relic-alerts/advanced-alerts/understand-technical-concepts/streaming-alerts-key-terms-concepts/#aggregation-methods) para obter os melhores resultados de avaliação para suas condições.

### Atraso/temporizador [#delay-timer]

Você pode ajustar o [atraso/temporizador](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts#delay-timer) para coordenar [nosso algoritmo de alerta de streaming](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/streaming-alerts-key-terms-concepts) com o comportamento dos seus dados. Se seus dados forem esparsos ou inconsistentes, você pode usar o método de agregação de temporizador de evento.

Para o método de cadência, a latência total suportada é a soma da duração da janela de agregação e do atraso.

Se o tipo de dados vier de um [agente de linguagem APM](/docs/apm/new-relic-apm/getting-started/introduction-apm) e for agregado de muitas instâncias de aplicativo (por exemplo, `Transactions`, `TransactionErrors` etc.), recomendamos usar o método de fluxo de eventos com as configurações padrão.

<Callout variant="important">
  Ao criar condições NRQL para dados coletados de [infraestrutura de integração na nuvem,](/docs/infrastructure/infrastructure-integrations/get-started/introduction-infrastructure-integrations) como AWS CloudWatch ou Azure, recomendamos que você use o método de timer de evento.
</Callout>

### Preencha lacunas de dados [#data-gaps]

O preenchimento de lacunas permite personalizar os valores a serem usados quando seus sinais não possuem dados. Você pode preencher lacunas em seus fluxos de dados com uma destas configurações:

* <DoNotTranslate>**None**</DoNotTranslate>

  : (Padrão) Escolha esta opção se não quiser realizar nenhuma ação em janelas de agregação vazias. Na avaliação, uma janela de agregação vazia redefinirá o temporizador de duração limite. Por exemplo, se uma condição disser que todas as janelas de agregação devem ter pontos de dados acima do limite durante 5 minutos, e 1 das 5 janelas de agregação estiver vazia, então a condição não abrirá um incidente.

* <DoNotTranslate>**Custom static value**</DoNotTranslate>

  : escolha esta opção se desejar inserir um valor estático personalizado nas janelas de agregação vazias antes de serem avaliadas. Esta opção tem um parâmetro adicional obrigatório de `fillValue` (conforme nomeado na API) que especifica qual valor estático deve ser usado. O padrão é `0`.

* <DoNotTranslate>**Last known value**</DoNotTranslate>

  : esta opção insere o último valor visto antes da avaliação ocorrer. Mantemos o estado do último valor visto por 2 horas.

<Callout variant="tip">
  O sistema de alerta preenche lacunas nos sinais reportados ativamente. Este histórico de sinal é eliminado após 2 horas de inatividade. Para preencher lacunas, os pontos de dados recebidos após este período de inatividade são tratados como novos sinais.

  Para saber mais sobre perda de sinal, preenchimento de lacunas e como solicitar acesso a esses recursos, veja [este post do Fórum de Suporte](https://discuss.newrelic.com/t/announcing-new-relic-one-streaming-alerts-for-nrql-conditions/115361).
</Callout>

Opções para editar configurações de lacuna de dados:

* Na interface das condições NRQL, acesse

  <DoNotTranslate>**Condition settings > Advanced signal settings > fill data gaps with**</DoNotTranslate>

  e escolha uma opção.

* Se estiver usando nossa [API Nerdgraph](/docs/alerts-applied-intelligence/new-relic-alerts/alerts-nerdgraph/nerdgraph-api-loss-signal-gap-filling) (preferencial), este nó está localizado em: `actor : account : alerts : nrqlCondition : signal : fillOption | fillValue`

* NerdGraph é nossa API recomendada para isso, mas se você estiver usando nossa API REST, poderá encontrar essa configuração no explorador da API REST na seção

  <DoNotTranslate>**"signal"**</DoNotTranslate>

  [da API de condições NRQL de alerta](https://rpm.newrelic.com/api/explore/alerts_nrql_conditions/list).