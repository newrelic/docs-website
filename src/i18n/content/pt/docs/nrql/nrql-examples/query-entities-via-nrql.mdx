---
title: exemplos de entidade e relacionamentos via NRQL (E&R via NRQL)
metaDescription: Examples of NRQL queries for entities & relationships
freshnessValidatedDate: '2024-03-19T00:00:00.000Z'
translationType: machine
---

Simplifique a análise do seu sistema usando a linguagem New Relic Consulta (NRQL) para consultar diretamente dados de entidades e relacionamentos. Essa abordagem substitui processos manuais complexos para tarefas cruciais, como correlacionar o desempenho da CPU com atributos do host, visualizar estados anteriores de entidades ou rastrear alterações de configuração, oferecendo insights mais rápidos sobre seus ambientes complexos.

Para consultar esses dados, você precisará de computação avançada; use o tipo de evento entidade (e Relacionamentos ou entityRelationships para consultas específicas de relacionamento).

<Callout variant="tip">
  Está começando a usar consultas a entidades e relacionamentos com NRQL? Antes de explorar esses exemplos, aprenda sobre os [conceitos e benefícios de E&amp;R por meio do NRQL](/docs/nrql/get-started/query-entities-and-relationships-via-nrql).
</Callout>

Explore as soluções práticas de NRQL abaixo para te ajudar:

<CollapserGroup>
  <Collapser id="total-tx" title="Correlacionar o uso da CPU com o atributo do host">
    * **Objetivo**: Uma equipe de operações precisa analisar a utilização da CPU de todos os hosts de produção localizados em uma região específica AWS (por exemplo, &apos;eu-central-1&apos;) para identificar possíveis gargalos de desempenho.
    * **Desafio**: Isso frequentemente exigia a exportação separada dos dados do host e das métricas de desempenho, seguida da utilização de ferramentas externas ou scripts complexos para combiná-los e analisá-los.
    * **Solução NRQL**:

    ```sql
    FROM SystemSample
    JOIN (FROM Entity SELECT id, name WHERE type = 'INFRA-HOST' AND `tags.aws.awsRegion` = 'eu-central-1')
    ON entityGuid = id
    SELECT average(cpuPercent) FACET name
    ```
  </Collapser>

  <Collapser id="total-tx" title="Visualizar o estado da entidade em um ponto específico no tempo.">
    * **Objetivo**: Um desenvolvedor está investigando um incidente ocorrido há várias horas e precisa saber a configuração ou o estado exato de um host específico (ou contêiner, aplicativo etc.) naquele momento específico.

    * **Desafio**: Obter um instantâneo de um atributo de uma entidade em um período específico do passado muitas vezes não era possível ou exigia vasculhar volumosos logs de configuração, quando disponíveis.

    * **SoluçãoNRQL **: Esta consulta recupera todos os atributos disponíveis para uma entidade específica (identificada pelo seu ID) dentro de um intervalo de uma hora, a partir de sete horas atrás.

    ```sql
    FROM Entity
    SELECT *
    WHERE id = '<your_entity_id>'
    SINCE 7 hours ago UNTIL 6 hours ago
    LIMIT 1
    ```
  </Collapser>

  <Collapser id="total-tx" title="Rastreamento de mudanças no estado da entidade">
    * **Objetivo**: Um SRE deseja entender como a configuração ou os atributos-chave de uma entidade mudaram nas últimas horas, talvez para verificar se uma implantação ou um processo automatizado alterou seu estado conforme o esperado.

    * **Desafio**: Rastrear mudanças sutis no estado de uma entidade ao longo do tempo era difícil e frequentemente envolvia comparações manuais ou scripts de monitoramento personalizados.

    * **Solução NRQL**: Esta consulta recupera todos os estados registrados para uma determinada entidade nas últimas três horas, permitindo uma auditoria de quaisquer alterações.

    ```sql
      SELECT *
      FROM Entity
      WHERE id = '<your_entity_id>'
      SINCE 3 hours ago
    ```
  </Collapser>

  <Collapser id="total-tx" title="Encontrando aplicativos relacionados a anfitriões">
    * **Objetivo**: Identificar os aplicativos em execução em hosts específicos.

    * **Desafio**: Dificuldade em correlacionar o aplicativo aos hosts

    * **Solução NRQL**:

    ```sql
    FROM EntityRelationship SELECT sourceEntityGuid, targetEntityGuid, sourceEntityType, targetEntityType, relationshipType   where (sourceEntityType like '%HOST%' and targetEntityType='APPLICATION') or (targetEntityType LIKE '%HOST%' and sourceEntityType='APPLICATION')
    ```
  </Collapser>
</CollapserGroup>