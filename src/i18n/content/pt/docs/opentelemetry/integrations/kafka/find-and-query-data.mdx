---
title: Encontre e consulte dados do Kafka no New Relic
tags:
  - Integrations
  - OpenTelemetry
  - Kafka
  - Query data
metaDescription: Learn how to find your Kafka metrics in New Relic UI and write NRQL queries to analyze your data.
freshnessValidatedDate: never
translationType: machine
---

Depois que o monitoramento do Kafka for configurado com o OpenTelemetry, suas métricas aparecerão em vários locais no New Relic. Este guia mostra onde encontrar seus dados e como consultá-los de forma eficaz.

## Navegue para seus dados do Kafka [#find-data]

Suas métricas do Kafka aparecem em vários lugares na plataforma New Relic, cada um otimizado para diferentes casos de uso:

### 1. Explorador de entidades

Ideal para: Verificações rápidas de integridade e relacionamentos de entidades

1. Vá para <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; On host integrations**</DNT>
2. Visualize os tipos de entidade de broker, cluster e tópicos do Kafka

<img title="OTel Kafka Entity Explorer" alt="Entity explorer showing Kafka broker, cluster, and topics entity types" src="/images/otel-kafka-entityexplorer.webp" />

### 2. Filas e Streams

Ideal para: Monitoramento focado em fila de mensagens

1. Vá para <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; All capabilities &gt; Queues &amp; Streams**</DNT>
2. Filtre por `provider=opentelemetry` e clique na linha da conta onde você instrumentou o Kafka para visualizar seus dados

<img title="OTel Kafka Queues & Streams" alt="Queues & Streams view showing Kafka data filtered by OpenTelemetry provider" src="/images/otel-kafka-queues-streams.webp" />

/\* ### 3. Serviços de terceiros Melhor para: monitoramento focado em integração 1. Acesse &lt;DNT&gt;\*\*\[one.newrelic.com]\(https\://one.newrelic.com) &gt; All capabilities &gt; Infrastructure &gt; Third-party services\*\*&lt;/DNT&gt; 2. Selecione &lt;DNT&gt;\*\*Kafka (OpenTelemetry)\*\*&lt;/DNT&gt; &gt; &lt;DNT&gt;\*\*OpenTelemetry Kafka\*\*&lt;/DNT&gt; &lt;img title=&quot;Serviços de terceiros do Kafka OTel&quot; alt=&quot;Visualização de serviços de terceiros mostrando a integração do Kafka (OpenTelemetry)&quot; src=&quot;/images/infrastructure\_screenshot-crop\_otel-kafka-third-party-integrations.webp&quot; /&gt; \*/

### 3. Dashboards pré-construídos

Ideal para: Monitoramento e visualização abrangentes

1. Vá para <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Dashboards &gt; Recommended dashboards (View all)**</DNT>
2. Pesquisar por <DNT>**&quot;OpenTelemetry Kafka&quot;**</DNT>

<img title="OpenTelemetry Kafka" alt="Pre-built dashboard showing Kafka cluster health, network throughput, and broker metrics" src="/images/otel-kafka-prebuilt-dashboards.webp" />

## Consulte dados do Kafka com NRQL [#query-data]

Use [NRQL](/docs/nrql/get-started/introduction-nrql-new-relics-query-language) para criar consultas e dashboards personalizados para seus dados Kafka.

<CollapserGroup>
  <Collapser id="basic-queries" title="Consultas básicas">
    **Visualize todas as métricas do Kafka:**

    ```sql
    FROM Metric SELECT *
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name IS NOT NULL
    LIMIT 100
    ```

    **Monitorar cluster específico:**

    ```sql
    FROM Metric SELECT *
    WHERE kafka.cluster.name = 'production-cluster'
    AND instrumentation.provider='opentelemetry'
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Monitoramento de atraso do consumidor">
    **Atraso do consumidor por grupo:**

    ```sql
    FROM Metric SELECT latest(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    FACET group, topic
    SINCE 1 hour ago TIMESERIES
    ```

    **Alerta de alta defasagem do consumidor:**

    ```sql
    FROM Metric SELECT max(kafka.consumer_group.lag)
    WHERE instrumentation.provider='opentelemetry'
    AND group = 'your-consumer-group'
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="Consultas de integridade do broker">
    **Contagem de brokers ativos:**

    ```sql
    FROM Metric SELECT latest(kafka.brokers)
    WHERE instrumentation.provider='opentelemetry'
    AND kafka.cluster.name = 'your-cluster'
    TIMESERIES
    ```

    **Partições sub-replicadas:**

    ```sql
    FROM Metric SELECT latest(kafka.partition.under_replicated)
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id SINCE 1 hour ago
    ```
  </Collapser>

  <Collapser id="performance-queries" title="Monitoramento de desempenho">
    **Taxa de transferência de mensagens por tópico:**

    ```sql
    FROM Metric SELECT rate(sum(kafka.prod.msg.count), 1 minute) as 'Messages/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET topic SINCE 1 hour ago TIMESERIES
    ```

    **E/S de rede por broker:**

    ```sql
    FROM Metric SELECT rate(sum(kafka.network.io), 1 minute) as 'Bytes/min'
    WHERE instrumentation.provider='opentelemetry'
    FACET broker.id, direction SINCE 1 hour ago TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Consultas avançadas [#advanced-queries]

Para exemplos de consultas mais abrangentes organizados por área de foco de monitoramento:

<CollapserGroup>
  <Collapser id="cluster-overview-queries" title="Visão geral do cluster">
    Obtenha estatísticas e integridade de alto nível do cluster:

    ```sql
    FROM Metric SELECT
      max(kafka.brokers) AS 'Active Brokers',
      max(kafka.cluster.topic.count) AS 'Total Topics',
      max(kafka.cluster.partition.count) AS 'Total Partitions',
      latest(kafka.partition.offline) AS 'Offline Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="broker-health-queries" title="Integridade do broker">
    Monitore a integridade e liderança de cada broker:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_replicated) AS 'Under-replicated Partitions',
      latest(kafka.broker.leader.count) AS 'Leader Count',
      latest(kafka.partition.count) AS 'Total Partitions'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="topic-throughput-queries" title="Taxa de transferência e E/S do tópico">
    Monitore as taxas de mensagens e a taxa de transferência de dados por tópico:

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.prod.msg.count), 1 minute) AS 'Messages/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'in'), 1 minute) AS 'Bytes In/min',
      rate(filter(sum(kafka.topic.io), WHERE direction = 'out'), 1 minute) AS 'Bytes Out/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET topic
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="consumer-lag-queries" title="Defasagem do consumidor">
    Acompanhe a defasagem e os atrasos de processamento do grupo de consumidores:

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum) AS 'Total Lag'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="request-latency-queries" title="Latência da solicitação">
    Monitore os tempos de processamento e o desempenho das solicitações:

    ```sql
    FROM Metric SELECT
      latest(kafka.request.time.avg) AS 'Avg Latency',
      latest(`kafka.request.time.99p`) AS '99th Percentile'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    TIMESERIES
    ```
  </Collapser>

  <Collapser id="jvm-health-queries" title="Integridade da JVM">
    Monitore as métricas da JVM para brokers Kafka:

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100 AS 'Heap Usage %',
      rate(sum(jvm.gc.collections.count), 1 minute) AS 'GC Count/min'
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    TIMESERIES
    ```
  </Collapser>
</CollapserGroup>

## Criar dashboards personalizados [#custom-dashboards]

Combine várias consultas para criar dashboards abrangentes de monitoramento Kafka:

1. Vá para [one.newrelic.com](https://one.newrelic.com) &gt; <DNT>**Dashboards**</DNT>

2. Clique <DNT>**Create a dashboard**</DNT>

3. Adicione widgets usando as consultas NRQL acima

4. Organize os widgets por área de foco:

   * Integridade do cluster: contagem de brokers, partições sub-replicadas, status do controlador
   * Desempenho do consumidor: Lag, taxa de transferência, associação ao grupo
   * Métricas do tópico: taxas de mensagens, contagens de partições, status de replicação
   * Utilização de recursos: E/S de rede, métricas JVM, uso de disco

## Configurar alerta [#alerts]

<Callout variant="tip">
  A New Relic fornece alertas de métricas douradas pré-configurados para Kafka. Ao criar uma nova condição de alerta, selecione **Guided mode** → **Host integrations** → **Kafka** (brokers, cluster ou tópicos) para visualizar os modelos de alerta recomendados.
</Callout>

Você também pode criar alertas personalizados usando consultas NRQL:

<CollapserGroup>
  <Collapser id="consumer-lag-alert" title="Lag alto do consumidor">
    Alertar quando a defasagem do consumidor exceder seu limite aceitável:

    ```sql
    FROM Metric SELECT
      latest(kafka.consumer_group.lag_sum)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET group
    ```

    **Limite recomendado**: Alerta quando o lag &gt; 10.000 mensagens para grupos de consumidores críticos.
  </Collapser>

  <Collapser id="under-replicated-alert" title="Partições sub-replicadas">
    Alerta quando as partições perdem a replicação:

    ```sql
    FROM Metric SELECT
      sum(kafka.partition.under_replicated)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Limite recomendado**: Alerta quando alguma partição se torna sub-replicada (&gt; 0).
  </Collapser>

  <Collapser id="offline-partitions-alert" title="Partições offline">
    Alerta imediatamente quando as partições ficarem offline:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.offline)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Limite recomendado**: Alerta imediatamente quando alguma partição ficar offline (&gt; 0).
  </Collapser>

  <Collapser id="min-isr-alert" title="Partições abaixo do ISR mínimo">
    Alerta quando as partições ficam abaixo do mínimo de réplicas em sincronia:

    ```sql
    FROM Metric SELECT
      latest(kafka.partition.under_min_isr)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Limite recomendado**: Alerta quando alguma partição cair abaixo do ISR mínimo (&gt; 0).
  </Collapser>

  <Collapser id="jvm-memory-alert" title="Alto uso de memória JVM">
    Alerta quando o uso do heap é crítico:

    ```sql
    FROM Metric SELECT
      (latest(jvm.memory.heap.used) / latest(jvm.memory.heap.max)) * 100
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET broker.id
    ```

    **Limite recomendado**: Alerta quando o uso do heap &gt; 85% por períodos prolongados.
  </Collapser>

  <Collapser id="request-failures-alert" title="Falhas de solicitação">
    Alertar sobre altas taxas de falha de solicitações:

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.request.failed), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    FACET type
    ```

    **Limite recomendado**: Alertar quando a taxa de falha &gt; 1% do total de solicitações.
  </Collapser>

  <Collapser id="unclean-elections-alert" title="Eleições de líder impuras">
    Alerta sobre eleições de líder impuras (indica falhas no broker):

    ```sql
    FROM Metric SELECT
      rate(sum(kafka.unclean.election.rate), 1 minute)
    WHERE kafka.cluster.name = 'production-cluster'
      AND instrumentation.provider='opentelemetry'
    ```

    **Limite recomendado**: Alerta sobre quaisquer eleições de líder impuras (&gt; 0).
  </Collapser>
</CollapserGroup>

## Próximos passos [#next-steps]

* [Referência de métricas do Kafka](/docs/opentelemetry/integrations/kafka/metrics-reference) - Lista completa de métricas disponíveis com descrições
* [Criar condições de alerta NRQL](/docs/alerts/create-alert/create-alert-condition/create-nrql-alert-conditions/) - Configurar monitoramento proativo
* [Tutorial de NRQL](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language) - Aprenda técnicas avançadas de consulta