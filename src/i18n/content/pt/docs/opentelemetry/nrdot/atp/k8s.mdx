---
title: Configurar o ATP para Kubernetes
metaDescription: Step-by-step guide to install and configure the Adaptive Telemetry Processor (ATP) with NRDOT Collector in Kubernetes environments.
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Kubernetes
  - Helm
  - Manifests
freshnessValidatedDate: never
translationType: machine
---

<Callout title="Visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de uma prévia, de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/).
</Callout>

Aprenda a instalar e configurar o Adaptive Telemetry Processor (ATP) com o NRDOT Collector em ambientes Kubernetes. O ATP reduz o volume de dados de telemetria enquanto mantém a visibilidade crítica de suas aplicações.

<Callout variant="important">
  O ATP para Kubernetes usa uma build experimental. Toda esta build é experimental para a instalação do Kubernetes, não apenas o recurso ATP que está em preview.
</Callout>

## Métodos de instalação [#installation-methods]

Você pode instalar o OpenTelemetry Collector com ATP usando Helm (recomendado) ou manifestos do Kubernetes:

<Tabs>
  <TabsBar>
    <TabsBarItem id="helm">Instalação via Helm (recomendado)</TabsBarItem> <TabsBarItem id="manifest">Instalação via manifesto</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="helm">
      O método de instalação Helm é a abordagem recomendada para implantar coletores habilitados para ATP no Kubernetes.

      <Steps>
        <Step>
          ### Antes de você começar [#helm-prereq]

          Certifique-se de ter:

          * Sua chave de licença New Relic
          * kubectl configurado para acessar seu cluster
          * Permissões de administrador do cluster
        </Step>

        <Step>
          ### Baixe e personalize o values.yaml [#helm-values]

          1. Baixe o arquivo `values.yaml` do Helm chart:

             ```bash
             curl -o values.yaml https://raw.githubusercontent.com/newrelic/helm-charts/master/charts/nr-k8s-otel-collector/values.yaml
             ```

          2. Edite o arquivo `values.yaml` com sua configuração específica:

             ```yaml
             # Required: Set your cluster name and license key
             cluster: "YOUR_CLUSTER_NAME"
             licenseKey: "YOUR_NEW_RELIC_LICENSE_KEY"

             # Enable ATP
             enable_atp: true

             # IMPORTANT: Use experimental collector image for ATP
             images:
               collector:
                 repository: "newrelic/nrdot-collector"  # Changed from nrdot-collector-k8s
                 tag: "<NRDOT_COLLECTOR_LATEST_VERSION>"  # Use latest version from releases page
             ```

          3. Encontre a versão mais recente do NRDOT Collector na [página de releases](https://github.com/newrelic/nrdot-collector-releases/releases) e atualize o valor `tag`.

          4. Para opções de configuração adicionais, consulte [parâmetros de configuração](/docs/kubernetes-pixie/k8s-otel/install/#config-params).
        </Step>

        <Step>
          ### Instale o Helm chart [#helm-install]

          1. Adicione o repositório Helm da New Relic:

             ```bash
             helm repo add newrelic https://helm-charts.newrelic.com
             helm repo update
             ```

          2. Instale o chart usando seu arquivo `values.yaml` personalizado:

             ```bash
             helm upgrade nr-k8s-otel-collector newrelic/nr-k8s-otel-collector \
               -f values.yaml \
               -n newrelic \
               --create-namespace \
               --install
             ```
        </Step>

        <Step>
          ### Verifique a instalação [#helm-verify]

          1. Verifique se os pods estão em execução:

             ```bash
             kubectl get pods -n newrelic --watch
             ```

             Você deve ver pods com nomes como `nr-k8s-otel-collector-<hash>` no namespace `newrelic`.

          2. Verifique se o New Relic está recebendo dados de processo executando estas consultas no [query builder](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='YOUR_CLUSTER_NAME'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Acesse os dados do ATP no New Relic [#access-data]

          Uma vez configurado, o ATP começa a coletar dados do seu cluster Kubernetes. Você pode acessar esses dados na UI do New Relic OpenTelemetry. Para mais informações sobre a interface do New Relic OpenTelemetry, consulte [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Para visualizar os dados de métrica do processo ATP no New Relic:**

          1. Vá para **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             OU

             Vá para <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Pesquise a entidade onde você instalou o coletor NRDOT com ATP.

          3. Selecione a entidade e clique em **<DNT>Process</DNT>** no painel esquerdo.

             Na página <DNT>Process</DNT>, você pode visualizar todos os processos em execução, juntamente com seus IDs e métricas de utilização de CPU e memória. Ele também exibe a relação pai-filho entre processos se um processo gerar outros processos.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>

    <TabsPageItem id="manifest">
      O método de instalação via manifesto oferece uma maneira de configurar o OpenTelemetry para Kubernetes sem usar o Helm. Este método é adequado para usuários que preferem uma abordagem mais prática ou têm requisitos específicos que exigem configuração manual.

      <Steps>
        <Step>
          ### Antes de você começar [#manifest-prereq]

          Certifique-se de ter:

          * Sua chave de licença New Relic
          * kubectl configurado para acessar seu cluster
          * Permissões de administrador do cluster
        </Step>

        <Step>
          ### Baixe e prepare os arquivos de manifesto [#manifest-download]

          1. Copie o conteúdo do diretório de exemplos renderizados do `nr-k8s-otel-collector` para o seu espaço de trabalho local:

             ```bash
             git clone https://github.com/newrelic/helm-charts.git
             cd helm-charts/charts/nr-k8s-otel-collector/examples/k8s-with-atp/rendered
             ```

          2. Atualize a imagem do coletor nos arquivos `daemonset.yaml` e `deployment.yaml`:

             Alterar de:

             ```yaml
             image: docker.io/newrelic/nrdot-collector-k8s
             ```

             Para:

             ```yaml
             image: docker.io/newrelic/nrdot-collector:<NRDOT_COLLECTOR_LATEST_VERSION>
             ```

             <Callout variant="important">
               Esta é uma build experimental para a instalação do Kubernetes. Encontre a versão mais recente na [página de releases](https://github.com/newrelic/nrdot-collector-releases/releases).
             </Callout>
        </Step>

        <Step>
          ### Configure a chave de licença e o nome do cluster [#manifest-config]

          1. Atualize o arquivo `secret.yaml` com sua chave de licença da New Relic codificada em Base64:

             ```yaml
             data:
               licenseKey: <YOUR_BASE64_ENCODED_LICENSE_KEY>
             ```

             Para codificar sua chave de licença:

             * **Linux/macOS:** `echo -n "<YOUR_LICENSE_KEY>" | base64`
             * **Windows (PowerShell):** `[System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes("<YOUR_LICENSE_KEY>"))`

          2. Atualize o nome do seu cluster nos arquivos `daemonset-configmap.yaml` e `deployment-configmap.yaml`:

             Localize instâncias de `k8s.cluster.name` e substitua `<YOUR_CLUSTER_NAME>` pelo nome do cluster desejado:

             ```yaml
             - key: k8s.cluster.name
               action: upsert
               value: YOUR_CLUSTER_NAME  # Replace with your cluster name
             ```
        </Step>

        <Step>
          ### Implante os manifestos [#manifest-deploy]

          1. Crie o namespace `newrelic` e aplique os manifestos:

             ```bash
             kubectl create namespace newrelic
             kubectl apply -n newrelic -R -f .
             ```

          2. Verifique se os pods estão em execução:

             ```bash
             kubectl get pods -n newrelic --watch
             ```

          3. Verifique se a New Relic está recebendo dados de processo executando estas consultas no [query builder](https://docs.newrelic.com/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder/):

             ```sql
             FROM Metric SELECT *
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             LIMIT 100
             ```

             ```sql
             FROM Metric SELECT uniqueCount(metricName)
             WHERE k8s.cluster.name='<YOUR_CLUSTER_NAME>'
             AND metricName LIKE 'process.%'
             ```
        </Step>

        <Step>
          ### Acesse os dados do ATP no New Relic [#access-data]

          Uma vez configurado, o ATP começa a coletar dados do seu cluster Kubernetes. Você pode acessar esses dados na UI do New Relic OpenTelemetry. Para mais informações sobre a interface do New Relic OpenTelemetry, consulte [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui).

          **Para visualizar os dados de métrica do processo ATP no New Relic:**

          1. Vá para **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**.

             OU

             Vá para <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>.

          2. Pesquise a entidade onde você instalou o coletor NRDOT com ATP.

          3. Selecione a entidade e clique em **<DNT>Process</DNT>** no painel esquerdo.

             Na página <DNT>Process</DNT>, você pode visualizar todos os processos em execução, juntamente com seus IDs e métricas de utilização de CPU e memória. Ele também exibe a relação pai-filho entre processos se um processo gerar outros processos.

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## Opções de configuração do ATP [#atp-config]

Quando o ATP está habilitado, a seguinte configuração é aplicada automaticamente:

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Descrição
      </th>

      <th>
        Valor padrão
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `enable_atp`
      </td>

      <td>
        Habilitar/desabilitar a funcionalidade ATP. Defina como 

        `true`

         para habilitar o ATP.
      </td>

      <td>
        `false`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.repository`
      </td>

      <td>
        Deve ser alterado para 

        `newrelic/nrdot-collector`

         para usar o ATP.
      </td>

      <td>
        `newrelic/nrdot-collector-k8s`
      </td>
    </tr>

    <tr>
      <td>
        `images.collector.tag`
      </td>

      <td>
        Tag da imagem para coletor com ATP habilitado.
      </td>

      <td>
        `<TO_BE_CONFIRMED>`
      </td>
    </tr>
  </tbody>
</table>

/\* ## Solução de problemas do ATP \[#troubleshooting] ### ATP não filtrando métricas \*\*Problema\*\*: Todas as métricas de processo estão sendo enviadas, não filtradas. \*\*Soluções\*\*: 1. \*\*Verifique se o ATP está habilitado\*\*: \`\`\`bash kubectl get configmap -n newrelic nr-k8s-otel-collector-daemonset-config -o yaml | grep adaptivetelemetry \`\`\` 2. \*\*Verifique se o ATP está no pipeline\*\*: Procure por \`adaptivetelemetry\` no pipeline \`metrics/nr\`. 3. \*\*Verifique se você está usando a imagem correta do coletor\*\*: \`\`\`bash kubectl get daemonset -n newrelic nr-k8s-otel-collector-daemonset -o yaml | grep &quot;image:&quot; \`\`\` Esperado: \`newrelic/nrdot-collector:1.11.0\` (ou posterior) \*\*NÃO\*\*: \`newrelic/nrdot-collector-k8s:1.11.0\` 4. \*\*Verifique se \`enable\_atp\` está definido como \`true\`\*\* no seu \`values.yaml\` ou ConfigMap. ### Pods não iniciando \*\*Problema\*\*: Os pods do Coletor estão falhando ao iniciar. \*\*Soluções\*\*: 1. \*\*Verifique os logs do pod\*\*: \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector \`\`\` 2. \*\*Verifique se a chave de licença está codificada corretamente\*\*: \`\`\`bash kubectl get secret -n newrelic nr-k8s-otel-collector-config -o yaml \`\`\` 3. \*\*Verifique os limites de recursos\*\*: Certifique-se de que seu cluster tenha recursos suficientes para os pods do coletor. ### Sem dados no New Relic \*\*Problema\*\*: Nenhuma métrica aparecendo no New Relic após a instalação. \*\*Soluções\*\*: 1. \*\*Aguarde de 2 a 5 minutos\*\* para os dados aparecerem na interface do New Relic. 2. \*\*Verifique se o nome do cluster\*\* corresponde ao que você definiu na sua configuração. 3. \*\*Verifique os logs do coletor\*\* para erros de conexão: \`\`\`bash kubectl logs -n newrelic -l app.kubernetes.io/name=nr-k8s-otel-collector | grep -i error \`\`\` \*/

## Recursos relacionados [#related-resources]

<DocTiles>
  <DocTile title="Resolução de problemas" path="/docs/opentelemetry/nrdot/atp/troubleshooting">
    Saiba como solucionar problemas de ATP no seu ambiente.
  </DocTile>

  <DocTile title="Consulte seus dados" path="/docs/opentelemetry/nrdot/atp/query">
    Saiba como consultar dados de ATP no New Relic usando NRQL.
  </DocTile>

  <DocTile title="Recursos-avançados" path="/docs/opentelemetry/nrdot/atp/advanced-features">
    Saiba como ativar recursos avançados para sua implantação do ATP.
  </DocTile>
</DocTiles>