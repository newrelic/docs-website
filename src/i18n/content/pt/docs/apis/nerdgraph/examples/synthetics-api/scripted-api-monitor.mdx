---
title: Gerenciar monitores de API com scripts
tags:
  - Synthetics
  - APIs
  - NerdGraph
  - Examples
metaDescription: How to use New Relic NerdGraph API to create and update scripted API monitors for synthetic monitoring.
freshnessValidatedDate: never
translationType: machine
---

O New Relic permite que você use o NerdGraph para criar [monitores de API com scripts](/docs/synthetics/synthetic-monitoring/scripting-monitors/write-synthetic-api-tests). Os monitores API com script executam código JavaScript personalizado para testar APIs e serviços backend sem um navegador, fazendo requests HTTP e validando respostas programaticamente. Este tutorial fornece exemplos de como usar a API do NerdGraph para automatizar a criação de monitores de API com scripts.

## Crie um monitor de API com script [#create-scripted-api]

Você pode criar um monitor de API com script usando a mutação `syntheticsCreateScriptApiMonitor`. Essa mutação permite configurar testes API personalizados que executam seu código JavaScript para validar os endpoints da API.

### Parâmetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Tipo de dados
      </th>

      <th>
        É obrigatório?
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `accountId`
      </td>

      <td>
        Inteiro
      </td>

      <td>
        Sim
      </td>

      <td>
        Seu 

        [ID de conta](/docs/accounts/accounts-billing/account-structure/account-id)

         New Relic onde o monitor será criado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Sim
      </td>

      <td>
        matriz de 

        [localização pública](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         identificadar onde o monitor executará verificações (por exemplo, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O nome de exibição para o seu monitor de API com script.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Enum
      </td>

      <td>
        Sim
      </td>

      <td>
        Com que frequência o monitor é executado? Opções: 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O tipo de tempo de execução usado pelo seu monitor. 

        `NODE_API`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        A versão do tipo de tempo de execução usada pelo seu monitor. 

        `16.10`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O idioma utilizado no seu monitor. 

        `JAVASCRIPT`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O código JavaScript que o monitor executa. Este texto deve ser em formato simples, não codificado em base64. O script pode usar o objeto $http para fazer requests HTTP e realizar testes API.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Enum
      </td>

      <td>
        Sim
      </td>

      <td>
        O estado do monitor. Opções: 

        `ENABLED`

         (monitor ativo e realizando verificações), 

        `DISABLED`

         (monitor inativo).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Float
      </td>

      <td>
        Não
      </td>

      <td>
        O monitor Apdex destino em segundos, usado para preencher relatórios SLA. O valor padrão é de 7,0 segundos.
      </td>
    </tr>
  </tbody>
</table>

### Solicitação de amostra

```graphql
mutation {
  syntheticsCreateScriptApiMonitor(
    accountId: ACCOUNT_ID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Resposta de amostra

Uma resposta bem-sucedida retorna `null` para erros:

```json
{
  "data": {
    "syntheticsCreateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Se houver algum problema ao criar o monitor, a matriz `errors` conterá objetos com campos `description` e `type` explicando o que deu errado.

## Atualizar um monitor de API com script [#update-scripted-api]

Você pode atualizar um monitor de API com script existente usando a mutação `syntheticsUpdateScriptApiMonitor`. Isso permite modificar a configuração de um monitor de API com script que já foi criado.

### Parâmetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Tipo de dados
      </th>

      <th>
        É obrigatório?
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         exclusivo da entidade do monitor que você deseja atualizar.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Não
      </td>

      <td>
        matriz de 

        [localização pública](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

         identificadar onde o monitor executará verificações (por exemplo, 

        `["US_EAST_1", "US_WEST_1"]`

        ).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        Corda
      </td>

      <td>
        Não
      </td>

      <td>
        O nome de exibição atualizado para o seu monitor de API com script.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        Enum
      </td>

      <td>
        Não
      </td>

      <td>
        Com que frequência o monitor é executado? Opções: 

        `EVERY_MINUTE`

        , 

        `EVERY_5_MINUTES`

        , 

        `EVERY_10_MINUTES`

        , 

        `EVERY_15_MINUTES`

        , 

        `EVERY_30_MINUTES`

        , 

        `EVERY_HOUR`

        , 

        `EVERY_6_HOURS`

        , 

        `EVERY_12_HOURS`

        , 

        `EVERY_DAY`

        .
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Corda
      </td>

      <td>
        Não
      </td>

      <td>
        O tipo de tempo de execução usado pelo seu monitor. 

        `NODE_API`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Corda
      </td>

      <td>
        Não
      </td>

      <td>
        A versão do tipo de tempo de execução usada pelo seu monitor. 

        `16.10`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Corda
      </td>

      <td>
        Não
      </td>

      <td>
        O idioma utilizado no seu monitor. 

        `JAVASCRIPT`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Corda
      </td>

      <td>
        Não
      </td>

      <td>
        O código JavaScript que o monitor executa. Este texto deve ser em formato simples, não codificado em base64.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        Enum
      </td>

      <td>
        Não
      </td>

      <td>
        O estado do monitor. Opções: 

        `ENABLED`

         (monitor ativo e realizando verificações), 

        `DISABLED`

         (monitor inativo).
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        Float
      </td>

      <td>
        Não
      </td>

      <td>
        O monitor Apdex destino em segundos, usado para preencher relatórios SLA. O valor padrão é de 7,0 segundos.
      </td>
    </tr>
  </tbody>
</table>

### Solicitação de amostra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: ENTITY_GUID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Resposta de amostra

Uma resposta bem-sucedida retorna `null` para erros:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Se houver algum problema ao atualizar o monitor, a matriz `errors` conterá objetos com campos `description` e `type` explicando o que deu errado.

## Atualize o ambiente de execução de um monitor de API baseado em script. [#upgrade-monitor-runtime]

Você pode atualizar um monitor de API baseado em script para usar o ambiente de execução Node.js 16.10 mais recente. Isso garante que seu monitor utilize as atualizações mais recentes de recursos e segurança Node.js

### Parâmetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Tipo de dados
      </th>

      <th>
        É obrigatório?
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         exclusivo da entidade do monitor que você deseja atualizar.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O tipo de tempo de execução. 

        `NODE_API`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        A versão de tempo de execução. 

        `16.10`

         é o único valor aceito.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        A linguagem de script. 

        `JAVASCRIPT`

         é o único valor aceito.
      </td>
    </tr>
  </tbody>
</table>

### Solicitação de amostra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "NODE_API",
        runtimeTypeVersion: "16.10",
        scriptLanguage: "JAVASCRIPT"
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Resposta de amostra

Uma resposta bem-sucedida retorna `null` para erros:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Se houver algum problema ao atualizar o tempo de execução do monitor, a matriz `errors` conterá objetos com campos `description` e `type` explicando o que deu errado.

## Fazer downgrade do runtime de um monitor de API baseado em script [#downgrade-monitor-runtime]

Você pode fazer o downgrade de um monitor de API baseado em script para usar um ambiente de execução legado. Isso pode ser necessário por motivos de compatibilidade, mas observe que os runtimes legados chegarão ao fim de sua vida útil em 22 de outubro de 2024.

<Callout variant="important">
  Os ambientes de execução legados estão obsoletos e chegarão ao fim de sua vida útil em 22 de outubro de 2024. Não é recomendável fazer o downgrade para versões de tempo de execução legadas, exceto em casos de necessidade temporária de compatibilidade.
</Callout>

### Parâmetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Tipo de dados
      </th>

      <th>
        É obrigatório?
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         exclusivo da entidade do monitor para o qual você deseja fazer o downgrade.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        Defina como string vazia 

        `""`

         para usar o ambiente de execução legado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        Defina como string vazia 

        `""`

         para usar o ambiente de execução legado.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        Defina como string vazia 

        `""`

         para usar o ambiente de execução legado.
      </td>
    </tr>
  </tbody>
</table>

### Solicitação de amostra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "",
        runtimeTypeVersion: "",
        scriptLanguage: ""
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### Resposta de amostra

Uma resposta bem-sucedida retorna `null` para erros:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

Se houver algum problema ao fazer o downgrade do tempo de execução do monitor, a matriz `errors` conterá objetos com campos `description` e `type` explicando o que deu errado.

## Mova um monitor API com script entre localização privada habilitada para VSE [#move-monitor]

Você pode mover um monitor API com script entre localização privada habilitada para VSE. Ao mover monitores entre locais privados com a execução script verificada (VSE) ativada, você deve incluir o script para regenerar os HMACs para validação de segurança.

### Parâmetro de entrada

<table>
  <thead>
    <tr>
      <th>
        Parâmetro
      </th>

      <th>
        Tipo de dados
      </th>

      <th>
        É obrigatório?
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O 

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         exclusivo da entidade do monitor que você deseja mover.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private`
      </td>

      <td>
        Matriz
      </td>

      <td>
        Sim
      </td>

      <td>
        matriz de localização privada configuração. Cada local requer um 

        `guid`

         e 

        `vsePassword`

         para locais habilitados para VSE.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.guid`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O GUID da entidade da localização privada de destino.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.vsePassword`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        A senha do VSE para o destino localização privada.
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        Corda
      </td>

      <td>
        Sim
      </td>

      <td>
        O código JavaScript que o monitor executa. Isso deve ser incluído para regenerar os HMACs ao migrar entre locais com VSE habilitado.
      </td>
    </tr>
  </tbody>
</table>

### Solicitação de amostra

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID"
    monitor: {
      locations: {
        private: [{
          guid: "LOCATION_GUID",
          vsePassword: "YOUR_VSE_PASSWORD"
        }]
      },
      script: "SCRIPT_CONTENT"
    }
  ) {
    errors {
      description
      type
    }
    monitor {
      status
    }
  }
}
```

### Resposta de amostra

Uma resposta bem-sucedida retorna `null` para erros e inclui o status do monitor:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null,
      "monitor": {
        "status": "ENABLED"
      }
    }
  }
}
```

Se houver algum problema ao mover o monitor, a matriz `errors` conterá objetos com campos `description` e `type` explicando o que deu errado.

## Excluir um monitor de API com script [#delete-monitor]

Quando um monitor de API com script não for mais necessário, você poderá removê-lo permanentemente usando a mutação `syntheticsDeleteMonitor`.

Para excluir um monitor, consulte a seção [Excluir monitor Sintético](/docs/apis/nerdgraph/examples/synthetics-api/ping-monitor/#delete-monitor).