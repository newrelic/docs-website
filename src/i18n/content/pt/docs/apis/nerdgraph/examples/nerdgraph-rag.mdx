---
title: 'Tutorial do NerdGraph: Configurar integração RAG'
metaDescription: Enhance New Relic AI with RAG (Retrieval Augmented Generation)
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Com New Relic, você pode aprimorar o agente New Relic AI com geração de recuperação de recuperação (RAG) associando sua documentação, runbooks, retros de incidentes e até mesmo código-fonte aos seus serviços. Esse processo fornece à New Relic AI melhores insights sobre problemas no seu sistema. O tutorial descreve como obter o ID da sua organização, criar uma ferramenta RAG e adicionar seus documentos à plataforma usando a API Blob.

Depois de adicionar seus documentos, você criará um relacionamento para associá-los à ferramenta RAG. Você pode então verificar sua configuração consultando os relacionamentos entre os documentos RAG e a ferramenta RAG. A etapa final é consultar a própria ferramenta RAG para recuperar informações relevantes e indexadas.

Para saber mais sobre o conector de conhecimento, consulte o [Conector de conhecimento do New Relic AI](/docs/agentic-ai/knowledge-integration/overview).

<Callout variant="important">
  Antes de executar as etapas a seguir, certifique-se de ter permissões de &quot;Administrador de produto da organização&quot;.
</Callout>

Para começar a indexar seu conteúdo e se beneficiar do conector de conhecimento com o New Relic AI, siga estas etapas mencionadas:

## Tarefa 1: Crie sua ferramenta RAG [#create-your-rag-tool]

<CollapserGroup>
  <Collapser id="get-started" title="Obtenha o ID da sua organização">
    O ID da organização identifica exclusivamente sua conta e garante que qualquer ferramenta RAG que você criar, documentos que você enviar ou relacionamentos que você estabelecer sejam associados à sua organização no New Relic.

    O ID da organização é necessário para executar mutações e consultas no NerdGraph ao configurar e gerenciar ferramentas e documentos do RAG. Execute a seguinte consulta e mantenha o ID da organização em mãos para etapas posteriores.

    ### Exemplo de consulta

    ```graphql
    {
      actor {
        organization {
          id
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="create-rag-tool" title="Criar uma ferramenta RAG">
    Uma ferramenta RAG atua como um contêiner especializado para organizar documentos e recursos relacionados no New Relic. Um nome claro e uma descrição precisa para suas ferramentas RAG ajudam o LLM a selecionar a ferramenta certa para cada prompt, garantindo respostas relevantes e contextualizadas.

    Para criar uma nova ferramenta RAG na sua conta New Relic, execute a seguinte mutação `entityManagementCreateRagTool` :

    1. Certifique-se de substituir `${ORGANIZATION_ID}` pelo ID real da sua organização obtido na etapa anterior.
    2. Se for bem-sucedido, você receberá um `id` para sua ferramenta RAG.

    ### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ragToolEntity`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sim
          </td>

          <td>
            O objeto de entrada que contém a configuração para a nova ferramenta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `description`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            Uma descrição clara e precisa do propósito da ferramenta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O nome exclusivo para sua ferramenta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `scope`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sim
          </td>

          <td>
            Um objeto que define o contexto no qual a ferramenta será criada.
          </td>
        </tr>

        <tr>
          <td>
            `scope.id`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O ID único da sua organização (

            `${ORGANIZATION_ID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `scope.type`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O tipo do escopo, que deve ser 

            `ORGANIZATION`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutação de amostra

    ```graphql
    mutation {
      entityManagementCreateRagTool(
        ragToolEntity: {
          description: "Runbooks for resolving incidents with APIs",
          name: "API Runbooks",
          scope: {id: `${ORGANIZATION_ID}`, type: ORGANIZATION}
        }
      ) {
        entity {
          id
        }
      }
    }
    ```

    Você deve salvar o `id` retornado, pois precisará dele em etapas posteriores para vincular documentos à ferramenta, verificar relacionamentos e consultar a ferramenta para obter informações relevantes no New Relic.
  </Collapser>
</CollapserGroup>

## Tarefa 2: Indexe seus documentos [#index-your-documents]

<CollapserGroup>
  <Collapser id="upload-document" title="Carregar um documento por meio da API Blob">
    <Callout variant="important">
      Todos os documentos indexados ficam visíveis para todos os usuários da sua organização. Certifique-se de que os documentos indexados estejam em conformidade com suas políticas internas e não carregue dados confidenciais ou privados.
    </Callout>

    ### A API Blob e sua finalidade

    A Blob API é um serviço da New Relic projetado para enviar arquivos, como documentação e runbooks, para sua conta. O NerdGraph é otimizado para consultas e mutações de dados estruturados e não para transferência eficiente de arquivos, então a API Blob é necessária para carregar documentos.

    ### Requisitos de autenticação

    Você precisa de uma chave de API válida do New Relic com permissões para fazer upload de documentos. Para obter a chave de API para enviar um documento para o New Relic usando a API Blob:

    1. Entre na sua conta [New Relic](https://one.newrelic.com/).
    2. Crie e gerencie sua chave de API na [página de interface da chave de API ](https://one.newrelic.com/administration/api-keys).
    3. Clique em **Create a key** e preencha os detalhes necessários (ou use uma existente com as permissões necessárias).
    4. Clique em **Create a key** e copie a chave gerada (ela se parecerá com NRAK-XXXXXXXXXX).

    Aqui está um exemplo de como fazer upload de um documento usando um comando `curl` `bash` :

    ### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `Api-Key`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            Sua chave de API do New Relic para autenticação.
          </td>
        </tr>

        <tr>
          <td>
            `NewRelic-Entity`
          </td>

          <td>
            Objeto JSON
          </td>

          <td>
            Sim
          </td>

          <td>
            Informações sobre o documento, como seu nome.
          </td>
        </tr>

        <tr>
          <td>
            `Content-Type`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O formato do arquivo que está sendo carregado (por exemplo, 

            `application/json`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `payload`

             (

            `@incidents.json`

            )
          </td>

          <td>
            Arquivo
          </td>

          <td>
            Sim
          </td>

          <td>
            O arquivo de documento que você está carregando, especificado pelo caminho do arquivo.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemplo de consulta

    ```shell
    curl -X POST https://blob-api.service.newrelic.com/v1/e/organizations/$ORGANIZATION_ID/RagDocuments \
         -H 'Api-Key: NRAK-XXXXXXXXXX' \
         -H 'NewRelic-Entity: {"name": "Runbooks for API service" }' \
         -H 'Content-Type: application/json' \
         -d @incidents.json
    ```

    ### Resposta de amostra

    <table>
      <thead>
        <tr>
          <th>
            Resposta
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `entityGuid`
          </td>

          <td>
            Corda
          </td>

          <td>
            O identificador exclusivo para o documento RAG carregado.
          </td>
        </tr>

        <tr>
          <td>
            `blobVersionEntity`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Representa a versão do blob carregado.
          </td>
        </tr>
      </tbody>
    </table>

    ```json
    {
      "entityGuid": "MTIyODU0NTN8TkdFUHxSQUdfRE9DVU1FTlR8MDE5NGUyOTgtYmQzMS03NzA4LWI3NzItYzQ4MTZlYjNhYThk",
      "blobVersionEntity": null
    }
    ```

    ### Próximos passos

    Após o upload do seu documento, ele é indexado e fica disponível para o New Relic AI pesquisar e recuperar. Você deve salvar o `entityGuid` da resposta para criar um relacionamento com sua ferramenta RAG ou para consultar o documento no NerdGraph.
  </Collapser>

  <Collapser id="view-the-rag-document-entity-represented-in-nerdgraph" title="Visualize a entidade do documento RAG representada no NerdGraph">
    Depois que um documento é carregado por meio da API Blob, a execução desta consulta confirma que o carregamento foi bem-sucedido e que o documento foi registrado corretamente como uma entidade de documento RAG com seu próprio identificador e propriedades exclusivos.

    #### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O GUID exclusivo do documento RAG a ser recuperado.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemplo de consulta

    Na consulta abaixo, substitua o espaço reservado `${RAG_DOCUMENT_GUID}` pelo `entityGuid` que você recebeu na etapa anterior.

    ```graphql
    {
      actor {
        entityManagement {
          entity(
            id: `${RAG_DOCUMENT_GUID}`
          ) {
            ... on EntityManagementRagDocumentEntity {
              id
              name
              blob {
                url
              }
              type
            }
          }
        }
      }
    }
    ```

    Esta consulta retornará os seguintes detalhes sobre seu documento RAG:

    * `id`: O ID único do documento RAG.
    * `name`: O nome do documento RAG.
    * `blob { url }`: A URL para acessar o documento carregado.
    * `type`: O tipo da entidade, que neste caso é `EntityManagementRagDocumentEntity`.
  </Collapser>

  <Collapser id="create-a-relationship-between-the-rag-document-and-the-rag-tool" title="Crie um relacionamento entre a ferramenta RAG e o documento RAG">
    Agora que você criou uma ferramenta RAG, carregou seu documento e verificou que o upload foi bem-sucedido, a próxima etapa é associar a ferramenta RAG e o documento RAG, tornando seu documento pesquisável e utilizável pelo New Relic AI. Para fazer isso, execute a mutação `entityManagementCreateRelationship` :

    1. Substitua `${RAG_DOCUMENT_GUID}` por `entityGuid` da resposta do upload do documento via API Blob.
    2. Substitua `${RAG_TOOL_GUID}` por `id` da resposta da mutação de criação da ferramenta RAG.

    ### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationship`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sim
          </td>

          <td>
            O objeto de entrada que contém os detalhes do relacionamento.
          </td>
        </tr>

        <tr>
          <td>
            `source`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sim
          </td>

          <td>
            A entidade de origem do relacionamento, que é o documento RAG.
          </td>
        </tr>

        <tr>
          <td>
            `source.scope`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O escopo da entidade de origem, que deve ser 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `source.id`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O GUID exclusivo do documento RAG (

            `${RAG_DOCUMENT_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `target`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Sim
          </td>

          <td>
            O destino entidade do relacionamento, que é a ferramenta RAG.
          </td>
        </tr>

        <tr>
          <td>
            `target.scope`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O escopo da entidade de destino, que deve ser 

            `ORGANIZATION`

            .
          </td>
        </tr>

        <tr>
          <td>
            `target.id`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O GUID exclusivo da ferramenta RAG (

            `${RAG_TOOL_GUID}`

            ).
          </td>
        </tr>

        <tr>
          <td>
            `type`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O tipo de relacionamento, que deve ser 

            `"INDEXED_FOR"`

            .
          </td>
        </tr>
      </tbody>
    </table>

    ### Mutação de amostra

    ```graphql
    mutation {
      entityManagementCreateRelationship(
        relationship: {
          source: {
            scope: ORGANIZATION,
            id: `${RAG_DOCUMENT_GUID}`
          },
          target: {
            scope: ORGANIZATION,
            id: `${RAG_TOOL_GUID}`
          },
          type: "INDEXED_FOR"
        }
      ) {
        relationship {
          type
          target {
            id
            type
          }
          source {
            id
            type
          }
        }
      }
    }
    ```
  </Collapser>
</CollapserGroup>

## Tarefa 3: Recuperar informações relevantes [#retrieve-relevant-information]

<CollapserGroup>
  <Collapser id="query-to-see-relationships-between-rag-documents-and-rag-tools" title="consulta para ver as relações entre os documentos RAG e as ferramentas RAG">
    Depois de criar um relacionamento entre seu documento RAG e a ferramenta RAG, você pode verificar a associação consultando relacionamentos no NerdGraph. Isso ajuda a garantir que seu documento esteja devidamente vinculado e disponível para uso pelo New Relic AI.

    * Substitua `${RAG_DOCUMENT_ID}` pelo `entityGuid` do seu documento carregado.

    ### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `relationships`
          </td>

          <td>
            Consulta
          </td>

          <td>
            Sim
          </td>

          <td>
            A consulta para recuperar relacionamentos entre entidades.
          </td>
        </tr>

        <tr>
          <td>
            `filter`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Não
          </td>

          <td>
            Um objeto usado para filtrar relacionamentos com base em atributos.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId`
          </td>

          <td>
            Objeto
          </td>

          <td>
            Não
          </td>

          <td>
            Um objeto a ser filtrado pelo identificador exclusivo da entidade de origem.
          </td>
        </tr>

        <tr>
          <td>
            `filter.sourceId.eq`
          </td>

          <td>
            Corda
          </td>

          <td>
            Não
          </td>

          <td>
            O GUID exclusivo do documento RAG a ser correspondido.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemplo de consulta

    ```graphql
    {
      actor {
        entityManagement {
          relationships(
            filter: {sourceId: {eq: `${RAG_DOCUMENT_ID}`}}
          ) {
            items {
              type
              target {
                id
                type
              }
            }
          }
        }
      }
    }
    ```
  </Collapser>

  <Collapser id="query-the-rag-tool" title="consulte a ferramenta RAG">
    Depois de configurar sua ferramenta RAG e indexar os documentos, você pode consultá-la para recuperar informações relevantes com base em seu prompt. Isso permite que a New Relic AI revele respostas contextuais usando a documentação da sua organização.

    ### Parâmetro de entrada

    <table>
      <thead>
        <tr>
          <th>
            Nome do parâmetro
          </th>

          <th>
            Tipo de dados
          </th>

          <th>
            É obrigatório?
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `prompt`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            A consulta em linguagem natural que você deseja que a ferramenta RAG processe.
          </td>
        </tr>

        <tr>
          <td>
            `toolId`
          </td>

          <td>
            Corda
          </td>

          <td>
            Sim
          </td>

          <td>
            O GUID exclusivo da ferramenta RAG a ser consultado.
          </td>
        </tr>
      </tbody>
    </table>

    ### Exemplo de consulta

    ```graphql
    {
      actor {
        machineLearning {
          ragQueryData(
            prompt: "tell me about the incident", 
            toolId: `${RAG_TOOL_GUID}`
          ) {
            blobId
            chunk
            documentId
            score
            toolId
          }
        }
      }
    }
    ```

    A resposta incluirá correspondências fragmentadas dos seus documentos indexados, que você pode usar diretamente ou resumir com o New Relic AI.
  </Collapser>
</CollapserGroup>