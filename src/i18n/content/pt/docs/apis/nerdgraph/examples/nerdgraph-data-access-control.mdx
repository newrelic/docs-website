---
title: 'Tutorial do NerdGraph: Gerenciar políticas de acesso a dados'
tags:
  - Manage data access policies via NerdGraph
  - Manage data access policies via API
metaDescription: 'Use New Relic NerdGraph to create, update, and manage data access policies for controlling access to log partitions.'
freshnessValidatedDate: never
translationType: machine
---

Você pode usar nossa [APINerdGraph](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/) para criar, consultar, atualizar e excluir políticas de acesso a dados. As políticas de acesso a dados controlam a quais [partições de log](/docs/logs/ui-data/data-partitions/) o usuário pode acessar, permitindo restringir o acesso a dados de log confidenciais com base em grupos de usuários.

## Requisitos [#requirements]

Para gerenciar políticas de acesso a dados via NerdGraph, você precisa de:

* Uma conta New Relic [Pro ou Enterprise.](https://newrelic.com/pricing)
* Função [de gerente de domínio de autenticação](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#admin-settings)
* tipo de usuário [do usuário principal ou usuário da plataforma completa](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type)
* Uma [chave de usuário](/docs/apis/intro-apis/new-relic-api-keys/#user-key) para autenticação.

## Antes de você começar [#before-you-begin]

Antes de usar a API do NerdGraph para políticas de acesso a dados, entenda como funciona [o controle de acesso a dados](/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control) e familiarize-se com [o NerdGraph](https://api.newrelic.com/graphiql).

## Atributo comum [#attributes]

Os seguintes atributos são comumente usados em consultas e alterações de políticas de acesso a dados:

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        Atributo
      </th>

      <th>
        Descrição
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>

      <td>
        O ID da organização associada à política. Utilizado para filtrar políticas ou definir o escopo da criação de políticas.
      </td>
    </tr>

    <tr>
      <td>
        `id`
      </td>

      <td>
        O identificador único da apólice. Necessário ao atualizar ou excluir uma política específica.
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        Um nome amigável para o usuário para a política de acesso a dados.
      </td>
    </tr>

    <tr>
      <td>
        `policy`
      </td>

      <td>
        O objeto JSON que define as regras da política. Inclui:

        * `rules`: Uma matriz de objetos de regra.
        * `operations`: As operações a permitir ou negar (ex.: `SELECT`, `*`).
        * `eventTypes`: Um objeto que especifica quais tipos de evento `allow` (por exemplo, `["*"]`) ou `except` (por exemplo, `["Log_accessible"]`).
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        O ID da conta à qual a função concede acesso.
      </td>
    </tr>

    <tr>
      <td>
        `dataAccessPolicyId`
      </td>

      <td>
        O ID da política de acesso a dados que define quais dados em uma conta são permitidos.
      </td>
    </tr>

    <tr>
      <td>
        `roleId`
      </td>

      <td>
        O ID da função que define o nível de acesso.
      </td>
    </tr>
  </tbody>
</table>

## Operações comuns [#operations]

A seguir, estão as operações mais comuns para gerenciar políticas de acesso a dados:

<CollapserGroup>
  <Collapser id="query-grants" title="Políticas de acesso a dados de consulta associadas a concessões de acesso.">
    Esta consulta recupera todas as concessões de acesso em sua organização e suas respectivas políticas de acesso a dados. Use esta ferramenta para obter quais políticas estão atualmente atribuídas às subvenções.

    ### Exemplo de consulta

    ```graphql
    {
      customerAdministration {
        grants(filter: {organizationId: {eq: "YOUR_ORG_ID"}}) {
          items {
            dataAccessPolicy {
              id
              name
            }
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Obrigatório.** Identificação da organização à qual as subvenções pertencem. Use o operador igual (`eq`) para filtrar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "customerAdministration": {
          "grants": {
            "items": [
              {
                "dataAccessPolicy": {
                  "id": "DATA_ACCESS_POLICY_ID",
                  "name": "DATA_ACCESS_POLICY_NAME"
                }
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Lista de bolsas de estudo da organização.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy`
          </td>

          <td>
            A política de acesso aos dados associada a cada concessão.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            O identificador único da política de acesso aos dados.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            O nome da política de acesso aos dados.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="query-policies" title="consultar políticas de acesso a dados para uma organização">
    Esta consulta recupera todas as políticas de acesso a dados da sua organização.

    ### Exemplo de consulta

    ```graphql
    {
      customerAdministration {
        dataAccessPolicies(
          filter: {organizationId: {eq: "YOUR_ORG_ID"}}
        ) {
          items {
            id
            name
            policy
            status
            version
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Obrigatório.** O ID da organização à qual as políticas pertencem. Use o operador igual (`eq`) para filtrar.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "customerAdministration": {
          "dataAccessPolicies": {
            "items": [
              {
                "id": "ddadbdd2-183b-42d9-8a1a-41ec7692fb4c",
                "name": "Log Operations",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Operations"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              },
              {
                "id": "bb8efcf5-3127-4a4d-b25f-114505a0a68d",
                "name": "Restrict Log_Security",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Sec%"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            Lista de políticas de acesso a dados na organização.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            O identificador único da política de acesso aos dados.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            O nome da política de acesso aos dados.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            O objeto JSON contendo as regras de política com `operations` e `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            O estado atual da política (ex.: `VALID`).
          </td>
        </tr>

        <tr>
          <td>
            `version`
          </td>

          <td>
            A versão da política (atualmente `1.0-logs`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="create-policy" title="Criar uma política de acesso a dados">
    Essa mutação cria uma nova política de acesso a dados para controlar o acesso às partições de log.

    ### Mutação de amostra

    ```graphql
    mutation createMyPolicy {
      dataAccessPolicyCreate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_accessible"]}}]}
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    Você também pode usar as seguintes variáveis:

    ```graphql
    mutation createMyPolicy($policy: DataAccessPolicyRawDocument!) {
      dataAccessPolicyCreate(
        policy: $policy
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    ```json
    {
      "policy": {
        "rules": [
          {"operations": ["SELECT"], "eventTypes": {"allow": ["*"], "except": []}}
        ]
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **Obrigatório.** Seu ID de organização do New Relic.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Obrigatório.** Um nome descritivo para a política.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Obrigatório.** O objeto JSON que define as regras da política com `operations` e `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "dataAccessPolicyCreate": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            O identificador único da política de acesso a dados recém-criada.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            O nome da política de acesso aos dados.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            O objeto JSON contendo as regras de política com `operations` e `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            O estado da política (ex.: `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="update-policy" title="Atualizar uma política de acesso a dados">
    Essa mutação atualiza uma política de acesso a dados existente para modificar suas regras ou seu nome.

    ### Mutação de amostra

    ```graphql
    mutation {
      dataAccessPolicyUpdate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_inaccessible"]}}]}
        name: "Test"
        id: "YOUR_DATA_POLICY_ID"
      ) {
        dataAccessPolicy {
          name
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Obrigatório.** O ID da política a ser atualizada.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **Opcional.** Nome atualizado para a apólice.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **Opcional.** O objeto JSON que define as regras de política atualizadas com `operations` e `eventTypes`.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "dataAccessPolicyUpdate": {
          "dataAccessPolicy": {
            "assigned": "UNASSIGNED",
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `assigned`
          </td>

          <td>
            Indica se a política está atribuída a alguma subvenção (ex.: `UNASSIGNED`).
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            O identificador único da política de acesso a dados atualizada.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            O nome da política de acesso aos dados.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            O objeto JSON contendo as regras de política atualizadas com `operations` e `eventTypes`.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            O estado da política (ex.: `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="delete-policy" title="Excluir uma política de acesso a dados">
    Essa mutação exclui uma política de acesso a dados existente.

    <Callout variant="important">
      Excluir uma política a remove de todas as concessões atribuídas. Usuários em grupos com essas permissões perderão as restrições de acesso a dados definidas pela política.
    </Callout>

    ### Mutação de amostra

    ```graphql
    mutation {
      dataAccessPolicyDelete(id: "YOUR_DATA_POLICY_ID") {
        dataAccessPolicy {
          name
          id
          policy
          status
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **Obrigatório.** O ID da política a ser excluída.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "dataAccessPolicyDelete": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            O identificador único da política de acesso aos dados excluídos.
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            O nome da política de acesso aos dados excluídos.
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            O objeto JSON contendo as regras de política que foram excluídas.
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            O estado da política (ex.: `VALID`).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="grant-access" title="Criar uma concessão de acesso com uma política de acesso a dados">
    Essa mutação cria uma nova concessão de acesso que inclui uma política de acesso a dados, atribuindo-a a uma conta e função específicas.

    ### Mutação de amostra

    ```graphql
    mutation {
      authorizationManagementGrantAccess(
        grantAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Obrigatório.** O ID da conta à qual conceder acesso.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Obrigatório.** O ID da política de acesso a dados a ser aplicada.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Obrigatório.** O ID da função define as permissões.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta

    A resposta mostra a concessão de acesso recém-criada com seu ID.
  </Collapser>

  <Collapser id="update-grant" title="Atualizar uma concessão de acesso com uma política de acesso a dados">
    Esta mutação atualiza uma concessão de acesso existente para adicionar ou alterar a política de acesso aos dados.

    ### Mutação de amostra

    ```graphql
    mutation {
      authorizationManagementUpdateAccess(
        updateAccessOptions: {accountAccessGrant: {dataAccessPolicyId: "YOUR_DATA_POLICY_ID"}, ids: YOUR_GRANT_ID}
      ) {
        grants {
          dataAccessPolicy {
            id
          }
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ids`
          </td>

          <td>
            **Obrigatório.** O ID da concessão precisa ser atualizado.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Obrigatório.** O ID da política de acesso a dados a ser aplicada à concessão.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta de amostra

    ```json
    {
      "data": {
        "authorizationManagementUpdateAccess": {
          "grants": [
            {
              "dataAccessPolicy": {
                "id": "YOUR_DATA_POLICY_ID"
              },
              "id": "YOUR_GRANT_ID"
            }
          ]
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Campo de resposta
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `grants`
          </td>

          <td>
            Lista de subsídios atualizados.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy.id`
          </td>

          <td>
            O ID da política de acesso a dados agora atribuída à concessão.
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            O ID da concessão atualizada.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="revoke-grant" title="Revogar uma concessão de acesso com uma política de acesso a dados">
    Essa mutação remove uma concessão de acesso que inclui uma política de acesso a dados.

    ### Mutação de amostra

    ```graphql
    mutation {
      authorizationManagementRevokeAccess(
        revokeAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            Parâmetro
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **Obrigatório.** O ID da conta da concessão a ser revogada.
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **Obrigatório.** O ID da política de acesso aos dados da concessão a ser revogada.
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **Obrigatório.** O ID da função da concessão a ser revogada.
          </td>
        </tr>
      </tbody>
    </table>

    ### Resposta

    A resposta mostra a concessão de acesso revogada com seu respectivo ID.
  </Collapser>
</CollapserGroup>

## Tópicos relacionados [#related-topics]

<DocTiles>
  <DocTile title="Guia de interface do usuário para controle de acesso a dados" path="/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control">
    Aprenda a gerenciar políticas de acesso a dados por meio da interface do usuário do New Relic.
  </DocTile>

  <DocTile title="Conceitos de gerenciamento de usuários" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">
    Compreender os tipos de usuários, funções e gerenciamento de acesso.
  </DocTile>

  <DocTile title="Gerenciar usuário com NerdGraph" path="/docs/apis/nerdgraph/examples/nerdgraph-manage-users">
    Utilize a API do NerdGraph para gerenciar programaticamente usuários e permissões de acesso.
  </DocTile>

  <DocTile title="Partições de log" path="/docs/logs/ui-data/data-partitions/">
    Aprenda como organizar seus dados de log em partições.
  </DocTile>
</DocTiles>