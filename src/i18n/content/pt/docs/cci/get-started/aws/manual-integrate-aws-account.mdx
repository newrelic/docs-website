---
title: Integre manualmente sua conta da AWS
tags:
  - cloud cost intelligence
  - aws
  - amazon web services
  - aws cost management
  - cloud cost optimization
  - cci aws
  - manual aws setup
metaDescription: Manually integrate your AWS account with Cloud Cost Intelligence by configuring required AWS resources and settings.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

Integre manualmente sua conta da AWS ao Cloud Cost Intelligence configurando os recursos e configurações necessários da AWS. Este método oferece controle total sobre cada etapa de configuração.

## Instruções de configuração

<Callout variant="important">
  Para as etapas a seguir, faça login no **Console de Gerenciamento da AWS** e permaneça conectado durante todo o processo.
</Callout>

<Steps>
  <Step>
    ### Criar bucket S3 para relatórios de Custo e Uso [#create-s3-bucket]

    Crie um bucket S3 para armazenar os Relatórios de Custos e Uso (CUR) da AWS. Recomendamos o uso da região `us-east-2`.

    1. Navegue até o **S3 service** e clique em **Create bucket**.

    2. Insira um nome de bucket exclusivo (por exemplo, `<your-company-name>-billing`).

    3. Configurar as definições do bucket:

       * Ativar versionamento
       * Desativar o acesso público (recomendado)
       * Ativar a criptografia padrão (recomendado)

    4. **Tags (Opcional)**: Adicione quaisquer tags, se necessário, para o gerenciamento de recursos da sua organização e clique em **Create bucket**.

    <Callout variant="important">
      Lembre-se do nome do bucket para as próximas etapas.
    </Callout>
  </Step>

  <Step>
    ### Configure os Relatórios de Custo e Uso da AWS [#create-cur]

    Crie um **Cost and Usage Report** para ser entregue ao seu bucket S3:

    1. Navegue até **Billing Dashboard** &gt; **Cost &amp; Usage Analysis** &gt; **Data Exports** e clique em **Create**.

    2. Configurar as definições do relatório:

       <table>
         <thead>
           <tr>
             <th width={250}>
               **Contexto**
             </th>

             <th>
               **Valor**
             </th>

             <th>
               **Descrição**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               Tipo de exportação
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               Informações detalhadas de uso e custo para faturamento e análise de custos.
             </td>
           </tr>

           <tr>
             <td>
               Nome da exportação
             </td>

             <td>
               `Name`
             </td>

             <td>
               Nome para o relatório CUR (por exemplo, `<company-name>-billing-cci`).
             </td>
           </tr>

           <tr>
             <td>
               Tabela de dados
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               Suporta a estrutura de tabela mais recente do formato FOCUS.
             </td>
           </tr>

           <tr>
             <td>
               Incluir IDs de recursos
             </td>

             <td>
               `ON`
             </td>

             <td>
               Permite o rastreamento detalhado dos custos por recursos individuais da AWS.
             </td>
           </tr>

           <tr>
             <td>
               Dados de alocação de custos divididos
             </td>

             <td>
               `OFF`
             </td>

             <td>
               Simplifica a estrutura de dados. Deixe de fora, a menos que sejam necessárias divisões detalhadas de alocação de custos.
             </td>
           </tr>

           <tr>
             <td>
               Granularidade temporal
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               Necessário para análise detalhada de custos e uso.
             </td>
           </tr>

           <tr>
             <td>
               Tipo de compressão
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               Formato de armazenamento colunar que aprimora o desempenho da consulta e reduz o espaço de armazenamento.
             </td>
           </tr>

           <tr>
             <td>
               Controle de versão de arquivos
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               Cria uma nova versão a cada atualização, retendo relatórios históricos para auditoria.
             </td>
           </tr>

           <tr>
             <td>
               Configurações de atualização de dados
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               Mantém os dados do CUR atualizados automaticamente.
             </td>
           </tr>

           <tr>
             <td>
               Configuração de exportação de dados no bucket S3
             </td>

             <td>
               Selecione o bucket que você criou em [Criar bucket S3 para relatórios de custo e uso](#create-s3-bucket)
             </td>

             <td>
               Os arquivos CUR são salvos no bucket S3. Concorde em sobrescrever a política.
             </td>
           </tr>

           <tr>
             <td>
               prefixo do caminho S3
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               Organiza os Relatórios de Custos e Uso dentro do bucket S3.
             </td>
           </tr>
         </tbody>
       </table>

    3. Clique em **Next** e depois em **Create report**.

    <Callout variant="important">
      Lembre-se do nome da exportação para a integração CCI. Certifique-se de que o prefixo do caminho S3 seja `cost-and-usage-reports`. O primeiro relatório é entregue em 24 horas; os relatórios subsequentes são entregues periodicamente.
    </Callout>
  </Step>

  <Step>
    ### Criar política IAM para acesso CCI [#create-iam-policy]

    Crie uma política de Identity and Access Management (IAM) que conceda permissões ao CCI para acessar seus dados do CUR:

    1. Navegue para **IAM service** &gt; **Policies** e clique em **Create policy**.
    2. Mude para o **editor JSON (JSON editor)** e cole a seguinte política:

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      Substitua `bucket-name` pelo nome do seu bucket S3 em [Criar bucket S3 para relatórios de custo e uso](#create-s3-bucket).
    </Callout>

    3. Clique em **Next**.
    4. Nomeie a política `CCI-Access-Policy` (ou seu nome preferido), adicione uma descrição e clique em **Create policy**.
  </Step>

  <Step>
    ### Criar função IAM para CCI assumir [#create-iam-role]

    Crie uma função do IAM que o CCI assumirá para acessar seus dados CUR:

    1. Navegue até **IAM service** &gt; **Roles** e clique em **Create role**.
    2. Selecione **Custom Trust Policy** na seção de tipo de entidade confiável e cole a seguinte definição de função:
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="important" title="Observação">
      O `externalId` é gerado quando você inicia a integração do CCI.
    </Callout>

    3. Clique em **Next**.
    4. Anexe a política criada em [Create IAM policy for CCI access](#create-iam-policy) e clique em **Next**.
    5. Nomeie a função `CCI-Access-Role` (ou seu nome preferido), adicione uma descrição (opcional) e clique em **Create role**.
    6. Anote o ARN da função (Amazon Resource Name) na página de resumo da função.

    <Callout variant="important">
      Você precisará do ARN da função durante a integração do CCI.
    </Callout>
  </Step>

  <Step>
    ### Integre manualmente sua conta da AWS [#access-integration]

    1. Navegue até <DNT>[**one.newrelic.com**](https://one.newrelic.com/) &gt; **Integrations &amp; Agents** &gt; **Cloud Cost Intelligence - AWS**</DNT>.
    2. Selecione **Manually integrate your AWS account** e clique em **Continue**.
  </Step>

  <Step>
    ### Forneça detalhes de conexão [#provide-connection-details]

    Insira os detalhes necessários:

    * **Nome da conexão**: Nome padrão fornecido. Editar para nome personalizado.
    * **ARN da função do IAM entre contas**: Insira o ARN da função do IAM (Amazon Resource Name) para permitir que o Cloud Cost Intelligence acesse seu bucket do S3 (formato: `arn:aws:iam::<account-id>:role/<role-name>`).
    * **ID externo**: Copie o ID externo e adicione-o à sua política de confiança da função do IAM na AWS.
    * **Nome da exportação de dados**: Insira o nome do arquivo de exportação de dados. Para o relatório `cci-ingestion-test`, o caminho é `cost-and-usage-reports/cci-ingestion-test/data`.
    * **Nome do bucket S3**: Insira o nome exato do bucket. Use a região `us-east-2` para um desempenho ideal.
  </Step>

  <Step>
    ### Configurar política de confiança [#configure-trust-policy]

    Adicione o usuário global do New Relic (`arn:aws:iam::207192125115:user/cci_global_user`) à sua política de confiança da função IAM:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": {
            "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
          },
          "Action": "sts:AssumeRole",
          "Condition": {
            "StringEquals": {
              "sts:ExternalId": "<externalID>"
            }
          }
        }
      ]
    }
    ```

    <Callout variant="important">
      Defina `sts:ExternalId` como o ID externo de [Fornecer detalhes da conexão](#provide-connection-details). Ative o AWS Security Token Service (STS) para regiões onde ele não está ativo por padrão (por exemplo, `ap-east-1`, `eu-south-1`).
    </Callout>
  </Step>

  <Step>
    ### Conexão de teste [#test-connection]

    Clique em **Test connection** para verificar a conexão com seu ambiente AWS.

    <Callout variant="important">
      O processamento inicial de dados leva algumas horas após a conclusão da configuração.
    </Callout>
  </Step>
</Steps>

## Opcional: Habilitar recursos avançados

Habilite esses recursos opcionais para aprimorar sua análise de custos da AWS.

### Estimativa de custos em tempo real [#real-time-cost-estimation]

Para habilitar a visualização de custos estimados em tempo real no CCI, atenda aos pré-requisitos para seu método de instrumentação:

<table>
  <thead>
    <tr>
      <th>
        Método
      </th>

      <th>
        Descrição
      </th>

      <th>
        Quando escolher
      </th>

      <th>
        Pré-requisitos
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        agente de infraestrutura e integração
      </td>

      <td>
        Utiliza o agente New Relic Infrastructure para monitoramento detalhado.
      </td>

      <td>
        Para visibilidade/controle profundos, ideal para configurações EC2, EKS/EC2 ou ECS/EC2 autônomas.
      </td>

      <td>
        * EC2 autônomo: Instale o agente de infraestrutura New Relic.
        * EKS/EC2: Instale a integração do Kubernetes.
        * ECS/EC2: Instale a integração ECS. Não suportado para AWS Fargate.
      </td>
    </tr>

    <tr>
      <td>
        integração na nuvem (métrica)
      </td>

      <td>
        Utiliza as métricas AWS do CloudWatch para monitoramento quase em tempo real.
      </td>

      <td>
        Quando dados em tempo real são essenciais para ambientes dinâmicos.
      </td>

      <td>
        Configure 

        [CloudWatch Metric Streams](/install/aws-cloudwatch/)

        .
      </td>
    </tr>

    <tr>
      <td>
        integração na nuvem (polling) - legado
      </td>

      <td>
        Coleta dados consultando os serviços da AWS em intervalos regulares.
      </td>

      <td>
        Para ambientes que toleram atualizações menos frequentes.
      </td>

      <td>
        Configure 

        [a integração de pesquisaAWS ](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        .
      </td>
    </tr>
  </tbody>
</table>

### Alocação de custos do Kubernetes [#k8s-cost-allocation]

* [Instale a integração do Kubernetes](https://docs.newrelic.com/install/kubernetes/). A integração do AWS Fargate não é compatível.
* Além dos rótulos Kubernetes padrão (`app.kubernetes.io/name`, `app.kubernetes.io/instance`, `app.kubernetes.io/component` e `app.kubernetes.io/part-of`), adicione rótulos personalizados como `environment` e `team` e tags de recursos personalizadas como `project` e `costCenter` para melhor segmentação e análise de custos.

## Recomendações

* Configure [tags de alocação de custos](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html) em sua conta AWS. Aplique pelo menos duas tags de recursos personalizadas de forma consistente em todos os recursos da AWS para filtragem e agrupamento de custos eficazes.
* Use um bucket S3 na região `us-east-2` para desempenho e eficiência de custos ideais.

## Aviso sobre controle de acesso

Todos os usuários com acesso à conta/organização New Relic designada podem visualizar seus dados de custos da nuvem AWS. Selecione a conta/organização New Relic apropriada que se alinha com suas políticas internas de controle de acesso.

<Callout variant="important">
  **Acesso ao bucket S3**

  O New Relic requer apenas acesso de leitura ao seu bucket S3, limitado a uma única função IAM. Mantenha este nível de acesso para proteger seus dados.
</Callout>

<DocTiles numbered>
  <DocTile title="Overview of Cloud Cost Intelligence - AWS" path="/docs/cci/get-started/aws/aws-cci" />

  <DocTile title="Automate AWS with CloudFormation" path="/docs/cci/get-started/aws/automated-setup-cloudformation" />

  <DocTile title="Manually integrate your AWS account" label={{text: 'You are here', color: '#FCD672'}} path="/docs/cci/get-started/aws/manual-integrate-aws-account" />
</DocTiles>