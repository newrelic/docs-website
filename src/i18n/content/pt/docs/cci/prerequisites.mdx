---
title: Pré-requisitos para a certificação AWS CCI
metaDescription: 'Set up AWS for CCI with consolidated billing, CUR, IAM roles, and region activation to optimize cost analysis in New Relic.'
redirect:
  - /docs/cci/getting-started/prerequisites
freshnessValidatedDate: never
translationType: machine
---

<Callout title="visualização">
  Ainda estamos trabalhando nesse recurso, mas adoraríamos que você experimentasse!

  Atualmente, esse recurso é fornecido como parte de um programa de visualização de acordo com nossas [políticas de pré-lançamento](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

## Visão geral

Prepare seu ambiente AWS para a integração com a Inteligência de Custos na Nuvem (CCI) seguindo estes pré-requisitos, incluindo a configuração do faturamento consolidado, a ativação dos relatórios de custo e uso, a configuração de funções e políticas do IAM para acesso seguro e a ativação das regiões AWS necessárias. Garanta que sua configuração suporte uma análise e gestão de custos eficazes dentro da plataforma New Relic.

## Pré-requisitos

<CollapserGroup>
  <Collapser id="aws-account-permissions" title="Conta AWS com as permissões apropriadas">
    Certifique-se de que o [faturamento consolidado esteja configurado para a organização AWS ](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html). Isso consolida a cobrança em todas as contas da sua organização para uma gestão de custos unificada.
  </Collapser>

  <Collapser id="s3-bucket-creation" title="Bucket S3 para relatórios de custo e utilização">
    Os relatórios de custo e uso da AWS (CUR) serão armazenados em um bucket do S3. Recomendamos que o bucket S3 seja criado na região `us-east-2`. Siga estes passos para criar um bucket dedicado:

    1. Faça login no **Console de Gerenciamento da AWS (AWS Management Console)**.

    2. Acesse o serviço S3.

    3. Clique em **Create bucket**.

    4. Insira um nome de bucket exclusivo (ex: `<your-company-name>-billing`).

    5. Configurar as definições do bucket:

       * Ativar versionamento
       * Desativar o acesso público (recomendado)
       * Ativar a criptografia padrão (recomendado)

    6. **Etiqueta (Opcional)**: Adicione qualquer etiqueta, se necessário, para a gestão de recursos da sua organização.

    7. Clique em **Create bucket**.

    <Callout variant="important">
      Lembre-se do nome do bucket, pois você precisará dele nas etapas seguintes e nas etapas de instalação no CCI.
    </Callout>
  </Collapser>

  <Collapser id="s3-bucket-creation" title="Configuração de relatórios de uso e custo AWS">
    Crie um relatório de custos e utilização para ser enviado ao seu bucket S3:

    1. Faça login no **Console de Gerenciamento da AWS (AWS Management Console)**.

    2. Acesse o **Billing Dashboard**.

    3. No painel de navegação à esquerda, clique em **Cost &amp; Usage Analysis**.

    4. Clique em **Data Exports** e, em seguida, em **Create**.

    5. Configurar as definições do relatório:

       <table>
         <thead>
           <tr>
             <th width={250}>
               **Contexto**
             </th>

             <th>
               **Valor**
             </th>

             <th>
               **Descrição**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               Tipo de exportação
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               Fornece informações detalhadas sobre uso e custos, adequadas para a maioria dos casos de uso de faturamento e análise de custos.
             </td>
           </tr>

           <tr>
             <td>
               Nome da exportação
             </td>

             <td>
               `Name`
             </td>

             <td>
               Nome da exportação que fornece contexto ao relatório CUR. (`eg-<company name-billing-cci>`)&gt;
             </td>
           </tr>

           <tr>
             <td>
               Tabela de dados
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               O CUR 2.0 suporta a estrutura de tabela no formato FOCUS mais recente.
             </td>
           </tr>

           <tr>
             <td>
               Incluir IDs de recursos
             </td>

             <td>
               `ON`
             </td>

             <td>
               Permite o rastreamento detalhado dos custos associados a recursos individuais da AWS, auxiliando na análise e faturamento precisos.
             </td>
           </tr>

           <tr>
             <td>
               Dados de alocação de custos divididos
             </td>

             <td>
               `OFF`
             </td>

             <td>
               Caso não seja estritamente necessário, manter essa opção desativada simplifica a estrutura de dados. Isso evita a separação de dados com base em categorias ou divisões de custos personalizadas. Esta informação pode ser omitida, a menos que sejam necessárias divisões detalhadas da alocação de custos para a sua análise.
             </td>
           </tr>

           <tr>
             <td>
               Granularidade temporal
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               Define a granularidade do tempo para horária. Essa configuração é essencial para permitir análises detalhadas de custos e uso, o que dá suporte à funcionalidade da plataforma.
             </td>
           </tr>

           <tr>
             <td>
               Tipo de compressão
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               Um formato de arquivo de armazenamento colunar que melhora o desempenho da consulta e reduz o espaço de armazenamento, sendo benéfico para o processamento eficiente de grandes volumes de dados.
             </td>
           </tr>

           <tr>
             <td>
               Controle de versão de arquivos
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               Cada atualização do CUR cria uma nova versão. Isso preserva os relatórios históricos, que são úteis para auditoria e acompanhamento das mudanças de custos ao longo do tempo.
             </td>
           </tr>

           <tr>
             <td>
               Configurações de atualização de dados
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               Garante que os dados CUR sejam mantidos atualizados com as informações mais recentes de uso e custo, sem intervenção manual.
             </td>
           </tr>

           <tr>
             <td>
               Configuração de exportação de dados no bucket S3
             </td>

             <td>
               `Existing (Select the bucket created in Step 1)`
             </td>

             <td>
               O arquivo CUR criado será salvo no bucket S3 com um caminho definido, conforme descrito abaixo. Concordo em sobrescrever a política (na próxima etapa, mapearemos a política para uma nova).
             </td>
           </tr>

           <tr>
             <td>
               prefixo do caminho S3
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               Garante que seus Relatórios de Custo e Uso (CUR) sejam organizados e armazenados corretamente no bucket S3, facilitando o acesso e o gerenciamento eficientes.
             </td>
           </tr>
         </tbody>
       </table>

    6. Clique em **Next** e depois em **Create report**.

    <Callout variant="important">
      Lembre-se do nome da exportação, pois você precisará dele na etapa de integração no CCI. Além disso, verifique se o prefixo do caminho S3 é cost-and-usage-reports.
    </Callout>

    <Callout variant="caution" title="Observação">
      O primeiro relatório CUR será entregue em até 24 horas. Os relatórios subsequentes são entregues periodicamente.
    </Callout>
  </Collapser>

  <Collapser id="iam-policy-cci-access" title="Política IAM para acesso CCI">
    Crie uma política IAM que conceda à CCI as permissões necessárias para acessar seus dados CUR:

    1. Faça login no **Console de Gerenciamento da AWS (AWS Management Console)**.
    2. Acesse o **IAM service**.
    3. Clique em **Policies** no painel de navegação à esquerda.
    4. Clique em **Create policy**.
    5. Mude para o **editor JSON (JSON editor)** e cole a seguinte política:

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      Substitua \`bucket-name\` pelo nome real do bucket S3 que você criou na etapa **S3 bucket for Cost and Usage reports**.
    </Callout>

    6. Clique em **Next**.
    7. Dê o nome `CCI-Access-Policy` à política (ou o nome que preferir).
    8. Adicione uma descrição.
    9. Clique em **Create policy**.
  </Collapser>

  <Collapser id="iam-role-cci-access" title="Papel do IAM para a CCI assumir">
    Crie uma função do IAM que o CCI assumirá para acessar seus dados CUR:

    1. Faça login no **Console de Gerenciamento da AWS (AWS Management Console)**.
    2. Acesse o serviço IAM.
    3. Clique em **Roles** no painel de navegação à esquerda.
    4. Clique em **Create role**.
    5. Selecione **Custom Trust Policy** na seção &quot;Tipo de entidade confiável&quot;.
    6. Cole a seguinte definição de função no editor:
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="caution" title="Observação">
      O externalId é um identificador exclusivo dinâmico do serviço de integração CCI, ele é gerado assim que voltamos ao CCI para iniciar a integração.
    </Callout>

    7. Clique em **Next**.
    8. Anexe a política criada na [política IAM para a etapa de acesso CCI](#iam-policy-cci-access).
    9. Clique em **Next**.
    10. Nome da função: `CCI-Access-Role` (ou o nome de sua preferência).
    11. Adicione uma descrição (opcional).
    12. Clique em **Create role**.
    13. Após a criação da função, anote o ARN da função (exibido na página de resumo da função).

    <Callout variant="important">
      Você precisará fornecer o ARN da função à CCI durante o processo de integração.
    </Callout>
  </Collapser>
</CollapserGroup>

## Pré-requisitos para estimativa de custos em tempo real

Para habilitar a visualização de custos estimados em tempo real no CCI, certifique-se de atender aos pré-requisitos específicos associados ao seu método de instrumentação:

<table>
  <thead>
    <tr>
      <th>
        Método
      </th>

      <th>
        Descrição
      </th>

      <th>
        Quando escolher
      </th>

      <th>
        Pré-requisitos
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        agente de infraestrutura e integração
      </td>

      <td>
        Utiliza o agente New Relic Infrastructure para monitoramento detalhado.
      </td>

      <td>
        Selecione esta opção para obter visibilidade e controle detalhados, ideal para configurações EC2 autônomas, EKS/EC2 ou ECS/EC2.
      </td>

      <td>
        * Se você tiver uma instância EC2 independente, instale o agente de infraestrutura New Relic.
        * Se você utiliza EKS/EC2, instale a integração com o Kubernetes.
        * Se você tiver ECS/EC2, instale a integração com o ECS. Este método não é compatível com o AWS Fargate.
      </td>
    </tr>

    <tr>
      <td>
        integração na nuvem (métrica)
      </td>

      <td>
        Utiliza as métricas AWS do CloudWatch para monitoramento quase em tempo real.
      </td>

      <td>
        Opte por essa opção quando os dados em tempo real forem essenciais. Adequado para ambientes dinâmicos que necessitam de insights atualizadas.
      </td>

      <td>
        Configure 

        [CloudWatch Metric Streams](/install/aws-cloudwatch/)

        .
      </td>
    </tr>

    <tr>
      <td>
        integração na nuvem (polling) - legado
      </td>

      <td>
        Coleta dados consultando os serviços da AWS em intervalos regulares.
      </td>

      <td>
        Adequado para ambientes que toleram atualizações menos frequentes. A opção legada é usada quando a abordagem baseada em métricas é menos viável.
      </td>

      <td>
        Configure 

        [a integração de pesquisaAWS ](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        .
      </td>
    </tr>
  </tbody>
</table>

## Pré-requisitos para alocação de custos do Kubernetes

* [Instale a integração com o Kubernetes](https://docs.newrelic.com/install/kubernetes/). A integração com o AWS Fargate não é compatível com este recurso.
* Além dos rótulos padrão do Kubernetes (`app.kubernetes.io/name`, `app.kubernetes.io/instance`, `app.kubernetes.io/component` e `app.kubernetes.io/part-of`), considere adicionar dois rótulos personalizados, como `environment` e `team` para indicar o ambiente de implantação e a equipe responsável. Considere também adicionar duas tags de recursos personalizadas, como `project` e `costCenter`. Essas etiquetas e tags de recursos ajudarão você a segmentar e analisar melhor seus dados de alocação de custos Kubernetes.

## Recomendações

* Configure [as tags de alocação de custos](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html) na sua conta da AWS. A etiqueta facilita a categorização de custos detalhada e significativa. Garanta que pelo menos duas tags de recursos personalizadas sejam aplicadas de forma consistente em todos os seus recursos AWS para uma filtragem e agrupamento de custos eficazes.
* Use um bucket S3 localizado na região `us-east-2` para obter desempenho ideal e eficiência de custos.

## Aviso sobre controle de acesso

Todos os usuários com acesso à conta/organização New Relic designada podem visualizar seus dados de custos da nuvem da AWS dentro da Inteligência de Custos na Nuvem. Recomendamos que você selecione cuidadosamente a conta/organização New Relic mais adequada e alinhada às suas políticas internas de controle de acesso para garantir o manuseio seguro e em conformidade dos dados de custos cloud.

<Callout variant="important">
  **Acesso ao bucket S3**

  O New Relic requer apenas acesso de leitura ao seu bucket S3, e esse acesso é limitado a uma única função IAM do lado do New Relic. Garanta que esse nível de acesso seja mantido para proteger seus dados e, ao mesmo tempo, facilitar as operações necessárias.
</Callout>