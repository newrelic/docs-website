---
title: Atualizar o agente Node.js
tags:
  - Agents
  - Nodejs agent
  - Installation and configuration
metaDescription: 'How to update your APM Node.js agent, and notes on EOL support for early agent versions.'
freshnessValidatedDate: never
translationType: machine
---

Para aproveitar ao máximo os recursos, melhorias e patches de segurança importantes do New Relic, recomendamos que você atualize seu agente Node.js para a versão mais recente. Para obter informações adicionais sobre atualizações específicas do agente, consulte as [notas de versão do agente Node.js.](/docs/release-notes/agent-release-notes/nodejs-release-notes) As notas de versão incluem um link para download quando aplicável, além de instruções para baixar e [instalar](/docs/agents/nodejs-agent/installation-configuration/install-nodejs-agent) a versão mais recente.

* Se o módulo `newrelic` estiver listado em `package.json`, execute `npm install`.
* Se você deseja destinar apenas o módulo `newrelic` , execute `npm update newrelic`.

Recomendação: teste sua versão atualizada antes de colocá-la em produção. Se você tiver problemas, siga os [procedimentos de agente de resolução de problemas](/docs/agents/nodejs-agent/troubleshooting/troubleshooting-your-nodejs-installation) do Node.js.

## Atualize para o agente Node.js versão 11 [#node-agent-v11]

Antes de atualizar para o Node.js versão 11, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v11**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Adicionado suporte de paridade oficial para Node.js 20.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: Suporte ao Node.js 14 eliminado.
      </td>

      <td>
        * Para mais informações consulte nossa [política de suporte](/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: carregador ESM atualizado para oferecer suporte ao Node.js 20.
      </td>

      <td>
        * Agora você deve usar os argumentos `--experimental-loader` e `-r` ao executar um aplicativo.
        * `node --experimental-loader newrelic/esm-loader.mjs -r newrelic path/to/app.js`
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: o gerenciador de contexto padrão foi atualizado para AsyncLocalContextManager.
      </td>

      <td>
        * O LegacyContextManager padrão anterior pode ser restaurado definindo o sinalizador de recurso de `config.feature_flag.legacy_context_manager` como `true`.
        * Se preferir variáveis de ambiente, você pode definir `NEW_RELIC_FEATURE_FLAG_LEGACY_CONTEXT_MANAGER` como `true`.
        * Observe que este gerenciador de contexto será removido em versões futuras. Se você achar que precisa voltar a usar esse gerenciador de contexto legado, levante a questão com [o suporte da New Relic](https://support.newrelic.com/s/) ou com um [problema do GitHub](https://github.com/newrelic/node-newrelic/issues/new?assignees=&labels=bug%2C+needs-triage&projects=&template=bug_report.md&title=).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: renomeado `shim.handleCATHeaders` para `shim.handleMqTracingHeaders`.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        Atualize a dependência do New Relic para versões com suporte de versão Node.js atualizado
      </td>

      <td>
        * @newrelic/AWS-sdk v7.0.0
        * @newrelic/koa v8.0.0
        * @newrelic/native-métrica v10.0.0
        * @newrelic/superagente v7.0.0
        * @newrelic/test-utilities v8.0.0
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v11]

Node.js 16 é a versão mais antiga suportada pelo agente New Relic Node.js v11. Node.js 14 e 15 não são suportados pela v11. Os clientes que executam o Node.js 15 e versões anteriores têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v11.
* Permanecer no agente New Relic Node.js v10 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 16.
</Callout>

## Atualizar para o agente Node.js versão 10 [#node-agent-v10]

Antes de atualizar para o Node.js versão 10, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v11**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        * Adicionada a capacidade de registrar vários ganchos de instrumentação (onRequire, onResolved) para o mesmo moduleName resolvido.
      </td>

      <td>
        * Esta tem sido uma limitação do agente desde o início.
        * Se você usasse a API para o instrumento api.instrument, api.instrumentDatastore, api.instrumentWebframework, api.instrumentMessages, ou api.instrumentConglomerate, ela substituiria os ganchos de instrumentação existentes.
        * O efeito foi que o agente Node.js não funcionaria conforme planejado.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: o padrão `config.transaction_tracer.record_sql` foi atualizado de desativado para ofuscado. Isso significa que as instruções SQL serão capturadas, mas ofuscadas.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: Os parâmetros Route (URL) agora são armazenados como `request.parameters.route.*` atributo na transação, segmentos raiz e spans.
      </td>

      <td>
        * O parâmetro de consulta estará disponível como atributo prefixado com request.parameters.\* sobre transação e Spans.
        * O parâmetro Route estará disponível como atributo prefixado com request.parameters.route.\* sobre transação e Spans.
        * Os parâmetros de rota (também conhecidos como parâmetros de url) são um recurso comum de vários frameworks da web, onde você pode criar um espaço reservado como parte de uma definição de rota de API.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: CaptureUrlParams removido da classe WebFrameworkShim.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**DEPRECATION NOTICE**</DNT>: shim.unwrap e shim.unwrapOnce não funcionarão mais se você tentar desembrulhar um item que foi empacotado diversas vezes.
      </td>

      <td>
        * Isso ocorre porque como agora permitimos instrumentar o mesmo módulo mais de uma vez, você não pode desembrulhar com segurança sem quebrar toda a instrumentação registrada. Planejamos remover shim.unwrap e shim.unwrapOnce na próxima versão principal.
      </td>
    </tr>

    <tr>
      <td>
        Atualize a dependência do New Relic para versões com suporte de versão Node.js atualizado
      </td>

      <td>
        * @newrelic/AWS-sdk v7.0.0
        * @newrelic/koa v8.0.0
        * @newrelic/native-métrica v10.0.0
        * @newrelic/superagente v7.0.0
        * @newrelic/test-utilities v8.0.0
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v10]

Node.js 14 é a versão mais antiga compatível com o agente New Relic Node.js v10. Node.js 12 e 13 não são suportados pela v10. Os clientes que executam o Node.js 13 e versões anteriores têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v10.
* Permanecer no agente New Relic Node.js v8 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 14.
</Callout>

## Atualizar para o agente Node.js versão 9 [#node-agent-v9]

Antes de atualizar para o Node.js versão 9, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v9**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Adicionado suporte de paridade oficial para Node.js 18.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: Suporte ao Node.js 12 eliminado.
      </td>

      <td>
        * Para mais informações consulte nossa [política de suporte](/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: o agente não inclui mais o pacote de certificados New Relic automaticamente ao usar a configuração de &amp;apos;certificados&amp;apos; (geralmente com proxies).
      </td>

      <td>
        * O agente não inclui mais o pacote de certificados New Relic ao usar a configuração de 'certificados' (geralmente com proxies). Se você achar que isso prejudica seu ambiente atual, recomendamos obter um pacote CA como o da Mozilla.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: O agente agora exclui a porta ao fazer solicitações HTTPS externas para a porta 443 para estar em conformidade com a especificação e outros agentes
      </td>

      <td>
        * Os segmentos externos anteriores seriam nomeados `External/example.com:443` ao usar a porta HTTPS padrão.
        * O segmento externo agora será denominado `External/example.com`.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: capacidade de desativar o rastreamento de contexto de promessa baseado em ganchos assíncronos por meio da sinalização de recurso `await_support` foi removida. Isso também remove a instrumentação herdada do Promise.
      </td>

      <td>
        * Lançada a sinalização do recurso `await_support` . O agente agora depende de async_hooks para rastrear a propagação de promessas assíncronas. O resultado líquido é que se você tivesse `feature_flag.await_support` definido como falso, a instrumentação herdada rastrearia cada função em uma cadeia de promessas como um segmento separado.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: instrumentação removida para o pacote obsoleto [oracle](https://www.npmjs.com/package/oracle) npm.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: atualização da versão mínima de `pg` para 8.2.x. Esta é a versão de suporte mais antiga executada em Node.js 14+.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: Atualizada a versão mínima suportada do hapi para v20.0.0.
      </td>

      <td>
        * Todas as versões anteriores à v20.0.0 foram descontinuadas pelo hapi por motivos de segurança. Veja [a política de suporte deles](https://hapi.dev/policies/support/).
      </td>
    </tr>

    <tr>
      <td>
        Atualize a dependência do New Relic para versões com suporte de versão Node.js atualizado
      </td>

      <td>
        * @newrelic/AWS-sdk v5.0.0
        * @newrelic/koa v7.0.0
        * @newrelic/native-métrica v9.0.0
        * @newrelic/superagente v6.0.0
        * @newrelic/test-utilities v7.0.0
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v9]

Node.js 14 é a versão mais antiga suportada pelo agente New Relic Node.js v9. Node.js 12 e 13 não são suportados pela v9. Os clientes que executam o Node.js 13 e versões anteriores têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v9.
* Permanecer no agente New Relic Node.js v8 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 14.
</Callout>

## Atualize para o agente Node.js versão 8 [#node-agent-v8]

Antes de atualizar para o Node.js versão 8, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v8**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Adicionado suporte de paridade oficial para Node.js 16.
      </td>

      <td/>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: Suporte ao Node.js v10.x eliminado.
      </td>

      <td>
        * Para mais informações consulte nossa [política de suporte](/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: `serverless_mode` foi removido como sinalizador de recurso.
      </td>

      <td>
        * A configuração padrão `serverless_mode` ainda existe.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT>: o agente não inclui mais o pacote de certificados New Relic automaticamente ao usar a configuração de &amp;apos;certificados&amp;apos; (geralmente com proxies).
      </td>

      <td>
        * Se você achar que isso prejudica seu ambiente atual, poderá aproveitar um sinalizador de recurso para restaurar temporariamente essa funcionalidade. Exemplo de configuração: `feature_flag: { certificate_bundle: true }`. Neste caso, recomendamos obter um pacote de certificados para o seu ambiente, como o da Mozilla. O pacote New Relic e o sinalizador de recurso serão totalmente removidos na próxima versão principal.
        * config.feature_flags.certificate_bundle padrãopara falso.
      </td>
    </tr>

    <tr>
      <td>
        Atualize a dependência do New Relic para versões com suporte de versão Node.js atualizado
      </td>

      <td>
        * @newrelic/AWS-sdk v4.0.1
        * @newrelic/koa v6.0.1
        * @newrelic/native-métrica v7.0.1
        * @newrelic/superagente v5.0.1
        * @newrelic/test-utilities v6.0.0
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v8]

Node.js v12 é a versão mais antiga compatível com o agente New Relic Node.js v8. Node.js 10 e 11 não são suportados pela v8. Os clientes que executam o Node.js 11 e versões anteriores têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v8.
* Permanecer no agente New Relic Node.js v7 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 12.
</Callout>

## Atualize para o agente Node.js versão 7 [#node-agent-v7]

Antes de atualizar para o Node.js versão 7, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v7**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        <DNT>**BREAKING**</DNT> Removido o atributo de resposta http obsoleto `httpResponseCode`, `response.status` e `httpResponseMessage`
      </td>

      <td>
        * <DNT>**v6.4.2-v6.14.0:**</DNT> A partir do agente v6.4.2, esses atributo foram marcados como obsoletos, mas deixados para dar um período de transição para o novo atributo.
        * <DNT>**v7:**</DNT> Quando o relatório de atributo de resposta http estiver ativado, `http.statusCode` e `http.statusText` serão relatados.
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT> Método de API `setIgnoreTransaction` obsoleto removido
      </td>

      <td>
        * <DNT>**v5 - v6:**</DNT> A partir do agente v5.0.0, esse método foi marcado como obsoleto, mas deixado para fornecer um período de transição para os novos métodos.
        * <DNT>**v7:**</DNT> Aplicativo deve usar o método API [`transactionHandle.ignore()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api/#transaction-handle-ignore).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT> O item de configuração `api.custom_parameters_enabled` e a variável de ambiente associada `NEW_RELIC_API_CUSTOM_PARAMETERS` foram removidos.
      </td>

      <td>
        * O aplicativo deve usar a configuração [`api.custom_attributes_enabled` ou a variável de ambiente associada `NEW_RELIC_API_CUSTOM_ATTRIBUTES`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#custom-attributes) para ativar [`newrelic.addCustomAttribute`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api/#add-custom-attribute) e [`newrelic.addCustomAttributes`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api/#add-custom-attributes).
      </td>
    </tr>

    <tr>
      <td>
        <DNT>**BREAKING**</DNT> Métodos de API distributed tracing obsoletos foram removidos, `createDistributedTracePayload()` e `acceptDistributedTracePayload()`
      </td>

      <td>
        * <DNT>**v6.4.0-v6.14.0:**</DNT> A partir do agente v6.4.0, esses métodos foram marcados como obsoletos, mas deixados para fornecer um período de transição para os novos métodos.
        * <DNT>**v7:**</DNT> Aplicativo deve usar os métodos API [`transactionHandle.insertDistributedTraceHeaders(headers)`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api/#transaction-handle-insertDistributedTraceHeaders) e [`transactionHandle.acceptDistributedTraceHeaders(transportType, headers) `](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api/#transaction-handle-acceptDistributedTraceHeaders). Com esses métodos, o agente Node.js agora aceitará os cabeçalhos `traceparent` e `tracestate` do W3C ao chamar `transactionHandle.acceptDistributedTraceHeaders(headers)` e incluirá os cabeçalhos W3C junto com o cabeçalho distributed tracing da New Relic ao chamar `transactionHandle.insertDistributedTraceHeaders(headers)`, a menos que o cabeçalho da New Relic o formato de rastreamento é desabilitado usando [`distributed_tracing.exclude_newrelic_header:true`.](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#dt-exclude-newrelic-header)
      </td>
    </tr>

    <tr>
      <td>
        Atualize a dependência do New Relic para versões com suporte de versão Node.js atualizado
      </td>

      <td>
        * @newrelic/AWS-sdk v3.0.0
        * @newrelic/koa v5.0.0
        * @newrelic/native-métrica v6.0.0
        * @newrelic/superagente v4.0.0
        * @newrelic/test-utilities v5.0.0
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v7]

Node.js v10 é a versão mais antiga suportada pelo agente New Relic Node.js v7. Node.js 8 e 9 não são suportados pela v7. Os clientes que executam o Node.js 9 e versões anteriores têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v7.
* Permanecer no agente New Relic Node.js v6 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

[O Node.js 10 não recebe atualizações](https://github.com/nodejs/Release/tree/cecdcf#end-of-life-releases). Atualize para uma versão mais recente do Node.js o mais rápido possível. O suporte para Node.js 10 foi descontinuado com o agente New Relic Node.js v8.

## Atualizar para o agente Node.js versão 6 [#node-agent-v6]

Antes de atualizar para o agente Node.js versão 6, revise estas informações para obter alterações importantes.

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js agent v6**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Módulo de instrumentação oficial framework Koa atualizado para v3.0.0
      </td>

      <td>
        * <DNT>**v6:**</DNT> Adicionado suporte para @koa/router até v8.0.2. @koa/router v8.0.3 e superior não são suportados no momento.
        * <DNT>**v6:**</DNT> Adicionado suporte para Node.js v12 e removido suporte para Node.js v6, 7 e 9. A versão mínima suportada é Node.js v8.
        * Consulte também [as notas de lançamento do Koa da New Relic no Github.](https://github.com/newrelic/node-newrelic-koa/blob/master/NEWS.md).
      </td>
    </tr>

    <tr>
      <td>
        Removido o parâmetro de configuração `max_samples_per_minute` obsoleto, que foi substituído pelo comportamento `max_samples_stored`
      </td>

      <td>
        * <DNT>**v1 - v5:**</DNT> `max_samples_per_minute` definiu o número máximo de eventos que o agente coleta por minuto. Se seu aplicativo usou anteriormente `max_samples_per_minute` como limite superior, talvez seja necessário diminuir o limite para um máximo válido para evitar que os dados sejam descartados no servidor. Recomendamos menos de 10k.
        * <DNT>**v5:**</DNT> No agente v5 e versões anteriores, `max_samples_stored` definiu o número máximo de eventos que o agente armazenará se não conseguir se comunicar com o [coletor New Relic](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector).
        * <DNT>**v6:**</DNT> O novo comportamento de `max_samples_stored` define o número máximo de eventos que o agente coleta por minuto. Se houver mais que esse número, o agente coleta uma amostragem estatística. Este uso da configuração é consistente com o outro agente APM.
        * <DNT>**Troubleshooting tips:**</DNT> Se faltarem dados de evento, aumente o valor de `max_samples_stored` ou reverta para o valor padrão. O valor de `max_samples_stored` não deve ser superior a 10.000.
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v6]

Node.js 8 é a versão mais antiga suportada pelo agente New Relic Node.js v6. Node.js 6, 7 e 9 não são suportados pela v6. Os clientes que executam o Node.js 6, 7 e 9 têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v6.
* Permanecer no agente New Relic Node.js v5 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

[O Node.js 8 não recebe mais atualizações](https://github.com/nodejs/Release/tree/cecdcf#end-of-life-releases), mas a New Relic continuará a oferecer suporte a essas versões do Node.js por enquanto.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 8.
</Callout>

## Atualize para o agente Node.js versão 5 [#node-agent-v5]

Antes de atualizar para o agente Node.js v5, revise estas informações para obter alterações importantes. Consulte também [o guia de migração Node.js v5 da New Relic no GitHub](https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md).

<table>
  <thead>
    <tr>
      <th style={{ width: "250px" }}>
        <DNT>
          **Major changes with Node.js v5 agent**
        </DNT>
      </th>

      <th>
        <DNT>
          **Comments**
        </DNT>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Métodos `addCustomParameter` obsoletos removidos.
      </td>

      <td>
        * <DNT>**v2 - v4:**</DNT> A partir do agente v2.7.0, esses métodos foram marcados como obsoletos, mas deixados para fornecer um período de transição para os novos métodos.
        * <DNT>**v5:**</DNT> Aplicativo deve usar os métodos API [`newrelic.addCustomAttribute()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#add-custom-attribute) e [`newrelic.addCustomAttributes()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#add-custom-attributes). Estes são substitutos imediatos para os métodos antigos.
      </td>
    </tr>

    <tr>
      <td>
        Métodos `create*Transaction` obsoletos removidos.
      </td>

      <td>
        * <DNT>**v2 - v4:**</DNT> A partir do agente v2.0.2, esses métodos foram marcados como obsoletos, mas deixados para dar um período de transição aos novos métodos.
        * <DNT>**v5:**</DNT> O aplicativo deve ser atualizado para os métodos de API [`newrelic.startWebTransaction()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startWebTransaction) e [`newrelic.startBackgroundTransaction()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startBackgroundTransaction).
        * <DNT>**Troubleshooting tips:**</DNT> Esses novos métodos **não** são substitutos imediatos dos antigos. Antes de passar para esses novos métodos, revise nosso [guia de instrumentação personalizada](/docs/agents/nodejs-agent/supported-features/nodejs-custom-instrumentation#web-txn).
      </td>
    </tr>

    <tr>
      <td>
        Método `createTracer` obsoleto removido.
      </td>

      <td>
        * <DNT>**v3 - v4:**</DNT> A partir do agente v3.3.0, esse método foi marcado como obsoleto em favor de `newrelic.startSegment()`.
        * <DNT>**v5:**</DNT> O aplicativo deve ser atualizado para [`newrelic.startSegment()`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startSegment).
      </td>
    </tr>

    <tr>
      <td>
        Removida `node-cassandra-cql` instrumentação.
      </td>

      <td>
        * <DNT>**v4:**</DNT> Aplicativo usando o pacote npm [`node-cassandra-cql`](https://www.npmjs.com/package/node-cassandra-cql) obteria métrica de armazenamento de dados para Cassandra.
        * <DNT>**v5:**</DNT> O aplicativo deve migrar para o pacote [`cassandra-driver`](https://www.npmjs.com/package/cassandra-driver) para obter a métrica do datastore Cassandra. Este módulo é mantido ativamente pelos mesmos desenvolvedores. O pacote `node-cassandra-cql` foi abandonado em fevereiro de 2014 em favor do pacote `cassandra-driver` .
      </td>
    </tr>

    <tr>
      <td>
        Remoção da configuração obsoleta de `capture_params` e `ignored_params` .
      </td>

      <td>
        * <DNT>**v2 - v4:**</DNT> A partir do agente v2.7.0, esses parâmetros de configuração causavam o registro de um aviso e os valores eram automaticamente atualizados para as novas configurações de atributo.
        * <DNT>**v5:**</DNT> Um aviso ainda será registrado, mas a configuração será ignorada e nenhuma atualização automática acontecerá mais.
        * <DNT>**Troubleshooting tips:**</DNT> Se seu aplicativo tiver parâmetros listados na configuração `ignored_params` , você precisará movê-los para [`attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_exclude).
      </td>
    </tr>
  </tbody>
</table>

## Suporte à versão Node.js. [#node-support-v5]

Node.js 6 é a versão mais antiga suportada pelo agente New Relic Node.js v5. Node.js 4 e 5 não são suportados pela v5. Os clientes que executam o Node.js 4 ou 5 têm duas opções:

* Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v5.
* Permanecer no agente New Relic Node.js v4 sem a capacidade de usar o novo recurso disponível apenas com versões do agente de atualização.

[O Node.js 7 e 9 não recebem mais atualizações](https://github.com/nodejs/Release/tree/cecdcf#end-of-life-releases), mas a New Relic continuará a oferecer suporte a essas versões do Node.js por enquanto.

<Callout variant="tip">
  Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 6 e 7.
</Callout>

## Sinalizadores de recurso a partir da v5 [#v5-feature-flags]

A partir do New Relic para Node.js v5:

* `custom_instrumentation`: esse recurso não é mais configurável.
* `custom_metrics`: esse recurso não é mais configurável.
* `synthetics`: esse recurso não é mais configurável.
* `native_metrics`: esse recurso agora é controlado pelo valor de configuração `plugins.native_metrics.enabled` .

## Atualize para o agente Node.js versão 4 [#node-agent-v4]

Antes de atualizar para o agente Node.js v4, revise estas informações para obter alterações importantes. Consulte também [o guia de migração Node.js v4 da New Relic no GitHub](https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v4).

<CollapserGroup>
  <Collapser
    id="https-proxy-agent"
    title="Atualizar https-proxy-agente de v0 para v2"
  >
    As principais mudanças no agente Node.js v4 incluem um upgrade do `https-proxy-agent` de v0 para v2. Esta dependência foi atualizada devido a um [problema de segurança](/docs/using-new-relic/new-relic-security/security-bulletins/security-bulletin-nr18-08) no `https-proxy-agent` usado pelo agente New Relic Node.js. Como `https-proxy` v2 é incompatível com os nós v0.10 e v0.12, A New Relic descontinuou essas versões de agente. Não há nenhuma ação necessária para migrar da v3 para a v4 do agente Node.js da New Relic.
  </Collapser>

  <Collapser
    id="v4-node-version"
    title="Suporte à versão Node.js."
  >
    Node.js 4 é a versão mais antiga suportada pelo agente New Relic Node.js v4. Node.js 0.10 e 0.12 não são suportados pela v4. Os clientes que executam o Node.js 0.10 ou 0.12 têm duas opções:

    * Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v4.

    * Permanecer no agente New Relic Node.js v3 sem a capacidade de usar o novo recurso disponível apenas com versões atualizadas do agente.

      [O Node.js 4, 5 e 7 também não receberá mais atualizações](https://github.com/nodejs/Release/tree/1d8fca#end-of-life-releases), mas a New Relic continuará a oferecer suporte a essas versões do Node.js por enquanto.

      <Callout variant="tip">
        Atualize para uma versão mais recente do Node.js o mais rápido possível. A próxima versão principal do agente New Relic Node.js provavelmente removerá o suporte para Node.js 4 e 5.
      </Callout>
  </Collapser>
</CollapserGroup>

## Atualizar para o agente Node.js versão 3 [#node-agent-v3]

Antes de atualizar para o Node.js agente agente v3, revise estas informações para obter alterações importantes. Consulte também [o guia de migração Node.js v3 da New Relic no GitHub](https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v3).

<CollapserGroup>
  <Collapser
    id="changes-v3"
    title="Principais mudanças com o agente Node.js v3"
  >
    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            <DNT>
              **Major changes with Node.js v3 agent**
            </DNT>
          </th>

          <th>
            <DNT>
              **Comments**
            </DNT>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            Configuração SSL removida
          </td>

          <td>
            * <DNT>**v2:**</DNT> Com o agente v2, foi possível configurar o agente para se conectar ao New Relic sem criptografia.
            * <DNT>**v3:**</DNT> O agente Node.js v3 sempre se conecta aos servidores New Relic usando criptografia TLS para proteger as comunicações. Se o agente estiver configurado para desabilitar isso, um aviso será registrado e a configuração será ignorada.
          </td>
        </tr>

        <tr>
          <td>
            Parâmetro de solicitação agora prefixado com `request.parameters.`
          </td>

          <td>
            * <DNT>**v2:**</DNT> O agente v2 coleta parâmetros de solicitação, como parâmetro de rota (`/users/:userId`) e parâmetro de consulta (`/users?userId=123`), como o nome do parâmetro (`userId`).
            * <DNT>**v3:**</DNT> O agente v3 prefixa todos os parâmetros de solicitação com a string `request.parameters.`. Por exemplo,`userId` aparece como `request.parameters.userId`.
            * <DNT>**Troubleshooting tips:**</DNT> Se você tiver dashboard, política de alertas ou outra consulta NRQL baseada em parâmetro de solicitação, atualize-os com os novos nomes de parâmetro.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="v3-feature-flags"
    title="Sinalizadores de recurso a partir da v3"
  >
    A partir do agente Node.js v3 da New Relic, o recurso `send_request_uri_attribute` não é mais configurável.
  </Collapser>
</CollapserGroup>

## Atualizar para o agente Node.js versão 2 [#node-agent-v2]

Antes de atualizar para o agente Node.js v2, revise estas informações para obter alterações importantes. Consulte também [o guia de migração Node.js v2 da New Relic no GitHub](https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v2).

<CollapserGroup>
  <Collapser
    id="changes-v2"
    title="Principais mudanças com o agente Node.js v2"
  >
    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            <DNT>
              **Major changes with Node.js v2 agent**
            </DNT>
          </th>

          <th>
            <DNT>
              **Comments**
            </DNT>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            Nomenclatura invertida e regras para ignorar
          </td>

          <td>
            * <DNT>**v1:**</DNT> Com o agente v1, as regras definidas nas propriedades de configuração `rules.name` e `rules.ignore` foram aplicadas na ordem inversa; a primeira regra da lista foi aplicada por último.
            * <DNT>**v2:**</DNT> O agente Node.js v2 aplica regras na ordem em que são definidas, portanto, a primeira regra da lista é aplicada primeiro.
            * <DNT>**Troubleshooting tips:**</DNT> Se você usou regras de nomenclatura no agente v1 e percebeu problemas, inverta a ordem das suas regras na sua configuração.
          </td>
        </tr>

        <tr>
          <td>
            Solicitação HTTP deduplicada de transação
          </td>

          <td>
            * <DNT>**v1:**</DNT> O agente v1 iniciou uma nova transação para cada ouvinte no evento `request` de um servidor HTTP. Em aplicativos com vários listeners no evento `request` , isso resultava na criação de transações estranhas que quase sempre não eram nomeadas corretamente.
            * <DNT>**v2:**</DNT> O agente v2 cria apenas uma transação para cada evento `request` emitido.
            * <DNT>**Troubleshooting tips:**</DNT> Se você usou vários ouvintes de eventos `request` e adicionou uma chamada a `newrelic.ignoreTransaction()` para remover a transação extra, remova essas chamadas.
          </td>
        </tr>

        <tr>
          <td>
            Parou de engolir erros de solicitação de saída
          </td>

          <td>
            * <DNT>**v1:**</DNT> O agente v1 engoliu o evento `error` não tratado emitido por objetos de solicitação HTTP de saída.
            * <DNT>**v2:**</DNT> O agente v2 remove esse comportamento. Em vez disso, o agente v2 não altera a execução normal do Node.js. Isso significa que o evento `error` sempre será emitido.
            * <DNT>**Troubleshooting tips:**</DNT> Se você estiver fazendo solicitações de saída e atualmente não escuta o evento `error` , adicione um ouvinte e trate o erro conforme apropriado para seu aplicativo.
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="config-options"
    title="Opções de configuração atualizadas a partir da v2"
  >
    Em `newrelic.js`, edite as propriedades [de configuração do agente Node.js](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration) que você usa para compatibilidade com as versões mais recentes:

    <table>
      <thead>
        <tr>
          <th width={200}>
            <DNT>
              **Deprecated property**
            </DNT>
          </th>

          <th>
            <DNT>
              **New property**
            </DNT>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `capture_params`
          </td>

          <td>
            `attributes.enabled: false`

            Por padrão, as solicitações de atributo não são enviadas para a New Relic. Configure `attributes.enabled: true` para incluir atributo personalizado ou definido pelo agente no rastreio. A propriedade `capture_params` foi descontinuada.
          </td>
        </tr>

        <tr>
          <td>
            `ignored_params`
          </td>

          <td>
            `attributes.exclude: []`

            Adicione quaisquer chaves de atributo de solicitação à lista `attributes.exclude` . Agora, em vez de ser uma correspondência exata, os curingas (`*`) podem ser anexados a cada item para uma filtragem mais ampla. A propriedade `ignored_params` foi descontinuada.
          </td>
        </tr>
      </tbody>
    </table>

    Essas propriedades [de configuração do agente Node.js](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration) também têm substituições para destinos específicos, incluindo:

    * `transaction_tracer`

    * `transaction_events`

    * `error_collector`

    * `browser_monitoring`

      Por exemplo, se a raiz `attributes.enabled` for `true` e você definir `transaction_tracer.attributes.enabled: false`, isso restringirá a coleta de atributo no rastreamento da transação, enquanto ainda os permitirá para todos os outros.
  </Collapser>

  <Collapser
    id="deprecated-apis"
    title="Métodos de API obsoletos a partir da v2"
  >
    Os métodos a seguir do agente Node.js foram descontinuados e a New Relic os excluiu na v5 do agente. Cada um tem uma substituição fácil que realiza a mesma tarefa de maneira mais flexível e confiável.

    <CollapserGroup>
      <Collapser
        id="newrelic_createWebTransaction"
        title={<InlineCode>newrelic.createWebTransaction()</InlineCode>}
      >
        Substitua por [`newrelic.startWebTransaction()`](#newrelic_start_transaction) e [`newrelic.getTransaction()`](#newrelic_getTransaction).
      </Collapser>

      <Collapser
        id="newrelic_createBackgroundTransaction"
        title={<InlineCode>newrelic.createBackgroundTransaction()</InlineCode>}
      >
        Substitua por [`newrelic.startBackgroundTransaction()`](#newrelic_start_transaction) e [`newrelic.getTransaction()`](#newrelic_getTransaction).
      </Collapser>

      <Collapser
        id="newrelic_addCustomParameter"
        title={<InlineCode>newrelic.addCustomParameter()</InlineCode>}
      >
        Substitua por [`newrelic.addCustomAttribute()`](#newrelic_add_custom_attribute).
      </Collapser>

      <Collapser
        id="newrelic_addCustomParameter"
        title={<InlineCode>newrelic.addCustomParameters()</InlineCode>}
      >
        Substitua por [`newrelic.addCustomAttributes()`](#newrelic_add_custom_attributes).
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="api-methods"
    title="Novos métodos de API do agente v2"
  >
    Os métodos de API a seguir são novos no agente New Relic Node.js v2.

    <CollapserGroup>
      <Collapser
        id="newrelic_getTransaction"
        title={<InlineCode>newrelic.getTransaction()</InlineCode>}
      >
        Este método obtém uma referência à transação em execução no momento. Use em conjunto com:

        * `newrelic.startWebTransaction`
        * `newrelic.startBackgroundTransaction`
        * Serviços de consumidor de mensagens baseados em retorno de chamada para [resolução de problemas de consumidor de mensagens](/docs/agents/nodejs-agent/troubleshooting/troubleshoot-message-consumers)
      </Collapser>

      <Collapser
        id="newrelic_start_transaction"
        title={<><InlineCode>
          newrelic.startWebTransaction()
        </InlineCode><InlineCode>
          newrelic.startBackgroundTransaction()
        </InlineCode></>}
      >
        Esses novos métodos de API substituem os métodos `create*Transaction` mais antigos. Eles são mais fáceis de usar e funcionam perfeitamente com promessas. Ao contrário do método v1, o retorno de chamada fornecido é invocado imediatamente.
      </Collapser>

      <Collapser
        id="newrelic_instrument"
        title={<><InlineCode>
          newrelic.instrument()
        </InlineCode><InlineCode>
          newrelic.instrumentDatastore()
        </InlineCode><InlineCode>
          newrelic.instrumentWebframework()
        </InlineCode><InlineCode>
          newrelic.instrumentMessages()
        </InlineCode></>}
      >
        Use esses métodos para adicionar instrumentação personalizada para módulos de terceiros, incluindo aqueles já instrumentados pelo agente Node.js da New Relic. Para obter mais informações, consulte [os tutoriais de instrumentação Node.js da New Relic no GitHub](https://newrelic.github.io/node-newrelic/tutorial-Instrumentation-Basics.html).
      </Collapser>

      <Collapser
        id="newrelic_add_custom_attribute"
        title={<InlineCode>newrelic.addCustomAttribute()</InlineCode>}
      >
        Use este método para incluir um atributo trace customizado.
      </Collapser>

      <Collapser
        id="newrelic_add_custom_attributes"
        title={<InlineCode>newrelic.addCustomAttributes()</InlineCode>}
      >
        Use este método para adicionar vários atributos trace personalizados.
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="node-support"
    title="Suporte à versão Node.js para v2"
  >
    A versão mais antiga do Node.js suportada pelo agente New Relic Node.js v2 é 0.10. O Node.js 0.8, que não é atualizado desde julho de 2014, não é compatível com a v2. Os clientes que executam o Node.js 0.8 têm duas opções:

    * Atualize para uma versão compatível do Node.js e aproveite o novo recurso do agente New Relic Node.js v2.

    * Permanecer no agente New Relic Node.js v1 sem a capacidade de usar o novo recurso disponível apenas com versões atualizadas do agente.

      [O Node.js 0.10 também não recebe mais atualizações](https://github.com/nodejs/LTS/tree/2b4253#lts-schedule1), mas a New Relic continuará a oferecer suporte a esta versão do Node.js por enquanto.

      Recomendação: atualize para uma versão mais recente do Node.js o mais rápido possível.
  </Collapser>

  <Collapser
    id="npm-versions"
    title="suporte à versão npm a partir da v2"
  >
    O agente New Relic Node.js agora requer npm versão 2.0.0 ou superior. Esta versão do npm vem com Node.js 0.10.44 ou superior.

    Se estiver usando uma versão anterior do Node.js 0.10, você precisará primeiro instalar o npm 2.0.0 ou superior ou atualizar para uma versão mais recente do Node. Para instalar o npm versão 2:

    ```
    $ npm install --global npm@2
    ```
  </Collapser>

  <Collapser
    id="v2-feature-flags"
    title="Sinalizadores de recurso a partir da v2"
  >
    A partir do agente New Relic Node.js v2:

    * `express_segments`: esse recurso não é mais configurável.
    * `cat`: esse recurso agora é controlado pelo valor de configuração `cross_application_tracer.enabled` .
  </Collapser>

  <Collapser
    id="framework-minimum"
    title="Versões mínimas do framework a partir da v2"
  >
    A partir do agente New Relic Node.js v2:

    <table>
      <thead>
        <tr>
          <th style={{ width: "150px" }}>
            <DNT>
              **Module**
            </DNT>
          </th>

          <th style={{ width: "175px" }}>
            <DNT>
              **V2 minimum**
            </DNT>
          </th>

          <th style={{ width: "175px" }}>
            <DNT>
              **Minimum before v2**
            </DNT>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            expressar
          </td>

          <td>
            4.6.0
          </td>

          <td>
            2.0.0
          </td>
        </tr>

        <tr>
          <td>
            mysql
          </td>

          <td>
            2.0.0
          </td>

          <td>
            0.9.0
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>
