---
title: Configuração de serviços externos
metaDescription: Here are steps to enable and configure external services
freshnessValidatedDate: never
translationType: machine
---

O recurso de serviços externos está disponível para o agente New Relic APM e [OpenTelemetry](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/introduction-opentelemetry-new-relic).

Se você quiser começar a trabalhar o mais rápido possível, recomendamos usar nosso agente APM.

Clicar em um logotipo direciona você para a plataforma New Relic, onde você será orientado na instalação e configuração do agente.

<TechTileGrid>
  <TechTile
    name="Go agent"
    icon="logo-go"
    to="https://one.newrelic.com/nr1-core?state=985d4005-ba90-a8c7-1da1-2af34539b03b"
  />

  <TechTile
    name="Java agent"
    icon="logo-java"
    to="https://one.newrelic.com/nr1-core?state=80d18bcb-4919-1fcb-2b77-9406838eb916"
  />

  <TechTile
    name=".NET agent"
    icon="logo-dotnet"
    to="https://one.newrelic.com/nr1-core?state=30e93090-6dfa-6b70-8e75-472f54414355"
  />

  <TechTile
    name="Node.js agent"
    icon="logo-nodejs"
    to="https://one.newrelic.com/marketplace/install-data-source?state=be2e62fa-cc3b-c428-27c4-8d662c9e80a1"
  />

  <TechTile
    name="PHP agent"
    icon="logo-php"
    to="https://one.newrelic.com/nr1-core?state=aa633b41-72d4-009c-3abf-55dcf64894fe"
  />

  <TechTile
    name="Python agent"
    icon="logo-python"
    to="https://one.newrelic.com/nr1-core?state=20fda75b-58fb-a92a-f9e1-7b052035c6e8"
  />

  <TechTile
    name="Ruby agent"
    icon="logo-ruby"
    to="https://one.newrelic.com/nr1-core?state=d69143ab-605c-579b-25bf-cc6e5fee5b80"
  />
</TechTileGrid>

## Configurar serviços externos

As instruções a seguir orientarão você na configuração de serviços externos.

<Steps>
  <Step>
    ### Comece a enviar dados

    A configuração de alterações de serviços externos com base no fato de você estar usando o agente APM ou OpenTelemetry. Selecione a guia da opção de instalação adequada ao seu sistema:

    <Tabs>
      <TabsBar>
        <TabsBarItem id="send-data-apm">
          Agentes APM
        </TabsBarItem>

        <TabsBarItem id="send-data-otel">
          OpenTelemetry
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="send-data-apm">
          Preencha o seguinte para cada serviço que deseja visualizar em serviços externos:

          1. Se ainda não tiver feito isso, instale o [agente](/docs/distributed-tracing/enable-configure/quick-start) New Relic APM apropriado.

          2. Certifique-se de que distributed tracing esteja ativado no agente:

             * Se você instalou um novo agente, distributed tracing padrão será ativado por padrão. Se o seu serviço se comunicar com outros serviços que usam o Rastreamento Infinito, consulte a documentação do seu agente para obter ajuda com o Rastreamento Infinito.
             * Se você tiver um agente mais antigo, siga as etapas de configuração para ativar distributed tracing padrão ou o rastreamento infinito. Quando você habilita distributed tracing, ele substitui o antigo rastreamento multiaplicativo.

          3. Veja se o seu agente requer etapas adicionais de configuração:

             <table>
               <thead>
                 <tr>
                   <th style={{ width: "200px" }}>
                     Agente
                   </th>

                   <th>
                     Versão Mínima
                   </th>

                   <th>
                     Configurar
                   </th>
                 </tr>
               </thead>

               <tbody>
                 <tr>
                   <td>
                     Go
                   </td>

                   <td>
                     3.6.0
                   </td>

                   <td>
                     Consulte a documentação sobre como usar [`NewRoundTripper()`](/docs/apm/agents/go-agent/instrumentation/instrument-go-segments/).
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Java
                   </td>

                   <td>
                     5.13.0
                   </td>

                   <td>
                     Consulte a documentação sobre como usar a [API do agente Java](/docs/apm/agents/java-agent/api-guides/java-agent-api-instrument-external-calls-messaging-datastore-web-frameworks/) para chamadas externas de instrumentos.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     .NET
                   </td>

                   <td>
                     8.29.0
                   </td>

                   <td>
                     O agente .NET e o agente .NET no Azure instrumentalizam automaticamente chamadas externas, mas não instrumentalizam métodos de transação. Para ver a transação, você precisa usar uma combinação dos seguintes:

                     * [Transação aduaneira](/docs/agents/net-agent/instrumentation/net-custom-transactions/)
                     * [Funções de trabalhador instrumentado](/docs/apm/agents/net-agent/azure-installation/install-net-agent-azure-cloud-services/#requirements)
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Node.js
                   </td>

                   <td>
                     6.9.0
                   </td>

                   <td>
                     Consulte a documentação sobre como usar a [API do agente Node.js.](/docs/apm/agents/nodejs-agent/api-guides/guide-using-nodejs-agent-api/#external-services)
                   </td>
                 </tr>

                 <tr>
                   <td>
                     PHP
                   </td>

                   <td>
                     9.12.0.268
                   </td>

                   <td>
                     Veja a documentação sobre como usar a [API do agente PHP](/docs/apm/agents/php-agent/php-agent-api/guide-using-php-agent-api/#datastore) para chamadas externas de instrumentos.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Python
                   </td>

                   <td>
                     5.14.0.142
                   </td>

                   <td>
                     Nenhuma etapa extra é necessária: As chamadas externas são instrumentadas automaticamente.
                   </td>
                 </tr>

                 <tr>
                   <td>
                     Ruby
                   </td>

                   <td>
                     6.12.0.367
                   </td>

                   <td>
                     Veja a documentação sobre como usar a [API do agente Ruby](/docs/apm/agents/ruby-agent/api-guides/guide-using-ruby-agent-api/#externals) para chamadas externas de instrumentos.
                   </td>
                 </tr>
               </tbody>
             </table>

             <Callout variant="tip">
               A versão clássica de serviços externos ainda estará disponível se você precisar adicionar um novo serviço a uma cadeia de agentes que já utiliza serviços externos clássicos. Para instalar serviços externos clássicos, habilite [o rastreamento multiaplicativo](/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces) em vez do distributed tracing nas etapas abaixo.
             </Callout>
        </TabsPageItem>

        <TabsPageItem id="send-data-otel">
          A interface do New Relic mostra detalhes de serviços externos depois que você conclui as etapas de configuração da instrumentação OpenTelemetry para seu serviço e as [chamadas](https://opentelemetry.io/docs/java/manual_instrumentation/#span-attributes) que ele faz para outros serviços. O recurso de serviços externos mostra chamadas entre seus serviços, divididas por endpoint de transação em cada serviço. O nome de cada transação é derivado do intervalo de entrada do processo (`span.kind = "server"`).

          Se o seu serviço APM estiver conectado a um serviço OpenTelemetry (upstream ou downstream), esse serviço OpenTelemetry não aparecerá na visualização desse serviço APM. Isso porque, ao visualizar um serviço APM, este recurso utiliza métricas que são reportadas apenas pelo agente APM. Ao visualizar um serviço OpenTelemetry, o serviço APM aparecerá como uma conexão.

          A qualidade das informações que você vê depende da estratégia de amostragem usada no coletor. Consulte a seção a seguir sobre como usar amostragem para controlar o que você vê na interface.

          <Callout variant="tip">
            Se você enviar 100% dos seus dados do OpenTelemetry para nossa API trace , armazenaremos 100% desses dados, a menos que você tenha um limite de taxa específico para sua organização ou se enviar dados suficientes para acionar nosso limite de taxa padrão.
          </Callout>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ### Ajuste a amostragem para ver mais dados da interface [#adjust-sampling]

    Se você estiver usando um agente APM e estiver vendo poucos ou nenhum dado quando começar a perfurar além da página inicial do mapa, talvez seja necessário ajustar o reservatório de extensão para amostrar mais dados. Isso ocorre porque os dados no nível da transação são preenchidos por dados trace de amostra.

    Para o OpenTelemetry, tanto a página inicial quanto todas as páginas de detalhamento são preenchidas por dados de amostra, portanto, talvez seja necessário fazer alguns ajustes na amostragem para obter os dados necessários.

    Aqui estão algumas informações sobre as diferentes rotinas de ajuste do reservatório para o agente APM, bem como dicas para ajuste de amostragem para OpenTelemetry:

    <Tabs>
      <TabsBar>
        <TabsBarItem id="agent-sample">
          Amostragem de agente APM
        </TabsBarItem>

        <TabsBarItem id="otel-sample">
          Amostragem OpenTelemetry
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="agent-sample">
          Todos os agentes APM possuem um reservatório que armazena spans, e a maioria desses reservatórios de agentes são configuráveis. O tamanho deste reservatório afeta a probabilidade de um agente ser capaz de enviar todos os vãos que ele cria. Consulte [rastreamento fragmentado](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui/#fragmented-traces) para obter mais detalhes.

          Os dados para esse recurso são derivados de clientes e servidores adjacentes, onde chamadas externas são feitas de um serviço para outro. Quando um agente atinge seu limite de reservatório de span, há uma chance de ele eliminar alguns spans que representam essas chamadas.

          O valor de configuração padrão do agente de 2.000 define o número máximo de eventos que o agente coleta por minuto. Se houver mais intervalos do que esse número, o agente coleta uma amostragem estatística, degradando essencialmente a quantidade de dados usados no mapa de serviços externos.

          Se não estiver vendo o tipo de detalhe desejado na interface, você pode aumentar o tamanho do reservatório para até 10.000. Revise o seguinte para ajustar os reservatórios de agente:

          <table>
            <thead>
              <tr>
                <th style={{ width: "200px" }}>
                  Agente APM
                </th>

                <th>
                  Documentação
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  Go
                </td>

                <td>
                  O reservatório não é atualmente configurável
                </td>
              </tr>

              <tr>
                <td>
                  Java
                </td>

                <td>
                  [Configuração Java](/docs/apm/agents/java-agent/configuration/java-agent-configuration-config-file/#cfg-span-events-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  .NET
                </td>

                <td>
                  [Configuração .NET](/docs/apm/agents/net-agent/configuration/net-agent-configuration/#paragrp-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  Node.js
                </td>

                <td>
                  [Configuração do Node.js.](/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#span-events-max-samples-stored)
                </td>
              </tr>

              <tr>
                <td>
                  PHP
                </td>

                <td>
                  O reservatório não é atualmente configurável
                </td>
              </tr>

              <tr>
                <td>
                  Python
                </td>

                <td>
                  [Configuração do Python](/docs/apm/agents/python-agent/configuration/python-agent-configuration/#environment-variables) (consulte `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED`)
                </td>
              </tr>

              <tr>
                <td>
                  Ruby
                </td>

                <td>
                  [Configuração Ruby](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#span_events-max_samples_stored)
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="otel-sample">
          <Callout variant="tip">
            Esta seção se aplica apenas se seus serviços estiverem enviando dados para o New Relic por meio de um coletor OpenTelemetry. Isso ocorre porque os dados não estão sendo amostrados em um coletor OpenTelemetry.
          </Callout>

          Para o OpenTelemetry, todas as visualizações de serviços externos são preenchidas por rastreamento de amostra, o que significa que talvez você não veja dados úteis suficientes. Para resolver isso, você pode alterar a amostragem no coletor para permitir mais dados no New Relic.

          Consulte [Amostragem](https://opentelemetry.io/docs/concepts/sampling/) para obter mais informações.
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>
</Steps>

## Qual é o próximo? [#next]

* Aprenda como usar serviços externos para [solucionar problemas de API](/docs/tutorial-external-services/respond-external)
* Saiba mais sobre como [navegar na interface de serviços externos](/docs/apm/apm-ui-pages/monitoring/external-services/external-services-ui).
* Caso tenha dúvidas sobre como entender a interface, veja nossas [dicas](/docs/apm/apm-ui-pages/monitoring/external-services/external-services-ui).
