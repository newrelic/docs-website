---
title: Vulnerabilidades críticas do Apache Log4j CVE-2021-44228 - Java
tags:
  - Security
  - Security and Privacy
  - Security bulletin
  - Log4j
metaDescription: 'Apache Log4j CVE-2021-44228, Security Bulletin NR21-03 (Java)'
releaseDate: '2021-12-10'
translationType: machine
---

<DNT>**Versions affected:**</DNT> Todas as versões do agente entre (a) 4.12.0 e 6.5.1; e (b) 7.0.0 e 7.4.1

<DNT>**Fix versions:**</DNT> 6.5.2, 6.5.3, 6.5.4, 7.4.2, 7.4.3 e 7.5.0

<DNT>**Vulnerability identifier:**</DNT> NR21-03

Determinamos que as novas vulnerabilidades identificadas (CVE-2021-44832) NÃO afetam o agente Java da New Relic, a menos que um vetor de ataque adicional permita permissões de gravação no sistema host. No entanto, as versões mais recentes do agente Java New Relic usarão as versões mais recentes do Apache do log4j (atualmente versões 2.17.1 (Java 8) e 2.12.4 (Java 7), que corrige CVE-2021-44832).

Também determinamos que o agente Java da New Relic NÃO é vulnerável a CVE-2021-45046 ou CVE-2021-45105. Isso ocorre porque o uso do log4j pelo agente fica atrás de uma interface wrapper que não usa ou suporta dados de entrada do Thread Context Map, um aspecto necessário das vulnerabilidades. No entanto, recomendamos a atualização para _pelo menos_ a versão 6.5.2 ou 7.4.2 para garantir proteção abrangente contra CVE-2021-44228.

À medida que novas versões do log4j forem disponibilizadas, continuaremos a lançar novas versões do agente.

<table>
  <thead>
    <tr>
      <th>
        New Relic
      </th>

      <th>
        Versão do Apache log4j
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        6.5.1
      </td>

      <td>
        2.15.0
      </td>
    </tr>

    <tr>
      <td>
        6.5.2
      </td>

      <td>
        2.12.2
      </td>
    </tr>

    <tr>
      <td>
        6.5.3
      </td>

      <td>
        2.12.3
      </td>
    </tr>

    <tr>
      <td>
        6.5.4
      </td>

      <td>
        2.12.4
      </td>
    </tr>

    <tr>
      <td>
        7.4.1
      </td>

      <td>
        2.15.0
      </td>
    </tr>

    <tr>
      <td>
        7.4.2
      </td>

      <td>
        2.16.0
      </td>
    </tr>

    <tr>
      <td>
        7.4.3
      </td>

      <td>
        2.17.0
      </td>
    </tr>

    <tr>
      <td>
        7.5.0+
      </td>

      <td>
        2.17.1
      </td>
    </tr>
  </tbody>
</table>

## Resumo

New Relic lançou novas versões do agente Java para solucionar vulnerabilidades críticas na framework do código aberto log4j que podem permitir que um ator mal-intencionado exfiltre dados ou execute código arbitrário usando o parâmetro mensagem do log ou mensagem do log.

New Relic atualizará este Boletim de Segurança e as orientações de nossos clientes à medida que novas informações forem disponibilizadas.

## Itens de ação [#action]

Para corrigir o CVE 2021-44228 no agente Java New Relic , recomendamos que os clientes atualizem para o agente versão 6.5.2 ou superior (requer Java 7 ou superior) ou 7.4.2 ou superior (requer Java 8 ou superior) o mais rápido possível.

Se você já atualizou para as versões 6.5.2 ou 7.4.2 do agente, você está protegido contra CVE 2021-44228 e não precisa atualizar novamente neste momento. Determinamos que o agente Java do New Relic NÃO é suscetível a CVE-2021-45046 ou CVE-2021-45105, já que o uso do agente log4j fica atrás de uma interface wrapper que não usa ou suporta dados de entrada do Thread Context Map, um aspecto obrigatório das vulnerabilidades. Recomendamos atualizar pelo menos para a versão 6.5.2 ou 7.4.2 para garantir proteção abrangente contra CVE-2021-44228.

<Callout variant="important">
  Se você estiver em uma versão do agente anterior à 6.5.2 ou 7.4.2, ou não puder atualizar a versão do agente, recomendamos fortemente que você desative o log do agente.
</Callout>

### Como desabilitar o log do agente Java [#disable]

Você pode definir o nível de registro do agente Java como `OFF` para corrigir CVE-2021-44228. Para fazer isso, use qualquer uma das seguintes opções:

* Modifique o arquivo de configuração do agente local (procure o parâmetro `log_level` ) (não é necessário reiniciar)
* Defina a propriedade do sistema `newrelic.config.log_level=OFF` (é necessário reiniciar)
* Defina a variável de ambiente `NEW_RELIC_LOG_LEVEL=OFF` (é necessário reiniciar)

Você pode verificar se o log do agente foi desativado verificando o arquivo de log do agente. Você não deverá ver nenhuma nova mensagem sendo escrita.

A desativação da criação de log do agente Java não afeta a funcionalidade do agente e não haverá degradação na observabilidade.

<DNT>**Note:**</DNT> Esta solução alternativa é recomendada apenas como uma solução temporária até que você possa atualizar a versão do seu agente.

Compartilharemos mais informações e etapas adicionais para correção, se a situação mudar.

<DNT>
  **If you use log4j directly in your applications, be sure to carefully review the [Apache Log4j Security Vulnerabilities](https://logging.apache.org/log4j/2.x/security.html). This page provides remediation details for you to consider.**
</DNT>

### Minion privado em contêiner [#CPM]

A etapa acima corrigirá apenas o agente Java do New Relic. Você também pode precisar atualizar seu minion privado New Relic Containerized. Consulte a [NR21-04](/docs/security/new-relic-security/security-bulletins/security-bulletin-nr21-04/) para mais informações.

## Informações sobre vulnerabilidades técnicas [#technical-info]

* [CVE-2021-44228 CVSS 10.0](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228)
* [CVE-2021-45046 CVSS 9.0](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046)
* [CVE-2021-45105 CVSS 7.5](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105)
* [CVE-2021-44832 CVSS 6.6](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832)
* [Orientações de segurança para clientes New Relic relacionadas às vulnerabilidades do Apache Log4j](https://newrelic.com/blog/nerdlog/security-guidance-for-log4j)
* [Como ajudar a identificar sistemas com versões log4j vulneráveis usando New Relic](https://newrelic.com/blog/how-to-relic/new-relic-log4j-detection)
* [Vulnerabilidades de segurança do Apache log4j](https://logging.apache.org/log4j/2.x/security.html)
* [Fórum de suporte New Relic](https://discuss.newrelic.com/t/log4j-zero-day-vulnerability-and-the-new-relic-java-agent/170322)

## Perguntas frequentes [#faq]

<CollapserGroup>
  <Collapser
    id="upgrade-options"
    title="Quais são as nossas opções se não conseguirmos atualizar nosso agente Java ou versão do Java?"
  >
    Implemente a [solução alternativa recomendada neste boletim](#action).
  </Collapser>

  <Collapser
    id="versions"
    title="Como posso descobrir quais versões do agente estamos executando?"
  >
    As informações da versão do agente são exibidas na <DNT>**Environment**</DNT> página Dashboard New Relic One . Consulte nossa [página de documentos](/docs/apm/agents/manage-apm-agents/troubleshooting/get-environment-data-about-your-apm-app) para obter mais informações.
  </Collapser>

  <Collapser
    id="patch-v5"
    title="Por que não existe um patch para o agente v5 e versões anteriores?"
  >
    A maioria de nossos clientes usa versões de agente 6.x ou 7.x e incentivamos os clientes a usar versões mais recentes de nosso agente para garantir que tenham a melhor experiência. Se você não conseguir atualizar a versão do seu agente, implemente a solução alternativa descrita acima.
  </Collapser>

  <Collapser
    id="update-742"
    title="Já atualizei para 6.5.1 ou 7.4.1, preciso atualizar novamente?"
  >
    Se você já tiver atualizado para as versões 6.5.1 ou 7.4.1 do agente, recomendamos também desabilitar o log do agente, pois a correção para CVE-2021-44228 estava incompleta no log4j v2.15.0. Recomendamos a atualização para pelo menos a versão do agente Java 6.5.2 ou 7.4.2 para garantir proteção abrangente contra essas vulnerabilidades críticas. Embora tenhamos lançado um agente Java mais recente com log4j 2.17.1 (Java 8) e 2.12.4 (Java 7), determinamos que a atualização para 6.5.3+ ou 7.4.3+ não é crítica, pois o agente Java da New Relic é não suscetível a CVE-2021-45046 ou CVE-2021-45105.
  </Collapser>
</CollapserGroup>

## Histórico de publicação [#pub-history]

* 3 de março de 2022: Revisão da NR21-03:

  * Referências atualizadas para o agente Java versões 6.5.4 e 7.5.0

* 29 de dezembro de 2021: Revisão da NR21-03:

  * Atualizado para refletir as descobertas do agente em CVE-2021-44832

* 22 de dezembro de 2021: Revisão Principal da NR21-03:

  * Novas versões de correção 6.5.3 e 7.4.3 disponível para endereçar CVE-2021-44228, CVE-2021-45046 e CVE-2021-45105.
  * Adição de avaliações de risco de explorabilidade para cada vulnerabilidade, para auxiliar os clientes na tomada de decisões de remediação.
  * Adição de conteúdo relacionado ao impacto da falta de funcionalidade para clientes que desativam o registro do agente.

* 17 de dezembro de 2021: Revisão da NR21-03:

  * Alteração na gravidade e descrição técnica de CVE-2021-45046

* 16 de dezembro de 2021: Revisão Principal da NR21-03:

  * Nova correção versão 6.5.2 disponível para resolver CVE-2021-44228 e CVE-2021-45046.
  * Alteração na orientação relativa à suficiência do log4j versão 2.15.0 para proteção contra exploração de CVE-2021-44228.
  * Alteração na solução alternativa recomendada.
  * Atualização da descrição técnica NIST de CVE-2021-44228.

* 14 de dezembro de 2021: Revisão Principal da NR21-03:

  * Nova correção versão 7.4.2 disponível para endereçar CVE-2021-44228 e CVE-2021-45046.
  * Atualizado para incluir uma opção de solução alternativa adicional.
  * Atualizado para fornecer clareza entre as atualizações do agente Java New Relic e as práticas recomendadas que os clientes devem seguir para proteger seu aplicativo.
  * Adicionadas descrições de vulnerabilidades técnicas e pontuações CVSS do Instituto Nacional de Padrões e Tecnologia (NIST).

* 13 de dezembro de 2021: NR21-03 atualizada para incluir orientações mais explícitas sobre soluções alternativas e perguntas frequentes

* 10 de dezembro de 2021: publicada NR21-03

## Relate vulnerabilidades de segurança à New Relic [#report]

A New Relic está comprometida com a segurança de nossos clientes e de seus dados. Se você acredita ter encontrado vulnerabilidades de segurança em um de nossos produtos ou sites, agradecemos e agradecemos muito que você relate isso ao programa de divulgação coordenado da New Relic. Para obter mais informações, consulte nossa documentação sobre como [relatar vulnerabilidades de segurança](/docs/security/new-relic-security/data-privacy/reporting-security-vulnerabilities).
