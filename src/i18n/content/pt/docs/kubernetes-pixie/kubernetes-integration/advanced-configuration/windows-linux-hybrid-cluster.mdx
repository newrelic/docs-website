---
title: Instalação em um cluster híbrido com nós Windows e Linux
tags:
  - Kubernetes
  - Windows
  - Linux
  - Installation
metaDescription: Learn how to install New Relic to a hybrid Windows and Linux Kubernetes cluster.
freshnessValidatedDate: '2024-04-05T00:00:00.000Z'
translationType: machine
---

Este documento esclarece a instalação da integração do Kubernetes para um cluster misto de Windows e Linux.

## Pré-requisitos [#prerequisites]

Certifique-se de ter concluído o seguinte antes de prosseguir:

* Um cluster com nós Windows e Linux, incluindo a capacidade de extrair imagens de contêiner para os nós Windows.

* Configure o repositório Helm e crie um namespace:

  ```shell
  helm repo add newrelic https://helm-charts.newrelic.com
  helm repo update
  kubectl create namespace newrelic
  ```

## Instale o pacote de gráficos atual [#install-chart-bundle]

O gráfico `newrelic/nri-bundle` é o gráfico normal com todas as atualizações mais recentes para tudo nos nós do Linux. Você pode configurar o gráfico `newrelic-logging` para instalação no Windows. Este recurso é confiável e compatível com o gráfico de registro.

Você pode usar outros gráficos, mas deve configurar um `NodeSelector` para evitar agendamento para Windows. Se uma instalação falhar em um cluster misto usando valores padrão da instalação guiada, adicione os valores `nodeSelector` .

Crie o arquivo de valores com seu editor de texto favorito, vamos chamá-lo de `values.yaml`. Você pode fazer download de um arquivo inicial `values.yaml` na interface do New Relic . Adicione a integração do Kubernetes e escolha **Helm** como método de instrumentação.

```yaml
global:
  licenseKey: mykey
  cluster: mycluster
  lowDataMode: true
 
newrelic-infrastructure:
  enabled: true
  nodeSelector:
    kubernetes.io/os: linux
 
kube-state-metrics:
  enabled: true
  image:
    tag: v2.10.0
  nodeSelector:
    kubernetes.io/os: linux
 
nri-kube-events:
  enabled: true
  nodeSelector:
    kubernetes.io/os: linux
 
newrelic-logging:
  enabled: true
  enableWindows: true
 
nri-metadata-injection:
  enabled: true
  nodeSelector:
    kubernetes.io/os: linux
 
newrelic-prometheus-agent:
  enabled: true
  verboseLog: true
  config:
    kubernetes:
      integrations_filter:
        enabled: false
  nodeSelector:
    kubernetes.io/os: linux
```

## Instale o pacote [#install-bundle]

Execute este comando para instalar o pacote:

```shell
helm upgrade --install newrelic-bundle newrelic/nri-bundle --namespace newrelic -f values-newrelic.yaml

```

Quando o Helm retornar, todos os pods deverão ser iniciados, incluindo um pod de registro em cada nó do Windows. Nenhum outro pod New Relic em nós do Windows ainda.

## Instalando a visualização do newrelic-infrastructure para nós do Windows [#newrelic-infra]

Crie o arquivo de valores para o gráfico `newrelic-infrastructure` v2. Por exemplo, `windows-values.yaml`. O exemplo abaixo é para um cluster com grupo de nós ou pool de nós do Windows 2022. Ajuste a seção `windowsOsList` com os valores corretos seguindo [estas instruções](/docs/kubernetes-pixie/kubernetes-integration/installation/kubernetes-integration-install-configure/#windows-install). Isso se aplica se você estiver executando 2019 ou 2022.

```yaml
global:
  licenseKey: mykey
  cluster: mycluster
 
enableLinux: false
enableWindows: true
windowsOsList:
  - version: 2022
    imageTag: 2-windows-ltsc2022-alpha
    buildNumber: 10.0.20348
windowsNodeSelector:
  kubernetes.io/os: windows
```

Instale a versão v2.7.2 do gráfico `newrelic-infrastructure` . Execute este comando:

```shell
helm upgrade --install newrelic-windows newrelic/newrelic-infrastructure --namespace newrelic --version 2.7.2 -f windows-values.yaml
```

Quando o Helm retornar, você deverá ver o pod `newrelic-windows-newrelic-infrastructure` em cada nó do Windows.

## Resultados esperados [#expected-results]

Depois que tudo estiver configurado, a interface do New Relic deverá mostrar seus nós do Windows no cluster do Kubernetes. Você verá a infraestrutura métrica, o pod em execução e toda a informação relacionada.