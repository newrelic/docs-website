---
title: Regras de normalização métrica
tags:
  - New Relic
  - Use New Relic
  - UI and data
metaDescription: How to create and manage rules in New Relic to deal with noise from high cardinality metrics and prevent metric grouping issues (MGIs).
freshnessValidatedDate: never
translationType: machine
---

As regras de normalização de métricas ajudam você a gerenciar [Problemas de agrupamento de métricas](/docs/using-new-relic/cross-product-functions/troubleshooting/metric-grouping-issues) (MGIs). Isso ajuda a garantir que os dados de desempenho da aplicação permaneçam relevantes. A normalização de métricas se aplica apenas a [dados de timeslice de métrica](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data).

Você pode criar e gerenciar regras de normalização de métricas para:

* Agrupe ou filtre [dados de fatia de tempo de métrica](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data)
* Gerencie as métricas de alta cardinalidade reportadas ao New Relic
* Evitar MGIs
* Impedir a criação automática de regras de `DENY_NEW_METRICS`
* Reduza o número de nomes de métricas únicos reportados ao New Relic

<Callout variant="important">
  Sempre que MGIs com um número muito alto de métricas são detectados, uma regra `DENY_NEW_METRICS` é criada automaticamente para proteger a plataforma contra a degradação de desempenho. Esta regra `DENY_NEW_METRICS` não afeta nenhuma métrica reportada anteriormente para a New Relic.
</Callout>

<Callout variant="tip">
  Você também pode criar uma regra de normalização de métrica usando o [NerdGraph](/docs/apis/nerdgraph/examples/nerdgraph-metric-normalization-rule/).
</Callout>

## Agentes reportando para múltiplos aplicativos [#multi-app-agents]

Quando um agente reporta para múltiplas aplicações, as regras de normalização de todas as aplicações são aplicadas aos dados de métrica.

Considere este cenário:

* Um agente reporta ao `app1` e `app2`
* A regra `r1` é definida para `app1`
* A regra `r2` é definida para `app2`

Tanto `r1` quanto `r2` são aplicados a todos os dados de métrica enviados pelo agente.

O que acontece se a configuração do agente for modificada para reportar apenas para `app2`? Nesse caso, apenas a regra `r2` será aplicada, pois é a única regra definida para o aplicativo ao qual o agente está reportando.

## Gerenciar a normalização de métricas [#manage-rules]

Você pode criar e gerenciar novas regras de normalização de métricas para uma entidade usando a página <DNT>**Metric normalization rules**</DNT>.

<CollapserGroup>
  <Collapser id="access-rules" title="Visualizar regras de normalização de métricas">
    Para visualizar a página <DNT>**Metric normalization rules**</DNT>, acesse <DNT>[https://one.newrelic.com](https://one.newrelic.com) &gt; **All Entities**</DNT> &gt; Selecione uma entidade &gt; <DNT>**Settings** &gt; **Metric normalization** </DNT>.

    <img title="View details" alt="View MGI details" src="/images/Access_metric_rules.webp" />
  </Collapser>

  <Collapser id="create-metric-normalization-rule" title="Criar uma regra de normalização de métricas">
    Para criar uma regra de normalização de métricas:

    1. Na página <DNT>**Metric normalization rules**</DNT>, clique em **+ Create a new rule**.
    2. Forneça os seguintes detalhes:

    <table>
      <thead>
        <tr>
          <th>
            Campo
          </th>

          <th>
            Descrição
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            **Faixa de tempo**
          </td>

          <td>
            Selecione o intervalo de tempo necessário no menu suspenso para a regra.
          </td>
        </tr>

        <tr>
          <td>
            **Expressão regular**
          </td>

          <td>
            Insira um padrão de 

            [expressão regular](https://regexone.com/)

             que corresponda às métricas a serem normalizadas. Este campo deve começar com um 

            `^`

             e terminar com um 

            `$`

            . Define um padrão para identificar quais métricas devem ser afetadas pela regra de normalização. Por exemplo: 

            `^WebTransaction/Uri/RESTfulExample/users/username/[a-zA-Z0-9]+$`

             O padrão 

            `^[a-zA-Z0-9]+$`

             corresponde a qualquer string composta por caracteres minúsculos 

            `(a-z)`

            , caracteres maiúsculos 

            `(A-Z)`

             e números 

            `(0-9)`

            .
          </td>
        </tr>

        <tr>
          <td>
            **Correspondências de expressão regular**
          </td>

          <td>
            Pré-visualize as métricas correspondidas pelo campo 

            **Regular expression**

            .
          </td>
        </tr>

        <tr>
          <td>
            **O que você deseja fazer com as correspondências?**
          </td>

          <td>
            Selecione uma das seguintes ações para executar nas métricas que correspondem ao campo **Regular expression**:

            * **Substituir**: Substitua as métricas correspondentes pelo valor no campo <DNT>Replacement</DNT>.
            * **Ignorar**: Bloqueie o envio de quaisquer métricas correspondentes para a plataforma New Relic.
            * **Ignorar novas métricas**: Impeça a criação de novos nomes de métricas, enquanto permite que nomes de métricas existentes continuem reportando.
          </td>
        </tr>

        <tr>
          <td>
            **Substituição**
          </td>

          <td>
            O campo Substituição é obrigatório apenas quando você seleciona a opção 

            **Replace**

             no campo anterior. Insira a métrica de substituição para substituir a métrica correspondente definida no campo 

            **Regular expression**

            .
          </td>
        </tr>

        <tr>
          <td>
            **Ordem da regra na sequência**
          </td>

          <td>
            Especifique a ordem em que a regra é aplicada em relação a outras regras. Quanto menor o número, maior a prioridade avaliada. O valor recomendado é 

            `2000`
          </td>
        </tr>

        <tr>
          <td>
            **Encerrar**
          </td>

          <td>
            Se ativado, nenhuma regra adicional será aplicada às métricas após esta regra corresponder com sucesso a uma métrica.
          </td>
        </tr>

        <tr>
          <td>
            **Ativo**
          </td>

          <td>
            Alterne para ativar ou desativar a regra.
          </td>
        </tr>

        <tr>
          <td>
            **Notas**
          </td>

          <td>
            Notas sobre a regra para referência.
          </td>
        </tr>
      </tbody>
    </table>

    3. Clique em **Save**.
  </Collapser>

  <Collapser id="update-metric-normalization-rule" title="Atualizar uma regra de normalização de métrica">
    ### Atualizar uma regra de normalização de métrica [#update-rule]

    1. Na página <DNT>**Metric normalization rules**</DNT>, selecione a regra e clique no ícone <Icon name="fe-more-horizontal" />, depois selecione **Edit**.
    2. Atualize os detalhes necessários.
    3. Clique em **Save**.
  </Collapser>
</CollapserGroup>

## Desativar uma regra de normalização de métrica [#disable-rule]

Você não pode excluir uma regra de normalização de métrica, mas pode desativá-la. A regra desativada não afetará nenhuma métrica reportando para a New Relic. Você pode desativar uma regra `DENY_NEW_METRICS` na página **MGI details** quando o `Denied rate (minute)` for inferior ao `resolution rate (minute)` de 1000.

Para desativar uma regra:

1. Na página <DNT>**Metric normalization rules**</DNT>, selecione a regra necessária e clique no ícone <Icon name="fe-more-horizontal" />; em seguida, clique em **MGI details**.
2. Clique em **Deactivate**.

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

## Página de detalhes do MGI [#mgi-details]

A página **<DNT>MGI details</DNT>** fornece uma visão geral abrangente das regras de normalização de métricas aplicadas às suas métricas. Isso permite que você analise o impacto dessas regras em seus dados de métricas e tome decisões informadas sobre o gerenciamento de métricas de alta cardinalidade.

Na página **MGI details**, você pode visualizar as seguintes informações:

* **Blocked Metrics Overview**: Exibe o número de métricas afetadas pela regra `DENY_NEW_METRICS`, incluindo a taxa na qual as métricas são bloqueadas. Insights semelhantes estão disponíveis para ações `REPLACE` e `IGNORE`.
* **Time Picker Functionality**: Permite visualizar o relatório de métricas antes da ativação da regra, discriminado por prefixo de métrica. Este recurso ajuda a identificar a origem do crescimento de métricas.
* **NRQL Query Integration**: Oferece um botão &apos;visualizar no construtor de consultas&apos; para ver a consulta NRQL ilustrando a explosão de métricas logo antes de qualquer regra ser aplicada. Isso visa dados de Metric Timeslice, permitindo análises retrospectivas de até três meses.
* **Metric Pattern Identification**: Permite a identificação de padrões de métricas em explosão e a criação de novas regras de regex para gerenciá-los de forma eficaz.
* **Real-Time Status Indicators**: Inclui widgets que mostram o status atual das regras de normalização, com indicadores mudando de &apos;Ativo&apos; para &apos;Mitigado&apos; à medida que as regras gerenciam o crescimento das métricas.
* **Rule Modification Capability**: Permite que os usuários desativem suas próprias regras de `DENY_NEW_METRICS` diretamente da página de Detalhes da MGI, bem como modifiquem regras de `REPLACE` e `IGNORE` sem tickets de suporte. Para mais informações, consulte [Desabilitar uma regra](#disable-rule).

### Acesse a página de detalhes do MGI [#access-mgi]

Na página <DNT>**Metric normalization rules**</DNT>, selecione a regra e clique no ícone <Icon name="fe-more-horizontal" />; em seguida, selecione **MGI details**.

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

### Exemplo de caso de uso [#example-use-case]

No exemplo acima, a página de detalhes do MGI exibe que 1,1 milhão de nomes de métricas únicos são bloqueados pela regra `DENY_NEW_METRICS` a uma taxa de 738 métricas por minuto. A maior parte desse crescimento é atribuída ao namespace `WebTransaction/Uri/RESTfulExample/users/username/`. Ao visualizar a consulta NRQL, você pode identificar a fonte da explosão, permitindo criar uma nova regra para gerenciar as métricas de forma eficaz.