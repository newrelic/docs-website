---
title: Baseline sua ingestão de dados
tags:
  - Observability maturity
  - Operational efficiency
  - Data ingest cost
  - Sampling rate
  - Drop rules
  - Observability as code
  - Value drivers
  - Bill and Usage Data
  - Data ingest cost
metaDescription: 'The second part of New Relic''s data ingest governance series on optimizing how you ingest and use your telemetry data: this focuses on baselining your data ingest.'
freshnessValidatedDate: never
translationType: machine
---

import omaoedgBaselineIcon from 'images/oma-oe-dg_icon_baseline.webp'

import omaoedgSimpleCompareWithTimeSeries from 'images/oma-oe-dg_screenshot-full_simple-compare-with-time-series.webp'

import omaoedgJaggedDailyRateTimeSeries from 'images/oma-oe-dg_screenshot-full_jagged-daily-rate-timeseries.webp'

import omaoedgSlidingWindowSmoothExample from 'images/oma-oe-dg_screenshot-full_smoothed-daily-rate-timeseries.webp'

import omaoedgDerivativeExample from 'images/oma-oe-dg_screenshot-crop-rate-of-growth-time-series.webp'

import omaoedgEventTypeExample from 'images/oma-oe-dg_screenshot-full_facet-event-type-example.webp'

import omaoedgFacetMetricnameExample from 'images/oma-oe-dg_screenshot-full_facet-metricname-example.webp'

import omaoedgDataIngestGovBaselineOverviewTab from 'images/oma-oe-dg_screenshot-full_data-ingest-gov-baseline-overview.webp'

import omaoedgDataIngestGovBaselineReportsTab from 'images/oma-oe-dg_screenshot-full_data-ingest-gov-baseline-reports.webp'

import omaoedgDataIngestGovBaselineBrowserTab from 'images/oma-oe-dg_screenshot-full_data-ingest-gov-baseline-browser.webp'

import omaoedgThirtyDayRateTargetLine from 'images/oma-oe-dg_screenshot-full_target-30-day-rate-ts.webp'

import omaoedgIngestTargetLine from 'images/oma-oe-dg_screenshot-full_ingest-target-line.webp'

import omaoedgBaselineSheet from 'images/oma-oe-dg_diagram_baseline-sheet.webp'

import omaoedgLookoutViewTelemType from 'images/oma-oe-dg_screenshot-crop_lookout-view-telem-type.webp'

import omaoedgLookoutViewConsumingAccount from 'images/oma-oe-dg_screenshot-crop_lookout-view-consuming-account.webp'

import omaoedgInfraIntegrationsNrIo from 'images/oma-oe-dg_screenshot-full_infra-integrations-nr-io.webp'

import omaoedgEntityBreakdownDash from 'images/oma-oe-dg_screenshot-full_entity-breakdown-dash.webp'

<img
  src={omaoedgBaselineIcon}
  alt="Baseline"
  style={{ height: '96px', width: '120px', verticalAlign: 'middle' }}
/>

<DoNotTranslate>**Data ingest governance**</DoNotTranslate> é a prática de obter o valor ideal para os dados de telemetria coletados por uma organização. Isto é especialmente importante para uma organização complexa que possui inúmeras unidades de negócios e grupos de trabalho. Esta é a segunda parte de um guia de quatro partes para otimizar a ingestão de dados do New Relic e faz parte de [nossa série sobre maturidade de observabilidade](/docs/new-relic-solutions/observability-maturity/introduction).

## Antes que você comece [#before-start]

Este guia contém recomendações detalhadas para otimizar a ingestão de dados. Antes de usar este guia, recomendamos que você revise [nossos documentos gerais de gerenciamento de dados](/docs/data-apis/manage-data/manage-your-data).

## Sobre esta etapa [#about]

Para esta fase da sua prática de governação de ingestão de dados, é necessário obter uma visão de alto nível de toda a telemetria que está a ser gerada atualmente pela sua organização. A unidade se concentra em dividir as estatísticas de ingestão em vários grupos, como conta, tipo de telemetria e aplicativo. Esses números serão usados para informar os estágios [de Otimizar seus dados de ingestão](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-optimizing) e [Prever seus dados de ingestão](/docs/new-relic-solutions/observability-maturity/operational-efficiency/data-governance-forecast-ingest-guide/) .

Você aprenderá como gerar um relatório detalhado estruturado para as seguintes dimensões:

* Organização
* Contas específicas em sua organização
* Tipo de telemetria faturável

Além disso, você aprenderá como criar detalhamentos altamente granulares, incluindo:

* Aplicativo (APM | Browser | mobile)
* Cluster do Kubernetes
* Integração de infraestrutura

## Resultado desejado [#desired-outcome]

Entenda exatamente quais grupos da sua organização estão contribuindo com quais tipos de dados e com que quantidade.

## Pré-requisitos [#prereqs]

<CollapserGroup>
  <Collapser
    id="understand-nr-consumption-metrics"
    title="Entenda os tipos de eventos de consumo"
  >
    Toda a telemetria faturável é rastreada com nossos eventos `NrConsumption` e `NrMTDConsumption` . Este guia se concentra em como consultar `NrConsumption`, que fornece dados mais granulares e em tempo real do que `NrMTDConsumption`. O atributo `NrConsumption` `usageMetric` denota o tipo de telemetria.

    Usando `NrConsumption`, você pode fazer perguntas como "Quantos <InlinePopover type="browser"/>dados cada conta ingeriu nos últimos 30 dias?" e "Como a ingestão mudou desde os 30 dias anteriores?" Aqui está uma consulta retornando esses dados:

    ```sql
    FROM NrConsumption SELECT sum(GigabytesIngested) WHERE usageMetric = 'BrowserEventsBytes' SINCE 30 days AGO COMPARE WITH 30 days AGO FACET consumingAccountName
    ```

    A resposta mostra quantos GBs de dados de monitoramento do Browser você ingeriu por conta.

    ```shell
    Banking platform, 75 GB, +2.9%
    Marketing platform, 40 GB, -1.3%
    ```

    Abaixo está um detalhamento dos diferentes tipos de `usageMetric` , o evento constituinte (tipos de evento onde os dados são armazenados) e o tipo de agente ou mecanismo responsável pela criação da ingestão de dados.

    ### Tabela de detalhamento de telemetria faturável

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            NrcConsumption.usageMetric
          </th>

          <th style={{ width: "200px" }}>
            Evento constituinte
          </th>

          <th>
            Fonte
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            InfraHostBytes
          </td>

          <td>
            `SystemSample`, `StorageSample`, `InfrastructureEvent`, `NetworkSample`
          </td>

          <td>
            Agente de infraestrutura
          </td>
        </tr>

        <tr>
          <td>
            InfraProcessBytes
          </td>

          <td>
            `ProcessSample`
          </td>

          <td>
            Agente de infraestrutura
          </td>
        </tr>

        <tr>
          <td>
            InfraIntegrationBytes
          </td>

          <td>
            Vários eventos para integração de plataforma de terceiros, bem como `ContainerSample`
          </td>

          <td>
            [integração no host](/docs/infrastructure/host-integrations/get-started/introduction-host-integrations/) e certa [integração na nuvem](/docs/infrastructure/infrastructure-integrations/get-started/introduction-infrastructure-integrations/#cloud)
          </td>
        </tr>

        <tr>
          <td>
            ApmEventsBytes
          </td>

          <td>
            `Transaction`, `TransactionError` e possivelmente `WorkloadStatus`
          </td>

          <td>
            Agente APM(s)
          </td>
        </tr>

        <tr>
          <td>
            TracingBytes
          </td>

          <td>
            `Span`, `SpanEvent`
          </td>

          <td>
            Agente APM(s) e OpenTelemetry
          </td>
        </tr>

        <tr>
          <td>
            BrowserEventsBytes
          </td>

          <td>
            `Browser`, `BrowserInteraction`, `Browser:EventLog`, `Browser:JSErrors`, `JavaScriptError`, `PageView`, `PageViewTiming`, `PcvPerf`
          </td>

          <td>
            agente browser
          </td>
        </tr>

        <tr>
          <td>
            MobileEventsBytes
          </td>

          <td>
            `Mobile`, `MobileReqest`, `MobileRequestError`, `MobileSession`, `MobileHandleException`, `MobileCrash`
          </td>

          <td>
            Agente móvel
          </td>
        </tr>

        <tr>
          <td>
            SeverlessBytes
          </td>

          <td>
            Específico da nuvem (ou seja, evento AWS Lambda)
          </td>

          <td>
            Específico da nuvem (ou seja, integração AWS Lambda)
          </td>
        </tr>

        <tr>
          <td>
            LoggingBytes
          </td>

          <td>
            `Log` bem como evento específico da partição do padrão `[partition].Log`
          </td>

          <td>
            Vários (Fluentd, FluentBit, Syslog, serviços de streaming específicos para nuvem)
          </td>
        </tr>

        <tr>
          <td>
            MetricEventBytes
          </td>

          <td>
            `Metric`
          </td>

          <td>
            Da API métrica e da integração que a utiliza ([métricas dimensionais](/docs/data-apis/understand-data/new-relic-data-types/#dimensional-metrics)), ou de agentes como agente Browser, agente APM ou agente móvel ([métrica de fração de tempo data](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data)).
          </td>
        </tr>

        <tr>
          <td>
            Bytes de eventos personalizados
          </td>

          <td>
            Vários
          </td>

          <td>
            Várias API. [Use `SHOW EVENT TYPES` para visualizar todos os tipos de eventos disponíveis em uma conta](#show-event-types).
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="understand-monthly-ingest-targets"
    title="Entenda o destino da ingestão mensal da sua organização"
  >
    Para nosso [modelo de preços baseado no uso](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing), os dados de telemetria e o usuário contribuem para seu uso e custo. Este guia se concentra em maximizar o valor dos dados de telemetria. A menção de usuário nesta seção é para ajudá-lo a entender as diferentes opções para equilibrar usuário e dados.

    Existem três tipos gerais de planos de uso. Seu plano de uso pode afetar como você define o destino de ingestão para sua organização.

    ### Contratos de compromisso

    Se você tiver um [contrato de compromisso](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing/#usage-plans), provavelmente terá um orçamento de destino mensal para ingestão de dados. Por exemplo, você pode ter definido um destino de 5 TB por dia e 100 usuários completos da plataforma. Neste tipo de contrato, o usuário pode ser “trocado”, mas é melhor discutir isso com outras partes interessadas na sua organização para garantir que você está obtendo a combinação certa para seus objetivos de observabilidade. Embora alguns clientes planeiem a variabilidade no seu consumo durante o ano, vamos assumir por enquanto que o seu orçamento de consumo mensal é a sua taxa de compromisso anual total dividida por 12.

    Se você souber o número de usuários completos da plataforma e de usuários principais necessários, poderá usar esta fórmula:

    ```sql
    (monthly_target_spend - (num_fso_users*per_fso_cost) - (num_core_users*per_core_cost))/YOUR_INGESTED_DATA_COST
    ```

    Não tem certeza do custo dos seus dados? Consulte [Dados ingeridos](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/data-ingest-billing#data-prices).

    ### Pague conforme o uso

    Em um [plano pré-pago,](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing/#usage-plans) você não terá um compromisso anual predeterminado; no entanto, provavelmente terá um limite compreendido para seus gastos mensais. Neste modelo, você faria o seguinte para determinar sua ingestão de destino:

    ```sql
    (monthly_target_spend - (num_fso_users*per_fso_cost) - (num_core_users*per_core_cost))/YOUR_INGESTED_DATA_COST
    ```

    Não tem certeza do custo dos seus dados? Consulte [Dados ingeridos](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/data-ingest-billing#data-prices).

    ### Edição grátis [#free-tier]

    Com todas as [nossas edições](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing#editions), você obtém 100 GB de ingestão de dados por mês gratuitamente. Para obter detalhes sobre preços de ingestão de dados acima do valor gratuito, consulte [a tabela de preços de tabela](/docs/licenses/license-information/usage-plans/new-relic-usage-plan/#list-price).
  </Collapser>

  <Collapser
    id="nrql-operators-for-baselining"
    title="Compreenda as operações NRQL úteis para definição de linha de base e modelagem de mudanças"
  >
    <CollapserGroup>
      <Collapser
        id="the-rate-operator"
        title="Avaliar"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use o operador `rate` quando precisar coletar uma amostra de dados extraídos de um determinado período e produzir uma determinada taxa. Por exemplo, pegue uma amostra diária de dados e calcule uma taxa de 30 dias com base nisso.
        </Callout>

        _Taxa de computação baseada em uma determinada amostra de dados_

        Veja qual foi a sua ingestão média diária no último mês.

        ```sql
        SELECT rate(sum(GigabytesIngested), 1 day) AS 'Daily Ingest Rate (GB)' FROM NrConsumption WHERE productLine = 'DataPlatform' LIMIT MAX SINCE 30 days AGO
        ```

        Nossa resposta simples para toda a organização é

        ```shell
        Daily ingest rate: 30.4 k
        ```

        Esta consulta mostra que a taxa de ingestão diária foi de aproximadamente 30 TB por dia no último mês.
      </Collapser>

      <Collapser
        id="the-month-of-operator"
        title="Mês de"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use isto quando for importante restringir um cálculo de ingestão a meses específicos. Por exemplo, a ingestão para uma integração pode ter aumentado no final de janeiro e continuado até meados de fevereiro. Este operador ajudará a segmentar a ingestão para os meses específicos usados para faturamento.
        </Callout>

        _Faceta por mês civil_

        ```sql
        SELECT sum(GigabytesIngested) AS 'Daily Ingest Rate (GB)' FROM NrConsumption WHERE productLine = 'DataPlatform' FACET monthOf(timestamp) LIMIT MAX SINCE 56 weeks AGO
        ```

        A tabela resultante mostra uma variabilidade bastante alta. Observe que as coisas estavam bastante `hot` em agosto e setembro. Parte disso é a sazonalidade da nossa organização, mas também está relacionada ao aumento da amplitude da nossa cobertura de telemetria.

        ```shell
        |MONTH OF TIMESTAMP|GB INGESTED|
        |---|---|
        |December 2021*|636 k|
        |November 2021|901 k|
        |October 2021|873 k|
        |September 2021|1.05 M|
        |August 2021|1.08 M|
        |July 2021|1.05 M|
        |June 2021|887 k|
        |May 2021|881 k|
        |||
        ```
      </Collapser>

      <Collapser
        id="change-analysis"
        title="Compare com"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use isto quando quiser avaliar a quantidade de alteração no volume ou taxa de ingestão entre um período de tempo e outro. Isto é importante para saber se a sua ingestão está aumentando inesperadamente.
        </Callout>

        _Análise Simples de Mudanças_

        ```sql
        SELECT sum(GigabytesIngested) FROM NrConsumption WHERE productLine = 'DataPlatform' AND usageMetric = 'BrowserEventsBytes' SINCE 6 months AGO UNTIL 1 week AGO TIMESERIES 7 weeks COMPARE WITH 2 months ago
        ```

        <img
          src={omaoedgSimpleCompareWithTimeSeries}
          alt="Example chart showing the use of COMPARE WITH to understand growth patterns."
          title="Example chart showing the use of COMPARE WITH to understand growth patterns."
        />

        <figcaption>
          Gráfico de exemplo mostrando o uso de <DoNotTranslate>**COMPARE WITH**</DoNotTranslate> para entender os padrões de crescimento.
        </figcaption>
      </Collapser>

      <Collapser
        id="sliding-window"
        title="Janela deslizante"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use isto quando precisar remover os efeitos da variabilidade regular de ingestão para ver o padrão mais amplo.
        </Callout>

        A telemetria é inerentemente barulhenta. Os fenômenos do mundo real acontecem em surtos, deixando muitos picos e depressões aleatórios no sinal. De certa forma, isso é bom, pois nos permite ver toda a complexidade de um fenômeno. No entanto, quando procuramos ver tendências, podemos nos distrair com os detalhes. NRQL fornece uma maneira poderosa de suavizar qualquer série temporal, combinando cada ponto de dados com pontos um pouco mais antigos. Isso nos permitirá focar na tendência temporal geral, em vez de em um extremo `increase` ou `decrease`.

        Note the jaggedness of the raw time series for 1 day ingest rate:

        ```sql
        FROM NrConsumption SELECT rate(sum(GigabytesIngested), 1 day) WHERE productLine = 'DataPlatform' SINCE 26 weeks AGO TIMESERIES 1 DAY
        ```

        <img
          src={omaoedgJaggedDailyRateTimeSeries}
          alt="Daily rate time series without smoothing."
          title="Daily rate time series without smoothing."
        />

        <figcaption>
          Suavização de série temporal de taxa diária <DoNotTranslate>**without**</DoNotTranslate>
        </figcaption>

        Agora, se usarmos uma [janela deslizante](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/create-smoother-charts-sliding-windows/) de quatro dias para reduzir o impacto de um evento de um único dia, veremos uma imagem mais clara. Quatro dias é uma boa escolha, pois desfocará o impacto de `weekends`, portanto, os dados de domingo serão combinados de alguma forma com os dados de sexta-feira, etc.

        ```sql
        FROM NrConsumption SELECT rate(sum(GigabytesIngested), 1 day) WHERE productLine = 'DataPlatform' since 24 weeks ago TIMESERIES 1 DAY SLIDE BY 4 days
        ```

        <img
          src={omaoedgSlidingWindowSmoothExample}
          alt="Daily rate time series with smoothing."
          title="Daily rate time series with smoothing."
        />

        <figcaption>
          Suavização de série temporal de taxa diária <DoNotTranslate>**with**</DoNotTranslate>
        </figcaption>
      </Collapser>

      <Collapser
        id="derivative"
        title="Derivado"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use isso para estimar a taxa estatística de mudança durante um determinado período de tempo. A taxa de variação é calculada usando uma regressão linear de mínimos quadrados para aproximar a derivada.
        </Callout>

        O NRQL nos fornece algumas ferramentas para avaliar a taxa de mudança. Isto é útil porque, como vemos no exemplo anterior, tivemos um aumento muito grande nos últimos meses nas métricas do Browser. Esta análise de taxa de variação usa o operador `derivative` e nos dá alguma confiança de que o principal crescimento ocorreu no início de setembro. Parece que nossa taxa de crescimento com base na derivada de 7 dias é um tanto negativa, então podemos ter alcançado um novo patamar no momento na ingestão de BrowserEventsBytes.

        ```sql
        SELECT derivative(sum(GigabytesIngested) , 7 day) FROM NrConsumption WHERE productLine = 'DataPlatform'  and usageMetric = 'BrowserEventsBytes'  LIMIT MAX SINCE 3 MONTHS AGO UNTIL THIS MONTH TIMESERIES 1 MONTH slide by 3 days COMPARE WITH 1 WEEK AGO
        ```

        <img
          src={omaoedgDerivativeExample}
          alt="Using a seven day derivative to explore ingest trends"
          title="Using a seven day derivative to explore ingest trends"
        />

        <figcaption>
          Usando uma derivada de sete dias para explorar tendências de ingestão
        </figcaption>
      </Collapser>

      <Collapser
        id="baseline-query-examples"
        title="bytecountestimate()"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use [`bytecountestimate()`](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/usage-queries-alerts/#byte-count-estimate) quando precisar estimar o volume de dados de ingestão para um subconjunto de evento ou métrica bruta.
        </Callout>

        <CollapserGroup>
          ### Exemplos

          <Collapser
            id="ingest-by-application"
            title="Ingestão por aplicativo (APM, Browser, mobile)"
          >
            Execute essas consultas em cada subconta ou em um dashboard com gráficos específicos da conta. A consulta estima uma taxa de 30 dias com base em 1 semana de coleta.

            <DoNotTranslate>
              **Estimate 30 day rate**
            </DoNotTranslate>

            APM:

            ```sql
            FROM Transaction, TransactionError, TransactionTrace, SqlTrace, ErrorTrace, Span SELECT rate(bytecountestimate()/10e8, 30 day) AS 'GB Ingest' FACET appName SINCE 1 WEEK AGO
            ```

            Browser:

            ```sql
            FROM PageAction, PageView, PageViewTiming, AjaxRequest, JavaScriptError SELECT rate(bytecountestimate()/10e8, 30 day) AS 'GB Ingest' FACET appName SINCE 1 WEEK AGO 
            ```

            Móvel:

            ```sql
            FROM Mobile, MobileRequestError, MobileSession SELECT rate(bytecountestimate()/10e8, 30 day) AS 'GB Ingest' FACET appName SINCE 1 WEEK AGO 
            ```
          </Collapser>

          <Collapser
            id="metric-ingest-by-integration"
            title="Ingestão métrica por integração"
          >
            Alguns exemplos de valores `usage.Integration` que aparecerão com este atributo são:

            * com.newrelic.mssql (a integração no host do New Relic MSSQL)
            * com.newrelic.rabbitmq (a integração no host do New Relic RabbitMQ)
            * EC2 (a integração AWS EC2)
            * Lambda (a integração Lambda)

            Execute essas consultas em cada conta específica ou em um dashboard com gráficos específicos da conta.

            <DoNotTranslate>
              **Estimate 30 day rate:**
            </DoNotTranslate>

            ```
            FROM Metric SELECT rate(bytecountestimate()/10e8, 30 day) FACET usage.integrationName SINCE 1 WEEK AGO
            ```

            <DoNotTranslate>
              **Seven day sum:**
            </DoNotTranslate>

            ```sql
            FROM Metric SELECT bytecountestimate()/10e8 FACET usage.integrationName SINCE 1 WEEK AGO
            ```
          </Collapser>

          <Collapser
            id="log-ingest-by-host"
            title="Log de entrada por diversas entidades de infraestrutura"
          >
            De todos [os tipos de telemetria da New Relic](/docs/data-apis/understand-data/new-relic-data-types), os dados log são os que apresentam maior variação. Um registro `Log` pode conter praticamente qualquer campo e muitas vezes não se sabe o que um determinado registro de log conterá. Como não há um esquema comum, a linha de base de ingestão de log pode exigir um pouco mais de análise do que a linha de base de outros tipos de dados.

            Uma das técnicas básicas de ingestão de log mais úteis é tentar estimar a ingestão por host, contêiner ou mesmo por cluster do Kubernetes. aqui estão alguns exemplos:

            <DoNotTranslate>
              **Log ingest by host for past 3 hours (total):**
            </DoNotTranslate>

            ```sql
            FROM Log SELECT bytecountestimate()/10e8 
              WHERE host is not NULL SINCE 3 hours ago FACET host
            ```

            <DoNotTranslate>
              **Log ingest by host (30 day rate):**
            </DoNotTranslate>

            ```sql
            FROM Log SELECT rate(bytecountestimate()/10e8, 30 day) 
              WHERE host is not NULL SINCE 3 hours ago FACET host
            ```

            <DoNotTranslate>
              **Log ingest by cluster_name (30 day rate):**
            </DoNotTranslate>

            ```sql
            FROM Log SELECT rate(bytecountestimate()/10e8, 30 day) 
              WHERE host is not NULL SINCE 3 hours ago FACET cluster_name
            ```

            <DoNotTranslate>
              **Log ingest by cluster_name and container_name (30 day rate):**
            </DoNotTranslate>

            ```sql
            FROM Log SELECT rate(bytecountestimate()/10e8, 30 day) 
              WHERE host is not NULL SINCE 3 hours ago FACET cluster_name, container_name
            ```
          </Collapser>

          <Collapser
            id="ingest-by-k8s-cluster"
            title="Ingerir por cluster do Kubernetes"
          >
            _Estimativa da taxa de 30 dias_

            ```sql
            FROM K8sClusterSample, K8sContainerSample,K8sDaemonsetSample, K8sDeploymentSample, K8sEndpointSample, K8sHpaSample, K8sNamespaceSample, K8sNodeSample, K8sPodSample, K8sReplicasetSample, K8sServiceSample, K8sVolumeSample SELECT rate(bytecountestimate()/10e8, 30 day) AS 'GB Ingest' FACET clusterName SINCE 1 WEEK AGO
            ```
          </Collapser>

          <Collapser
            id="ingest-by-process-sample"
            title="Amostras de processo"
          >
            `ProcessSample` pode ser um evento de grande volume. Neste exemplo, calcularemos a ingestão de 30 dias por linha de comando.

            _Estimar taxa de 30 dias por nome de comando_

            ```sql
            FROM ProcessSample SELECT rate(bytecountestimate()/10e8, 30 day) AS 'GB Ingested' FACET commandName SINCE 1 DAY AGO
            ```
          </Collapser>
        </CollapserGroup>
      </Collapser>

      <Collapser
        id="eventtype-examples"
        title="eventType()"
      >
        <Callout
          variant="important"
          title="Quando usar"
        >
          Use o operador `eventType()` quando precisar ter granularidade no nível do evento em sua consulta e quando não estiver familiarizado com quais eventos personalizados estão presentes em sua conta.
        </Callout>

        Muitas vezes usaremos uma consulta que seleciona vários eventos. Este é um dos principais meios que temos para determinar quantos dados um determinado agente ou integração está nos enviando.

        A consulta a seguir nos informa quantos dados a integração do Kubernetes está nos enviando:

        ```sql
        FROM
        K8sApiServerSample,
        K8sClusterSample,
        K8sContainerSample,
        K8sControllerManagerSample,
        K8sDaemonsetSample,
        K8sDeploymentSample,
        K8sEndpointSample,
        K8sNamespaceSample,
        K8sNodeSample,
        K8sPodSample,
        K8sReplicasetSample,
        K8sSchedulerSample,
        K8sServiceSample,
        K8sStatefulsetSample,
        K8sVolumeSample
        SELECT bytecountestimate()/10e8 AS 'Gigabytes'
        SINCE 1 DAYS AGO
        LIMIT MAX
        ```

        É poderoso por si só, mas retornará apenas um único valor agregado:

        ```shell
        42.341 Gigabytes
        ```

        Quando precisarmos nos aprofundar para saber quantos dados um evento específico está consumindo, podemos usar `eventType()` em uma cláusula de faceta para obter esse resultado.

        Adicionar a cláusula `FACET eventType()` à consulta anterior nos dá:

        <img
          src={omaoedgEventTypeExample}
          alt="Listing of ingest by K8s event type"
          title="Listing of ingest by K8s event type"
        />

        <figcaption>
          Listagem de ingestão por tipo de evento K8s
        </figcaption>
      </Collapser>

      <Collapser
        id="show-event-types"
        title="MOSTRAR TIPOS de evento"
      >
        <Callout
          variant="important"
          title="Quando usar"
        >
          Use `SHOW EVENT TYPES` quando não tiver certeza do evento que existe em sua conta.
        </Callout>

        `SHOW EVENT TYPES` Lista todos os tipos de eventos em uma conta para um determinado período. Para obter mais detalhes, consulte [SHOW evento TYPES](/docs/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions/#show-event-types). Usar uma janela de tempo específica pode ser útil para entender melhor quando um determinado evento começou a entrar no sistema.
      </Collapser>

      <Collapser
        id="facet-metric-name"
        title="Métrica FACETName"
      >
        <Callout
          variant="IMPORTANT"
          title="Quando usar"
        >
          Use `FACET metricName` quando precisar de granularidade no nível do nome da métrica em sua consulta.
        </Callout>

        A melhor maneira de realmente explorar métricas e ter uma noção do volume relativo de dados provenientes de cada uma é usar `FACET metricName` em uma consulta `SELECT FROM Metric` . É possível incorporar cláusulas WHERE para restringir a lista. Por exemplo, para visualizar o volume relativo de ingestão para métrica com o texto `kube_pod` em `metricName` execute uma consulta como esta:

        ```sql
        SELECT bytecountestimate()/10e8 as 'Gigabytes' from Metric facet metricName where metricName like '%kube_pod%' since 1 day ago limit max
        ```

        <img
          src={omaoedgFacetMetricnameExample}
          alt="Listing of ingest by the metricName attribute of the Metric namespace"
          title="Listing of ingest by the metricName attribute of the Metric namespace"
        />

        <figcaption>
          Listagem de ingestão pelo atributo <DoNotTranslate>**metricName**</DoNotTranslate> do namespace <DoNotTranslate>**Metric**</DoNotTranslate>
        </figcaption>
      </Collapser>
    </CollapserGroup>
  </Collapser>
</CollapserGroup>

## Processo [#process]

Aqui estão as principais etapas que você executará como parte deste procedimento de melhoria da governança de ingestão de dados:

* [Instalar o de governança de ingestão de dados baseline dashboard](#install-dashboard)
* [Adicione indicadores de destino de ingestão ao seu dashboard](#add-target-indicators)
* [Gerar um relatório tabular de ingestão de 30 dias](#generate-report)
* [Personalize seu relatório](#customize-report)
* [Detectar anomalia de ingestão](#detect-anomalies)
* [Instale o dashboard de detalhamento da entidade (opcional)](#install-entity-breakdown-dashboard)
* [Instale o dashboard de integração na nuvem (opcional)](#install-cloud-integration-dashboard)

Descreveremos essas etapas com mais detalhes abaixo.

### Instalar o de governança de ingestão de dados baseline dashboard [#install-dashboard]

Para instalar o dashboard:

1. Navegue até o [início rápido de governança de ingestão de dados](https://onenr.io/0PoR8zpDYQG).
2. Clique em `Install this quickstart` na parte superior direita da janela do Browser.
3. Se aplicável: selecione sua conta principal ou de nível superior no alternador de contas.
4. Clique em `Done`.
5. Quando a instalação do guia de início rápido terminar, abra o dashboard `Data ingest governance baseline` .

Isso o levará ao dashboard recém-instalado.

#### Visão geral dashboard [#dashboard-overview]

A guia de visão geral principal mostra uma variedade de gráficos, incluindo algumas visualizações poderosas de séries temporais.

<img
  src={omaoedgDataIngestGovBaselineOverviewTab}
  alt="Organization wide baseline ingest time series"
  title="Organization-wide baseline ingest time series"
/>

<figcaption>
  Série temporal de ingestão baseline em toda a organização
</figcaption>

A segunda guia fornece um relatório baseline por subconta e métrica de uso.

<img
  src={omaoedgDataIngestGovBaselineReportsTab}
  alt="Organization wide baseline reports view"
  title="Organization wide baseline reports view"
/>

<figcaption>
  Visualização de relatórios baseline em toda a organização
</figcaption>

As guias restantes fornecem visualizações detalhadas de tipos específicos de telemetria, como dados do Browser, dados APM, log e rastreamento. Por exemplo, esta captura de tela mostra a página de detalhes do browser:

<img
  src={omaoedgDataIngestGovBaselineBrowserTab}
  alt="Baseline Browser ingest"
  title="Baseline Browser ingest"
/>

<figcaption>
  Exemplo de detalhe de ingestão focado em um único tipo de telemetria (neste caso, dados do browser).
</figcaption>

As guias de detalhes incluem:

* APM: `ApmEventsBytes`
* Rastreamento: `TracingBytes`
* Browser: `BrowserEventsBytes`
* Móvel: `MobileEventsBytes`
* Infra (anfitrião): `InfraHostBytes`
* Infra (processo):`InfraProcessBytes`
* Infra (integração): `InfraIntegrationBytes`
* Evento personalizado: `CustomEventsBytes`
* Sem servidor: `ServerlessBytes`
* Duende: `PixieBytes`

### Adicione indicadores de destino de ingestão ao seu dashboard [#add-target-indicators]

Na seção de pré-requisitos discutimos o conceito de destino de uso mensal. Na verdade, você pode ter vários destinos para ajudar a mantê-lo no caminho certo:

* Um destino organizacional geral sobre taxa diária ou ingestão mensal.
* Destino por tipo de dados para garantir a distribuição ideal (por exemplo 1 TB por dia para log e 2 TB por dia para métrica).
* Destino para subcontas ou unidades de negócios específicas.

Em nosso exemplo, temos uma organização que destina sua ingestão organizacional total para `<` 360 TB por mês. Este foi um novo destino depois de ter reduzido a ingestão de mais de 20 TB por dia (600 TB por mês).

Para facilitar a medição do destino, adicionamos um gráfico de linhas de limite adicionando o número estático `360000` à nossa instrução `SELECT` .

```sql
SELECT 360000, rate(sum(GigabytesIngested), 30 day) AS '30 Day Rate' FROM NrConsumption WHERE productLine='DataPlatform' since 30 days ago limit max compare with 1 month ago TIMESERIES 7 days
```

<img
  src={omaoedgThirtyDayRateTargetLine}
  alt="Thirty day ingest target line"
  title="Thirty-day ingest target line"
/>

<figcaption>
  Podemos usar NRQL para renderizar uma linha que representa nossa ingestão de trinta dias de destino <DoNotTranslate>**target**</DoNotTranslate>.
</figcaption>

Também podemos aplicar uma linha destino de tarifa diária. Vamos apenas dividir 360.000 por 30 e usaremos 12.000 como nossa taxa diária de destino. Atualize o gráfico `Daily ingest rate (compare with 3 months prior)` :

```sql
SELECT 12000, rate(sum(GigabytesIngested), 1 day) AS avgGbIngestTimeseries FROM NrConsumption WHERE productLine='DataPlatform' TIMESERIES AUTO since 9 months ago limit max COMPARE WITH 3 months ago
```

<img
  src={omaoedgIngestTargetLine}
  alt="Daily ingest target line"
  title="Daily ingest target line"
/>

<figcaption>
  Podemos usar NRQL para renderizar uma linha que representa nossa ingestão diária <DoNotTranslate>**target**</DoNotTranslate>.
</figcaption>

### Gerar um relatório tabular de ingestão de 30 dias [#generate-report]

Para criar um relatório de ingestão de 30 dias:

1. Abra o de governança de ingestão de dados instalado baseline dashboard anteriormente.

2. Clique na guia

   <DoNotTranslate>**Baseline report**</DoNotTranslate>

   .

3. Clique em `...` no canto superior direito da tabela "Últimos 30 dias" e escolha `Export as CSV`

4. Importe o CSV para o Planilhas Google ou para a planilha de sua preferência.

Alternativamente, se você não instalou o dashboard, você pode simplesmente usar esta consulta para criar um gráfico personalizado no [criador de consulta](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder):

```sql
SELECT sum(GigabytesIngested) AS 'gb_ingest_30_day_sum', rate(sum(GigabytesIngested), 1 day) AS 'gb_ingest_daily_rate', derivative(GigabytesIngested, 90 day) as 'gb_ingest_90_day_derivative' FROM NrConsumption WHERE productLine='DataPlatform' since 30 days ago facet consumingAccountName, usageMetric  limit max
```

Abaixo está um exemplo de planilha que importamos para o Planilhas Google.

<img
  src={omaoedgBaselineSheet}
  alt="Baseline tabular spreadsheet"
  title="Screenshot of a baseline report example"
/>

<figcaption>
  Uma planilha exportada da baseline dashboard página tabular
</figcaption>

A captura de tela mostra a tabela classificada pelo total de ingestão de 30 dias.

Sinta-se à vontade para ajustar seu cronograma e alguns detalhes conforme necessário. Por exemplo, optamos por extrair uma derivada de 90 dias para ter alguma noção de mudança nos últimos meses. Você poderia facilmente alterar o período da derivada para atender aos seus objetivos.

### Personalize seu relatório [#customize-report]

Adicione colunas úteis ao seu relatório para facilitar outras fases da governança de ingestão de dados, como <DoNotTranslate>**Optimize**</DoNotTranslate> e <DoNotTranslate>**Forecast**</DoNotTranslate>. Os campos a seguir ajudarão a orientar as decisões de otimização e planejamento:

* Notas: Anote quaisquer anomalias de crescimento e quaisquer explicações relevantes para elas. Indique qualquer grande crescimento esperado, se previsto.
* Contato técnico: Nome do gestor de uma determinada conta ou alguém relacionado a um tipo específico de telemetria.

### Detectar anomalia de ingestão [#detect-anomalies]

Aqui estão algumas etapas para detectar anomalia de ingestão.

#### Alerta sobre anomalia de ingestão [#on-ingest-anomalies]

Use [este guia de alerta de ingestão](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/usage-queries-alerts) para garantir que um aumento no consumo de dados não o pegue de surpresa. No mínimo, crie:

* Um alerta de limite para notificar se você exceder o destino mensal para ingestão de dados além dos aumentos sazonais
* Um alerta de anomalia para notificá-lo sobre um aumento repentino e acentuado na ingestão de dados

Além de usar o alerta para identificar anomalias de consumo, você pode usar o New Relic Lookout para explorar possíveis anomalias de ingestão.

#### Vista do Lookout [#lookout]

O Lookout permite que você forneça praticamente qualquer consulta NRQL e procurará anomalias durante um determinado período de tempo. A visualização abaixo é baseada nesta consulta:

```sql
SELECT rate(sum(GigabytesIngested), 1 day) AS avgGbIngest FROM NrConsumption WHERE productLine='DataPlatform' FACET usageMetric 
```

<img
  src={omaoedgLookoutViewTelemType}
  alt="Lookout view usage metric"
  title="Lookout view usage metric"
/>

<figcaption>
  Podemos usar o Lookout para encontrar anomalias em nossa ingestão até <DoNotTranslate>**usageMetric**</DoNotTranslate>.
</figcaption>

Altere o campo de atributo para `consumingAccountName` para obter esta visualização:

<img
  src={omaoedgLookoutViewConsumingAccount}
  alt="Lookout view consuming account"
  title="Lookout view consuming account"
/>

<figcaption>
  Podemos usar o Lookout para encontrar anomalias em nossa ingestão até <DoNotTranslate>**consumingAccountName**</DoNotTranslate>.
</figcaption>

### Instale o dashboard de detalhamento da entidade (opcional) [#install-entity-breakdown-dashboard]

Em uma seção anterior você instalou o dashboard de ingestão `baseline` que usa `NrConsumption` como fonte principal. Além dessa visualização de alto nível, você pode criar outras visualizações que usam `bytescountestimate()` para estimar a ingestão para praticamente qualquer evento ou métrica. Uma visão geral detalhada de `bytescountestimate()` foi discutida [na seção de pré-requisitos](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-baselining#baseline-query-examples).

Para instalar o dashboard de detalhamento da entidade:

1. Vá para o [mesmo início rápido](https://onenr.io/0PoR8zpDYQG) usado para o baseline dashboard.

2. Clique em `Install this quickstart` na seção superior direita da janela do Browser.

3. Você deve instalá-lo em qualquer conta que contenha APM, monitoramento de Browser, monitoramento de Mobile ou cluster do Kubernetes usando a [função import dashboard ](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/#dashboards-import). (Se você tiver uma parceria: não instale este dashboard em uma conta de proprietário de parceria ou POA.) Você pode instalar este dashboard em várias contas. Se você tiver uma estrutura de conta pai/filho: você pode instalar o dashboard em uma conta pai e modificar o dashboard para ter gráficos específicos da conta dashboard completo .

4. Clique em `Done`.

5. Quando a instalação do guia de início rápido terminar, abra o dashboard `Data governance entity breakdowns` .

   <img
     src={omaoedgEntityBreakdownDash}
     alt="Entity breakdown dashboard"
     title="Entity breakdown dashboard"
   />

   <figcaption>
     O dashboard de detalhamento da entidade usa <DoNotTranslate>**bytecountestimate()**</DoNotTranslate> para ingestão de atributos por atributo útil, como aplicativo ou nome do cluster
   </figcaption>

Você pode consultar [esta seção](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-baselining#understand-nr-consumption-metrics) para ver exatamente quais tipos de eventos são usados nessas análises.

<Callout variant="tip">
  Essas consultas consomem mais recursos porque não funcionam a partir de uma fonte de dados pré-agregada como `NrConsumption`. Talvez seja necessário ajustar os prazos usando cláusulas `WHERE` e `LIMIT` adicionais para que funcionem melhor em alguns de seus ambientes.
</Callout>

### Instale o dashboard de integração na nuvem (opcional) [#install-cloud-integration-dashboard]

A integração na nuvem da New Relic muitas vezes pode ser uma fonte significativa de crescimento na ingestão de dados. Sem boas visualizações pode ser muito difícil identificar de onde vem o crescimento. Isso ocorre em parte porque essas integrações são muito fáceis de configurar e não fazem parte do pipeline normal de CI/CD de uma organização. Eles também podem não fazer parte de um sistema formal de gerenciamento de configuração.

Felizmente, este poderoso conjunto de <InlinePopover type="dashboards"/>pode ser instalado [diretamente do New Relic Instant observabilidade](https://onenr.io/0EPwJJO9Ow7).

O painel individual instalado por este pacote inclui:

* Integração AWS
* Integração Azure
* Integração do Google Cloud Platform
* Integração sem host
* Kubernetes

<img
  src={omaoedgInfraIntegrationsNrIo}
  alt="Infra integrations dashboard"
  title="Infra integrations dashboard"
/>

<figcaption>
  Este [início rápido](https://onenr.io/0EPwJJO9Ow7) contém um conjunto altamente granular de painéis que detalham os dados de quase todas as integrações na nuvem, integração no host e integração do Kubernetes.
</figcaption>

## Exercício [#exercise]

Responder às seguintes perguntas irá ajudá-lo a desenvolver confiança na sua capacidade de interpretar dados baseline e fazer inferências corretas. Estas perguntas podem ser respondidas usando a [baselinede ingestão de dados](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-baselining#install-dashboard) e os painéis [de detalhamento da entidade de ingestão de dados](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-baselining#install-entity-breakdown-dashboard) . Instale esse painel conforme descrito e veja quantas dessas perguntas você pode responder.

| Questões                                                                                                                                                                                                                                       |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Qual é a taxa diária típica de ingestão para toda a organização (todas as contas) na semana passada? O que foi três meses antes?                                                                                                               |
| Quais são os três principais tipos de telemetria (para a organização como um todo) por ingestão? Liste cada tipo de telemetria e sua taxa de ingestão mais recente em 30 dias.                                                                 |
| Quantas contas contribuem para a ingestão desta organização?                                                                                                                                                                                   |
| Quantas contas (se houver) contribuem atualmente com mais de 50 TB por mês?                                                                                                                                                                    |
| Quais são as três principais contas em termos de ingestão nos últimos 30 dias?                                                                                                                                                                 |
| Qual é a ingestão de GB no mês de janeiro passado para a conta com maior consumo?                                                                                                                                                              |
| Quais são as três principais contas em termos de ingestão de `ApmEventsBytes` nos últimos 30 dias                                                                                                                                              |
| Qual é o maior aumento em termos de ingestão de tipo de telemetria para uma determinada conta nos últimos nove meses? E quanto às diminuições?                                                                                                 |
| Acesse a conta que mais contribui `ApmEventsBytes` e instale/abra o `data governance entity breakdown dashboard`. Liste os três principais aplicativos APM por ingestão nas últimas 24 horas e suas respectivas taxas de ingestão em 24 horas. |

## Conclusão [#conclusion]

A seção [de processos](#process) orientou você na criação de visualizações e relatórios de ingestão de dados. Agora você pode revisar a ingestão de dados com uma abordagem visual orientada por dados que você e seus colegas podem usar para colaborar.

Daqui para frente, decida quais visualizações usar para:

* Seus [check-ins de ingestão mensal](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-coe#monthly-ingest-check-ins)
* Suas [reuniões anuais de planejamento de ingestão](/docs/new-relic-solutions/observability-maturity/operational-efficiency/dg-coe#yearly-ingest-target-planning)
* Visualizações de práticas recomendadas para qualquer pessoa que gerencia a ingestão de dados de uma ou mais contas em uma organização.

## Recursos adicionais [#additional-resources]

Outros recursos relacionados incluem:

* [Gerenciar dados recebidos](/docs/data-apis/manage-data/manage-data-coming-new-relic/)
* [Centro de gerenciamento de dados](/docs/data-apis/manage-data/manage-your-data/)
* [Eliminar dados usando Nerdgraph](/docs/data-apis/manage-data/drop-data-using-nerdgraph/)
* [Alerta sobre anomalia de ingestão de dados](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/usage-queries-alerts/)
* [Automatizando o fluxo de trabalho da telemetria](https://developer.newrelic.com/automate-workflows/)
* [Agregação métrica e evento para métrica](/docs/data-apis/convert-to-metrics/create-metrics-other-data-types/)