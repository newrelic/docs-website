---
duration: 30
title: Mapeie visualiza√ß√µes de p√°ginas por regi√£o em um aplicativo personalizado
metaDescription: Build a New Relic app showing page view data on a world map.
freshnessValidatedDate: never
translationType: machine
---

New Relic possui ferramentas poderosas e flex√≠veis para criar aplicativos personalizados e preench√™-los com dados. Este guia mostra como criar um aplicativo personalizado e preench√™-lo com dados de visualiza√ß√£o de p√°gina usando a linguagem de consulta da New Relic (NRQL - pronuncia-se 'nurkle'). Ent√£o voc√™ torna seus dados interativos. E por √∫ltimo, se voc√™ tiver um pouco mais de tempo e quiser instalar uma biblioteca React de terceiros, poder√° exibir os dados de visualiza√ß√£o de p√°gina coletados em um mapa-m√∫ndi.

Neste guia, voc√™ cria um aplicativo para exibir dados de visualiza√ß√£o de p√°gina de duas maneiras:

* Em uma mesa
* Em um mapa

Revise a se√ß√£o **Before you begin** para ter certeza de que tem tudo o que precisa e n√£o fique preso no meio do caminho.

## Antes de voc√™ come√ßar [#begin]

Para aproveitar ao m√°ximo este guia, voc√™ deve ter:

* Uma conta New Relic, chave de API e ferramenta de linha de comando.
* New Relic Browser para preencher o aplicativo. Sem esses dados, voc√™ n√£o conseguir√° concluir este guia.

Para adicionar seus dados a um mapa mundial na segunda metade do guia:

* npm, que voc√™ usar√° durante esta se√ß√£o do guia para instalar [Leaflet](https://www.npmjs.com/package/leaflet), uma biblioteca JavaScript React de terceiros usada para construir mapas interativos. Se voc√™ √© novo no React e no npm, pode acessar aqui para [instalar o Node.js e o npm](https://nodejs.org/en/download/).

## Terminologia New Relic [#terminology]

A seguir est√£o alguns termos usados neste guia:

* Aplicativo New Relic : O produto final onde os dados s√£o renderizados no New Relic. Pode parecer uma s√©rie de gr√°ficos interativos ou um mapa do mundo.
* Nerdpack: cole√ß√£o padr√£o de JavaScript, JSON, CSS e outros arquivos da New Relic que controlam a funcionalidade e a apar√™ncia do seu aplicativo. Para obter mais informa√ß√µes, consulte [Estrutura de arquivos Nerdpack](/explore-docs/nerdpack-file-structure).
* Launcher: O bot√£o no New Relic que inicia seu aplicativo.
* Nerdlets: New Relic React usados para construir seu aplicativo. Os tr√™s arquivos padr√£o s√£o `index.js`, `nr1.json` e `styles.scss`, mas voc√™ pode personalizar e adicionar seus pr√≥prios.

## Crie um aplicativo personalizado com um gr√°fico de tabela [#build-app-table-chart]

<Steps>
  <Step>
    ### Consulte seus dados do browser [#query-data]

    Use o criador de consulta para escrever uma consulta NRQL para ver os dados de visualiza√ß√£o da sua p√°gina, como segue.

    No New Relic, selecione **Query your data** (no canto superior direito). Isso coloca voc√™ no modo **NRQL** . Voc√™ usar√° NRQL para testar sua consulta antes de colocar os dados em sua tabela.

    Copie e cole esta consulta em um campo de consulta limpo e selecione **Run**.

    ```sql
    FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000
    ```

    Se voc√™ tiver dados de PageView, esta consulta mostrar√° uma semana de m√©dia de visualiza√ß√µes de p√°gina divididas por pa√≠s e limitada a mil itens. A tabela ter√° largura total e usar√° a classe "gr√°fico" definida no CSS.

    Se voc√™ n√£o tiver nenhum resultado neste momento, certifique-se de que sua consulta n√£o contenha erros. Se sua consulta estiver correta, talvez voc√™ n√£o tenha o [agente do Browser](https://docs.newrelic.com/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent) instalado.
  </Step>

  <Step>
    ### Crie e sirva um novo Nerdpack [#create-nerdpack]

    Para come√ßar, crie um novo Nerdpack e sirva-o no New Relic a partir do seu ambiente de desenvolvimento local:

    1. Atualize `nr1` e crie um novo Nerdpack para este aplicativo:

       ```bash
       nr1 update
       nr1 create --type nerdpack --name pageviews-app
       [output] {success}‚úî  {plain}Component created successfully!
       [output]    {purple}nerdpack {blue}pageviews-app {plain}is available at {green}"./pageviews-app"
       ```

    2. Servir o projeto at√© a New Relic:

       ```bash animate
       cd pageviews-app && nr1 nerdpack:serve
       [output] Found and loaded {green}2 {plain}nr1.json files on PageviewsApp ({purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45{plain}) Nerdpack.
       [output]
       [output] {purple}Nerdpack:
       [output] {success}‚úî  PageviewsApp {purple}(00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45) {blue}nr1.json
       [output]
       [output] {purple}Launchers:
       [output] {success}‚úî  {green}pageviews-app-launcher {blue}launchers/pageviews-app-launcher/nr1.json
       [output]
       [output] {purple}Nerdlets:
       [output] {success}‚úî  {green}pageviews-app-nerdlet {blue}nerdlets/pageviews-app-nerdlet/nr1.json
       [output]
       [output] üõ†  Built artifact files for:
       [output] {yellow}‚Åé  {purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45--pageviews-app-nerdlet {plain}built {success}‚úî
       [output]
       [output] {success}‚úî  {plain}Nerdpack built successfully!
       [output] {yellow}‚òÖ  {plain}Starting as orchestrator...
       [output]
       [output] {success}‚úî  {plain}Server ready! Test it at: https://staging-one.newrelic.com/?nerdpacks=local
       [output] {blue}‚Ü©  Server will reload automatically if you modify any file!
       [output]
       [output] üõ†  Built artifact files for:
       [output] {yellow}‚Åé  {purple}00e0f043-1fc3-42cd-a8ca-7eef5fc9cd45--pageviews-app-nerdlet {plain}built {success}‚úî
       [output]
       [output] {success}‚úî  {plain}Nerdpack built successfully!
       ```
  </Step>

  <Step>
    ### Revise os arquivos do seu aplicativo e visualize-o localmente [#review-files]

    1. Navegue at√© `pageviews-app` para ver como ele est√° estruturado. Ele cont√©m uma pasta inicializadora, onde voc√™ pode personalizar a descri√ß√£o e o √≠cone que ser√° exibido no inicializador do aplicativo no New Relic. Ele tamb√©m cont√©m `nerdlets`, cada um contendo tr√™s arquivos padr√£o: `index.js`, `nr1.json` e `styles.scss`. Voc√™ editar√° alguns desses arquivos como parte deste guia. Para obter mais informa√ß√µes, consulte [Estrutura de arquivos Nerdpack](/explore-docs/nerdpack-file-structure).
    2. Agora, em seu navegador, abra `https://one.newrelic.com/?nerdpacks=local` e clique em **Apps** para ver o `pageview-apps` Nerdpack que voc√™ disponibilizou.

       Ao selecionar o iniciador, voc√™ ver√° uma mensagem `Hello` .
  </Step>

  <Step>
    ### Codifique o ID da sua conta [#account-id]

    Para os fins deste exerc√≠cio e para sua conveni√™ncia, codifique o ID da sua conta. No diret√≥rio `pageview-app-nerdlet` , no arquivo `index.js` , adicione este c√≥digo entre as linhas `import` e `export` . ([Leia sobre como encontrar o ID da sua conta aqui](/docs/accounts/install-new-relic/account-setup/account-id)).

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return <h1>Hello, pageview-app-nerdlet Nerdlet!</h1>;
      }
    }
    ```
  </Step>

  <Step>
    ### Importe o componente `TableChart` [#import-table-component]

    Para mostrar seus dados em um gr√°fico de tabela, importe o componente `TableChart` do New Relic. Para fazer isso, em `index.js`, adicione este c√≥digo em `import React`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return <h1>Hello, pageview-app-nerdlet Nerdlet!</h1>;
      }
    }
    ```
  </Step>

  <Step>
    ### Adicione uma tabela com uma √∫nica linha [#add-single-row-table]

    Para adicionar uma tabela com uma √∫nica linha, no arquivo `index.js` , substitua esta linha por este c√≥digo `export` :

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row"></div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Personalize a apar√™ncia da sua mesa (opcional) [#customize-table]

    Voc√™ pode usar CSS padr√£o para personalizar a apar√™ncia dos seus componentes.

    No arquivo `styles.scss` , adicione este CSS. Sinta-se √† vontade para personalizar este CSS ao seu gosto.

    ```css fileName=pageview-app-nerdlet/styles.scss
    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }
    ```
  </Step>

  <Step>
    ### Coloque seus dados nessa tabela [#add-data-table]

    Agora que voc√™ tem uma tabela, pode descartar um `TableChart` preenchido com dados da consulta NRQL que voc√™ escreveu no in√≠cio deste guia.

    Coloque este c√≥digo na div `row` .

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    V√° para New Relic e clique no seu aplicativo para ver seus dados na tabela. (Talvez seja necess√°rio veicular seu aplicativo no New Relic novamente.)

    Parab√©ns! Voc√™ fez seu aplicativo! Continue para torn√°-lo interativo e mostrar seus dados em um mapa.
  </Step>
</Steps>

## Torne seu aplicativo interativo com um campo de texto [#app-text-field]

Depois de confirmar que os dados est√£o chegando ao New Relic a partir do seu aplicativo, voc√™ pode come√ßar a personaliz√°-los e torn√°-los interativos. Para fazer isso, voc√™ adiciona um campo de texto para filtrar seus dados. Mais tarde, voc√™ usar√° uma biblioteca de terceiros chamada `Leaflet` para mostrar esses dados em um mapa mundial.

<Steps>
  <Step>
    ### Importe o componente `TextField` [#import-textfield]

    Assim como fez com o componente `TableChart` , voc√™ precisa importar um [componente`TextField` ](/client-side-sdk/index.html#components/TextField)do New Relic.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Adicione uma linha ao seu campo de texto [#add-row-textfield]

    Para adicionar um filtro de campo de texto acima da tabela, coloque este c√≥digo acima da div `TableChart` . O campo de texto ter√° um valor padr√£o de ‚ÄúEUA‚Äù.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      render() {
        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Construa o objeto de campo de texto [#build-text-field]

    Acima da fun√ß√£o `render()` , adicione um `constructor` para criar o objeto de campo de texto.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Acima de `return`, adicione:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Agora adicione `countryCode` √† sua consulta de gr√°fico de tabela.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Recarregue seu aplicativo para testar o campo de texto.
  </Step>
</Steps>

## Coloque seus dados em um mapa [#add-data-map]

Para criar o mapa, voc√™ usa npm para instalar `Leaflet`.

<Steps>
  <Step>
    ### Instalar `Leaflet` [#install-leaflet]

    No seu terminal, digite:

    ```bash
    npm install --save leaflet react-leaflet
    ```

    No arquivo `styles.scss` dos nerdlets, importe o CSS `Leaflet` :

    ```css fileName=pageview-app-nerdlet/styles.scss
    @import `~leaflet/dist/leaflet.css`;

    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }
    ```

    Enquanto estiver em `styles.scss`, corrija a largura e a altura do seu mapa:

    ```css fileName=pageview-app-nerdlet/styles.scss
    @import `~leaflet/dist/leaflet.css`;

    .container {
      width: 100%;
      height: 99vh;
      display: flex;
      flex-direction: column;
      .row {
        margin: 10px;
        display: flex;
        flex-direction: row;
      }
      .chart {
        height: 250px;
      }
    }

    .containerMap {
      width: 100%;
      z-index: 0;
      height: 70vh;
    }
    ```
  </Step>

  <Step>
    ### Adicione um arquivo de configura√ß√£o do webpack para `Leaflet`

    Adicione um arquivo de configura√ß√£o do webpack `.extended-webpackrc.js` √† pasta de n√≠vel superior do seu nerdpack. Isso suporta o uso de dados de informa√ß√µes de blocos de mapa de `Leaflet`.

    ```jsx fileName=.extended-webpackrc.js
    module.exports = {
      module: {
        rules: [
          {
            test: /\.(png|jpe?g|gif)$/,
            use: [
              {
                loader: 'file-loader',
                options: {},
              },
              {
                loader: 'url-loader',
                options: { limit: 25000 },
              },
            ],
          },
        ],
      },
    };
    ```
  </Step>

  <Step>
    ### Importar m√≥dulos de `Leaflet`

    Em `index.js`, importe m√≥dulos de `Leaflet`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import { TableChart, TextField } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Importe m√≥dulos adicionais do New Relic

    Voc√™ precisa de v√°rios outros m√≥dulos do New Relic para fazer o mapa `Leaflet` funcionar bem. Importe-os com este c√≥digo:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    `NerdGraphQuery` permite fazer v√°rias consultas NRQL de uma s√≥ vez e √© o que preencher√° o mapa com dados. `Spinner` adiciona um controle girat√≥rio de carregamento. `Button` fornece componentes de bot√£o. `BlockText` fornece componentes de texto em bloco.
  </Step>

  <Step>
    ### Obtenha dados para o mapa [#get-data-map]

    Usando latitude e longitude com c√≥digos de pa√≠s, voc√™ pode colocar dados do New Relic em um mapa.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Personalize as cores dos marcadores do mapa [#customize-map-colors]

    Acima da fun√ß√£o `mapData` , adicione este c√≥digo para personalizar as cores dos marcadores do mapa.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Sinta-se √† vontade para alterar os valores do c√≥digo de cores HTML de acordo com sua prefer√™ncia. Neste exemplo, `#11A600` √© verde, `#FFD966` √© meio amarelo e `#BF0016` √© vermelho.
  </Step>

  <Step>
    ### Defina o ponto central padr√£o do seu mapa

    Defina um ponto central padr√£o para o seu mapa usando latitude e longitude.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>

  <Step>
    ### Adicione uma linha ao seu mapa [#add-row-map]

    Entre a linha do campo de texto e a linha do gr√°fico da tabela, insira uma nova linha para o conte√∫do do mapa usando `NerdGraphQuery`.

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <div className="row">
                <NerdGraphQuery query={this.mapData()}>
                  {({ loading, error, data }) => {
                    if (loading) {
                      return <Spinner fillContainer />;
                    }
                    if (error) {
                      return 'Error';
                    }
                    const { results } = data.actor.account.mapData;
                    console.debug(results);
                    return 'Hello';
                  }}
                </NerdGraphQuery>
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```

    Recarregue seu aplicativo no New Relic para testar se ele funciona.
  </Step>

  <Step>
    ### Substitua "Ol√°" pelo c√≥digo do folheto [#replace-hello]

    Substitua `return "Hello";` por:

    ```jsx fileName=pageview-app-nerdlet/index.js
    import React from 'react';
    import {
      TableChart,
      TextField,
      NerdGraphQuery,
      Spinner,
      Button,
      BlockText,
    } from 'nr1';
    import { Map, CircleMarker, TileLayer } from 'react-leaflet';

    const accountId = 0; // Replace with your account ID

    export default class PageViewApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          countryCode: null,
        };
      }

      getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
      }

      mapData() {
        const { countryCode } = this.state;
        const query = `{
          actor {
            account(id: 1606862) {
              mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${
                countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
              } LIMIT 1000 ") {
                results
                nrql
              }
            }
          }
        }`;

        return query;
      }

      render() {
        const { countryCode } = this.state;
        const defaultMapCenter = [10.5731, -7.5898];

        return (
          <div className="container">
            <div className="row">
              <div className="row">
                <TextField
                  placeholder="US"
                  onChange={(event) => {
                    this.setState({ countryCode: event.target.value });
                  }}
                />
              </div>
              <div className="row">
                <NerdGraphQuery query={this.mapData()}>
                  {({ loading, error, data }) => {
                    if (loading) {
                      return <Spinner fillContainer />;
                    }
                    if (error) {
                      return 'Error';
                    }
                    const { results } = data.actor.account.mapData;
                    console.debug(results);

                    return (
                      <Map
                        className="containerMap"
                        center={defaultMapCenter}
                        zoom={2}
                        zoomControl
                      >
                        <TileLayer
                          attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                        />
                        {results.map((pt, i) => {
                          const center = [pt.lat, pt.lng];
                          return (
                            <CircleMarker
                              key={`circle-${i}`}
                              center={center}
                              color={this.getMarkerColor(pt.y)}
                              radius={Math.log(pt.x) * 3}
                              onClick={() => {
                                alert(JSON.stringify(pt));
                              }}
                            />
                          );
                        })}
                      </Map>
                    );
                  }}
                </NerdGraphQuery>
              </div>
              <TableChart
                accountId={accountId}
                query={`FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' ${
                  countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''
                } FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000`}
                fullWidth
                className="chart"
              />
            </div>
          </div>
        );
      }
    }
    ```
  </Step>
</Steps>

Este c√≥digo cria um mapa-m√∫ndi centrado na latitude e longitude que voc√™ escolheu usando os dados `OpenStreetMap` e as cores do seu marcador.

Atualize seu aplicativo para ver os dados de visualiza√ß√£o de p√°gina no mapa!
