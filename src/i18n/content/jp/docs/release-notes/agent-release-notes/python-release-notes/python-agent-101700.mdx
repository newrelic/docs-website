---
subject: Python agent
releaseDate: '2025-09-04'
version: 10.17.0
downloadLink: 'https://pypi.python.org/pypi/newrelic'
features:
  - Adds support for custom tasks in Celery
  - Adds support for graphene-django
  - Adds support for middleware filtering in Django
  - Adds support for AWS Bedrock Converse API
  - Adds support for W3CTraceParent header sampled flag
bugs:
  - Safeguard for deepest unique path in GraphQL
  - Safeguard for web request parsing
  - Fix crash in GraphQL
  - Fix crash in ElasticSearch
translationType: machine
---

## メモ

このリリースの Python エージェントでは、以下のサポートが追加されました。

* [Celery](https://pypi.org/project/celery/)のカスタムタスク
* [Graphene-Django](https://pypi.org/project/graphene-django/)監視
* [Django](https://pypi.org/project/django/)のミドルウェアフィルタリング
* AWS Bedrock [コンバース](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/bedrock-runtime/client/converse.html)API
* W3CTraceParent ヘッダーのサンプリングフラグ

このリリースでは、次の修正も提供されています。

* GraphQL における最も深いユニークパスの保護
* ウェブ URL リクエスト解析の安全策
* ElasticSearchとGraphQLのフォールバック `trace.settings==None`
* 非同期 ElasticSearch クライアント リストから`options`メソッドを削除します

[Python パッケージ インデックス](https://pypi.python.org/pypi/newrelic)経由で`easy_install/pip/distribute`を使用してエージェントをインストールするか、 [New Relic ダウンロード サイト](https://download.newrelic.com/python_agent/release)から直接ダウンロードします。

## 新機能

* Celeryのカスタムタスクのサポートを追加

  * [Celery](https://pypi.org/project/celery/)のカスタム タスク クラスの監視サポートを追加します。以前は、デフォルトのタスク クラスを使用するタスクのみをモニターできました。 注意: このバージョンの Python エージェントは、 Celery バージョン[v5.2.0](https://github.com/celery/celery/releases/tag/v5.2.0)未満をサポートしなくなります。

* Graphene-Djangoのサポートを追加

  * [Graphene-Django](https://pypi.org/project/graphene-django/)で作成された同期スキーマの監視サポートを追加します。以前は、Graphene-Django で作成されたスキーマは部分的にしかモニターされず、 [GraphQL](https://pypi.org/project/graphql-core/)関連の属性が欠落していました。

* Django のミドルウェアフィルタリングのサポートを追加

  * ユーザーは、どの[Django](https://pypi.org/project/django/)ミドルウェアを監視するかをフィルタリングできるようになりました。 [追加設定が 3 つ](/docs/apm/agents/python-agent/configuration/python-agent-configuration/#middleware-filters)あります。

    * `instrumentation.middleware.django.enabled` (デフォルトは`true`です)
    * `instrumentation.middleware.django.exclude`
    * `instrumentation.middleware.django.include`

  詳細と例については、 [Django ミドルウェア フィルタリング ページ](/docs/apm/agents/python-agent/supported-features/django-middleware-filtering/)を参照してください。

* AWS Bedrock Converse APIのサポートを追加

  * 非ストリーミング[Converse](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/bedrock-runtime/client/converse.html) API の監視サポートを追加します。これには`boto3`および`aioboto3`クライアントを使用して行われた`converse`チャット完了呼び出しのサポートが含まれます。

* W3CTraceParent ヘッダーのサンプリングフラグのサポートを追加

  * アップストリーム サービスがサンプリング フラグを設定した W3CTraceParent ヘッダーを送信すると、New Relic は現在のトランザクションをサンプリングするかどうかを決定する際にそのサンプリング決定を考慮します。

* リモート親がサンプリングされるかどうかに基づくサンプリング決定のサポートを追加しました

  * 2 つの新しい設定オプションのサポートが追加されました。

    * `distributed_tracing.sampler.remote_parent_sampled`
    * `distributed_tracing.sampler.remote_parent_not_sampled`

  * `default` これはデフォルトの動作であり、この変更前と同じように動作します (サンプリングの決定を適応サンプリング アルゴリズムに渡して、トランザクションをサンプリングするかどうかを決定します)。

  * `always_on` リモート親がサンプリングされたトレースとリモート親がサンプリングされていないトレースが常にサンプリングされることを意味します。

  * `always_off` リモート親がサンプリングされたトレース、またはリモート親がサンプリングされていないトレースはサンプリングされないことを意味します。

## バグ修正

* GraphQL の最も深いユニークパスに安全策を追加する

  * 一部のユーザーは、フィールド名が`None`を返すため、 [GraphQL](https://pypi.org/project/graphql-core/)の最も深い一意のパスが生成されないという問題を経験していました。この問題は修正されました。

* Webリクエスト解析の安全策を追加する

  * `request_uri`が不正な形式であったり無効な文字が含まれていたりした場合に、一部のユーザーに解析エラーが発生しました。この時点で、リクエスト ヘッダーの`request_uri`が無効であり、最初に指定された (有効な) URL と一致しない場合にこれが発生する可能性があります。この安全対策は現在 New Relic に導入されていますが、 `urllib` 2025 年 1 月 31 日以降にリリースされた Python のバージョンに対してこの問題を解決しました。

* ElasticSearchとGraphQLのクラッシュを修正 `trace.settings==None`

  * `trace.settings`が`None`の場合、ElasticSearch の計装によりアプリケーションがクラッシュしました。 `global_settings`フォールバックが設定されました。これにより、GraphQL で見つかった同じ問題も解決されます。

* 非同期 ElasticSearch クライアント リストから`options`メソッドを削除します

  * ElasticSearch の以前の計画では、 `options`非同期メソッドのリストにあったためクラッシュが発生しました。 このメソッドは、データストアの操作やrequestsを実行するものではないため、 `DatastoreTrace`にラップされなくなりました。

## サポートステートメント

最新のエージェント バージョンが利用可能になったらすぐに更新することをお勧めします。最新バージョンにアップグレードできない場合は、エージェントを 90 日以内のバージョンに更新してください。エージェントを最新の状態に保つ方法の[詳細](/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/)については、こちらをご覧ください。

エージェントのリリースとサポート日については、New Relic Python エージェントの[EOL ポリシーを](/docs/apm/agents/python-agent/getting-started/python-agent-eol-policy/)参照してください。