---
subject: Node.js agent
releaseDate: '2025-12-08'
version: 13.7.0
downloadLink: 'https://www.npmjs.com/package/newrelic'
security: []
bugs:
  - Fixed normalization of OTEL hrtime
features:
  - Updated `koa` instrumentation to properly wrap `Router` when using `@koa/router@15.0.0`+
  - Added ability to configure a ratio based sampler
  - 'Updated configuration to allow `adaptive.sampling_target` to be set for `config.distributed_tracing.sampler.root`, `config.distributed_tracing.sampler.remote_parent_sampled`, and `config.distributed_tracing.sampler.remote_parent_not_sampled`'
  - Added support for OTEL span links
  - Replaced `default` with `adaptive` as the default for samplers
  - Preliminary support for partial granularity traces (Not available for production use)
translationType: machine
---

## メモ

#### 特徴

* `@koa/router@15.0.0` + ([#3550](https://github.com/newrelic/node-newrelic/pull/3550)) ([f1e08ad](https://github.com/newrelic/node-newrelic/commit/f1e08ad9fe200138ab9ed32e423517f64e41af49)) を使用するときに`Router`適切にラップするように`koa`計装を更新しました。

* 比率ベースのサンプラーを構成する機能を追加しました ([#3501](https://github.com/newrelic/node-newrelic/pull/3501)) ([f300bd5](https://github.com/newrelic/node-newrelic/commit/f300bd5eacf9d6509b56484e7ad36d5c0725b497))

  * 比率ベースのサンプラーを割り当てるには、 `config.distributed_tracing.sampler.root` 、 `config.distributed_tracing.sampler.remote_parent_sampled` 、または`config.distributed_tracing.sampler.remote_parent_not_sampled`を `{ trace_id_ratio_based: { ratio: <float between 0 and 1> }}`
  * 環境変数で割り当てるには、 `NEW_RELIC_DISTRIBUTED_TRACING_SAMPLER_<TYPE>='trace_id_ratio_based'`と`NEW_RELIC_DISTRIBUTED_TRACING_SAMPLER_<TYPE>_RATIO=<float between 0 and 1>`を設定します。 `<TYPE>`は`ROOT` 、 `REMOTE_PARENT_SAMPLED` 、または `REMOTE_PARENT_NOT_SAMPLED`

* `config.distributed_tracing.sampler.root` 、 `config.distributed_tracing.sampler.remote_parent_sampled` 、 `config.distributed_tracing.sampler.remote_parent_not_sampled`に`adaptive.sampling_target`を設定できるように構成を更新しました（ [#3532](https://github.com/newrelic/node-newrelic/pull/3532) ）（[44f51dd](https://github.com/newrelic/node-newrelic/commit/44f51dd5583e74aef1e2d0ee9483d51d5ff786c3) ）

* OTEL スパンリンクのサポートを追加しました ([#3528](https://github.com/newrelic/node-newrelic/pull/3528)) ([e840690](https://github.com/newrelic/node-newrelic/commit/e8406903dd0c92cd003fac69770785489e1bba85))

* サンプラーのデフォルトとして`default` `adaptive`に置き換えました ([#3543](https://github.com/newrelic/node-newrelic/pull/3543)) ([3f03162](https://github.com/newrelic/node-newrelic/commit/3f0316285fdde6d3c38ce819aa41221a71bd4fcb))

* 部分粒度トレースの予備サポート（本番環境では使用できません）

  * 部分粒度トレースに`essential`タイプを追加しました ([#3547](https://github.com/newrelic/node-newrelic/pull/3547)) ([3d85fb5](https://github.com/newrelic/node-newrelic/commit/3d85fb5fa16d411892eb4a23067e66669461ada0))
  * 部分粒度トレースに`reduced`タイプを追加しました。（ [#3540](https://github.com/newrelic/node-newrelic/pull/3540) ） （[cfa8f41](https://github.com/newrelic/node-newrelic/commit/cfa8f41618595cc5ffb3e3b5574673721c64580c) ）
  * 部分粒度サンプラーを追加し、部分粒度サンプリングの決定が行われた場合にトランザクションを`isPartialTrace`に割り当てます ([#3544](https://github.com/newrelic/node-newrelic/pull/3544)) ([1535a82](https://github.com/newrelic/node-newrelic/commit/1535a82331ce40d7c96e0c6746ec70bcdbd6e4f6))
  * サンプラーをクラスにリファクタリングし、 `agent.sampler.*`に保存しました ([#3527](https://github.com/newrelic/node-newrelic/pull/3527)) ([ad63441](https://github.com/newrelic/node-newrelic/commit/ad634411a0d91240c0c16c7a372b00b36651589f))
  * ロガーメッセージを正規化し、該当する場合はショートサーキットを行い、オプションのチェーンチェックを削除するために`Samplers`クラスを更新しました ([#3546](https://github.com/newrelic/node-newrelic/pull/3546)) ([4f7684c](https://github.com/newrelic/node-newrelic/commit/4f7684cb4c64a89545704c70c110d2fd13815197))
  * DT が無効になっている場合、または完全な粒度と部分的な粒度の両方が無効になっている場合に、0 ～ 1 の優先度を割り当てるようにサンプラーを更新しました ([#3559](https://github.com/newrelic/node-newrelic/pull/3559)) ([7a1c37e](https://github.com/newrelic/node-newrelic/commit/7a1c37e3e04fef0538a8af15fa690915bce65262))
  * 部分的な粒度インジケータを`.partialType`として保存するようにトランザクションを更新しました ([#3561](https://github.com/newrelic/node-newrelic/pull/3561)) ([a7f20d8](https://github.com/newrelic/node-newrelic/commit/a7f20d8e83b44556434bae90bd3924c54af9f587))
  * 部分的な粒度ルールが適用されたときに更新されます ([#3553](https://github.com/newrelic/node-newrelic/pull/3553)) ([a4bdf4f](https://github.com/newrelic/node-newrelic/commit/a4bdf4fbbbdac102519020c5ca4d3dc92eeff844))
  * デフォルトの Sampler クラスに`toString`と`get [Symbol.toStringTag]()`を追加しました ([#3562](https://github.com/newrelic/node-newrelic/pull/3562)) ([771168d](https://github.com/newrelic/node-newrelic/commit/771168dcd927240b6efc703f238046e9a7f7766b))

#### バグ修正

* OTEL hrtime の正規化を修正しました ([#3564](https://github.com/newrelic/node-newrelic/pull/3564)) ([707fe7d](https://github.com/newrelic/node-newrelic/commit/707fe7d6395f0e15b5e6c6195f93df1c27540423))

#### ドキュメント

* 互換性レポートを更新しました ([#3551](https://github.com/newrelic/node-newrelic/pull/3551)) ([02268a4](https://github.com/newrelic/node-newrelic/commit/02268a4e3fe7b2f2f5c2fd035bcb337fd7b2bfc2))
* 属性の内部ドキュメントを追加しました ([#3539](https://github.com/newrelic/node-newrelic/pull/3539)) ([68543b6](https://github.com/newrelic/node-newrelic/commit/68543b606fc53e59e9a6fcb08173e423bc6437a9))

#### 雑用

* `preconnect`ペイロード周辺のログ記録を改善しました

  * `preconnect`中にホスト名を割り当てる際のログ記録を追加しました ([#3568](https://github.com/newrelic/node-newrelic/pull/3568)) ([3ee4d38](https://github.com/newrelic/node-newrelic/commit/3ee4d383cd7d9e7bf16e9da5e7f130fc2a103ca4))
  * GCP 使用率ログの改善 ([#3552](https://github.com/newrelic/node-newrelic/pull/3552)) ([e6c4141](https://github.com/newrelic/node-newrelic/commit/e6c4141b55860b5f1fe5cd14049abb9eca9b3859))

* 使用率の解決が同時に行われるようになりました ([#3556](https://github.com/newrelic/node-newrelic/pull/3556)) ([8386360](https://github.com/newrelic/node-newrelic/commit/8386360fe7fb4b7278e001dac8c8293581654069))

* すべての OTEL スパンで OTEL 計装スコープのメタデータを収集しました。 ([#3554](https://github.com/newrelic/node-newrelic/pull/3554)) ([75703c4](https://github.com/newrelic/node-newrelic/commit/75703c41a8db1d204a1500b8b43dff0d04a5b286))

* OTEL hrtime 処理の改善 ([#3557](https://github.com/newrelic/node-newrelic/pull/3557)) ([8f187b1](https://github.com/newrelic/node-newrelic/commit/8f187b11eac96f78d9743cadb2302001ed94412a))

* 設定名`opentelemetry_bridge` `opentelemetry`に変更しました ([#3565](https://github.com/newrelic/node-newrelic/pull/3565)) ([c9d156f](https://github.com/newrelic/node-newrelic/commit/c9d156fe302ffb99b262ffd3e256d953301f08f2))

### サポートステートメント:

最新のエージェント バージョンが利用可能になったらすぐに更新することをお勧めします。最新バージョンにアップグレードできない場合は、エージェントを 90 日以内のバージョンに更新してください。エージェントを最新の状態に保つ方法の詳細については、こちらをご覧ください。( [https://docs.newrelic.com/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/](https://docs.newrelic.com/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/) )

エージェントのリリースとサポート日については、New Relic Node.js エージェントの EOL ポリシーを参照してください。( [https://docs.newrelic.com/docs/apm/agents/nodejs-agent/getting-started/nodejs-agent-eol-policy/](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/getting-started/nodejs-agent-eol-policy/) )