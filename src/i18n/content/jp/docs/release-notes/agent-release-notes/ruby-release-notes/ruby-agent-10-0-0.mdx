---
subject: Ruby agent
releaseDate: '2026-01-14'
version: 10.0.0
downloadLink: 'https://rubygems.org/downloads/newrelic_rpm-10.0.0.gem'
features:
  - Remove support for Ruby 2.4 and 2.5
  - Removal of Cross Application Tracing (CAT)
  - Rename ActiveJob metrics and segments
  - Rename `bin/newrelic` command to `bin/newrelic_rpm`
  - Remove the `newrelic deployments` CLI command
  - 'Remove the NewRelic::Agent::SqlSampler#notice_sql method'
  - 'Remove unused arguments from various NewRelic::Agent::Datastores APIs'
  - Remove experimental feature Configurable Security Policies (CSP)
  - Remove support for Puma versions below 3.9.0
  - Improve configuration validation and coercion
  - Replace 'default' option with 'adaptive' for distributed tracing remote parent samplers
  - Add `logger` as a dependency
  - Add Active Support notification allowlist configuration option
  - Use Ruby's built-in Gzip compression
  - 'Add argument validation for the `NewRelic::Agent#record_custom_event` API'
  - Add root sampling configuration options
  - Add Trace ID Ratio Based sampling options
  - Add Entity GUID to Agent Control health check files
bugs:
  - Resolve a `NoMethodError` in GCP utilization detection.
security: []
translationType: machine
---

<Callout variant="important">
  **メジャー バージョン アップデート:**このバージョンの Ruby エージェントは SemVer メジャー アップデートであり、重大な変更が含まれています。メジャー バージョンでは、メンテナーの規定によりサポート終了となった言語ランタイムのサポートが廃止されることがあります。さらに、メジャー バージョンでは、特定の計装のサポートが終了し、削除される場合があります。 これらの変更の詳細については、[ここにある](/docs/apm/agents/ruby-agent/getting-started/migration-10x-guide/)移行ガイドを参照してください。
</Callout>

<Callout variant="important">
  最新のエージェント バージョンが利用可能になったらすぐに更新することをお勧めします。最新バージョンにアップグレードできない場合は、エージェントを 90 日以内のバージョンに更新してください。[エージェントを最新の状態に保つ方法](/docs/new-relic-solutions/new-relic-one/install-configure/update-new-relic-agent/)の詳細については、こちらをご覧ください。

  エージェントのリリースとサポート日については、New Relic Ruby エージェントの[EOL ポリシーを](/docs/apm/agents/ruby-agent/getting-started/ruby-agent-eol-policy/)参照してください。
</Callout>

## v10.0.0

* **重大な変更: Ruby 2.4 および 2.5 のサポートを削除**

  Ruby バージョン 2.4 および 2.5 のサポートは削除されました。新しい最低限必要な Ruby バージョンは 2.6 になりました。[PR#3314](https://github.com/newrelic/newrelic-ruby-agent/pull/3314)

* **重大な変更: クロスアプリケーショントレース (CAT) の削除**

  以前は、クロスアプリケーション トレーシング (CAT) が非推奨となり、ディストリビューティッド（分散）トレーシングが使用されました。 CAT 機能は削除されました。設定オプション`cross_application_tracer.enabled`は削除されました。 パブリック API メソッド`NewRelic::Agent::External.process_request_metadata` 、 `NewRelic::Agent::External.get_response_metadata` 、 `NewRelic::Agent::Transaction::ExternalRequestSegment#process_response_metadata` 、 `NewRelic::Agent::Transaction::ExternalRequestSegment#get_request_metadata` 、および`NewRelic::Agent::Transaction::ExternalRequestSegment#read_response_headers`も削除されました。[PR#3333](https://github.com/newrelic/newrelic-ruby-agent/pull/3333)

* **重大な変更: ActiveJob メトリクスとセグメントの名前を変更する**

  ActiveJob メトリクスが更新され、より具体的なレポートを作成するためにジョブのクラス名が含まれるようになりました。 これは重大な変更であり、カスタムダッシュボードまたはアラートの更新が必要になる場合があります。 [PR#3370](https://github.com/newrelic/newrelic-ruby-agent/pull/3370) [PR#3320](https://github.com/newrelic/newrelic-ruby-agent/pull/3320)

  * 古い形式: `Ruby/ActiveJob/<QueueName>/<Method>`
  * 新しいフォーマット: `Ruby/ActiveJob/<QueueName>/<ClassName>/<Method>`

  さらに、アクティブ ジョブのキュー登録アクション用に作成されたセグメントにジョブ クラスが含まれるようになりました。

  * 古い形式: `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>`
  * 新しいフォーマット: `ActiveJob/<QueueAdapter>/Queue/<Event>/Named/<QueueName>/<ClassName>`

* **変更点: `bin/newrelic`コマンドの名前を次のように変更します `bin/newrelic_rpm`**

  エージェントの CLI の実行可能ファイルの名前が`bin/newrelic`から`bin/newrelic_rpm`に変更されました。この変更により、スタンドアロンの New Relic CLI ツールとの名前の競合が解決されます。[PR#3323](https://github.com/newrelic/newrelic-ruby-agent/pull/3323)

* **変更点: `newrelic deployments` CLI コマンドを削除します**

  非推奨の`newrelic deployments` CLI コマンドは削除されました。New Relicの変更とデプロイメントを追跡するには、利用可能なオプションのリストについては[、変更追跡 (変更追跡機能)](https://docs.newrelic.com/docs/change-tracking/change-tracking-introduction/)のガイドを参照してください。 [PR#3299](https://github.com/newrelic/newrelic-ruby-agent/pull/3299)

* **重大な変更: NewRelic::エージェント::SqlSampler#notice\_sql メソッドを削除**

  代わりに、ユーザーは`NewRelic::Agent::Datastores.notice_sql`を呼び出す必要があります。[PR#3338](https://github.com/newrelic/newrelic-ruby-agent/pull/3338)

* **重大な変更: さまざまな NewRelic::エージェント::Datastores API から未使用の引数を削除**

  `NewRelic::Agent::Datastores`クラスの次の API からメソッド引数が削除されました:

  * `NewRelic::Agent::Datastores.notice_sql`には、以前は 3 つの位置引数`query` 、 `scoped_metric` 、 `elapsed`がありました。現在は`query`のみになっています。
  * `NewRelic::Agent::Datastores.notice_statement`、以前は 2 つの位置引数`query`と`elapsed`がありました。現在は`query`のみになっています。
  * `NewRelic::Agent::Datastores.wrap` プロセスが必要です。以前は、プロシージャは、yield の結果、最も具体的なスコープのメトリック名、および呼び出しの経過時間という 3 つの引数を受け取りました。 今では、yield の結果のみを受け取ります。

  削除された引数の値は、呼び出し時の現在のセグメントから導出されます。[PR#3347](https://github.com/newrelic/newrelic-ruby-agent/pull/3347)

* **重大な変更: 実験的機能の設定可能なセキュリティ ポリシー (CSP) を削除します。**

  実験的機能である設定可能なセキュリティ ポリシー (CSP) はサポートされなくなり、削除されました。 [PR#3292](https://github.com/newrelic/newrelic-ruby-agent/pull/3292)

* **重大な変更: Puma バージョン &apos;&lt;&apos; 3.9.0 のサポートを削除します**

  現在サポートされている Puma の最小バージョンは 3.9.0 以上です。[PR#3326](https://github.com/newrelic/newrelic-ruby-agent/pull/3326)

* **重大な変更: 設定の検証と強制実行の改善**

  係数設定に提供された値を強制および検証するために使用される内部機能は、よりパフォーマンスが向上し、より正確になりました。

  * nil がサポートされていない設定の設定値として指定された場合、警告メッセージが newrelic\_agent.log ファイルに記録されるようになりました。
  * フロート設定タイプには整数値が許可されます
  * フロート値は整数設定型で許可されます
  * 無効な入力値を置き換えるデフォルト値が見つかると、致命的な中断が防止されます[PR#3341](https://github.com/newrelic/newrelic-ruby-agent/pull/3341)

* **重大な変更: ディストリビューティッド（分散）トレーシング リモート親サンプラーの「default」オプションを「adaptive」に置き換えます。**

  以前は、 `distributed_tracing.sampler.remote_parent_sampled`と`distributed_tracing.sampler.remote_parent_not_sampled`デフォルト オプションは`default`であり、既存のアダプティブ サンプラーが使用されていました。`default`オプションの名前が`adaptive`に変更されました。[PR#3363](https://github.com/newrelic/newrelic-ruby-agent/pull/3363)

* **機能: `logger`依存関係として追加**

  継続的なログ機能と Ruby 4.0.0 以降のバージョンのサポートを確保するために、 `logger` gem がエージェントの依存関係としてリストされるようになりました。[PR#3293](https://github.com/newrelic/newrelic-ruby-agent/pull/3293)

* **機能: Active Support 通知許可リストの設定オプションを追加**

  新しい設定オプション`instrumentation.active_support_notifications.active_support_events`使用すると、ユーザーはエージェントが購読するアクティブ サポート通知イベント名の許可リストを定義できます。 デフォルトでは、エージェントはすべての[Active Support: Caching](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-caching)および[Active Support: Messages](https://guides.rubyonrails.org/active_support_instrumentation.html#active-support-messages)イベントをサブスクライブします。[PR#3327](https://github.com/newrelic/newrelic-ruby-agent/pull/3327)

* **機能: Ruby の組み込み Gzip 圧縮を使用する**

  エージェントは、以前のカスタム実装に代わって、Ruby 標準ライブラリの組み込み`Zlib.gzip`メソッドを圧縮に使用するようになりました。[PR#3332](https://github.com/newrelic/newrelic-ruby-agent/pull/3332)

* **機能: `NewRelic::Agent#record_custom_event` API の引数検証を追加**

  無効な`event_type`が指定された場合、 `NewRelic::Agent#record_custom_event` API は`ArgumentError`を発生させるようになりました。有効なイベント タイプは、英数字、アンダースコア (`_`)、コロン (`:`)、またはスペース (` `) のみで構成されている必要があります。[PR#3319](https://github.com/newrelic/newrelic-ruby-agent/pull/3319)

* **機能: ルートサンプリング設定オプションを追加**

  `distributed_tracing.sampler.root`を使用して、現在のサービス内で生成されたトレースのサンプリング動作を構成できるようになりました。[PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330)

  利用できるモードは 4 つあります。

  | モード                    | 説明                                                                                                                     |
  | ---------------------- | ---------------------------------------------------------------------------------------------------------------------- |
  | `adaptive`             | 既存の適応サンプラーアルゴリズムを使用する                                                                                                  |
  | `always_off`           | ルートトレースの0%をサンプリング済みとしてマークします                                                                                           |
  | `always_on`            | ルートトレースの100%をサンプリング済みとしてマークします                                                                                         |
  | `trace_id_ratio_based` | `distributed_tracing.sampler.root.trace_id_ratio_based.ratio`に設定された比率に基づいてトレースをサンプリングします。比率は 0.0 ～ 1.0 のフロートでなければなりません |

* **機能: トレース ID 比率ベースのサンプリング オプションを追加**

  エージェントは、 OpenTelemetry ID Ratio Based サンプラー アルゴリズムを使用してトレースをサンプリングできるようになりました。 [PR#3330](https://github.com/newrelic/newrelic-ruby-agent/pull/3330)トレース ID に基づいて 0.0 ～ 1.0 の確率でトレースをサンプリングします。

  このオプションを使用するには、まずディストリビューティッド（分散）トレーシング サンプラー設定を`trace_id_ratio_based`に設定し、次に対応する`distributed_tracing.sampler.*.trace_id_ratio_based.ratio`サンプラーを 0.0 ～ 1.0 のフロートに設定する必要があります。

  例えば：

  ```yaml
    distributed_tracing.sampler.remote_parent_sampled: 'trace_id_ratio_based'
    distributed_tracing.sampler.remote_parent_sampled.trace_id_ratio_based.ratio': 0.5
  ```

  この設定では、リモートの親がサンプリングされるすべてのトレースについて、トレースの約 50% がサンプリングされます。

  このオプションは以下で利用可能です:

  * `distributed_tracing.sampler.root`
  * `distributed_tracing.sampler.remote_parent_sampled`
  * `distributed_tracing.sampler.remote_parent_not_sampled`

* **機能: エンティティ GUID をAgent Controlヘルス チェック ファイルに追加します**

  [Agent Control](https://docs-preview.newrelic.com/docs/new-relic-agent-control)環境内でエージェントが開始されると、各プロセスの構成されたファイルの場所にヘルス チェック ファイルが作成されます。 このファイルには、利用可能な場合、エージェントに関連するエンティティの GUID が含まれるようになりました。[PR#3371](https://github.com/newrelic/newrelic-ruby-agent/pull/3371)

* **バグ修正: GCP 使用率検出における`NoMethodError`を解決しました。**

  GCP メタデータ検出ロジックは、 `nil`または予期しない値を適切に処理し、サービス初期化のクラッシュを防ぐようになりました。[PR#3388](https://github.com/newrelic/newrelic-ruby-agent/pull/#3388)