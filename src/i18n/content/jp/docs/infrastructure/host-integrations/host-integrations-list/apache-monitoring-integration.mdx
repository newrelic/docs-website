---
title: Apacheモニタリングインテグレーション
tags:
  - Integrations
  - On-host integrations
  - On-host integrations list
metaDescription: The New Relic Apache integration ​sends performance metrics and inventory data from your Apache web server to the New Relic platform.
translationType: human
---

当社のApache[インテグレーション](/docs/integrations/host-integrations/getting-started/introduction-host-integrations)は、ApacheウェブサーバーからNew Relicプラットフォームに、パフォーマンス[メトリクス](#metrics)と[インベントリデータ](#inventory)を送信します。ご利用のApacheメトリックデータに関するプレビルドダッシュボードを閲覧し、アラートポリシーを作成して、独自のカスタムクエリおよびチャートを作成することができます。

このインテグレーションでは、Apacheの[ステータスモード](https://httpd.apache.org/docs/2.4/mod/mod_status.html)からデータを収集する仕組みとなっているため、モジュールを有効にしてApacheインスタンスに合わせて設定する必要があります（詳細は[要件](#comp-req)を参照）。

インテグレーションのインストールと、当社がどのようなデータを収集するかについてお読みください。

## 互換性および要件 [#comp-req]

当社のインテグレーションは、Apacheバージョン2.2または2.4と互換性があります。

インテグレーションをインストールする前に、以下の要件を満たしていることを確認してください。

* New Relicアカウント。アカウントをお持ちでない場合[無料サインアップ](https://newrelic.com/signup)クレジットカードは不要です。

* [Apacheステータスモジュール](https://httpd.apache.org/docs/2.4/mod/mod_status.html)が、Apacheインスタンスに対して有効化かつ設定済みです。

* Apacheインテグレーションを含むホストから使用できるApacheのステータスモジュールエンドポイント（デフォルトの`server-status`）。

* ApacheがKubernetesまたはAmazon ECSで実行されて**いない**場合、[Infrastructureエージェントが、Apacheを実行しているLinux OSホストにインストールされている](/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic)必要があります。その他の場合：

  * Kubernetesで実行されている場合は、[これらの要件](/docs/monitor-service-running-kubernetes#requirements)をご覧ください。
  * ECSで実行されている場合は、[これらの要件](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)をご覧ください。

## クイックスタート [#quick]

Apacheウェブサーバーを迅速に計装し、ガイド付きインストールでテレメトリデータを送信します。ガイド付きインストールは、New Relic CLIおよびインフラストラクチャエージェントをダウンロードおよびインストールする環境用にカスタマイズされたCLIコマンドを作成します。

![ガイド付きインストールCLIのスクリーンショット。](./images/guided-install-cli.png "ガイド付きインストールCLI。")

始める準備はできていますか？ボタンの1つをクリックし、試行してください。

<ButtonGroup>
  <ButtonLink
    role="button"
    to="https://one.newrelic.com/launcher/nr1-core.explorer?pane=eyJuZXJkbGV0SWQiOiJucjEtY29yZS5saXN0aW5nIn0=&cards[0]=eyJuZXJkbGV0SWQiOiJucjEtaW5zdGFsbC1uZXdyZWxpYy5ucjEtaW5zdGFsbC1uZXdyZWxpYyIsInBhdGgiOiJvaGkiLCJyZWNpcGVOYW1lIjoiYXBhY2hlLW9wZW4tc291cmNlLWludGVncmF0aW9uIiwiYWN0aXZlQ29tcG9uZW50IjoiVlRTT0NvbW1hbmQiLCJhY3RpdmVFbnZpcm9ubWVudCI6ImFwYWNoZS1vcGVuLXNvdXJjZS1pbnRlZ3JhdGlvbiJ9"
    variant="primary"
  >
    ガイド付きインストール
  </ButtonLink>

  <ButtonLink
    role="button"
    to="https://one.eu.newrelic.com/launcher/nr1-core.explorer?pane=eyJuZXJkbGV0SWQiOiJucjEtY29yZS5saXN0aW5nIn0=&cards[0]=eyJuZXJkbGV0SWQiOiJucjEtaW5zdGFsbC1uZXdyZWxpYy5ucjEtaW5zdGFsbC1uZXdyZWxpYyIsInBhdGgiOiJvaGkiLCJyZWNpcGVOYW1lIjoiYXBhY2hlLW9wZW4tc291cmNlLWludGVncmF0aW9uIiwiYWN0aXZlQ29tcG9uZW50IjoiVlRTT0NvbW1hbmQiLCJhY3RpdmVFbnZpcm9ubWVudCI6ImFwYWNoZS1vcGVuLXNvdXJjZS1pbnRlZ3JhdGlvbiJ9"
    variant="primary"
  >
    EUガイド付きインストール
  </ButtonLink>
</ButtonGroup>

当社のガイド付きインストールは、インフラストラクチャエージェントを使用してApacheインテグレーションを設定します。それだけではなく、環境内で実行中のその他のアプリケーションとログソースを発見し、どれを計装するべきかを推奨します。

ガイド付きインストールは、ほとんどの設定と連動します。ただし、ニーズに合わない場合は、その他の方法を検索し、Apacheウェブサーバーのモニターを開始できます。

## インストールと有効化 [#install]

Apacheインテグレーションをインストールするには、お使いの環境の指示に従います。

<CollapserGroup>
  <Collapser
    id="ecs-install"
    title="ECS"
  >
    [ECSで実行しているサービスを監視する](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)をご覧ください。
  </Collapser>

  ' '

  <Collapser
    id="k8s-install"
    title="Kubernetes"
  >
    [Kubernetesで実行しているサービスを監視する](/docs/monitor-service-running-kubernetes)をご覧ください。
  </Collapser>

  <Collapser
    id="linux-install"
    title="Linux"
  >
    1. ファイル名[nri-apache](/docs/install-integrations-package)を使用して、`インテグレーションのインストール`手順に従ってください。

    2. ディレクトリをインテグレーションのフォルダに変更する場合は、以下の手順に従います。

       ```
       cd /etc/newrelic-infra/integrations.d
       ```

    3. サンプルの設定ファイルのコピー：

       ```
       sudo cp apache-config.yml.sample apache-config.yml
       ```

    4. `環境設定`で説明したとおり、[apache-config.yml](#config)ファイルを編集します。

    5. [Infrastructureエージェントを再起動します](/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status)。
  </Collapser>
</CollapserGroup>

追加の注：

* **アドバンスト：**インテグレーションは[tarball書式](/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball)で使用すると、パッケージマネージャ以外にもインストールできます。
* **オンホストインテグレーションは、自動的にアップデートしません。**最善の結果を得るため、[インテグレーションパッケージの更新](/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package)と[Infrastructureエージェントの更新](/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent)を定期的に実施してください。

## 設定 [#configuration]

### Apacheサーバーの有効化 [#enable-instance]

Apacheインテグレーションからデータを取得するには、まずステータスモジュールを有効化し、設定する必要があります。

* [Apacheステータスモジュール](https://httpd.apache.org/docs/2.4/mod/mod_status.html)が、Apacheインスタンスに対して有効化かつ設定済みであることを確認します。
* Apacheインテグレーションを含むホストから使用できるApacheのステータスモジュールエンドポイント（デフォルトの`server-status`）であることを確認します。

### インテグレーションの設定 [#config]

インストールの方法により、インテグレーションの設定方法はいくつかあります。

* Kubernetesで有効化した場合：[Kubernetes上で実行中のサービスの監視](/docs/monitor-service-running-kubernetes)を参照してください。
* Amazon ECSで有効化した場合：[ECS上で実行中のサービスの監視](/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs)を参照してください。
* オンホストにインストールする場合: インテグレーションのYAML設定ファイル`nginx-config.yml`で設定を編集します。

インテグレーションのYAML形式設定では、必要なログインクレデンシャルやデータの収集方法を設定できます。どのオプションを変更するかは、設定とプリファレンスにより異なります。

設定ファイルには、`間隔`、`タイムアウト`、`inventory_source`など、すべてのインテグレーションに適用される共通設定があります。これらの共通設定の詳細については、[設定形式](/docs/create-integrations/infrastructure-integrations-sdk/specifications/host-integrations-newer-configuration-format/#configuration-basics)ドキュメントを参照してください。

<Callout variant="important">
  レガシー設定/定義ファイルを引き続き使用する場合は、この[ドキュメント](/docs/create-integrations/infrastructure-integrations-sdk/specifications/host-integrations-standard-configuration-format/)を参照してください。
</Callout>

設定ファイルの`env`セクションを使用して、Apacheに関連する特定の設定を定義します。これらの設定は、Apacheインスタンスへの接続、およびその他のセキュリティ設定と機能を制御します。有効な設定のリストについては、このドキュメントの次のセクションで説明します。

### Apacheインスタンスの設定 [#instance-settings]

Apacheインテグレーションはメトリクス（**M**）とインベントリ（**I**）の両方の情報を収集します。このテーブルでは、各収集に使用可能な設定に**Applies To**列を使用します。

' ' ' ' ' ' ' ' ' ' ' '

<table>
  <thead>
    <tr>
      <th style={{ width: '150px' }}>
        設定
      </th>

      <th>
        説明
      </th>

      <th>
        デフォルト
      </th>

      <th>
        適用先
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        **STATUS_URL**
      </td>

      <td>
        ステータスモジュールを使ってメトリクスを付与するために設定されたURL。
      </td>

      <td>
        [http://127.0.0.1/server-status?auto](http://127.0.0.1/server-status?auto)
      </td>

      <td style={{ "text-align": "center" }}>
        M/I
      </td>
    </tr>

    <tr>
      <td>
        **CA_BUNDLE_FILE**
      </td>

      <td>
        代替証明書機関のバンドルファイル。
      </td>

      <td>
        該当なし
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        **CA_BUNDLE_DIR**
      </td>

      <td>
        代替証明書機関のバンドルディレクトリ。
      </td>

      <td>
        該当なし
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        **VALIDATE_CERTS**
      </td>

      <td>
        ステータスURLが自己署名証明書を持つHTTPSの場合、`false`に設定されます。
      </td>

      <td>
        true
      </td>

      <td style={{ 'text-align': 'center' }}>
        M
      </td>
    </tr>

    <tr>
      <td>
        **[REMOTE_MONITORING](https://docs.newrelic.com/docs/remote-monitoring-host-integrations)**
      </td>

      <td>
        マルチテナンシー監視を有効にします。
      </td>

      <td>
        true
      </td>

      <td style={{ 'text-align': 'center' }}>
        M/I
      </td>
    </tr>

    <tr>
      <td>
        **メトリクス**
      </td>

      <td>
        `true`に設定すると、メトリクスのみの収集が有効になります。
      </td>

      <td>
        false
      </td>

      <td style={{ 'text-align': 'center' }}/>
    </tr>

    <tr>
      <td>
        **インベントリ**
      </td>

      <td>
        `true`に設定すると、インベントリのみの収集が有効になります。
      </td>

      <td>
        false
      </td>

      <td style={{ 'text-align': 'center' }}/>
    </tr>
  </tbody>
</table>

これらの設定値は、いくつかの方法で定義できます。

* 設定ファイルに直接値を追加します。これは最も一般的な方法です。
* `{{}}`表記を使用して、環境変数の値を置き換えます。これにはインフラストラクチャエージェントv1.14.0以降が必要です。詳細については、[こちら](/docs/infrastructure/install-infrastructure-agent/configuration/configure-infrastructure-agent/#passthrough)をご覧いただくか、[以下](#example5)の例をご覧ください。
* シークレット管理の使用。これを使用して、設定ファイルのプレーンテキストで公開されないようにパスワードなどの重要な情報を保護してください。詳細については、[シークレット管理](/docs/integrations/host-integrations/installation/secrets-management)を参照してください。

### ラベル／カスタム属性 [#labels]

さらに、メトリクスにラベルを付けることもできます。ラベルを使用すると、キーや値のペア属性をメトリクスに追加して、メトリクスのクエリを挙げ、フィルターをかけ、グループ化を行うことができます。<br/>デフォルトのサンプル設定ファイルにはラベルの例が含まれていますが、必須ではないため、削除、変更、お好きな設定を新規追加することができます。

```
 labels:
   env: production
   role: load_balancer
```

## 設定の例 [#examples]

<CollapserGroup>
  <Collapser
    id="example1"
    title="基本設定"
  >
    これは、ローカルホストからメトリクスとインベントリを収集するための非常に基本的な設定です。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: http://127.0.0.1/server-status?auto
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer

      - name: nri-apache
        env:
          INVENTORY: "true"
          STATUS_URL: http://127.0.0.1/server-status?auto
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/apache
    ```
  </Collapser>

  <Collapser
    id="example2"
    title="HTTP基本認証"
  >
    この設定は、基本認証で保護されたローカルホストからメトリクスとインベントリを収集します。STATUS_URLの`ユーザー名`と`パスワード`を認証情報に置き換えます。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: http://username:password@127.0.0.1/server-status?auto
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer

      - name: nri-apache
        env:
          INVENTORY: "true"
          STATUS_URL: http://username:password@127.0.0.1/server-status?auto
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/apache
    ```
  </Collapser>

  <Collapser
    id="example3"
    title="自己署名証明書のみを使用したメトリクス"
  >
    この設定では、メトリクスのみを収集するための`METRICS: true`を含むインテグレーションブロックが1つだけあり、`VALIDATE_CERTS: false`を追加して、自己署名証明書の使用時にサーバーのSSL証明書の検証を防止します。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: https://my_apache_host/server-status?auto
          VALIDATE_CERTS: false
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>

  <Collapser
    id="example4"
    title="代替証明書のみを使用したメトリクス"
  >
    この設定では、メトリクスのみを収集するための`METRICS: true`を含むインテグレーションブロックが1つだけあり、`CA_BUNDLE_FILE`を追加し、代替証明書ファイルを指定します。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: https://my_apache_host/server-status?auto
          CA_BUNDLE_FILE='/etc/ssl/certs/custom-ca.crt'
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>

  <Collapser
    id="example5"
    title="環境変数の置換"
  >
    この設定では、環境変数`APACHE_STATUS`を使用して、インテグレーションのSTATUS_URL設定を入力します。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: {{APACHE_STATUS}}
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>

  <Collapser
    id="example6"
    title="マルチインスタンス監視"
  >
    この設定では、同じインテグレーションから複数のApacheサーバーを監視しています。最初のインスタンス（`STATUS_URL：https://1st_apache_host/server-status?auto`）ではメトリクスとインベントリを収集し、2番目のインスタンス（`STATUS_URL：https://2nd_apache_host/server-status?auto`）ではメトリクスのみを収集します。

    ```
    integrations:
      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: https://1st_apache_host/server-status?auto
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer
      - name: nri-apache
        env:
          INVENTORY: "true"
          STATUS_URL: https://1st_apache_host/server-status?auto
          REMOTE_MONITORING: true
        interval: 60s
        labels:
          env: production
          role: load_balancer
        inventory_source: config/apache

      - name: nri-apache
        env:
          METRICS: "true"
          STATUS_URL: http://2nd_apache_host/server-status?auto
          REMOTE_MONITORING: true
        interval: 15s
        labels:
          env: production
          role: load_balancer
    ```
  </Collapser>
</CollapserGroup>

## データの検索と使用 [#find-and-use]

このサービスからのデータは、[インテグレーションダッシュボード](/docs/integrations/new-relic-integrations/getting-started/infrastructure-integration-dashboards-charts)にレポートされます。

Apacheデータは`ApacheSample`の[イベントタイプ](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic)に関連付けられています。トラブルシューティング目的で、またはチャートとダッシュボードを作成するために、[このデータのクエリ](/docs/using-new-relic/data/understand-data/query-new-relic-data)を行えます。

データの検索・使用方法の詳細については、 [インテグレーションデータを理解する](/docs/infrastructure/integrations/find-use-infrastructure-integration-data)を参照してください。

## メトリックデータ [#metrics]

Apacheインテグレーションは、以下のメトリックデータ属性を収集します。各メトリック名には、以下のようにカテゴリの指標とピリオドで接頭辞が付けられます。`net.`または`server.`。

<table>
  <thead>
    <tr>
      <th style={{ width: "360px" }}>
        名前
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `net.bytesPerSecond`
      </td>

      <td>
        1秒あたりに処理されたバイト数。
      </td>
    </tr>

    <tr>
      <td>
        `net.requestsPerSecond`
      </td>

      <td>
        1秒あたりのクライアントリクエスト数。
      </td>
    </tr>

    <tr>
      <td>
        `server.busyWorkers`
      </td>

      <td>
        ビジー状態の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.idleWorkers`
      </td>

      <td>
        アイドル状態の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.closingWorkers`
      </td>

      <td>
        レスポンスを処理してからTCP接続を終了中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.dnsLookupWorkers`
      </td>

      <td>
        DNSルックアップを実施中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.finishingWorkers`
      </td>

      <td>
        円満に終了中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.idleCleanupWorkers`
      </td>

      <td>
        クリーンアップ作業の準備が整った、アイドル状態の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.keepAliveWorkers`
      </td>

      <td>
        持続的な接続を維持している現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.loggingWorkers`
      </td>

      <td>
        ロギング操作中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.readingWorkers`
      </td>

      <td>
        リクエスト（ヘッダまたはボディ）を読み込み中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.startingWorkers`
      </td>

      <td>
        起動中の現在のワーカー数。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.totalWorkers`
      </td>

      <td>
        手が空いている合計ワーカー数。リクエスト処理に必要のないワーカーは、開始できません。
      </td>
    </tr>

    <tr>
      <td>
        `server.scoreboard.writingWorkers`
      </td>

      <td>
        書き込み中の現在のワーカー数。
      </td>
    </tr>
  </tbody>
</table>

## インベントリデータ [#inventory]

インベントリデータは、実行中のApacheと読み込まれたすべてのApacheモジュールからバージョン番号を取得し、それらのバージョン番号を`config/apache`ネームスペースの下に追加します。インベントリデータの詳細については、[データを理解する](/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data)を参照してください。

## システムメタデータ [#metadata]

Infrastructureエージェントによって収集された標準属性の他にも、インテグレーションは`ApacheSample`[イベントタイプ](/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic)に関連付けられたインベントリデータも収集します。

<table>
  <thead>
    <tr>
      <th style={{ width: "180px" }}>
        名前
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `software.version`
      </td>

      <td>
        Apacheサーバーのバージョン。例：`Apache/2.4.7 (Ubuntu)`。
      </td>
    </tr>
  </tbody>
</table>

## トラブルシューティング

<CollapserGroup>
  <Collapser
    id="https-access"
    title="ApacheのHTTPSエンドポイントにアクセスする際の問題"
  >
    ApacheのHTTPSエンドポイントにアクセスする際に問題がある場合は、以下の2つの解決策があります。

    * SSL証明書を無視することはできませんが、`ca_bundle_file`と`ca_bundle_dir`の設定ファイルパラメーターを、Apache設定ファイルにある未署名証明書をポイントするように設定できます。例：

      ```
      instances:
      	- name: apache-server-metrics
      command: metrics
      arguments:
      	status_url: http://127.0.0.1/server-status?auto
      	ca_bundle_file: /etc/newrelic-infra/integrations.d/ssl/b2b.ca-bundle
      ```

      `ca_bundle_dir`を使用した例：

      ```
      ca_bundle_dir: /etc/newrelic-infra/integrations.d/ssl
      ```

    * HTTPSの代わりに、HTTPを使用することもできます。
  </Collapser>
</CollapserGroup>

## ソースコードのチェック [#source-code]

このインテグレーションはオープンソースソフトウェアです。つまり、[ソースコードを参照](https://github.com/newrelic/nri-apache/ "新しいウィンドウにリンクが開きます。")して改善を送信したり、独自のフォークを作成して構築したりできます。