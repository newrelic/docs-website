---
title: Snowflake の統合
tags:
  - Snowflake integration
  - New Relic integrations
metaDescription: Install our Snowflake dashboards and see your Snowflake data in New Relic.
translationType: machine
---

import infrastructureSnowflakeDashboard from 'images/infrastructure_screenshot-full_snowflake-dashboard.png'

Snowflake ダッシュボードを使用すると、クエリのパフォーマンスとログインを簡単に追跡し、Snowflake ウェアハウスを監視し、潜在的なセキュリティ インシデントなど、ストレージ システムの健全性の全体像を把握できます。インフラストラクチャ エージェントと Snowflake の統合で構築された Snowflake ダッシュボードを使用すると、最も重要なクエリ データをすべて 1 か所で表示できます。

<img
  src={infrastructureSnowflakeDashboard}
  title="Snowflake dashboard"
  alt="A screenshot of a dashboard with Snowflake query metrics."
/>

<figcaption>
  Snowflake と New Relic の統合を設定すると、すぐにデータがこのようなダッシュボードに表示されます。
</figcaption>

## インフラストラクチャエージェントをインストールします [#infra]

Snowflake データを New Relic に取り込む前に、まずインフラストラクチャ エージェントをインストールします。これにより、New Relic は Snowflake からデータを収集できるため、パフォーマンス メトリック、ログイン、およびその他のデータがダッシュボードに表示されます。

インフラストラクチャ エージェントをインストールするには、次の 2 つの方法があります。

* [ガイド付きインストール](https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20)に従って、システムにインフラストラクチャ エージェントをインストルメント化します。
* コマンド ラインから[インフラストラクチャ エージェントをインストールします](/docs/infrastructure/install-infrastructure-agent/linux-installation/install-infrastructure-monitoring-agent-linux)。

## Snowflake と New Relic の統合 [#integrate]

次の手順では、Snowflake と New Relic の統合について説明します。インストールに関する情報は、このドキュメントと、手順 4 で移動する New Relic Snowflake リポジトリに分かれています。

<CollapserGroup>
  <Collapser
    id="step1"
    title="ステップ 1.Snowflake リポジトリのクローンを作成する"
  >
    CLI で次のコマンドを実行して、New Relic Snowflake リポジトリをマシンにクローンします。

    ```
    git clone https://github.com/newrelic/newrelic-snowflake-integration.git
    ```
  </Collapser>

  <Collapser
    id="step2"
    title="ステップ 2. プラットフォームに関連するバイナリをダウンロードする"
  >
    ステップ 1 のクローン リポジトリで、[関連するバイナリ](https://github.com/newrelic/newrelic-snowflake-integration/releases)を`releases`セクションにダウンロードします。つまり、Linux を実行している場合は、ダウンロードします。 `snowflakeintegration-linux.`
  </Collapser>

  <Collapser
    id="step3"
    title="ステップ 3. `config.yaml` を更新する"
  >
    統合に最新の情報を使用していることを確認するには、 `config.yaml`ファイルを更新して、Snowflake リポジトリの[キー ペア認証](https://github.com/newrelic/newrelic-snowflake-integration#key-pair-authentication)で見つかったスニペットと一致させます。

    yaml ファイルを更新したら、このドキュメントに戻ってダッシュボードを New Relic アカウントにインストールします。
  </Collapser>
</CollapserGroup>

## カスタム クエリを作成する [#custom]

独自にカスタマイズしたメトリクスを New Relic に送信できます。これらのカスタム クエリを追加したら、ダッシュボードで監視できます。

以下に、カスタム クエリの 2 つの例を示します。

<CollapserGroup>
  <Collapser
    className="freq-link"
    id="longest"
    title="最長のクエリ"
  >
    読み込みに最も時間がかかるクエリを見つけるには:

    1. ファイルを作成して名前を付ける `longest_queries.sql`

    2. ファイル パスを`newrelic-snowflake-integrations/queries`として指定します。

    3. `longest_queries.sql`に、次のスニペットを追加します:

       ```sql
       select 
           query_id, 
           query_text,
           (execution_time / 60000) as exec_time,
           warehouse_name,
           user_name,
           execution_status
       from 
           snowflake.account_usage.query_history 
       where 
           execution_status = 'SUCCESS' 
       order by 
           execution_time desc
       ```

    4. `flex-snowflake-linux.yml`ファイルに、次のスニペットを追加します。

    ```yml
    - name: longestQueries
    entity: snowflake
    # New Relic will capture all your Snowflake metrics when you use `event_type: SnowflakeVirtualWarehouse`. 
    event_type: SnowflakeVirtualWarehouse
    custom_attributes:
        metric_type: snowflake.query_performance
    commands: 
        - run: - run: YOUR_PATH_TO_DOWNLOADED_BINARY_FILE YOUR_PATH_TO_CLONED_REPOSITORY_DIRECTORY/config.yaml YOUR_PATH_TO_CLONED_REPOSITORY_DIRECTORY/queries/longest_queries.sql
    ```
  </Collapser>

  <Collapser
    className="freq-link"
    id="warehouse-usage"
    title="倉庫ごとのクレジット使用量"
  >
    読み込みに最も時間がかかるクエリを見つけるには:

    1. ファイルを作成して名前を付ける `credit_usage_by_warehouse.sql`

    2. ファイル パスを`YOUR_PATH_TO_CLONED_REPOSITORY_DIRECTORY/queries/credit_usage_by_warehouse.sql`として指定します。

    3. `credit_usage_by_warehouse.sql`に、次のスニペットを追加します:

       ```sql
       select 
           warehouse_name, 
           sum(credits_used) as total_credits_used 
       from 
           snowflake.account_usage.warehouse_metering_history 
       group by 
           1 
       order by 
           2 desc;
       ```

    4. 次のスニペットを`flex-snowflake.yml`に追加します:

       ```yml
           - name: CreditUsageByWarehouse
               entity: snowflake
               event_type: SnowflakeVirtualWarehouse
               custom_attributes:
                   metric_type: snowflake.credit_usage_by_warehouse
               commands: 
               - run: YOUR_PATH_TO_DOWNLOADED_BINARY_FILE YOUR_PATH_TO_CLONED_REPOSITORY_DIRECTORY/config.yaml YOUR_PATH_TO_CLONED_REPOSITORY_DIRECTORY/queries/credit_usage_by_warehouse.sql
       ```
  </Collapser>
</CollapserGroup>

## ダッシュボードで Snowflake メトリクスを取得する [#dash]

[Snowflake クイックスタート](https://newrelic.com/instant-observability/snowflake)をインストールすると、重要な Snowflake データを New Relic で確認できます。

1. **[one.newrelic.com](https://one.newrelic.com/all-capabilities)**にアクセスし、次に \[**メトリクスとイベント**] をクリックします。
2. NRQL クエリを実行して Snowflake メトリクスを表示します: `SELECT * FROM SnowflakeAccount`または`SELECT * FROM SnowflakeVirtualWarehouse` 。
3. New Relic が Snowflake メトリクスを取り込んだことを確認したら、 **[one.newrelic.com](https://one.newrelic.com/all-capabilities)**から**Dashboards**に移動して、Snowflake ダッシュボードを表示します。

## 次は何ですか？

NRQL クエリの作成とダッシュボードの生成の詳細については、次のドキュメントをご覧ください。

* 基本的なクエリと高度なクエリを作成する[ためのクエリ ビルダーの概要](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder)。
* [ダッシュボードをカスタマイズしてさまざまなアクションを実行するためのダッシュボードの概要](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards)。
* ダッシュボードを[管理して、ダッシュ](/docs/query-your-data/explore-query-data/dashboards/manage-your-dashboard)ボードの表示モードを調整したり、ダッシュボードにコンテンツを追加したりします。