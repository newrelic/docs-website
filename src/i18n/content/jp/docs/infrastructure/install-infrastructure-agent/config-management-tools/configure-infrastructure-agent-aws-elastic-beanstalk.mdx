---
title: AWS Elastic Beanstalk上でのインフラストラクチャエージェントの設定
tags:
  - Infrastructure
  - Install the infrastructure agent
  - Config management tools
metaDescription: 'Linux users: How to install AWS Elastic Beanstalk for New Relic''s infrastructure agent.'
freshnessValidatedDate: never
translationType: machine
---

Amazon Web Services (AWS) [Elastic Beanstalk](https://aws.amazon.com/elasticbeanstalk) は、アプリケーションの簡単なデプロイメントとスケーラビリティを可能にするダイナミックなサービスです。以下の手順で、インフラストラクチャエージェントを、AWS Elastic Beanstalkアプリケーションで起動したインスタンスにデプロイします。

インフラストラクチャエージェントのデプロイに加えて、New RelicとAWSを統合し、Elastic Beanstalkの監視情報をNew Relicに取り込むこともできます。まだ行っていない場合は、 [Amazon インテグレーションとインフラストラクチャ モニタリング](/docs/infrastructure/infrastructure-integrations/getting-started/connect-aws-integrations-infrastructure) の指示に従ってください。

## 要件

サポートされている[アマゾン ウェブ サービス アカウント](http://aws.amazon.com/elasticbeanstalk/)があることを確認してください。 さらに、 New Relicインストレーションには、<InlinePopover type="licenseKey"/> が必要です。 これは、アカウントに[サインアップする](http://newrelic.com/signup "リンクが新しいウィンドウで開きます")ときに New Relic が提供する 40 文字の 16 進文字列です。

## インフラストラクチャエージェントをインストールします [#download]

AWS Elastic Beanstalkで起動したインスタンスにインフラストラクチャエージェントをインストールするには、以下の手順に従います。

1. Elastic BeanStalkアプリケーション内の`.ebextensions`フォルダーに、 `newrelic.config`という名前の新しいファイルを作成します。

2. オペレーティング システムに基づいて、次の内容をファイルに追加します。

   * `YOUR_LICENSE_KEY`を New Relic <InlinePopover type="licenseKey"/>に置き換えます。

   * ARM (Graviton) で実行する場合は、 `x86_64` を `aarch64` に置き換えます。

     <CollapserGroup>
       <Collapser
         id="linux-2"
         title="Amazon Linux 2"
       >
         ```yml
         files:
           "/etc/newrelic-infra.yml":
             mode: "000644"
             owner: root
             group: root
             content: |
               license_key: YOUR_LICENSE_KEY

         commands:
           # Create the agent’s yum repository
           "01-agent-repository":
             command: sudo curl -o /etc/yum.repos.d/newrelic-infra.repo https://download.newrelic.com/infrastructure_agent/linux/yum/amazonlinux/2/x86_64/newrelic-infra.repo
           #
           # Update your yum cache
           "02-update-yum-cache":
             command: yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'
           #
           # Run the installation script
           "03-run-installation-script":
             command: sudo yum install newrelic-infra -y
         ```
       </Collapser>

       <Collapser
         id="linux-2023"
         title="Amazon Linux 2023"
       >
         ```yml
         files:
           "/etc/newrelic-infra.yml":
             mode: "000644"
             owner: root
             group: root
             content: |
               license_key: YOUR_LICENSE_KEY

         commands:
           # Create the agent’s yum repository
           "01-agent-repository":
             command: sudo curl -o /etc/yum.repos.d/newrelic-infra.repo https://download.newrelic.com/infrastructure_agent/linux/yum/amazonlinux/2023/x86_64/newrelic-infra.repo
           #
           # Update your yum cache
           "02-update-yum-cache":
             command: yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'
           #
           # Run the installation script
           "03-run-installation-script":
             command: sudo yum install newrelic-infra -y
         ```
       </Collapser>

       <Collapser
         id="deploy-infrastructure"
         title="ウィンドウズ"
       >
         ```yml
         packages:
           msi:
             infrastructure: https://download.newrelic.com/infrastructure_agent/windows/newrelic-infra.msi
         files:
           "C:\\Program Files\\New Relic\\newrelic-infra\\newrelic-infra.yml":
             content: |
               license_key: YOUR_LICENSE_KEY
         commands:
           01_stop-newrelic-infra:
             command: net stop newrelic-infra
             ignoreErrors: true
           02_start-newrelic-infra:
             command: net start newrelic-infra
             ignoreErrors: true
         ```
       </Collapser>
     </CollapserGroup>

3. 作成したアプリをElastic BeanStalkにプッシュします。

   * 通常、 [`eb deploy`](http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-deploy.html)を使用します。
   * まだ[EbCLI2.6](http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli.html)を使用している場合は、必要に応じて`git aws.push`を使用してください。
   * オプションです。AWS コンソール UI を使用します。

セットアップが成功した後、New Relic にメトリクスが表示され始めるまでに最大 15 分かかる場合があります。 ホストのインフラストラクチャ ページを<DNT>**[one.newrelic.com](https://one.newrelic.com/all-capabilities)**</DNT>で表示します。

## インフラストラクチャエージェントを構成する

インフラストラクチャ エージェントを構成するには、エージェント構成ファイルを調整するか、環境変数を使用して要件に基づいて[エージェント設定を](/docs/infrastructure/install-infrastructure-agent/configuration/infrastructure-agent-configuration-settings/)決定します。設定は、以下のいずれかの方法を使用して適用できます。

* ファイル内の設定: 追加のエージェント設定を使用して、 `.ebextensions`フォルダー内の`newrelic.config`ファイルを編集します。設定は、 `newrelic-infra.yml`ファイルの内容に含まれている必要があります。
* 環境変数の設定: Elastic Beanstalk UI、API、または CLI を介して必要な`NRIA_*`環境変数を定義します。`newrelic.config`ファイルの`option_settings`を使用してそれらを定義することもできます。詳細については、 [AWS Beanstalk のドキュメント](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-cfg-softwaresettings.html)を参照してください。

## インフラストラクチャ・エージェントのアンインストール

エージェントをアンインストールするには、次の構成で`.ebextensions` }から`newrelic.config`を更新してから、デプロイメントを更新します。

<CollapserGroup>
  <Collapser
    id="uninstall-agent-linux-ami"
    title="Amazon Linux"
  >
    ```yml
    commands:
      # Remove agent configuration file
      "04-agent-remove-config":
        command: sudo rm /etc/newrelic-infra.yml
      #
      # Uninstall infra agent
      "05-agent-uninstall":
        command: sudo yum remove newrelic-infra -y
    ```
  </Collapser>

  <Collapser
    id="uninstall-infrastructure"
    title="ウィンドウズ"
  >
    ```yml
    commands:
      03_uninstall-newrelic-infra:
        command: wmic product where name="New Relic Infrastructure Agent" call uninstall
        ignoreErrors: true
    ```
  </Collapser>
</CollapserGroup>
