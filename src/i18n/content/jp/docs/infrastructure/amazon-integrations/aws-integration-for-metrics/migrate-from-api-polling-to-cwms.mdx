---
title: APIポーリングからCloudWatch Metric Streamsへの移行
tags:
  - API polling to CWMS migration
metaDescription: Migrate your New Relic and AWS services integration type from API Polling to CloudWatch Metric Streams.
freshnessValidatedDate: never
translationType: machine
---

AWSアカウントとNew Relicをシームレスに統合するには、 [CloudFormation および CloudWatch Metric Streams を介した](/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation)統合が最も推奨されるアプローチです。 ただし、 APIポーリングを使用してAWSアカウントをNew Relicとすでに統合している場合は、次の手順を参照してAPIポーリングからCloudWatch Metric Streamsに移行してください。

## 前提条件 [#prerequisites]

AWS アカウントと New Relic の統合を開始する前に、次の前提条件を満たしていることを確認してください。

* **New Relic[Ingest \[の取り込み\] - ライセンスキーとユーザー キー](https://one.newrelic.com/api-keys)**: AWSサービスをNew Relicアカウントに接続するには、これらのキーが必要です。
* **[](https://docs.aws.amazon.com/ARG/latest/userguide/gettingstarted-prereqs-permissions.html)**新しい AWS リソースと**[ IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html)** ロール をデプロイするための 権限: AWS アカウントにはこの権限が必要です。
* クラウド統合の**[権限](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/#infrastructure)**: New Relicアカウントにはこれらの権限が必要です。
* 複数の AWS アカウントを管理するユーザーの場合は、[各アカウントを 1 つの New Relic アカウントに接続します](/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account)。
* これらのアカウント内で複数のリージョンを管理するユーザーの場合は、リージョンごとに New Relic を指す個別の Kinesis Data Firehose を作成する必要があります。

<Steps>
  <Step>
    ## CloudWatch Metric Streams統合への移行 [#migrate]

    APIポーリングから移行するには、CloudFormation テンプレートを作成するか、 AWSアカウントを再追加してアプリ内のガイド付きインストール手順に従う必要があります。 最も効率的な移行方法であるため、CloudFormation テンプレート方式を使用することをお勧めします。これらの統合はCloudWatch Metric Streamsではサポートされていないため、統合に移行できません。

    * AWS CloudTrail
    * AWS Health
    * AWS Trusted Advisor
    * AWS X-Ray

    これらの統合を使用する場合でも、 APIポーリング方式を使用する必要があります。

    <CollapserGroup>
      <Collapser id="with-template" title="CloudFormation テンプレートを使用して移行する (推奨)">
        CloudFormation テンプレートを使用すると、ポーリング設定に基づいて事前設定されたネームスペースでテンプレートを更新できます。

        1. **[one.newrelic.com &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**に移動し、 **<DNT>Migrate to CloudWatch Metric stream</DNT>**クリックします。
        2. 手順に従ってください。テンプレートをダウンロードし、 APIポーリングからネームスペースを複製します。 ダウンロードしたテンプレートにアカウントの詳細を必ず追加してください。
        3. AWS Consoleから<DNT>**Cloud Formation &gt; Create Stack &gt; Upload a template file**</DNT>に移動します。 更新された CloudFormation テンプレートをアップロードします。
      </Collapser>

      <Collapser id="without-template" title="CloudFormation テンプレートを使用せずに移行する">
        CloudFormation 方式を使用しない場合は、すでにAWSアカウントをポーリングインテグレーションにリンクしている場合でも、 AWSアカウントを再度追加する必要があります。 これらの手順により、このドキュメントから離れる必要があるかもしれませんが、ポーリング統合を無効にするために戻ってください。

        1. <DNT>**[one.newrelic.com &gt; All capabilities &gt;Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT>に移動し、 <DNT>**Add AWS account**</DNT>をクリックします。方法を選択してください。
        2. このドキュメントのAWS Console[フローのAWS Console](/install/aws-cloudwatch/?task=console)手順に従います。
        3. 以前のAWSプロバイダー アカウントでの[不要なポーリング統合をすべて無効にします](/docs/infrastructure/amazon-integrations/connect/uninstall-aws/)。

        無効にする場合は、 [一部の統合がCloudWatch Metric Streamsでサポートされない](/docs/infrastructure/amazon-integrations/connect/connect-aws-new-relic-infrastructure-monitoring/)ことに注意してください。
      </Collapser>
    </CollapserGroup>

    CloudWatch Metric Streams統合は、メトリクスAPIを使用して、メトリクスを[次元メトリクス](/docs/data-apis/understand-data/new-relic-data-types/#dimensional-metrics)形式でプッシュします。 一方、 APIポーリング方式は[イベント](/docs/data-apis/understand-data/new-relic-data-types/#events-new-relic)に基づいてメトリクスをプッシュします。

    * 移行を支援するために、あらゆる形式でクエリを透過的に記述できるシミング メカニズムを提供します。これらの書き込みは、イベントからメトリクス、またはメトリクスからイベントのいずれかで、利用可能なソースに基づいて期待どおりに処理されます。
    * CloudWatch Metric Streams 統合でイベントベースの書き込みを使用できるようにするシミング メカニズムに関する[いくつかの制限](/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/query-infrastructure-dimensional-metrics-nrql/#known-limitations)を確認することをお勧めします。

    移行後、API ポーリング データに依存する一部の New Relic 機能の動作が異なる場合があります。

    * <DNT>**Dashboards**</DNT>: 投票ベースのAWSインテグレーション イベントを使用するカスタムダッシュボードは引き続き期待どおりに機能します。
    * <DNT>**Alerts**</DNT>: ポーリングベースの AWS イベントを使用するアラート条件は引き続き機能します。これらを、 NRQLソースとして使用する次元メトリクス形式に適合させることをお勧めします。
    * <DNT>**Entities**</DNT>：モニターエンティティのリストには、重複したエンティティが最大24時間表示される場合があります
    * <DNT>**Attributes**</DNT>：ポーリングベースのAWS統合では、収集されたリソースタグに`label.`プレフィックスが付けられましたが、Amazon CloudWatch Metric Streams統合では、収集されたリソースタグに`tags.`プレフィックスが付けられました。同じAWSアカウントに対して両方の統合が有効になっている場合、イベント形式を使用すると、リソースタグが両方のプレフィックスの下に表示されます
  </Step>

  <Step>
    ## データの検証 [#validate-data]

    メトリック ストリームからデータを受信していることを確認するには、次の手順に従います。

    1. <DNT>**[one.newrelic.com &gt; All capabilities &gt; Infrastructure &gt; AWS](https://one.newrelic.com/infra/infrastructure/cloud-aws)**</DNT>へ移動します。New Relic に接続した AWS アカウントを検索します。<DNT>**Stream**</DNT>アカウント。
    2. アカウント ステータス ダッシュボードを確認し、 New Relicメトリクス データを受信していることを確認します。 これには、エラー、取り込まれたネームスペースおよびメトリクスの数が含まれる場合があります。
    3. メトリクスの特定のセットに対して書き込みを行って、データを探索します。

    New Relic が新しいリソースを検出し、それをエンティティとして合成するまでに数分かかる場合があります。

    <Callout variant="tip">
      AWS Billingなどのグローバル サービス用のAWS CloudWatchメトリクスは、 <DNT>**us-east-1**</DNT>リージョンでのみ利用できます。 そのリージョンにアクティブな CloudWatch メトリック ストリームが設定されていることを確認します。
    </Callout>
  </Step>
</Steps>

## 関連トピック [#related-topics]

<DocTiles>
  <DocTile title="複数のAWSアカウントからデータを収集する" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-multi-account/">
    複数の AWS アカウントからデータを収集する方法を学びます。
  </DocTile>

  <DocTile title="AWSインテグレーションのメトリクス" path="/docs/infrastructure/amazon-integrations/manage-aws-data/aws-integrations-metrics/">
    CloudWatch メトリック ストリームからメトリクスを探索して使用します。
  </DocTile>

  <DocTile title="CloudFormation と CWMS によるAWSインテグレーション" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-cwms">
    CloudFormation とCloudWatch Metric Streamsを使用して、 AWSサービスをNew Relicと統合します。
  </DocTile>

  <DocTile title="CloudFormation とAPIポーリングによるAWSインテグレーション" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/via-cloudformation-and-api-polling">
    CloudFormation とAPIポーリングを使用して、 AWSサービスをNew Relicと統合します。
  </DocTile>

  <DocTile title="Terraform によるAWSインテグレーション" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/terraform">
    Terraform を使用してAWSサービスをNew Relicと統合します。
  </DocTile>

  <DocTile title="AWSコンソールからの手動統合" path="/docs/infrastructure/amazon-integrations/aws-integration-for-metrics/manual">
    AWSコンソールからAWSサービスをNew Relicと手動で統合します。
  </DocTile>
</DocTiles>