---
title: webhookペイロードのカスタマイズ
tags:
  - Alerts and applied intelligence
  - Alerts
  - Alert notifications
metaDescription: Examples of webhook values we can send to the defined callback URL for alerts notifications.
translationType: human
---

<Callout
  variant="important"
  title="有効期限（EOL）の通知"
>
  通知チャネルをより強力なワークフローに置き換えています。既存の通知を、より多くのオプション、柔軟性、制御を提供するワークフローに自動移行し、通知に追加のデータを含めて強制できます。[ワークフローの詳細](/docs/alerts-applied-intelligence/applied-intelligence/incident-workflows/incident-workflows/)。
</Callout>

Webhookを[アラート通知チャネル](/docs/alerts/new-relic-alerts-beta/managing-notification-channels/notification-channels-controlling-where-send-alerts#webhook)として使用する場合は、デフォルト値を使用できます。POSTメッセージのペイロードをカスタマイズして、システムインテグレーションをさらに高めることもできます。

## Webhookを定義する [#ssl]

JSON Webhookを定義する場合は、`"name":"value",`の形式を使用します。例:

```
"current_state":"acknowledged",
```

ペイロード形式で静的なWebhook変数を定義する場合は、`name="value"`形式を使用します。例:

```
current_state="acknowledged"
```

Webhookに自己署名したカスタムのSSL証明書は含めないでください。当社エージェントは、[デフォルトでSSLが有効化](/docs/accounts-partnerships/accounts/security/data-security)されます。当社のセキュリティポリシーにより、カスタムSSL証明書はTrustストアにインポートされません。合成モニタリングマルチロケーション障害条件の`$METADATA`変数を持つWebhookは現在サポートされていません。

## Webhookの値 [#variables]

当社は、以下のデフォルトの動的webhook値に対応しています。利便性を考慮して、値はアルファベット順に表示されていますが、Webhookの値は順不同で定義できます。`"Error Type": "My Error"`などの独自のキーと値のペアを使用して、カスタム変数を追加することもできます。

<table>
  <thead>
    <tr>
      <th>
        **キー**
      </th>

      <th>
        **変数**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `"account_id"`
      </td>

      <td>
        `$ACCOUNT_ID`

        **可能な値：**New RelicアカウントID（文字列）
      </td>
    </tr>

    <tr>
      <td>
        `"account_name"`
      </td>

      <td>
        `$ACCOUNT_NAME`

        **可能な値：**New Relicアカウント名（文字列）
      </td>
    </tr>

    <tr>
      <td>
        `"closed_violations_count_critical"`
      </td>

      <td>
        `$CLOSED_VIOLATIONS_COUNT_CRITICAL`
      </td>
    </tr>

    <tr>
      <td>
        `"closed_violations_count_warning"`
      </td>

      <td>
        `$CLOSED_VIOLATIONS_COUNT_WARNING`
      </td>
    </tr>

    <tr>
      <td>
        `"condition_id"`
      </td>

      <td>
        `$CONDITION_ID`
      </td>
    </tr>

    <tr>
      <td>
        `"condition_description"`
      </td>

      <td>
        `$DESCRIPTION`

        これには、アラート条件の[説明フィールド](/docs/alerts/new-relic-alerts/defining-conditions/alert-condition-descriptions)が含まれます（存在する場合）。
      </td>
    </tr>

    <tr>
      <td>
        `"condition_name"`
      </td>

      <td>
        `$CONDITION_NAME`

        **可能な値:** （ユーザー定義文字列）
      </td>
    </tr>

    <tr>
      <td>
        `"current_state"`
      </td>

      <td>
        `$EVENT_STATE`

        **設定可能な値: **`[open|acknowledged|closed]`
      </td>
    </tr>

    <tr>
      <td>
        `"details"`
      </td>

      <td>
        `$EVENT_DETAILS`
      </td>
    </tr>

    <tr>
      <td>
        `"duration"`
      </td>

      <td>
        `$DURATION`
      </td>
    </tr>

    <tr>
      <td>
        `"event_type"`
      </td>

      <td>
        `$EVENT_TYPE`

        **設定可能な値: **`[INCIDENT]`
      </td>
    </tr>

    <tr>
      <td>
        `"incident_acknowledge_url"`
      </td>

      <td>
        `$INCIDENT_ACKNOWLEDGE_URL`
      </td>
    </tr>

    <tr>
      <td>
        `"incident_id"`
      </td>

      <td>
        `$INCIDENT_ID`
      </td>
    </tr>

    <tr>
      <td>
        `"incident_url"`
      </td>

      <td>
        `$INCIDENT_URL`
      </td>
    </tr>

    <tr>
      <td>
        `"metadata"`
      </td>

      <td>
        `$METADATA`

        現在、Syntheticモニタリングの複数の場所における障害条件でのみ使用されています。

        **可能値：**（オブジェクト）
      </td>
    </tr>

    <tr>
      <td>
        `"open_violations_count_critical"`
      </td>

      <td>
        `$OPEN_VIOLATIONS_COUNT_CRITICAL`
      </td>
    </tr>

    <tr>
      <td>
        `"open_violations_count_warning"`
      </td>

      <td>
        `$OPEN_VIOLATIONS_COUNT_WARNING`
      </td>
    </tr>

    <tr>
      <td>
        `"owner"`
      </td>

      <td>
        `$EVENT_OWNER`
      </td>
    </tr>

    <tr>
      <td>
        `"policy_name"`
      </td>

      <td>
        `$POLICY_NAME`

        **可能な値:** （ユーザー定義文字列）
      </td>
    </tr>

    <tr>
      <td>
        `"policy_url"`
      </td>

      <td>
        `$POLICY_URL`
      </td>
    </tr>

    <tr>
      <td>
        `"runbook_url"`
      </td>

      <td>
        `$RUNBOOK_URL`
      </td>
    </tr>

    <tr>
      <td>
        `"severity"`
      </td>

      <td>
        `$SEVERITY`

        **設定可能な値: **\[`CRITICAL]`
      </td>
    </tr>

    <tr>
      <td>
        `"targets"`
      </td>

      <td>
        `$TARGETS`

        `$TARGETS`変数はFORMデータとともに使用できませんが、JSONデータと互換性があります。

        [静的なNRQLファセット型アラート](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#threshold-types)の場合は、アラートをトリガーしたファセット名がターゲットの**名前**フィールドに自動入力されます。

        使用可能なフィールドの説明については、[ターゲット値](/docs/alerts/new-relic-alerts/managing-notification-channels/customize-your-webhook-payload#target-values)を参照してください。
      </td>
    </tr>

    <tr>
      <td>
        `"timestamp"`
      </td>

      <td>
        `$TIMESTAMP`
      </td>
    </tr>

    <tr>
      <td>
        `"timestamp_utc_string"`
      </td>

      <td>
        `$TIMESTAMP_UTC_STRING`

        `YYYY-MM-DD, HH:MM UTC`形式の人間が可読可能なタイムスタンプ。
      </td>
    </tr>

    <tr>
      <td>
        `"version"`
      </td>

      <td>
        `$VERSION`
      </td>
    </tr>

    <tr>
      <td>
        `"violation_callback_url"`
      </td>

      <td>
        `$VIOLATION_CALLBACK_URL`
      </td>
    </tr>

    <tr>
      <td>
        `"violation_chart_url"`
      </td>

      <td>
        `$VIOLATION_CHART_URL`
      </td>
    </tr>
  </tbody>
</table>

## ターゲット値 [#target-values]

このセクションでは、Webhookの`$TARGETS`フィールドについて説明します。このデータはカスタマイズ不能で、参照用にここに提供されています。`$TARGETS`には、0個以上のターゲット（エンティティ）のリストが含まれています。各ターゲットは、次のフィールドを含むJSONオブジェクトによって説明されます。

<table>
  <thead>
    <tr>
      <th width={250}>
        **キー**
      </th>

      <th>
        **変数**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `"id"`
      </td>

      <td>
        ターゲットまたはエンティティのID
      </td>
    </tr>

    <tr>
      <td>
        `"name"`
      </td>

      <td>
        ターゲットまたはエンティティの名前
      </td>
    </tr>

    <tr>
      <td>
        `"labels"`
      </td>

      <td>
        条件の評価から派生したエンティティタグとNRQLファセットの組み合わせ、および使用可能なエンティティタグ。
      </td>
    </tr>

    <tr>
      <td>
        `"link"`
      </td>

      <td>
        このターゲットまたはエンティティへのURLリンク。
      </td>
    </tr>

    <tr>
      <td>
        `"product"`
      </td>

      <td>
        このターゲットまたはエンティティの製品タイプ: 例 `APM`
      </td>
    </tr>

    <tr>
      <td>
        `"type"`
      </td>

      <td>
        `product`に含まれるターゲットまたはエンティティのタイプ: 例 `Application`
      </td>
    </tr>
  </tbody>
</table>

## Webhookの書式の例 [#webhook-format-examples]

以下の例は、デフォルトの動的変数とカスタム変数の両方を使用したWebhookペイロードを示したものです。独自のペイロードを定義するにあたっては、動的変数のすべてもしくは一部、並びに任意のカスタム変数を使用できます。

<CollapserGroup>
  <Collapser
    id="json-example"
    title="JSON Webhookの例"
  >
    <Callout variant="important">
      以下のWebhookの例には、読みやすくするために余分なスペースと改行が挿入されています。実際のWebhookの応答は、連続した1行のテキストとして配信されます。`"team": "DevOps"`行は、カスタム変数の例です。
    </Callout>

    ```
    {
    "account_id": "$ACCOUNT_ID",
    "account_name": "$ACCOUNT_NAME",
    "closed_violations_count_critical": "$CLOSED_VIOLATIONS_COUNT_CRITICAL",
    "closed_violations_count_warning": "$CLOSED_VIOLATIONS_COUNT_WARNING",
    "condition_family_id": "$CONDITION_FAMILY_ID",
    "condition_id": "$CONDITION_ID",
    "condition_name": "$CONDITION_NAME",
    "current_state": "$EVENT_STATE",
    "details": "$EVENT_DETAILS",
    "duration": "$DURATION",
    "event_type": "$EVENT_TYPE",
    "incident_acknowledge_url": "$INCIDENT_ACKNOWLEDGE_URL",
    "incident_id": "$INCIDENT_ID",
    "incident_url": "$INCIDENT_URL",
    "open_violations_count_critical": "$OPEN_VIOLATIONS_COUNT_CRITICAL",
    "open_violations_count_warning": "$OPEN_VIOLATIONS_COUNT_WARNING",
    "owner": "$EVENT_OWNER",
    "policy_name": "$POLICY_NAME",
    "policy_url": "$POLICY_URL",
    "runbook_url": "$RUNBOOK_URL",
    "severity": "$SEVERITY",
    "targets": "$TARGETS",
    "timestamp": "$TIMESTAMP",
    "timestamp_utc_string": "$TIMESTAMP_UTC_STRING",
    "violation_callback_url": "$VIOLATION_CALLBACK_URL",
    "violation_chart_url": "$VIOLATION_CHART_URL",
    "team": "DevOps"
    }
    ```
  </Collapser>

  <Collapser
    id="form-example"
    title="フォームWebhookの例"
  >
    <Callout variant="important">
      以下のWebhookの例には、読みやすくするために余分なスペースと改行が挿入されています。実際のWebhookの応答は、連続した1行のテキストとして配信されます。
    </Callout>

    ```
    account_id=$ACCOUNT_ID
    account_name=$ACCOUNT_NAME
    closed_violations_count_critical=$CLOSED_VIOLATIONS_COUNT_CRITICAL
    closed_violations_count_warning=$CLOSED_VIOLATIONS_COUNT_WARNING
    condition_family_id=$CONDITION_FAMILY_ID
    condition_id=$CONDITION_ID
    condition_name=$CONDITION_NAME
    current_state=$EVENT_STATE
    details=$EVENT_DETAILS
    duration=$DURATION
    event_type=$EVENT_TYPE
    incident_acknowledge_url=$INCIDENT_ACKNOWLEDGE_URL
    incident_id=$INCIDENT_ID
    incident_url=$INCIDENT_URL
    open_violations_count_critical=$OPEN_VIOLATIONS_COUNT_CRITICAL
    open_violations_count_warning=$OPEN_VIOLATIONS_COUNT_WARNING
    owner=$EVENT_OWNER
    policy_name=$POLICY_NAME
    policy_url=$POLICY_URL
    runbook_url=$RUNBOOK_URL
    severity=$SEVERITY
    timestamp=$TIMESTAMP
    timestamp_utc_string=$TIMESTAMP_UTC_STRING
    violation_callback_url=$VIOLATION_CALLBACK_URL
    violation_chart_url=$VIOLATION_CHART_URL
    team="DevOps"  <--[example of custom variable]
    ```
  </Collapser>

  <Collapser
    id="MS-Teams-example"
    title="Microsoft Teamsの例"
  >
    ```
    {
      "@type": "MessageCard",
      "@context": "http://schema.org/extensions",
      "themeColor": "0076D7",
      "summary": {{ json annotations.title.[0] }},
      "sections": [{
        "activityTitle": "{{eq state 'CLOSED' yes='🟩' no='🟥'}} {{ annotations.title.[0] }}",
        "activitySubtitle": "{{#each accumulations.policyName}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}",
        "activityImage": "https://one.newrelic.com/apple-touch-icon.png?v=2.1",
        "facts": [{
          "name": "Timestamp",
          "value": {{ json issueActivatedAtUtc }}
          }, {
          "name": "Account",
          "value": "{{ accumulations.tag.account.[0] }} ({{ nrAccountId }})"
          }, {
          "name": "Severity",
          "value": {{ json priority}}
          }, {
          "name": "State",
          "value": {{ json state}}
          }, {
          "name": "Duration",
          "value": {{ json issueDurationText }}
          }, {
          "name": "Impacted entities",
          "value": "{{#each entitiesData.names}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}"
          }, {
          "name": "Details",
          "value": "{{#each accumulations.conditionName}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}"
          }],
        "markdown": true
        }, {
          "text": "<img src="{{ violationChartUrl }}" alt="Incident Chart">"
        }],
        "potentialAction": [{
          "@type": "OpenUri",
          "name": "View Incident",
          "targets": [{
          "os": "default",
          "uri": {{ json issuePageUrl }}
          }]
        }, {
          "@type": "OpenUri",
          "name": "Acknowledge Incident",
          "targets": [{
          "os": "default",
          "uri": {{ json issueAckUrl }}
          }]
        }, {
          "@type": "OpenUri",
          "name": "Open Runbook",
          "targets": [{
          "os": "default",
          "uri": {{ json accumulations.runbookUrl.[0] }}
          }]
        }]  
      }
    ```
  </Collapser>
</CollapserGroup>