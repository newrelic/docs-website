---
title: あなたのKubernetesデータを見つけて使う
tags:
  - Integrations
  - Kubernetes integration
  - Understand and use data
metaDescription: 'New Relic''s Kubernetes integration: How to install and activate the integration, and what data is reported.'
translationType: machine
---

import kubernetesDashboard from 'images/kubernetes_screenshot-full_dashboard.webp'

独自のチャートを作成したり、 [クエリ](/docs/using-new-relic/data/understand-data/query-new-relic-data) すべての [Kubernetesインテグレーション](/docs/integrations/kubernetes-integration/get-started/introduction-kubernetes-integration) データをクエリビルダやNerdGraph APIを使って照会することができます。当社の統合では、コンテナ・オーケストレーション・レイヤーをインスツルメンテーションすることでKubernetesのデータを収集します。よりシンプルで視覚的な体験をするには、 [クラスタエクスプローラ](/docs/integrations/kubernetes-integration/understand-use-data/kubernetes-cluster-explorer) を使用してください。

<img
  title="New Relic - Kubernetes dashboard"
  alt="New Relic - Kubernetes dashboard"
  src={kubernetesDashboard}
/>

<figcaption>
  **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Dashboards**:[クエリ ビルダー](/docs/chart-builder/use-chart-builder/get-started/introduction-chart-builder) を使用すると、Kubernetes データをクエリし、明確な視覚化を作成できます。
</figcaption>

## Kubernetesのデータを照会する [#view-data]

[Kubernetesのデータを照会する最も簡単な方法](/docs/using-new-relic/data/understand-data/query-new-relic-data) は、 [クエリビルダー](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data) を使用し、 [NRQLクエリ](/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql) を受け入れます。または、 [NerdGraph API](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph) を使用してKubernetesデータを取得することもできます。

### イベントと属性 [#event-types]

Kubernetes データは、次の[イベント](/docs/using-new-relic/data/understand-data/new-relic-data-types#event-data)に添付されます。このデータの詳細については[、データ ディクショナリ](https://docs.newrelic.com/attribute-dictionary/?dataSource=Kubernetes)を参照してください。

<table>
  <thead>
    <tr>
      <th style={{ width: "275px" }}>
        イベント名
      </th>

      <th>
        Kubernetesのデータの種類
      </th>

      <th style={{ width: "200px" }}>
        発売日
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `K8sNodeSample`
      </td>

      <td>
        ノードデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sNamespaceSample`
      </td>

      <td>
        名前空間データ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sDeploymentSample`
      </td>

      <td>
        デプロイメントデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sReplicasetSample`
      </td>

      <td>
        レプリカセットデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sDaemonsetSample`
      </td>

      <td>
        デーモンセットデータ
      </td>

      <td>
        v1.13.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sStatefulsetSample`
      </td>

      <td>
        StatefulSetデータ
      </td>

      <td>
        v1.13.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sPodSample`
      </td>

      <td>
        ポッドデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sClusterSample`
      </td>

      <td>
        クラスターデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sContainerSample`
      </td>

      <td>
        コンテナデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sVolumeSample`
      </td>

      <td>
        ボリュームデータ
      </td>

      <td>
        v1.0.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sApiServerSample`
      </td>

      <td>
        APIサーバーデータ
      </td>

      <td>
        v1.11.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sControllerManagerSample`
      </td>

      <td>
        コントローラー・マネージャー・データ
      </td>

      <td>
        v1.11.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sSchedulerSample`
      </td>

      <td>
        スケジューラーデータ
      </td>

      <td>
        v1.11.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sEtcdSample`
      </td>

      <td>
        etcdデータ
      </td>

      <td>
        v1.11.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sEndpointSample`
      </td>

      <td>
        エンドポイントデータ
      </td>

      <td>
        v1.13.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sServiceSample`
      </td>

      <td>
        サービスデータ
      </td>

      <td>
        v1.13.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sHpaSample`
      </td>

      <td>
        Horizontal Pod Autoscaler データ
      </td>

      <td>
        v2.3.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sCronjobSample`
      </td>

      <td>
        CronJob データ
      </td>

      <td>
        v3.10.0
      </td>
    </tr>

    <tr>
      <td>
        `K8sJobSample`
      </td>

      <td>
        ジョブデータ
      </td>

      <td>
        v3.10.0
      </td>
    </tr>
  </tbody>
</table>

これらのイベントとその属性の詳細については[、データ ディクショナリ](https://docs.newrelic.com/attribute-dictionary/?dataSource=Kubernetes)を参照してください。

### APMが監視するアプリケーションにおけるKubernetesのメタデータ [#apm-custom-attributes]

[アプリケーションをKubernetesと連携させることで](/docs/integrations/kubernetes-integration/metadata-injection/kubernetes-apm-metadata-injection) 、アプリケーショントレースや分散トレースに以下の属性が追加されます。

* `nodeName`
* `containerName`
* `podName`
* `clusterName`
* `deploymentName`
* `namespaceName`

## アラートの管理 [#alerts]

Kubernetes データのアラートとインシデントについて通知を受け取ることができます。

<CollapserGroup>
  <Collapser
    id="create-alert"
    title="警告条件の作成"
  >
    Kubernetesインテグレーションのアラート条件を作成するには

    1. **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Infrastructure > Settings > Alerts & AI > Kubernetes**に移動し、 **Create alert condition** \[アラート条件の作成]を選択します。

    2. 選択した属性のみを持つKubernetesエンティティにアラートをフィルタリングするには、 **Filter** を選択します。

    3. 閾値の設定を選択します。 **Trigger an alert when...** オプションの詳細については、 [Alert types](#alert-types) を参照してください。

    4. 既存の [アラートポリシー](/docs/alerts/new-relic-alerts/configuring-alert-policies/create-or-rename-alert-policy) を選択するか、新しいポリシーを作成します。

    5. \[**作成]**を選択します。

       アラート条件の閾値がトリガーされると、New Relic はポリシーの通知チャンネルに [通知](#notifications) を送信します。
  </Collapser>

  <Collapser
    id="alert-types"
    title="事前に設定された警告タイプと閾値を使用する"
  >
    Kubernetesの統合には、独自のアラートポリシーとアラート条件が付属しています。定義済みのアラート条件を確認するには、 [Kubernetesの統合を参照してください。定義済みのアラートポリシー](/docs/integrations/kubernetes-integration/kubernetes-events/kubernetes-integration-predefined-alert-policy) をご覧ください。

    さらに、Kubernetesインテグレーションを含め、使用している [New Relicインテグレーション](/docs/integrations/new-relic-integrations/getting-started/introduction-infrastructure-integrations) が収集するあらゆるメトリックに対してアラート条件を作成することができます。

    1. Select alert type **Integrations**.
    2. **Select a data source** ドロップダウンから、Kubernetes（K8s）のデータソースを選択します。
  </Collapser>

  <Collapser
    id="notifications"
    title="アラート通知の選択"
  >
    アラート条件の閾値がトリガーされると、New Relic はアラートポリシーで選択された通知チャンネルにメッセージを送信します。通知の種類に応じて、以下のようなオプションがあります。

    * [インシデントを見る](/docs/alerts/new-relic-alerts/reviewing-alert-incidents/view-violation-event-details-incidents).

    * [Acknowledge the incident](/docs/alerts/new-relic-alerts/reviewing-alert-incidents/acknowledge-alert-incidents).

    * 識別子名を選択すると、インシデントデータのチャートに移動します。

      アラートを発生させたエンティティの識別子は、通知メッセージの先頭付近に表示されます。識別子の形式は、アラートの種類によって異なります。

    * **利用可能なポッドが希望のポッドより少ない** アラート。

      ```
      K8s:CLUSTER_NAME:PARENT_NAMESPACE:replicaset:REPLICASET_NAME
      ```

    * **CPUやメモリーの使用状況** アラート。

      ```
      K8s:CLUSTER_NAME:PARENT_NAMESPACE:POD_NAME:container:CONTAINER_NAME
      ```

      いくつか例を挙げてみましょう。

      <CollapserGroup>
        <Collapser
          id="pod-alerts"
          title="ポッドアラートの通知例"
        >
          **使用可能なポッドが目的のポッドアラートより少ない場合**、問題をトリガーする`ReplicaSet`のIDは次のようになります。

          ```
          k8s:beam-production:default:replicaset:nginx-deployment-1623441481
          ```

          この識別子には以下の情報が含まれています。

          * クラスター名： `beam-production`
          * 親名前空間： `default`
          * `ReplicaSet` 名前： `nginx-deployment-1623441481`
        </Collapser>

        <Collapser
          id="container-resource"
          title="コンテナリソースの通知例"
        >
          コンテナのCPUやメモリ使用量のアラートの場合、エンティティは次のようになります。

          ```
          k8s:beam-production:kube-system:kube-state-metrics-797bb87c75-zncwn:container:kube-state-metrics
          ```

          この識別子には以下の情報が含まれています。

          * クラスター名： `beam-production`
          * 親名前空間： `kube-system`
          * ポッド名前空間： `kube-state-metrics-797bb87c75-zncwn`
          * コンテナ名： `kube-state-metrics`
        </Collapser>
      </CollapserGroup>
  </Collapser>

  <Collapser
    id="nrql-alerts"
    title="NRQLを使ったアラート条件の作成"
  >
    標準的な手順に従って、 [NRQL クエリのアラート条件を作成する](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries) 。
  </Collapser>
</CollapserGroup>

## データ取り込みを減らす [#reducedataingest]

当社のグラフは、粒度を犠牲にして取り込まれるデータの量を減らすオプションの設定をサポートしています。有効にするには、 `nri-bundle`チャートで`global.lowDataMode`を`true`に設定します。

`lowDataMode` 以下に概説する`nri-bundle`チャートの4つの特定のコンポーネントに影響します。

### New Relicのインフラ

`lowDataMode`が有効になっている場合、デフォルトのスクレイプ間隔は`15s`から`30s`に変更されます。 `config.interval`を使用してカスタム値を指定することもできます。これは`lowDataMode`よりも優先されます。

### Prometheus エージェントの統合

`lowDataMode`が有効になっている場合、次のプレフィックスが付いたメトリクスは、 [New Relic Kubernetes Integration](/docs/integrations/kubernetes-integration/understand-use-data/find-use-your-kubernetes-data/#event-types)によって既に収集および使用されているため、デフォルトで除外されます。

```
- kube_
- container_
- machine_
- cadvisor_
```

### New Relic のロギング

`lowDataMode` が有効な場合、ラベルとアノテーションは New Relic に転送されるログに含まれません。これにより、New Relic へのデータ取り込み全体が削減されます。

次のフィールドが保持されます: `cluster_name`、 `container_name`、 `namespace_name`、 `pod_name`、 `stream`、 `message` 、および `log`。

**ローデータモードのログ例**

次のログ レコードには、 [New Relic Logs Kubernetes プラグイン](/docs/logs/forward-logs/kubernetes-plugin-log-forwarding/)によって通常キャプチャされるすべての属性が含まれています。

```json
[
  {
    "cluster_name": "api-test",
    "kubernetes": {
      "annotations": {
        "kubernetes.io/psp": "eks.privileged"
      },
      "container_hash": "fryckbos/test@sha256:5b098eaf3c7d5b3585eb10cebee63665b6208bea31ef31a3f0856c5ffdda644b",
      "container_image": "fryckbos/test:latest",
      "container_name": "newrelic-logging",
      "docker_id": "134e1daf63761baa15e035b08b7aea04518a0f0e50af4215131a50c6a379a072",
      "host": "ip-192-168-17-123.ec2.internal",
      "labels": {
        "app": "newrelic-logging",
        "app.kubernetes.io/name": "newrelic-logging",
        "controller-revision-hash": "84db95db86",
        "pod-template-generation": "1",
        "release": "nri-bundle"
      },
      "namespace_name": "nrlogs",
      "pod_id": "54556e3e-719c-46b5-af69-020b75d69bf1",
      "pod_name": "nri-bundle-newrelic-logging-jxnbj"
    },
    "message": "[2021/09/14 12:30:49] [ info] [engine] started (pid=1)\n",
    "plugin": {
      "source": "kubernetes",
      "type": "fluent-bit",
      "version": "1.8.1"
    },
    "stream": "stderr",
    "time": "2021-09-14T12:30:49.138824971Z",
    "timestamp": 1631622649138
  }
]
```

`lowDataMode`を有効にした後の前のログ レコードは次のようになります。

```json
[
  {
    "cluster_name": "api-test",
    "container_name": "newrelic-logging",
    "namespace_name": "nrlogs",
    "pod_name": "nri-bundle-newrelic-logging-jxnbj",
    "message": "[2021/09/14 12:30:49] [ info] [engine] started (pid=1)\n",
    "stream": "stderr",
    "timestamp": 1631622649138
  }
]
```

### New Relic Pixieの統合 [#nr-pixie-integration]

`lowDataMode`が有効になっている場合、 `newrelic-pixie`統合はPixieスパンでより重いサンプリングを実行し、収集間隔を10秒から15秒に短縮します。

`lowDataMode` 設定：

```
HTTP_SPAN_LIMIT: 750
DB_SPAN_LIMIT: 250
COLLECT_INTERVAL_SEC: 15
```

これらのパラメータやその他のパラメータのデフォルト設定は、 [newrelic-pixie-integration](https://github.com/newrelic/newrelic-pixie-integration) Github repoにあります。

New Relic の kubernetes 統合を最大限に活用するには、無料の New Relic アカウントが必要です。まだ作成していない場合は、以下で作成して、今すぐデータの監視を開始してください。

<InlineSignup/>