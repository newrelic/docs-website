---
title: 特権モードと非特権モード
metaDescription: 'Understand why the New Relic Kubernetes integration defaults to privileged mode, what metrics are affected by disabling it, and how to configure it.'
template: GuideTemplate
freshnessValidatedDate: never
translationType: machine
---

New Relic Kubernetesはデフォルトで**特権モード**で実行され、インフラストラクチャエージェント (DaemonSet サイドカーとして実行) が基盤となるホストの情報に直接アクセスできるようになります。

これは最も完全なテレメトリーを提供しますが、一部のセキュリティ ポリシー (Pod セキュリティ標準や OpenShift 標準的契約条項など) では、ワークロードを**非特権モード**で実行する必要がある場合があります。

## 特権モードが必要な理由

New Relic Infrastructureエージェントは Kubelet ポッドに含まれており、ディープ システム メトリクスを収集するにはノードの OS への低レベルのアクセスが必要です。

[共通ライブラリ](https://github.com/newrelic/helm-charts/blob/master/library/common-library/README.md)の`privileged`のデフォルト値は`false`ですが、このチャートでは、エージェントが次の操作を実行できるように、デフォルトで`true`に設定されています ([`values.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/nri-bundle/values.yaml)を参照)。

* ホストの`/proc`および`/sys`ファイルシステムを読み取ります。
* **基盤となるホスト**の正確な CPU、メモリ、ストレージ、およびネットワーク統計を収集します。
* インフラストラクチャの健全性と Kubernetes オブジェクトを関連付ける完全なプロセス リストとメタデータを収集します。

### 非特権モードで実行

クラスター セキュリティ ポリシーでポッドのセキュリティ コンテキストで`privileged`許可されていない場合は、 `privileged`を`false`に設定して無効にすることができます。

### データ収集への影響

<Callout variant="important">
  特権モードを無効にすると、**ホストレベルのメトリクス**とメタデータが失われます。
</Callout>

特権がないと、インフラストラクチャエージェントはホストのリソース使用状況を確認できません。 次のような標準ホスト メトリクスにアクセスできなくなります。

* **SystemSample:**ホスト レベルの CPU、メモリ、および負荷平均。
* **StorageSample:**ノードのファイルシステムのディスク使用量と I/O。
* **NetworkSample:**物理ネットワーク インターフェイスの統計。
* **ProcessSample:** New Relic コンテナ外で実行されているプロセスに関するデータ。

非特権モードで使用できないプロパティとメトリクスの正確な詳細リストについては、 [Linux エージェントの実行モードのドキュメント](/docs/infrastructure/infrastructure-agent/linux-installation/linux-agent-running-modes/#mode-metrics)を参照してください。

### 設定方法

カスタム値ファイルを更新して、グローバル特権フラグを`false`に設定します。

```yaml
global:
  privileged: false
```

### 非特権モードのWindows

標準のWindowsコンテナは、コンテナが分離されているため、ホストインフラストラクチャに直接アクセスできません。 HostProcess コンテナはこのアクセスを提供できますが、追加のセキュリティ リスクが生じるため、現在New Relic Kubernetesインテグレーションでは使用されていません。 したがって、Windows DaemonSets は非特権モードでのみ実行され、特権モードは Windows ノードではサポートされません。

このモードで収集されるメトリクスの詳細については、 [「 Windows用Kubernetesインテグレーションの制限」を](/docs/kubernetes-pixie/kubernetes-integration/troubleshooting/troubleshooting-windows/#k8-windows-limitations)参照してください。