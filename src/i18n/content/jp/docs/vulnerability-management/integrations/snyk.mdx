---
title: Snyk データを New Relic に送信する
metaDescription: Send your security data from Snyk directly to New Relic.
freshnessValidatedDate: never
translationType: machine
---

このガイドではNew Relic Vulnerability Management（脆弱性管理）を <DNT>Snyk</DNT> Webhook と統合する方法について説明します。 <DNT>Snyk</DNT>の Webhook は、 <DNT>Snyk's Business</DNT>または Enterprise 顧客のみが利用できるベータ機能です。 ベータ機能であるため、 <DNT>Webhook API</DNT>と構造は予告なく変更される可能性があります。セキュリティ プロセスの自動化に Webhook を使用する場合は慎重に行ってください。

<DNT>Snyk Webhooks</DNT>の変更に同期できるよう全力を尽くしますが、同期がとれていないことに気付いた場合はお知らせください。

これらの手順を完了すると、 <DNT>Snyk</DNT>によって検出された新しい脆弱性が New Relic アカウントでリアルタイムに表示され、新しく検出された問題の分析ダッシュボードを構築できるようになります。

詳細については、[公式の<DNT>Snyk</DNT>ドキュメント](https://snyk.docs.apiary.io/#reference/webhooks)を参照してください。

## 前提条件 [#prereqs]

* <DNT>Snyk</DNT> API トークン
* ニューレリック<InlinePopover type="licenseKey"/>
* API経由で Webhook を構成するには、<DNT>Snyk</DNT> 組織アドミニストレーターである必要があります

## Webhook 構成 [#webhook-config]

Webhook を構成するには、次の手順を実行します。

<Steps>
  <Step>
    ### Snyk API トークンを取得する [#snky-API-token]

    Snyk UI のユーザー メニューで、 <DNT>**Account settings**</DNT>をクリックし、 <DNT>Snyk</DNT> API トークン キーをコピーします。 詳細については[、Snyk の公式ドキュメント](https://docs.snyk.io/snyk-admin/snyk-broker/snyk-broker-code-agent/setting-up-the-code-agent-broker-client-deployment/step-1-obtaining-the-required-tokens-for-the-setup-procedure/obtaining-your-snyk-api-token)をご覧ください。
  </Step>

  <Step>
    ### ニューレリック <DNT>**License - Insert**</DNT> [#nr-license-key]

    New Relic アカウントで<DNT>**License - Insert**</DNT> <InlinePopover type="licenseKey"/>を選択するか、新しいアカウントを作成してください。

    <Callout variant="important">
      <DNT>Snyk</DNT>と New Relic キーに加えて、ランダムな署名シークレットを生成する必要があります。 これは Snyk では必須ですが、New Relic ではデータを受信するときに使用されません。
    </Callout>
  </Step>

  <Step>
    ### Snyk 組織 ID をコンパイルする [#sny-org-ids]

    次のコマンドを実行して、アクセスできる<DNT>Snyk</DNT>組織 ID のリストを取得します。

    ```shell
    curl -H "content-type: application/json" \
    -H "authorization: token YOUR_SNYK_API_TOKEN" \
    "https://api.snyk.io/api/v1/orgs" | jq -r '.orgs[] | "\(.id)\t\(.name)"'
    ```

    <Callout variant="important">
      このコマンドを実行するには、コマンドライン JSON プロセッサである [jq](https://stedolan.github.io/jq/)をインストールする必要があります。
    </Callout>
  </Step>

  <Step>
    ### 各 Snyk 組織で Webhook を作成する [#create-webhook]

    <DNT>Snyk</DNT>組織ごとに Webhook を個別に構成する必要があります。

    次のコマンドを実行して、プロジェクトがテストされるたびに New Relic のセキュリティ インジェスト プロセッサにポストする Webhook を作成します。これは、 [project_snapshot](https://snyk.docs.apiary.io/#introduction/consuming-webhooks/event-types) イベント タイプを通じて送信されます。

    ```shell
    curl -X POST -H "content-type: application/json" \
    -H "authorization: token <SNYK_API_TOKEN>" \
    --data '{"url": 
        "https://security-ingest-processor.service.newrelic.com/v1/security/webhooks/snyk?Api-Key=YOUR_NEW_RELIC_LICENSE_KEY",
        "secret": "YOUR_SIGNING_SECRET"}' \
    "https://api.snyk.io/api/v1/org/<SNYK_ORG_ID>/webhooks"
    ```
  </Step>

  <Step>
    ### Webhook 接続をテストする [#confirm-webhook]

    次のコマンドは、組織内で構成されている各 Webhook の Webhook ID と URL を含む結果の配列を返します。

    ```shell
    curl -H "content-type: application/json" \
    -H "authorization: token YOUR_SNYK_API_TOKEN" \
    "https://api.snyk.io/api/v1/org/YOUR_SNYK_ORG_ID/webhooks"
    ```

    Webhook をテストするには、テストする Webhook から ID をコピーし、次のコマンドを実行します。

    ```shell
    curl -X POST --data "" -H "content-type: application/json" \
    -H "authorization: token YOUR_SNYK_API_TOKEN" \
    "https://api.snyk.io/api/v1/org/YOUR_SNYK_ORG_ID/webhooks/YOUR_WEBHOOK_ID/ping"
    ```

    Webhook が正しく設定されている場合、コマンドは `OK` を返します。
  </Step>
</Steps>

## Webhook を手動でテストする [#webhook-test]

New Relic にデータを流すには、 <DNT>Snyk</DNT>内のプロジェクトの手動スキャンをトリガーする必要がある場合があります。 これは、 <DNT>Snyk</DNT> CLI または API を介して、またはプロジェクト内のスキャン ターゲットで<DNT>**Retest now**</DNT>をクリックして<DNT>Snyk</DNT> UI から実行できます。

[手動テストの実行](https://docs.snyk.io/getting-started/running-tests#run-tests-manually)については、公式の<DNT>Snyk</DNT>ドキュメントを確認してください。

<img
  title="Test a webhook manually"
  alt="Test a webhook manually"
  src="/images/vulnerability-management_screenshot-crop_test-webhook.webp"
/>

<figcaption>
  プロジェクト内のスキャン ターゲットで<DNT>**Retest now**</DNT>をクリックします。
</figcaption>

## Snyk データが New Relic に送信されていることを確認する [#verify-snyk-sending]

New Relic のログをチェックして、 `logtype:security`と入力してセキュリティ イベントをフィルター処理し、手動テストからの<DNT>Snyk</DNT>検出結果が正常に配信されたことを確認します。

1. <DNT>**[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Logs**</DNT>に移動します。
2. 検索バーに`logtype:security`と入力し、 <DNT>**Query logs**</DNT>をクリックします。

<img
  title="Logs screen"
  alt="Logs screen"
  src="/images/vulnerability-management_screenshot-crop_verify-snyk-data.webp"
/>

<figcaption>
  <DNT>
    **[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Logs**
  </DNT>
</figcaption>

Snyk Webhook トランスポートは、各テストで発生する<DNT>**New Issues**</DNT>と<DNT>**Removed Issues**</DNT>のみを返します。 New Relic は<DNT>**New Issues**</DNT>のみを解析します。 手動テストで新しい問題が見つからない場合、New Relic に新しいセキュリティ ログは表示されません。 この場合、 New Relicには、成功した Webhook トランスポートに関する次のようなログメッセージが表示されます。

```sql
SnykWebhook scan reported 879 byte payload with 0 events (0 unique issue ids) from '' errors=no
```

## New Relic で Snyk データを表示する [#view-data-NR]

1 つ以上の Webhook イベントを構成すると、New Relic のセキュリティ取り込みエンドポイントに送信されている<DNT>Snyk</DNT> Webhook の結果を表示できます。

New Relic で<DNT>Snyk</DNT>データを識別するために使用できる 3 つの方法を確認してください。

### 脆弱性管理でのデータの表示 [#view-data]

このページは<DNT>**[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Vulnerability Management**</DNT>にあります。

このビューでは、 <DNT>Snyk</DNT>統合から消費されたデータを含む、すべてのソフトウェアの脆弱性を俯瞰的に見ることができます。 さまざまなタブを使用して、脆弱性を特定し、優先順位付けします。

<img
  title="Vulnerability management screen"
  alt="Vulnerability management screen"
  src="/images/accounts_screenshot-full_vm-landing.webp"
/>

<figcaption>
  <DNT>**[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Vulnerability Management**</DNT>。
</figcaption>

### 脆弱性イベントのクエリ [#query-vuln-events]

<DNT>Snyk</DNT>イベントが処理されると、 <DNT>**Vulnerability**</DNT>テーブルに保存されます。 このテーブルをクエリして生データを表示するには、次の手順を実行します。

1. <DNT>**[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Query your data**</DNT>に移動します。

2. 次のクエリを入力します。

   ```sql
   FROM Vulnerability SELECT * where source = 'Snyk' since 7 days ago
   ```

   <img
     title="Query vulnerability events"
     alt="Query vulnerability events"
     src="/images/vulnerability-management_screenshot-full_query-vuln-events.webp"
   />

   <figcaption>
     <DNT>
       **[one.newrelic.com](https://one.newrelic.com) &amp;gt; All capabilities &amp;gt; Query your data**
     </DNT>
   </figcaption>

### Snyk ダッシュボード [#snyk-dashboard]

[New Relic Instant observability マーケットプレイス](https://newrelic.com/instant-observability/snyk)から、事前構築済みの <DNT>Snyk</DNT> ダッシュボードをインストールできます。

このダッシュボードは、脆弱性データの別のビューを提供し、グラフ ウィジェットを使用して、Snyk 統合データから独自のダッシュボード ビューを作成できます。

<img
  title="Snyk dashboard"
  alt="Snyk dashboard"
  src="/images/vm_screenshot-full_snyk-dashboard.webp"
/>

<figcaption>
  [Instant Observability Snyk ダッシュボード](https://newrelic.com/instant-observability/snyk)をインストールします。
</figcaption>
