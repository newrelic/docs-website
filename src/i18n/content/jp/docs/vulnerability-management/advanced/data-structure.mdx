---
title: セキュリティデータ構造（NRQLリファレンス）
metaDescription: Learn about the data structure and entity types used to store security data in New Relic.
freshnessValidatedDate: never
translationType: machine
---

Security RX は、脆弱性と構成ミスのデータを New Relic のデータベース (NRDB) に保存し、NRQL を使用してクエリできるようにします。このリファレンス ガイドでは、カスタム クエリ、ダッシュボード、アラートの構築に使用できるエンティティ タイプ、属性、およびデータ構造について説明します。

## エンティティとイベントの種類

Security RX は、セキュリティ データを保存するために次のエンティティおよびイベント タイプを使用します。

### SecurityFindingエンティティ（推奨）

`SECURITY_FINDING`は、Security RX によって検出されたすべてのセキュリティ問題の汎用コンテナとして機能する特殊なエンティティ タイプです。これは、New Relic でセキュリティ データをクエリするための推奨される方法です。

**重要:** SecurityFinding は、従来のイベントではなく、エンティティ タイプとしてクエリされます。

```sql
FROM Entity
SELECT * WHERE type = 'SECURITY_FINDING'
```

#### findingTypeの理解

`findingType`属性は、データ ソースを区別するためのキー フィールドです。

* **`findingType = 'VULNERABILITY'`** : APMエージェント、インフラストラクチャーエージェント、サードパーティスキャナー（ Snyk 、Trivy、FOSSA）などの情報源からの脆弱性の発見を示します。
* **`findingType = 'MISCONFIGURATION'`** : Security RX Cloud (AWS Security Hub、GuardDuty、Config など) からのcloudセキュリティ ポスチャ管理 (CSPM) の検出結果を示します。

その他の findingType 値には、 `LIBRARY_VULNERABILITY` 、 `INFRASTRUCTURE_VULNERABILITY` 、 `APPLICATION_VULNERABILITY` 、 `SYSTEM_VULNERABILITY` 、 `SECURITY_EVENT` 、 `OTHER`などがあります。

#### コアエンティティフィールド

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        例
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `id`
      </td>

      <td>
        弦
      </td>

      <td>
        この SecurityFinding のグローバルに一意の識別子 (ターゲット固有の CVE および影響を受けるエンティティ)
      </td>

      <td>
        「ABC123…」
      </td>
    </tr>

    <tr>
      <td>
        `type`
      </td>

      <td>
        弦
      </td>

      <td>
        エンティティタイプ - 常に「SECURITY_FINDING」
      </td>

      <td>
        「SECURITY_FINDING」
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        弦
      </td>

      <td>
        脆弱性または構成ミスのタイトル
      </td>

      <td>
        「CVE-2024-12345: ライブラリ名内の SQL インジェクション」
      </td>
    </tr>

    <tr>
      <td>
        `scope.id`
      </td>

      <td>
        弦
      </td>

      <td>
        この検出が検出されたアカウントID
      </td>

      <td>
        「1234567」
      </td>
    </tr>

    <tr>
      <td>
        `scope.type`
      </td>

      <td>
        弦
      </td>

      <td>
        スコープタイプ - 通常は「ACCOUNT」
      </td>

      <td>
        &quot;ACCOUNT&quot;
      </td>
    </tr>

    <tr>
      <td>
        `metadata.createdAt`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        このエンティティが作成された時期
      </td>

      <td>
        Unix タイムスタンプ
      </td>
    </tr>

    <tr>
      <td>
        `metadata.updatedAt`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        このエンティティが最後に更新された日時
      </td>

      <td>
        Unix タイムスタンプ
      </td>
    </tr>

    <tr>
      <td>
        `tags`
      </td>

      <td>
        配列
      </td>

      <td>
        エンティティに適用可能なタグのリスト（通常、SecurityFinding の場合は空）
      </td>

      <td>
        \[]
      </td>
    </tr>
  </tbody>
</table>

#### 分類分野

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        例
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `vulnerabilityIdentifier`
      </td>

      <td>
        弦
      </td>

      <td>
        「SecurityFindings」を集約するための識別子（通常はCVE ID）
      </td>

      <td>
        「CVE-2024-12345」
      </td>
    </tr>

    <tr>
      <td>
        `findingType`
      </td>

      <td>
        弦
      </td>

      <td>
        最上位レベルの検出結果の種類
      </td>

      <td>
        &quot;VULNERABILITY&quot;, &quot;MISCONFIGURATION&quot;
      </td>
    </tr>

    <tr>
      <td>
        `findingSubType`
      </td>

      <td>
        弦
      </td>

      <td>
        サブタイプ（APM 脆弱性の場合は言語、インフラストラクチャの場合は INFRA_OS_VULNERABILITY または INFRA_PACKAGE_VULNERABILITY）
      </td>

      <td>
        &quot;java&quot;, &quot;INFRA_PACKAGE_VULNERABILITY&quot;
      </td>
    </tr>

    <tr>
      <td>
        `source`
      </td>

      <td>
        弦
      </td>

      <td>
        発見の出典
      </td>

      <td>
        「New Relic」、「Snyk」、「AWS セキュリティハブ」
      </td>
    </tr>
  </tbody>
</table>

#### ステータスと重大度フィールド

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        価値観
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `severity`
      </td>

      <td>
        弦
      </td>

      <td>
        報告された所見の重症度
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;, &quot;UNKNOWN&quot;, &quot;INFO&quot;
      </td>
    </tr>

    <tr>
      <td>
        `status`
      </td>

      <td>
        弦
      </td>

      <td>
        調査結果の現状
      </td>

      <td>
        &quot;AFFECTED&quot;, &quot;IGNORED&quot;, &quot;NO_LONGER_DETECTED&quot;, &quot;UNKNOWN&quot;
      </td>
    </tr>

    <tr>
      <td>
        `remediation.remediationExists`
      </td>

      <td>
        ブール値
      </td>

      <td>
        改善策が存在するかどうか
      </td>

      <td>
        true, false
      </td>
    </tr>

    <tr>
      <td>
        `remediation.upgradeAction`
      </td>

      <td>
        弦
      </td>

      <td>
        Security RXの推奨アップグレード
      </td>

      <td>
        「バージョン2.17.1にアップグレード」
      </td>
    </tr>

    <tr>
      <td>
        `remediation.remediationDetails`
      </td>

      <td>
        弦
      </td>

      <td>
        ソースからの簡単な修復テキスト
      </td>

      <td>
        「ライブラリをパッチ適用バージョンに更新する」
      </td>
    </tr>

    <tr>
      <td>
        `remediation.url`
      </td>

      <td>
        弦
      </td>

      <td>
        ソースからのドキュメントURL
      </td>

      <td>
        「 

        [https://example.com/security-advisory](https://example.com/security-advisory)

         」
      </td>
    </tr>
  </tbody>
</table>

#### CVE参照フィールド

脆弱性の検出については、 `cve`オブジェクトに詳細な CVE 情報が含まれます。

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `cve.id`
      </td>

      <td>
        弦
      </td>

      <td>
        CVE識別子
      </td>
    </tr>

    <tr>
      <td>
        `cve.description`
      </td>

      <td>
        弦
      </td>

      <td>
        CVEの説明
      </td>
    </tr>

    <tr>
      <td>
        `cve.cvssScore`
      </td>

      <td>
        数
      </td>

      <td>
        CVSSスコア
      </td>
    </tr>

    <tr>
      <td>
        `cve.cvssVector`
      </td>

      <td>
        弦
      </td>

      <td>
        CVSSベクトル文字列
      </td>
    </tr>

    <tr>
      <td>
        `cve.epssScore`
      </td>

      <td>
        数
      </td>

      <td>
        EPSSエクスプロイト確率スコア
      </td>
    </tr>

    <tr>
      <td>
        `cve.epssPercentile`
      </td>

      <td>
        数
      </td>

      <td>
        EPSSパーセンタイルランキング
      </td>
    </tr>

    <tr>
      <td>
        `cve.exploitKnown`
      </td>

      <td>
        ブール値
      </td>

      <td>
        既知の脆弱性が存在するかどうか
      </td>
    </tr>

    <tr>
      <td>
        `cve.disclosureUrl`
      </td>

      <td>
        弦
      </td>

      <td>
        CVEが公開されたURL
      </td>
    </tr>

    <tr>
      <td>
        `cve.disclosedAt`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        CVEが公開されたとき
      </td>
    </tr>
  </tbody>
</table>

#### 誤った設定フィールド（クラウドの検出結果）

構成ミスの検出結果については、 `misconfiguration`オブジェクトにクラウド固有の情報が含まれます。

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `misconfiguration.cloudProvider`
      </td>

      <td>
        弦
      </td>

      <td>
        クラウドプロバイダー
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.issueTitle`
      </td>

      <td>
        弦
      </td>

      <td>
        誤った設定のタイトル
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.misconfigurationType`
      </td>

      <td>
        弦
      </td>

      <td>
        ソースからの生の検出タイプ
      </td>
    </tr>

    <tr>
      <td>
        `misconfiguration.normalizedResourceType`
      </td>

      <td>
        弦
      </td>

      <td>
        簡略化されたリソースタイプ（例：「S3」、「EC2」、「RDS」）
      </td>
    </tr>
  </tbody>
</table>

#### 影響を受けるエンティティフィールド

`impactedEntity`オブジェクトは、影響を受ける New Relic エンティティを識別します。

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `impactedEntity.id`
      </td>

      <td>
        弦
      </td>

      <td>
        エンティティGUID
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.name`
      </td>

      <td>
        弦
      </td>

      <td>
        エンティティ名
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.type`
      </td>

      <td>
        弦
      </td>

      <td>
        エンティティ タイプ (APM-APPLICATION, INFRA-HOST など)
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.scope.id`
      </td>

      <td>
        弦
      </td>

      <td>
        アカウントID
      </td>
    </tr>

    <tr>
      <td>
        `impactedEntity.scope.type`
      </td>

      <td>
        弦
      </td>

      <td>
        スコープタイプ
      </td>
    </tr>
  </tbody>
</table>

#### タイムスタンプフィールド

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `firstDetected`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        発見が最初に発見されたとき
      </td>
    </tr>

    <tr>
      <td>
        `findingUpdatedAt`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        調査結果が最後に更新された日時
      </td>
    </tr>

    <tr>
      <td>
        `lastSeen`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        発見が最後にアクティブであったことがわかった時期
      </td>
    </tr>
  </tbody>
</table>

#### UIと内部フィールド

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `vulnerabilityUILinks.detailsUrl`
      </td>

      <td>
        弦
      </td>

      <td>
        Security RX UI の詳細ページへのリンク
      </td>
    </tr>

    <tr>
      <td>
        `vulnerabilityUILinks.tabUrl`
      </td>

      <td>
        弦
      </td>

      <td>
        Security RX UI のエンティティ ビューへのリンク
      </td>
    </tr>

    <tr>
      <td>
        `internalState.status`
      </td>

      <td>
        弦
      </td>

      <td>
        内部ステータスフィールド
      </td>
    </tr>

    <tr>
      <td>
        `internalState.active`
      </td>

      <td>
        ブール値
      </td>

      <td>
        内部アクティブフラグ (cloudで使用)
      </td>
    </tr>

    <tr>
      <td>
        `entityLookupValue`
      </td>

      <td>
        弦
      </td>

      <td>
        内部フィールド（本番環境では非表示になります）
      </td>
    </tr>

    <tr>
      <td>
        `issueInstanceKey`
      </td>

      <td>
        弦
      </td>

      <td>
        内部フィールド（本番環境では非表示になります）
      </td>
    </tr>

    <tr>
      <td>
        `additionalInfo`
      </td>

      <td>
        オブジェクトの配列
      </td>

      <td>
        キーの値ペアを含む追加のメタデータ (cloudアカウント ID などに使用)
      </td>
    </tr>
  </tbody>
</table>

<Callout variant="tip">
  「内部」としてマークされたフィールドは現在 NRDB に表示されますが、最終リリース時には非表示になる可能性があります。 `internalState.active`フィールドは、アクティブな検出結果をフィルター処理するために、 cloud誤った構成のクエリでよく使用されます。
</Callout>

#### 脆弱性のクエリ例

**エンティティごとにアクティブな重大な脆弱性をカウントします。**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND severity = 'CRITICAL'
FACET impactedEntity.name
```

**特定の CVE の影響を受けるエンティティを検索します。**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
  AND cve.id = 'CVE-2024-23944'
FACET impactedEntity.name
```

**アクティブなランサムウェア キャンペーンの CVE を検索します。**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.exploitKnown IS true
FACET impactedEntity.name, cve.id
```

**悪用される可能性のある脆弱性を見つける（EPSS スコアが高い）:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND cve.epssPercentile > '0.95'
FACET cve.id
```

**調査結果の報告元を探す:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
FACET source
```

**脆弱性閾値が高いエンティティ:**

```sql
SELECT impactedEntity
FROM (
  SELECT count(*) AS vulnerableCount
  FROM Entity
  WHERE type = 'SECURITY_FINDING'
    AND severity IN ('CRITICAL', 'HIGH')
  FACET impactedEntity.name AS impactedEntity, severity
)
WHERE (severity = 'HIGH' AND vulnerableCount > 10)
   OR (severity = 'CRITICAL' AND vulnerableCount > 5)
```

#### cloudの構成ミスの例

**ステータス別に固有の誤った構成をカウントします。**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET status
```

**最も一般的な構成ミスの上位 10 種類:**

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.issueTitle
LIMIT 10
```

**最もリスクの高い AWS アカウントを見つける:**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity IN ('CRITICAL', 'HIGH')
FACET aparse(additionalInfo, '%"key":"cloudProviderAccountId","values":["*"]%') AS 'AWS Account ID'
LIMIT 10
```

**リソースタイプ別に誤った構成をカウントします。**

```sql
FROM Entity
SELECT uniqueCount(misconfiguration.issueTitle)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
FACET misconfiguration.normalizedResourceType
```

**重要な公開リソースを見つけます:**

```sql
FROM Entity
SELECT name, impactedEntity.name, misconfiguration.misconfigurationType
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
  AND internalState.active = true
  AND severity = 'CRITICAL'
  AND misconfiguration.misconfigurationType LIKE 'Effects/Data Exposure'
SINCE 1 day ago
```

### NrAiIncident（レガシー）

脆弱性の発見とその現在のステータスを保存するレガシー イベント タイプ。このイベント タイプは下位互換性のために引き続きサポートされていますが、新しいクエリには`SecurityFinding`を使用することをお勧めします。

**主な用途：**エンティティに影響を与える書き込み脆弱性

**主な属性:**

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        例
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `title`
      </td>

      <td>
        弦
      </td>

      <td>
        脆弱性のタイトル
      </td>

      <td>
        「CVE-2024-12345: ライブラリ名内の SQL インジェクション」
      </td>
    </tr>

    <tr>
      <td>
        `priority`
      </td>

      <td>
        弦
      </td>

      <td>
        計算された優先順位
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;
      </td>
    </tr>

    <tr>
      <td>
        `state`
      </td>

      <td>
        弦
      </td>

      <td>
        現在の脆弱性の状態
      </td>

      <td>
        &quot;OPEN&quot;, &quot;CLOSED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `acknowledged`
      </td>

      <td>
        ブール値
      </td>

      <td>
        脆弱性が検討されているかどうか
      </td>

      <td>
        `true`, `false`
      </td>
    </tr>

    <tr>
      <td>
        `conditionName`
      </td>

      <td>
        弦
      </td>

      <td>
        検出源/条件
      </td>

      <td>
        「 Security RX - 脆弱性検知」
      </td>
    </tr>

    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        弦
      </td>

      <td>
        脆弱性の影響を受けるエンティティ GUID
      </td>

      <td>
        「ABC123…」
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        弦
      </td>

      <td>
        エンティティ名
      </td>

      <td>
        &quot;my-application&quot;
      </td>
    </tr>

    <tr>
      <td>
        `entityType`
      </td>

      <td>
        弦
      </td>

      <td>
        影響を受けるエンティティの種類
      </td>

      <td>
        &quot;APPLICATION&quot;, &quot;HOST&quot;
      </td>
    </tr>
  </tbody>
</table>

**クエリの例：**

```sql
FROM NrAiIncident
SELECT count(*)
WHERE conditionName LIKE '%Security RX%'
FACET priority, state
```

### 脆弱性（カスタムイベント）

CVE 情報、重大度スコア、修復ガイダンスなどの詳細な脆弱性メタデータを保存します。

**主な用途:**脆弱性の詳細とメタデータの詳細な調査

**主な属性:**

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        例
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `cveId`
      </td>

      <td>
        弦
      </td>

      <td>
        CVE識別子
      </td>

      <td>
        「CVE-2024-12345」
      </td>
    </tr>

    <tr>
      <td>
        `severity`
      </td>

      <td>
        弦
      </td>

      <td>
        CVSSベースの重大度
      </td>

      <td>
        &quot;CRITICAL&quot;, &quot;HIGH&quot;, &quot;MEDIUM&quot;, &quot;LOW&quot;
      </td>
    </tr>

    <tr>
      <td>
        `cvssScore`
      </td>

      <td>
        数
      </td>

      <td>
        CVSS数値スコア
      </td>

      <td>
        9.8
      </td>
    </tr>

    <tr>
      <td>
        `epssScore`
      </td>

      <td>
        数
      </td>

      <td>
        EPSSの悪用確率
      </td>

      <td>
        0.95
      </td>
    </tr>

    <tr>
      <td>
        `epssPercentile`
      </td>

      <td>
        数
      </td>

      <td>
        EPSSパーセンタイルランキング
      </td>

      <td>
        98.5
      </td>
    </tr>

    <tr>
      <td>
        `activeRansomware`
      </td>

      <td>
        ブール値
      </td>

      <td>
        既知のランサムウェアキャンペーンで使用
      </td>

      <td>
        `true`, `false`
      </td>
    </tr>

    <tr>
      <td>
        `affectedPackage`
      </td>

      <td>
        弦
      </td>

      <td>
        脆弱なライブラリ/パッケージ名
      </td>

      <td>
        「log4j-core」
      </td>
    </tr>

    <tr>
      <td>
        `affectedVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        脆弱なパッケージのバージョン
      </td>

      <td>
        「2.14.0」
      </td>
    </tr>

    <tr>
      <td>
        `fixedVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        修正版
      </td>

      <td>
        「2.17.1」
      </td>
    </tr>

    <tr>
      <td>
        `entityGuid`
      </td>

      <td>
        弦
      </td>

      <td>
        影響を受けるエンティティのGUID
      </td>

      <td>
        「ABC123…」
      </td>
    </tr>

    <tr>
      <td>
        `source`
      </td>

      <td>
        弦
      </td>

      <td>
        検出源
      </td>

      <td>
        &quot;APM\_AGENT&quot;, &quot;SNYK&quot;, &quot;AWS\_SECURITY\_HUB&quot;
      </td>
    </tr>
  </tbody>
</table>

**クエリの例：**

```sql
FROM Vulnerability
SELECT count(*)
WHERE severity = 'CRITICAL'
AND activeRansomware = true
FACET affectedPackage
```

### NrAiIncidentTimeline

脆弱性のステータスの変更とライフサイクル イベントを追跡します。

**主な用途:**脆弱性のステータス履歴を監査し、修復の進捗状況を追跡する

**主な属性:**

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        タイプ
      </th>

      <th>
        説明
      </th>

      <th>
        例
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `incidentId`
      </td>

      <td>
        弦
      </td>

      <td>
        関連インシデント/脆弱性ID
      </td>

      <td>
        「INC-123」
      </td>
    </tr>

    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        タイムスタンプ
      </td>

      <td>
        ステータスが変更されたとき
      </td>

      <td>
        Unix タイムスタンプ
      </td>
    </tr>

    <tr>
      <td>
        `event`
      </td>

      <td>
        弦
      </td>

      <td>
        変更の種類
      </td>

      <td>
        &quot;STATUS\_CHANGED&quot;, &quot;DETECTED&quot;, &quot;RESOLVED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `previousState`
      </td>

      <td>
        弦
      </td>

      <td>
        変更前の状態
      </td>

      <td>
        &quot;AFFECTED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `newState`
      </td>

      <td>
        弦
      </td>

      <td>
        変更後の状態
      </td>

      <td>
        &quot;IGNORED&quot;
      </td>
    </tr>

    <tr>
      <td>
        `changedBy`
      </td>

      <td>
        弦
      </td>

      <td>
        変更を行ったユーザー
      </td>

      <td>
        「 [user@example.com](mailto:user@example.com) 」
      </td>
    </tr>

    <tr>
      <td>
        `reason`
      </td>

      <td>
        弦
      </td>

      <td>
        ステータス変更の理由
      </td>

      <td>
        「誤検知 - 脆弱なコードパスを使用していない」
      </td>
    </tr>
  </tbody>
</table>

**クエリの例：**

```sql
FROM NrAiIncidentTimeline
SELECT timestamp, event, previousState, newState, changedBy
WHERE event = 'STATUS_CHANGED'
SINCE 7 days ago
```

## イベントタイプに共通する属性

これらの属性は複数のイベント タイプにわたって表示されます。

### エンティティ識別

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        影響を受けるエンティティの一意の識別子
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        人間が読めるエンティティ名
      </td>
    </tr>

    <tr>
      <td>
        `entity.type`
      </td>

      <td>
        エンティティタイプ（APPLICATION, HOST, SERVICE）
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        New RelicアカウントID
      </td>
    </tr>
  </tbody>
</table>

### タイムスタンプ

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `timestamp`
      </td>

      <td>
        イベントが発生したとき
      </td>
    </tr>

    <tr>
      <td>
        `detectedAt`
      </td>

      <td>
        脆弱性が最初に検出されたとき
      </td>
    </tr>

    <tr>
      <td>
        `updatedAt`
      </td>

      <td>
        最終更新タイムスタンプ
      </td>
    </tr>

    <tr>
      <td>
        `resolvedAt`
      </td>

      <td>
        脆弱性が解決されたとマークされたとき
      </td>
    </tr>
  </tbody>
</table>

### ソース追跡

<table>
  <thead>
    <tr>
      <th>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `source`
      </td>

      <td>
        データソース (APM\_AGENT, INFRASTRUCTURE, SNYK, など)
      </td>
    </tr>

    <tr>
      <td>
        `sourceId`
      </td>

      <td>
        ソースシステムからの固有ID
      </td>
    </tr>

    <tr>
      <td>
        `integrationName`
      </td>

      <td>
        データを提供したインテグレーション
      </td>
    </tr>
  </tbody>
</table>

## データ関係

データ型が互いにどのように関連しているかを理解する:

### 現代的なアプローチ（推奨）

```
SecurityFinding Entity (type = 'SECURITY_FINDING')
    ↓ contains
    ├─ findingType (VULNERABILITY or MISCONFIGURATION)
    ├─ cve (CVE details for vulnerabilities)
    ├─ misconfiguration (Cloud security details)
    └─ impactedEntity (Affected New Relic entity)
```

### レガシーアプローチ（下位互換性）

```
Entity (Application/Host)
    ↓ has many
NrAiIncident (Active vulnerabilities)
    ↓ references
Vulnerability (CVE details)
    ↓ has many
NrAiIncidentTimeline (Status history)
```

## クエリパターン

<Callout variant="tip">
  **推奨:**新しい実装には、 `SecurityFinding`エンティティ クエリ (上記の SecurityFinding セクションに表示) を使用します。以下のパターンはレガシー イベント タイプを使用しており、下位互換性のみを目的として提供されています。
</Callout>

### 最新のクエリパターン

SecurityFinding エンティティを使用した最新の書き込みパターンについては、[上記の書き込み例のセクションを](#query-examples-for-vulnerabilities)参照してください。

### レガシークエリパターン

これらのパターンでは、レガシー イベント タイプを使用します。

#### エンティティデータと脆弱性を結合する（レガシー）

```sql
FROM NrAiIncident
SELECT entity.name, count(*) as 'Vulnerability Count'
WHERE conditionName LIKE '%Security RX%'
AND state = 'OPEN'
FACET entity.name
SINCE 1 day ago
```

**現代の同等語:**

```sql
FROM Entity
SELECT impactedEntity.name, count(*) as 'Vulnerability Count'
WHERE type = 'SECURITY_FINDING'
  AND status = 'AFFECTED'
FACET impactedEntity.name
SINCE 1 day ago
```

#### 露出ウィンドウを計算する（レガシー）

```sql
FROM Vulnerability
SELECT entity.name,
       cveId,
       (max(timestamp) - min(timestamp)) / 86400 as 'Days Exposed'
WHERE severity IN ('CRITICAL', 'HIGH')
FACET entity.name, cveId
SINCE 30 days ago
```

**現代の同等語:**

```sql
FROM Entity
SELECT impactedEntity.name,
       cve.id,
       (max(findingUpdatedAt) - min(firstDetected)) / 86400 as 'Days Exposed'
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
FACET impactedEntity.name, cve.id
SINCE 30 days ago
```

#### 修復速度を追跡する（レガシー）

```sql
FROM NrAiIncidentTimeline
SELECT count(*) as 'Vulnerabilities Resolved'
WHERE event = 'STATUS_CHANGED'
AND newState = 'CLOSED'
FACET weekOf(timestamp)
SINCE 90 days ago
```

<Callout variant="important">
  SecurityFinding エンティティを使用してステータスの変化を追跡するには、時間の経過に伴う`status`フィールドの変化を監視するか、 New Relicアラートを使用してステータスの変化が発生したときに通知を受け取ります。
</Callout>

## 属性の種類と形式

### 重大度値

```
CRITICAL - CVSS 9.0-10.0
HIGH     - CVSS 7.0-8.9
MEDIUM   - CVSS 4.0-6.9
LOW      - CVSS 0.1-3.9
INFO     - CVSS 0.0
```

### 州の価値

```
OPEN      - Vulnerability currently active
CLOSED    - Vulnerability resolved or fixed
AFFECTED  - Entity is confirmed affected
IGNORED   - Marked as not applicable
NO_LONGER_DETECTED - No longer seen in scans
```

### ソース値

```
APM_AGENT            - Detected by New Relic APM agent
INFRASTRUCTURE       - Detected by Infrastructure agent
SNYK                 - Imported from Snyk
AWS_SECURITY_HUB     - Imported from AWS Security Hub
DEPENDABOT           - Imported from GitHub Dependabot
FOSSA                - Imported from FOSSA
TRIVY                - Imported from Trivy
SECURITY_DATA_API    - Sent via API
```

## クエリのヒント

### 重大度によるフィルタリング（最新のアプローチ）

調査結果は重大度に基づいて優先順位が付けられます。

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND severity IN ('CRITICAL', 'HIGH')
  AND status = 'AFFECTED'
FACET impactedEntity.name
```

### 検索結果の種類で絞り込む

脆弱性と誤った構成を区別する:

```sql
-- Vulnerabilities only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'VULNERABILITY'
FACET impactedEntity.type

-- Misconfigurations only
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND findingType = 'MISCONFIGURATION'
FACET misconfiguration.normalizedResourceType
```

### エンティティタイプでフィルタリング

アプリケーションとインフラストラクチャの脆弱性を分離する:

```sql
-- Application vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%APPLICATION%'
FACET impactedEntity.name

-- Infrastructure vulnerabilities
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND impactedEntity.type LIKE '%HOST%'
FACET impactedEntity.name
```

### 検出元でフィルタリング

特定の統合から得られた発見:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND source = 'Snyk'
FACET severity
```

### 時間ベースのフィルタリング

最近検出された結果を検索:

```sql
FROM Entity
SELECT count(*)
WHERE type = 'SECURITY_FINDING'
  AND firstDetected > ago(7 days)
FACET cve.id, severity
```

## カスタムダッシュボードの構築

SecurityFinding エンティティを使用して、包括的なセキュリティ ダッシュボードを作成します。

1. **エグゼクティブ ダッシュボード**- すべての検出タイプにわたる高レベルのセキュリティ メトリクス

   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET severity, findingType
   ```

2. **脆弱性の傾向**- 脆弱性の検出を長期的に追跡します

   ```sql
   FROM Entity
   SELECT count(*)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'VULNERABILITY'
   FACET weekOf(firstDetected)
   SINCE 90 days ago
   ```

3. **クラウドのセキュリティ体制**- cloud構成ミスを監視する

   ```sql
   FROM Entity
   SELECT uniqueCount(misconfiguration.issueTitle)
   WHERE type = 'SECURITY_FINDING'
     AND findingType = 'MISCONFIGURATION'
   FACET misconfiguration.cloudProvider, severity
   ```

4. **エンティティ セキュリティ体制**- エンティティごとのセキュリティ ビュー

   ```sql
   FROM Entity
   SELECT count(*) AS 'Findings'
   WHERE type = 'SECURITY_FINDING'
     AND status = 'AFFECTED'
   FACET impactedEntity.name, severity
   ```

その他のクエリ例については、 [「セキュリティ データ クエリの例」を](/docs/vulnerability-management/advanced/query-examples)参照してください。

### レガシーダッシュボードの取り組み

下位互換性を確保するために、レガシー イベント タイプ (`NrAiIncident` 、 `Vulnerability` 、 `NrAiIncidentTimeline`) を引き続き使用できますが、新しいダッシュボードについては SecurityFinding エンティティに移行することをお勧めします。

## 次は何ですか？

<DocTiles>
  <DocTile title="クエリの例" path="/docs/vulnerability-management/advanced/query-examples">
    一般的なセキュリティシナリオですぐに使用できる NRQL クエリ
  </DocTile>

  <DocTile title="アラートの設定" path="/docs/vulnerability-management/advanced/set-up-alerts">
    脆弱性に関するNRQLベースのアラートを作成する
  </DocTile>

  <DocTile title="脆弱性ステータスの管理" path="/docs/vulnerability-management/advanced/manage-vulnerability-status">
    脆弱性のステータスを変更し、修復を追跡する
  </DocTile>
</DocTiles>