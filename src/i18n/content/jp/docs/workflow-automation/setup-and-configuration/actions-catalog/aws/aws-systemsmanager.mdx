---
title: AWS Systems Manager のアクション
tags:
  - workflow automation
  - workflow
  - workflow automation actions
  - AWS actions
  - AWS Systems Manager actions
metaDescription: A list of available aws systems manager actions in the actions catalog for workflow definitions
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

このページでは、ワークフロー自動化アクション カタログで使用できる AWS Systems Manager アクションの包括的なリファレンスを提供します。これらのアクションにより、システム管理の自動化と操作の文書化が可能になります。

## 前提条件

ワークフロー自動化で AWS アクションを使用する前に、次の点を確認してください。

* 適切な権限を持つ AWS アカウント。
* 設定された AWS 認証情報 (IAM ユーザー認証情報、IAM ロール ARN、またはセッション認証情報)。
* 使用する予定の特定のAWSサービスに必要な IAM 権限。

IAM ユーザーおよび IAM ロールを作成する方法、およびワークフロー オートメーションAWSアクションと統合するための静的 AWS 認証情報とセッションAWS認証情報を設定する方法については[、「 AWS認証情報のセットアップ」を](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/)参照してください。

<CollapserGroup>
  <Collapser id="aws-systemsmanager.writedocument" title="SSMドキュメントをAWSに書き込む">
    アクション入力で渡された AWS 認証情報に基づいて、SSM ドキュメントをAWSアカウントに書き込みます。 [AWS Systems Manager のドキュメントを](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway)参照してください

    <Tabs>
      <TabsBar>
        <TabsBarItem id="writedocumentinputs">
          入力
        </TabsBarItem>

        <TabsBarItem id="writedocumentoutputs">
          出力
        </TabsBarItem>

        <TabsBarItem id="writedocumentexample">
          例
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="writedocumentinputs">
          <table>
            <thead>
              <tr>
                <th>
                  入力フィールド
                </th>

                <th>
                  オプション性
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **リージョン**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentType: "Command"`

                  [ここ](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of)から有効な値を確認してください。
                </td>
              </tr>

              <tr>
                <td>
                  **documentFormat**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentFormat: "YAML"`

                  [ここ](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of)から有効な値を確認してください。
                </td>
              </tr>

              <tr>
                <td>
                  **documentContent**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  例を確認する
                </td>
              </tr>

              <tr>
                <td>
                  **override**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  ブール値
                </td>

                <td>
                  `override: true (default)`。

                  `true`の場合、既に存在する場合でも、指定された名前でドキュメントを常に書き込みます。

                  `false`の場合、指定された`documentName`を持つドキュメントがすでに存在する場合、アクションは`success: false`を返し、 `errorMessage: Document already exists. Please enable override if you want to update the existing document.`
                </td>
              </tr>

              <tr>
                <td>
                  **セレクター**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  リスト
                </td>

                <td>
                  `[{\"name\": \"documentName\", \"expression\": \".documentName\"}, {\"name\": \"documentType\", \"expression\": \".documentType\"}, {\"name\": \"documentStatus\", \"expression\": \".documentStatus\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="writedocumentoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  出力フィールド
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  説明と例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentVersion**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentVersion: 1`
                </td>
              </tr>

              <tr>
                <td>
                  **documentType**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentType: "Command"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentStatus**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentStatus: "Active"`

                  値は[ここ](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_DocumentDescription.html#systemsmanager-Type-DocumentDescription-Status:text=Required%3A%20No-,Status,-The%20status%20of)からのステータスのいずれかになります。
                </td>
              </tr>

              <tr>
                <td>
                  **成功**
                </td>

                <td>
                  ブール値
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **エラーメッセージ**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * アクション入力では、 `awsAccessKeyId`と`awsSecretAccessKey`のみを指定できますが、これらは IAM ユーザーの静的認証情報である必要があります。
            * セッション資格情報を使用する場合は、 `awsAccessKeyId` 、 `awsSecretAccessKey` 、および`awsSessionToken`アクション入力に渡す必要があります。
            * 指定された唯一のものを出力として取得するセレクター。
            * 手順については、 [AWS 認証情報](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials)を参照してください。
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="writedocumentexample">
          **例 1** : すべての Lambda関数をリストする単純な SSM ドキュメント

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **SSM リストによる完全なオートフロー定義 Lambda関数**

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```

          **例 2: Pythonスクリプトの実行**

          <Collapser id="execute.python.script" title="Pythonスクリプトを実行する">
            AWS `SystemsManager`自動化とドキュメントアクションを使用して、Python スクリプトを実行するワークフロー定義を定義できます。

            ここでは、単純な Hello World アプリケーションを使用した短い例を示します。

            <Collapser id="system.manager.document" title="SystemsManager ドキュメント">
              ```yaml
              schemaVersion: '0.3'
              description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
              parameters:
                Username:
                  type: String
                  description: "The username to greet."
                  default: "User"
              mainSteps:
                - action: aws:executeScript
                  name: pythonStep
                  inputs:
                    Runtime: python3.8
                    Handler: script_handler
                    Script: |
                      def script_handler(event, context):
                          username = event['username']
                          return f'Hello {username}'
                    InputPayload:
                      username: "{{ Username }}"
                  outputs:
                    - Name: scriptOutput
                      Type: String
                      Selector: $.Payload
              outputs:
                - pythonStep.scriptOutput
              ```

              これは以下のワークフローで使用できます。

              <Collapser id="workflow.definition.1" title="ワークフロー定義">
                ```yaml
                name: aws-python-script

                workflowInputs:
                  key:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
                  access:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
                  token:
                    type: String
                    defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
                  region:
                    type: String
                    defaultValue: us-west-2
                  name:
                    type: String
                    defaultValue: ExecuteHelloPythonScript
                  username:
                    type: String
                    defaultValue: World!

                steps:
                  - name: generateIdempotencyToken
                    type: action
                    action: utils.uuid.generate
                    version: 1

                  - name: createSsmDocument
                    type: action
                    action: aws.systemsManager.writeDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .workflowInputs.name }}
                      documentContent: |
                        schemaVersion: '0.3'
                        description: "Run a Python script that says 'Hello' to the username passed as input and capture the output."
                        parameters:
                          Username:
                            type: String
                            description: "The username to greet."
                            default: "User"
                        mainSteps:
                          - action: aws:executeScript
                            name: pythonStep
                            inputs:
                              Runtime: python3.8
                              Handler: script_handler
                              Script: |
                                def script_handler(event, context):
                                    username = event['username']
                                    return f'Hello {username}'
                              InputPayload:
                                username: "{{ Username }}"
                            outputs:
                              - Name: scriptOutput
                                Type: String
                                Selector: $.Payload
                        outputs:
                          - pythonStep.scriptOutput

                  - name: start1
                    type: action
                    action: aws.systemsManager.startAutomation
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                      idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}
                      parameters:
                        Username: ${{ .workflowInputs.username }}

                  - name: waitForCompletion
                    type: action
                    action: aws.systemsManager.waitForAutomationStatus
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                      # Optional, default is Success and Failed
                      automationExecutionStatuses:
                        - "Success"
                        - "Failed"
                      timeout: 300

                  - name: hasCompleted
                    type: switch
                    switch:
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                        next: displayError
                      - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                        next: displaySuccess
                    next: displayUnexpected

                  - name: displayUnexpected
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
                    next: cleanupSsmDocument

                  - name: displaySuccess
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "This is the results of the automation that was run on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.pythonStep.scriptOutput | tojson }}"
                    next: cleanupSsmDocument

                  - name: displayError
                    type: action
                    action: newrelic.instrumentation.log
                    version: 1
                    inputs:
                      message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs | tojson }}"
                    next: cleanupSsmDocument

                  - name: cleanupSsmDocument
                    type: action
                    action: aws.systemsManager.deleteDocument
                    version: 1
                    inputs:
                      awsAccessKeyId: ${{ .workflowInputs.key }}
                      awsSecretAccessKey: ${{ .workflowInputs.access }}
                      awsSessionToken: ${{ .workflowInputs.token }}
                      region: ${{ .workflowInputs.region }}
                      documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
                ```

                これは、AWS の一時シークレットが以前に`secretsManagementCreateSecretNerdGraph`ミューテーションで保存されていることを前提として、次の NerdGraph ミューテーションで開始できます。

                ```yaml
                mutation { 
                    autoflowsStartWorkflowRun(accountId: 11933347,
                    definition: {
                        name: "aws-python-script",
                    }, workflowInputs: [
                        {key: "key" value: "${{ :secrets:testUser123_AWS_ACCESS_KEY_ID }}"}
                        {key: "access" value: "${{ :secrets:testUser123_AWS_SECRET_ACCESS_KEY }}"}
                        {key: "token" value: "${{ :secrets:testUser123_AWS_SESSION_TOKEN }}"}
                        {key: "region" value:"us-west-2"}
                        {key: "username" value: "Julien"}
                    ]) 
                    { runId }
                } 
                ```

                上記のミューテーションを実行すると、runId (例: `207e8c23-2c89-4af2-a74f-3c9ea2ffd543`が返されます。この runId を使用してログをクエリし、次の出力を表示できます。

                <img title="Image of a python script execution output" alt="Image of a python script execution output" src="/images/python-script.webp" />
              </Collapser>
            </Collapser>
          </Collapser>

          **例3: より複雑なSSMドキュメント**

          <Collapser id="example3.complex.document" title="複雑なSSMドキュメントの例">
            **API ゲートウェイのロールバックを実行する SSM ドキュメント:**

            1. API ゲートウェイ REST API のリストを取得します。私の API (`Test API`) をフィルターし、残りの API ID を取得します。
            2. 私の API (`Test API`) 内のすべてのリソースのリストを取得します。pathPart(`/test`)に基づいて特定のリソースをフィルタリングし、リソースIDを取得します
            3. Lambda関数 (`ApiGwTestFn`) のバージョンのリストを取得します。 ロールバックする特定のバージョン (バージョン: 1) をフィルターし、そのバージョンの functionArn を取得します。
            4. 上記の手順で取得したラムダ関数Arnを使用してAPIゲートウェイ統合を更新します。
            5. REST API (`Test API`) の新しいデプロイメントを作成します。

            ```yaml
            schemaVersion: '0.3'
            description: Test SSM for API gateway rollback
            mainSteps:
              - name: ExecuteAwsApi
                action: aws:executeAwsApi
                nextStep: ExecuteGetApiResources
                inputs:
                  Service: apigateway
                  Api: GetRestApis
                outputs:
                  - Name: resultApiId
                    Selector: $.items[?(@.name=='Test API')].id
                    Type: String
              - name: ExecuteGetApiResources
                action: aws:executeAwsApi
                nextStep: ExecuteListVersionsByFunction
                inputs:
                  Service: apigateway
                  Api: GetResources
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
                outputs:
                  - Name: resultResourceId
                    Selector: $.items[?(@.pathPart=='test')].id
                    Type: String
              - name: ExecuteListVersionsByFunction
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwUpdateIntg
                inputs:
                  Service: lambda
                  Api: ListVersionsByFunction
                  FunctionName: ApiGwTestFn
                outputs:
                  - Name: resultLambdaVersionArn
                    Selector: $.Versions[?(@.Version=='1')].FunctionArn
                    Type: String
              - name: ExecuteApiGwUpdateIntg
                action: aws:executeAwsApi
                nextStep: ExecuteApiGwCreateDeployment
                inputs:
                  Service: apigateway
                  Api: UpdateIntegration
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
                  resourceId: '\{{ ExecuteGetApiResources.resultResourceId }}'
                  httpMethod: GET
                  patchOperations:
                    - op: replace
                      path: /uri
                      value: arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/\{{ ExecuteListVersionsByFunction.resultLambdaVersionArn }}/invocations
              - name: ExecuteApiGwCreateDeployment
                action: aws:executeAwsApi
                inputs:
                  Service: apigateway
                  Api: CreateDeployment
                  restApiId: '\{{ ExecuteAwsApi.resultApiId }}'
            outputs:
              - ExecuteGetApiResources.resultResourceId
              - ExecuteListVersionsByFunction.resultLambdaVersionArn
            ```

            サンプル SSM は`ExecuteGetApiResources.resultResourceId`と`ExecuteListVersionsByFunction.resultLambdaVersionArn`を出力します。これらの出力は、ワークフロー定義の以降のステップで使用できます。
          </Collapser>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.deletedocument" title="AWS SSM ドキュメントを削除する">
    このアクションは、アクション入力で渡された認証情報に基づいて、AWS アカウント内の AWS SSM ドキュメントを削除します。[AWS Systems Manager のドキュメントを](https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html)参照してください

    <Tabs>
      <TabsBar>
        <TabsBarItem id="systemsmanagerinputs">
          入力
        </TabsBarItem>

        <TabsBarItem id="systemsmanageroutputs">
          出力
        </TabsBarItem>

        <TabsBarItem id="systemsmanagerexample">
          例
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="systemsmanagerinputs">
          <table>
            <thead>
              <tr>
                <th>
                  入力フィールド
                </th>

                <th>
                  オプション性
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **リージョン**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **セレクター**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  リスト
                </td>

                <td>
                  `[{\"name\": \"success\", \"expression\": \".success\"}, {\"name\": \"documentName\", \"expression\": \".documentName\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="systemsmanageroutputs">
          <table>
            <thead>
              <tr>
                <th>
                  出力フィールド
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **成功**
                </td>

                <td>
                  ブール値
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **エラーメッセージ**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * アクション入力では、 `awsAccessKeyId`と`awsSecretAccessKey`のみを指定できますが、これらは IAM ユーザーの静的認証情報である必要があります。
            * セッション資格情報を使用する場合は、 `awsAccessKeyId` 、 `awsSecretAccessKey` 、および`awsSessionToken`アクション入力に渡す必要があります。
            * 指定された唯一のものを出力として取得するセレクター。
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="systemsmanagerexample">
          すべての Lambda関数をリストする単純な SSM ドキュメント

          ```yaml
          schemaVersion: '0.3'
          description: List all Lambda function names.
          mainSteps:
            - name: ExecuteAwsApi
              action: aws:executeAwsApi
              isEnd: true
              inputs:
                Service: lambda
                Api: ListFunctions
              outputs:
                - Name: resultFunctionName
                  Selector: $..FunctionName
                  Type: StringList
          outputs:
            - ExecuteAwsApi.resultFunctionName
          ```

          **SSM による完全なワークフロー定義**:

          ```yaml
          name: aws-api

          workflowInputs:
            key:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_ACCESS_KEY_ID }}"
            access:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SECRET_ACCESS_KEY }}"
            token:
              type: String
              defaultValue: "${{ :secrets:11933347:USERNAME_AWS_SESSION_TOKEN }}"
            region:
              type: String
              defaultValue: us-east-2

          steps:
            - name: createSsmDocument
              type: action
              action: aws.systemsManager.writeDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                selectors:
                  - name: documentName
                    expression: '.documentName'
                  - name: documentType
                    expression: '.documentType'
                  - name: documentStatus
                    expression: '.documentStatus'
                  - name: success
                    expression: '.success'
                documentName: "LambdaListFunctionNames"
                documentContent: |
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName

            - name: generateIdempotencyToken
              type: action
              action: utils.uuid.generate
              version: 1

            - name: start1
              type: action
              action: aws.systemsManager.startAutomation
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: "${{ .steps.createSsmDocument.outputs.documentName }}"
                idempotencyToken: ${{ .steps.generateIdempotencyToken.outputs.uuid }}

            - name: waitForCompletion
              type: action
              action: aws.systemsManager.waitForAutomationStatus
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                automationExecutionId: ${{ .steps.start1.outputs.automationExecutionId }}
                # Optional, default is Success and Failed
                automationExecutionStatuses:
                  - "Success"
                  - "Failed"
                timeout: 60

            - name: hasCompleted
              type: switch
              switch:
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Failed" }}
                  next: displayError
                - condition: ${{ .steps.waitForCompletion.outputs.automationExecutionStatus == "Success" }}
                  next: displaySuccess
              next: displayUnexpected

            - name: displayUnexpected
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Unexpected status ${{ .steps.waitForCompletion.outputs.automationExecutionStatus | tojson }}"
              next: cleanupSsmDocument

            - name: displaySuccess
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "This is all the lambda function names on the region ${{ .workflowInputs.region }}:${{ .steps.waitForCompletion.outputs.automationExecutionOutputs.ExecuteAwsApi.resultFunctionName | join(\",\") }}"
              next: cleanupSsmDocument

            - name: displayError
              type: action
              action: newrelic.instrumentation.log
              version: 1
              inputs:
                message: "Error while executing document ${{ .steps.createSsmDocument.outputs.documentName }}, detail: ${{ .steps.waitForCompletion.outputs.errorMessage }}"
              next: cleanupSsmDocument

            - name: cleanupSsmDocument
              type: action
              action: aws.systemsManager.deleteDocument
              version: 1
              inputs:
                awsAccessKeyId: ${{ .workflowInputs.key }}
                awsSecretAccessKey: ${{ .workflowInputs.access }}
                awsSessionToken: ${{ .workflowInputs.token }}
                region: ${{ .workflowInputs.region }}
                documentName: ${{ .steps.createSsmDocument.outputs.documentName }}
          ```
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.startautomation" title="SSM doc で自動化を開始する">
    AWS SSM ドキュメントを使用して自動化を開始します。[AWS Systems Manager のドキュメントを](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartAutomationExecution.html)参照してください

    <Tabs>
      <TabsBar>
        <TabsBarItem id="startautomationinputs">
          入力
        </TabsBarItem>

        <TabsBarItem id="startautomationoutputs">
          出力
        </TabsBarItem>

        <TabsBarItem id="startautomationexample">
          例
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="startautomationinputs">
          <table>
            <thead>
              <tr>
                <th>
                  入力フィールド
                </th>

                <th>
                  オプション性
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **リージョン**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **documentName**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `documentName: "my-ssm-document"`
                </td>
              </tr>

              <tr>
                <td>
                  **パラメーター**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  地図
                </td>

                <td>
                  ```yaml
                  parameters:
                        myKey: myValue
                  ```
                </td>
              </tr>

              <tr>
                <td>
                  **idempotencyToken**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  UUID
                </td>

                <td>
                  `idempotencyToken: "any token"`

                  これは、AWS ssm 自動化を開始するための冪等性のためにクライアントとして渡されます。
                </td>
              </tr>

              <tr>
                <td>
                  **セレクター**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  リスト
                </td>

                <td>
                  `[{\"name\": \"automationExecutionId\", \"expression\": \".automationExecutionId\"}, {\"name\": \"success\", \"expression\": \".success\"}]`
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="startautomationoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  出力フィールド
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **成功**
                </td>

                <td>
                  ブール値
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **エラーメッセージ**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            * アクション入力で`awsAccessKeyId`と`awsSecretAccessKey`を指定する場合、それらが IAM ユーザーの静的認証情報であることを確認してください。
            * セッション資格情報を使用する場合は、 `awsAccessKeyId` 、 `awsSecretAccessKey`および`awsSessionToken`アクション入力に渡す必要があります。
            * 手順については、 [AWS 認証情報](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials/)を参照してください。
            * セレクターを使用して、指定されたもののみを出力として取得します。
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="startautomationexample">
          <table>
            <thead>
              <tr>
                <th>
                  ワークフロー定義
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser id="aws-systemsmanager.waitforautomationstatus" title="自動化ステータスを待つ">
    AWS ドキュメントを使用した自動化を待機します。詳細については、 [AWS Systems Manager のドキュメント](https://docs.aws.amazon.com/systems-manager/?id=docs_gateway)を参照してください。

    <Tabs>
      <TabsBar>
        <TabsBarItem id="automationstatusinputs">
          入力
        </TabsBarItem>

        <TabsBarItem id="automationstatusoutputs">
          出力
        </TabsBarItem>

        <TabsBarItem id="automationstatusexample">
          例
        </TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="automationstatusinputs">
          <table>
            <thead>
              <tr>
                <th>
                  入力フィールド
                </th>

                <th>
                  オプション性
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **awsRoleArn**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `arn:aws:iam::123456789012:role/my-workflow-role`
                </td>
              </tr>

              <tr>
                <td>
                  **awsAccessKeyId**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsAccessKeyId> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSecretAccessKey**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSecretAccessKey> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **awsSessionToken**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  弦
                </td>

                <td>
                  `${{ :secrets:<awsSessionToken> }}`
                </td>
              </tr>

              <tr>
                <td>
                  **リージョン**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `region: "us-east-2"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  必須
                </td>

                <td>
                  弦
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`

                  完了を待つ必要がある自動化

                  `executionId`

                   。
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatuses**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  リスト
                </td>

                <td>
                  `automationExecutionStatuses: ["status1", "status2"]`

                  待機を停止できる[AutomationExecution](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_AutomationExecution.html#AutomationExecutionStatus)からの自動化実行ステータスのリスト。

                  デフォルト： `["Success", "Failed"]`
                </td>
              </tr>

              <tr>
                <td>
                  **タイムアウト**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  int
                </td>

                <td>
                  `timeout: 180`(デフォルト)、最大 600。

                  自動化ステータスが予想される`automationExecutionStatuses`のいずれかになるまで待機できる期間 (秒)。

                  タイムアウトが発生した場合、出力には`success: false`と`errorMessag: Timeout waiting for automation status`が含まれます。
                </td>
              </tr>

              <tr>
                <td>
                  **セレクター**
                </td>

                <td>
                  オプション
                </td>

                <td>
                  リスト
                </td>

                <td>
                  `[{\"name\": \"automationExecutionStatus\", \"expression\": \".automationExecutionStatus\"}, {\"name\": \"scriptOutput\", \"expression\": \".automationExecutionOutputs.pythonStep.scriptOutput | tojson\"}]`

                  。
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>

        <TabsPageItem id="automationstatusoutputs">
          <table>
            <thead>
              <tr>
                <th>
                  出力フィールド
                </th>

                <th>
                  タイプ
                </th>

                <th>
                  例
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  **automationExecutionId**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `automationExecutionId: "3143a28d-241c-4abd-a3ca-9c0ff3890241"`
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionStatus**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `automationExecutionStatus: "Success"`

                  アクションが成功した場合、 `automationExecutionStatuses`入力フィールドに渡された値のいずれかになります。

                  それ以外の場合、これは null になります。
                </td>
              </tr>

              <tr>
                <td>
                  **automationExecutionOutputs**
                </td>

                <td>
                  地図
                </td>

                <td>
                  ```yaml
                  "automationExecutionOutputs": {
                        "ExecuteGetApiResources": {
                          "resultResourceId": [
                            "pky3cb"
                          ]
                        },
                        "ExecuteListVersionsByFunction": {
                          "resultLambdaVersionArn": [
                            "arn:aws:lambda:us-east-2:661945836867:function:ApiGwTestFn:1"
                          ]
                        }
                  } 
                  ```

                  出力は、ドキュメントからの出力値のマップになります。ドキュメント内のすべての出力は、この出力フィールドを使用して収集でき、ワークフロー自動化定義の後続のステップで使用できます。
                </td>
              </tr>

              <tr>
                <td>
                  **成功**
                </td>

                <td>
                  ブール値
                </td>

                <td>
                  `success: true`
                </td>
              </tr>

              <tr>
                <td>
                  **エラーメッセージ**
                </td>

                <td>
                  弦
                </td>

                <td>
                  `errorMessage: "Some error message from ssm"`
                </td>
              </tr>
            </tbody>
          </table>

          <Callout variant="important">
            1. アクション入力では、 `awsAccessKeyId`と`awsSecretAccessKey`のみを指定できますが、これらは IAM ユーザーの静的認証情報である必要があります。
            2. セッション資格情報を使用する場合は、 `awsAccessKeyId` 、 `awsSecretAccessKey`および`awsSessionToken`アクション入力に渡す必要があります。
            3. [AWS 認証情報](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials)を設定する手順を参照してください。
            4. セレクターを使用して、指定されたもののみを出力として取得します。
          </Callout>
        </TabsPageItem>

        <TabsPageItem id="automationstatusexample">
          <table>
            <thead>
              <tr>
                <th>
                  ワークフロー定義
                </th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  ```yaml
                  schemaVersion: '0.3'
                  description: List all Lambda function names.
                  mainSteps:
                    - name: ExecuteAwsApi
                      action: aws:executeAwsApi
                      isEnd: true
                      inputs:
                        Service: lambda
                        Api: ListFunctions
                      outputs:
                        - Name: resultFunctionName
                          Selector: $..FunctionName
                          Type: StringList
                  outputs:
                    - ExecuteAwsApi.resultFunctionName
                  ```
                </td>
              </tr>
            </tbody>
          </table>
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Collapser>
</CollapserGroup>