---
title: ワークフロー自動化のトラブルシューティング
tags:
  - workflow automation
  - troubleshooting
  - workflow errors
metaDescription: 'Common issues and solutions for Workflow Automation including AWS credentials, workflow execution, and dashboard problems.'
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

このページでは、ワークフロー自動化の使用時に発生する可能性のある一般的な問題の解決策を示します。追加のサポートについては、 [New Relic サポート フォーラム](https://discuss.newrelic.com/)を参照するか、 [New Relic サポート](https://support.newrelic.com/)にお問い合わせください。

## AWS の認証情報と認証

<CollapserGroup>
  <Collapser id="access-denied-errors" title="アクセス拒否エラー">
    **問題:**ワークフローが AWS 認証エラーで失敗します。

    **解決策:**

    1. **アカウント ID を確認してください:**信頼ポリシーで`253490767857` ( `754728514883`ではない) を使用していることを確認してください。クラウドインテグレーションのアカウント ID ( `754728514883` ) は、ワークフロー オートメーションのアカウント ID とは異なります。
    2. **外部 ID の確認:**信頼ポリシー内の外部 ID が New Relic アカウント ID ([アカウント設定](/docs/accounts/accounts-billing/account-structure/account-id)で確認可能) と完全に一致していることを確認します。
    3. **権限を確認する:** IAM ロールまたはユーザーに、ワークフローに必要な特定の AWS 権限があることを確認します。[必要な AWS 権限の](/docs/workflow-automation/setup-and-configuration/set-up-aws-credentials#required-aws-permissions)表を確認してください。
    4. **AWS CLI でテスト:**ロールが引き受け可能であることを確認するには、 `aws sts assume-role`をローカルで実行します。
       ```bash
       aws sts assume-role \
       --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/NewRelicWorkflowAutomationRole" \
       --role-session-name "TestSession" \
       --external-id "YOUR_NR_ACCOUNT_ID"
       ```
  </Collapser>
</CollapserGroup>

### 「無効なトークン」または期限切れの資格情報

**問題:**トークンの有効期限エラーによりワークフローが失敗します。

**解決策:**

1. **セッション トークンの場合:**有効期限のタイムスタンプを確認します。セッション トークンの有効期間は通常 1 ～ 12 時間です。有効期限が切れる前に、次の方法で新しいものを生成します。
   ```bash
   aws sts assume-role \
     --role-arn "arn:aws:iam::YOUR_ACCOUNT:role/YOUR_ROLE" \
     --role-session-name "WorkflowAutomationSession"
   ```
2. **アクセス キーの場合:**アクセス キー ID とシークレット アクセス キーの両方がシークレット マネージャーに正しく保存されていることを確認します。[NerdGraph GraphiQL エクスプローラー](https://one.newrelic.com/nerdgraph-graphiql)で値を再確認します。
3. **シークレットの構文を確認してください:** `${{ secrets.keyName }}`ではなく`${{ :secrets:keyName }}`形式を使用していることを確認してください。コロンプレフィックス（ `:secrets:` ）が必要です。

### 自分の役割のARNが見つかりません

**問題:** ARN が必要なのに、AWS で見つけることができません。

**解決：**

1. [AWS IAMコンソール](https://console.aws.amazon.com/iam/)にサインインする
2. ナビゲーションから**Roles** \[役割]を選択します
3. ロール名を検索します（例： `NewRelicWorkflowAutomationRole` ）
4. ロールを選択すると、ARNが概要セクションに表示されます。
5. ARN の形式は次のとおりです。 `arn:aws:iam::<YOUR_AWS_ACCOUNT>:role/<ROLE_NAME>`

### ワークフローは特定のAWSリソースにアクセスできません

**問題:**ロールには権限がありますが、ワークフローが特定のリソースにアクセスできません。

**解決策:**

1. **リソースレベルのアクセス許可:** IAM ポリシーによって特定のリソース ARN へのアクセスが制限されているかどうかを確認します。テストのためにワイルドカード ( `*` ) を追加し、特定のリソースにロックダウンする必要がある場合があります。
   ```json
   {
     "Effect": "Allow",
     "Action": "ec2:DescribeInstances",
     "Resource": "*"  // Change from specific ARN to * for testing
   }
   ```
2. **サービス制御ポリシー (SCP):** AWS 組織内にいる場合、SCP によって特定のアクションがブロックされる可能性があります。組織ポリシーを確認するには、 AWSアドミニストレーターに問い合わせてください。
3. **リージョンの不一致:** IAM 権限で、リソースが存在する正しい AWS リージョンが指定されていることを確認します。リソースの場所に一致するようにワークフローの`awsRegion`問題を更新します。

## ワークフロー実行の問題

### クイックトラブルシューティングリファレンス

一般的なワークフローの問題を迅速に診断するには、次の表を使用します。

| **症状**                     | **チェック**             | **解決**                                            |
| -------------------------- | -------------------- | ------------------------------------------------- |
| ワークフローが特定のステップで失敗する        | エラーメッセージの実行ログを表示する   | そのアクションの設定、資格情報、または入力データを修正します                    |
| ワークフローは実行されるが、間違った結果が生成される | ステップ間のデータ受け渡しをチェックする | テンプレートの構文を確認する `${{ .steps.name.outputs.field }}` |
| スケジュールされたワークフローが実行されない     | スキップされた実行の実行履歴を確認する  | スケジュール設定とワークフローの状態（アクティブ）を確認する                    |
| ワークフローがタイムアウトする            | 実行時間を確認する            | ポーリング頻度を減らすか、ワークフローを小さく分割する                       |
| 変更は有効になりません                | バージョン履歴を確認する         | 新しいバージョンを使用するようにスケジュールされた実行を更新する                  |

ログと実行履歴の表示に関する詳細な手順については、 [「ワークフロー実行の監視」](/docs/workflow-automation/create-a-workflow-automation/managing-workflow#monitor-runs)を参照してください。

### ワークフローが「失敗」ステータスとして表示される

**問題:**ダッシュボードにワークフローのステータスが「失敗」と表示されます。

**解決策:**

1. **実行履歴を確認します**:

   * **[one.newrelic.com](https://one.newrelic.com) &gt; All Capabilities &gt; Workflow Automation**にアクセスしてください。
   * ワークフロー名をクリック
   * **Run history** \[実行履歴を]表示して、どの実行が失敗したかを確認します

2. **実行ログを確認します**:

   * 失敗した実行の**View logs** \[ログを表示]をクリックして、失敗した特定のアクションを特定します。
   * 根本原因を示すエラーメッセージを探す

3. **一般的な原因**:

   * **無効な資格情報**: 期限切れのトークン、不正なシークレット構文、または間違ったシークレットキー
   * **不足している権限**: AWS IAM 権限、Slack ボットトークンのスコープ、または API アクセスが不十分です
   * **目標リソースの変更**: EC2 インスタンスの削除、Slack チャネルの削除、またはデータベースの名前変更
   * **APIレート制限を超えました**: 外部サービス ( AWS 、Slack など) へのrequestsが多すぎます
   * **ネットワークタイムアウト**: 外部APIの応答に時間がかかりすぎます

4. **修正して再実行**: 問題を解決した後、 [StartWorkflowRun API を](/docs/workflow-automation/workflow-automation-apis/start-workflow-run)使用してワークフローを手動でトリガーし、動作することを確認します。

### ワークフローの実行に時間がかかりすぎる

**問題:**ワークフローの実行が予想される期間またはタイムアウトを超えます。

**解決策:**

1. **アクション シーケンスを確認する**: ログをチェックして、遅いアクションを特定します。実行時間が 30 秒を超えるアクションを探します。

2. **クエリの最適化**: NRQL クエリを使用する場合は、パフォーマンスを向上させるためにクエリを最適化します。

   * すべてのデータをクエリするのではなく、特定の時間範囲を追加します
   * 結果セットのサイズを縮小するには、 `LIMIT`を使用します。
   * `WHERE`句で早期にフィルタリング

3. **外部 API を確認する**: 統合サービス (AWS、Slack) からの応答が遅いと、実行が遅れる可能性があります。API応答時間を個別にテストします。

4. **ワークフローの制限を考慮する**: タイムアウト制約の[ワークフロー制限](/docs/workflow-automation/limitations-and-faq/workflow-limits)を確認します (通常、ワークフローごとに 15 分)。

5. **より小さなワークフローに分割する**: 複雑なワークフローを、並行して実行できる、より小さく、集中した自動化に分割します。

### ワークフローの変更が有効にならない

**問題:**ワークフローを編集しましたが、実行時に変更が適用されません。

**解決策:**

1. **保存したことを確認する**：ワークフロー設定を編集した後、 **Save** \[保存]をクリックしたことを確認します。

2. **バージョンを確認してください**:

   * ワークフローの詳細へ
   * **Version history** \[バージョン履歴]タブをクリック
   * 最新の変更が新しいバージョンとして表示されることを確認します
   * このバージョンがアクティブとしてマークされていることを確認してください

3. **スケジュールされた実行の更新**: ワークフローがスケジュールに従って実行される場合は、新しいバージョンを使用するようにスケジュールを更新します。

   * **[one.newrelic.com](https://one.newrelic.com) &gt; All Capabilities &gt; Workflow Automation**にアクセスしてください。
   * スケジュールされた実行を見つける
   * 新しいワークフロー バージョンを参照するようにスケジュールを更新します

4. **キャッシュをクリア**: Browserキャッシュに古い設定が表示される場合があります - ページをハードリフレッシュします (Ctrl+Shift+R または Cmd+Shift+R)。

## ワークフローダッシュボードの問題

### ダッシュボードでワークフローが見つからない

**問題:**作成したワークフローがダッシュボード リストに表示されません。

**解決策:**

1. **フィルターを確認してください**:

   * フィルタードロップダウンをクリック
   * ステータスフィルターに「すべて」を選択します
   * 検索バーをクリアする

2. **アカウントの確認**: ワークフローが作成された正しい New Relic アカウントにログインしていることを確認します。右上隅のアカウントセレクターを確認してください。

3. **権限を確認する**: ユーザーロールにワークフローを表示するためのアクセス権があることを確認してください。 ワークフロー アクセス権限が必要な場合は、New Relic 管理者に問い合わせてください。

4. **ページを更新します**。 Browserキャッシュにより、最近の変更が隠れてしまう場合があります。 ハードリフレッシュ (Ctrl+Shift+R または Cmd+Shift+R) を試してください。

### ワークフローを削除できません

**問題:**削除オプションがグレー表示されているか、削除に失敗します。

**解決策:**

1. **権限を確認する**: ユーザーロールにワークフローの削除権限があることを確認します。 必要に応じてアカウント管理者に問い合わせてください。

2. **スケジュールされた実行を停止**: 削除する前に、アクティブなスケジュールされた実行をキャンセルします。

   * ワークフローの詳細に移動する
   * **Scheduled runs** \[スケジュール実行]タブに移動
   * すべてのアクティブなスケジュールをキャンセルする

3. **依存関係を確認する**: 他の自動化が依存しているワークフローは削除できません。ワークフローが以下によって参照されているかどうかを確認します。

   * これを呼び出す他のワークフロー
   * それをトリガーするアラートポリシー
   * API経由で起動する外部システム

4. **サポートにお問い合わせください**: 上記の手順を試しても問題が解決しない場合は、 [New Relic サポート](https://support.newrelic.com/)にお問い合わせください。

## 統合特有の問題

### Slackの通知が表示されない

**問題:**ワークフローは正常に完了しますが、Slack メッセージが表示されません。

**解決策:**

1. **チャネル ID を確認する**: チャネル名ではなく、Slack チャネル**ID** (例: `C01234ABCD` ) を使用していることを確認します。Slack で ID を見つける:

   * チャンネル名を右クリック
   * **View channel details** \[チャンネルの詳細を表示]を選択
   * 下部のチャンネルIDをコピーします

2. **ボットの権限を確認する**: Slack ボットに次のスコープがあることを確認します。

   * `chat:write` - メッセージを投稿する
   * `channels:read` - パブリックチャンネルを表示する
   * `groups:read` - プライベートチャンネルを表示する（該当する場合）

3. **ボットがチャネル内にあることを確認する**: ボットをターゲット チャネルに追加します。

   * チャンネルに`/invite @YourBotName`と入力してください
   * ボットがメンバーリストに表示されていることを確認する

4. **シークレット内のトークンを確認する**: シークレット マネージャーに保存されている Slack トークンが正しく、期限切れになっていないことを確認します。

### AWS Systems Manager の操作が失敗する

**問題:** SSM 自動化ドキュメントまたはコマンドの実行に失敗します。

**解決策:**

1. **SSM 権限を確認する**: IAM ロールに次の権限があることを確認します。
   ```json
   {
     "Effect": "Allow",
     "Action": [
       "ssm:CreateDocument",
       "ssm:DeleteDocument",
       "ssm:StartAutomationExecution",
       "ssm:GetAutomationExecution"
     ],
     "Resource": "*"
   }
   ```
2. **SSM エージェントを確認します**: 目的の EC2 インスタンスに SSM エージェントがインストールされ、実行されていることを確認します。
   ```bash
   aws ssm describe-instance-information --region us-east-1
   ```
3. **インスタンス プロファイルの確認**: EC2 インスタンスには、コマンドを実行するための SSM 権限を持つ IAM インスタンス プロファイルが必要です。
4. **ドキュメントの存在を確認する**: 既存の SSM ドキュメントを使用する場合は、それが AWS アカウントとリージョンに存在することを確認します。

## テンプレート固有の問題

### エンティティ GUID が見つかりません

**問題:**テンプレートが`Entity not found`エラーで失敗します。

**解決策:**

1. **正しいエンティティ GUID を見つけます**:

   * New Relicのモニター リソース ページに移動します
   * GUIDのURLまたはエンティティメタデータを確認します
   * [エンティティ検索を](/docs/new-relic-solutions/new-relic-one/core-concepts/what-entity-new-relic#find)使用してエンティティを見つけます

2. **エンティティが正しいアカウントに存在することを確認する**: ワークフローがデプロイされているのと同じアカウントのエンティティを使用していることを確認します

3. **エンティティ レポート データを確認する**: エンティティに**Last seen** \[最後に表示されたのは]最近 — 古いエンティティは削除された可能性があります」と表示されていることを確認します。

4. **AWSの場合**:[インテグレーション](/docs/infrastructure/amazon-integrations/get-started/introduction-aws-integrations)がアクティブであることを確認してください

<Callout variant="tip">
  **エンティティ GUID はアカウント固有です。**アカウント間でワークフローを移動するには、すべてのエンティティ GUID を更新する必要があります。
</Callout>

### NRQL結果を返しません

**問題:** NRQL クエリを使用するテンプレートは完了しますが、空のデータセットを返します。

**解決策:**

1. **最初にクエリをテストする**: テンプレートに追加する前に[クエリビルダー](/docs/query-your-data/explore-query-data/query-builder/introduction-query-builder)を使用してクエリを検証します

2. **データ型とイベント名を確認します**:

   * `FROM Transaction`を使用してください。 `FROM Transactions`
   * 属性名が完全に一致していることを確認します（大文字と小文字を区別します）

3. **時間範囲を調整する**: まばらなデータの場合は、時間ウィンドウを拡張します。

   * 最近のデータに`SINCE 1 hour ago`を追加
   * トレンドには`SINCE 1 day ago`を使用する

4. **段階的に簡素化してテストする**: 基本的なクエリから始めて、フィルターを 1 つずつ追加します。

5. **[NRQL構文](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language)のチェック**: クエリ構造がNRQL要件と一致していることを確認します

### テンプレートのデプロイメントが失敗する

**問題:**テンプレートがデプロイされないか、デプロイメント中にエラーが表示されます。

**解決策:**

1. **必須入力をすべて確認**: 必須フィールド (資格情報、GUID、クエリ) がすべて入力されていることを確認します。
2. **認証情報の形式を確認してください**: シークレットはコロンのプレフィックスが付いた`${{ :secrets:keyName }}`形式を使用する必要があります
3. **認証情報を個別にテストする**: デプロイする前に、AWS CLI と Slack API の Slack トークンを使用して AWS 認証情報をテストします。
4. **テンプレートの要件を確認する**: 各テンプレートには特定の前提条件が記載されているので、すべてが満たされていることを確認します。
5. **特殊文字のチェック**: 一部のフィールド（チャンネル名、クエリ）は特殊文字で失敗する可能性があります。可能な場合は英数字を使用してください。

### 承認ワークフローが応答しない

**問題:** Slack 承認を必要とするテンプレート (API Gateway ロールバック、EC2 サイズ変更) が反応を検出しません。

**解決策:**

1. **ボットトークンスコープを確認します**:

   * `reactions:read` - 絵文字反応を検出するために必要
   * `chat:write` - 承認メッセージを投稿する必要があります

2. **反応形式を確認する**: ワークフローで指定された絵文字を正確に使用します (通常、承認の場合は👍、拒否の場合は👎)

3. **タイムアウト設定を確認する**: 承認requests設定されたタイムアウト（通常 5 ～ 10 分）後に期限切れになります。

4. **ボットがメッセージを読み取ることができることを確認する**: ボットはチャネルに参加し、メッセージ履歴を読み取る権限を持っている必要があります

5. **シンプルな承認でテストする**: 問題を切り分けるために、承認ロジックのみでテストワークフローを作成します。

### EC2インスタンス管理の問題

**問題:** EC2 テンプレートがインスタンスのサイズ変更や管理に失敗します。

**解決策:**

1. **[CloudWatch Metric Streams](/install/aws-cloudwatch/)が設定されていることを確認します**: 収益 EC2 メトリクスに必要です
2. **[EC2 監視統合](/docs/infrastructure/amazon-integrations/aws-integrations-list/aws-ec2-monitoring-integration/#activate)active を確認する**: インスタンス データがNew Relicに流れることを確認します
3. **インスタンスの状態を確認します**。インスタンスは`running`または`stopped`状態である必要があります。遷移状態 (保留中、停止中) は失敗の原因になります。
4. **インスタンスタイプの互換性を確認する**: すべてのインスタンスタイプがすべてのサイズ変更操作をサポートしているわけではありません。AWS[インスタンスタイプのドキュメントAWS](https://aws.amazon.com/ec2/instance-types/)確認してください。
5. **停止/開始権限を確認してください**: IAMロールには`ec2:StopInstances`と`ec2:StartInstances`に加えて `ec2:ModifyInstanceAttribute`

### JSON解析テンプレートがデータをログに記録しない

**問題:** JSON 解析テンプレートは正常に実行されますが、 New Relicログにデータが表示されません。

**解決策:**

1. **APIエンドポイントの検証**: ブラウザでステータスページのURLをテストし、有効なJSONが返されることを確認します。
2. **JSON構造をチェック**: テンプレートは特定の形式を想定しています - コンポーネントのヘルスフィールドが期待される構造と一致していることを確認します
3. **ログフィルタを確認する**: ログアクションで正しいイベントタイプと属性が使用されていることを確認する
4. **シンプルなエンドポイントでテスト**: 基本的な JSON エンドポイント ( `https://httpbin.org/json`など) を使用して、テンプレートの仕組みが機能することを確認します。
5. **アカウント権限の確認**: ワークフローに New Relic にログを書き込む権限があることを確認します

## 次のステップ

* **[ベストプラクティス](/docs/workflow-automation/limitations-and-faq/workflow-best-practices)**: エラー処理、パフォーマンスの最適化、テスト戦略。
* **[ワークフローの制限](/docs/workflow-automation/limitations-and-faq/workflow-limits)**: タイムアウト、レート制限、制約を理解します。