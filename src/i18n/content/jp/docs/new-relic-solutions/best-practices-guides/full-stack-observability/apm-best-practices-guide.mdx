---
title: APMのベストプラクティスガイド
contentType: page
template: basicDoc
topics:
  - New Relic solutions
  - Best practices guides
  - Full-stack observability
---

**知っておくべきアプリケーションモニターのヒント**

APMの使い方を知ることも大事ですが、New Relicのアプリケーションパフォーマンス監視ソフトウェアの正確な使い方を知ることも大事です。ここではAPMをマスターし、チームにとって重要なメンバーとなるために役立ついくつかのベストプラクティスをご紹介します。

<Callout variant="tip">
  ご利用の全てのアプリケーションおよびサービスに関する大まかな概要を得るには、New Relic Oneの[エンティティエクスプローラー](/docs/new-relic-one/use-new-relic-one/ui-data/new-relic-one-entity-explorer)を利用してください。
</Callout>

## 1. アプリケーション名を標準化 [#naming]

New Relicの設定ファイルでアプリケーション名を指定しなかった場合、ほとんどのNew Relicエージェントは「My Application」や「PHP Application」などの、デフォルトのアプリケーション名を使用します。20個のアプリケーションが同じ名前になるような状態を避けるために、アプリケーションをディプロイしたらすぐに、必ず分かりやすい識別子を選択してください。

一貫性と操作性を保つため、New Relicではアプリケーション命名の標準化を推奨しています（例：ステージングのすべてのアプリケーションの名前の末尾に、「Staging」または同様の名前を追加します）。新しいJavaアプリケーションを命名する際には、打ち間違いや命名の誤りの可能性を減らすため、自動的に命名できることが理想的です。

### 設定方法

Javaアプリケーションの場合、自動的にアプリケーションを命名するには、次のソースが利用できます。

* リクエスト属性
* サーブレットの初期化パラメーター
* フィルターの初期化パラメーター
* ウェブアプリケーションのコンテキストパラメーター
* ウェブアプリケーションのコンテキスト名（表示名）
* ウェブアプリケーションのコンテキストパス

ニーズに最も適した方法を選択して、[これらの手順](https://docs.newrelic.co.jp/docs/agents/java-agent/configuration/automatic-application-naming)に従ってください。

Java以外のアプリケーションの場合は自動的に命名する方法がないため、[APMエージェントのドキュメント](https://docs.newrelic.co.jp/docs/agents)を参照してください。

## 2. アプリケーションにタグを追加する [#labels]

複数の異なるアプリケーションが同じアカウントを使用し、各アプリケーションが複数の環境にまたがっている場合（例：開発、テスト、試作、生産）、概要ダッシュボードで特定のアプリケーションを見つけることが難しい場合があります。そのため、アプリケーションにタグを追加して、論理グループに分けることが推奨されます。

APMを使い慣れた顧客が使用する最も一般的な2つのタグは、アプリケーション名と環境です。So, for example, if you wanted to view the billing application in Test, you could simply filter by "billing app" (name tag) and "test" (environment tag).

<Callout variant="caution">
  In the APM agent configuration settings files, use the `labels` field to add tags to your data. For example, see this description of the [Python labels setting](/docs/agents/python-agent/configuration/python-agent-configuration#labels).
</Callout>

APM is designed so that apps can roll up into an unlimited number of meaningful tag categories.

### 設定方法

1. 概要を読む：[タグを使用してモニター対象を整理・グループ化](/docs/new-relic-one/use-new-relic-one/core-concepts/tagging-use-tags-organize-group-what-you-monitor)。
2. タグ作成の指示に従う：[NerdGraphのタグを作成するAPIチュートリアル](/docs/apis/nerdgraph/examples/nerdgraph-tagging-api-tutorial)。

## 3. アラートポリシーを作成・評価する [#alerts]

主なパフォーマンス指標の急上昇または急降下が発生した場合、組織内の個人やチームに通知を行う必要があります。[New Relicのアラート](https://docs.newrelic.co.jp/docs/alerts/new-relic-alerts/getting-started/alerting-new-relic)は、エンドユーザーに影響がでる前に問題を検出するダイナミックベースラインなどのツールを提供します。

アラートポリシーは、主に次の2通りの方法で設定できます。

* **スタティック閾値アラート**は、アプリケーションの性質が既によく理解されていて、通常の動作がすぐに変更される可能性が低い場合に適しています。Apdex （Application Performance Index）スコア、レスポンスタイム、エラー率、スループットなどは静的な閾値で、これらに対してアラートポリシーを作成できます。
* **ダイナミックベースラインアラート**を使用すると、変化する周期的パターンや成長傾向（通常の動作を定義する閾値を設定することを困難にする）に対して、アプリケーションアラートの動的な閾値を判断・設定することが容易になります。これらのアラートは、アプリケーションの過去のメトリックデータからモデル化されたベースラインを使用します。

各アラートポリシーには必要なだけ条件を含めることができます。それぞれのアラート条件には次の3つのコンポーネントが含まれます。

* 条件のタイプ（メトリック、外部サービスなど）
* New Relic APMまたはNew Relic Browserが監視するアプリケーションや、New Relic Infrastructureが監視するホストなど、ポリシーのターゲットとなる[エンティティ](https://docs.newrelic.co.jp/docs/accounts-partnerships/education/getting-started-new-relic/glossary#alert-entity)。
* 深刻さが増した際にアラート状態に進行する閾値

アラートを設定したら、実行可能なすべての通知チャネルを利用していることを確認します。結局のところ、誰にも知られていないアラートには意味がありません。

アラートの管理は、特定のユーザーグループを作成し、Slack、PagerDuty、Campfire、Webhook、電子メールなど、New Relicの統合アラートチャネルを利用して行うことができます。アラートポリシーを定期的に評価して、常に有効であることを確認してください。

### 設定方法

以下の詳細なドキュメンテーションを参照してください。

* 動的なベースラインアラートを設定し、アプリケーションを選択するには、[標準的な手順に従ってください](https://docs.newrelic.co.jp/docs/alerts/new-relic-alerts/defining-conditions/create-baseline-alert-conditions)。メトリックのプレビューが予測ベースラインとともに表示されます。アプリケーションのメトリックを選択して、該当するベースラインを確認できます。それから、閾値スライダーを使用して、閾値をベースライン予測にどれだけ近づけるかを設定できます。
* Apdex設定に静的な閾値アラートを設定するには、[標準的な手順に従ってください](https://docs.newrelic.co.jp/docs/apm/new-relic-apm/apdex/change-your-apdex-settings)。
* アラート通知チャネルを設定するには、[標準的な手順に従ってください](https://docs.newrelic.co.jp/docs/alerts/new-relic-alerts/managing-notification-channels/notification-channels-controlling-where-send-alerts)。

## 4. キートランザクションを特定・設定する [#key-transactions]

お使いのアプリケーションの性質によっては、他のトランザクションよりも重要なトランザクションがあります。New Relicのキートランザクション機能は、エンドユーザーやアプリケーションのレスポンスタイム、コール数、エラー率など、アプリケーションで最も重要と考えられるトランザクションを厳密に監視するよう設計されています。キートランザクションのパフォーマンスが悪い場合は、通知のアラート閾値レベルを設定することもできます。

### 設定方法

1. メニューバーで、**詳細 > キートランザクション**の順に選択してから、**追加**を選択します。次にアプリケーションとウェブトランザクションを選択するか、選択したトランザクションから**Track as key transaction**を選択します。
2. キートランザクションの名前を入力し、**Track key transaction**を選択します。
3. オプション：選択したアプリケーションのエージェントがカスタムアラートに対応している場合は、New Relicが自動的に入力するデフォルト値を使用するか、 キーアラートトランザクションポリシーを編集して Apdex （Application Performance Index）とアラート閾値を設定します。
4. キートランザクションダッシュボードの詳細を表示するには、**View new key transaction**を選択します。

## 5. デプロイメント履歴を追跡する [#deployments]

開発チームが頻繁に新しいコードを投入する中、それぞれのデプロイメントがパフォーマンスに及ぼす影響を測定することは容易ではありません。これらの変更がアプリケーションに及ぼす影響を正確に把握する方法の1つに、デプロイメントレポートがあります。

これらのレポートには、直近のデプロイメントとエンドユーザーやアプリケーションサーバーのApdex （Application Performance Index）スコアへの影響、さらにレスポンスタイム、スループット、エラーが一覧表示されます。また直近のデプロイメントに関するエラーを見つけるために、詳細をドリルダウンして表示することも可能で、チケットを発行したり、チームと詳細を共有したりもできます。

### 設定方法

1. New Relicメニューバーから**APM >（選択したアプリケーション）> Events > Deployments**を選択します。
2. デプロイメント後のパフォーマンスを表示するには、選択したアプリケーションの**Recent events**セクションにあるOverviewダッシュボードに移動します。

チャート内の青色の縦線は、デプロイメントを示しています。デプロイメントに関する要約情報を表示するには、青色の縦線を指し示します。

## 6. APMレポートの確認 [#reporting]

New Relic APMはSLA、デプロイメント、容量からスケーラビリティ、ホスト使用状況レポートなどに至るまで、過去の傾向を浮き彫りにするさまざまなダウンロード可能なレポートツールを提供します。これらは役員や顧客への報告に最適な方法です。[レポートの完全なリスト](https://docs.newrelic.co.jp/docs/apm/reports)を参照し、役立ててください。

### 設定方法

1. New Relic APMのメニューバーから**Applications >（選択したアプリケーション）> Reports**を選択します。
2. 表示するレポートを選択します。
3. 共有するレポートを保存またはエクスポートする場合は、**Download this report as .csv**を選択すると、コンマで区切られた値でレポートが作成されます。

## 7. サービスマップで環境を見直す [#entire-environment]

アーキテクチャ内のアプリケーションとサービスがどのように接続・通信するかを理解するには、New Relic APMに含まれる[サービスマップ](https://docs.newrelic.co.jp/docs/data-analysis/service-maps/get-started/introduction-service-maps)機能を使用します。サービスマップは、アプリケーションアーキテクチャを可視化した[カスタマイズ可能な描写](https://docs.newrelic.co.jp/docs/apm/applications-menu/monitoring/customize-service-maps)です。マップには、データベースや外部サービスなど、お使いのアプリケーションの[接続先や依存関係](https://docs.newrelic.co.jp/docs/data-analysis/service-maps/get-started/introduction-service-maps#connections)が自動的に表示されます。[稼働状態インジケータやパフォーマンスメトリックス](https://docs.newrelic.co.jp/docs/data-analysis/service-maps/get-started/introduction-service-maps#health-performance)には、アーキテクチャのあらゆる構成要素についての現在の稼働状態ステータスが表示されます。

**設定方法**

1. **[one.newrelic.com](https://one.newrelic.com) > 詳細 > サービスマップ**の順に移動します。
2. 開始するには、[サービスマップの説明](/docs/understand-dependencies/understand-system-dependencies/service-maps/introduction-service-maps)にある説明をお読みください。

## 8. 最新の状態に保つ [#agents-current]

New RelicのSaaSプラットフォームでは、新機能の追加はエージェントの更新と同じくらい簡単です。大抵の組織では、アプリケーションのアップグレードを環境にディプロイするために、一連のスクリプトが用意されています。同じように、New Relicエージェントのデプロイメントを自動化して、システムを最新の状態に保つこともできます。[PuppetとChef](https://docs.newrelic.co.jp/docs/plugins/plugins-new-relic/installing-plugins/plugin-installation-chef-puppet)スクリプトは、共にデプロイメントフレームワークのよい例で、デプロイメントプロセスや管理プロセス全体の自動化を可能にすることで作業を軽減します。

### 設定方法

アップデートが必要なときに備えて、使用しているエージェントのバージョンを定期的に確認します。最新のエージェントリリースに、必要な修正または機能が追加されている場合は、ダウンロードします。

エージェントを自動的にディプロイするには、次の手順を実行します**（エラー防止の方法として推奨）**。

1. デプロイメントを処理するための変更が可能な場合、既存のデプロイメントスクリプトを使用します。

   または

   New Relicエージェントのディプロイ・設定に特化したスクリプトを作成・管理します。理想的に、スクリプトは（ロールバックができるよう）ファイルがバージョン管理されているリポジトリからエージェントファイルを取得します。
2. スクリプトが作成されたら、アプリケーションをシャットダウンします（スクリプトがシャットダウンを処理しない場合）。
3. デプロイメントスクリプトを実行します。
4. アプリケーションを起動します（スクリプトが起動を処理しない場合）。
5. 問題が発生した場合は、スクリプトを実行して以前のバージョンに戻します。

手動によるエージェントのディプロイ：

1. 現在のエージェントディレクトリをバックアップします。
2. 更新されたエージェントを、既存のエージェントディレクトリにディプロイします。
3. 新しい設定ファイルと既存の設定ファイルを比較して、ファイルを変更します。具体的には、ライセンスキーやカスタム拡張機能などが、新しい設定にコピーされるようにします。
4. アプリケーションを再起動します。
5. 問題が発生した場合は、バックアップを使用して古いエージェントを復元し、再起動します。

## 9. ユーザーアクセスの管理 [#sso]

<Callout variant="important">
  これは、[元の製品ベースの価格プラン](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing)についてのみご利用いただけます。
</Callout>

**ロールベースアクセス制御 (RBAC) とシングルサインオン (SSO) の有効化**

New Relicは、割り当てられたロールに関わらず、許可された個人が可能な限り広範囲のデータにアクセスできるようにします。New Relicアカウントの所有者または管理者として、個々のユーザーのアクセス権を制御する、またはRBACを使ってロール全体を制御することができます。実行可能な操作、および変更を行う方法については、[ユーザーとロール](https://docs.newrelic.co.jp/docs/accounts/accounts/roles-permissions/users-roles)を参照してください。

セキュリティは組織にとって最大の懸念事項です。従業員のパスワード管理を簡素化し、セキュリティを強化するために、すでに他のシステムでSSOをお使いかもしれません。New Relicでも同じようにする必要があります。

アカウントのアドミニストレーターは、New RelicのSSOインテグレーション機能を使用して強力なパスワードの義務づけや、企業の認証メカニズムを通じてのログイン制限を施行できます。このようにして、企業のSSOシステムですでに認証されているNew Relicユーザーは、New Relicのログインプロンプトをバイパスすることができます。

### 設定方法

1. New Relicに管理者としてログインし、SSO設定ページに移動します。New Relicのタイトルバーから**（アカウント名）> Account Settings > Integrations > Single Sign On**を選択します。
2. SAMLのシングルサインオンページで、New Relic SAMLサービスプロバイダーの詳細を確認します。
3. SAML IDプロバイダー証明書をアップロードするには、**File**を選択し、標準の手順に従ってファイルを選択・保存します。
4. ユーザーがシングルサインオンに使用する削除ログインURLをコピーして貼り付けるか、入力します。
5. 組織のSAMLインテグレーションによってログアウト用のリダイレクトURLが提供される場合は、**ログアウト用のランディングURL**をコピーして貼り付けるか、入力します。その他の場合は空白のままにします。
6. 保存してテストし、有効にします。

## その他のヘルプ [#more_help]

さらに支援が必要な場合は、これらのサポートと学習リソースを確認してください：

* [Explorers Hub](https://discuss.newrelic.com/)を参照して、コミュニティから支援を受け、ディスカッションに参加してください。
* [当社のサイトで回答を見つけ、サポートポータルの使用方法について学びます](/docs/using-new-relic/welcome-new-relic/get-started/find-help-use-support-portal)。
* Linux、Windows、およびmacOSのトラブルシューティングツールである[New Relic Diagnosticsを実行します](/docs/using-new-relic/cross-product-functions/troubleshooting/new-relic-diagnostics)。
* New Relicの[データセキュリティ](/docs/security)と[ライセンス](/docs/licenses)ドキュメントを見直してください。
