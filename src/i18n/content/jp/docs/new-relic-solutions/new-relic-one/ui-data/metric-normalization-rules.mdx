---
title: メトリックの正規化ルール
tags:
  - New Relic
  - Use New Relic
  - UI and data
metaDescription: How to create and manage rules in New Relic to deal with noise from high cardinality metrics and prevent metric grouping issues (MGIs).
freshnessValidatedDate: never
translationType: machine
---

メトリクスの正規化ルールは[、メトリクスのグループ化問題](/docs/using-new-relic/cross-product-functions/troubleshooting/metric-grouping-issues)(MGI) の管理に役立ちます。 これは、アプリケーションのパフォーマンス データの関連性を維持するのに役立ちます。 メトリクス正規化は[、メトリクス タイムスライス データ](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data)にのみ適用されます。

メトリクス正規化ルールを作成および管理して、次のことを行うことができます。

* [メトリックタイムスライスデータを](/docs/data-apis/understand-data/new-relic-data-types/#timeslice-data)グループ化またはフィルタリングする
* New Relicに報告される高いカーディナリティ メトリクスを管理する
* MGIを予防する
* `DENY_NEW_METRICS`ルールの自動作成を禁止する
* New Relicに報告される一意のメトリクス名の数を減らす

<Callout variant="important">
  メトリクスの数が非常に多い MGI が検出されると、プラットフォームをパフォーマンスの低下から保護するために、 `DENY_NEW_METRICS`ルールが自動的に作成されます。 この`DENY_NEW_METRICS`ルールは、以前にNew Relicに報告されたメトリクスには影響しません。
</Callout>

<Callout variant="tip">
  [NerdGraph](/docs/apis/nerdgraph/examples/nerdgraph-metric-normalization-rule/)を使用してメトリクス正規化ルールを作成することもできます。
</Callout>

## 複数のアプリにレポートするエージェント [#multi-app-agents]

エージェントが複数のアプリケーションに報告する場合、すべてのアプリケーションの正規化ルールがメトリクス データに適用されます。

次のシナリオを考えてみましょう。

* エージェントは`app1`に報告し、 `app2`
* ルール`r1`は `app1`
* ルール`r2`は `app2`

`r1`と`r2`は両方とも、エージェントによって送信されるすべてのメトリクス データに適用されます。

エージェント設定が`app2`のみにレポートするように変更された場合はどうなりますか? その場合、エージェントがレポートするアプリに定義されている唯一のルールであるルール`r2`のみが適用されます。

## メトリクス正規化を管理する [#manage-rules]

<DNT>**Metric normalization rules**</DNT>ページを使用して、エンティティの新しいメトリクス正規化ルールを作成および管理できます。

<CollapserGroup>
  <Collapser id="access-rules" title="メトリクスの正規化ルールを表示する">
    <DNT>**Metric normalization rules**</DNT>ページを表示するには、 <DNT>[https://one.newrelic.com](https://one.newrelic.com) &gt; **All Entities**</DNT> &gt; エンティティを選択 &gt; <DNT>**Settings** &gt; **Metric normalization** </DNT>に移動します。

    <img title="View details" alt="View MGI details" src="/images/Access_metric_rules.webp" />
  </Collapser>

  <Collapser id="create-metric-normalization-rule" title="メトリクス正規化ルールを作成する">
    メトリクス正規化ルールを作成するには:

    1. <DNT>**Metric normalization rules**</DNT>ページで、 **+ Create a new rule** \[+ 新しいルールを作成] をクリックします。
    2. 以下の詳細を入力してください。

    <table>
      <thead>
        <tr>
          <th>
            フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            **時間範囲**
          </td>

          <td>
            ルールのドロップダウン メニューから必要な時間範囲を選択します。
          </td>
        </tr>

        <tr>
          <td>
            **正規表現**
          </td>

          <td>
            正規化するメトリクスに一致する

            [正規表現](https://regexone.com/)

            パターンを入力します。 このフィールドは

            `^`

            で始まり、 

            `$`

            で終わる必要があります。どのメトリクスが正規化ルールの影響を受けるかを特定するパターンを定義します。 たとえば、 

            `^WebTransaction/Uri/RESTfulExample/users/username/[a-zA-Z0-9]+$`

            パターン

            `^[a-zA-Z0-9]+$`

            は、小文字

            `(a-z)`

             、大文字

            `(A-Z)`

             、および数字

            `(0-9)`

            で構成される任意の文字列と一致します。
          </td>
        </tr>

        <tr>
          <td>
            **正規表現の一致**
          </td>

          <td>
            **Regular expression**

             \[正規表現]フィールドと一致するメトリクスをプレビューします。
          </td>
        </tr>

        <tr>
          <td>
            **マッチをどうしたいですか？**
          </td>

          <td>
            **Regular expression** \[正規表現]フィールドに一致するメトリクスに対して実行する次のアクションのいずれかを選択します。

            * **Replace** : 一致したメトリクスを<DNT>Replacement</DNT>フィールドの値に置き換えます。
            * **Ignore** : 一致するメトリクスがNew Relicプラットフォームにレポートするのをブロックします。
            * **新しいメトリクスを無視する**: 既存のメトリクス名によるレポートの継続を許可しながら、新しいメトリクス名の作成を防止します。
          </td>
        </tr>

        <tr>
          <td>
            **置き換え**
          </td>

          <td>
            「置換」フィールドは、前のフィールドで

            **Replace**

             \[置換]オプションを選択した場合にのみ必要です。置換メトリクスを入力して、 

            **Regular expression**

             \[正規表現]フィールドに定義されている一致したメトリクスを置き換えます。
          </td>
        </tr>

        <tr>
          <td>
            **ルールの順序**
          </td>

          <td>
            ルールが他のルールに対して適用される順序を指定します。数字が小さいほど、評価される優先度が高くなります。推奨値は 

            `2000`
          </td>
        </tr>

        <tr>
          <td>
            **終了**
          </td>

          <td>
            有効にすると、このルールがメトリクスと正常に一致した後、追加のルールはメトリクスに適用されません。
          </td>
        </tr>

        <tr>
          <td>
            **アクティブ**
          </td>

          <td>
            ルールを有効または無効に切り替えます。
          </td>
        </tr>

        <tr>
          <td>
            **メモ**
          </td>

          <td>
            ルールに関する参考メモ。
          </td>
        </tr>
      </tbody>
    </table>

    3. クリック **保存**.
  </Collapser>

  <Collapser id="update-metric-normalization-rule" title="メトリクス正規化ルールを更新する">
    ### メトリクス正規化ルールを更新する [#update-rule]

    1. <DNT>**Metric normalization rules**</DNT>ページでルールを選択し、 <Icon name="fe-more-horizontal" />アイコンをクリックし、**Edit** \[編集]を選択します。
    2. 必要な詳細を更新します。
    3. クリック **保存**.
  </Collapser>
</CollapserGroup>

## メトリクス正規化ルールを無効にする [#disable-rule]

メトリクス正規化ルールは削除できませんが、非アクティブ化することはできます。 非アクティブ化されたルールは、 New Relicにレポートするメトリクスには影響しません。 `Denied rate (minute)`が 1000 の`resolution rate (minute)`を下回る場合、 **MGI details** \[MGI 詳細]ページから`DENY_NEW_METRICS`ルールを非アクティブ化できます。

ルールを非アクティブ化するには:

1. <DNT>**Metric normalization rules**</DNT>ページで必要なルールを選択し、 <Icon name="fe-more-horizontal" />アイコンをクリックし、 **MGI details** \[MGI の詳細を]クリックします。
2. **Deactivate** \[非アクティブ化]をクリックします。

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

## MGI詳細ページ [#mgi-details]

**<DNT>MGI details</DNT>**ページでは、メトリクスに適用されるメトリクス正規化ルールの包括的な概要が提供されます。 これにより、メトリクス データに対するこれらのルールの影響を分析し、高いカーディナリティ メトリクスの管理について情報に基づいた意思決定を行うことができます。

**MGI details** \[MGI 詳細]ページでは、次の情報を表示できます。

* **Blocked Metrics Overview \[ブロックされたメトリクスの概要]**: `DENY_NEW_METRICS`ルールの影響を受けるメトリクスの数 (メトリクスがブロックされる割合を含む) が表示されます。 同様のインサイトは、 `REPLACE`および`IGNORE`アクションで使用できます。
* **Time Picker Functionality \[タイムピッカー機能]**: ルールのアクティブ化前のメトリクス レポートをメトリクス プレフィックスごとに表示できます。 この機能は、メトリクスの成長の原因を特定するのに役立ちます。
* **NRQL Query Integration \[NRQL書き込み統合]**: ルールが適用される直前のメトリクス爆発を示すNRQL書き込みを表示する「書き込みビルダーで表示」ボタンを提供します。 このターゲット メトリックタイムスライス データにより、最大 3 か月の遡及分析が可能になります。
* **Metric Pattern Identification \[メトリクス パターンの識別]**: 爆発的なメトリクス パターンの識別と、それらを効果的に管理するための新しい正規表現ルールの作成を可能にします。
* **Real-Time Status Indicators \[ステータス インジケーター]**: 正規化ルールの現在のステータスを示すウィジェットが含まれており、ルールがメトリクスの成長を管理するにつれてインジケーターが「アクティブ」から「緩和」に変化します。
* **Rule Modification Capability \[ルール変更機能]**: ユーザーは、MGI 詳細ページから独自の`DENY_NEW_METRICS`ルールを直接非アクティブ化したり、サポート チケットなしで`REPLACE`ルールと`IGNORE`ルールを変更したりできます。詳細については、 [「ルールを無効にする」](#disable-rule)を参照してください。

### MGIの詳細ページにアクセスする [#access-mgi]

<DNT>**Metric normalization rules**</DNT>ページでルールを選択し、 <Icon name="fe-more-horizontal" />アイコンをクリックし、 **MGI details** \[MGI の詳細]を選択します。

<img title="View details" alt="View MGI details" src="/images/metric-details.webp" />

### 使用例 [#example-use-case]

上の例では、MGI の詳細ページに、110 万の一意のメトリクス名が、 `DENY_NEW_METRICS`ルールによって 1 分あたり 738 メトリクスの割合でブロックされていることが表示されます。 この成長の大部分はネームスペースへのトレースです`WebTransaction/Uri/RESTfulExample/users/username/` 。 NRQL書き込みを表示すると、爆発の原因を正確に特定でき、メトリクスを効果的に管理するための新しいルールを作成できます。