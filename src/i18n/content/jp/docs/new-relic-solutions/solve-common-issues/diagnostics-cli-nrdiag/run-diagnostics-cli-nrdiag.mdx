---
title: 診断用CLI（nrdiag）の実行
tags:
  - Using New Relic
  - Cross-product functions
  - Diagnostics CLI (nrdiag)
metaDescription: How to run the New Relic Diagnostics CLI (nrdiag) and upload results to a support ticket.
translationType: machine
---

<ButtonLink
  role="button"
  to="https://download.newrelic.com/nrdiag/nrdiag_latest.zip"
  variant="primary"
>
  最新版のダウンロード
</ButtonLink>

Diagnostics CLIを使用するには

1. [リリースノート](/docs/release-notes/diagnostics-release-notes/diagnostics-cli-release-notes/) を見て、最新バージョンであることを確認してください。
2. [Linux、macOS、Windows 用の実行ファイルを含む最新版](https://download.newrelic.com/nrdiag/nrdiag_latest.zip) をダウンロードできます。
3. お使いのプラットフォーム用の実行ファイルを、アプリケーションのルートディレクトリ [の場所に移動します。](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)
4. [](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)
5. [より正確なトラブルシューティングのために、New Relic エージェントの ](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)[ロギングレベル](/docs/agents/manage-apm-agents/troubleshooting/new-relic-agent-logs-troubleshooting) を一時的に引き上げます。ロギングレベルを変更した後、アプリケーションを再起動してください。
6. 実行可能ファイルを実行します。**推奨事項：**トラブルシューティングの範囲をより簡単にするには、[タスクスイート](#suites)（CLIオプション）を使用して`nrdiag`を実行します。

Diagnostics CLIは、ルート・ディレクトリとサブ・ディレクトリを自動的に検索して、エージェント構成ファイルやその他の関連データを探します。

## プラットフォーム固有の手順 [#platform]

Diagnostics CLIを実行するには、お使いのプラットフォームの手順に従ってください。

<CollapserGroup>
  <Collapser
    id="linux-run"
    title="Linux"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、ディレクトリをアプリケーションのルートディレクトリに変更し、 `nrdiag.zip`ファイルが存在することを確認します。

         また

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて`nrdiag.zip`を解凍します。

    3. `nrdiag_1.2.3/linux`ディレクトリから、 `nrdiag`をアプリケーションのルートディレクトリに移動します。

    4. `nrdiag`を実行します（ [CLIオプション](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)と一緒に）

       ```
       ./nrdiag CLI_OPTIONS
       ```

       Diagnostics CLIは、発見した問題を出力し、添付フラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="macos-run"
    title="マックOS"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、ディレクトリをアプリケーションのルートディレクトリに変更し、 `nrdiag.zip`ファイルが存在することを確認します。

         また

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて`nrdiag.zip`を解凍します。

    3. `nrdiag_1.2.3/mac`ディレクトリから、 `nrdiag`をアプリケーションのルートディレクトリに移動します。

    4. `nrdiag`を実行します（ [CLIオプション](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)と一緒に）

       ```
       ./nrdiag CLI_OPTIONS
       ```

       Diagnostics CLIは、発見した問題を出力し、添付フラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="windows-run"
    title="ウィンドウズ"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、ディレクトリをアプリケーションのルートディレクトリに変更し、 `nrdiag.zip`ファイルが存在することを確認します。

         また

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて`nrdiag.zip`を解凍します。

    3. `nrdiag_1.2.3/win`ディレクトリから、 `nrdiag.exe`または`nrdiag_x64.exe`をアプリケーションのルートディレクトリに移動します。

    4. Webアプリケーションのトラブルシューティングを行うには、プロジェクトの**親**ディレクトリから実行可能ファイルを実行していることを確認するか、 `-c`オプションを使用して構成ファイルの場所を指定します。

    5. バイナリを配置したディレクトリから、実行ファイル（任意の [CLIオプションと一緒に）](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag) を実行します。一部のチェックには昇格したパーミッションが必要なため、最良の結果を得るためには管理者シェルから実行してください。

       `CLI_OPTIONS`を追加した場合は、PowerShell経由で実行します。

       ```
       ./nrdiag.exe CLI_OPTIONS
       ```

       **OR** 、x64システムの場合。

       ```
       ./nrdiag_x64.exe CLI_OPTIONS
       ```

       Diagnostics CLI は、発見した問題を出力し、添付ファイルフラグを含めると関連ファイルを New Relic アカウントにアップロードします。
  </Collapser>

  <Collapser
    id="browser-run"
    title="ブラウザのモニタリング"
  >
    1. Diagnostics CLI の最新バージョンがあることを確認します。必要に応じて、 [手動で最新バージョンをダウンロードしてください](https://download.newrelic.com/nrdiag/nrdiag_latest.zip) 。

    2. 必要に応じて`nrdiag.zip`を解凍します。

    3. `nrdiag_1.2.3/` OS ディレクトリから、 `nrdiag`を実行します ( [CLI オプション](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)とともに:

       ```
       ./nrdiag -browser-url WEBSITE_URL CLI_OPTIONS
       ```

       Diagnostics CLIは、発見した問題を出力し、添付ファイルフラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="docker"
    title="Dockerコンテナ"
  >
    Dockerコンテナで実行されているNewRelicでインストルメント化されたアプリケーションのトラブルシューティングを行うには、 `docker exec`コマンドを使用します。

    1. `nrdiag_latest.zip`ファイルを[ダウンロード](https://download.newrelic.com/nrdiag/nrdiag_latest.zip)して解凍します。

    2. バイナリをコンテナにコピーします。 `IMAGE_NAME`をDockerコンテナの名前に置き換えます。

       ```
       docker cp nrdiag/linux/nrdiag IMAGE_NAME:/bin
       ```

    3. Dockerコンテナで`nrdiag`コマンドを実行します。上記のように`IMAGE_NAME`を置き換え、 `APPLICATION_ROOT`をNewRelicエージェントをインストールしたアプリケーションのルートディレクトリに置き換えます。

       ```
       docker exec -it -w APPLICATION_ROOT IMAGE_NAME nrdiag
       ```

    4. （オプション）終了したら、 `nrdiag`バイナリを削除します。

       ```
       docker exec IMAGE_NAME rm /bin/nrdiag
       ```
  </Collapser>
</CollapserGroup>

## スイーツフラグ（CLIオプションとして強く推奨） [#suites]

スイートとは、特定の製品や問題を対象としたヘルスチェックの集合体のことです。スイートを使用することで、トラブルシューティングの範囲を狭めたり、誤検知の発生を減らすことができます。

使用可能なスイートのリストを確認するには、 `-help suites`オプションを指定してDiagnosticsCLIを実行します。

```
./nrdiag -help suites
```

`nrdiag`でスイートを実行するには、引数として実行する`-suites`フラグと1つ以上のスイート名（たとえば、 `java` ）を指定します。

**LinuxとmacOS：**

* 32ビットシステムの場合

  ```
  ./nrdiag -suites SUITE NAMES
  ```

* 64ビットシステムの場合

  ```
  ./nrdiag_x64 -suites SUITE NAMES
  ```

**ウィンドウズ：**

PowerShellから実行するには、 `cmd`の先頭に`./`を追加します。

* 32ビットシステムの場合

  ```
  nrdiag.exe -suites SUITE NAMES
  ```

* 64ビットシステムの場合

  ```
  nrdiag_x64.exe -suites SUITE NAMES
  ```

## zipに追加のファイルを含める [#include-additional-files]

サポートと共有したい追加のファイルがある場合は、 `-include`コマンドラインフラグを使用してそれらを`nrdiag-output.zip`ファイルに含めることができます。これは、単一のファイルまたはディレクトリで使用できます。ディレクトリが提供されている場合、そのすべてのサブディレクトリが含まれます。含まれるファイルの合計サイズ制限は4GBです。

これを`-attach`と組み合わせて使用[し、ファイルをNewRelicアカウントにアップロードします](#attach-account-results)。

**LinuxとmacOS：**

* 32ビットシステムの場合

  ```
  ./nrdiag -include ./path/to/file -attach
  ```

* 64ビットシステムの場合

  ```
  ./nrdiag_x64 -include /entire/directory/ -attach
  ```

**ウィンドウズ：**

PowerShellから実行するには、 `cmd`の先頭に`./`を追加します。

* 32ビットシステムの場合

  ```
  nrdiag -include Path\To\File -attach
  ```

* 64ビットシステムの場合

  ```
  nrdiag_x64.exe -include \Entire\Directory\ -attach
  ```

## 結果をNew Relicアカウントにアップロード [#attach-account-results]

<Callout variant="important">
  システムが外部IPアドレスに接続し**ない**ように構成されている場合、この方法は機能しません。代わりに、 [出力ファイル](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/interpret-nrdiag-output)をメールでNewRelicSupportに添付してください。ライセンスキーに問題がある場合は、サポートのために出力ファイルを電子メールで送信する必要もあります。
</Callout>

### アカウントの自動アップロード [#automatic]

Diagnostics CLIの実行時に結果をNewRelicアカウントに自動的にアップロードするには、 `-attach`または`-a`コマンドラインフラグを使用します。これにより、ご使用の環境で見つかったNewRelicライセンスキーをアップロード用に検証します。

結果をアカウントにアップロードすると、 `nrdiag-output.json`と`nrdiag-output.zip`のコンテンツが自動的にアップロードされます。

**LinuxとmacOS：**

* 32ビットシステムの場合

  ```
  ./nrdiag -attach
  ```

* 64ビットシステムの場合

  ```
  ./nrdiag_x64 -attach
  ```

**ウィンドウズ：**

PowerShellから実行するには、 `cmd`の先頭に`./`を追加します。

* 32ビットシステムの場合

  ```
  nrdiag.exe -attach
  ```

* 64ビットシステムの場合

  ```
  nrdiag_x64.exe -attach
  ```