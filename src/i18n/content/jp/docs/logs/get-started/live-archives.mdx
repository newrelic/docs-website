---
title: ライブアーカイブによる長期ログストレージ
tags:
  - Logs
  - Log management
  - Get started
metaDescription: Store your logs with New Relic for up to seven years using live archives.
signupBanner:
  text: Monitor and improve your entire stack. 100GB free. Forever.
freshnessValidatedDate: never
translationType: human
---

ライブアーカイブを使用すると、必要な期間ログを保存できます。 New Relicのログ保持期間はデフォルトで30日間ですが、ライブアーカイブを使用すると、その期間を最大7年まで延長できます。古い税務書類と同様に、データを手元に置く必要がない場合もありますが、必要に応じて参照できるように情報を保管しておくと安全です。

ライブアーカイブが必要ですか？この機能のメリットを享受できるユースケースをいくつか紹介します。

* <DNT>
    **Internal retention requirements**
  </DNT>

  ：貴社では、ログを一定期間保存することを義務付けるポリシーがありますか？ライブアーカイブの保存期間を延長することで、要件を満たすことができる場合があります。

* <DNT>
    **Trends and long-term debugging**
  </DNT>

  : ログを長期保存すると、前年比のパフォーマンスが向上します。たとえば、小売会社を管理している場合、あるホリデーシーズンと次のホリデーシーズンのログを比較すると、パフォーマンスを向上させる方法を確認できます。

## ライブアーカイブの仕組み [#how-it-works]

ライブアーカイブ機能は、ストレージコスト削減のためにクエリを控えめに実行するための長期ログデータストレージを提供します。ライブアーカイブを使用すると、潜在的な監査や長期的なデバッグのためにログが長期間利用できるため、安心できますが、古いデータの保存とクエリには別途料金がかかります。

## スタートガイド

<Steps>
  <Step>
    ### ライブアーカイブを有効にする [#enable]

    まず、ライブアーカイブ機能をリクエストする必要があります。

    1. [データ管理ハブ](https://one.newrelic.com/data-management-hub)にある

       <DNT>
         **Data retention**
       </DNT>

       UIページ。

    2. <DNT>
         **Logging live archives**
       </DNT>

       までスクロールダウンします。

    3. <DNT>
         **Request**
       </DNT>

       をヒットします。弊社チームの担当者からご連絡させていただきます。
  </Step>

  <Step>
    ライブアーカイブを有効にしたら、データ保持期間を編集する必要があります。

    1. [データ管理ハブ](https://one.newrelic.com/data-management-hub)にある

       <DNT>
         **Data retention**
       </DNT>

       UIページで、

       <DNT>
         **Edit data retention**
       </DNT>

       を選択します。

    2. <DNT>
         **Logging live archives**
       </DNT>

       までスクロールダウンし、データを保存する合計日数を入力します。これには標準の保持日数が含まれることに注意してください。

    3. <DNT>
         **Apply changes**
       </DNT>

       をクリックします。

       データ保持期間を編集するには[管理者権限](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts/#roles)が必要です。

       <img
         title="edit data retention"
         alt="A screenshot showing users how to edit their data retention."
         src="/images/logs_screenshot-crop_edit-data-retention-live-archives.webp"
       />
  </Step>

  <Step>
    ### ライブアーカイブを使用してパーティションを作成する [#partitions]

    パーティションは、特定の基準に基づいてログをグループ化する方法です。パーティションを作成すると、不要なログをフィルタリングして除外し、ライブアーカイブで作成したログを保持するのに役立ちます。

    1. <DNT>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs**</DNT>に移動します。

    2. ログクエリバーの左側にある<DNT>**Data partitions**</DNT>をクリックし、次に<DNT>**Create data partition**</DNT>をクリックします。

    3. パーティション名を、Logで始まる英数字の文字列として定義します。

    4. <DNT>**Use live archives on this partition**</DNT>フィールドを選択します。

       <img
         title="create a live archives partition"
         alt="A screenshot showing a user how to create a partition using live archives"
         src="/images/logs_screenshot-crop_create-a-partition-using-live-archives.webp"
       />

       <figcaption>
         <DNT>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs > Data partitions**</DNT>に移動して、ライブアーカイブを使用してパーティションを作成します。
       </figcaption>

    5. <DNT>**Total effective retention**</DNT>日は、通常の保存期間_と_[ライブアーカイブの保持期間](/docs/logs/get-started/live-archives-billing/#what-counts)を反映して更新されます。

       <DNT>**Data partitions**</DNT>ページの<Icon name="fe-more-horizontal"/>アイコンをクリックして、既存のパーティションを編集することもできます。既存のパーティションを使用する場合は、元のパーティションに選択したのと同じパラメーターがライブアーカイブデータに適用されます。

       <img
         width="60%;"
         title="Edit a live archives partition"
         alt="A screenshot showing a user how to edit a partition using live archives"
         src="/images/logs_screenshot-crop_edit-data-partition-using-live-archives.webp"
       />

       パーティションの使用方法の詳細については、[パーティションを使用してデータを整理する](/docs/logs/ui-data/data-partitions/)のドキュメントを参照してください。
  </Step>

  <Step>
    ## ログをクエリする

    ライブアーカイブをクエリするには、Lucene、NRQL、NerdGraph APIのNRQLなど、いくつかの方法があります。これら3つの方法すべてにおいて、ライブアーカイブをクエリするには、**Live archives query** \[ライブアーカイブクエリ]機能が必要になります。

    ### Luceneクエリ構文を使用してライブアーカイブをクエリする [#query]

    Luceneクエリ構文に精通している場合は、 <DNT>**Logs**</DNT> UIで実行できます。

    1. <DNT>
         **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs**
       </DNT>

       に移動します。

    2. 検索バーを使用して、目的のクエリを実行します。最初にクエリを練習して、クエリが期待どおりに動作することを確認することが最善です。

    3. クエリを実行する日付を選択します。

    4. ライブアーカイブをクエリしようとしていることが画面に表示されます。ライブアーカイブのクエリにはコストがかかるため、準備ができている場合にのみ

       <DNT>
         **Query live archives**
       </DNT>

       を選択してください。

       <img
         title="lucene live archives"
         alt="A screenshot showing a user how to query live archives in the logs UI"
         src="/images/logs_screenshot-crop_lucene-live-archives.webp"
       />

       <figcaption>
         <DNT>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs**</DNT>に移動して、ライブアーカイブに保存されているデータをクエリします。
       </figcaption>

       ### NRQLを使用してライブアーカイブをクエリする [#nrql]

       Errors Inboxまたはアラートに使用するのと同じ言語を使用してクエリを実行する場合は、NRQLでクエリを実行することをお勧めします。

    5. <DNT>
         **[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs**
       </DNT>

       に移動します。

    6. 右上隅の**NRQL**をクリックします。

    7. 実行するNRQLクエリを入力します。

    8. まずクエリを練習して、クエリが期待どおりに動作することを確認してください。

    9. <DNT>
         **Use live archives**
       </DNT>

       を切り替えます。

    10. ライブアーカイブをクエリしようとしていることが画面に表示されます。ライブアーカイブのクエリにはコストがかかるため、準備ができている場合にのみ

        <DNT>
          **Query live archives**
        </DNT>

        を選択してください。

        <img
          title="nrql live archives"
          alt="A screenshot showing a user how to query live archives with NRQL"
          src="/images/logs_screenshot-crop_query-live-archives-nrql.webp"
        />

        <figcaption>
          <DNT>**[one.newrelic.com > All capabilities](https://one.newrelic.com/all-capabilities) > Logs**</DNT>に移動し、<DNT>**NRQL**</DNT>を選択して、クエリビルダーを使用してライブアーカイブに保存されているデータをクエリします。
        </figcaption>

        ### Nerdgraph APIを使用してライブアーカイブをクエリする [#api]

        NerdGraph APIのNRQLを使用してライブアーカイブデータをクエリすることもできます。ライブアーカイブ`eventNamespace`を指定するには、NRQLオプションに`{eventNamespaces: "Logging:Archive"}`を含める必要があります。

        クエリの例を次に示します。

        ```
        query {
          actor {
            account(id: 1234567) {
              nrql(
                query: "SELECT count(*) FROM Log SINCE '2024-02-01 12:00:00' UNTIL '2024-02-01 13:00:00'"
                options: {eventNamespaces: "Logging:Archive"}
                async: true
              ) {
                results
              }
            }
          }
        }
        ```
  </Step>

  <Step>
    ### データ消費量を確認する [#data-consumption]

    ライブアーカイブの料金は、残りのログとは異なります。詳細については、[ライブアーカイブストレージ：請求とルールのドキュメント](/docs/logs/get-started/live-archives-billing/)を参照してください。ライブアーカイブには3つの課金の柱があります。

    * <DNT>
        **Data**
      </DNT>

      ：最初に通常のログを取り込んだときに料金が発生します。

    * <DNT>
        **Storage**
      </DNT>

      ：ライブアーカイブでは、データをライブアーカイブに保存するために料金がかかります。

    * <DNT>
        **Compute**
      </DNT>

      ：ライブアーカイブデータのクエリは計算容量ユニットで課金されます。計算容量ユニットの詳細については、[利用プランのドキュメント](https://docs.newrelic.com/docs/licenses/license-information/usage-plans/new-relic-usage-plan/#list-price)を参照してください。

      <DNT>**Plan & Usage**</DNT>ページでデータストレージを確認するには：

    1. <DNT>
         **[one.newrelic.com](https://one.newrelic.com/)**
       </DNT>

       に移動し、ユーザーメニューをクリックし、次に

       <DNT>
         **Administration**
       </DNT>

       をクリックして

       <DNT>
         **Plan & usage**
       </DNT>

       ページを開きます。

    2. <DNT>
         **Retention (GB-month)**
       </DNT>

       までスクロールダウンします。

    3. ストレージの内訳の詳細については、

       <DNT>
         **View more details**
       </DNT>

       をクリックしてください。

       ライブアーカイブをクエリすると、計算管理ハブで計算消費量を調査できます。

    4. <DNT>
         **[one.newrelic.com](https://one.newrelic.com/)**
       </DNT>

       に移動し、ユーザーメニューをクリックしてから、

       <DNT>
         **Administration**
       </DNT>

       をクリックします。

    5. <DNT>
         **Compute management**
       </DNT>

       を選択します。

    6. <DNT>
         **Product capabilities**
       </DNT>

       までスクロールダウンします。

    7. <DNT>
         **Logs**
       </DNT>

       を選択します。

    8. <DNT>
         **Data category**
       </DNT>

       によるファセットにより、ライブアーカイブの計算消費量が表示されます。
  </Step>
</Steps>

## 例 [#examples]

9月1 日にチケットを履行するためにユーザーが自分のコンピューターからマシンにログインしたかどうかを確認する必要があるとします。次の手順を実行すると、ライブアーカイブを使用してこれが行われたことを確認できます。

1. ユーザーがマシンにログインした時間枠を確認してください。

2. <DNT>**Logs**</DNT>でクエリをテストして、期待どおりに動作することを確認します。これはドライランであり、データは返されませんが、クエリを検証するだけです。うまくいけば、アーカイブされたログに対してより負荷の高いクエリを実行できます。

   クエリの例：

   ```
   "logtype":"linux_audit" "type":"USER_LOGIN" "hostname":"apache_svr01"
   ```

3. ユーザーがマシンにログインした日付を検索するには、時間セレクターを変更します。

4. <DNT>**Query live archives**</DNT>を選択します。

## データの削除 [#delete]

データ保持期間を短縮したい場合は、次の点に注意してください。

* データ保持期間を編集するには管理者権限が必要です。
* _後でデータ保持期間を短縮すると、データを復元できなくなります。保存期間は慎重に選択して設定してください。_
* データの削除は、保持期間を短縮した日から有効になります。
* 任意の日数のデータの削除をリクエストできます。選択した日付のライブアーカイブデータをすべて削除します。
* 日はUTC境界で始まり、終わるので、リクエストを行うときは必ずUTCに合わせてください。つまり、1日を加算したり減算したりしてください。

<Callout variant="important">
  誤解を避けるために付け加えておきますが、New Relicは、アカウントのダウングレード後や契約失効後、またはお客様が該当する商用要件を満たしていない場合には、ライブアーカイブにデータを保持する義務を負いません。
</Callout>

<DocTiles>
  <DocTile
    title="Understand how live archives billing works"
    number="1"
    path="/docs/logs/get-started/live-archives-billing"
  />

  <DocTile
    title="Learn more about creating data partitions"
    number="2"
    path="/docs/logs/ui-data/data-partitions/"
  />

  <DocTile
    title="Query your logs"
    number="3"
    path="/docs/logs/ui-data/query-syntax-logs/"
  />
</DocTiles>
