---
title: infrastructureエージェントを用いたログの転送
tags:
  - Logs
  - Enable log management in New Relic
  - Enable log monitoring in New Relic
metaDescription: 'How to forward your logs to New Relic using our infrastructure agent, so you can use enhanced log management capabilities.'
freshnessValidatedDate: never
translationType: human
---

ログをNew Relicに転送すると、すべてのログデータが1か所で利用できるようになり、アプリケーションとプラットフォームのパフォーマンスデータへの可視性が高まります。ログを1か所にまとめて、ログデータ内で見つかったエラーや異常を収集、処理、探索、照会、集計することができます。

<img title="Logs in context for a host" alt="Screenshot of logs in context for a host" src="/images/logs_full_host_logs_ui.webp" />

<figcaption>
  ホストのUIから、選択した期間のイベントのコンテキストでログが配置されます。強調表示された属性の詳細データにドリルダウンできます。
</figcaption>

infrastructureエージェントがログ転送機能を有効にするため、ログの転送方法はinfrastructureエージェントのインストール方法によって異なります。infrastructureエージェントは次の方法でインストールできます。

* ガイド付きインストール（ほとんどのユーザーに推奨）
* 手動インストレーション
* Linux tarball

<Callout variant="important">
  Linuxバージョンのinfrastructureエージェント（具体的にはバージョン1.42.0）は、ttd-agent-bitパッケージからfluent-bitパッケージに移行しました。この変更は、メジャーバージョン2.xのアップデート以降、fluent-bitがtd-agent-bitフレーバーで配布されなくなったために必要になったものです。

  スムーズな運用を確保し、fluent-bitパッケージに問題が発生した場合にtd-agent-bitパッケージに戻せるよう、infrastructureエージェントは両方のパッケージ（td-gent-bitとfluent-bit）をインストールします。デフォルトでは、エージェントはfluent-bitを使用するように設定されています。

  ロールバックの方法の詳細については、 「[Fluent Bit 1.9へのロールバック](#rollback-after-fluent-bit-2)」を参照してください。
</Callout>

<Callout variant="tip">
  ログがたくさんありますか？[それらを最適化および管理する方法については、チュートリアル](/docs/tutorial-large-logs/get-started-managing-large-logs/)をご覧ください。
</Callout>

## システム要件 [#system]

* infrastructureエージェントバージョン1.11.4以降
* [Fluent Bit](https://fluentbit.io/) 。infrastructureエージェントは最新バージョンをすでにインストールしています。特定のバージョンに更新またはダウングレードするには、 [Fluent Bitインストレーション](#install-fb-version)手順を参照してください。
* OpenSSLライブラリ1.1.0以降
* Linuxシステム上のARM64 architecture（AWS Graviton architectureなど）の組み込みサポートがinfrastructureエージェント[1.20.6](https://github.com/newrelic/infrastructure-agent/releases/tag/1.20.6)に追加されました。
* Amazon Linux 2および2023
* CentOSバージョン8および9ストリーム（Rocky LinuxおよびAlmaLinuxもサポート対象です）
* RedHatバージョン8および9
* Debianバージョン11（Bullseye）および12（Bookworm）。
* SUSE Linux Enterprise Server（SLES）バージョン12および15（ARM64はサポート対象外です）。
* Ubuntuバージョン16.04.x、18.04.x、20.04.x、22.04.x、24.04.x（LTSバージョン）。
* Windows Server 2016、2019、2022およびそれらのサービスパック。
* Windows10、Windows11。

## ガイド付きインストールでログを自動的に転送する [#infra]

ガイド付きインストールを使用してinfrastructureエージェントをインストールすると、インストールプロセス中にログ転送機能が自動的に設定されます。

インストールを開始するには、導入方法を選択してください。

<TechTileGrid>
  <TechTile name="Amazon Linux" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_Amazon-linux.webp" alt="Amazon Linux" variant="TechTile"/>} />

  <TechTile name="Ansible" to="/docs/infrastructure/new-relic-infrastructure/config-management-tools/configure-new-relic-infrastructure-using-ansible" icon={<img src="/images/os_icon_ansible-red.webp" alt="Ansible" variant="TechTile"/>} />

  <TechTile name="CentOS" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_centos.webp" alt="CentOS" variant="TechTile"/>} />

  <TechTile name="Debian" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_debian.webp" alt="Debian" variant="TechTile"/>} />

  <TechTile name="RHEL" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_redhat.webp" alt="Red Hat" variant="TechTile"/>} />

  <TechTile name="SLES" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_suse.webp" alt="SLES" variant="TechTile"/>} />

  <TechTile name="Ubuntu" to="https://one.newrelic.com/marketplace?state=8f14e646-461e-b010-4675-3a0658bb3d20" icon={<img src="/images/infrastructure_logo_ubuntu.webp" alt="Ubuntu" variant="TechTile"/>} />

  <TechTile name="Windows" to="https://one.newrelic.com/marketplace?state=a792b092-300f-a5a4-ff62-510f4e0c52a5" icon={<img src="/images/infrastructure_logo_windows.webp" alt="Windows" variant="TechTile"/>} />
</TechTileGrid>

<Callout variant="important">
  Dockerコンテナからログを転送するには、この[Dockerイメージ](https://hub.docker.com/r/newrelic/newrelic-fluentbit-output)をKubernetesログインテグレーションで使用するベースのイメージとして使用するか、各環境に合わせたカスタム設定を使用して独自のコンテナを構築することができます。
</Callout>

## 手動でインストールしたエージェントでログ転送を有効にする [#manual]

infrastructureエージェントを手動でインストールするには、 [チュートリアルに従ってパッケージマネージャーをインストールする](/docs/infrastructure/install-infrastructure-agent/linux-installation/install-infrastructure-agent-linux-using-package-manager)か、 [MSIインストーラ](/docs/infrastructure/install-configure-manage-infrastructure/windows-installation/install-infrastructure-windows-server-using-msi-installer)（ Windows）を確認してください。

### ステップ 1. infrastructureエージェントを設定する

設定ファイルは、New Relicに表示するログソースを転送するようにシステムに指示します。必要な数だけ設定ファイルを追加できます。当社のinfrastructureエージェントは、 `.yml`ファイルを使用してログ記録を設定します。UIの[インテグレーションおよびエージェント](https://one.newrelic.com/marketplace?state=78678a7f-91c5-ca40-ac55-e6b74a50085c)を介してinfrastructureエージェントをインストールすると、ファイル「`logging.yml`」が自動的に作成されます。

ログ転送機能の新しい設定ファイルを追加するには：

1. ログフォワーダー設定フォルダーに移動します。

   * Linux： `/etc/newrelic-infra/logging.d/`
   * Windows： `C:\Program Files\New Relic\newrelic-infra\logging.d\`

2. 設定ファイル「`logging.yml`」を作成し、必要なパラメーターを追加します。`logging.d`ディレクトリには、参照または開始点として使用できるさまざまな`.yml.example`ファイルがあります。Windowsの例については、 [Githubリポジトリを](https://github.com/newrelic/infrastructure-agent/tree/master/assets/examples/logging/windows)参照してください。

   ```yml
   # Log forwarder configuration file example
   # Source: file
   # Available customization parameters: attributes, max_line_kb, pattern
   logs:
     # Basic tailing of a single file
     - name: basic-file
       file: /var/log/logFile.log

     # File with spaces in its path. No need to use quotes.
     - name: file-with-spaces-in-path
       file: /var/log/folder with spaces/logFile.log

     # Specify a list of custom attributes, as key-value pairs, to be included
     # in each log record
     - name: file-with-attributes
       file: /var/log/logFile.log
       attributes:
         application: tomcat
         department: sales
         maintainer: example@mailprovider.com

     # Use wildcards to refer to multiple files having a common extension or
     # prefix. Newly generated files will be automatically detected every 60
     # seconds.
     #
     # WARNING: avoid using wildcards that include the file extension, since
     # it'll cause logs to be forwarded repeatedly if log rotation is enabled.
     - name: log-files-in-folder
       file: /var/log/logF*.log

     # Lines longer than 128 KB will be automatically skipped. Use 'max_line_kb'
     # to increase this limit.
     - name: log-file-with-long-lines
       file: /var/log/logFile.log
       max_line_kb: 256

     # Use 'pattern' to filter records using a regular expression
     - name: only-records-with-warn-and-error
       file: /var/log/logFile.log
       pattern: WARN|ERROR
   ```

エージェントは、インフラストラクチャ監視サービスを再起動することなく、新しい設定ファイルを自動的に処理します。唯一の例外は、カスタムFluent Bit設定を設定する場合です。

### ステップ 2. ログ転送のパラメーターを設定する [#parameters]

ログ転送の設定ファイル（`.yml`）`name`でログソースパラメーターを設定する必要があります。まず、 New Relicに転送するログの`name`を定義します。

ログソースに何を使用するかは、ログのソース元の場所によって異なります。ログソースに使用できるオプションは次のとおりです。

<CollapserGroup>
  <Collapser id="file" title="ファイル">
    ログファイルへのパス。エージェントは、 `tail -f`シェルと同様の方法でログファイルの変更を追跡します。

    <DNT>
      **Example:**
    </DNT>

    ```yml
    logs:
      - name: example-log
        file: /var/log/example.log     # Path to a single log file
      - name: example-log-two
        file: /var/log/example-two.log # Path to another single log file
    ```

    `file`パラメーターは、名前と拡張子に適用されるワイルドカードを使用して、特定のログファイルまたは複数のファイルを指すことができます（例： `/logs/*.log` ）。ファイルパス内のディレクトリの代わりにワイルドカードを使用できます。これを使用すると、異なるディレクトリにあるファイルを追跡できます。

    <DNT>
      **Example:**
    </DNT>

    ```yml
    logs:
      - name: docker-logs
        file: /var/lib/docker/containers/*/*.log # Path to multiple folders and files
    ```

    <Callout variant="important">
      ワイルドカードを使用すると、ファイル記述子の数が大幅に増加し、Fluent Bitプロセスが開いたままになっているinotify watchが増える可能性があります。これにより、ホストのファイル記述子の制限に達した場合にログ収集が妨げられる可能性があります。多数のファイルをtailする場合は、OS で許可されているファイル記述子とinotifyウォッチャーの最大数を増やす必要がある場合があります。ログファイルを増やす方法の詳細については、「[大量のログファイルを追跡するときのエラー](#too-many-files)」を参照してください。
    </Callout>
  </Collapser>

  <Collapser id="systemd" title="SystemD">
    Linux 環境で`journald`デーモンによって収集されたログメッセージを転送するには、 `systemd`パラメーターを使用します。この入力タイプでは、エージェントを[rootモード](/docs/infrastructure/install-configure-infrastructure/linux-installation/linux-agent-running-modes)で実行する必要があります。

    <DNT>
      **Example:**
    </DNT>

    ```yml
    logs:
      - name: systemd-example
        systemd: cupsd
    ```
  </Collapser>

  <Collapser id="syslog" title="Syslog">
    Syslogデータソース。

    <DNT>
      **Parameters:**
    </DNT>

    * `uri:` Syslogソケット。フォーマットはプロトコルによって異なります。

      * TCP/UDPネットワークソケット： `[tcp/udp]://LISTEN_ADDRESS:PORT`
      * Unix ドメインソケット： `unix_[tcp/udp]:// + /socket/path`

    * `parser:` Syslog パーサー。デフォルトは`rfc3164`です。メッセージに小数秒が含まれる場合は`rfc5424`使用します。注意：`rfc3164`現在、SuSEでは動作しません。

    * `unix_permissions:` ドメインソケットのデフォルトは`0644`です。これにより、エントリはrootとして実行されているプロセスに制限されます。`0666`使用して、非ルートプロセスをリッスンすることができます（自己責任）。

      エージェントを[特権モード](/docs/infrastructure/install-configure-infrastructure/linux-installation/linux-agent-running-modes)で実行する場合、他のプロセスがソケットにログを書き込むことができるように、ポートとソケットが使用可能であるか、 `nri-agent`によって所有されており、 `0666`ファイル権限を持っている必要があります。

      ```yml
      logs:
        # TCP network socket
        - name: syslog-tcp-test
          syslog:
            uri: tcp://0.0.0.0:5140 # Use the tcp://LISTEN_ADDRESS:PORT format
            parser: rfc5424 # Default syslog parser is rfc3164

        # UDP network socket
        - name: syslog-udp-test
          syslog:
            uri: udp://0.0.0.0:6140 # Use the udp://LISTEN_ADDRESS:PORT format
          max_line_kb: 35

        # Unix TCP domain socket
        - name: syslog-unix-tcp-test
          syslog:
            uri: unix_tcp:///var/unix-tcp-socket-test
            unix_permissions: 0666 # Default is 0644. Change at your own risk

        # Unix UDP domain socket
        - name: syslog-unix-udp-test
          syslog:
            uri: unix_udp:///var/unix-udp-socket-test
            parser: rfc5424
      ```
  </Collapser>

  <Collapser id="tcp" title="TCP">
    TCP接続を介して取得されたログ。

    <DNT>
      **Parameters:**
    </DNT>

    * `uri:` 着信データをリッスンするTCP/IPソケット。URI 形式は`tcp://LISTEN_ADDRESS:PORT`です。

    * `format:` データの形式。`json`または`none`になります。

    * `separator:` `format: none`を使用する場合、レコードを分割するための区切り文字列を定義できます（デフォルト：`\n`）。

      ```yml
      logs:
        - name: tcp-simple-test
          tcp:
            uri: tcp://0.0.0.0:1234 # Use the tcp://LISTEN_ADDRESS:PORT format
            format: none            # Raw text - this is default for 'tcp'
            separator: \t           # String for separating raw text entries
          max_line_kb: 32
        - name: tcp-json-test
          tcp:
            uri: tcp://0.0.0.0:2345 # Use the tcp://LISTEN_ADDRESS:PORT format
            format: json
      ```
  </Collapser>

  <Collapser id="winevtlog" title="winevtlog">
    <Callout variant="important">
      infrastructureエージェントv.1.24.3以降で利用可能Windows Server 2019以降とのみ互換性があります。以前のバージョンの場合は代わりに[`winlog`](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/#winlog)を使用してください。
    </Callout>

    [winevtlog Fluent Bitプラグイン](https://docs.fluentbit.io/manual/pipeline/inputs/windows-event-log-winevtlog)を使用した新しいWindowsイベントログAPIを使用して、 Windowsログチャネルからイベントを収集します。

    <DNT>
      **Parameters:**
    </DNT>

    * `channel`：ログが収集されるチャネルの名前。

    * `collect-eventids`：収集され、New Relicに転送されるWindowsイベントIDのリスト。イベントIDの範囲がサポートされています。

    * `exclude-eventids`：収集から除外するWindowsイベントIDのリスト。イベントIDの範囲がサポートされています。

    * `use-ansi`：`winlog`メッセージにANSIエンコードを使用します。Windows Server 2016以前のバージョンではデフォルトでANSIエンコードが使用され、それ以降のバージョンではUTF-8が使用されます。これらのデフォルトがユースケースに合わない場合は、この設定パラメーターでこの動作をオーバーライドできます。これにより、ANSI 文字コードログが空の文字列になる問題が解決されます。これは、ANSI文字コード内のマルチバイト文字コードのログをUTF-8に変換する機能ではありません。

      デフォルトでは、すべてのイベントは指定されたチャネルから収集されます。不要なログがNew Relicアカウントに送信されないように、 `collect-eventids`セクションと`exclude-eventids`セクションを構成します。

      特定のイベントを転送または削除するには、イベントIDまたは範囲を`collect-eventids`または`exclude-eventids`に追加します。両方のセクションに同じイベントIDが存在する場合、 `exclude-eventids` `collect-eventids`よりも優先されます。

      <DNT>
        **Example:**
      </DNT>

      ```yml
      logs:
        # Example winevtlog security log ingestion with eventId filters.
        - name: windows-security
          winevtlog:
            channel: Security
            collect-eventids:
              - 4624
              - 4265
              - 4700-4800
            exclude-eventids:
              - 4735
          attributes:
            logtype: windows_security

        # Example entries for the application and system channels
        - name: windows-application
          winevtlog:
            channel: Application
            attributes:
              logtype: windows_application

        # Example entries for the application use-ansi
        - name: windows-application
          winevtlog:
            channel: Application
            attributes:
              logtype: windows_application
            use-ansi: true

        - name: windows-system
          winevtlog:
            channel: System
            attributes:
              logtype: windows_system

        # Example/Optional entry for Windows Defender Logs
        - name: windows-defender
          winevtlog:
            channel: Microsoft-Windows-Windows Defender/Operational

        # Example/Optional entry for Windows Clustering Logs
        - name: windows-clustering
          winevtlog:
            channel: Microsoft-Windows-FailoverClustering/Operational
      ```
  </Collapser>

  <Collapser id="winlog" title="winlog">
    <Callout variant="important">
      `Winlog` 従来のイベントログのみを収集できます。他のユーザーをキャプチャしようとすると、アプリケーションログがサイレントに収集されます。
    </Callout>

    Windowsログチャネルからイベントを収集します。

    <DNT>
      **Parameters:**
    </DNT>

    * `channel`：ログが収集されるチャネルの名前。カスタムチャネルでは機能しません。

    * `collect-eventids`：収集され、New Relicに転送されるWindowsイベントIDのリスト。イベントIDの範囲がサポートされています。

    * `exclude-eventids`：収集から除外するWindowsイベントIDのリスト。イベントIDの範囲がサポートされています。

    * `use-ansi`：`winlog`メッセージにANSIエンコードを使用します。Windows Server 2016以前のバージョンではデフォルトでANSIエンコードが使用され、それ以降のバージョンではUTF-8が使用されます。これらのデフォルトがユースケースに合わない場合は、この設定パラメーターでこの動作をオーバーライドできます。これにより、ANSI 文字コードログが空の文字列になる問題が解決されます。これは、ANSI文字コード内のマルチバイト文字コードのログをUTF-8に変換する機能ではありません。

      デフォルトでは、すべてのイベントは指定されたチャネルから収集されます。不要なログがNew Relicアカウントに送信されないように、 `collect-eventids`セクションと`exclude-eventids`セクションを構成します。

      特定のイベントを転送または削除するには、イベントIDまたは範囲を`collect-eventids`または`exclude-eventids`に追加します。両方のセクションに同じイベントIDが存在する場合、 `exclude-eventids` `collect-eventids`よりも優先されます。

      <DNT>
        **Example:**
      </DNT>

      ```yml
      logs:
        # Example winlog security log ingestion with eventId filters.
        - name: windows-security
          winlog:
            channel: Security
            collect-eventids:
              - 4624
              - 4265
              - 4700-4800
            exclude-eventids:
              - 4735
          attributes:
            logtype: windows_security

        # Example entries for the application and system channels
        - name: windows-application
          winlog:
            channel: Application
            attributes:
              logtype: windows_application
        - name: windows-system
          winlog:
            channel: System
            attributes:
              logtype: windows_system

        # Example entries for the application use-ansi
        - name: windows-application
          winlog:
            channel: Application
            attributes:
              logtype: windows_application
            use-ansi: true

        # Example/Optional entry for Windows Defender Logs
        - name: windows-defender
          winlog:
            channel: Microsoft-Windows-Windows Defender/Operational

        # Example/Optional entry for Windows Clustering Logs
        - name: windows-clustering
          winlog:
            channel: Microsoft-Windows-FailoverClustering/Operational
      ```
  </Collapser>
</CollapserGroup>

### ステップ3. 主要な属性を定義する [#optional-config]

これらの設定は必須ではありませんが、ログ転送を最大限に活用するために、これらの設定パラメーターを`logging.yml`ファイルに適用することをお勧めします。

<CollapserGroup>
  <Collapser id="attributes" title="属性">
    キーの値のペアとして指定されたカスタムアトリビュートのリスト。これを使用してログとともに追加データを送信し、そのデータを書き込むことができます。`attributes`設定パラメーターは、どのログソースでも使用できます。

    <Callout variant="important">
      `attributes`設定パラメーターは、外部Fluent Bit設定（例： `fluentbit`設定パラメーターを使用）経由で転送されたログにカスタムアトリビュートを追加しません。このシナリオでは、 [Fluent Bitドキュメント](https://docs.fluentbit.io/manual/)の`record_modifier`オプションを参照する必要があります。
    </Callout>

    `attributes`設定パラメーターの一般的な使用法の1つは、 `logtype`属性を指定することです。この属性により、New Relic の<InlinePopover type="logs" />機能でサポートされている[組み込み解析ルール](/docs/logs/log-management/ui-data/parsing/#built-in-rules)の1つを活用できます。

    <DNT>
      **Example:**
    </DNT>

    ```yml
    logs:
      - name: example-file-attributes
        file: /var/log/example.log
        attributes:
          logtype: nginx
          region: example-us-02
          team: A-team
      - name: example-tcp-attributes
        tcp:
          uri: tcp://0.0.0.0:2345
          format: json
        attributes:
          logtype: nginx
          region: example-us-02
          team: B-team
    ```
  </Collapser>

  <Collapser id="automatically-inserted-attributess" title="infrastructureエージェントによって自動的に挿入される属性">
    infrastructureエージェントは、利便性のためにログ属性を自動的に挿入します。それらの一部は任意のログレコードに挿入されますが、その他はログフォワーダーのセットアップ中に使用した設定パラメーターに依存します。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            属性名
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `entity.guids`
          </td>

          <td>
            常に挿入されます。

            infrastructureエージェントは、 New Relicによって割り当てられた[エンティティGUID](/attribute-dictionary/?event=Span&attribute=entityGuid)を挿入して、実行されているホストを識別します。`entity.guids`フィールドで使用できます。

            注：キャプチャされたログがAPMを使用してインストゥルメントされたアプリケーションに属している場合、 `entity.guids`フィールドにはインフラストラクチャのエンティティGUIDとAPMのGUIDの両方がパイプ（|）区切り文字で区切られて含まれます。
          </td>
        </tr>

        <tr>
          <td>
            `fb.input`
          </td>

          <td>
            常に挿入されます。

            ログをキャプチャするために使用される、基礎となる[Fluent Bit入力プラグインタイプ](https://docs.fluentbit.io/manual/pipeline/inputs)。現在、その値は`tail` 、 `systemd` 、 `winlog` 、 `syslog` 、 `tcp`です。
          </td>
        </tr>

        <tr>
          <td>
            `filePath`
          </td>

          <td>
            `file`入力タイプを使用するときに挿入されます。

            監視対象ファイルの絶対ファイルパス。
          </td>
        </tr>

        <tr>
          <td>
            `hostname`
          </td>

          <td>
            常に挿入されます。

            infrastructureエージェントを実行するマシン/ VM /コンテナのhostname 。
          </td>
        </tr>

        <tr>
          <td>
            `plugin.type`
          </td>

          <td>
            常に挿入されます。

            ログをキャプチャするために使用されるユーティリティを示します。この場合、それはinfrastructureエージェント自体であるため、この属性の値は常に`nri-agent`になります。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="pattern" title="パターン">
    レコードをフィルタリングするための正規表現。`file` 、 `systemd` 、 `syslog` 、および`tcp`（`none`形式のみ）のソースでのみサポートされます。

    このフィールドは、Unixシステムの`grep -E`と同様に機能します。たとえば、キャプチャされている特定のファイルに対して、次のようにして`WARN`または`ERROR`のいずれかを含むレコードをフィルタリングできます。

    ```yml
    - name: only-records-with-warn-and-error
      file: /var/log/logFile.log
      pattern: WARN|ERROR
    ```

    デフォルトではフィルタリングは適用されません。
  </Collapser>

  <Collapser id="max_line_kb" title="max_line_kb">
    ログエントリ/行の最大サイズ（KB）。ログエントリが制限を超えた場合、スキップされます。デフォルトは`128` 、最小許容値は`33`です。
  </Collapser>

  <Collapser id="fluentbit" title="Fluentbit">
    外部の[Fluent Bit](https://fluentbit.io/)設定およびパーサーファイル。定義されている場合、それらはinfrastructureエージェントによって生成された既存の設定およびパーサーファイルとマージされます。

    infrastructureエージェントは、 `logging.d`ディレクトリにある設定ファイルを処理し、適切な`[INPUT]` 、 `[FILTER]` 、および`[OUTPUT]`セクションを含むランタイムFluent Bit設定ファイルを生成します。オプションとして、 `fluentbit`オプションを使用して外部のFluent Bit設定ファイルを提供した場合、 `@INCLUDE`も宣言されます。

    ランタイムファイルでは[`[SERVICE]`セクション](https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/classic-mode/configuration-file)が定義されていないため、 Fluent Bit設定値はすべてデフォルトのままになります。外部Fluent Bit構成ファイルで独自の`[SERVICE]`セクションを定義し、それを`fluentbit`オプションで含めることで、Fluent Bitのデフォルト設定をオーバーライドすることもできます。

    <DNT>
      **Parameters:**
    </DNT>

    `config_file:` 既存のFluent Bit設定ファイルへのパス。重複するソースがあると、ログUIに重複したメッセージが表示されることに注意してください。

    `parsers_file:` 既存のFluent Bitパーサーファイルへのパス。次のパーサー名は予約されています：`rfc3164` 、 `rfc3164-local` 、および`rfc5424` 。

    <Callout variant="important">
      このドキュメントで説明されているように、infrastructureエージェントでは、 `logging.d/`ディレクトリのYAMLファイルに単純なログ転送設定を定義することで、最も一般的なユースケースでログを転送できます。これらのファイルは、内部で正しい形式と正常な設定デフォルトを備えたFluent Bit設定ファイルに変換されます。New Relic生成された設定ファイルが正しく動作することを保証しているため、これらの設定オプションに対して公式サポートを提供しています。

      ただし、サポートされている設定オプションでカバーされていないユースケースについては、 `fluentbit` 、 `config_file` 、および`parsers_file`オプションを使用して、外部で生成されたFluent Bit設定およびパーサーファイルを使用する可能性を提供しています。

      注：提供された設定は完全に任意であり、エージェントによって生成/検証されていないため、この場合に転送されたログが正しく動作することは保証できません。したがって、 New Relicはこれらのオプションで指定された外部設定に対して公式サポートを提供しません。
    </Callout>
  </Collapser>
</CollapserGroup>

### サンプル設定ファイル [#running-modes]

YAML形式の`logging.d`設定ファイルの例を次に示します。その他の設定例については、[infrastructureエージェントリポジトリを参照してください](https://github.com/newrelic/infrastructure-agent/tree/master/assets/examples/logging)。

<CollapserGroup>
  <Collapser id="configuration-file" title="logging.d/sample.yaml">
    ```yml
    # Remember to only use spaces for indentation

    logs:
      # Example of 'file' source
      - name: file-with-attributes
        file: /var/log/test.log # Path to a single file or pattern
        attributes:             # You can use custom attributes to enrich your data
          logtype: nginx
          team: The A Team
        pattern: Error          # Regular expression to filter log entries

      # Example of 'systemd' source (Linux only)
      - name: systemd-example
        systemd: cupsd

      # Examples of 'syslog' source, one per protocol
      # TCP network socket
      - name: syslog-tcp-test
        syslog:
          uri: tcp://0.0.0.0:5140 # Use the tcp://LISTEN_ADDRESS:PORT format
          parser: rfc5424         # Default syslog parser is rfc3164

      # UDP network socket
      - name: syslog-udp-test
        syslog:
          uri: udp://0.0.0.0:6140 # Use the udp://LISTEN_ADDRESS:PORT format
        max_line_kb: 35

      # Paths for Unix sockets are defined by combining protocol and path:
      # unix_udp:// + /path/socket - for example, unix_udp:///tmp/socket
      # Unix TCP domain socket
      - name: syslog-unix-tcp-test
        syslog:
          uri: unix_tcp:///var/unix-tcp-socket-test
          unix_permissions: 0666 # Default is 0644. Change at your own risk

      # Unix UDP domain socket
      - name: syslog-unix-udp-test
        syslog:
          uri: unix_udp:///var/unix-udp-socket-test
          parser: rfc5424

      # Examples of 'tcp' source for formats 'none' and 'json'
      - name: tcp-simple-test
        tcp:
          uri: tcp://0.0.0.0:1234 # Use the tcp://LISTEN_ADDRESS:PORT format
          format: none            # Raw text - this is default for 'tcp'
          separator: \t           # String for separating raw text entries
        attributes:               # You can add custom attributes to any source of logs
          tcpFormat: none
          someOtherAttribute: associatedValue
        max_line_kb: 32
      - name: tcp-json-test
        tcp:
          uri: tcp://0.0.0.0:2345 # Use the tcp://LISTEN_ADDRESS:PORT format
          format: json
        attributes:
          tcpFormat: json
          yetAnotherAttribute: 12345

      # Example of Fluent Bit configuration import
      - name: fluentbit-import
        fluentbit:
          config_file: /path/to/fluentbit.config
          parsers_file: /path/to/fluentbit/parsers.conf
    ```
  </Collapser>
</CollapserGroup>

### ステップ4. ログデータを表示する [#find-data]

すべてが正しく構成され、データが収集されている場合は、次の場所にログと関連するテレメトリーデータが表示されます。

* 当社の[ログUI](https://one.newrelic.com/launcher/logger.log-launcher)
* インフラストラクチャUIで、ホストテーブルから、 <Icon name="fe-more-horizontal" />特定のホストのアイコンをクリックし、 <DNT>**View logs**</DNT>をクリックします。
* [NRQL クエリ](/docs/chart-builder/use-chart-builder/choose-data/use-advanced-nrql-mode-specify-data)を実行するためのツール。たとえば、次のようなクエリを実行できます。

```sql
SELECT * FROM Log
```

## オンホストインテグレーションのログ記録を有効にする [#on-host]

infrastructureエージェントをインストールすると、最も人気のあるオンホストインテグレーションの自動ログ解析と転送をワンステップで有効にすることができます。この機能を有効にするには、 `on-host-log.yml.example`ファイルの名前を`on-host-log.yml`に変更します。完了すると、インテグレーションのログが自動的に解析され、 New Relicに送信されるようになります。

このオプションは、[サポート対象のLinuxプラットフォーム](#requirements)で利用できます。

オンホストインテグレーションのログ転送機能を有効にする方法：

<CollapserGroup>
  <Collapser id="elastic-search-logs" title="Elasticsearchログ">
    自動Elasticsearch JSON形式のログ解析とNew Relicへの転送を有効にするには、 `elasticsearch-log.yml.example`ファイルを`elasticsearch-log.yml`にコピーするか名前を変更します。エージェントを再起動する必要はありません。

    <DNT>
      **Example:**
    </DNT>

    ```bash
    sudo cp /etc/newrelic-infra/logging.d/elasticsearch-log.yml.example /etc/newrelic-infra/logging.d/elasticsearch-log.yml
    ```
  </Collapser>

  <Collapser id="mysql-logs" title="MySQLログ">
    自動MySQLエラーログ解析とNew Relicへの転送を有効にするには、 `mysql-log.yml.example`ファイルを`mysql-log.yml`にコピーするか名前を変更します。エージェントを再起動する必要はありません。

    <DNT>
      **Example:**
    </DNT>

    ```bash
    sudo cp /etc/newrelic-infra/logging.d/mysql-log.yml.example /etc/newrelic-infra/logging.d/mysql-log.yml
    ```
  </Collapser>

  <Collapser id="nginx-logs" title="NGINXログ">
    自動NGINXアクセスとエラーログ解析を有効にしてNew Relicに転送するには、 `nginx-log.yml.example`ファイルを`nginx-log.yml`にコピーするか名前を変更します。エージェントを再起動する必要はありません。

    <DNT>
      **Example:**
    </DNT>

    ```bash
    sudo cp /etc/newrelic-infra/logging.d/nginx-log.yml.example /etc/newrelic-infra/logging.d/nginx-log.yml
    ```
  </Collapser>

  <Collapser id="rabbitmq-logs" title="Rabbitmqログ">
    自動Rabbitmqエラーログ解析とNew Relicへの転送を有効にするには、 `rabbitmq-log.yml.example`ファイルを`rabbitmq-log.yml`にコピーするか名前を変更します。エージェントを再起動する必要はありません。

    <DNT>
      **Example:**
    </DNT>

    ```bash
    sudo cp /etc/newrelic-infra/logging.d/rabbitmq-log.yml.example /etc/newrelic-infra/logging.d/rabbitmq-log.yml
    ```
  </Collapser>

  <Collapser id="redis-logs" title="Redisログ">
    自動Redisエラーログ解析とNew Relicへの転送を有効にするには、 `redis-log.yml.example`ファイルを`redis-log.yml`にコピーするか名前を変更します。エージェントを再起動する必要はありません。

    <DNT>
      **Example:**
    </DNT>

    ```bash
    sudo cp /etc/newrelic-infra/logging.d/redis-log.yml.example /etc/newrelic-infra/logging.d/redis-log.yml
    ```
  </Collapser>
</CollapserGroup>

## Linux tarballを使用してインストールされたエージェントでログ転送を有効にする [#tarball-install]

インフラストラクチャ監視用のカスタムLinuxインストレーションプロセスを使用すると、インストレーションプロセスのあらゆる側面を調整し、マシン上にファイルやフォルダーを配置できます。[支援型](/docs/infrastructure/install-infrastructure-agent/linux-installation/tarball-assisted-install-infrastructure-agent-linux)または[手動型](/docs/infrastructure/install-infrastructure-agent/linux-installation/tarball-manual-install-infrastructure-agent-linux)のtarballインストレーションプロセスを選択した場合は、次の手順に従ってログフォワーダー機能を実装します。

1. 次のディレクトリを作成します。

   * `/var/db/newrelic-infra/newrelic-integrations/logging`
   * `/etc/newrelic-infra/logging.d`

2. 次のようなコマンドを実行して、New Relicの[fluent-bit-package（RPM）](https://github.com/newrelic/fluent-bit-package/releases)をダウンロードしてインストールします。

   ```shell
   yum localinstall fluent-bit-<some-version>.rpm
   ```

3. New Relicの[fluentbitプラグイン](https://github.com/newrelic/newrelic-fluent-bit-output/releases)をダウンロードし、 `/var/db/newrelic-infra/newrelic-integrations/logging/out_newrelic.so`として保存します。

4. [このGithubリポジトリ](https://github.com/newrelic/fluent-bit-package/blob/main/parsers.conf)から`parsers.conf`ファイルをダウンロードまたはコピーし、 `/var/db/newrelic-infra/newrelic-integrations/logging/parsers.conf`として保存します。

<InstallFeedback />

## トラブルシューティング [#troubleshoot]

ログフォワーダーの設定で問題が発生した場合は、次のトラブルシューティングのヒントを試してください。

<CollapserGroup>
  <Collapser className="freq-link" id="log-data" title="ログデータなし">
    ログ管理機能を有効にしてもデータが表示されない場合は、[標準のログトラブルシューティング手順](/docs/logs/log-management/troubleshooting/no-log-data-appears-ui/)に従ってください。
  </Collapser>

  <Collapser className="freq-link" id="no-data" title="ファイルの末尾にデータが表示されない">
    ログ転送機能を使用するには、エージェントにデータソースを読み取る権限が必要です。infrastructureエージェントを[特権モードまたは非特権モード](/docs/infrastructure/install-configure-infrastructure/linux-installation/linux-agent-running-modes)で実行する場合は、転送するログファイル（およびそのパス内の中間ディレクトリ）が、 `nri-agent`を実行しているユーザーによって読み取れることを確認してください。

    <DNT>
      **Example: Check file access under Linux**
    </DNT>

    ファイル`/var/log/restrictedLogs/logFile.log`が`nri-agent`ユーザーによって監視できるかどうかを確認してみましょう。Linuxでは、 `namei`コマンドを使用して簡単にチェックできます。

    ```bash
    sudo -u nri-agent namei -ml /var/log/restrictedLogs/logFile.log
    [output] f: /var/log/restrictedLogs/logFile.log
    [output] drwxr-xr-x root root /
    [output] drwxr-xr-x root root var
    [output] drwxrwxr-x root syslog log
    [output] drwxr--r-- root root restrictedLogs
    [output] logFile.log - No such file or directory
    ```

    ファイルが`nri-agent`ユーザーに表示されないため、このコマンドは失敗しました。前の出力を調べると、 `restrictedLogs`ディレクトリに`others`実行フラグがないことがわかります。

    これを修正するには、次を実行します。

    ```bash
    sudo chmod 755 /var/log/restrictedLogs
    ```

    次に、ファイルアクセスを再度確認します。

    ```bash
    sudo -u nri-agent namei -ml /var/log/restrictedLogs/logFile.log
    [output] f: /var/log/restrictedLogs/logFile.log
    [output] drwxr-xr-x root root /
    [output] drwxr-xr-x root root var
    [output] drwxrwxr-x root syslog log
    [output] drwxr-xr-x root root restrictedLogs
    [output] -rw-r----- vagrant vagrant logFile.log
    ```

    ファイルは`nri-agent`ユーザーに表示されます。ファイルが`nri-agent`ユーザーによって読み取り可能であることも確認する必要があります。これを確認するには、次を使用します。

    ```bash
    sudo -u nri-agent head /var/log/restrictedLogs/logFile.log
    [output] head: cannot open '/var/log/restrictedLogs/logFile.log' for reading: Permission denied
    ```

    この例では、ファイルに`others`グループ（`vagrant`および`vagrant`ユーザーグループ以外のユーザー）の読み取り権限がありません。`others`に読み取り権限を付与することでこれを修正できますが、アプリケーションの再起動時にこれらの権限が変更される可能性があります。

    これを回避するには、 `nri-agent`ユーザーを`vagrant`ユーザーグループに追加することをお勧めします。
  </Collapser>

  <Collapser className="freq-link" id="syslog" title="Syslogソケット経由でキャプチャするとデータが表示されない">
    ログ転送機能を使用するには、エージェントにデータソースを読み取る権限が必要です。infrastructureエージェントを[特権モードまたは非特権モード](/docs/infrastructure/install-configure-infrastructure/linux-installation/linux-agent-running-modes)で実行する場合：

    * Unixドメインソケットファイルを使用している場合は、`nri-agent`ユーザーがこれらのファイルにアクセスできること（前のセクションを参照してください）と、他のユーザーが読み取りおよび書き込み権限（`666`）を持っていることを確認してください。 `nri-agent`よりも多くのユーザーが書き込み可能です。

    * IPソケットを使用している場合は、使用しているポートがシステムで予約済みのポート（たとえば、ポート`80`など）ではないことを確認してください。

      ログ管理を有効にしてもデータが表示されない場合は、[標準のログ管理トラブルシューティング手順](/docs/logs/new-relic-logs/troubleshooting/no-data-appears-logs)に従ってください。
  </Collapser>

  <Collapser className="freq-link" id="proxy" title="infrastructureエージェントプロキシを使用するとデータが表示されない">
    [infrastructureエージェント設定ガイドライン](/docs/infrastructure/install-infrastructure-agent/configuration/infrastructure-agent-configuration-settings#proxy)で説明されているように、 `proxy`パラメーターはHTTPまたはHTTPSのいずれかを使用し、`https://user:password@hostname:port`形式である必要があります。エージェントはHTTPまたはHTTPSを使用せずにパラメーターを解析できますが、ログフォワーダーは解析できません。エージェントの詳細ログに次のようなエラーが表示されます。

    ```
    [ERROR] building HTTP transport: parse \"hostname:port\":
    first path segment in URL cannot contain colon
    ```

    この問題を解決するには、 `newrelic-infra.yml`ファイルをチェックして、 `proxy`パラメーターがこの形式に従っていることを確認してください。

    証明書を指定するために`caBundleFile`または`caBundleDir`を使用している場合は、OSごとに以下の規則に従うことをお勧めします。

    <DNT>
      **Linux**
    </DNT>

    `HTTP`プロキシの場合、証明書を設定する必要はありません。プラグインはシステム証明書を読み込み、New Relicはログをログエンドポイントに送信します。ただし、 `caBundleFile`または`caBundleDir`パラメーターのいずれかを使用して、プロキシ自己署名証明書（PEMファイル）を指定できます。

    <DNT>
      **Windows**
    </DNT>

    * `HTTP`プロキシの場合、証明書を設定する必要はありません。プラグインはシステム証明書を読み込みます。

    * `HTTPS`の場合は、次のいずれかの方法で設定できます。

      * （推奨）プロキシ証明書をシステムプールにインポートします。MMCツールを使用して、プロキシ自己署名証明書（PEMファイル）をインポートします。[このリンク](https://www.ssls.com/knowledgebase/how-to-import-intermediate-and-root-certificates-via-mmc/)を参照し、 <DNT>**Step 2**</DNT>では`Intermediate Certification Authorities`ではなく`Trusted Root Certification Authorities`にインポートするようにしてください。

      * `caBundleFile`および`caBundleDir`パラメーターを使用してください。 Windowsでは、システム証明書プールからの証明書と、 `caBundleFile` `caBundleDir`パラメーターで指定された証明書の両方を読み込むことはできません。したがって、 `caBundleFile`または`caBundleDir`使用している場合は、次の証明書が同じPEMファイル（`caBundleFile`を使用している場合）または同じディレクトリ（`caBundleDir`を使用している場合）に配置されていることを確認してください。

    * プロキシ証明書（`HTTPS`プロキシであるため）。

    * ログ記録エンドポイント証明書（例：`https://log-api.newrelic.com/log/v1`）。

    * infrastructureエージェント証明書（例：`https://infra-api.newrelic.com`）。

      次のコマンドを実行して証明書を確認できます。

      ```bash
      openssl s_client -connect log-api.newrelic.com:443 -servername log-api.newrelic.com
      ```
  </Collapser>

  <Collapser className="freq-link" id="agent-logs" title="infrastructureエージェントのログをNew Relicに送信する">
    独自のログをNew Relicに送信するようにinfrastructureエージェントを設定できます。これは、ログ転送、エージェントに関する問題のトラブルシューティングや、[サポート](https://support.newrelic.com/)への問い合わせに役立ちます。

    <Callout variant="important">
      トレースログでは大量のデータが迅速に生成されます。ディスク領域の消費量とデータの取り込み量を削減するには、ログの生成が完了したら、必ず`level: info`（またはそれ以下）に設定してください。
    </Callout>

    infrastructureエージェントのログをNew Relicに転送するには：

    1. `newrelic-infra.yml`ファイルを編集します。

    2. 次の設定スニペットを追加して、New Relicへのログ転送を有効にします。

       ```yml
       log:
         level: trace  # Recommended: Helps with troubleshooting
         forward: true # Enables sending logs to New Relic
         format: json  # Recommended: Enable agent logging in JSON format
         stdout: false # On Windows and systems that don't use `systemd` or where `journald` is inaccessible
       ```

    3. 新しい設定を読み込むには[エージェントを再起動します](/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status)。

       この設定はトラブルシューティングモードでエージェントを設定しますが、ログフォワーダー（[Fluent Bit](https://fluentbit.io/)に基づく）は非冗長モードで続行されます。
  </Collapser>

  <Collapser className="freq-link" id="fluentbit-logs" title="ログフォワーダーで詳細モードを有効にする（Fluent Bit）">
    ログフォワーダー自体に問題が発生する場合があります。たとえば、 Windowsログイベントを配信するときや特定のログファイルにアクセスするときに、特定のチャネルにアクセスするときに問題が発生する可能性があります。このような状況では、ログフォワーダーの冗長モードを有効にすることもできます。

    <Callout variant="important">
      トレースログでは大量のデータが迅速に生成されます。ディスク領域の消費量とデータの取り込み量を削減するには、ログの生成が完了したら、必ず`level: info`（またはそれ以下）に設定してください。
    </Callout>

    1. `newrelic-infra.yml`ファイルを編集します。
    2. 次の構成スニペットを追加して、Fluent Bitの詳細ログを有効にします。
       ```yml
       log:
         level: trace
         forward: true # Enables sending logs to New Relic
         format: json  # Recommended: Enable agent logging in JSON format
         stdout: false # On Windows and systems that don't use `systemd` or where `journald` is inaccessible
         include_filters:
           traces:
             - supervisor # Required to see verbose logs from Fluent Bit
       ```
    3. 新しい設定を読み込むには[エージェントを再起動します](/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status)。
  </Collapser>

  <Collapser className="freq-link" id="no-fb" title="Fluent Bitはinfrastructureエージェントでは起動しません">
    <Callout variant="important">
      Fluent Bit のtailプラグインはネットワークドライブをサポートしていません。
    </Callout>

    2016より前の Linuxバージョンの場合、OpenSSLライブラリを1.1.0以降に更新する必要がある場合があります。この問題があるかどうかを確認するには：

    1. 次を実行して、 `infra-agent`がFluent Bitを開始したかどうかを確認します。

       ```bash
       ps -aux | grep fluent-bit
       ```

    2. 実行されていない場合は、 `/var/db/newrelic-infra/newrelic-integrations/logging`に移動して次を実行してください：

       ```bash
       ./fluent-bit -i systemd -o stdout
       ```

    3. 次のエラーが表示された場合：

       ```
       error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory
       ```

       OpenSSLを1.1.0以降にアップデートしてください。
  </Collapser>

  <Collapser className="freq-link" id="windows-runtime-error" title="Windowsでのランタイムエラー">
    Windowsでログ転送を有効にすると、次のエラーメッセージのいずれかが表示される場合があります。

    ```
    The code execution cannot proceed because VCRUNTIME140.dll was not found.
    ```

    または

    ```
    error="exit status 3221225781" process=log-forwarder
    ```

    これはDLLが見つからないために発生します。

    この問題を解決するには、該当する[Microsoft Visual C++再頒布可能パッケージ](https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads)をインストールします。

    * [x64](https://aka.ms/vs/16/release/vc_redist.x64.exe)
    * [x86](https://aka.ms/vs/16/release/vc_redist.x86.exe)
  </Collapser>

  <Collapser className="freq-link" id="too-many-files" title="大量のログファイルをtailする際のエラー（Linux）">
    大量のファイルをtailしようとすると、次のいずれかのエラーメッセージが発生するのが一般的です。

    * `Too many open files`
    * `The user limit on the total number of inotify watches was reached or the kernel failed to allocate a needed resource`

    OSは、割り当て可能なファイル記述子の最大数（通常はデフォルトで1024）と、割り当て可能なinotify watchの最大数（通常はデフォルトで8192）を定義します。これらの制限を超えようとするプロセスは失敗し、上記のいずれかのエラーが返されます。

    ログを転送するために使用する基礎テクノロジーである[Fluent Bit](https://fluentbit.io/)は、1 つのファイル記述子を開き、転送するように構成されたファイルごとにinotify watchを設定します。さらに、このセクションの執筆時点では、Fluent Bitは通常の操作に32個のファイル記述子の追加セットを使用し、シャットダウン時にはさらに別のファイル記述子を使用します。したがって、 <DNT>**to capture a large amount of files you need to ensure that both the file descriptor and inotify watch limits are slightly greater than the amount of log files you wish to tail**</DNT> 。

    次の手順は、10,000個のログファイルを追跡する場合にこれらの制限を増やす方法をまとめたものです。また、infrastructureエージェントが`root` [実行モード](/docs/infrastructure/install-infrastructure-agent/linux-installation/linux-agent-running-modes/)でインストールされていることを前提としているため、 `root`ユーザーを使用して実行する必要があります。

    1. プロセスあたりのファイル記述子の数に対する現在のハード制限を確認します。通常、この制限は非常に高く設定されており、変更する必要はありません。

       ```bash
       ulimit -Hn
       ```

    2. `/etc/security/limits.conf`に次の行を追加します。Fluent Bitが動作するために必要な追加のファイル記述子を割り当てられるように、ここでは`10000`ではなく`10100`の制限を指定しました。

       ```bash
       root soft nofile 10100 # replace root by nri-agent for non-root (privileged and unprivileged) installations
       ```

    3. 再起動時に以前の制限が適用されるように、 `/etc/pam.d/common-session`に次の行を追加します。

       ```bash
       session required pam_limits.so
       ```

    4. ユーザーごとに許可されるinotifyウォッチャーの数を増やすには、 `/etc/sysctl.conf`に次の行を追加します。ここでは、 `10000`ではなく`18192`の制限を指定しました。これにより、 `root`ユーザーは引き続き`8192`のinotify watch（デフォルト値）を利用できるようになります。

       ```bash
       fs.inotify.max_user_watches=18192
       ```

    5. システムを再起動します。

    6. 次のコマンドを実行して、新しい制限が適用されていることを確認します。

       ```bash
       ulimit -Sn                                 # Should return 10100
       cat /proc/sys/fs/inotify/max_user_watches  # Should return 18192
       ```

       [オープンファイルの制限を増やす方法](https://tecadmin.net/increase-open-files-limit-ubuntu/)、または[inotify watchを増やす方法](https://dev.to/rubiin/ubuntu-increase-inotify-watcher-file-watch-limit-kf4)について詳しく説明します。
  </Collapser>

  <Collapser className="freq-link" id="install-fb-version" title="最新のFluent Bitバージョンをインストールする（Linux）">
    バージョン[1.19.0](/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes/new-relic-infrastructure-agent-1190)（SLES 12.5の場合はバージョン[1.20.3](/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes/new-relic-infrastructure-agent-1203)）より前では、Linux infrastructureエージェントはFluent Bitバイナリにバンドルされていました。このバージョンから、Fluent Bitが個別の`recommended`パッケージ依存関係として含まれるようになりました。

    つまり、エージェントとは別に Fluent Bit をインストール、更新、またはダウングレードできます。便宜上、インフラストラクチャが存在する同じリポジトリにいくつかのFluent Bitパッケージを含めました。そのため、 Fluent Bitアップグレードするために追加のリポジトリをインストールする必要はありません。

    エージェントは、初めてインストールするときに、利用可能な最新バージョンを使用して Fluent Bit を自動的にインストールすることに注意してください。最初のインストレーション後は、他のLinuxパッケージと同様にFluent Bitアップグレードできます。

    次のコマンドを実行すると、利用可能なFluent Bitバージョンを一覧表示できます。

    RPM：

    ```bash
    sudo yum check-update
    yum list fluent-bit --showduplicates
    ```

    DEB：

    ```bash
    sudo apt update
    apt-cache showpkg fluent-bit
    ```

    最新の Fluent Bitバージョンにアップグレードするには、次のコマンドを実行します。

    RPM：

    ```bash
    # Remove command only required when downgrading to a previous version
    # sudo yum remove fluent-bit
    sudo yum install fluent-bit
    ```

    DEB：

    ```bash
    sudo apt install fluent-bit
    ```
  </Collapser>

  <Collapser className="freq-link" id="rollback-after-fluent-bit-2" title="Linuxでinfrastructureエージェント1.42.0を適用した後、fluent-bit 1.xにロールバックする">
    td-agent-bitは次のディストリビューションでは利用できないため、ロールバックは不可能であることに注意してください。

    * CentOS 9ストリーム（Rocky Linux と AlmaLinux を含む）
    * RedHat 9
    * Ubuntu 22.04.x
    * オープンSUSE（SLES）15.4
    * Amazon Linux 2023

    td-agent-bitに戻したい場合は、以下の手順に従ってください。

    1. 好みのテキストエディターを使用してファイル`/etc/newrelic-infra.yml`を開きます。
    2. ファイルの末尾に次の行を追加します：`fluent_bit_exe_path: /opt/td-agent-bit/bin/td-agent-bit` 。
    3. 変更を保存します。
    4. 次のコマンドを実行して、infrastructureエージェントを再起動します：`sudo systemctl restart newrelic-infra` 。

    これらの手順を完了すると、infrastructureエージェントは、fluent-bitの代わりにtd-agent-bitを使用するように構成されます。
  </Collapser>
</CollapserGroup>

## 次のステップ [#what-next]

[ログ UI](/docs/logs/log-management/ui-data/use-logs-ui/)を使用して、プラットフォーム全体のログデータを調べます。

* [コンテキスト内のログ](/docs/logs/enable-log-management-new-relic/configure-logs-context/configure-logs-context-apm-agents/)機能でログを転送することで、アプリケーションとプラットフォームのパフォーマンスデータをより深く可視化することができます。
* [アラート](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/)の設定
* [データをクエリ](/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/)し、[ダッシュボードを作成](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/)します。

## ログ転送の無効化 [#uninstall]

ログ転送機能を無効にするには、 `logging.d`ディレクトリに移動し、[設定](#step-1-configure-the-infrastructure-agent)プロセス中に最初に追加された`.yml`拡張子を持つファイルを削除します。

* Linux： `/etc/newrelic-infra/logging.d/`
* Windows： `C:\Program Files\New Relic\newrelic-infra\logging.d\`