---
title: eBPF エージェントのベストプラクティスガイド
tags:
  - New Relic solutions
  - Best practices guides
  - eBPF
metaDescription: Best practices to help you find problems faster and deliver a better experience to your customers with New Relic's eBPF solution.
freshnessValidatedDate: never
translationType: machine
---

New Relic eBPF エージェントは、eBPF テクノロジーを使用して、ゼロコード計装の単一エージェントでAPM機能を提供します。 このアプローチにより、デプロイメントの監視のためにアプリケーション チームと調整する必要がなくなり、プラットフォーム エンジニアリング チームの能力が向上します。

## eBPF を利用した APM を使用する場合 [#when-to-use-eapm]

* **大規模なデプロイメント: 大**規模な監視デプロイを必要とし、個々の言語エージェントのオーバーヘッドなしで「十分な」メトリクスを必要とするアプリケーションが多数ある場合。
* **不明または変更不可能なワークロード:**監視したいワークロードが不明なプログラミング言語で書かれているか、変更できない場合。
* **プラットフォーム エンジニアリングの効率化:**個々のアプリケーション チームと調整せずに大規模にプロイ監視を行いたい場合。
* **Linux 中心の環境:** eBPF はKubernetes環境とホスト環境の両方で Linux 上で優れた動作をするため、 Windowsプラットフォームを監視する必要がない場合。
* **ディストリビューティッド（分散）トレーシング要件なし:**監視が必要な場合は、ディストリビューティッド（分散）トレーシング機能は必要ありません。

### eBPFと従来のAPMの比較 [#comparison]

eBPF を利用したAPMと従来のAPMエージェントの違いを理解すると、適切なアプローチを選択するのに役立ちます。

<table>
  <thead>
    <tr>
      <th>
        機能性
      </th>

      <th>
        eBPF エージェント (eAPM)
      </th>

      <th>
        APMエージェント
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        概要
      </td>

      <td>
        ✅
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        トランザクション
      </td>

      <td>
        ✅ (Java、Go、Node.js のセグメントリンク)
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        データベース操作
      </td>

      <td>
        ✅
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        サービスマップ
      </td>

      <td>
        ✅
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        ディストリビューティッド（分散）トレーシング
      </td>

      <td>
        ❌
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        プログラミング言語に依存しない
      </td>

      <td>
        ✅
      </td>

      <td>
        ❌
      </td>
    </tr>

    <tr>
      <td>
        カスタムインストゥルメンテーション
      </td>

      <td>
        ❌
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        アプリとサービスを継続的に自動検出
      </td>

      <td>
        ✅
      </td>

      <td>
        ❌
      </td>
    </tr>

    <tr>
      <td>
        Linuxサポート
      </td>

      <td>
        ✅
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        Windows サポート
      </td>

      <td>
        ❌
      </td>

      <td>
        ✅
      </td>
    </tr>

    <tr>
      <td>
        TCP および DNS テレメトリー
      </td>

      <td>
        ✅
      </td>

      <td>
        ❌
      </td>
    </tr>
  </tbody>
</table>

### データソースの観点

eBPF を利用した APM は、監視の観点をアプリケーション層からカーネル層に移行します。

<table>
  <thead>
    <tr>
      <th>
        機能
      </th>

      <th>
        APM言語エージェント
      </th>

      <th>
        eBPF を活用した APM
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        情報源
      </td>

      <td>
        アプリケーションのメモリ/ランタイムフック
      </td>

      <td>
        Linuxカーネル（eBPF経由）
      </td>
    </tr>

    <tr>
      <td>
        言語依存関係
      </td>

      <td>
        高（言語ごとに特定のエージェントが必要）
      </td>

      <td>
        なし（カーネルのプロセスビューで動作します）
      </td>
    </tr>

    <tr>
      <td>
        コードの変更
      </td>

      <td>
        必須
      </td>

      <td>
        不要（外部からプロセスを観察）
      </td>
    </tr>

    <tr>
      <td>
        結果
      </td>

      <td>
        既知の言語のディープ インサイト
      </td>

      <td>
        Linux (C++、 Rustなど) 上のあらゆるワークロードに最適なインサイト
      </td>
    </tr>
  </tbody>
</table>

## デプロイメント用ベストプラクティス [#deployment-best-practices]

### 1. 従来のAPMを補完する

eBPF エージェントを使用して、 APM言語エージェントを補完し、包括的なカバレッジを実現します。 これにより、二重のデータ取り込みを行わずに、 eAPMとAPMエージェントが共存し、 APM完全にカバーできるようになります。

**推奨されるアプローチ:**

* **APM言語エージェント:**深いレベルのインサイト、ディストリビューティッド（分散）トレーシング、またはカスタム インストゥルメンテーションを必要とする最も重要なアプリケーションに使用します。
* **eBPF を利用した APM:**インストルメント化されていないサービス、サードパーティ アプリ、および新しいサービスの継続的な検出/レポートなど、その他すべてをカバーするために使用します。

### 2. より深いコンテキストのためのネットワークメトリクスを追加する

<Callout title="プレビュー">
  私たちは eBPF ネットワーク メトリクス機能の開発にまだ取り組んでいますが、ぜひ試してみてください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/)に従ってプレビューの一部として提供されています。 HIPAA または FedRAMP 規制の対象となる顧客にはご利用いただけません。
</Callout>

eBPF エージェントは、アプリケーションの境界の外側を可視化するための詳細なネットワーク メトリクス (TCP、DNS など) も提供できます。 この機能は補完的であり、eAPM の有無にかかわらず使用できます。詳細については、[ネットワーク メトリクス](/docs/ebpf/network-metrics/)を参照してください。

次のデプロイメント オプションが利用可能です。

<table>
  <thead>
    <tr>
      <th>
        アプリケーション メトリクス ソース
      </th>

      <th>
        ネットワーク メトリクス ソース
      </th>

      <th>
        構成
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        APM言語エージェント
      </td>

      <td>
        eBPFエージェント（ネットワークメトリクス専用モード）
      </td>

      <td>
        2人のエージェント
      </td>
    </tr>

    <tr>
      <td>
        eBPF エージェント (eAPM)
      </td>

      <td>
        eBPFエージェント（同じエージェント）
      </td>

      <td>
        単一エージェント
      </td>
    </tr>
  </tbody>
</table>

### 3. 統一された監視アプローチを作成する

上記のプラクティスに従うことで、単一の eBPF エージェントを使用してインフラストラクチャとアプリケーションの両方の監視ニーズに対応できます。これによりオブザーバビリティが統合され、エージェントが重要なアプリケーション パフォーマンス データ (eAPM) とネットワーク メトリクス (eBPF ネットワーク メトリクス) を自動的に収集して既存のダッシュボードに入力できるようになり、コードの変更や再起動を行わずに詳細なコンテキストが提供されます。

**利点：**

* New Relic APM UI に自動的に入力される APM インサイト。
* 同じエージェントのネットワークインサイト。

## 実装の推奨事項 [#implementation-recommendations]

* **大規模なeAPMから始める:**多くのアプリケーションにわたって大規模にプロイ監視を行う必要があり、複雑な調整なしで「十分な」メトリクスが必要な場合は、eBPF を利用したAPMから始めてください。

* **ネットワーク メトリクスを追加して完全な可視性を実現:** eAPMがデプロイされたら、eBPF ネットワーク メトリクスの追加を検討して、アプリケーションの境界を超えて包括的なトラブルシューティング機能を可視化します。

## 関連記事 [#related-articles]

<DocTiles>
  <DocTile title="eBPF Kubernetesインストレーション" path="/docs/ebpf/k8s-installation/">
    Kubernetesクラスタ用にNew Relic eBPFエージェントを設定する方法を学びます。
  </DocTile>

  <DocTile title="eBPF Linux のインストール" path="/docs/ebpf/linux-installation/">
    Linux ホストに New Relic eBPF エージェントを設定する方法を学びます。
  </DocTile>

  <DocTile title="eBPFのトラブルシューティング" path="/docs/ebpf/troubleshooting/no-ui-data/">
    New Relic eBPF エージェントの問題をトラブルシューティングする方法を学びます。
  </DocTile>
</DocTiles>