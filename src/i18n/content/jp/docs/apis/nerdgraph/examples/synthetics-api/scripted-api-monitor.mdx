---
title: スクリプト化されたAPIモニターを管理する
tags:
  - Synthetics
  - APIs
  - NerdGraph
  - Examples
metaDescription: How to use New Relic NerdGraph API to create and update scripted API monitors for synthetic monitoring.
freshnessValidatedDate: never
translationType: machine
---

New Relic では、NerdGraph を使用して[スクリプト化された API モニター](/docs/synthetics/synthetic-monitoring/scripting-monitors/write-synthetic-api-tests)を作成できます。スクリプト化されたAPIモニターは、カスタム JavaScript コードを実行して、ブラウザーを使用せずに API とバックエンド サービスをテストし、HTTP requestsを作成し、プログラム的にレスポンスを検証します。 このチュートリアルでは、NerdGraph API を使用してスクリプト化された API モニターの作成を自動化する方法の例を示します。

## スクリプト化されたAPIモニターを作成する [#create-scripted-api]

`syntheticsCreateScriptApiMonitor`ミューテーションを使用してスクリプト化された API モニターを作成できます。この変更により、JavaScript コードを実行してAPIエンドポイントを検証するカスタムAPIテストをセットアップできるようになります。

### 入力

<table>
  <thead>
    <tr>
      <th>
        パラメータ
      </th>

      <th>
        データタイプ
      </th>

      <th>
        必須ですか?
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `accountId`
      </td>

      <td>
        整数
      </td>

      <td>
        はい
      </td>

      <td>
        モニターが作成される New Relic

        [アカウント ID](/docs/accounts/accounts-billing/account-structure/account-id)

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        配列
      </td>

      <td>
        はい
      </td>

      <td>
        モニターがチェックを実行する 

        [パブリックロケーション](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

        識別子の配列 (例: 

        `["US_EAST_1", "US_WEST_1"]`

         )。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        スクリプト化された API モニターの表示名。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        イナム
      </td>

      <td>
        はい
      </td>

      <td>
        モニターが実行される頻度。オプション: 

        `EVERY_MINUTE`

         、 

        `EVERY_5_MINUTES`

         、 

        `EVERY_10_MINUTES`

         、 

        `EVERY_15_MINUTES`

         、 

        `EVERY_30_MINUTES`

         、 

        `EVERY_HOUR`

         、 

        `EVERY_6_HOURS`

         、 

        `EVERY_12_HOURS`

         、 

        `EVERY_DAY`

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        モニターで使用されるランタイム タイプ。受け入れられる値は

        `NODE_API`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        モニターで使用されるランタイム タイプのバージョン。受け入れられる値は

        `16.10`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        モニターで使用される言語。受け入れられる値は

        `JAVASCRIPT`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        モニターが実行する JavaScript コード。これは base64 でエンコードされたものではなく、プレーンテキストである必要があります。スクリプトは $http オブジェクトを使用して HTTP requests作成し、 APIテストを実行できます。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        イナム
      </td>

      <td>
        はい
      </td>

      <td>
        モニターのステータス。オプション: 

        `ENABLED`

         (モニターはアクティブでチェックを実行中)、 

        `DISABLED`

         (モニターは非アクティブ)。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        浮く
      </td>

      <td>
        いいえ
      </td>

      <td>
        SLA レポートの入力に使用される、モニターの Apdex ターゲット (秒単位)。デフォルトは 7.0 秒です。
      </td>
    </tr>
  </tbody>
</table>

### サンプルリクエスト

```graphql
mutation {
  syntheticsCreateScriptApiMonitor(
    accountId: ACCOUNT_ID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### サンプル回答

成功した応答はエラーに対して`null`を返します:

```json
{
  "data": {
    "syntheticsCreateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

モニターの作成中に問題が発生した場合、 `errors`配列には、何が問題であったかを説明する`description`と`type`フィールドを持つオブジェクトが含まれます。

## スクリプト化されたAPIモニターを更新する [#update-scripted-api]

`syntheticsUpdateScriptApiMonitor`ミューテーションを使用して、既存のスクリプト API モニターを更新できます。これにより、すでに作成されているスクリプトAPIモニターの設定を変更できます。

### 入力

<table>
  <thead>
    <tr>
      <th>
        パラメータ
      </th>

      <th>
        データタイプ
      </th>

      <th>
        必須ですか?
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        更新するモニターの一意のエンティティ

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.public`
      </td>

      <td>
        配列
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターがチェックを実行する 

        [パブリックロケーション](/docs/synthetics/synthetic-monitoring/using-monitors/add-edit-monitors/#setting-location)

        識別子の配列 (例: 

        `["US_EAST_1", "US_WEST_1"]`

         )。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.name`
      </td>

      <td>
        弦
      </td>

      <td>
        いいえ
      </td>

      <td>
        スクリプト化された API モニターの更新された表示名。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.period`
      </td>

      <td>
        イナム
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターが実行される頻度。オプション: 

        `EVERY_MINUTE`

         、 

        `EVERY_5_MINUTES`

         、 

        `EVERY_10_MINUTES`

         、 

        `EVERY_15_MINUTES`

         、 

        `EVERY_30_MINUTES`

         、 

        `EVERY_HOUR`

         、 

        `EVERY_6_HOURS`

         、 

        `EVERY_12_HOURS`

         、 

        `EVERY_DAY`

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        弦
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターで使用されるランタイム タイプ。受け入れられる値は

        `NODE_API`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターで使用されるランタイム タイプのバージョン。受け入れられる値は

        `16.10`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        弦
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターで使用される言語。受け入れられる値は

        `JAVASCRIPT`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        弦
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターが実行する JavaScript コード。これは base64 でエンコードされたものではなく、プレーンテキストである必要があります。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.status`
      </td>

      <td>
        イナム
      </td>

      <td>
        いいえ
      </td>

      <td>
        モニターのステータス。オプション: 

        `ENABLED`

         (モニターはアクティブでチェックを実行中)、 

        `DISABLED`

         (モニターは非アクティブ)。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.apdexTarget`
      </td>

      <td>
        浮く
      </td>

      <td>
        いいえ
      </td>

      <td>
        SLA レポートの入力に使用される、モニターの Apdex ターゲット (秒単位)。デフォルトは 7.0 秒です。
      </td>
    </tr>
  </tbody>
</table>

### サンプルリクエスト

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: ENTITY_GUID
    monitor: {
      locations: { public: ["LOCATION_1", "LOCATION_2"] }
      name: "YOUR_MONITOR_NAME"
      period: PERIOD
      runtime: {
        runtimeType: "RUNTIME_TYPE"
        runtimeTypeVersion: "RUNTIME_TYPE_VERSION"
        scriptLanguage: "SCRIPT_LANGUAGE"
      }
      script: "SCRIPT_CONTENT"
      status: STATUS
      apdexTarget: APDEX_TARGET
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### サンプル回答

成功した応答はエラーに対して`null`を返します:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

モニターの更新中に問題が発生した場合、 `errors`配列には、何が問題であったかを説明する`description`と`type`フィールドを持つオブジェクトが含まれます。

## スクリプト化されたAPIモニターのランタイムをアップグレードする [#upgrade-monitor-runtime]

スクリプト化された API モニターをアップグレードして、新しい Node.js 16.10 ランタイムを使用できます。これにより、モニターで最新の Node.js 機能とセキュリティ更新が使用されるようになります。

### 入力

<table>
  <thead>
    <tr>
      <th>
        パラメータ
      </th>

      <th>
        データタイプ
      </th>

      <th>
        必須ですか?
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        アップグレードするモニターの一意のエンティティ

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        ランタイムタイプ。受け入れられる値は

        `NODE_API`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        ランタイムバージョン。受け入れられる値は

        `16.10`

        のみです。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        スクリプト言語。受け入れられる値は

        `JAVASCRIPT`

        のみです。
      </td>
    </tr>
  </tbody>
</table>

### サンプルリクエスト

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "NODE_API",
        runtimeTypeVersion: "16.10",
        scriptLanguage: "JAVASCRIPT"
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### サンプル回答

成功した応答はエラーに対して`null`を返します:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

モニター ランタイムのアップグレードで問題が発生した場合、 `errors`配列には、何が問題であったかを説明する`description`フィールドと`type`フィールドを持つオブジェクトが含まれます。

## スクリプト API モニターのランタイムをダウングレードする [#downgrade-monitor-runtime]

スクリプト化された API モニターをダウングレードして、レガシー ランタイムを使用することができます。これは互換性の理由で必要な場合がありますが、レガシー ランタイムは 2024 年 10 月 22 日にサポートが終了することに注意してください。

<Callout variant="important">
  レガシー ランタイムは非推奨となり、2024 年 10 月 22 日にサポートが終了します。一時的な互換性が必要な場合を除き、レガシー ランタイムへのダウングレードは推奨されません。
</Callout>

### 入力

<table>
  <thead>
    <tr>
      <th>
        パラメータ
      </th>

      <th>
        データタイプ
      </th>

      <th>
        必須ですか?
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        ダウングレードするモニターの一意のエンティティ

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeType`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        レガシーランタイムを使用するには、空の文字列

        `""`

        に設定します。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.runtimeTypeVersion`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        レガシーランタイムを使用するには、空の文字列

        `""`

        に設定します。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.runtime.scriptLanguage`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        レガシーランタイムを使用するには、空の文字列

        `""`

        に設定します。
      </td>
    </tr>
  </tbody>
</table>

### サンプルリクエスト

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID",
    monitor: {
      runtime: {
        runtimeType: "",
        runtimeTypeVersion: "",
        scriptLanguage: ""
      }
    }
  ) {
    errors {
      description
      type
    }
  }
}
```

### サンプル回答

成功した応答はエラーに対して`null`を返します:

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null
    }
  }
}
```

モニター ランタイムのダウングレードで問題が発生した場合、 `errors`配列には、何が問題であったかを説明する`description`フィールドと`type`フィールドを持つオブジェクトが含まれます。

## VSE が有効なプライベートロケーション間でスクリプト化されたAPIモニターを移動する [#move-monitor]

スクリプト化されたAPIモニターを VSE 対応のプライベートロケーション間で移動できます。 検証済みスクリプト実行 (VSE) を有効にしてプライベートロケーション間でモニターを移動する場合は、セキュリティ検証のために HMAC を再生成するためのスクリプトを含める必要があります。

### 入力

<table>
  <thead>
    <tr>
      <th>
        パラメータ
      </th>

      <th>
        データタイプ
      </th>

      <th>
        必須ですか?
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `guid`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        移動するモニターの一意のエンティティ

        [GUID](/docs/apis/nerdgraph/examples/synthetics-api/query-synthetics-data#query-monitors)

         。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private`
      </td>

      <td>
        配列
      </td>

      <td>
        はい
      </td>

      <td>
        プライベートロケーション設定の配列。 各場所には、VSE 対応の場所の場合は

        `guid`

        と

        `vsePassword`

        必要です。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.guid`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        ターゲットプライベートロケーションのエンティティ GUID。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.locations.private.vsePassword`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        ターゲットプライベートロケーションの VSE パスワード。
      </td>
    </tr>

    <tr>
      <td>
        `monitor.script`
      </td>

      <td>
        弦
      </td>

      <td>
        はい
      </td>

      <td>
        モニターが実行する JavaScript コード。VSE 対応の場所間を移動するときに HMAC を再生成するには、これを含める必要があります。
      </td>
    </tr>
  </tbody>
</table>

### サンプルリクエスト

```graphql
mutation {
  syntheticsUpdateScriptApiMonitor(
    guid: "ENTITY_GUID"
    monitor: {
      locations: {
        private: [{
          guid: "LOCATION_GUID",
          vsePassword: "YOUR_VSE_PASSWORD"
        }]
      },
      script: "SCRIPT_CONTENT"
    }
  ) {
    errors {
      description
      type
    }
    monitor {
      status
    }
  }
}
```

### サンプル回答

成功した応答では、エラーに対して`null`返され、モニターのステータスが含まれます。

```json
{
  "data": {
    "syntheticsUpdateScriptApiMonitor": {
      "errors": null,
      "monitor": {
        "status": "ENABLED"
      }
    }
  }
}
```

モニターの移動に問題がある場合は、 `errors`配列に、何が問題であったかを説明する`description`と`type`フィールドを持つオブジェクトが含まれます。

## スクリプト化されたAPIモニターを削除する [#delete-monitor]

スクリプト化された API モニターが不要になった場合は、 `syntheticsDeleteMonitor`ミューテーションを使用してそれを完全に削除できます。

モニターを削除するには、 [「合成モニターの削除」](/docs/apis/nerdgraph/examples/synthetics-api/ping-monitor/#delete-monitor)セクションを参照してください。