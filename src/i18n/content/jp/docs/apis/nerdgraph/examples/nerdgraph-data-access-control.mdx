---
title: 'NerdGraphチュートリアル: データアクセスポリシーの管理'
tags:
  - Manage data access policies via NerdGraph
  - Manage data access policies via API
metaDescription: 'Use New Relic NerdGraph to create, update, and manage data access policies for controlling access to log partitions.'
freshnessValidatedDate: never
translationType: machine
---

[NerdGraph API を](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/)使用して、データ アクセス ポリシーを作成、クエリ、更新、削除できます。データ アクセス ポリシーは、ユーザーがアクセスできる[ログ パーティション](/docs/logs/ui-data/data-partitions/)を制御し、ユーザー グループに基づいて機密ログ データへのアクセスを制限できます。

## 要件 [#requirements]

NerdGraph 経由でデータ アクセス ポリシーを管理するには、次のものが必要です。

* [ProまたはEnterprise](https://newrelic.com/pricing)エディションのNew Relicアカウント
* [認証ドメインマネージャーの](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#admin-settings)役割
* [コア ユーザーまたはフル プラットフォーム ユーザー](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type)のユーザー タイプ
* 認証用の[ユーザー キー](/docs/apis/intro-apis/new-relic-api-keys/#user-key)。

## あなたが始める前に [#before-you-begin]

データ アクセス ポリシーに NerdGraph API を使用する前に、[データ アクセス制御の](/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control)仕組みを理解し、 [NerdGraph](https://api.newrelic.com/graphiql)に慣れておいてください。

## 共通の属性 [#attributes]

次の属性は、データ アクセス ポリシーのクエリとミューテーションでよく使用されます。

<table>
  <thead>
    <tr>
      <th style={{width: "200px"}}>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `organizationId`
      </td>

      <td>
        ポリシーに関連付けられている組織の ID。ポリシーをフィルタリングしたり、ポリシー作成の範囲を限定したりするために使用されます。
      </td>
    </tr>

    <tr>
      <td>
        `id`
      </td>

      <td>
        ポリシーの一意の識別子。特定のポリシーを更新または削除するときに必要です。
      </td>
    </tr>

    <tr>
      <td>
        `name`
      </td>

      <td>
        データ アクセス ポリシーのユーザーフレンドリな名前。
      </td>
    </tr>

    <tr>
      <td>
        `policy`
      </td>

      <td>
        ポリシーのルールを定義する JSON オブジェクト。含まれるもの:

        * `rules`: ルール オブジェクトの配列。
        * `operations`: 許可または拒否する操作 (例: `SELECT` 、 `*` )。
        * `eventTypes`: どのイベント タイプを`allow` (例: `["*"]` ) または`except` (例: `["Log_accessible"]` ) にするかを指定するオブジェクト。
      </td>
    </tr>

    <tr>
      <td>
        `accountId`
      </td>

      <td>
        ロールがアクセスを許可するアカウント ID。
      </td>
    </tr>

    <tr>
      <td>
        `dataAccessPolicyId`
      </td>

      <td>
        アカウント内のどのデータが許可されるかを定義するデータ アクセス ポリシー ID。
      </td>
    </tr>

    <tr>
      <td>
        `roleId`
      </td>

      <td>
        アクセス レベルを定義するロール ID。
      </td>
    </tr>
  </tbody>
</table>

## 一般的な操作 [#operations]

データ アクセス ポリシーを管理するための最も一般的な操作は次のとおりです。

<CollapserGroup>
  <Collapser id="query-grants" title="アクセス許可に関連付けられたデータ アクセス ポリシーを作成する">
    このクエリは、組織内のすべてのアクセス許可とそれに関連付けられたデータ アクセス ポリシーを取得します。これを使用して、現在どのポリシーが許可に割り当てられているかを取得します。

    ### サンプルクエリ

    ```graphql
    {
      customerAdministration {
        grants(filter: {organizationId: {eq: "YOUR_ORG_ID"}}) {
          items {
            dataAccessPolicy {
              id
              name
            }
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **必須。**助成金が属する組織 ID。フィルタリングするには、等号 ( `eq` ) 演算子を使用します。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "customerAdministration": {
          "grants": {
            "items": [
              {
                "dataAccessPolicy": {
                  "id": "DATA_ACCESS_POLICY_ID",
                  "name": "DATA_ACCESS_POLICY_NAME"
                }
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            組織内の助成金のリスト。
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy`
          </td>

          <td>
            各許可に関連付けられたデータ アクセス ポリシー。
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            データ アクセス ポリシーの一意の識別子。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            データ アクセス ポリシーの名前。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="query-policies" title="組織のデータ アクセス ポリシーを決定する">
    このクエリは、組織内のすべてのデータ アクセス ポリシーを取得します。

    ### サンプルクエリ

    ```graphql
    {
      customerAdministration {
        dataAccessPolicies(
          filter: {organizationId: {eq: "YOUR_ORG_ID"}}
        ) {
          items {
            id
            name
            policy
            status
            version
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **必須。**ポリシーが属する組織 ID。フィルタリングするには、等号 ( `eq` ) 演算子を使用します。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "customerAdministration": {
          "dataAccessPolicies": {
            "items": [
              {
                "id": "ddadbdd2-183b-42d9-8a1a-41ec7692fb4c",
                "name": "Log Operations",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Operations"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              },
              {
                "id": "bb8efcf5-3127-4a4d-b25f-114505a0a68d",
                "name": "Restrict Log_Security",
                "policy": {
                  "rules": [
                    {
                      "eventTypes": {
                        "allow": [
                          "*"
                        ],
                        "except": [
                          "Log_Sec%"
                        ]
                      },
                      "operations": [
                        "*"
                      ]
                    }
                  ]
                },
                "status": "VALID",
                "version": "1.0-logs"
              }
            ]
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `items`
          </td>

          <td>
            組織内のデータ アクセス ポリシーのリスト。
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            データ アクセス ポリシーの一意の識別子。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            データ アクセス ポリシーの名前。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            `operations`と`eventTypes`を含むポリシー ルールを含む JSON オブジェクト。
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            ポリシーの現在のステータス (例: `VALID` )。
          </td>
        </tr>

        <tr>
          <td>
            `version`
          </td>

          <td>
            ポリシーのバージョン (現在は`1.0-logs` )。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="create-policy" title="データアクセスポリシーを作成する">
    この変更により、ログ パーティションへのアクセスを制御する新しいデータ アクセス ポリシーが作成されます。

    ### サンプル変異

    ```graphql
    mutation createMyPolicy {
      dataAccessPolicyCreate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_accessible"]}}]}
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    次の変数も使用できます。

    ```graphql
    mutation createMyPolicy($policy: DataAccessPolicyRawDocument!) {
      dataAccessPolicyCreate(
        policy: $policy
        name: "Test"
        organizationId: "YOUR_ORG_ID"
      ) {
        dataAccessPolicy {
          id
        }
      }
    }
    ```

    ```json
    {
      "policy": {
        "rules": [
          {"operations": ["SELECT"], "eventTypes": {"allow": ["*"], "except": []}}
        ]
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `organizationId`
          </td>

          <td>
            **必須。**New Relic 組織 ID。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **必須。**ポリシーの分かりやすい名前。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **必須。**`operations`と`eventTypes`を使用してポリシー ルールを定義する JSON オブジェクト。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "dataAccessPolicyCreate": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log"
                    ]
                  },
                  "operations": [
                    "*"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            新しく作成されたデータ アクセス ポリシーの一意の識別子。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            データ アクセス ポリシーの名前。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            `operations`と`eventTypes`を含むポリシー ルールを含む JSON オブジェクト。
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            ポリシーのステータス (例: `VALID` )。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="update-policy" title="データアクセスポリシーを更新する">
    このミューテーションは、既存のデータ アクセス ポリシーを更新して、そのルールまたは名前を変更します。

    ### サンプル変異

    ```graphql
    mutation {
      dataAccessPolicyUpdate(
        policy: {rules: [{operations: ["SELECT"], eventTypes: {allow: ["*"], except: ["Log_inaccessible"]}}]}
        name: "Test"
        id: "YOUR_DATA_POLICY_ID"
      ) {
        dataAccessPolicy {
          name
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **必須。**更新するポリシーの ID。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            **オプション。**ポリシーの名前が更新されました。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            **オプション。**`operations`と`eventTypes`を使用して更新されたポリシー ルールを定義する JSON オブジェクト。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "dataAccessPolicyUpdate": {
          "dataAccessPolicy": {
            "assigned": "UNASSIGNED",
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `assigned`
          </td>

          <td>
            ポリシーがいずれかの許可に割り当てられているかどうかを示します (例: `UNASSIGNED` )。
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            更新されたデータ アクセス ポリシーの一意の識別子。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            データ アクセス ポリシーの名前。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            `operations`と`eventTypes`を含む更新されたポリシー ルールを含む JSON オブジェクト。
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            ポリシーのステータス (例: `VALID` )。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="delete-policy" title="データアクセスポリシーを削除する">
    この変更により、既存のデータ アクセス ポリシーが削除されます。

    <Callout variant="important">
      ポリシーを削除すると、割り当てられたすべての許可からそのポリシーが削除されます。これらの権限を持つグループ内のユーザーは、ポリシーで定義されたデータ アクセス制限を失います。
    </Callout>

    ### サンプル変異

    ```graphql
    mutation {
      dataAccessPolicyDelete(id: "YOUR_DATA_POLICY_ID") {
        dataAccessPolicy {
          name
          id
          policy
          status
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            **必須。**削除するポリシーの ID。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "dataAccessPolicyDelete": {
          "dataAccessPolicy": {
            "id": "YOUR_DATA_POLICY_ID",
            "name": "Test",
            "policy": {
              "rules": [
                {
                  "eventTypes": {
                    "allow": [
                      "*"
                    ],
                    "except": [
                      "Log_inaccessible"
                    ]
                  },
                  "operations": [
                    "SELECT"
                  ]
                }
              ]
            },
            "status": "VALID"
          }
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            削除されたデータ アクセス ポリシーの一意の識別子。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            削除されたデータ アクセス ポリシーの名前。
          </td>
        </tr>

        <tr>
          <td>
            `policy`
          </td>

          <td>
            削除されたポリシー ルールを含む JSON オブジェクト。
          </td>
        </tr>

        <tr>
          <td>
            `status`
          </td>

          <td>
            ポリシーのステータス (例: `VALID` )。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="grant-access" title="データアクセスポリシーを使用してアクセス許可を作成する">
    このミューテーションにより、データ アクセス ポリシーを含む新しいアクセス許可が作成され、特定のアカウントとロールに割り当てられます。

    ### サンプル変異

    ```graphql
    mutation {
      authorizationManagementGrantAccess(
        grantAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **必須。**アクセスを許可するアカウント ID。
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **必須。**適用するデータ アクセス ポリシー ID。
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **必須。**権限を定義するロール ID。
          </td>
        </tr>
      </tbody>
    </table>

    ### レスポンス

    応答には、新しく作成されたアクセス許可とその ID が表示されます。
  </Collapser>

  <Collapser id="update-grant" title="データ アクセス ポリシーを使用してアクセス許可を更新する">
    このミューテーションは、既存のアクセス許可を更新して、データ アクセス ポリシーを追加または変更します。

    ### サンプル変異

    ```graphql
    mutation {
      authorizationManagementUpdateAccess(
        updateAccessOptions: {accountAccessGrant: {dataAccessPolicyId: "YOUR_DATA_POLICY_ID"}, ids: YOUR_GRANT_ID}
      ) {
        grants {
          dataAccessPolicy {
            id
          }
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `ids`
          </td>

          <td>
            **必須。**更新する許可 ID。
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **必須。**許可に適用するデータ アクセス ポリシー ID。
          </td>
        </tr>
      </tbody>
    </table>

    ### サンプル回答

    ```json
    {
      "data": {
        "authorizationManagementUpdateAccess": {
          "grants": [
            {
              "dataAccessPolicy": {
                "id": "YOUR_DATA_POLICY_ID"
              },
              "id": "YOUR_GRANT_ID"
            }
          ]
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            応答フィールド
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `grants`
          </td>

          <td>
            更新された助成金のリスト。
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicy.id`
          </td>

          <td>
            許可に現在割り当てられているデータ アクセス ポリシーの ID。
          </td>
        </tr>

        <tr>
          <td>
            `id`
          </td>

          <td>
            更新された許可の ID。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="revoke-grant" title="データ アクセス ポリシーを使用してアクセス許可を取り消す">
    この変更により、データ アクセス ポリシーを含むアクセス許可が削除されます。

    ### サンプル変異

    ```graphql
    mutation {
      authorizationManagementRevokeAccess(
        revokeAccessOptions: {accountAccessGrants: {accountId: YOUR_ACCOUNT_ID, dataAccessPolicyId: "YOUR_DATA_POLICY_ID", roleId: "YOUR_ROLE_ID"}}
      ) {
        accessGrants {
          id
        }
      }
    }
    ```

    <table>
      <thead>
        <tr>
          <th style={{width: "200px"}}>
            パラメータ
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `accountId`
          </td>

          <td>
            **必須。**取り消す許可のアカウント ID。
          </td>
        </tr>

        <tr>
          <td>
            `dataAccessPolicyId`
          </td>

          <td>
            **必須。**取り消す許可のデータ アクセス ポリシー ID。
          </td>
        </tr>

        <tr>
          <td>
            `roleId`
          </td>

          <td>
            **必須。**取り消す付与のロール ID。
          </td>
        </tr>
      </tbody>
    </table>

    ### レスポンス

    応答には、取り消されたアクセス許可とその ID が表示されます。
  </Collapser>
</CollapserGroup>

## 関連トピック [#related-topics]

<DocTiles>
  <DocTile title="データアクセス制御UIガイド" path="/docs/accounts/accounts-billing/new-relic-one-user-management/data-access-control">
    New Relic UI を通じてデータ アクセス ポリシーを管理する方法を学びます。
  </DocTile>

  <DocTile title="ユーザー管理の概念" path="/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts">
    ユーザーの種類、ロール、アクセス管理を理解します。
  </DocTile>

  <DocTile title="NerdGraphでユーザーを管理する" path="/docs/apis/nerdgraph/examples/nerdgraph-manage-users">
    NerdGraph API を使用して、ユーザーとアクセス権限をプログラムで管理します。
  </DocTile>

  <DocTile title="ログパーティション" path="/docs/logs/ui-data/data-partitions/">
    ログ データをパーティションに整理する方法を学びます。
  </DocTile>
</DocTiles>