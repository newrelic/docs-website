---
title: 'NerdGraphチュートリアル: Teamsのカスタムロールを作成する'
tags:
  - Teams
  - APIs
  - NerdGraph
  - Examples
  - Custom roles
metaDescription: How to use New Relic NerdGraph API to create a custom role to create and manage Teams.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

New Relic Teams を使用すると、監視対象のエンティティを、それを所有するチームに接続できます。エンティティの所有者が簡単にわかると、トラブルシューティングが高速化され、チームのコラボレーションが強化され、運用効率が向上します。

## デフォルトのチームアクセス

New Relic は、次の標準ロールを通じて Teams へのデフォルトのアクセスを提供します。

* **読み取りアクセス**: すべてのユーザーには、連絡先情報、チーム メンバー、その他の関連詳細などのメタデータを含む、Teams への読み取りアクセス権があります。
* **チームの変更**:**Organization Product Admin** \[組織製品管理者]ロールを持つユーザーはチームを変更できます。これは、現在**All Product Admin** \[すべての製品管理者の]役割を持つすべてのユーザーに割り当てられる新しい役割です。
* **チームの作成と削除**:**Organization Manager** \[組織マネージャー]または**Authentication Manager** \[認証マネージャー]の役割を持つユーザーは、チームを作成および削除できます。

デフォルトの権限が組織のニーズを満たさない場合は、カスタム ロールが必要になることがあります。このチュートリアルでは、NerdGraph GraphQL ミューテーションを使用して、チームを管理するためのカスタム ロールを作成する方法を説明します。

### プロセス概要

Teams アドミニストレーター カスタム ロールを作成するには、次の操作を行う必要があります。

1. [組織スコープのすべての機能を取得する](#retrieve-organization-scoped-capabilities)
2. [組織IDを取得する](#retrieve-your-organization-id)
3. [Teams に必要な権限 ID を特定する](#retrieve-organization-scoped-capabilities)
4. [Teams アドミニストレーターのカスタム ロールを作成する](#create-custom-role)
5. [ユーザーグループにカスタムロールを追加する](#add-custom-role-to-a-user-group)

## 前提条件

始める前に、次のものを用意してください。

* [一般的なNerdGraphの要件](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/#authentication)
* カスタムロールを作成するための組織管理者ロール権限

## 変異 [#mutations]

New Relic は、チーム マネージャーのカスタム ロールを作成するためのさまざまな NerdGraph ミューテーションを提供します。

<CollapserGroup>
  <Collapser id="retrieve-organization-scoped-capabilities" title="組織スコープの機能を取得する">
    `customerAdministration`ミューテーションを使用して、機能のリスト、その権限 ID、および関連情報を取得します。

    #### 入力

    <table>
      <thead>
        <tr>
          <th>
            パラメータ
          </th>

          <th>
            データタイプ
          </th>

          <th>
            必須ですか?
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `eq`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            Teams のロールを取得するには、値を

            `organization`

            に設定します。
          </td>
        </tr>
      </tbody>
    </table>

    #### サンプルリクエスト

    ```graphql
      {
      customerAdministration {
        permissions(filter: {scope: {eq: "organization"}}) {
            items {
              feature
              category
              id
              product
            }
          }
        }
      }

    ```

    #### サンプル回答

    ```graphql
    {
      "data": {
        "customerAdministration": {
          "permissions": {
            "items": [
              {
                "category": "READ",
                "feature": "Teams",
                "id": "xxxxx",
                "product": "New Relic One"
              },
              {
                "category": "OTHER",
                "feature": "Teams",
                "id": "xxxxxx",
                "product": "New Relic One"
              },
              {
                "category": "DELETE",
                "feature": "Teams",
                "id": "xxxxx",
                "product": "New Relic One"
              },
              {
                "category": "MODIFY",
                "feature": "Teams",
                "id": "xxxxxx",
                "product": "New Relic One"
              }
            ]
          }
        }
      }
    }

    ```

    **次のステップ**: 応答から、次の権限 ID を識別してコピーします。

    * `category: "MANAGE"` （またはニーズに合った適切なカテゴリ）
    * `feature: "Teams"`

    次のステップではこれらの ID が必要になります。
  </Collapser>

  <Collapser id="retrieve-your-organization-id" title="組織IDを取得する">
    後続のミューテーションで使用する組織 ID を取得します。

    #### サンプルリクエスト

    ```graphql
      {
      actor {
        organization {
          id
          }
        }
      }

    ```

    #### サンプル回答

    ```graphql
    {
      "data": {
        "actor": {
          "organization": {
            "id": "xxx****xxx-xx**00**-xxx-x*x*-xx**XXX**XX"
          }
        }
      }
    }

    ```

    **次のステップ**: 応答から組織 ID をコピーします。カスタム ロールを作成するにはこれが必要になります。
  </Collapser>

  <Collapser id="create-custom-role" title="カスタムロールの作成">
    `customRoleCreate`ミューテーションを使用して、Teams 管理用のカスタム ロールを作成します。

    #### 入力

    <table>
      <thead>
        <tr>
          <th>
            パラメータ
          </th>

          <th>
            データタイプ
          </th>

          <th>
            必須ですか?
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            前の手順でコピーした組織 ID。
          </td>
        </tr>

        <tr>
          <td>
            `type`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            タイプを

            `organization`

            に設定します。
          </td>
        </tr>

        <tr>
          <td>
            `name`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            ロールの名前。
          </td>
        </tr>

        <tr>
          <td>
            `permissionId`
          </td>

          <td>
            整数の配列
          </td>

          <td>
            はい
          </td>

          <td>
            最初の手順で取得された Teams 機能の権限 ID。
          </td>
        </tr>

        <tr>
          <td>
            `scope`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            スコープを

            `organization`

            に設定します。
          </td>
        </tr>
      </tbody>
    </table>

    #### サンプルリクエスト

    ```graphql

    mutation {
      customRoleCreate(
        container: {id: "xxx****xxx-xx**00**-xxx-x*x*-xx**XXX**XX", type: "organization"}
        name: "Teams manager"
        permissionIds: [xxxxx, xxxxx]
        scope: "organization"
      ) {
        id
      }
    }

    ```

    #### サンプル回答

    ```graphql

    {
      "data": {
        "customRoleCreate": {
          "id": 9999999
        }
      }
    }

    ```

    **次のステップ**: 返されたロール ID を保存します。このロールをユーザー グループに割り当てるにはこれが必要になります。
  </Collapser>

  <Collapser id="add-custom-role-to-a-user-group" title="ユーザーグループにカスタムロールを追加する">
    カスタム ロールを作成したら、それを New Relic のユーザー グループに割り当てる必要があります。

    ### ステップ1: グループIDを取得する

    利用可能なユーザー グループのリストを取得するには、 `customerAdministration`ミューテーションを使用します。

    #### 入力

    <table>
      <thead>
        <tr>
          <th>
            パラメータ
          </th>

          <th>
            データタイプ
          </th>

          <th>
            必須ですか?
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `id`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            前の手順でコピーした組織 ID。
          </td>
        </tr>
      </tbody>
    </table>

    #### サンプルリクエスト

    ```graphql

    {
      customerAdministration {
        groups(filter: {organizationId: {eq: "xxx****xxx-xx**00**-xxx-x*x*-xx**XXX**XX"}}) {
          nextCursor
          items {
            id
            name
            users {
              items {
                id
                email
              }
            }
          }
        }
      }
    }

    ```

    **次のステップ**: 応答から、Teams ロールを割り当てるグループのグループ ID をコピーします。

    ### ステップ2: ユーザーグループに役割を割り当てる

    `authorizationManagementGrantAccess`ミューテーションを使用して、カスタム ロールをユーザー グループに割り当てます。

    #### 入力

    <table>
      <thead>
        <tr>
          <th>
            パラメータ
          </th>

          <th>
            データタイプ
          </th>

          <th>
            必須ですか?
          </th>

          <th>
            説明
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `roleId`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            前の手順のカスタム ロール ID。
          </td>
        </tr>

        <tr>
          <td>
            `groupId`
          </td>

          <td>
            弦
          </td>

          <td>
            はい
          </td>

          <td>
            ステップ 1 のグループ ID。
          </td>
        </tr>
      </tbody>
    </table>

    #### サンプルリクエスト

    ```graphql
    mutation {
      authorizationManagementGrantAccess(
        grantAccessOptions: {organizationAccessGrants: {roleId: "99999999"}, groupId: "xxx****xxx-xx**00**-xxx-x*x*-xx**XXX**XX"}
      ) {
        roles {
          id
          name
          organizationId
          roleId
          groupId
          displayName
        }
      }
    }

    ```

    #### サンプル回答

    ```graphql
    {
      "data": {
        "authorizationManagementGrantAccess": {
          "roles": [
            {
              "displayName": "Teams manager",
              "groupId": null,
              "id": "99999999",
              "name": "teams_manager",
              "organizationId": "xxx****xxx-xx**00**-xxx-x*x*-xx**XXX**XX",
              "roleId": 99999
            }
          ]
        }
      }
    }

    ```
  </Collapser>
</CollapserGroup>

## 次のステップ

カスタム Teams ロールの作成と割り当てが正常に完了すると、割り当てられたグループ内のユーザーには構成した権限が付与されます。あなたはできる：

* 組織のユーザー管理を通じてロールの使用状況を監視する
* 必要に応じて、同様のNerdGraphミューテーションを使用してロールの権限を変更します。
* さまざまなレベルの Teams アクセスに対して追加のカスタム ロールを作成する

Teams の詳細については、 [Teams のドキュメント](/docs/service-architecture-intelligence/teams/teams/)を参照してください。