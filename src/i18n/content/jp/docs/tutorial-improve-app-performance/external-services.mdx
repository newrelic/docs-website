---
title: 遅い外部サービスと依存関係を特定する
metaDescription: Improve app performance by troubleshooting your third party services with the New Relic external services UI.
freshnessValidatedDate: never
translationType: machine
---

## 目的 [#objectives]

<SideBySide>
  <Side>
    このチュートリアルを終了すると、次のことができるようになります。

    * 外部サービス UI の使用方法を理解する
    * API 呼び出しなどの遅い外部サービスを特定する
    * トランザクションレベルのパフォーマンスのレビュー
  </Side>

  <Side>
    <img title="Screenshot showing the opening map for external services" alt="Screenshot showing the opening map for external services" src="/images/apm_screenshot-crop_external-service-intro.webp" style={{ maxWidth: '50%' }} />
  </Side>
</SideBySide>

## 外部サービスに注目する理由 [#why]

外部サービス機能を使用すると、サービスのアップストリームおよびダウンストリーム アクティビティを観察できます。これらのアップストリームまたはダウンストリームの外部サービスは、インストルメント化した独自のサービス、またはサードパーティのサービスと API 呼び出しである可能性があります。これらの外部サービスの応答時間が遅いと、アプリが滞り、速度が低下します。

## 遅い外部サービスを特定する [#identify]

遅い外部サービスを特定する方法を見てみましょう。

<Steps>
  <Step>
    外部サービス UI に移動します: <DNT>**[one.newrelic.com](https://one.newrelic.com/nr1-core?filters=\(domain%3D'APM'ANDtype%3D'APPLICATION'\)) &gt; (select an app) &gt; Monitor &gt; External services**</DNT>に移動します。まだ有効になっていない場合は、左上の<DNT>**Show new view**</DNT>を切り替えて、右上の<DNT>**Map**</DNT>をクリックします。

    アプリケーションの依存関係 (アップストリームの依存関係とも呼ばれます) は、左側に一覧表示されます。右側には、ダウンストリーム サービスと呼ばれるアプリケーションに依存するサービスがあります。どのサービスが正常であるか、および各サービスのスループットと時間消費を確認できます。サービスを選択すると、そのサービスに関する詳細情報を表示できます。

    すべての上流依存関係にマウスを移動し、応答タイムまたはトレース数が高いものを特定してください。 最近の履歴で大幅な上昇が見られるものには特に注意してください。疑わしいサービスを見つけた場合は、そのサービスにマウスを移動して<DNT>**View traces**</DNT>ボタンを選択し、さらに詳しく調べてください。この新しいペインには、その境界トレースに関する情報が表示され、その境界の利用可能な関数呼び出し、データベース呼び出し、および外部呼び出しが記録されます。
  </Step>

  <Step>
    このページの情報を活用する方法はいろいろありますので、ぜひ参考にしてみてください。ワークフローの例を次に示します。

    1. マップ上で最も太くて暗い線を探し、それを上流または下流のサービスまでたどります。

    2. 上流または下流の頂点をクリックします。

    3. 2 つのサービス間の取引の内訳を表示します。

       <img title="Screenshot showing calls to various endpoints in downstream service" alt="Screenshot showing calls to various endpoints in downstream service" src="/images/apm_screenshot-crop_external-services-downstream.webp" />

       <figcaption>この例では、太いエッジ (線) の 1 つが Order-Composer サービスから Order Status サービスの倉庫エンドポイントまで伸びています。</figcaption>

    4. 特定のトランザクションに最も時間がかかっていると判断した場合は、そのトランザクションをクリックして、その依存関係に特に焦点を当てます。

       <img title="Screenshot showing the transaction between the Order-Composer service and the warehouse endpoint in the Order-Status service" alt="Screenshot showing the transaction between the Order-Composer service and the warehouse endpoint in the Order-Status service" src="/images/apm_screenshot-crop_external-services-specific-transaction.webp" />

       <figcaption>このドリルダウン ビューでは、Order-Composer サービスと Order-Status サービスの倉庫エンドポイント間のトランザクションを確認できます。</figcaption>

    5. このフローのどの時点からでも、時間の経過に伴う変化を示すサポートパフォーマンスチャートを参照してください。

    6. ドリルダウンでディストリビューティッド（分散）トレーシングを表示したい箇所に到達したら、右上の<DNT>**List**</DNT>をクリックし、表内の<DNT>**Traces**</DNT>をクリックします。

       <img title="Screenshot showing the trace link in the table view" alt="Screenshot showing the trace link in the table view" src="/images/apm_screenshot-crop_external-services-link-table.webp" />

       <Callout variant="tip">
         上で使用したようなサービス マップは、システム内の複雑な関係を理解するのに役立ちます。インスツルメントしたサービスが多いほど、ロックを解除するシステムへのオブザーバビリティが向上します。[サービス マップの詳細については、こちらをご覧ください](/docs/new-relic-solutions/new-relic-one/ui-data/service-maps/introduction-service-maps/)。
       </Callout>
  </Step>

  <Step>
    前の手順のマップ ビューは、システムを視覚的に表示するのに最適ですが、問題のある外部サービスを特定するのに苦労している場合は、グラフや表でデータを提供するリスト ビューの方が役立つ場合があります。

    まず、右上の<DNT>**List**</DNT>を選択してリスト ビューに移動します。このページには、低速な外部サービスを識別するために使用できるさまざまな表とグラフが表示されます。このページを使用して、サービスをトリアージします。

    1. <DNT>**Response time**</DNT>グラフをご覧ください。最も遅い 5 つの外部サービスが表示されます。これらは最も遅いサービスですが、他のサービスと比較すると遅いだけであることに注意してください。アプリの動作に支障をきたすほど遅くない可能性があります。
    2. <DNT>**Traced error count**</DNT>をご覧ください。エラーは多量にありますか?もしそうなら、どのサービスから来ているのでしょうか?
    3. 下の表で、サービスを<DNT>**% change**</DNT>で並べ替えます。ここには、サービスの継続時間または呼び出されたトレースが最近どの程度変化したかによってランク付けされたサービスが表示されます。最近急激に増加しているサービスはありますか？

    下部の表でサービス名の横にある<DNT>**View traces**</DNT>選択すると、上記で特定したサービスについてさらに詳しく調べることができます。この情報を使用して、これらのサービスを置き換えたり、 APIコールを最適化したり、サービス間で負荷を分散したりします。
  </Step>
</Steps>

## 作品をチェック [#check-work]

問題の範囲を絞り込んだので、次は解決策を特定します。修正は問題に固有のものになりますが、いくつかの例を次に示します。

* 誤って API を 2 回呼び出していることに気付きました。重複した通話を削除すると、合計応答時間が半分になります。
* 特定の API 呼び出しが毎日正午頃にスロットルを開始し、毎日その時間に API の無料制限に達していることに気付きます。別の API を探すか、アクセスをアップグレードしてください。
* 負荷が高いと、別の内部サービスが制限を超えてヒットし、応答時間が遅くなります。この負荷をより多くのサービスに分散するか、負荷を軽減または最適化する方法を見つけてください。

修正を開発にプッシュしてから、一般的な負荷テストを実行して、アプリが本番環境でどのように実行されるかを把握します。

外部サービスを監視するときは、チャートをよく見てください。

* 外部サービスの応答時間は許容範囲内ですか?これで完了です。
* 彼らは改善しましたか？学んだことを使用して、なぜ彼らが通常よりも改善したのかを理解してください.
* まだ応答時間が遅いですか？データベースに問題があるか、トランザクションの実行が遅い可能性があります。

<DocTiles numbered>
  <DocTile title="Prepare to triage your application" path="/docs/journey-app-slow/root-causes" />

  <DocTile title="Identify problematic transactions" path="/docs/journey-app-slow/problematic-transactions" />
</DocTiles>

<DocTiles>
  <DocTile title="Identify slow database queries" number="3" path="/docs/journey-app-slow/slow-database-queries" />

  <DocTile title="Identify slow external services" number="4" label={{text: 'Current doc', color: '#FCD672'}} path="/docs/journey-app-slow/external-services" />

  <DocTile title="Create performance benchmarks" number="5" path="/docs/journey-app-slow/create-benchmarks/" />
</DocTiles>