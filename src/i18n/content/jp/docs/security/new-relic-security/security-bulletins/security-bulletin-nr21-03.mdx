---
title: Apache Log4jの重大な脆弱性 CVE-2021-44228 - Java
tags:
  - Security
  - Security and Privacy
  - Security bulletin
  - Log4j
metaDescription: 'Apache Log4j CVE-2021-44228, Security Bulletin NR21-03 (Java)'
translationType: machine
---

**影響を受けるバージョン：** (a) 4.12.0 から 6.5.1、および (b) 7.0.0 から 7.4.1 までのすべてのエージェントバージョン

**修正バージョン：** 6.5.2、6.5.3、7.4.2、7.4.3

**脆弱性の識別子:** NR21-03

今回確認された新たな脆弱性 (CVE-2021-44832) は、追加の攻撃ベクトルによってホストシステムへの書き込み権限が付与されない限り、New Relic の Java Agent には影響しないと判断しました。この結果を受けて、この問題を特に緩和するためのAgentの新規リリースは必要ないと判断しました。しかしながら、1月に予定されている次のリリースの一部として、New Relic Java Agentは最新のApacheバージョンのlog4j（現在はCVE-2021-44832をパッチしたバージョン2.17.1）を使用します。

また、New Relic の Java エージェントは、CVE-2021-45046 および CVE-2021-45105 のいずれに対しても脆弱ではないと判断しました。これは、エージェントで使用している log4j が、脆弱性の要件である Thread Context Map の入力データを使用またはサポートしていないラッパーインターフェイスの後ろに置かれているためです。ただし、CVE-2021-44228を完全に防ぐためには、少なくとも6.5.2または7.4.2にアップデートすることをお勧めします。

log4jの新しいバージョンが利用可能になると、私たちはエージェントの新しいバージョンをリリースし続けます。

<table>
  <thead>
    <tr>
      <th>
        New Relic Java エージェントのバージョン
      </th>

      <th>
        Apache log4jのバージョン
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        6.5.1
      </td>

      <td>
        2.15.0
      </td>
    </tr>

    <tr>
      <td>
        6.5.2
      </td>

      <td>
        2.12.2
      </td>
    </tr>

    <tr>
      <td>
        6.5.3
      </td>

      <td>
        2.12.3
      </td>
    </tr>

    <tr>
      <td>
        7.4.1
      </td>

      <td>
        2.15.0
      </td>
    </tr>

    <tr>
      <td>
        7.4.2
      </td>

      <td>
        2.16.0
      </td>
    </tr>

    <tr>
      <td>
        7.4.3
      </td>

      <td>
        2.17.0
      </td>
    </tr>
  </tbody>
</table>

## 概要

New Relicは、オープンソースのlog4jフレームワークに存在する重要な脆弱性に対処するため、Javaエージェントの新バージョンをリリースしました。この脆弱性により、悪意のある行為者がログメッセージやログメッセージのパラメータを使用してデータを流出させたり、任意のコードを実行したりする可能性があります。

ニューレリックは、新しい情報が得られ次第、このセキュリティブルテンおよびお客様向けガイダンスを更新します。

## アクションアイテム [#action]

New Relic Java エージェントの CVE 2021-44228 を修正するために、お客様にはエージェントのリリース 6.5.2 以降 (Java 7 以降が必要) または 7.4.2 以降 (Java 8 以降が必要) にできるだけ早くアップグレードすることをお勧めします。

すでにエージェントのバージョン 6.5.2 または 7.4.2 にアップグレードしている場合は、CVE 2021-44228 に対して保護されているため、今回は再度アップグレードする必要はありません。New Relic の Java エージェントは、CVE-2021-45046 および CVE-2021-45105 のいずれにも該当しないと判断しています。これは、エージェントが log4j を使用する際に、脆弱性の要件である Thread Context Map 入力データを使用またはサポートしないラッパーインターフェイスを使用しているためです。CVE-2021-44228 を完全に防ぐためには、少なくとも 6.5.2 または 7.4.2 にアップデートすることをお勧めします。

<Callout variant="important">
  6.5.2または7.4.2より前のバージョンのエージェントを使用している場合、またはエージェントのバージョンをアップグレードできない場合は、エージェントのログを無効にすることを強くお勧めします。
</Callout>

### Javaエージェントのログを無効にする方法 [#disable]

CVE-2021-44228を修正するために、Javaエージェントのログレベルを `OFF` に設定することができます。これを行うには、以下のいずれかのオプションを使用します。

* ローカルのエージェント設定ファイルを変更する（ `log_level` パラメータを検索する）（再起動の必要はありません）。
* `newrelic.config.log_level=OFF` システムプロパティの定義（要再起動）
* `NEW_RELIC_LOG_LEVEL=OFF` 環境変数を設定する（要再起動）。

エージェントログが無効になっていることは、エージェントログファイルを確認することで確認できます。新しいメッセージが書き込まれていないことを確認してください。

Javaエージェントのロギングを無効にしても、エージェントの機能には影響がなく、観測性の低下もありません。

**注意：** この回避策は、エージェントのバージョンを更新できるようになるまでの一時的な解決策としてのみ推奨されます。

状況が変化した場合には、より多くの情報や改善のための追加手順を共有します。

**アプリケーションで log4j を直接使用している場合は、 [Apache Log4j Security Vulnerabilities](https://logging.apache.org/log4j/2.x/security.html) を注意深く確認してください。このページでは、検討すべき改善策の詳細を提供しています。**

### コンテナ化されたプライベートミニオン [#CPM]

上記のステップは、New Relic Java エージェントのみを修復します。また、New Relic Containerized Private Minion のアップデートが必要な場合もあります。詳しくは、 [NR21-04](/docs/security/new-relic-security/security-bulletins/security-bulletin-nr21-04/) をご参照ください。

## 技術的な脆弱性情報 [#technical-info]

* [CVE-2021-44228 cvss 10.0](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228)
* [CVE-2021-45046 cvss 9.0](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046)
* [CVE-2021-45105 cvss 7.5](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105)
* [CVE-2021-44832 cvss 6.6](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832)
* [Apache Log4jの脆弱性に関するNew Relicのお客様へのセキュリティガイダンス](https://newrelic.com/blog/nerdlog/security-guidance-for-log4j)
* [New Relicを使って脆弱なlog4jのバージョンを持つシステムを特定する方法](https://newrelic.com/blog/how-to-relic/new-relic-log4j-detection)
* [Apache log4jのセキュリティの脆弱性](https://logging.apache.org/log4j/2.x/security.html)
* [New Relic Explorers Hub](https://discuss.newrelic.com/t/log4j-zero-day-vulnerability-and-the-new-relic-java-agent/170322)

## よくあるご質問 [#faq]

<CollapserGroup>
  <Collapser
    id="upgrade-options"
    title="JavaエージェントやJavaのバージョンをアップグレードできない場合、どのような選択肢がありますか？"
  >
    [この bulletin](#action) で推奨されている回避策を実行してください。
  </Collapser>

  <Collapser
    id="versions"
    title="稼働しているエージェントのバージョンを確認するにはどうすればいいですか？"
  >
    エージェントのバージョン情報は、New Relic One ダッシュボード内の **Environment** ページ内に表示されます。詳細は [docs ページ](/docs/apm/agents/manage-apm-agents/troubleshooting/get-environment-data-about-your-apm-app) をご覧ください。
  </Collapser>

  <Collapser
    id="patch-v5"
    title="なぜ agent v5 以下のパッチがないのか？"
  >
    ほとんどのお客様は、エージェントのバージョン6.xまたは7.xを使用しています。お客様には、最高の体験をしていただくために、より新しいバージョンのエージェントを使用することをお勧めします。もし、エージェントのバージョンをアップグレードできない場合は、上記の回避策を実行してください。
  </Collapser>

  <Collapser
    id="update-742"
    title="すでに6.5.1または7.4.1にアップデートしていますが、再度アップデートする必要がありますか？"
  >
    CVE-2021-44228に対する修正がlog4j v2.15.0では不完全であるため、すでにエージェントバージョン6.5.1または7.4.1にアップグレードしている場合は、エージェントのロギングも無効にすることをお勧めします。この重大な脆弱性に対する包括的な保護を確保するために、少なくともJava Agent 6.5.2または7.4.2のリリースに更新することをお勧めします。log4j 2.17.0 でより新しい Java Agent をリリースしていますが、New Relic の Java Agent は CVE-2021-45046 および CVE-2021-45105 のいずれにも影響されないため、6.5.3 または 7.4.3 へのアップデートは重要ではないと判断しています。
  </Collapser>
</CollapserGroup>

## 出版履歴 [#pub-history]

* 2021年12月29日NR21-03 Revision:

  * CVE-2021-44832に関するエージェントの調査結果を反映して更新しました。

* 2021年12月22日NR21-03 メジャーリビジョン

  * CVE-2021-44228、CVE-2021-45046、CVE-2021-45105 に対応した新しい修正バージョン 6.5.3 および 7.4.3 が利用可能です。
  * 脆弱性ごとに悪用可能性のリスク評価を追加し、お客様が改善策を決定する際に役立てています。
  * Agent Logingを無効にしているお客様の機能低下の影響に関する内容を追加しました。

* 2021年12月17日NR21-03 Revision:

  * CVE-2021-45046の深刻度と技術的記述の変更

* 2021年12月16日NR21-03 メジャーリビジョン

  * CVE-2021-44228とCVE-2021-45046の両方に対応する新しい修正バージョン6.5.2が利用可能です。
  * CVE-2021-44228 の悪用から保護するための log4j バージョン 2.15.0 の有効性に関するガイダンスの変更。
  * 推奨ワークアラウンドの変更
  * CVE-2021-44228のNIST技術解説を更新しました。

* 2021年12月14日NR21-03 メジャーリビジョン

  * CVE-2021-44228とCVE-2021-45046の両方に対応する新しい修正バージョン7.4.2が利用可能です。
  * ワークアラウンドオプションを追加しました。
  * New Relic Javaエージェントのアップデートと、お客様がアプリケーションのセキュリティを確保するために行うべきベスト・プラクティスを明確にするために更新しました。
  * 米国国立標準技術研究所（NIST）による技術的な脆弱性の説明とCVSSスコアを追加しました。

* 2021年12月13日NR21-03が更新され、より明確な回避策のガイダンスとFAQが追加されました。

* 2021年12月10日NR21-03公開

## セキュリティの脆弱性をNew Relicに報告 [#report]

ニューレリックは、お客様とお客様のデータのセキュリティを重視しています。私たちの製品やウェブサイトにセキュリティ上の脆弱性を発見された場合、New Relic の協調的開示プログラムに報告していただくことを歓迎し、大変感謝しています。詳細については、 [セキュリティ脆弱性の報告に関するドキュメント](/docs/security/new-relic-security/data-privacy/reporting-security-vulnerabilities) をご覧ください。