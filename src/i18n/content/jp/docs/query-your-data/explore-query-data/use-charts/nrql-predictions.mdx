---
title: NRQL予測
tags:
  - Prediction on a chart
  - Forecasting on a chart
  - NRQL Predictions
  - Forecasting
metaDescription: Use NRQL Predictions to predict future trends and potential performance issues.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

<DNT>**NRQL Predictions**</DNT> New Relicは、メトリクスの履歴データを使用して将来の傾向を予測し、メトリクスが将来どのように動作するかをサイトに提供します。 このプロアクティブなアプローチにより、傾向を視覚化し、潜在的な問題を予測して、タイムリーな介入により最適なシステム パフォーマンスを維持できるようになります。<DNT>**NRQL Predictions**</DNT>自体は潜在的な問題を特定するものではありませんが、傾向を評価し、将来の課題に備えるために必要な情報を提供します。

潜在的な問題を自動的に識別するには、現在パブリック プレビューで利用可能な<DNT>**[Predictive Alerts](/docs/query-your-data/explore-query-data/use-charts/nrql-predictions)**</DNT>機能に登録できます。 <DNT>**Predictive Alerts**</DNT> <DNT>**NRQL Predictions**</DNT>と連携して、予測される傾向が潜在的な問題を示している場合に自動的にアラートをトリガーし、システムをプロアクティブに管理できるようにします。

## 価格 [#pricing]

プレビュー期間中の<DNT>**NRQL Predictions**</DNT>の使用は、お客様のアカウントに関連付けられた価格モデルに適用される注文に従って課金されます。 この機能の使用に関連するNew Relic書き込み言語 (NRQLS) は、コア計算製品として課金されます。 この機能が一般に利用可能になった場合、ご注文に応じて使用料が請求されます。

価格に関する詳細については、弊社の営業チームにお問い合わせいただくか、ご注文を参照してください。

## 登録 [#enrollment]

<DNT>**NRQL Predictions**</DNT>機能に登録するには、 <DNT>**[one.newrelic.com &gt; Administration](https://one.newrelic.com/admin-portal) &amp;gt; Preview &amp;amp; Trials**</DNT>に移動して<DNT>**NRQL predictions**</DNT>有効にします。

## 折れ線グラフまたは面グラフに予測を追加する [#add-prediction]

次の 2 つの方法で、折れ線グラフと面グラフに予測を追加できます。

<CollapserGroup>
  <Collapser id="prediction-on-existing-chart" title="既存のグラフに予測を追加します。">
    既存のグラフに予測を追加するには、次の手順に従います。

    <Steps>
      <Step>
        ### 折れ線グラフまたは面グラフにアクセスする [#access-a-chart]

        1. [one.newrelic.com &gt; All capabilities](https://one.newrelic.com/all-capabilities)に移動します。
        2. 折れ線グラフまたは面グラフに予測を追加するには、 <DNT>**Dashboards**</DNT>から選択するか、 <DNT>**Metrics and events**</DNT>から開きます。
      </Step>

      <Step>
        ### 予測を追加 [#add-prediction]

        予測を追加するには、 <Icon name="fe-more-horizontal" />メニューで、 <DNT>**Predict trend**</DNT>を選択します。 **Data Explorer** \[データ エクスプローラー]では、将来の傾向を予測する予測傾向がグラフに表示されます。 予測範囲はクエリ ウィンドウの 20% に自動的に設定され、灰色で強調表示されます。 予測範囲内ではグラフが点線で表示されます。

        `PREDICT`キーワードがチャート クエリに追加されます。 要件に応じて[クエリを絞り込み](#customize-prediction-range)、実行して最新の傾向を取得できます。

        <Callout variant="tip">
          面グラフに予測を追加すると、グラフの種類が予測付き折れ線グラフに変わります。
        </Callout>
      </Step>

      <Step>
        ### ダッシュボードに追加 [#add-to-dashboard]

        1. 予測を含むグラフをダッシュボードに追加するには、 <DNT>**Add to dashboard**</DNT>クリックします。
        2. ウィジェット名を入力します。
        3. ウィジェットを追加するダッシュボードを選択するか、ウィジェット用の新しいダッシュボードを作成します。

        選択したダッシュボードで予測付きのチャートを表示できるようになりました。
      </Step>
    </Steps>
  </Collapser>

  <Collapser id="use-predict-clause" title="NRQL クエリで `PREDICT` 句を使用します。">
    NRQL クエリに`PREDICT`句を追加するには、次の手順に従います。

    <Steps>
      <Step>
        ### NRQLクエリを作成する [#create-query]

        1. [one.newrelic.com](https://one.newrelic.com)にアクセスし、クエリを作成するアカウントを選択します。
        2. <DNT>**Data Explorer**</DNT>開くには、 <DNT>**Query Your Data**</DNT>を選択します。
        3. NRQL 構文を使用して時系列クエリを作成します。詳細については、 [NRQL 構文のドキュメント](https://docs.newrelic.com/docs/nrql/nrql-syntax-clauses-functions)を参照してください。

        <Callout variant="important">
          クエリに[ メトリックタイムスライスデータ](/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#timeslice-data) 、[`COMPARE WITH`](/docs/nrql/nrql-syntax-clauses-functions/#sel-compare) 句、または[ サブクエリ](/docs/nrql/using-nrql/subqueries-in-nrql/) [内の ネストされた集計](/docs/nrql/using-nrql/nested-aggregation-make-ordered-computations-single-query) が含まれていないことを確認してください。これらの場合、予測はサポートされません。
        </Callout>
      </Step>

      <Step>
        ### 予測を追加 [#add-prediction-to-query]

        チャートに予測を追加するには、クエリに`PREDICT`句を追加して実行します。予測範囲はクエリ ウィンドウの 20% に自動的に設定され、灰色で強調表示されます。予測範囲内ではグラフが点線で表示されます。

        要件に応じて[クエリをさらに絞り込む](#customize-prediction-range)ことができます。
      </Step>

      <Step>
        ### ダッシュボードに追加 [#add-query-to-dashboard]

        1. 予測を含むグラフをダッシュボードに追加するには、 <DNT>**Add to dashboard**</DNT>クリックします。
        2. ウィジェット名を入力します。
        3. ウィジェットを追加するダッシュボードを選択するか、ウィジェット用の新しいダッシュボードを作成します。

        選択したダッシュボードで予測付きのチャートを表示できるようになりました。
      </Step>
    </Steps>
  </Collapser>
</CollapserGroup>

## サポートされている予測アルゴリズム [#supported-algorithm]

現在、 <DNT>**NRQL predictions**</DNT>季節性時系列と非季節性時系列の両方に対して<DNT>**Holt-Winters**</DNT>アルゴリズムのみをサポートしています。これは、予測および予言タスクで一般的に使用される標準アルゴリズムです。Holt-Winters モデルの季節の長さを時間ごと、日ごと、週ごとにサポートします。

## デフォルトの動作 [#defaults]

クエリ内の`PREDICT`句には、次のデフォルトの動作が付属しています。

* **季節性**: データ内の季節性を自動的に検出し、同じ季節の長さを使用して予測モデルを構築します。季節性が見つからない場合は、非季節モデルを構築します。
* **予測ウィンドウ**: クエリ ウィンドウで指定された合計時間範囲の 20% を予測します。
* **トレーニング用の履歴データ**: 現在の書き込みウィンドウと 2 つ前のウィンドウからの履歴データを使用して予測を生成します。
* **時間間隔**: クエリ ウィンドウ内の時系列のデータ ポイント間隔に合わせて、データ投影の一貫性を確保します。

NRQL クエリで`PREDICT`を使用する例:

```sql
FROM Transaction SELECT count(*) WHERE error IS TRUE TIMESERIES PREDICT
```

チャート上のデフォルトの予測は次のように表示されます。

<img title="Default prediction" alt="Default prediction" src="/images/nrql-prediction-default.webp" />

<figcaption>
  <DNT>**[one.newrelic.com &gt; All capabilities](https://one.newrelic.com/all-capabilities) &amp;gt; dashboards**</DNT>: デフォルトの予測。
</figcaption>

## 予測モデルをカスタマイズする [#customize-prediction-range]

トレーニング モデルのハイパーパラメータを手動で設定し、 `USING`および`BY`キーワードを追加することで、予測をカスタマイズできます。NRQL について詳しくは、 [NRQL ドキュメント](/docs/nrql/get-started/introduction-nrql-new-relics-query-language)を参照してください。

<CollapserGroup>
  <Collapser id="hyperparameters" title="モデルのハイパーパラメータを設定します。">
    現在、 <DNT>**Holt-Winters**</DNT>私たちがサポートしている唯一の予測アルゴリズムであり、予測を微調整するのに役立ついくつかのハイパーパラメータが付属しています。次の表を参照して、各ハイパーパラメータの動作を理解し、ユースケースに適したものを選択してください。

    クエリを変更するには、 `PREDICT`句の後に`holtwinters(<hyperparameters>: <value>)`追加します。

    <table id="hyperparameters">
      <thead>
        <tr>
          <th colSpan="3" />
        </tr>

        <tr>
          <th>
            ハイパーパラメータ
          </th>

          <th>
            価値
          </th>

          <th>
            行動
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td rowspan="3" style="width: 300px;">
            `seasonality`
          </td>

          <td>
            `<season length>`
          </td>

          <td>
            時系列の季節性を特定の季節の長さに設定します。シーズンの長さが`integer unit`の時間であることを確認してください。\
            **例**: `1 day`または `3 hours`
          </td>
        </tr>

        <tr>
          <td>
            `AUTO`
          </td>

          <td>
            時系列の季節性を自動的に検出し、識別された季節性に基づいて予測を生成します。
          </td>
        </tr>

        <tr>
          <td>
            `NONE`
          </td>

          <td>
            時系列の季節性を無効にし、季節性のない予測を生成します。

            <Callout variant="important">
              `seasonality: NONE` 季節平滑化係数を設定する`gamma`ハイパーパラメータと互換性がありません。
            </Callout>
          </td>
        </tr>

        <tr>
          <td>
            `alpha`
          </td>

          <td>
            0から1
          </td>

          <td>
            レベルのスムージング係数を設定します。

            * **値が低いほど**、履歴データに重点が置かれます。
            * **値が高いほど**、最近のデータに重点が置かれます。
          </td>
        </tr>

        <tr>
          <td>
            `beta`
          </td>

          <td>
            0から1
          </td>

          <td>
            トレンド平滑化係数を設定します。

            * **値が低いほど**、履歴データに重点が置かれます。
            * **値が高いほど**、最近のデータに重点が置かれます。
          </td>
        </tr>

        <tr>
          <td>
            `gamma`
          </td>

          <td>
            0から1
          </td>

          <td>
            季節平滑化係数を設定します。

            * **値が低いほど**、履歴データに重点が置かれます。
            * **値が高いほど**、最近のデータに重点が置かれます。
          </td>
        </tr>

        <tr>
          <td>
            `phi`
          </td>

          <td>
            0.98対1
          </td>

          <td>
            トレンドの減衰を設定します。

            * **値が低いほど**、予測曲線に対する減衰効果が大きくなり、徐々に平坦な曲線になります。
            * **値が大きいほど**、予測曲線への減衰効果は小さくなります。
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="by"
    title={<><InlineCode>
      BY
    </InlineCode>キーワードを追加します。</>
    }
  >
    `BY`キーワードを使用して、モデルでどのくらい先の時間を予測するかを設定します。たとえば、 `PREDICT BY 3 hours`時系列の最新の時点から 3 時間後の予測を生成します。時間範囲が`integer unit`であることを確認してください。
  </Collapser>

  <Collapser
    id="using"
    title={<><InlineCode>
      USING
    </InlineCode>キーワードを追加します。</>
    }
  >
    `USING`キーワードを使用して、モデルのトレーニングに使用する履歴データの量を指定します。たとえば、 `PREDICT USING 1 day`クエリ ウィンドウと前日のデータを使用してモデルをトレーニングします。時間範囲が`integer unit`であることを確認してください。
  </Collapser>
</CollapserGroup>

ハイパーパラメータ、 `BY` 、 `USING`キーワードとともに`PREDICT`使用する例:

```sql
FROM Transaction SELECT count(*) WHERE error IS TRUE TIMESERIES PREDICT holtwinters(seasonality: AUTO, alpha: 0.2) BY 1 hour USING 2 hours
```

このクエリは季節性を自動検出に設定し、レベル平滑化係数を調整して履歴データを強調します。今後 1 時間を予測し、クエリ ウィンドウの長さと過去 2 時間の履歴データを使用してモデルをトレーニングします。チャートには、カスタマイズされた予測が次のように表示されます。

<img title="Custom prediction" alt="Custom prediction" src="/images/nrql-prediction-custom.webp" />

<figcaption>
  <DNT>**[one.newrelic.com &gt; All capabilities](https://one.newrelic.com/all-capabilities) &amp;gt; dashboards**</DNT>: カスタマイズされた予測。
</figcaption>