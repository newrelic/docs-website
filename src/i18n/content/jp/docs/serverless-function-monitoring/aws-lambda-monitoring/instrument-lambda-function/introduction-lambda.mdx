---
title: AWS Lambda監視の概要
metaDescription: This provides an overview of New Relic's AWS Lambda monitoring and details how to link your accounts.
freshnessValidatedDate: never
translationType: machine
---

New Relic のAWS Lambda向けインストゥルメンテーションは、関数の内部動作を詳細に可視化します。 New Relic エージェントを関数に追加すると、各呼び出しが New Relic によって監視されます。 これにより、関数呼び出しの継続時間、エラーの監視、ソース イベントと関数の応答に関する詳細の記録が可能になります。

/\* AWS Lambda 、拡張性の高いイベント主導の計算サービスを提供し、サーバーのプロビジョニングや管理を必要とせずに、アプリケーションとバックエンド サービスを構築して実行できるようにします。 Lambda上のサーバーレスアーキテクチャーが洗練され、ビジネスクリティカルな役割を担うようになると、より広範なアプリケーションエコシステム内でそのパフォーマンス、運用の健全性、およびインターラクションに対する包括的な可視性を実現することが、信頼性と効率性を維持するために不可欠になります。 最新のアプリケーションは、他のさまざまなマイクロサービス、データベース、サードパーティ API と対話する多数のAWS Lambda関数に大きく依存しています。 このような複雑な環境では、観察に関するいくつかの課題に遭遇する可能性があります。 \* \*\*根本原因の特定が難しい:\*\* 断続的な速度低下などのパフォーマンスの問題が発生したり、 Lambda関数に関連する重要なトランザクションが失敗したりした場合、失敗している関数や問題の原因を正確に特定することは、複雑なパズルになる可能性があります。 \* \*\*サイロ化された監視ビュー:\*\* 専用サーバー レス監視UIと従来のアプリケーション パフォーマンス監視 ( APM ) ビューの間を行き来することになり、パフォーマンスの単一の統一された画像を取得することが困難になる場合があります。 \* \*\*非効率的なデータの関連付け:\*\* 情報が別々のサーバーレス システムとAPM監視システムに存在する場合、パフォーマンス データとイベントを効果的に関連付けることは困難になる可能性があります。 \* \*\*不完全なエンドツーエンドのトレース:\*\* 分散環境内のLambda関数やその他のサービスを通過する単一のリクエストをエンドツーエンドでシームレスにトレースする際に、課題に直面する可能性があります。 \* \*\* Lambdaの限定的な監視 :\*\* APMツールの完全な診断機能と使い慣れたワークフローをLambda関数に直接適用できないことがよくあります。 \* \*\*インサイトの手作業:\*\* Lambdaに関連する問題のコンテキスト全体を理解するには、さまざまなソースからのさまざまな情報をまとめるのに、かなりの手作業が必要になることがよくあります。 これらの観察可能性の課題に対処し、真に統合された監視エクスペリエンスを提供するために、 New Relic AWS Lambda関数を当社のプラットフォームに統合する方法を強化しています。 この取り組みにより、サーバーレス機能がNew Relic APMエクスペリエンスに直接組み込まれ、他のインストゥルメント サービスと並んでサーバーレス機能が第一級住民として扱われます。 私たちの目標は、 Lambda関数に豊富なアプリケーション対応テレメトリーを提供し、完全なコンテキストでパフォーマンスをこれまでより簡単に理解できるようにすることです。 \*/

## 主な特徴 [#key-features]

* **統合されたビューを取得します。**他のサービスに使用しているのと同じAPMインターフェイス内でLambda関数を監視します。 パフォーマンス メトリクス、トレース、ログ (構成時)、エラーなどのサーバーレス テレメトリーを表示し、すべて 1 か所で関連付けられるため、異なる UI を切り替える必要がなくなります。

* **APMのパワーを最大限に活用:** New Relic APM機能の包括的なスイートをLambda関数に直接適用します。 これには、高度なディストリビューティッド（分散）トレーシング、Errors Inbox による詳細なエラー分析、 Lambda関数を組み込んだサービス マップ、迷ダッシュボードなどが含まれます。 詳細については、 [APM のドキュメント](https://docs.newrelic.com/docs/apm/new-relic-apm/getting-started/introduction-apm/)を参照してください。

* **完全なエンドツーエンドのリクエスト トレースを実現します。**リクエストがフロントエンド サービスまたは他のマイクロサービスからAWS Lambda関数を介して接続されたコンポーネントに流れる際に、 requestsシームレスにトレースします。 これにより、アーキテクチャー全体にわたるリクエストのレイテンシと依存関係の明確で中断のない全体像が得られます。 詳細については、 [ディストリビューティッド（分散）トレーシングのドキュメント](https://docs.newrelic.com/docs/distributed-tracing/concepts/introduction-distributed-tracing/)を参照してください。

* **根本原因分析の簡素化:**サーバーレス データをAPMのアプリケーション テレメトリーの残りの部分と統合することにより、 Lambda関数内で発生したのか、アップストリーム/ダウンストリーム サービスで発生したのかに関係なく、問題を迅速に特定して診断できます。

* **サーバーレスの影響をより深く理解する:** Lambda関数がアプリケーションおよび主要なビジネス トランザクションの全体的な健全性とパフォーマンスにどのように貢献しているかを明確に確認し、インサイトをデジタル サービス内での役割に深く反映します。

<img title="New Relic Lambda Entities in APM" alt="New Relic Lambda Entities in APM" src="/images/lambda_overview.webp" />

## AWS Lambda監視はどのように設定できますか? [#config]

New Relicを使用してAWS Lambda監視するには、さまざまな環境、ランタイム、デプロイメント メソッドにわたって計装を構成できます。 設定プロセスについては、次の手順で説明します。

<Steps>
  <Step>
    ### 互換性と要件 [#req]

    AWS Lambda が当社の[互換性と要件](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/compatibility-requirement-lambda-monitoring)を満たしていることを確認してください。
  </Step>

  <Step>
    ### （オプション）AWSアカウントをNew Relicにリンクする [#link]

    アカウントをリンクすると、 AWSアカウントのインベントリを作成し、 Lambda関数の CloudWatchメトリクスを自動的に収集する権限を New Relic に付与することになります。 アカウントをリンクすると、 AWSアカウントのリソースが[エンティティ エクスプローラー](/docs/new-relic-solutions/new-relic-one/core-concepts/new-relic-explorer-view-performance-across-apps-services-hosts/#find)にエンティティとして表示されます。 Lambda関数 エンティティはサーバーレス機能ビューにあります。

    次の統合方法のいずれかで、 AWSと New Relic アカウントをリンクできます。

    <Tabs>
      <TabsBar>
        <TabsBarItem id="1">AWSメトリクスストリーム(推奨)</TabsBarItem> <TabsBarItem id="2">APIポーリング</TabsBarItem>
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="1">
          New RelicがLambda関数を監視するには、 New RelicとAWS間の統合をセットアップする必要があります。 レイテンシを削減し、ポーリングrequestsのスロットルを回避するには、[メトリクス ストリームを](/install/aws-cloudwatch)使用することをお勧めします。
        </TabsPageItem>

        <TabsPageItem id="2">
          メトリクス Streams インテグレーションを使用していない場合は、代わりに[APIポーリング インテグレーション](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling)をセットアップすることを選択できます。 デフォルトでは、 Lambdaサービスが有効になっているAPIポーリング統合は、CloudWatchメトリクスに対して 5 分ごとにポーリングを行います。

          [newrelic-lambda-cli](https://github.com/newrelic/newrelic-lambda-cli)を使用してAPIポーリング統合をセットアップすることはできますが、メトリクス Streams 統合はセットアップできません。

          ```sh
          newrelic-lambda integrations install --nr-account-id YOUR_NR_ACCOUNT_ID \
          --nr-api-key YOUR_NEW_RELIC_USER_KEY
          ```

          [統合インストール コマンド](https://github.com/newrelic/newrelic-lambda-cli?tab=readme-ov-file#aws-lambda-integration)の 1 つのステップで、 [AWS Secrets Manager](https://aws.amazon.com/secrets-manager/)に `NEW_RELIC_LICENSE_KEY` シークレットが作成され、セキュリティが向上します。 これは、他のオプションやフラグとともに、 `--disable-license-key-secret`フラグを使用して構成できます。
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ### AWS Lambda関数を計装する [#instrument]

    Lambda関数を計装するには、エージェントと拡張機能が必要です。 これらのコンポーネントは、New Relic [Lambda レイヤー](https://github.com/newrelic/newrelic-lambda-layers)にまとめられています。 Lambda レイヤーを使用できない場合は、エージェントと拡張機能を関数に手動で組み込むことができます。 Lambda関数の要件に基づいて、次のいずれかのインストルメンテーション方法を選択します。

    <Tabs>
      <TabsBar>
        <TabsBarItem id="layered-instrumentation">階層化されたインストゥルメンテーション</TabsBarItem><TabsBarItem id="sdk-based-instrumentation">SDK ベースのインストゥルメンテーション</TabsBarItem><TabsBarItem id="containerized-instrumentation">コンテナ化されたインストゥル</TabsBarItem>メンテーション
      </TabsBar>

      <TabsPages>
        <TabsPageItem id="layered-instrumentation">
          Lambda関数がZipファイルとしてパッケージ化されており、レイヤーを追加できる場合は、この方法を使用します。 レイヤーは、ライブラリ、カスタム ランタイム、およびその他の依存関係の配布メカニズムです。 詳細については、 [Layered インストゥルメンテーションの](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own/)ドキュメントを参照してください。
        </TabsPageItem>

        <TabsPageItem id="sdk-based-instrumentation">
          Lambda関数がレイヤーを使用できない場合はこのメソッドを使用すると、レイヤーを変更する必要がなく、迅速なデプロイメントが保証されます。 詳細については、 [SDK ベースのインストゥルメンテーションの](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/sdk-based-instrumentation/)ドキュメントを参照してください。
        </TabsPageItem>

        <TabsPageItem id="containerized-instrumentation">
          Lambda関数がコンテナ内で実行される場合は、このメソッドを使用します。 コンテナは、アプリケーションに対して一貫性のある分離された実行環境を提供します。New Relic は、New Relic Lambda レイヤー、New Relic Lambda 拡張機能、および New Relic エージェントを含む、事前に構築された Docker イメージを提供します。詳細については、 [Containerized コンテナの](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/containerized-images/)ドキュメントを参照してください。
        </TabsPageItem>
      </TabsPages>
    </Tabs>
  </Step>

  <Step>
    ### 環境変数を設定する [#env-variables]

    <Callout variant="tip">
      * New Relic CLI を使用して New Relic のLambdaレイヤーをセットアップすると、必須の環境変数が自動的に構成されます。 ただし、デフォルト設定の一部を変更し、監視のニーズに合った環境変数を使用してLambda関数を構成する必要がある場合があります。
      * New Relic Lambda 拡張機能を使用している場合は、環境変数を手動で設定する必要があります。
    </Callout>

    [環境変数は](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/env-variables-lambda)、New Relic エージェントと Lambda 拡張機能を構成するために使用されます。 Lambda関数が正しく監視されるようにするには、これらの変数を正しく設定することが重要です。
  </Step>

  <Step>
    ### New Relicでデータを探す [#data]

    AWS Lambda 関数をセットアップしたら、 New Relic APMインターフェースでデータを検索して使用できるようになります。 データはいくつかの主要な領域に編成されており、それぞれがLambda関数のパフォーマンスと状態に異なるインサイトを提供します。
  </Step>
</Steps>

## サンプル関数をお試しください [#example]

New Relicの Lambda レイヤーをインストゥルメントした後は、サンプル関数を試してみることを強くお勧めします。 これらの実用的な例は、独自のサーバーレス機能を開始するための出発点として使用する必要があります。 これらの例を使用すると、 New Relic Lambda レイヤーやアカウント リンクのテストに慣れることができ、独自のインストゥルメンテーションのリファレンスとしても使用できます。 各例では、権限の追加、ハンドラーをラップするためのランタイム固有の手法、CloudWatch での関数ログ保持の管理などを示します。

Lambda 関数を管理およびデプロイする方法は多数ありますが、この例ではAWS CloudFormation というメカニズムを使用しています。

私たちの例は、New Relic Lambda Extension とともに、この[GitHub リポジトリ](https://github.com/newrelic/newrelic-lambda-extension)で公開されています。 New Relic がサポートする Lambda ランタイムごとに 1 つあります。

* [Node.js](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/node)
* [Python](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/python)
* [Go](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/go)
* [Java](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/java)
* [Ruby](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/ruby)
* [.NET](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/dotnet)

また、ディストリビューティッド（分散）トレーシングの例で、ディストリビュー[ティッド（分散）トレーシングを](https://github.com/newrelic/newrelic-lambda-extension/tree/main/examples/sam/distributedtracing)非自明なサーバーレス アプリケーションに組み込む方法を学ぶこともできます。 これは、Node、Python、 Ruby 、Java 関数を使用して、Lambda 関数を呼び出す可能性のある 2 つの一般的なサービスである SQS と SNS の手動トレース伝播を示しています。

<Callout variant="tip">
  手動でテストする場合、テレメトリーデータが遅延する可能性があります。 バッファリングされたテレメトリが配信されるように、関数を再度呼び出す前に 7 秒待つことをお勧めします。
</Callout>

## コストの考慮 [#costs]

AWS Lambda のサーバーレス監視を実装すると、追加の AWS 料金が発生する場合があります。 New Relic にデータを報告する `newrelic-log-ingestion` Lambda関数はサードパーティのサービスとみなされ、関連するAWS料金はユーザーの責任となります。 [`newrelic-lambda-extension`](https://github.com/newrelic/newrelic-lambda-extension)[New RelicLambda ](https://github.com/newrelic/newrelic-lambda-layers)レイヤー に含まれる を使用すると、ログとテレメトリデータを CloudWatch`newrelic-log-ingestion` 経由で送信することを回避できますが、高可用性のニーズに合わせて 関数を CloudWatch フォールバックとして構成することも可能です。

AWS Lambda のサーバーレス監視を有効にすると、Amazon Web Services の料金が発生する可能性があります。お客様のLambdaデータを当社に報告する`newrelic-log-ingestion` Lambda関数は[サードパーティサービス](/docs/licenses/license-information/general-usage-licenses/acceptable-use-policy)とみなされます。このサービスの使用によって発生するAWS料金はお客様の責任となります。

[New RelicLambda](https://github.com/newrelic/newrelic-lambda-layers) Layers にバンドルされている[ newrelic-lambda-extension](https://github.com/newrelic/newrelic-lambda-extension) を使用すると、CloudWatch および[ newrelic-log-ingestion](https://github.com/newrelic/aws-log-ingestion) 関数を介したログとテレメトリーの送信を回避できます。オブザーバビリティデータの高可用性を必要とする機能の[ CloudWatch](/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/cloud-watch-fallback/) フォールバック メソッドとして newrelic-log-ingestion[ 関数を設定することもできます。](https://github.com/newrelic/aws-log-ingestion)

## 価格 [#pricing]

New Relic APM + Serverless Convergence の使用は、注文に従って APM エンティティとして請求されます。価格に関する詳細については、弊社の営業チームにお問い合わせいただくか、ご注文を参照してください。

## 関連記事 [#related-docs]

<DocTiles>
  <DocTile title="階層化されたインストゥルメンテーション" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/instrument-your-own">
    New Relicの階層化アプローチを使用してLambda関数を計装します。
  </DocTile>

  <DocTile title="SDK計装" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/sdk-based-instrumentation">
    SDK を使用してLambda関数を計装します。
  </DocTile>

  <DocTile title="コンテナ化されたインストゥルメンテーション" path="/docs/serverless-function-monitoring/aws-lambda-monitoring/instrument-lambda-function/containerized-images">
    New Relicのコンテナ化アプローチを使用してLambda関数を計装します。
  </DocTile>
</DocTiles>