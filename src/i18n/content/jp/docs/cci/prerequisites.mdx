---
title: AWS CCI の前提条件
metaDescription: 'Set up AWS for CCI with consolidated billing, CUR, IAM roles, and region activation to optimize cost analysis in New Relic.'
redirect:
  - /docs/cci/getting-started/prerequisites
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

統合請求の設定、コストと使用状況レポートの有効化、安全なアクセスのための IAM ロールとポリシーの構成、必要なAWSリージョンのアクティブ化など、以下の前提条件に従って、 Cloud Cost Intelligence (CCI) 統合用にAWS環境を準備します。 セットアップが New Relic プラットフォーム内で効果的なコスト分析と管理をサポートしていることを確認します。

## 前提条件

<CollapserGroup>
  <Collapser id="aws-account-permissions" title="適切な権限を持つAWSアカウント">
    [統合請求がAWS組織に対して設定されていること](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html)を確認します。 これにより、組織内のすべてのアカウントの請求が統合され、コスト管理が統一されます。
  </Collapser>

  <Collapser id="s3-bucket-creation" title="コストと使用状況レポート用の S3 バケット">
    AWS コストと使用状況レポート (CUR) は S3 バケットに保存されます。S3 バケットは`us-east-2`リージョンに作成することをお勧めします。専用バケットを作成するには、次の手順に従います。

    1. **AWS マネジメントコンソール (AWS Management Console)**にサインインします。

    2. S3 サービスに移動します。

    3. **Create bucket** \[バケットの作成]をクリックします。

    4. 一意のバケット名を入力します (例: `<your-company-name>-billing` )。

    5. バケット設定を構成します。

       * バージョン管理を有効にする
       * パブリックアクセスを無効にする（推奨）
       * デフォルトの暗号化を有効にする（推奨）

    6. **タグ (オプション)** : 組織のリソース管理に必要な場合は、タグを追加します。

    7. **Create bucket** \[バケットの作成]をクリックします。

    <Callout variant="important">
      バケット名は、次の手順と CCI のインストレーション手順で必要になるので覚えておいてください。
    </Callout>
  </Collapser>

  <Collapser id="s3-bucket-creation" title="AWS コストと使用状況レポートの設定">
    S3 バケットに配信されるコストと使用状況レポートを作成します。

    1. **AWS マネジメントコンソール (AWS Management Console)**にサインインします。

    2. **Billing Dashboard** \[請求ダッシュボード]に移動します。

    3. 左側のナビゲーション ペインで、 **Cost &amp; Usage Analysis** \[コストと使用状況分析]をクリックします。

    4. **Data Exports** \[データのエクスポート]をクリックし、 **Create** \[作成]をクリックします。

    5. レポート設定を構成します。

       <table>
         <thead>
           <tr>
             <th width={250}>
               **設定**
             </th>

             <th>
               **価値**
             </th>

             <th>
               **説明**
             </th>
           </tr>
         </thead>

         <tbody>
           <tr>
             <td>
               エクスポートタイプ
             </td>

             <td>
               `Standard Data Export`
             </td>

             <td>
               ほとんどの課金およびコスト分析のユースケースに適した、使用状況とコストに関する詳細な情報を提供します。
             </td>
           </tr>

           <tr>
             <td>
               エクスポート名
             </td>

             <td>
               `Name`
             </td>

             <td>
               CUR レポートのコンテキストを提供するエクスポート名。（ `eg-<company name-billing-cci>` ）&gt;
             </td>
           </tr>

           <tr>
             <td>
               データテーブル
             </td>

             <td>
               `CUR 2.0`
             </td>

             <td>
               CUR 2.0 は最新の FOCUS 形式のテーブル構造をサポートしています。
             </td>
           </tr>

           <tr>
             <td>
               リソースIDを含める
             </td>

             <td>
               `ON`
             </td>

             <td>
               個々の AWS リソースに関連するコストの詳細な追跡を可能にし、きめ細かな分析と請求に役立ちます。
             </td>
           </tr>

           <tr>
             <td>
               分割コスト配分データ
             </td>

             <td>
               `OFF`
             </td>

             <td>
               特に必要でない場合は、このオプションをオフにしておくとデータ構造が簡素化されます。カスタムコストカテゴリまたは分割に基づいてデータを分離することを回避します。分析に詳細なコスト配分分割が必要でない限り、これを省略できます。
             </td>
           </tr>

           <tr>
             <td>
               時間の粒度
             </td>

             <td>
               `Hourly`
             </td>

             <td>
               時間の粒度を時間単位に設定します。この設定は、プラットフォームの機能をサポートする詳細なコストと使用状況の分析を可能にするために不可欠です。
             </td>
           </tr>

           <tr>
             <td>
               圧縮タイプ
             </td>

             <td>
               `Parquet`
             </td>

             <td>
               クエリのパフォーマンスを向上させ、ストレージ スペースを削減する列指向のストレージ ファイル形式。大量のデータを効率的に処理するのに役立ちます。
             </td>
           </tr>

           <tr>
             <td>
               ファイルのバージョン管理
             </td>

             <td>
               `Create New Report Version`
             </td>

             <td>
               CUR が更新されるたびに、新しいバージョンが作成されます。これにより、時間の経過に伴うコストの変化を監査および追跡するのに役立つ履歴レポートが保持されます。
             </td>
           </tr>

           <tr>
             <td>
               データ更新設定
             </td>

             <td>
               `AUTOMATIC`
             </td>

             <td>
               手動による介入なしに、CUR データが最新の使用状況とコストの情報で最新の状態に保たれることを保証します。
             </td>
           </tr>

           <tr>
             <td>
               データエクスポート設定 S3バケット
             </td>

             <td>
               `Existing (Select the bucket created in Step 1)`
             </td>

             <td>
               作成された CUR ファイルは、以下で説明する定義済みのパスを使用して S3 バケットに保存されます。ポリシーの上書きに同意します（次のステップで新しいポリシーをマッピングします）
             </td>
           </tr>

           <tr>
             <td>
               S3 パスプレフィックス
             </td>

             <td>
               `cost-and-usage-reports`
             </td>

             <td>
               コストと使用状況レポート (CUR) が S3 バケット内で正しく整理され、保存されるようにし、効率的なアクセスと管理を容易にします。
             </td>
           </tr>
         </tbody>
       </table>

    6. **Next** \[次へ]をクリックし、 **Create report** \[レポートの作成]をクリックします。

    <Callout variant="important">
      エクスポート名は、CCI の統合ステップで必要になるため、覚えておいてください。 また、S3 パス プレフィックスが cost-and-usage-reports であることを検証します。
    </Callout>

    <Callout variant="caution" title="注記">
      最初の CUR レポートは 24 時間以内に配信されます。以降のレポートは定期的に配信されます。
    </Callout>
  </Collapser>

  <Collapser id="iam-policy-cci-access" title="CCI アクセスの IAM ポリシー">
    CUR データにアクセスするために必要な権限を CCI に付与する IAM ポリシーを作成します。

    1. **AWS マネジメントコンソール (AWS Management Console)**にサインインします。
    2. **IAM service** \[IAM サービス]に移動します。
    3. 左側のナビゲーション ペインで**Policies** \[ポリシー]をクリックします。
    4. **Create policy** \[ポリシーの作成]をクリックします。
    5. **JSON エディター (JSON editor)**に切り替えて、次のポリシーを貼り付けます。

    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
        {
        "Action": ["s3:Get*", "s3:List*"],
        "Effect": "Allow",
        "Resource": [
            "arn:aws:s3:::<bucket-name>/*",
            "arn:aws:s3:::<bucket-name>"
        ],
        "Sid": "AccessMasterPayerBillingBucket"
        },
        {
        "Effect": "Allow",
        "Action": [
            "pricing:DescribeServices",
            "pricing:GetAttributeValues",
            "pricing:GetProducts",
            "pricing:GetPriceListFileUrl",
            "pricing:ListPriceLists"
        ],
        "Resource": ["*"]
        }
    ]
    }
    ```

    <Callout variant="important">
      bucket-name を、**S3 bucket for Cost and Usage reports** \[コストと使用状況レポート用の S3 バケット] ステップで作成した S3 バケットの実際の名前に置き換えます。
    </Callout>

    6. **Next**\[次へ]をクリックします。
    7. ポリシーに`CCI-Access-Policy` (または任意の名前) という名前を付けます。
    8. 説明を追加します。
    9. **Create policy** \[ポリシーの作成]をクリックします。
  </Collapser>

  <Collapser id="iam-role-cci-access" title="CCIが担うIAMロール">
    CCI が CUR データにアクセスするために引き受ける IAM ロールを作成します。

    1. **AWS マネジメントコンソール (AWS Management Console)**にサインインします。
    2. IAM サービスに移動します。
    3. 左側のナビゲーション パネルで**Roles** \[ロール]をクリックします。
    4. **Create role** \[ロールの作成]をクリックします。
    5. 信頼されたエンティティ タイプ セクションで、**Custom Trust Policy** \[カスタム信頼ポリシーを]選択します。
    6. 次のロール定義をエディターに貼り付けます。
       ```json
       {
       "Version": "2012-10-17",
       "Statement": [
           {
           "Effect": "Allow",
           "Principal": {
               "AWS": "arn:aws:iam::207192125115:user/cci_global_user"
           },
           "Action": "sts:AssumeRole",
           "Condition": {
               "StringEquals": {
               "sts:ExternalId": "<externalID>"
               }
           }
           }
       ]
       }
       ```

    <Callout variant="caution" title="注記">
      externalId は、CCI 統合サービスの動的な一意の識別子であり、CCI に戻って統合を開始すると生成されます。
    </Callout>

    7. **Next**\[次へ]をクリックします。
    8. [CCI アクセス ステップの IAM ポリシー](#iam-policy-cci-access)で作成したポリシーを添付します。
    9. **Next**\[次へ]をクリックします。
    10. ロール名: `CCI-Access-Role` (または希望する名前)。
    11. 説明を追加します（オプション）。
    12. **Create role** \[ロールの作成]をクリックします。
    13. ロールの作成後、ロール ARN (ロールの概要ページに表示されます) をメモします。

    <Callout variant="important">
      統合プロセス中にロール ARN を CCI に提供する必要があります。
    </Callout>
  </Collapser>
</CollapserGroup>

## リアルタイムコスト見積りの前提条件

CCI で予想コストの表示を有効にするには、計装方法に関連付けられた特定の前提条件を満たしていることを確認してください。

<table>
  <thead>
    <tr>
      <th>
        方法
      </th>

      <th>
        説明
      </th>

      <th>
        いつ選ぶか
      </th>

      <th>
        前提条件
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        インフラストラクチャエージェントと統合
      </td>

      <td>
        詳細な監視にはNew Relic Infrastructureエージェントを使用します。
      </td>

      <td>
        詳細な可視性/制御のために選択し、スタンドアロンの EC2、EKS/EC2、または ECS/EC2 セットアップに最適です。
      </td>

      <td>
        * スタンドアロン EC2 を使用している場合は、 New Relic Infrastructure エージェントをインストールします。
        * EKS/EC2 がある場合は、 Kubernetesインテグレーションをインストールします。
        * ECS/EC2 をお持ちの場合は、ECS インテグレーションをインストールしてください。 このメソッドは AWS Fargate ではサポートされていません。
      </td>
    </tr>

    <tr>
      <td>
        クラウドインテグレーション（メトリクス）
      </td>

      <td>
        直近の監視にはAWS CloudWatchメトリクスを利用します。
      </td>

      <td>
        リアルタイムのデータが不可欠な場合に選択します。最新のインサイトが必要な動的な環境に適しています。
      </td>

      <td>
        [Amazon CloudWatch Metric Streams](/install/aws-cloudwatch/)

        を設定します。
      </td>
    </tr>

    <tr>
      <td>
        クラウドインテグレーション (ポーリング) - レガシー
      </td>

      <td>
        AWSサービスを定期的にポーリングしてデータを収集します。
      </td>

      <td>
        更新頻度が低い環境に適しています。レガシー オプションは、メトリクス ベースのアプローチが実現可能性が低い場合に使用されます。
      </td>

      <td>
        [AWSポーリング統合](/docs/infrastructure/amazon-integrations/connect/set-up-aws-api-polling/)

        をセットアップします。
      </td>
    </tr>
  </tbody>
</table>

## Kubernetes コスト配分の前提条件

* [Kubernetesインテグレーションをインストールします](https://docs.newrelic.com/install/kubernetes/)。 AWS Fargate 統合は、この機能ではサポートされていません。
* 標準の Kubernetes ラベル ( `app.kubernetes.io/name` 、 `app.kubernetes.io/instance` 、 `app.kubernetes.io/component` 、 `app.kubernetes.io/part-of` ) に加えて、デプロイメント環境と担当チームを示すために、 `environment`や`team`などの 2 つのカスタム ラベルを追加することを検討してください。また、 `project`や`costCenter`などの 2 つのカスタム リソース タグを追加することも検討してください。これらのラベルとリソース タグは、Kubernetes のコスト割り当てデータをより適切にセグメント化して分析するのに役立ちます。

## 推奨事項

* AWS アカウントで[コスト配分タグを](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html)設定します。タグ付けにより、コストの詳細かつ意味のある分類が可能になります。効果的なコストのフィルタリングとグループ化を実現するには、少なくとも 2 つのカスタム リソース タグが AWS リソース全体に一貫して適用されていることを確認します。
* 最適なパフォーマンスとコスト効率を得るには、 `us-east-2`リージョンにある S3 バケットを使用します。

## アクセス制御に関するアドバイス

指定されたNew Relicアカウント/組織にアクセスできるすべてのユーザーは、 Cloud Cost Intelligence内でAWSクラウドのコスト データを表示できます。 cloudコスト データの安全かつコンプライアンスに準拠した処理を実現するために、社内のアクセス制御ポリシーに適合した適切なNew Relicアカウント/組織を慎重に選択することをお勧めします。

<Callout variant="important">
  **S3バケットアクセス**

  New Relic では S3 バケットへの読み取りアクセスのみが必要であり、このアクセスは New Relic 側からの単一の IAM ロールに制限されます。必要な操作を容易にしながらデータを保護するために、このアクセス レベルが維持されるようにしてください。
</Callout>