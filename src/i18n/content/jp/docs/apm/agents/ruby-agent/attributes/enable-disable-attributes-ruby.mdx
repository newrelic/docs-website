---
title: アトリビュートの有効化・無効化（Ruby）
tags:
  - Agents
  - Ruby agent
  - Attributes
metaDescription: 'How to include and exclude specific attributes for your New Relic Ruby agent, including properties and rules.'
translationType: machine
---

ここでは、属性を有効または無効にするためのプロパティと、New Relic が [宛先](/docs/agents/manage-apm-agents/agent-data/agent-attributes#destinations) に対してどの属性を含めるか、または除外するかを決定する際に使用するルールについて説明しています。また、New Relic エージェントの属性のリリースに伴い、廃止された Ruby エージェントのプロパティについてもまとめています。

## プロパティ

以下のプロパティを使用して、属性を有効または無効にします。

<CollapserGroup>
  <Collapser
    id="attributes-enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、すべての宛先に対して属性の取得を有効にします。
  </Collapser>

  <Collapser
    id="transaction_tracer-attributes-enabled"
    title="transaction_tracer.attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定されていると、エージェントはトランザクショントレースの属性をキャプチャーします。
  </Collapser>

  <Collapser
    id="transaction_events-attributes-enabled"
    title="transaction_events.attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定されていると、エージェントはトランザクションイベントの属性をキャプチャーします。
  </Collapser>

  <Collapser
    id="error_collector-attributes-enabled"
    title="error_collector.attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、エージェントはエラーコレクションから属性を取得します。
  </Collapser>

  <Collapser
    id="browser_monitoring-attributes-enabled"
    title="ブラウザモニタリングの属性を有効にする"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true` の場合、エージェントはブラウザモニタリングから属性を取得します。
  </Collapser>

  <Collapser
    id="span-events-attributes-enabled"
    title="span_events.attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true` の場合、エージェントはスパンイベントの属性を取得します。
  </Collapser>

  <Collapser
    id="transaction-segments-attributes-enabled"
    title="transaction_segments.attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (ダイナミック)
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `new_relic_transaction_segments_attributes_enabled`
          </td>
        </tr>
      </tbody>
    </table>

    `true` の場合、エージェントはトランザクションセグメントの属性をキャプチャします。
  </Collapser>

  <Collapser
    id="attributes-exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    すべての宛先から除外する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="transaction_tracer-attributes-exclude"
    title="transaction_tracer.attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクショントレースから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="transaction_events-attributes-exclude"
    title="transaction_events.attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションイベントから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="error_collector-attributes-exclude"
    title="error_collector.attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクションから除外する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。

    [error.message](/attribute-dictionary?attribute_name=error.message) の収集を防ぐには、代わりに [strip_exception_messages](/docs/agents/ruby-agent/configuration/ruby-agent-configuration#strip_exception_messages-enabled) の設定を使用します。
  </Collapser>

  <Collapser
    id="browser_monitoring-attributes-exclude"
    title="ブラウザ_モニタリング.アトリビュート.エクスクルード"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    ブラウザモニタリングから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="span-events-attributes-exclude"
    title="span_events.attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    spanイベントから除外する属性のプレフィックス。末尾にワイルドカードとして `*` を付けることができます。
  </Collapser>

  <Collapser
    id="transaction-segments-attributes-exclude"
    title="transaction_segments.attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `new_relic_transaction_segments_attributes_exclude`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクション・セグメントから除外する属性のプレフィックス。末尾にワイルドカードとして `*` を指定できます。
  </Collapser>

  <Collapser
    id="attributes-include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    すべての宛先に含める属性のプレフィックス。末尾のワイルドカードとして `*` を許可します。
  </Collapser>

  <Collapser
    id="transaction_tracer-attributes-include"
    title="transaction_tracer.attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクショントレースに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="transaction_events-attributes-include"
    title="transaction_events.attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションイベントに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="error_collector-attributes-include"
    title="error_collector.attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクションに追加する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="browser_monitoring-attributes-include"
    title="ブラウザ_モニタリング.属性.インクルード"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    ブラウザモニタリングに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="span-events-attributes-include"
    title="span_events.attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    スパンイベントに含める属性のプレフィックス。末尾にワイルドカードとして `*` を付けることができます。
  </Collapser>

  <Collapser
    id="transaction-segments-attributes-include"
    title="transaction_segments.attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            環境変数
          </th>

          <td>
            `new_relic_transaction_segments_attributes_include`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクション・セグメントに含める属性のプレフィックス。末尾にワイルドカードとして `*` を付けることができます。
  </Collapser>
</CollapserGroup>

## アトリビュートルール [#attruls]

New Relic は、デスティネーションにどの属性を含めるか、または除外するかを決定する際に、これらのルールに従います。

<CollapserGroup>
  <Collapser
    id="rule-root-precedence"
    title="Rootレベルが優先されて有効になります。"
  >
    `attributes.enabled` フィールドは、他のすべての設定に優先します。 `false` の場合、属性は New Relic に報告されません。

    設定例

    ```
    attributes.enabled: false
        attributes.include: foo, bar
        transaction_tracer.attributes.enabled: true
    ```

    出力例。

    ```
    Keys passed in: foo, bar, baz
        Keys included for all destinations:
        Keys excluded for all destinations: foo, bar, baz
    ```
  </Collapser>

  <Collapser
    id="rule-destination-precedence"
    title="Destination enabledはincludeやexcludeよりも優先されます。"
  >
    `YOUR_DESTINATION.attributes.enabled` フラグは、includeおよびexcludeキーよりも優先されます。

    設定例

    ```
    transaction_tracer.attributes.enabled: false
        attributes.include: one, two
        transaction_tracer.attributes.include: three, four
    ```

    出力例。

    ```
    Keys passed in: one, two, three, four
        Keys included for transaction traces:
        Keys excluded for transaction traces: one, two, three, four
    ```
  </Collapser>

  <Collapser
    id="rule-included-destination"
    title="属性は、デスティネーションが有効な場合に含まれます。"
  >
    デスティネーションが有効な場合、すべてのユーザー属性はデフォルトでそのデスティネーションに送信されます。

    **注意：** すべてのユーザー属性のデフォルトは `true` です。ただし、デフォルトでは、すべての送信先でリクエストパラメーターが無効になっています。

    設定例

    ```
    attributes.enabled: true
        attributes.exclude: baz
    ```

    出力例。

    ```
    Keys passed in: foo, bar, baz
        Keys included: foo, bar
        Keys excluded: baz
    ```
  </Collapser>

  <Collapser
    id="rule-exclude-wins"
    title="Excludeは常にIncludeに優先します。"
  >
    includeリストとexcludeリストに同じキーが記載されている場合は、指定されたキーを持つ属性は除外されます。

    設定例

    ```
    attributes.enabled: true
        attributes.include: foo, bar
        attributes.exclude: nerd, bar
    ```

    出力例。

    ```
    Keys passed in: foo, bar, nerd
        Keys included: foo
        Keys excluded: nerd, bar
    ```
  </Collapser>

  <Collapser
    id="rule-keys-case-sensitive"
    title="キーは大文字と小文字を区別します。"
  >
    キーは大文字と小文字を区別します。

    設定例

    ```
    attributes.enabled: true
        attributes.exclude: username, UsErNaMe
    ```

    出力例。

    ```
    Keys passed in: username, Username, USERNAME, UsErNaMe, userNAME
        Keys included: Username, USERNAME, userNAME
        Keys excluded: username, UsErNaMe
    ```
  </Collapser>

  <Collapser
    id="rule-star-wildcard"
    title={<>ワイルドカードには <InlineCode>\*</InlineCode> を使用してください。</>}
  >
    キーの最後にアスタリスク `*` を付けると、ワイルドカードとして使用できます。これは、同じプレフィックスを持つ属性のセットにマッチします。

    設定例

    ```
    attributes.enabled: true
        attributes.include: custom*
        attributes.exclude: request.parameters.*
    ```

    出力例。

    ```
    Keys passed in: custom, custom.key1, custom.key2, request.parameters., request.parameters.foo, request.parameters.bar
        Keys included: custom, custom.key1, custom.key2
        Keys excluded: request.parameters., request.parameters.foo, request.parameters.bar
    ```
  </Collapser>

  <Collapser
    id="rule-specific-wins"
    title="キーの具体的な設定が優先されます。"
  >
    複数のincludeまたはexclude属性が同じキーに影響を与える場合は、最も具体的な設定が優先されます。

    設定例

    ```
    attributes.enabled: true
        attributes.include: request.parameters.foo
        attributes.exclude: request.parameters.*
    ```

    出力例。

    ```
    Keys passed in: request.parameters., request.parameters.foo, request.parameters.bar
        Keys included: request.parameters.foo
        Keys excluded: request.parameters., request.parameters.bar
    ```
  </Collapser>

  <Collapser
    id="rule-destination-include-exclude"
    title="特定のデスティネーションに影響を与えます。"
  >
    デスティネーションにincludeまたはexclude属性が指定されている場合、そのデスティネーションにのみ影響を与えます。

    設定例

    ```
    attributes.include: foo
        transaction_events.attributes.exclude: foo
    ```

    出力例。

    ```
    Keys passed in: foo
        Keys included for transaction events: 
        Keys included for other destinations: foo
        Keys excluded for transaction events: foo
    ```
  </Collapser>
</CollapserGroup>

## URI関連のプロパティ [#uri]

デフォルトでは、Ruby Agent は Uniform Resource Identifier (URI) を New Relic に報告しますが、その報告先は以下のように複数あります。

* `request.uri` [エラーイベントの属性](/docs/apm/applications-menu/error-analytics/error-analytics-manage-error-traces)
* `http.url` [spanイベントの属性です。](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing)
* `url` attribute of [slow SQL traces](/docs/apm/applications-menu/monitoring/view-slow-query-details)
* `uri` [外部リクエストセグメントの属性です。](/docs/agents/ruby-agent/features/http-client-tracing-ruby)

New Relic では、これらの URI には有用なデバッグ情報が含まれているため、レポートすることを推奨しています。報告してほしくない機密データがURIに含まれている場合は、URI報告を無効にすることができます。たとえば、機密データには、電子メールアドレスやアカウントIDなどがあります。URI報告を無効にするには、上記の属性名のいずれかを `attributes.exclude` リストに追加します。

例えば、以下のキーを設定ファイルに追加すると、エージェントがURI関連のプロパティを報告しなくなります。

```
attributes.exclude: <mark>uri</mark>
```

## 非推奨のプロパティ [#deprecated]

以下のプロパティは非推奨となりました。Rubyエージェントをアップグレードする際には、これらのプロパティを新しい属性設定に切り替えてください。

<table>
  <thead>
    <tr>
      <th width={200}>
        **償却資産**
      </th>

      <th>
        **新規物件**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `capture_params`
      </td>

      <td>
        `attributes.include: request.parameters.*`
      </td>
    </tr>

    <tr>
      <td>
        `resque.capture_params`
      </td>

      <td>
        `attributes.include: job.resque.args.*.`
      </td>
    </tr>

    <tr>
      <td>
        `sidekiq.capture_params`
      </td>

      <td>
        `attributes.include: job.sidekiq.args.*.`
      </td>
    </tr>

    <tr>
      <td>
        `transaction_tracer.capture_attributes`
      </td>

      <td>
        `transaction_tracer.attributes.enabled`
      </td>
    </tr>

    <tr>
      <td>
        `error_collector.capture_attributes`
      </td>

      <td>
        `error_collector.attributes.enabled`
      </td>
    </tr>

    <tr>
      <td>
        `ブラウザー・モニタリング・キャプチャー・アトリビュート`
      </td>

      <td>
        `ブラウザモニタリングの属性を有効にする`
      </td>
    </tr>

    <tr>
      <td>
        `analytics_events.capture_attributes（アナリティクス・エベント・キャプチャー・アトリビュート`
      </td>

      <td>
        `transaction_events.attributes.enabled`
      </td>
    </tr>
  </tbody>
</table>