---
title: Kubernetes APM 自動アタッチでデータがない
type: troubleshooting
tags:
  - Agents
  - Ruby agent
  - Kubernetes
  - Troubleshooting
  - Sinatra
metaDescription: 'If you are not seeing New Relic data for a non-Rails Ruby application using the Kubernetes APM auto-attach, you may need to explicitly call `Bundler.require`.'
freshnessValidatedDate: never
translationType: machine
---

## 問題

非 Rails フレームワーク (Sinatra など) 用の Kubernetes APM 自動アタッチを備えた New Relic Ruby エージェントを使用していますが、New Relic アカウントに APM データが表示されません。

## 解決

アプリケーションの起動プロセスの早い段階で`Bundler.require`明示的に呼び出します。

多くのフレームワークでは、アプリケーション クラスが定義される前に、メイン アプリケーション ファイルまたは`config.ru`ファイルに追加することでこれを実行できます。

例 ( `config.ru`または`app.rb` ):

```ruby
# config.ru

require 'bundler'
Bundler.require

# ... rest of your application's startup code
require_relative './my_sinatra_app'
run MySinatraApp
```

このコードを追加した後、アプリケーションを再デプロイします。数分以内に New Relic にデータが表示され始めます。

## 原因

Kubernetes APM の自動アタッチは、 `Bundler::Runtime#require`メソッドにパッチを適用して`newrelic_rpm` gem をアプリケーションに挿入することによって機能します。

Rails アプリケーションは起動プロセス中に`Bundler.require`自動的に呼び出しますが、他の多くのフレームワークでは呼び出しません。`Bundler.require`が呼び出されない場合、New Relic エージェントはアプリケーションの環境にロードされません。この行を追加すると、エージェントが期待どおりにロードされるようになります。