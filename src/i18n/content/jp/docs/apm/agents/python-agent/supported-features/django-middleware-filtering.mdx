---
title: Djangoミドルウェア 計装フィルタリング
tags:
  - Agents
  - Python agent
  - Supported features
metaDescription: Python agent (Django) middleware instrumentation filtering
freshnessValidatedDate: never
translationType: machine
---

Pythonエージェントは、どのDjangoミドルウェアを監視すべきかをフィルタリングできるようになりました。 デフォルトでは、すべてのミドルウェアがインストゥルメント化されます。

<Callout variant="important">
  Djangoのミドルウェア計装フィルタリングは、 Pythonエージェント バージョン 10.17.0 以降で利用できます。 デフォルトでは、すべてのミドルウェアがインストゥルメント化されます。 この設定を変更するには、 [ドキュメント](/docs/apm/agents/python-agent/configuration/python-agent-configuration/#middleware-filters)をご覧ください。
</Callout>

## すべてのDjangoミドルウェアを無効にする [#django-middleware-disable]

Djangoでミドルウェアを無効にするには、次の 2 つの方法のいずれかを実行します。

1. `NEW_RELIC_INSTRUMENTATION_DJANGO_MIDDLEWARE_ENABLED`環境変数を `False`
2. 構成ファイルで`instrumentation.middleware.django.enabled = false`設定します。

## Djangoミドルウェアの構成設定 [#django-middleware-configuration-settings]

<CollapserGroup>
  <Collapser id="config-middleware-django-include" title="instrumentation.middleware.django.include">
    <table>
      <tbody>
        <tr>
          <th>
            タイプ：
          </th>

          <td>
            ストリングスの空間分離されたリスト
          </td>
        </tr>

        <tr>
          <th>
            デフォルト：
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    属性が有効な場合、このリストにあるすべての属性キーが送信されます。
  </Collapser>

  <Collapser id="config-middleware-django-exclude" title="instrumentation.middleware.django.exclude">
    <table>
      <tbody>
        <tr>
          <th>
            タイプ：
          </th>

          <td>
            スペースで区切られた文字列のリスト
          </td>
        </tr>

        <tr>
          <th>
            デフォルト：
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    このリストのすべての属性キーは **not** 送信されます。
  </Collapser>
</CollapserGroup>

## ミドルウェアの除外/包含ルール [#django-middleware-rules]

エージェントは、監視対象に含めるか除外するかを決定する際に、次のルールに従います。

<CollapserGroup>
  <Collapser id="rule-destination-precedence" title="有効は、含めるおよび除外よりも優先されます。">
    `instrumentation.middleware.FRAMEWORK.enabled`フラグは、include ミドルウェアと exclude ミドルウェアよりも優先されます。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = false
    instrumentation.middleware.django.include = one two
    instrumentation.middleware.django.include = three four
    ```

    出力例。

    ```
    Middleware used in app: one, two, three, four
    Middleware included for monitoring:
    Middleware excluded for monitoring: one, two, three, four
    ```
  </Collapser>

  <Collapser id="rule-included-destination" title="宛先が有効になっている場合はミドルウェアが含まれます。">
    宛先が有効になっている場合、すべてのミドルウェアはデフォルトでその宛先に送信されます。

    すべてのミドルウェア監視のデフォルトは`true`です。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = true
    instrumentation.middleware.django.exclude = baz
    ```

    出力例。

    ```
    Middleware used in app: foo, bar, baz
    Middleware included for monitoring: foo, bar
    Middleware excluded for monitoring: baz
    ```
  </Collapser>

  <Collapser id="rule-exclude-wins" title="Excludeは常にIncludeに優先します。">
    含めるリストと除外リストに同じミドルウェアが含まれている場合、指定された名前のミドルウェアは除外されます。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = true
    instrumentation.middleware.django.include = foo bar
    instrumentation.middleware.django.exclude = nerd bar
    ```

    出力例。

    ```
    Middleware used in app: foo, bar, nerd
    Middleware included for monitoring: foo
    Middleware excluded for monitoring: nerd, bar
    ```
  </Collapser>

  <Collapser id="rule-middleware-name-case-sensitive" title="ミドルウェア名では大文字と小文字が区別されます。">
    ミドルウェア名では大文字と小文字が区別されます。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = true
    instrumentation.middleware.django.exclude = username UsErNaMe
    ```

    出力例。

    ```
    Middleware used in app: username, Username, USERNAME, UsErNaMe, userNAME
    Middleware included for monitoring:  Username, USERNAME, userNAME
    Middleware excluded for monitoring:  username, UsErNaMe
    ```
  </Collapser>

  <Collapser
    id="rule-star-wildcard"
    title={<>ワイルドカードには<InlineCode>
      \*
    </InlineCode>を使用してください。</>
    }
  >
    名前の末尾にアスタリスク`*`ワイルドカードとして使用できます。これにより、同じプレフィックスを持つミドルウェアのセットが一致します。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = true
    instrumentation.middleware.django.include = custom*
    instrumentation.middleware.django.exclude = request.parameters.*
    ```

    出力例。

    ```
    Middleware used in app: custom, custom.key1, custom.key2, request.parameters., request.parameters.foo, request.parameters.bar
    Middleware included for monitoring: custom, custom.key1, custom.key2
    Middleware excluded for monitoring: request.parameters., request.parameters.foo, request.parameters.bar
    ```
  </Collapser>

  <Collapser id="rule-specific-wins" title="最も具体的なミドルウェア名が優先されます。">
    複数の include または exclude 名が同じミドルウェアに影響する場合は、最も具体的な名前が優先されます。

    設定例

    ```ini
    instrumentation.middleware.django.enabled = true
    instrumentation.middleware.django.include = request.parameters.foo
    instrumentation.middleware.django.exclude = request.parameters.*
    ```

    出力例。

    ```
    Middleware used in app: request.parameters., request.parameters.foo, request.parameters.bar
    Middleware included for monitoring: request.parameters.foo
    Middleware included for monitoring: request.parameters., request.parameters.bar
    ```
  </Collapser>
</CollapserGroup>