---
title: wsgi_application (PythonエージェントAPI)
type: apiDoc
shortDescription: WSGIアプリケーションのエントリーポイントをマークすることで、Webトランザクションを監視します。
tags:
  - Agents
  - Python agent
  - Python agent API
metaDescription: 'Python API: Instruments an application''s WSGI entry point to capture web requests.'
translationType: machine
---

## 構文

```py
newrelic.agent.wsgi_application(application=None, name=None, group=None, framework=None)
```

WSGIアプリケーションのエントリーポイントをマークすることで、Webトランザクションを監視します。

## 説明

`wsgi_application` は、WSGI アプリケーションのエントリ ポイントを計測することによって Web トランザクションを監視するために使用される Python デコレータです。Python エージェントは、WSGI を使用する [ほとんどのフレームワークとサーバーを](/docs/agents/python-agent/getting-started/compatibility-requirements-python-agent) 自動的にサポートします。フレームワークまたは Web サーバーがサポートされていない場合は、 [高度な統合プロセス](/docs/agents/python-agent/installation-configuration/python-agent-integration#manual-integration)の一部としてこの API を使用する必要がある場合があります。

`wsgi_application` デコレータを使用できない場合は、次の他の呼び出し形式のいずれかを使用できます。

* **ラッパー:** ラッパー呼び出しは `WSGIApplicationWrapper`です。スタック可能な個別の WSGI アプリケーション コンポーネントに対して、複数の場所でラッパーを使用できます。その場合、最初に見つかったラッパーがトランザクションの開始をマークし、エージェントはその最初のラッパーに基づいてターゲット アプリを決定します (その後のラッパーは無視されます)。
* **パスベースのラッパー:** パスベースのラッパー呼び出しは `wrap_wsgi_application`です。インストルメンテーション スコープ内の変数として WSGI オブジェクトを参照できなかった場合は、これを使用します。これは、追加の `module` と `object_path` パラメーターを備えたデコレーターと同じパラメーターを受け取ります。

デコレーターとラッパーを使い分ける理由については、 [Different call formats](/docs/python-agent-api-different-call-forms) を参照してください。

## パラメーター

### デコレーターのパラメータ

```py
newrelic.agent.wsgi_application(application=None, name=None, group=None, framework=None)
```

`wsgi_application`デコレータは次のパラメータを使用します:

<table>
  <thead>
    <tr>
      <th width="25%">
        パラメータ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `application`

        _string_、または _アプリケーションオブジェクト_
      </td>

      <td>
        オプション。このデータに関連付けるアプリケーション名。デフォルトは `None`です。値を指定しない場合、エージェントは [エージェント設定で指定された](/docs/agents/python-agent/installation-configuration/python-agent-configuration#app_name)アプリケーション名を使用します。

        文字列を指定する場合は、正確なアプリケーション名である必要があり、アプリケーション名のリストを指定することはできません。アプリケーション オブジェクトの生成の詳細については、 [`application`](/docs/agents/python-agent/python-agent-api/application) メソッドをご覧ください。

        リクエスト環境ディクショナリごとに WSGI アプリケーション内で `newrelic.app_name` 定義されている場合、アプリケーションは指定されている場合でもオーバーライドできます。
      </td>
    </tr>

    <tr>
      <td>
        `name`

        _ストリング_
      </td>

      <td>
        オプション、ほとんど使用されません。WSGIエントリーポイントを介して取得されるすべてのリクエストのトランザクション名を設定します。通常は、すべてのトランザクションが同じ名前になることを望まないため、一般的には使用されません（ [Metric grouping issue](/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues) も参照してください）。
      </td>
    </tr>

    <tr>
      <td>
        `group`

        _ストリング_
      </td>

      <td>
        オプションですが、ほとんど使用されません。 `group` は、 `name` パラメータの命名構造を表します。これを設定すると、 [トランザクション タイプ サブカテゴリ](/docs/apm/applications-menu/monitoring/transactions-page#tx_functions)が作成されます。 `name`と同様に、通常はアプリケーション全体を 1 つのトランザクション名またはカテゴリとしてレポートする必要がないため、これはほとんど使用されません。
      </td>
    </tr>

    <tr>
      <td>
        `framework`

        _タプル_
      </td>

      <td>
        オプション。フレームワークの名前とバージョン番号を表す 2 つの文字列を含むタプル。例えば： `('Flask', '0.12.2')`
      </td>
    </tr>
  </tbody>
</table>

### ラッパーのパラメーター

```py
newrelic.agent.WSGIApplicationWrapper(wrapped, application=None, name=None, group=None, framework=None)
```

これは、 `wrapped` パラメータに加えて、 `wsgi_application` で必要なすべての [パラメータ](#decorator-parameters) を受け取ります。

<table>
  <thead>
    <tr>
      <th width="25%">
        パラメータ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `wrapped`

        _物体_
      </td>

      <td>
        必須。ラップされるWSGIオブジェクトです。
      </td>
    </tr>
  </tbody>
</table>

### パスベースのラッパーパラメーター [#path-based-parameters]

```py
newrelic.agent.wrap_wsgi_application(module, object_path, application=None, name=None, group=None, framework=None)
```

`wsgi_application`で必要な [パラメータ](#decorator-parameters) に加えて、この呼び出しには追加の `module` パラメータと `object_path` パラメータが必要です。

<table>
  <thead>
    <tr>
      <th width="25%">
        パラメータ
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `module`

        _オブジェクト_ または _文字列_
      </td>

      <td>
        必要です。WSGIオブジェクトを含むモジュールです。
      </td>
    </tr>

    <tr>
      <td>
        `object_path`

        _ストリング_
      </td>

      <td>
        必須です。クラスメソッドまたはファイル内のWSGIオブジェクトを見つけるためのメソッドを表します。
      </td>
    </tr>
  </tbody>
</table>

## 例

### wsgi_application の例 [#decorator-example]

オプションの `application` パラメータを指定せずに呼び出されるデコレータの例:

```py
@newrelic.agent.wsgi_application()
def application(environ, start_response):
    status = '200 OK'
    output = 'Hello World!'

    response_headers = [('Content-type', 'text/plain'),
                        ('Content-Length', str(len(output)))]
    start_response(status, response_headers)

    return [output]
```

### WSGIApplicationWrapperの例 [#wrapper-example]

`WSGIApplicationWrapper`の使用例。これは、 `wsgi_application` デコレーターが機能しない場合に必要になる可能性があります。

```py
import os
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "mysite.settings")
from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()

application = newrelic.agent.WSGIApplicationWrapper(application)
```

### wrap_wsgi_applicationの例 [#path-based-example]

パスベースのラッパーの使用例。

```py
import newrelic.agent
newrelic.agent.initialize('newrelic.ini')

class Application(object):
    def application(self, environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/plain')]
        start_response(status, response_headers)
        return [b'Hello World']

newrelic.agent.wrap_wsgi_application(__name__, 'Application.application')
```