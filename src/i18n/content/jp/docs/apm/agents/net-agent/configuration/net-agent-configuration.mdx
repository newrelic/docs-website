---
title: .NETエージェントの設定
tags:
  - Agents
  - NET agent
  - Configuration
metaDescription: 'How to configure the New Relic .NET agent using newrelic.config, including startup and instrumentation options, and disabling unwanted features.'
freshnessValidatedDate: never
translationType: machine
---

import apmNetAgentConfigurationHierarchy from 'images/apm_diagram_net-agent-configuration-hierarchy.webp'

[New Relic アカウントを作成し](https://newrelic.com/signup)(永久に無料です)、.NET エージェントを[インストールする](/install/dotnet)と、ご使用の環境に合わせて .NET エージェントを構成できます。

## 設定概要 [#config-overview]

APMエージェントの設定オプションでは、エージェントの動作の一部を制御することができます。これらの設定オプションの中には、基本的なインストールプロセスの一部であるもの（ライセンスキーやアプリ名の設定など）もありますが、ほとんどは、ログレベルの設定、プロキシホストアクセスの設定、特定の属性の除外、分散型トレースの有効化など、より高度な設定です。

.NET エージェントは、[インストール プロセス](/docs/agents/net-agent/installation//install/dotnet-agent)の一部として生成される`newrelic.config`ファイルから構成を取得します。デフォルトでは、グローバル`newrelic.config`ファイルのみが作成されますが、マルチアプリ システムをより細かく制御するためにアプリローカル`newrelic.config`ファイルを作成することもできます。構成オプションを設定するその他の方法には、環境変数を使用する方法や、UI からサーバー側の構成を設定する方法があります。さまざまな構成オプションと、何が何をオーバーライドするかについて詳しくは、[構成設定の優先順位](/docs/agents/net-agent/configuration/net-agent-configuration#config-options-precedence)を参照してください。

.NET Frameworkと.NET Coreの両方をサポートする場合、特に断りがない限り、同じ構成オプションを使用し、同じAPM機能を備えています。

構成ファイルに変更を加えて、それが正しい形式であることを検証したい場合は、任意のXSDバリデーターを使用してXSDファイル（たとえば、Windowsの場合は`C:\ProgramData\New Relic\.NET Agent\newrelic.xsd` ）と照合できます。

<Callout variant="important">
  <DoNotTranslate>**For IIS**</DoNotTranslate>: `newrelic.config`または`app.config`ファイルを変更した後、管理コマンド プロンプトから`IISRESET`を実行します。 ログレベルの調整にはリセットは必要ありません。
</Callout>

## 設定方法と優先順位レベル [#config-options-precedence]

インストール時に、.NETエージェントの構成ファイル（ `newrelic.config` ）はすべての監視対象アプリケーションに適用されますが、他の方法でエージェントを構成できます。これは、さまざまな構成オプションが互いにどのように優先されるかを示す図です。

<img
  title="net-config-precedence-core.png"
  alt="New Relic .NET agent configuration settings precedence"
  src={apmNetAgentConfigurationHierarchy}
/>

<figcaption>
  この図は、.NETエージェントを構成するさまざまな方法について、優先順位を説明しています。
</figcaption>

ここでは、図に示された設定方法の詳細と、その優先順位について説明します。

<table>
  <thead>
    <tr>
      <th style={{ width: "230px" }}>
        <DoNotTranslate>
          **.NET configuration**
        </DoNotTranslate>
      </th>

      <th>
        <DoNotTranslate>
          **Details and precedence**
        </DoNotTranslate>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `web.config` または`app.config`または `appsettings.json`
      </td>

      <td>
        これらのファイルで設定された設定が最も優先されます。

        エージェントがローカルまたはグローバル `newrelic.config`で無効になっている場合:

        * `appsettings.json`

          <DoNotTranslate>**will enable the agent**</DoNotTranslate>

          の`NewRelic.AgentEnabled`設定。

        * `web.config`または`app.config`ファイル

          <DoNotTranslate>**will be ignored**</DoNotTranslate>

          の`NewRelic.AgentEnabled`設定。
      </td>
    </tr>

    <tr>
      <td>
        環境変数
      </td>

      <td>
        2番目に高い優先順位です。これらの詳細については、 [.NET環境変数](#environment-variables) を参照してください。
      </td>
    </tr>

    <tr>
      <td>
        サーバー側の構成
      </td>

      <td>
        3番目に高い優先順位です。 [限られた数のサーバー側の構成](/docs/agents/manage-apm-agents/configuration/server-side-agent-configuration) の設定が利用できます。その他の設定は、他の構成ソースから得られます。
      </td>
    </tr>

    <tr id="local">
      <td>
        アプリローカル `newrelic.config`
      </td>

      <td>
        4番目に高い優先順位。 app-local `newrelic.config`ファイルを作成して、マルチアプリシステムで個々のアプリを構成できます。これらのローカル構成ファイルは、グローバル`newrelic.config`ファイルの設定を上書きします。

        エージェントは、以下のディレクトリにあるアプリローカルの設定ファイルを、この順番で探します。

        * `NewRelic.ConfigFile`プロパティを使用して`web.config`または`app.config`ファイルで指定されたディレクトリ

        * Webアプリのルートディレクトリ（ `app.config`または`web.config`を含む）

        * アプリの実行ファイルがあるディレクトリ

          app-local構成ファイルが完全であり、XSDファイルに対して検証する必要があることに注意してください（たとえば、Windowsの場合は`C:\ProgramData\New Relic\.NET Agent\newrelic.xsd` ）。
      </td>
    </tr>

    <tr>
      <td>
        デフォルト（グローバル） `newrelic.config`
      </td>

      <td>
        デフォルトのソースと最低の優先順位。他の構成ファイルがない場合に、ホスト上のすべてのアプリケーションを構成します。グローバル設定ファイルは、NewRelicエージェントのホームディレクトリにあります。 `%PROGRAMDATA%\New Relic\.NET Agent`
      </td>
    </tr>
  </tbody>
</table>

## 必要な環境変数 [#environment-variables]

.NETエージェントは、環境変数に依存して、.NET共通言語ランタイム（CLR）にNewRelicをプロセスにアタッチするように指示します。一部の[.NETエージェントのインストール手順](/docs/agents/net-agent/installation/new-relic-net-agent-install-introduction)（MSIインストーラーなど）では、これらの変数が自動的に設定されます。一部の手順では、手動で設定する必要があります。

<Callout variant="caution">
  セキュリティ上の推奨事項です。どのユーザがシステム環境変数を設定できるかを考慮する必要があります。また、ユーザの環境変数がシステムの環境変数を上書きしないように、アプリケーションを実行するアカウントを保護する必要があります。
</Callout>

<CollapserGroup>
  <Collapser
    id="net-framework-env-variables"
    title=".NET Frameworkの環境変数"
  >
    .NET Frameworkの場合、次の変数が必要です。

    ```ini
    COR_ENABLE_PROFILING=1
    COR_PROFILER={71DA0A04-7777-4EC6-9643-7D28B46A8A41}
    NEWRELIC_INSTALL_PATH="INSERT_THE_PATH_TO_THE_AGENT_DIRECTORY"
    ```

    Windows .NET エージェント インストーラ (.msi) は、これらをデフォルトで IIS に追加するか、または `Instrument All`を有効にしたときにシステム全体の環境変数として追加します。

    Windows .NETエージェントインストーラーを使用する場合は、 `NEWRELIC_INSTALL_PATH`が`C:\Program Files\New Relic\.NET Agent\`に設定されていることを確認してください。これは、エージェントDLLがシステムに配置される場所です。

    これらの変数の詳細、およびその他のインストール シナリオの正しい値については、 [「.NET エージェントの環境変数](/docs/apm/agents/net-agent/other-installation/understanding-net-agent-environment-variables/)について」を参照してください。

    Nugetパッケージを介してエージェントをインストールする場合、エージェントに [は異なる環境変数のセットが](/docs/apm/agents/net-agent/install-guides/install-net-agent-using-nuget/#nuget-framework)必要です。
  </Collapser>

  <Collapser
    id="net-core-env-variables"
    title=".NET Coreの環境変数"
  >
    .NET Coreの場合、次の変数が必要です。

    <DoNotTranslate>
      **Linux:**
    </DoNotTranslate>

    ```ini
    CORECLR_ENABLE_PROFILING=1
    CORECLR_PROFILER={36032161-FFC0-4B61-B559-F6C5D41BAE5A}
    CORECLR_NEWRELIC_HOME=<var>path/to/agent/directory</var>
    CORECLR_PROFILER_PATH="${CORECLR_NEWRELIC_HOME}/libNewRelicProfiler.so"
    ```

    <DoNotTranslate>
      **Windows (MSI Installer):**
    </DoNotTranslate>

    ```ini
    CORECLR_ENABLE_PROFILING=1
    CORECLR_PROFILER={36032161-FFC0-4B61-B559-F6C5D41BAE5A}
    NEWRELIC_INSTALL_PATH=<var>C:\Program Files\New Relic\.NET Agent\</var>
    CORECLR_NEWRELIC_HOME=<var>C:\ProgramData\New Relic\.NET Agent\</var>
    ```

    Windows .NET エージェント インストーラーは、これらをデフォルトで IIS に追加するか、 `Instrument All`を有効にしたときにシステム全体の環境変数として追加します。例外: IIS 以外でホストされている .NET Core アプリケーションを計測するには、 `CORECLR_ENABLE_PROFILING` を手動で設定する必要があります。.NET Framework アプリケーションの [.NET Framework の互換性と要件を](/docs/agents/net-agent/getting-started/net-agent-compatibility-requirements-net-framework) 参照してください。

    これらの変数の詳細、およびその他のインストール シナリオの正しい値については、 [「.NET エージェントの環境変数](/docs/apm/agents/net-agent/other-installation/understanding-net-agent-environment-variables/)について」を参照してください。

    WindowsでNugetパッケージを介してエージェントをインストールする場合、エージェントには[異なる環境変数のセットが](/docs/apm/agents/net-agent/install-guides/install-net-agent-using-nuget/#nuget-windows)必要です。
  </Collapser>
</CollapserGroup>

" お使いのシステムで以前に（New Relic 以外の）監視サービスを使用していた場合、New Relic エージェントをインストールして使用しようとすると、"プロファイラーの競合が発生する可能性があります。詳細はこちらをご覧ください。

<CollapserGroup>
  <Collapser
    id="profiler-conflicts"
    title="プロファイラーのコンフリクトに関する説明"
  >
    New Relicの.NETエージェントは、環境変数に依存して、.NET共通言語ランタイム（CLR）にNewRelicをプロセスにロードするように指示します。インストール関連の環境変数はMicrosoft変数であり、NewRelic変数ではありません。これらは他の.NETプロファイラーで使用でき、一度に1つのプロファイラーのみをプロセスにアタッチできます。このため、以前のアプリケーション監視製品を使用したことがある場合は、[プロファイラーの競合](/docs/agents/net-agent/troubleshooting/profiler-conflicts)が発生する可能性があります。
  </Collapser>
</CollapserGroup>

具体的なインストール方法については、 [.NETエージェントのインストールドキュメント](/docs/agents/net-agent/installation/new-relic-net-agent-install-introduction) をご覧ください。

## オプションの環境変数 [#optional-environment-variables]

New Relic の .NET エージェントの設定オプションの中には、設定ファイルで設定する代わりに、環境変数で設定できるものがあります。以下に、.NETエージェントで認識される環境変数のリストと値の例を示します。

```ini
NEW_RELIC_LICENSE_KEY=XXXXXXXX
NEW_RELIC_LOG=MyApp.log
NEW_RELIC_APP_NAME=Descriptive Name
MAX_TRANSACTION_SAMPLES_STORED=500
MAX_EVENT_SAMPLES_STORED=500
NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
NEW_RELIC_SPAN_EVENTS_ENABLED=false
NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED=2000
NEW_RELIC_LABELS=foo:bar;zip:zap
NEW_RELIC_PROXY_HOST=hostname
NEW_RELIC_PROXY_URI_PATH=path.to/something.aspx
NEW_RELIC_PROXY_PORT=5000
NEW_RELIC_PROXY_USER=myusername
NEW_RELIC_PROXY_PASS=XXXXXXXX
NEW_RELIC_PROXY_DOMAIN=mydomain.com
NEW_RELIC_PROXY_PASS_OBFUSCATED=XXXXXXXX
NEW_RELIC_CONFIG_OBSCURING_KEY=XXXXXXXX
NEW_RELIC_DISABLE_SAMPLERS=true
NEWRELIC_PROFILER_LOG_DIRECTORY=<var>path\to\a\directory</var> (not configurable via config file)
NEWRELIC_LOG_DIRECTORY=<var>path\to\a\directory</var> (Insert a directory where you want to put the agent and profiler logs. You can't set this directory for both agent and profiler logs in the configuration file.)
NEWRELIC_LOG_LEVEL=<var>off|error|warn|info|debug|finest|all</var>
NEW_RELIC_APPLICATION_LOGGING_ENABLED=true
NEW_RELIC_APPLICATION_LOGGING_METRICS_ENABLED=true
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=false
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=10000
NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=false
NEW_RELIC_ALLOW_ALL_HEADERS=true
NEW_RELIC_ATTRIBUTES_ENABLED=true
NEW_RELIC_ATTRIBUTES_INCLUDE=request.headers.*,foo.bar
NEW_RELIC_ATTRIBUTES_EXCLUDE=request.headers.cookie,request.headers.authorization
NEW_RELIC_UTILIZATION_DETECT_AWS=<var>true|false</var>
NEW_RELIC_UTILIZATION_DETECT_AZURE=<var>true|false</var>
NEW_RELIC_UTILIZATION_DETECT_GCP=<var>true|false</var>
NEW_RELIC_UTILIZATION_DETECT_PCF=<var>true|false</var>
NEW_RELIC_UTILIZATION_DETECT_DOCKER=<var>true|false</var>
NEW_RELIC_UTILIZATION_DETECT_KUBERNETES=<var>true|false</var>
NEW_RELIC_FORCE_NEW_TRANSACTION_ON_NEW_THREAD=<var>true|false</var>
NEW_RELIC_CODE_LEVEL_METRICS_ENABLED=<var>true|false</var>
NEW_RELIC_SEND_DATA_ON_EXIT=<var>true|false</var>
NEW_RELIC_SEND_DATA_ON_EXIT_THRESHOLD_MS=<var>2000</var>
NEW_RELIC_HIGH_SECURITY=<var>true|false</var>
```

<CollapserGroup>
  <Collapser
    id="net-framework-32on64-env-variables"
    title="64 ビット システム上で 32 ビット アプリケーションをサポートします。"
  >
    New Relic の .NET エージェント用の 64 ビット MSI インストーラーは、64 ビット アセンブリとともに 32 ビット プロファイラー アセンブリを自動的にインストールし、v10.16.0 以降、IIS の 32 ビット サポートが自動的に有効になります。IIS 以外でホストされるアプリケーションの場合は、必要な環境変数を手動で設定できます。

    ```ini
    COR_PROFILER_PATH_32="C:\Program Files (x86)\New Relic\.NET Agent\NewRelic.Profiler.dll"
    ```
  </Collapser>
</CollapserGroup>

New Relic CodeStreamを使用してIDEのパフォーマンスを監視している場合は[、リポジトリをサービス](/docs/codestream/how-use-codestream/performance-monitoring#repo-association)に[関連付け、ビルドSHAまたはリリースタグをエラー](/docs/codestream/how-use-codestream/performance-monitoring#buildsha)に関連付けることもできます。

## 受信トレイ構成のエラー [#errors-inbox-configuration]

次のタグのいずれかを設定すると、エラーが発生しているソフトウェアのバージョンを特定するのに役立ちます。

* `NEW_RELIC_METADATA_SERVICE_VERSION` デプロイされているコードのバージョン (多くの場合、1.2.3 などのセマンティック バージョン) を含むイベント データに tags.service.version が作成されますが、常にそうとは限りません。
* `NEW_RELIC_METADATA_RELEASE_TAG `リリースタグを含むイベントデータに tags.releaseTag を作成します (v0.1.209 など)またはリリース-209)。
* `NEW_RELIC_METADATA_COMMIT` コミット SHA を含むイベント データに対して tags.commit を作成します。sha 全体を使用することも、最初の 7 文字だけを使用することもできます (例: 734713b)。

エラー受信箱の今後のリリースでは、ソフトウェアのどのバージョンでエラーが発生しているかを自動的に追跡します。バージョン データも[CodeStream](/docs/codestream/how-use-codestream/performance-monitoring/#buildsha)に表示されます。

## セットアップオプション、newrelic.config [#setup]

これらのオプションを使用して、newrelic.configファイルを介してエージェントをセットアップおよび構成します。 .NETエージェントは、次のカテゴリのセットアップオプションをサポートします。

* [構成要素](#configuration)
* [サービス要素](#service)
* [重要な要素の隠蔽](#obscuring-key)
* [プロキシ要素](#proxy)
* [ログエレメント](#log)
* [アプリケーション要素（構成）](#application-configuration)
* [データ伝送素子](#data-transmission)
* [ホスト名](#host-name)

### 構成要素 [#configuration]

構成ドキュメントのルート要素は`configuration`要素です。

```xml
<configuration xmlns="urn:newrelic-config"
  agentEnabled="true"
  maxStackTraceLines="50">
```

`configuration`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="config-agentEnabled"
    title="agentEnabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    New Relic エージェントを有効または無効にします。
  </Collapser>

  <Collapser
    id="config-maxStackTraceLines"
    title="maxStackTraceLines"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `80`
          </td>
        </tr>
      </tbody>
    </table>

    任意のスタックダンプでトレースするスタックフレームの最大数です。
  </Collapser>
</CollapserGroup>

### サービス要素 [#service]

`configuration`要素の最初の子は`service`要素です。 service要素は、NewRelicサービスへのエージェントの接続を構成します。

```xml
<service licenseKey="<var>YOUR_LICENSE_KEY</var>"
  sendEnvironmentInfo="true"
  syncStartup="false"
  sendDataOnExit="false"
  sendDataOnExitThreshold="60000"
  autoStart="true"/>
```

`service`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="service-licenseKey"
    title={<>licenseKey <strong>（必須）</strong></>}
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    あなたの New Relic [ライセンスキー](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key) 。New Relic はライセンスキーを使用して、アプリのデータを UI で正しいアカウントに照合します。環境変数でライセンスキーを設定します。

    あるいは、アプリケーションの環境で`NEW_RELIC_LICENSE_KEY`環境変数を設定します。

    ```ini
    NEW_RELIC_LICENSE_KEY=<var>XXXXXXXX</var>
    ```
  </Collapser>

  <Collapser
    id="service-sendEnvironmentInfo"
    title="sendEnvironmentInfo"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    実行環境情報を記録するようにエージェントに指示します。環境情報には、オペレーティングシステム、エージェントのバージョン、どのアセンブリが利用可能かなどが含まれます。
  </Collapser>

  <Collapser
    id="service-syncStartup"
    title="syncStartup"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがNewRelicに接続するまで、アプリケーションの起動をブロックします。 `true`に設定すると、New Relicへの接続が完了するまでブロックされるため、最初のトランザクションの完了にかなり時間がかかる場合があります。
  </Collapser>

  <Collapser
    id="service-sendDataOnExit"
    title="sendDataOnExit"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが最後の収穫サイクルを開始し、すべてのデータをNew Relicに送信する間、アプリケーションのシャットダウンをブロックします。

    あるいは、アプリケーションの環境で`NEW_RELIC_SEND_DATA_ON_EXIT`環境変数を設定します。

    ```ini
    NEW_RELIC_SEND_DATA_ON_EXIT=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="service-sendDataOnExitThreshold"
    title="sendDataOnExitThreshold"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `60000`
          </td>
        </tr>

        <tr>
          <th>
            ユニット
          </th>

          <td>
            ミリ秒
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがプロセスのシャットダウンをブロックする前にプロセスを実行する必要がある最小時間。この設定は、 [`sendDataOnExit`](#service-sendDataOnExit)が`true`の場合にのみ適用されます。

    あるいは、アプリケーションの環境で`NEW_RELIC_SEND_DATA_ON_EXIT_THRESHOLD_MS`環境変数を設定します。

    ```ini
    NEW_RELIC_SEND_DATA_ON_EXIT_THRESHOLD_MS=<var>2000</var>
    ```
  </Collapser>

  <Collapser
    id="service-completeTransactionsOnThread"
    title="completeTransactionsOnThread"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    falseの場合、エージェントはプールのスレッドを使用してトランザクション処理を完了します。

    trueの場合、エージェントはリクエストスレッドでトランザクション処理を完了します。
  </Collapser>

  <Collapser
    id="service-forceNewTransactionOnNewThread"
    title="forceNewTransactionOnNewThread"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    falseの場合、非同期/スレッド化されたシナリオでカスタムインスツルメントされたメソッドが検出されると、エージェントは既存のトランザクションを再利用しようとします。

    trueの場合、エージェントは、非同期/スレッド化されたシナリオでカスタムインスツルメントされたメソッドが検出されたときに新しいトランザクションを作成しようとします。

    または、 `NEW_RELIC_FORCE_NEW_TRANSACTION_ON_NEW_THREAD`環境変数を使用してこの動作を制御することもできます。

    ```ini
    NEW_RELIC_FORCE_NEW_TRANSACTION_ON_NEW_THREAD=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="service-requestTimeout"
    title="リクエストタイムアウト"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `2000` （ [`sendDataOnExit`](#service-sendDataOnExit)有効）

            `120000` （ [`sendDataOnExit`](#service-sendDataOnExit)無効）
          </td>
        </tr>

        <tr>
          <th>
            ユニット
          </th>

          <td>
            ミリ秒
          </td>
        </tr>
      </tbody>
    </table>

    New Relic と通信する際のエージェントのリクエストタイムアウト。
  </Collapser>

  <Collapser
    id="service-autoStart"
    title="オートスタート"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    インスツルメンテーションされた最初のメソッドがヒットしたときに、自動的に.NETエージェントを起動します。
  </Collapser>

  <Collapser
    id="service-host"
    title="ホスト"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    値`gov-collector.newrelic.com`を使用して、エージェントが使用する[FedRAMP 準拠のエンドポイント](/docs/security/security-privacy/compliance/fedramp-compliant-endpoints/)を構成する機能を提供します。

    ```xml
    <service licenseKey="YOUR_LICENSE_KEY"
      host="gov-collector.newrelic.com" />
    ```

    環境変数`NEW_RELIC_HOST`も使用できます。

    ```ini
    NEW_RELIC_HOST=gov-collector.newrelic.com
    ```
  </Collapser>
</CollapserGroup>

### 重要な要素の隠蔽 [#obscuring-key]

`obscuringKey`要素は`service`要素のオプションの子です。 .NET Agentはこの値を使用して、サポートされている構成値の難読化を解除します。たとえば、[難読化されたプロキシパスワード](#proxy-password)が指定された場合、このキーを使用して難読化が解除されます。

```xml
<service licenseKey="<var>YOUR_LICENSE_KEY</var>">
  <obscuringKey><var>OBSCURING_KEY</var></obscuringKey>
</service>
```

隠蔽キーは、 `NEW_RELIC_CONFIG_OBSCURING_KEY`環境変数を設定することによって構成することもできます。

<Callout variant="caution">
  セキュリティの推奨事項：難読化された値と同じ構成ファイルに不明瞭なキーを配置すると、セキュリティ上のリスクが生じる可能性があります。難読化されたキーと[難読化されたプロキシパスワード](#proxy-password)を環境変数に配置し、環境内の環境変数へのアクセスを制限することを検討してください。
</Callout>

### プロキシ要素 [#proxy]

`proxy` 要素は、 `service` 要素のオプションの子です。 `proxy` 要素は、エージェントがプロキシ経由で New Relic バックエンド サービスと通信するときに使用されます。

```xml
<service licenseKey="<var>YOUR_LICENSE_KEY</var>">
  <proxy
    host="<var>hostname</var>"
    port="<var>PROXY_PORT</var>"
    uriPath="<var>path/to/something.aspx</var>"
    domain="<var>mydomain.com</var>"
    user="<var>PROXY_USERNAME</var>"
    password="<var>PROXY_PASSWORD</var>"
    passwordObfuscated="<var>OBFUSCATED_PROXY_PASSWORD</var>"/>
</service>
```

`proxy`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="proxy-host"
    title="ホスト"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    プロキシホストを定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_HOST`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-port"
    title="port"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `8080`
          </td>
        </tr>
      </tbody>
    </table>

    プロキシポートを定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_PORT`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-uripath"
    title="uriPath"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    必要に応じて、プロキシURIのパスを定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_URI_PATH`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-domain"
    title="ドメイン"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    必要に応じて、プロキシサーバーでの認証に使用するドメインを定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_DOMAIN`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-user"
    title="ユーザー"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    必要に応じて、認証用のユーザー名を定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_USER`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-password"
    title="password"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    必要に応じて、認証用のパスワードを定義します。

    または、アプリケーションの環境で`NEW_RELIC_PROXY_PASS`環境変数を設定します。
  </Collapser>

  <Collapser
    id="proxy-password"
    title="パスワード難読化"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    さらにセキュリティを高めるために、.NET エージェントは passwordObfuscated 属性を持つ難読化されたプロキシパスワードの使用をサポートしています。難読化されたプロキシパスワードは、以下の [New Relic CLI](https://github.com/newrelic/newrelic-cli) コマンドを使用して生成されます。

    ```bash
    newrelic agent config obfuscate --key OBSCURING_KEY --value "PLAIN_TEXT_PROXY_PASSWORD"
    ```

    または、アプリケーションの環境で`NEW_RELIC_PROXY_PASS_OBFUSCATED`環境変数を設定します。

    <Callout variant="important">
      難読化されたプロキシのパスワードを使用する場合は、 [難読化キー](#obscuring-key) も設定する必要があります。
    </Callout>
  </Collapser>
</CollapserGroup>

### ログエレメント [#log]

`log`要素は`configuration`要素の子です。 `log`要素はNewRelicのロギングを設定します。エージェントは独自のログファイルを生成して、そのログ情報をアプリケーションのログとは別に保持します。

```xml
<log enabled="true"
  level="info"
  auditLog="false"
  console="false"
  directory="<var>PATH\TO\LOG\DIRECTORY</var>"
  fileName="<var>FILENAME.log</var>" />
```

`log`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="log-level"
    title="level"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `info`
          </td>
        </tr>
      </tbody>
    </table>

    ログファイルに記録される詳細レベルを定義します。設定可能な値は、詳細度の高い順に以下のとおりです。

    * `off`

    * `error`

    * `warn`

    * `info`

    * `debug`

    * `finest`

    * `all`

      または、アプリケーションの環境で`NEWRELIC_LOG_LEVEL`環境変数を設定します。

      <Callout variant="important">
        ログレベルを上げると、New Relic のパフォーマンスへの影響が大きくなります。
      </Callout>
  </Collapser>

  <Collapser
    id="log-auditLog"
    title="監査ログ"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    New Relicとの間で送受信されたすべてのデータを、auditlogログファイルと標準ログファイルの両方に記録します。
  </Collapser>

  <Collapser
    id="log-console"
    title="コンソール"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    ログ ファイルに加えて、ログ メッセージをコンソールに送信します。あるいは、アプリケーションの環境で`NEWRELIC_LOG_CONSOLE`環境変数を設定します。
  </Collapser>

  <Collapser
    id="log-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    無効にすると、ログは記録されません。読み取り専用ファイル システムを対象としています。あるいは、アプリケーションの環境で`NEWRELIC_LOG_ENABLED`環境変数を設定します。
  </Collapser>

  <Collapser
    id="log-directory"
    title="ディレクトリ"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `C:\ProgramData\New Relic\.NET Agent\Logs`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントによって生成されたログファイルを保持するディレクトリ。 これを省略した場合、New Relic エージェントのインストール領域にある<DoNotTranslate>**logs**</DoNotTranslate>という名前のディレクトリがデフォルトで使用されます。

    または、アプリケーションの環境で`NEWRELIC_LOG_DIRECTORY`環境変数を設定します。
  </Collapser>

  <Collapser
    id="log-fileName"
    title="ファイル名"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    ログファイルの名前を定義します。 `fileName`を定義しない場合、名前は監視対象プロセスの名前に由来します。

    あるいは、アプリケーションの環境で`NEW_RELIC_LOG`環境変数を設定します。

    ```ini
    NEW_RELIC_LOG=MyApp.log
    ```
  </Collapser>

  <Collapser
    id="log-logRollingStrategy"
    title="logRollingStrategy"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            サイズ
          </td>
        </tr>
      </tbody>
    </table>

    エージェントのログファイルのローリング戦略を定義します。 可能な値は次のとおりです。

    * `size` (デフォルト): ログファイルは、 `maxLogFileSizeMB`で指定されたサイズに達するとロールオーバーします。

    * `day`: ログファイルは午前 0 時にロールオーバーします。

      あるいは、アプリケーションの環境で`NEW_RELIC_LOG_ROLLING_STRATEGY`環境変数を設定します。

      ```ini
      NEW_RELIC_LOG_ROLLING_STRATEGY=day
      ```

      .NET エージェント v10.21.0 以降でサポートされます。
  </Collapser>

  <Collapser
    id="log-logMaxFiles"
    title="logMaxFiles"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            4
          </td>
        </tr>
      </tbody>
    </table>

    保持するエージェント ログ ファイルの数を定義します。 ログファイルの最大数に達すると、最も古いログファイルが削除されます。 値`0`は、ログ ファイルの最大数がないことを指定します。

    あるいは、アプリケーションの環境で`NEW_RELIC_LOG_MAX_FILES`環境変数を設定します。

    ```ini
    NEW_RELIC_LOG_MAX_FILES=31
    ```

    .NET エージェント v10.21.0 以降でサポートされます。
  </Collapser>

  <Collapser
    id="log-maxLogFileSizeMB"
    title="maxLogFileSizeMB"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            50
          </td>
        </tr>
      </tbody>
    </table>

    ロールオーバーする前のエージェント ログ ファイルの最大サイズをメガバイト単位で定義します。 `logRollingStrategy` `size`に設定されている場合にのみ有効です。 値`0`は、ログファイルの最大サイズがないことを指定します。

    あるいは、アプリケーションの環境で`NEW_RELIC_LOG_MAX_FILE_SIZE_MB`環境変数を設定します。

    ```ini
    NEW_RELIC_LOG_MAX_FILE_SIZE_MB=100
    ```

    .NET エージェント v10.21.0 以降でサポートされます。
  </Collapser>
</CollapserGroup>

### 応募要素（必須） [#application-configuration]

`application`要素は`configuration`要素の子です。この必須要素は、アプリケーション名を定義し、サンプリングを無効または有効にします。

<CollapserGroup>
  <Collapser
    id="app-name"
    title="name"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `My Application`
          </td>
        </tr>
      </tbody>
    </table>

    [.NETアプリケーションの名前は](/docs/agents/net-agent/installation-and-configuration/naming-your-net-application)、 `application`要素の子です。 New Relicは、この名前に従ってデータを集約します。たとえば、 `AppA`と`AppB`という名前の2つの実行中のアプリケーションがある場合、NewRelicインターフェースに`AppA`と`AppB`の2つのアプリケーションが表示されます。

    アプリに [最大 3 つの名前を割り当てる](/docs/agents/manage-apm-agents/app-naming/use-multiple-names-app) こともできます。名がプライマリ名です。例えば：

    ```xml
    <application>
      <name><var>MY APPLICATION PRIMARY</var></name>
      <name><var>SECOND APP NAME</var></name>
      <name><var>THIRD APP NAME</var></name>
    </application>
    ```

    あるいは、アプリケーションの環境で`NEW_RELIC_APP_NAME`環境変数を設定します。

    ```ini
    NEW_RELIC_APP_NAME=Descriptive Name
    ```
  </Collapser>

  <Collapser
    id="app-disableSamplers"
    title="disableSamplers"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    サンプラーは、メモリとCPU消費に関する情報を収集します。サンプリングを無効にするには、これを`true`に設定します。

    あるいは、アプリケーションの環境で`NEW_RELIC_DISABLE_SAMPLERS`環境変数を設定します。

    ```ini
    NEW_RELIC_DISABLE_SAMPLERS=true
    ```
  </Collapser>
</CollapserGroup>

### データ伝送素子 [#data-transmission]

`dataTransmission`要素は`configuration`要素の子です。この要素は、データがNew Relicに送信される方法に影響し、特定のデータ送信要件がある場合に使用できます。

```xml
<dataTransmission
  putForDataSend="false"
  compressedContentEncoding="deflate"/>
```

`dataTransmission`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="data-transmission-putfordatasend"
    title="putForDataSend"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    NewRelicにデータを送信するときに使用されるHTTPメソッドを定義します。これを`true`に設定すると、データの送信時に`PUT`メソッドを使用できるようになります。デフォルトでは`POST`メソッドが使用されます。
  </Collapser>
</CollapserGroup>

### ホスト名

APM UI のデフォルトのホスト名ラベルが役に立たない場合は、New Relic UI でその名前を表示名で修飾できます。 アプリケーション プロセスが再起動され、.NET エージェントが再度レポートを行うと、表示名が<DoNotTranslate>**Servers**</DoNotTranslate>ドロップダウン リストに表示されます。 このホスト名の設定は[、アプリケーションの<DoNotTranslate>**Summary**</DoNotTranslate>ページ](/docs/apm/applications-menu/monitoring/apm-overview-page-view-transaction-apdex-usage-data)のホストのリストには影響しません。

表示名を設定するには、次のいずれかのオプションを選択します。環境変数は、コンフィグファイルの値よりも優先されます。その後、アプリケーションを再起動すると、New Relic UI に変更内容が表示されます。

<CollapserGroup>
  <Collapser
    id="host-name-config"
    title="コンフィグファイルによる設定"
  >
    `newrelic.config`の`processHost`要素に`displayName`属性を設定します。 `processHost`要素は`configuration`要素の子です。

    ```xml
    <configuration . . . >
      <processHost displayName="<var>CUSTOM_NAME</var>" />
    </configuration>
    ```
  </Collapser>

  <Collapser
    id="host-name-env_variable"
    title="環境変数による設定"
  >
    `NEW_RELIC_PROCESS_HOST_DISPLAY_NAME`環境変数を設定します。

    ```ini
    NEW_RELIC_PROCESS_HOST_DISPLAY_NAME="<var>CUSTOM_NAME</var>"
    ```
  </Collapser>
</CollapserGroup>

## クラウドプラットフォームの利用 [#cloud-platform-util]

`utilization`構成要素は、エージェントが使用率情報を収集し、それをNewRelicサービスに送信して価格を決定する方法を制御します。エージェントは、Amazon Web Services（AWS）EC2インスタンス、Dockerコンテナー、Microsoft Azure、Google Cloud Platform、Pivotal Cloud Foundry、Kubernetesから情報を収集できます。

```xml
<configuration . . . >
  <utilization detectAws="true" detectAzure="true" detectGcp="true" detectPcf="true" detectDocker="true" detectKubernetes="true" />
</configuration>
```

`utilization`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="detectAws"
    title="detectAws"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがAWSメタデータAPIをポーリングするかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_AWS`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_AWS=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="detectAzure"
    title="detectAzure"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがMicrosoftAzureメタデータAPIをポーリングするかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_AZURE`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_AZURE=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="detectGcp"
    title="検出GCP"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが GCP メタデータ API をポーリングするかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_GCP`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_GCP=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="detectPcf"
    title="detectPcf"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが環境変数からPCF情報をポーリングするかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_PCF`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_PCF=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="detectDocker"
    title="ドッカーの検出"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがDocker情報をファイルシステムから読み取るかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_DOCKER`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_DOCKER=<var>true|false</var>
    ```
  </Collapser>

  <Collapser
    id="detectKubernetes"
    title="Kubernetesの検出"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが環境変数からKubernetesの情報をポーリングするかどうかを決定します。

    または、この動作は`NEW_RELIC_UTILIZATION_DETECT_KUBERNETES`環境変数を介して制御できます。

    ```ini
    NEW_RELIC_UTILIZATION_DETECT_KUBERNETES=<var>true|false</var>
    ```
  </Collapser>
</CollapserGroup>

## インストゥルメンテーションのオプション [#instrumentation]

これらのオプションを使用して、アプリケーションや環境のどの要素をインスツルメンテーションするかを設定します。New Relic for .NET は、以下のカテゴリの計測オプションをサポートしています。

* [計装要素](#instrumentation-element)
* [ルール要素](#instrumentation-rules)
* [アプリケーションエレメント（計測器）](#application-instrumentation)
* [属性要素](#agent-attributes)

### 計装要素

`instrumentation`要素は`configuration`要素の子です。既定では、.NETエージェントはIISaspワーカープロセスとMicrosoftAzureWebおよびワーカーの役割を計測します。他のプロセスをインストルメント化するには、[カスタムアプリケーションのインストルメンテーション](/docs/agents/net-agent/features/instrumenting-custom-applications)を参照してください。

### ルール要素 (インストゥルメンテーション) [#instrumentation-rules]

<Callout variant="important">
  この機能は、.NETエージェント 10.21.0 以降で利用できます。
</Callout>

`rules`要素は`instrumentation`要素の子です。 `rules`要素は、任意の数の`ignore`子要素をサポートします。これにより、指定されたアセンブリで定義されたメソッドを計測しないようにプロファイラーに指示されます。 他のアセンブリで定義されたメソッドは引き続きインストゥルメント化されます。

```xml
<instrumentation>
  <rules>
    <ignore assemblyName="NameOfAssemblyToIgnore" />
  </rules>
</instrumentation>
```

無視ルールを使用すると、オプションでクラス名を定義できます。 次の例では、アセンブリ MyAssembly の MyNamespace.MyClass で定義されたメソッドのみが無視されます。 そのアセンブリ内および他のアセンブリ内の他のクラスの他のメソッドは、プロファイラーによって無視されません。

```xml
<instrumentation>
  <rules>
    <ignore assemblyName="MyAssembly" className="MyNamespace.MyClass" />
  </rules>
</instrumentation>
```

複数の無視ルールを指定できます。 次の例では、Confluent Kafka と StackExchange Redisインストゥルメンテーションの両方を無効にします。

```xml
<instrumentation>
  <rules>
    <ignore assemblyName="Confluent.Kafka" />
    <ignore assemblyName="StackExchange.Redis" />
  </rules>
</instrumentation>
```

カスタムインストゥルメンテーションは、 `rules`要素を介して無視できないことに注意してください。

### アプリケーションエレメント（計測器） [#application-instrumentation]

`applications`要素は`instrumentation`要素の子です。 `applications`要素は、インストルメントする非Webアプリを指定する`application`子要素をサポートします。 `application`要素には`name`属性が含まれています。

<Callout variant="important">
  これは[、 `configuration`要素の子である](#application)[`application` （構成）](#application-configuration)要素と同じではありません。
</Callout>

```xml
<instrumentation>
  <applications>
    <application name="<var>MyService1.exe</var>" />
    <application name="<var>MyService2.exe</var>" />
    <application name="<var>MyService3.exe</var>" />
  </applications>
</instrumentation>
```

### 属性要素 [#agent-attributes]

属性は、イベントまたはトランザクションのプロパティを決定するキーと値のペアです。各属性は、APM トランザクション追跡、APM エラー追跡、Transaction イベント、TransactionError イベント、または PageView イベントに送信されます。主要な`attributes`要素は、.NET エージェントの属性収集を有効または無効にし、収集または除外する特定の属性を定義します。送信先に基づいて属性設定を構成することもできます: [エラー コレクション](#error-attributes)、 [トランザクション追跡](#tracer-attributes)、 [ブラウザー インストルメンテーション](#browser-attributes)、および [トランザクション イベント](#transaction-attributes)。

この例では、エージェントはキーが<DoNotTranslate>**myApiKey**</DoNotTranslate>で始まるすべてのプロパティ ( <DoNotTranslate>**myApiKey.bar**</DoNotTranslate> 、 <DoNotTranslate>**myApiKey.value**</DoNotTranslate> ) を除外しますが、カスタム アトリビュート<DoNotTranslate>**myApiKey.foo**</DoNotTranslate>を収集します。

```xml
<attributes enabled="true">
  <exclude><var>myApiKey.*</var></exclude>
  <include><var>myApiKey.foo</var></include>
</attributes>
```

.NET APM属性は、 [.NETエージェント属性](/docs/agents/net-agent/attributes/net-agent-attributes)ページで表示できます。エージェントAPI呼び出し[`AddCustomAttribute`](/docs/agents/net-agent/net-agent-api/itransaction/#addcustomattribute)を使用してカスタム属性を定義することもできます。

<CollapserGroup>
  <Collapser
    id="agent-attributes-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    属性収集を有効または無効にします。プライマリ属性要素で`false`に設定すると、この設定は個々の宛先のすべての属性設定を上書きします。

    または、アプリケーションの環境で`NEW_RELIC_ATTRIBUTES_ENABLED`環境変数を設定します。
  </Collapser>

  <Collapser
    id="agent-attributes-include"
    title="include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    属性が有効になっている場合、エージェントはこのリストで指定されているすべての属性キーを収集します。複数の属性キーを指定するには、それぞれを個別に指定します。キーの最後に`*`ワイルドカード文字を使用して、複数の属性（たとえば、 `myApiKey.*` ）に一致させることもできます。詳細については、[属性ルール](/docs/agents/net-agent/attributes/enabling-disabling-attributes#attruls)を参照してください。

    または、アプリケーションの環境で`NEW_RELIC_ATTRIBUTES_INCLUDE`環境変数を設定します。この環境変数は、属性名のコンマ区切りリストを受け入れます。

    <Callout variant="caution">
      `NEW_RELIC_ATTRIBUTES_INCLUDE`環境変数を使用すると、newrelic.configのデフォルトのインクルードセットが上書きされます。デフォルトの包含と除外の詳細なリストについては、[ここ](#allow-all-headers-enabled)を参照してください。
    </Callout>
  </Collapser>

  <Collapser
    id="agent-attributes-exclude"
    title="exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    属性が有効になっている場合、エージェントはこのリストで指定された属性キーを収集しません。複数の属性キーを指定するには、それぞれを個別に指定します。キーの最後に`*`ワイルドカード文字を使用して、複数の属性（たとえば、 `myApiKey.*` ）に一致させることもできます。詳細については、[属性ルール](/docs/agents/net-agent/attributes/enabling-disabling-attributes#attruls)を参照してください。

    または、アプリケーションの環境で`NEW_RELIC_ATTRIBUTES_EXCLUDE`環境変数を設定します。この環境変数は、属性名のコンマ区切りリストを受け入れます。

    <Callout variant="caution">
      `NEW_RELIC_ATTRIBUTES_EXCLUDE`環境変数を使用すると、newrelic.configのデフォルトのexcludeセットが上書きされます。デフォルトの包含と除外の詳細なリストについては、[ここ](#allow-all-headers-enabled)を参照してください。
    </Callout>
  </Collapser>
</CollapserGroup>

## 機能オプション [#features]

これらのオプションを使用して、New Relic の機能を有効、無効、および設定します。New Relic for .NET では、以下の機能を設定することができます。

* [アプリ・プール](#include_exclude_apps)
* [エラー収集](#error_collector)
* [ハイセキュリティモード](#high_security_mode)
* [例外メッセージの除去](#strip_exception_messages)
* [Transactionイベント](#transaction_events)
* [カスタムイベント](#custom_events)
* [カスタムパラメータ](#custom_parameters)
* [タグ/ラベル](#labels-tags)
* [ブラウザのインストゥルメンテーション](#browser_monitoring)
* [スロークエリ](#slow_sql)
* [トランザクショントレース](#transaction_tracer)
* [データストアトレーサー](#datastore_tracer)
* [ディストリビューティッド（分散）トレーシング](#distributed_tracing)
* [無限のトレース](#infinite_tracing)
* [クロスアプリケーショントレース](#cross_application_tracer)
* [スパンイベント](#span-events)
* [HTTPリクエストヘッダの取得](#capture_http_request_headers)
* [アプリケーションログ](#application_logging)
* [コードレベルの指標](#code_level_metrics)
* [AIモニタリング](#ai_monitoring)

### アプリ・プール [#include_exclude_apps]

<Callout variant="important">
  これは、システムの [グローバルコンフィグファイル](#config-options-precedence) にのみ適用されます。
</Callout>

<Callout variant="important">
  この設定は、IIS ホスティング モデルがインプロセスに設定されている場合にのみ適用されます。
</Callout>

`applicationPools`要素は`configuration`要素の子です。 `applicationPools`要素は、プロファイラーに対して、インストルメントするアプリケーションプールを正確に指定し、IISアプリケーションプール名と同じ名前を使用します。この構成要素は、アプリプールのごく一部のみをインストルメント化する必要がある場合に役立ちます。たとえば、特定のサーバーに数百のアプリケーションプールがある場合でも、.NETエージェントがインストルメント化する必要があるのはそれらのプールのほんの一部です。

ここでは、特定のアプリケーションプールに対するインスツルメンテーションを無効にする例を示します。

```xml
<applicationPools>
  <applicationPool name="<var>Foo</var>" instrument="false"/>
  <applicationPool name="<var>Bar</var>" instrument="false"/>
</applicationPools>
```

ここでは、現在サーバー上で実行されているすべてのアプリケーションプールのインスツルメンテーションを無効にし、特定のアプリケーションプールのインスツルメンテーションを有効にする例を示します。

```xml
<applicationPools>
  <defaultBehavior instrument="false"/>
  <applicationPool name="<var>Foo</var>" instrument="true"/>
  <applicationPool name="<var>Bar</var>" instrument="true"/>
</applicationPools>
```

`applicationPools`要素は次の要素をサポートします。

<CollapserGroup>
  <Collapser
    id="appPool-defaultBehavior"
    title="defaultBehavior"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    IISを介して提供されるアプリケーションプールの「グローバル」レベルで.NETエージェントがどのように動作するかを定義します。 .NETエージェントは、デフォルトですべてのアプリケーションプールを計測します。 `true`の場合、 `instrument`属性がfalseに設定された[applicationPool](#appPool-applicationPool)の下にリストされているアプリケーションプールはインストルメントされません。

    基本的に、 `false`に設定すると、アプリケーションプールリストは許可リストとして機能します。 `true`に設定すると、アプリケーションプールリストは拒否リストとして機能します。
  </Collapser>

  <Collapser
    id="appPool-applicationPool"
    title="アプリケーションプール"
  >
    特定のアプリケーションプールのインストルメンテーション動作を定義します。 `name`属性は、アプリケーションプールの名前です。 `instrument`属性でプロファイリングを有効または無効にします。このアプリケーションを`name`属性で定義します。
  </Collapser>
</CollapserGroup>

### エラー収集 [#error_collector]

`errorCollector`要素は`configuration`要素の子です。 `errorCollector`は、キャッチされなかった例外に関する情報をキャプチャしてNewRelicに送信するエラー収集を構成します。

```xml
<errorCollector enabled="true" captureEvents="true" maxEventSamplesStored="100">
  <ignoreClasses>
    <errorClass><var>System.IO.FileNotFoundException</var></errorClass>
    <errorClass><var>System.Threading.ThreadAbortException</var></errorClass>
  </ignoreClasses>
  <ignoreMessages>
    <errorClass name="<var>System.Exception</var>">
       <message><var>Ignore message</var></message>
       <message><var>Ignore too</var></message>
    </errorClass>
  </ignoreMessages>
  <ignoreStatusCodes>
    <code><var>401</var></code>
    <code><var>404</var></code>
  </ignoreStatusCodes>
  <expectedClasses>
    <errorClass><var>System.ArgumentNullException</var></errorClass>
    <errorClass><var>System.ArgumentOutOfRangeException</var></errorClass>
  </expectedClasses>
  <expectedMessages>
    <errorClass name="<var>System.Exception</var>">
       <message><var>Expected message</var></message>
       <message><var>Expected too</var></message>
    </errorClass>
  </expectedMessages>
  <expectedStatusCodes>403,500-505</expectedStatusCodes>
  <attributes enabled="true">
    <exclude><var>myApiKey.*</var></exclude>
    <include><var>myApiKey.foo</var></include>
  </attributes>
</errorCollector>
```

<Callout variant="tip">
  APMでのエラー構成の概要については、「APMでのエラーの [管理](/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-mark-expected)」を参照してください。
</Callout>

<Callout variant="important">
  `expectedClasses`、 `expectedMessages` 、および`expectedStatusCodes`の構成設定には、 [.NETエージェントバージョン8.31.0.0以降が必要です](/docs/agents/net-agent/installation/update-net-agent)。
</Callout>

`errorCollector`要素は、次の要素と属性をサポートします。

<CollapserGroup>
  <Collapser
    id="error-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクターを有効または無効にします。
  </Collapser>

  <Collapser
    id="error-captureEvents"
    title="captureEvents"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    エラーイベントの取り込みを有効または無効にします。
  </Collapser>

  <Collapser
    id="error-maxEventSamplesStored"
    title="maxEventSamplesStored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `100`
          </td>
        </tr>
      </tbody>
    </table>

    エラー発生時のリザーバーリミット
  </Collapser>

  <Collapser
    id="error-ignoreClasses"
    title="ignoreClasses"
  >
    無視する完全修飾クラス名のリスト。 <DoNotTranslate>**SHOULD**</DoNotTranslate>が報告されるエラー クラスとメッセージの組み合わせの最大数は 50 です。 50 個を超えるものがリストされている場合は、最初の 50 個の<DoNotTranslate>**SHOULD**</DoNotTranslate>のみが使用されます
  </Collapser>

  <Collapser
    id="error-ignoreMessages"
    title="ignoreMessages"
  >
    エラーメッセージの部分文字列に一致する文字列のリストへの完全修飾クラス名のオプションのマップ。 <DoNotTranslate>**SHOULD**</DoNotTranslate>が報告されるエラー クラスとメッセージの組み合わせの最大数は 50 です。 50 個を超えるものがリストされている場合は、最初の 50 個の<DoNotTranslate>**SHOULD**</DoNotTranslate>のみが使用されます
  </Collapser>

  <Collapser
    id="error-ignoreErrors"
    title="ignoreErrors (廃止されました)"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    NewRelicに報告しない特定の例外を一覧表示します。 `System.IO.FileNotFoundException`などの例外のフルネームを使用する必要があります。
  </Collapser>

  <Collapser
    id="error-ignoreStatusCodes"
    title="ignoreStatusCodes"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    New Relic に報告しない特定の HTTP エラーコードを列挙します。401 だけのような標準的な積分 HTTP エラーコードを使用することもできますし、401.4 や 403.18 のような小数点を含む Microsoft の完全なステータスコードを使用することもできます。ステータスコードは400以上でなければなりません。

    <Callout variant="tip">
      エージェントの[`NoticeError()` API](/docs/agents/net-agent/net-agent-api/noticeerror-net-agent)で報告されたカスタムエラーは、関連付けられたトランザクションにHTTPステータスコードがここで構成されている場合でも、NewRelicに報告されます。
    </Callout>
  </Collapser>

  <Collapser
    id="error-expectedClasses"
    title="予想されるクラス"
  >
    期待どおりにマークされる完全修飾クラス名のリスト。 <DoNotTranslate>**SHOULD**</DoNotTranslate>が報告されるエラー クラスとメッセージの組み合わせの最大数は 50 です。 50 個を超えるものがリストされている場合は、最初の 50 個の<DoNotTranslate>**SHOULD**</DoNotTranslate>のみが使用されます
  </Collapser>

  <Collapser
    id="error-expectedMessages"
    title="期待されるメッセージ"
  >
    エラーメッセージの部分文字列に一致する文字列のリストへの完全修飾クラス名のオプションのマップ。 <DoNotTranslate>**SHOULD**</DoNotTranslate>が報告されるエラー クラスとメッセージの組み合わせの最大数は 50 です。 50 個を超えるものがリストされている場合は、最初の 50 個の<DoNotTranslate>**SHOULD**</DoNotTranslate>のみが使用されます
  </Collapser>

  <Collapser
    id="error-expectedStatusCodes"
    title="expectedStatusCodes"
  >
    ステータスコードのコンマ区切りのリストです。リストには整数の範囲を含めることができ、ダッシュ（-）を使用して、範囲内の開始と終了の両方の整数を含みます。
  </Collapser>

  <Collapser
    id="error-attributes"
    title="属性"
  >
    このサブ要素を使用して、エラートレースのエージェント属性設定をカスタマイズします。このサブ要素は、プライマリ`attributes`要素と同じ設定[`enabled`](#agent-attributes-enabled) 、 [`include`](#agent-attributes-include) 、および[`exclude`](#agent-attributes-exclude)を使用します。
  </Collapser>
</CollapserGroup>

### ハイセキュリティモード [#high_security_mode]

`highSecurity`要素は`configuration`要素の子です。[高セキュリティ モード](/docs/subscriptions/high-security)を有効にするには、このプロパティを`true`に設定し、New Relic ユーザー インターフェイスで高セキュリティ プロパティを有効にします。高度なセキュリティを有効にすると、SSL が有効になります。リクエストパラメータ、カスタムパラメータ、HTTPリクエストヘッダーは収集されません。例外メッセージの削除が有効になっています。また、クエリをそのままの形式で New Relic に送信することはできません。

<CollapserGroup>
  <Collapser
    id="highsecurity-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    高セキュリティ モードを有効または無効にします。例：

    ```xml
    <highSecurity enabled="true"/>
    ```

    あるいは、アプリケーションの環境で`NEW_RELIC_HIGH_SECURITY`環境変数を設定します。

    ```ini
    NEW_RELIC_HIGH_SECURITY=true
    ```
  </Collapser>
</CollapserGroup>

### 例外メッセージの除去 [#strip_exception_messages]

`stripExceptionMessages`要素は`configuration`要素の子です。例外メッセージの除去を有効にするには、このプロパティを`true`に設定します。デフォルトでは、これは false に設定されています。これは、エージェントがすべての例外からのメッセージを New Relic コレクターに送信することを意味します。高セキュリティ モードを有効にすると、これは自動的に true に変更され、エージェントは例外からメッセージを削除します。

<CollapserGroup>
  <Collapser
    id="stripExceptionMessages-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    ストリップの例外メッセージを有効または無効にします。例

    ```xml
    <stripExceptionMessages enabled="true"/>
    ```
  </Collapser>
</CollapserGroup>

### Transactionイベント [#transaction_events]

`transactionEvents`要素は`configuration`要素の子です。 `transactionEvents`を使用してトランザクションイベントを構成します。

```xml
<transactionEvents enabled="true" maximumSamplesStored="10000">
  <attributes enabled="true">
    <exclude><var>myApiKey.*</var></exclude>
    <include><var>myApiKey.foo</var></include>
  </attributes>
</transactionEvents>
```

`transactionEvents`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="transaction-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    イベントレコーダーの有効化、無効化を行います。
  </Collapser>

  <Collapser
    id="transaction-maximumSamplesStored"
    title="maximumSamplesStored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが一度にメモリに保存できる、サンプリングされたトランザクション イベントの最大数。これは、エージェントが 1 分間に送信できるトランザクション イベントの最大数になります。

    あるいは、アプリケーションの環境で`MAX_TRANSACTION_SAMPLES_STORED`環境変数を設定します。

    ```ini
    MAX_TRANSACTION_SAMPLES_STORED=500
    ```
  </Collapser>

  <Collapser
    id="transaction-attributes"
    title="属性"
  >
    このサブ要素を使用して、トランザクションイベントのエージェント属性設定をカスタマイズします。このサブ要素は、プライマリ`attributes`要素と同じ設定[`enabled`](#agent-attributes-enabled) 、 [`include`](#agent-attributes-include) 、および[`exclude`](#agent-attributes-exclude)を使用します。

    <Callout variant="tip">
      これらの属性設定は、 `transaction`イベントに固有です。属性設定は[、この構成設定](/docs/agents/net-agent/configuration/net-agent-configuration#agent-attributes)を使用して、すべてのイベントタイプにグローバルに適用できます。
    </Callout>

    <Callout variant="caution">
      分散トレーシングや無限トレーシングが有効な場合、トランザクションイベントからの情報は、そのトランザクションのルートのスパンイベントに適用されます。トランザクション・イベントの属性設定をスパン・イベントに適用したり、グローバル属性設定として適用することを検討してください。
    </Callout>
  </Collapser>
</CollapserGroup>

### カスタムイベント [#custom_events]

`customEvents`要素は`configuration`要素の子です。 `customEvents`を使用して[カスタムイベント](/docs/insights/new-relic-insights/adding-querying-data/inserting-custom-events-new-relic-apm-agents#net-att)を構成します。

```xml
<customEvents enabled="true" maximumSamplesStored="10000"/>
```

`customEvents`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="customevents-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    イベントレコーダーの有効化、無効化を行います。
  </Collapser>

  <Collapser
    id="customevents-maximumSamplesStored"
    title="maximumSamplesStored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが一度にメモリに保存できる、サンプリングされたカスタム イベントの最大数。これは、エージェントが 1 分間に送信できるカスタム イベントの最大数になります。

    * あるいは、アプリケーションの環境で`MAX_EVENT_SAMPLES_STORED`環境変数を設定します。

      ```ini
      MAX_EVENT_SAMPLES_STORED=500
      ```

    * [AI モニタリング](/docs/ai-monitoring/intro-to-ai-monitoring/)用にエージェントを構成する場合は、値を`100000`に設定することをお勧めします。
  </Collapser>
</CollapserGroup>

### カスタムパラメータ [#custom_parameters]

`customParameters`要素は`configuration`要素の子です。 `customParameters`を使用して[カスタムパラメータ](/docs/insights/insights-data-sources/custom-data/add-custom-attributes-apm-data)を設定します。

```xml
<customParameters enabled="true" />
```

`customParameters`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="customparameters-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    カスタムパラメーターの取り込みを有効または無効にします。
  </Collapser>
</CollapserGroup>

### ラベル（タグ）

`labels`要素は`configuration`要素の子です。

これにより、 [タグ](/docs/new-relic-one/use-new-relic-one/core-concepts/tagging-use-tags-organize-group-what-you-monitor)の名前と値が設定されます。このリストは、コロンで区切られた名前と値のペアのセミコロン区切りのリストです。 `NEW_RELIC_LABELS`環境変数と一緒に使用することもできます。例：

```xml
<labels><var>foo</var>:<var>bar</var>;<var>zip</var>:<var>zap</var></labels>
```

### ブラウザのインストゥルメンテーション [#browser_monitoring]

`browserMonitoring`要素は`configuration`要素の子です。 `browserMonitoring` .NET アプリケーションで<InlinePopover type="browser"/>を構成します。 browserエンドユーザーのパフォーマンス体験をインサイトに提供します。 これは、各ページのヘッダーとフッターに少量の JavaScript コードを挿入することにより、ユーザーのブラウザーが Web ページをダウンロードしてレンダリングするのにかかる時間を測定することで実現されます。

```xml
// If you use both the Exclude and Attribute elements
// the Exclude element must be listed first.
<browserMonitoring autoInstrument="true">
  <requestPathsExcluded>
    <path regex="url-regex-1"/>
    <path regex="url-regex-2"/>
    ...
    <path regex="url-regex-n"/>
  </requestPathsExcluded>
  <attributes enabled="true">
    <exclude><var>myApiKey.*</var></exclude>
    <include><var>myApiKey.foo</var></include>
  </attributes>
</browserMonitoring>
```

`browserMonitoring`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="browsermon-autoInstrument"
    title="オートインストゥルメント"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    デフォルトでは、エージェントはブラウザエージェントのJavaScriptを自動的に挿入します。自動インジェクションをオフにするには、この属性を`false`に設定します。

    <Callout variant="important">
      自動インストルメンテーションは .NET Framework アプリでのみ利用でき、.NET Core アプリでは [手動インストルメンテーションを](/docs/apm/agents/net-agent/other-features/browser-monitoring-net-agent/#manual_instrumentation)使用する必要があります。ASP.NET Core アプリケーションが .NET Framework によって監視されているか、Core エージェントによって監視されているかにかかわらず、自動インストルメンテーションは使用できません。
    </Callout>
  </Collapser>

  <Collapser
    id="browser-attributes"
    title="属性"
  >
    このサブ要素を使用して、[ブラウザ監視](/docs/browser/new-relic-browser/page-load-timing/instrumentation-page-load-timing)用のエージェント属性設定をカスタマイズします。このサブ要素は、プライマリ`attributes`要素と同じ設定[`enabled`](#agent-attributes-enabled) 、 [`include`](#agent-attributes-include) 、および[`exclude`](#agent-attributes-exclude)を使用します。
  </Collapser>

  <Collapser
    id="browser-path-exclusion"
    title="requestPathsExcluded"
  >
    特定のページにブラウザエージェントが注入されないようにするには、このサブエレメントを使用します。この要素の使い方は以下の通りです。

    ```xml
    <requestPathsExcluded>
      <path regex="url-regex-1"/>
      <path regex="url-regex-2"/>
      ...
      <path regex="url-regex-n"/>
    </requestPathsExcluded>
    ```

    このエージェントは、URL が指定された正規表現のいずれかに一致するページにブラウザエージェントを注入しません。正規表現は、 [Microsoft Guidelines for the Regex class](https://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex(v=vs.110).aspx) に従ってください。

    これは、アプリケーション内のパスの仮想ディレクトリへの参照であり、除外するパスの完全なURLではありません。たとえば、 `https://www.mywebsite.com/mywebpages/`のページを除外するには、パスの正規表現値として`/mywebpages/`を挿入するだけです。

    `requestPathsExcluded`要素は、 [`DisableBrowserMonitoring()`](/docs/agents/net-agent/net-agent-api/disablebrowsermonitoring-net-agent)呼び出しを使用することが不可能または望ましくない場合に使用する必要があります。パフォーマンスへの影響を最小限に抑えるには、使用する正規表現をできるだけ少なくし、できるだけ単純に保つようにしてください。
  </Collapser>
</CollapserGroup>

### 問い合わせの遅さ [#slow_sql]

`slowSql`要素は`configuration`要素の子です。 `slowSql`は、遅いクエリ実行に関する情報のキャプチャを構成し、これらのクエリの説明プランをキャプチャして難読化します。

```xml
<slowSql enabled="true"/>
```

`slowSql`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="catracer-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    スロークエリートレースを有効または無効にします。
  </Collapser>
</CollapserGroup>

### トランザクショントレース [#transaction_tracer]

`transactionTracer`要素は`configuration`要素の子です。 `transactionTracer`[はトランザクショントレースを](/docs/traces/transaction-traces)構成します。トレースには、発行されたクエリステートメントを含む、トランザクションの正確な呼び出しシーケンスが含まれます。

```xml
<transactionTracer enabled="true"
    transactionThreshold="apdex_f"
    recordSql="obfuscated"
    explainEnabled="true"
    explainThreshold="500"
    maxSegments="3000"
    maxExplainPlans="20">
  <attributes enabled="true">
    <exclude><var>myApiKey.*</var></exclude>
    <include><var>myApiKey.foo</var></include>
  </attributes>
 </transactionTracer>
```

`transactionTracer`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="tracer-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    [トランザクション トレースの有効化または無効化](/docs/apm/transactions/transaction-traces/transaction-traces).
  </Collapser>

  <Collapser
    id="tracer-transactionThreshold"
    title="トランザクションスレッショルド"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `apdex_f`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションをトレースするための閾値を定義します。トランザクションにかかる時間がしきい値より長ければ、トレースの対象となります。トレースに関するルールについては、 [transaction trace basics](/docs/apm/transactions/transaction-traces/transaction-traces#basics) を参照してください。

    デフォルト値は`apdex_f`で、これは、閾値をアプリケーションの<DoNotTranslate>**apdex_t**</DoNotTranslate>値の 4 倍に設定します。 <DoNotTranslate>**apdex_t**</DoNotTranslate>の詳細については、 [「Apdex」](/docs/site/apdex-measuring-user-satisfaction)を参照してください。

    また、しきい値をミリ秒単位の特定の時間値に設定することもできます。
  </Collapser>

  <Collapser
    id="tracer-recordSql"
    title="recordSql"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            弦
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `obfuscated`
          </td>
        </tr>
      </tbody>
    </table>

    クエリトレースポリシーを選択します。オプションは`off`で、何も記録されません。 `obfuscated` 、難読化されたバージョンのクエリを記録します。または`raw` 、データベースに発行されたとおりにクエリを記録します。

    <Callout variant="caution">
      生のクエリを記録することで、機密情報を取得できる可能性があります。
    </Callout>
  </Collapser>

  <Collapser
    id="tracer-explainEnabled"
    title="explainEnabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、エージェントは、期間が`explainThreshold`を超える低速クエリの`EXPLAIN`ステートメントをキャプチャします。この機能を有効にすると、 `maxExplainPlans`値までのすべてのトランザクションに対してプランがキャプチャされるため、パフォーマンスに影響を与える可能性があることに注意してください。
  </Collapser>

  <Collapser
    id="tracer-explainThreshold"
    title="explainThreshold"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `500`
          </td>
        </tr>

        <tr>
          <th>
            ユニット
          </th>

          <td>
            ミリ秒
          </td>
        </tr>
      </tbody>
    </table>

    エージェントは、トランザクション追跡の一部として、利用可能な説明プランとともに、このしきい値を超えるクエリの [低速クエリ データを](/docs/apm/applications-menu/monitoring/viewing-slow-query-details) 収集します。
  </Collapser>

  <Collapser
    id="tracer-maxSegments"
    title="maxSegments"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `3000`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクション・トレースで収集するセグメントの最大数です。
  </Collapser>

  <Collapser
    id="tracer-maxExplainPlans"
    title="maxExplainPlans"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `20`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションごとに収集するExplainプランの最大数。
  </Collapser>

  <Collapser
    id="tracer-maxStackTrace"
    title="maxStackTrace"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `0`
          </td>
        </tr>
      </tbody>
    </table>

    デフォルトでは、 `maxStackTrace`は0に設定されています。これにより、トランザクショントレースの一部としてスタックトレースが無効になります。この値が0より大きい値に設定されている場合、トランザクショントレースのスタックトレースがキャプチャされます。
  </Collapser>

  <Collapser
    id="tracer-attributes"
    title="属性"
  >
    このサブ要素を使用して、トランザクショントレースのエージェント属性設定をカスタマイズします。このサブ要素は、プライマリ`attributes`要素と同じ設定[`enabled`](#agent-attributes-enabled) 、 [`include`](#agent-attributes-include) 、および[`exclude`](#agent-attributes-exclude)を使用します。
  </Collapser>
</CollapserGroup>

### データストアトレーサー [#datastore_tracer]

`datastoreTracer`要素は`configuration`要素の子です。

```xml
<datastoreTracer>
  <instanceReporting enabled="true"  />
  <databaseNameReporting enabled="true" />
  <queryParameters enabled="false" />
</datastoreTracer>
```

`datastoreTracer`要素は、次のサブ要素をサポートします。

<CollapserGroup>
  <Collapser
    id="instance-reporting"
    title="instanceReporting"
  >
    このサブ要素を使用して、[一部のデータベースドライバー](/docs/agents/net-agent/features/net-agent-instance-level-database-information)のデータストアインスタンスメトリック（ホストやポートなど）の収集を有効にします。これらは、低速のクエリトレースとトランザクショントレースで報告されます。属性`enabled`のデフォルト値は`true`です。
  </Collapser>

  <Collapser
    id="database-name-reporting"
    title="databaseNameReporting"
  >
    このサブ要素を使用して、[一部のデータベースドライバー](/docs/agents/net-agent/features/net-agent-instance-level-database-information)の低速クエリトレースおよびトランザクショントレースでデータベース名を収集できるようにします。属性`enabled`のデフォルト値は`true`です。
  </Collapser>

  <Collapser
    id="datastore-tracer-query-parameters"
    title="queryParameters"
  >
    このサブ要素を使用して、低速のクエリトレースでSQLクエリパラメータの収集を有効にします。属性`enabled`のデフォルト値は`false`です。

    <Callout variant="caution">
      * クエリのパラメータを記録すると、機密情報が取得される可能性があります。
      * `transactionTracer.recordSql`構成オプションは`raw`に設定する必要があります。そうしないと、このオプションは無視されます。
    </Callout>
  </Collapser>
</CollapserGroup>

### ディストリビューティッド（分散）トレーシング [#distributed_tracing]

`distributedTracing`要素は`configuration`要素の子です。

```xml
<distributedTracing enabled="false"
   excludeNewrelicHeader="false"/>
```

分散トレースを使用すると、リクエストが分散システムを通過するときにたどるパスを確認できます。[.NETエージェントバージョン8.6.45.0以降](/docs/agents/net-agent/installation/update-net-agent)が必要であり、.NETエージェント9.0.0.0以降ではデフォルトでオンになっています。

<Callout variant="important">
  [分散トレース](/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing)を有効にすると、[クロスアプリケーショントレース](#cross_application_tracer)が無効になり、APM機能に他の影響があります。有効にする前に、[計画ガイド](/docs/transition-guide-distributed-tracing)をお読みください。
</Callout>

分散トレースの設定の詳細については、「。 [NETアプリケーションの分散トレースを有効にする」を参照してください](/docs/apm/agents/net-agent/configuration/distributed-tracing-net-agent)。

`distributedTracing`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="tracer-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    あるいは、アプリケーションの環境で`NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`環境変数を介してディストリビューティッド（分散）トレーシングを有効にします。

    ```ini
    NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
    ```
  </Collapser>

  <Collapser
    id="excludeNewrelicHeader"
    title="excludeNewrelicHeader"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    デフォルトでは、サポートされているバージョンのエージェントは、分散トレースに`newrelic`ヘッダーと[W3Cトレースコンテキスト](/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#headers)ヘッダーの両方を利用します。 `newrelic`分散トレースヘッダーにより、W3Cトレースコンテキストヘッダーをサポートしない古いエージェントとの相互運用が可能になります。 W3Cトレースコンテキストヘッダーをサポートするエージェントバージョンは、分散トレースの`newrelic`ヘッダーよりも優先されます。

    `newrelic`ヘッダーを使用しない場合、これを`true`に設定すると、エージェントが`newrelic`ヘッダーを除外し、ディストリビューティッド（分散）トレーシング用のW3Cトレースコンテキストヘッダーのみを使用するようになります。
  </Collapser>
</CollapserGroup>

分散型トレーシングはスパンイベントを報告します。スパンイベントのレポートはデフォルトで有効ですが、 [ディストリビュートトレース](/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing) スパンをレポートするためには有効にする必要があります。スパンイベントを無効にするには、次のいずれかのオプションを選択します。

<CollapserGroup>
  <Collapser
    id="span-events-disable-config"
    title="設定ファイルによるスパンイベントの無効化"
  >
    newrelic.configファイルを介して無効にするには、 `<spanEvents>`要素を`false`に設定します。この要素は`<configuration>`要素の子です。

    ```xml
    <configuration . . . >
      <spanEvents enabled="false" />
    </configuration>
    ```
  </Collapser>

  <Collapser
    id="span-events-disable-env_variable"
    title="環境変数によるスパンイベントの無効化"
  >
    アプリケーションの環境で`NEW_RELIC_SPAN_EVENTS_ENABLED`環境変数を設定します。

    ```ini
    NEW_RELIC_SPAN_EVENTS_ENABLED=false
    ```
  </Collapser>
</CollapserGroup>

### 無限のトレース [#infinite_tracing]

[Infinite Tracing は、](/docs/distributed-tracing/infinite-tracing/introduction-infinite-tracing) エージェントの外部にあるトレース オブザーバーを採用することで、分散トレース サービスを拡張します。さまざまなサービスでアプリケーション トレースを 100% 監視し、実用的なデータを提供するため、問題をより迅速に解決できます。

[Infinite Tracing](/docs/distributed-tracing/infinite-tracing/introduction-infinite-tracing)を有効にするには、 [.NET エージェントのバージョンが 8.30 以降で](/docs/release-notes/agent-release-notes/net-release-notes)あることを確認し、分散トレースを有効にします。次に、次の追加設定を追加します。

```xml
<configuration . . . >
  <distributedTracing enabled="true" />
  <infiniteTracing>
    <trace_observer host="<var>YOUR_TRACE_OBSERVER_HOST</var>" />
  </infiniteTracing>
</configuration>
```

<Callout variant="important">
  無限トレーススパンは、 [`transactionTracer.maxSegments`](/docs/apm/agents/net-agent/configuration/net-agent-configuration/#tracer-maxSegments)設定によって制限できます。
</Callout>

`infiniteTracing`要素は次の要素をサポートします。

<CollapserGroup>
  <Collapser
    id="trace_observer"
    title="トレース_オブザーバー"
  >
    `trace_observer`要素は、エージェントから独立しているオブザーバーホストを識別します。有効なInfiniteTracingトレースオブザーバーホストエントリの取得について[は、トレースオブザーバーエンドポイントの検索または作成を](/docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing#provision-trace-observer "https&#x3A;//docs.newrelic.com/docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing#provision-trace-observer")参照してください。

    トレースオブザーバーは、 `NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST`環境変数を使用して構成することもできます。

    <Callout variant="important">
      トレースオブザーバーを構成するときは、ホストの一部としてプロトコルを指定しないでください。たとえば、 `https://myhost.infinitetracing.com` }の代わりに`myhost.infinitetracing.com`を使用します。
    </Callout>
  </Collapser>
</CollapserGroup>

### クロスアプリケーショントレース [#cross_application_tracer]

`crossApplicationTracer`要素は`configuration`要素の子です。 `crossApplicationTracer`は、アプリケーション間でトランザクショントレースをリンクします。サービス指向アーキテクチャーでリンクされると、HTTPを介して相互に通信するすべてのインストルメント化されたアプリケーションは、トランザクショントレースを、それらが呼び出すアプリケーションおよびそれらが呼び出されるアプリケーションと「リンク」するようになります。[クロスアプリケーショントレース](/docs/traces/cross-application-traces)を使用すると、サービスとアプリケーション間のパフォーマンスの関係を簡単に理解できます。

<Callout variant="important">
  クロスアプリケーション トレースは[、エージェント v9.0.0 の](/docs/release-notes/agent-release-notes/net-release-notes/net-agent-9000/)時点で非推奨となり、デフォルトで無効になっています。 将来のエージェントのバージョンでは削除される予定です。 エージェントの v9 以降で CAT を使用するには、 `crossApplicationTracer.enabled = true`と`distributedTracing.enabled = false`の両方を設定する必要があります。 [ディストリビューティッド（分散）トレーシングを](/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing)有効にする[と、クロスアプリケーション トレーシングが](#cross_application_tracer)無効になります。
</Callout>

```xml
<crossApplicationTracer enabled="true"/>
```

`crossApplicationTracer`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="catracer-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    クロスアプリケーショントレースの有効化・無効化
  </Collapser>
</CollapserGroup>

### スパンイベント

`spanEvents`要素は`configuration`要素の子です。 `spanEvents`を使用してスパンイベントを構成します。

```xml
<spanEvents enabled="true">
  <attributes enabled="true">
    <exclude><var>myApiKey.*</var></exclude>
    <include><var>myApiKey.foo</var></include>
  </attributes>
</spanEvents>
```

`spanEvents`要素は次の属性をサポートします。

<CollapserGroup>
  <Collapser
    id="span-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    イベントレコーダーの有効化、無効化を行います。
  </Collapser>

  <Collapser
    id="span-max-samples-stored"
    title="maximumSamplesStored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            Int
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            2000
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが一度にメモリに保存できる、サンプリングされたスパン イベントの最大数。これは、エージェントが 1 分間に送信できるスパン イベントの最大数になります。

    * これは、 `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED`環境変数を使用して構成することもできます。

    * 10kを超える設定は推奨されません。サーバーによって1分あたりのデータの上限は10kに制限されることになります。

    * [AI モニタリング](/docs/ai-monitoring/intro-to-ai-monitoring/)用にエージェントを構成する場合は、値を`10000`に設定することをお勧めします。

      <Callout variant="important">
        この設定オプションは、.NET Agent v9.0以降でのみ利用可能です。
      </Callout>
  </Collapser>

  <Collapser
    id="span-attributes"
    title="属性"
  >
    このサブ要素を使用して、スパンイベントのエージェント属性設定をカスタマイズします。このサブ要素は、プライマリ`attributes`要素と同じ設定[`enabled`](#agent-attributes-enabled) 、 [`include`](#agent-attributes-include) 、および[`exclude`](#agent-attributes-exclude)を使用します。

    <Callout variant="tip">
      これらの属性設定は、スパン イベントに固有です。[この構成設定を使用すると、属性設定を](/docs/agents/net-agent/configuration/net-agent-configuration#agent-attributes)すべてのイベント タイプにグローバルに適用できます。
    </Callout>
  </Collapser>
</CollapserGroup>

### HTTPリクエストヘッダの取得 [#capture_http_request_headers]

`allowAllHeaders`要素は`configuration`要素の子です。これを`true`に設定して、.NET エージェントがすべての HTTP 要求ヘッダーをキャプチャーし、それらを`request.headers.{http-header-name}`属性として &#x7B; `Span`および`Transaction`イベントに適用できるようにします。これを`false`に設定すると、.NET エージェントのみが次の HTTP 要求ヘッダーを収集できるようになります:

```
request.headers.referer
request.headers.accept
request.headers.content-length
request.headers.host
request.headers.user-agent
```

<CollapserGroup>
  <Collapser
    id="allow-all-headers-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>

    HTTPリクエストヘッダのキャプチャを有効または無効にします。例を示します。

    あるいは、アプリケーションの環境で`NEW_RELIC_ALLOW_ALL_HEADERS`環境変数を設定します。

    ```xml
    <allowAllHeaders enabled="true" />
    <attributes enabled="true">
       <include>request.headers.*</include>
    </attributes>
    ```
  </Collapser>
</CollapserGroup>

<Callout variant="important">
  `allowAllHeaders`設定は、.NETAgentバージョン8.40.0以降でのみ使用できます。 `allowAllHeaders`を使用して属性をキャプチャする場合、キャプチャされたリクエストヘッダー属性は、ルートレベルと宛先レベルの[属性](/docs/agents/net-agent/configuration/net-agent-configuration/#agent-attributes)設定によって引き続き制御されます。 `attributes`要素の下の`include`リストに`request.header.*`を設定しなくても（以下を参照）、.NETエージェントはすべてのヘッダー属性を除外します。デフォルトの`newrelic.config`は、 `request.header.*`を含むように設定されています。

  ```xml
  <allowAllHeaders enabled="true" />
  <attributes enabled="true">
    <include>request.headers.*</include>
    ...
  </attributes>
  ```

  デフォルトの`newrelic.config`は、.NETエージェントが不要なデータを収集しないように、次のHTTPリクエストヘッダーを明示的に除外するようにも設定されています。

  ```xml
  <attributes enabled="true">
    <exclude>request.headers.cookie</exclude>
    <exclude>request.headers.authorization</exclude>
    <exclude>request.headers.proxy-authorization</exclude>
    <exclude>request.headers.x-*</exclude>
  </attributes>
  ```
</Callout>

### アプリケーションログ [#application_logging]

<Callout variant="important">
  これらの構成オプションは、.NET エージェント バージョン 9.7.1 以降でのみ使用できます。コンテキスト データ (カスタム属性) に関連するオプションは、.NET エージェント バージョン 10.4.0 以降でのみ使用できます。
</Callout>

`applicationLogging`要素は`configuration`要素の子です。 `applicationLogging`を使用して、アプリケーションのロギングアクティビティのインストルメンテーションを構成します。

3つの主要なサブ機能があります。

1. メトリック：ハーベストサイクルごとに書き込まれるログ行の総数（ `Logging/lines` ）、および特定のログレベル（たとえば、 `Logging/lines/ERROR` ）で書き込まれるログ行の数に関するメトリックを収集します。

2. ログ転送：有効にすると、エージェントはログデータをキャプチャしてNewRelicに送信します。

   * コンテキスト データ ( [`AddCustomAttribute`](/docs/apm/agents/net-agent/net-agent-api/itransaction/#addcustomattribute)経由): 有効にすると、エージェントはカスタム ログ属性をキャプチャして転送します。`include`要素と`exclude`要素は、他のエージェント属性設定と[同じルール](/docs/apm/agents/net-agent/attributes/enable-disable-attributes-net/#attruls)に従って、含めるか除外する属性名のカンマ区切りのリストです。デフォルトでは両方とも空であるため、すべてのログ コンテキスト データがキャプチャされて転送されます。
   * ログレベルのフィルタリング: カンマ区切りのリストで 1 つ以上のログ レベルを設定すると、エージェントはそれらのレベルのメッセージがキャプチャされ、転送されるのを防ぎます。

3. ローカルログデコレーション：有効にすると、既存のログは、エラーなどの他のNewRelicデータとログをリンクするメタデータでデコレーションされます。

詳細については、[コンテキストでの .NET エージェント ログの使用に関するドキュメントを](/docs/logs/logs-context/net-configure-logs-context-all)参照してください。

```xml
<applicationLogging enabled="true">
  <metrics enabled="true" />
  <forwarding enabled="true" maxSamplesStored="10000" logLevelDenyList="">
    <contextData enabled="false" include="" exclude="" />
  </forwarding>
  <localDecorating enabled="false" />
</applicationLogging>
```

これらの機能は、環境変数を介して構成することもできます。

```ini
NEW_RELIC_APPLICATION_LOGGING_ENABLED=<var>true|false</var>
NEW_RELIC_APPLICATION_LOGGING_METRICS_ENABLED=<var>true|false</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=<var>true|false</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_ENABLED=<var>true|false</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_INCLUDE=<var>"myCustomAttribute1, myOtherCustomAttribute*"</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_CONTEXT_DATA_EXCLUDE=<var>"myCustomAttribute2, myOtherCustomAttributeMoreSpecificName"</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED=<var>10000</var>
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_LOG_LEVEL_DENYLIST=<var>"log_level_1, log_level_2"</var>
NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED=<var>true|false</var>
```

`applicationLogging`要素は、次の属性とサブ要素をサポートします。

<CollapserGroup>
  <Collapser
    id="applog-enabled"
    title="有効"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>
      </tbody>
    </table>

    すべてのロギングインストルメンテーション機能を有効または無効にします。 `true`の場合、個々のサブ機能の構成が有効になります。 `false`の場合、ロギングインストルメンテーション機能は有効になりません。
  </Collapser>

  <Collapser
    id="applog-metrics"
    title="メトリックス"
  >
    このサブ要素を使用して、一般的な.NETロギングフレームワークのロギングメトリック（ `Logging/lines`など）の収集を有効にします。属性`enabled`のデフォルト値は`true`です。
  </Collapser>

  <Collapser
    id="applog-forwarding"
    title="ログ転送"
  >
    このサブ要素を使用して、アプリケーションのログをNewRelicに転送できるようにします。属性`enabled`のデフォルト値は`true`です。属性`maxSamplesStored`のデフォルト値は`10000`です。

    これをより低い値に設定して、送信されるログラインの量を減らします（ログサンプリングの原因になる場合があります）。これをより高い値に設定すると、より多くのログラインが送信されます。

    各ログは、関連するトランザクションと同じ優先度を受け取ります。トランザクション外で発生したログには、ランダムな優先度が割り当てられます。`maxSamplesStored`によって制限されているため、一部のログは含まれない場合があります。たとえば、ロギング`maxSamplesStored`が 10,000 に設定され、トランザクション 1 に 10,000 のログ エントリがある場合、トランザクション 1 のログ エントリのみが記録されます。トランザクション 1 のログが 10,000 未満の場合、トランザクション 1 のすべてのログを受け取ります。まだスペースがある場合は、トランザクション 2 のすべてのログを受け取ります。

    サンプリングされたトランザクションのすべてのログが記録され、それらが`maxSamplesStored`の制限に達していない場合、サンプリングに含まれていなかったトランザクションのログ メッセージが送信されます。残っている場合は、トランザクション以外のログ メッセージが記録されます。

    `logLevelDenyList` 属性を使用して、指定したログ レベルのログ メッセージを除外します。この属性の値は、大文字と小文字を区別しないカンマ区切りのレベルのリストです。この場合を除き、ログ レベル文字列はフィルタリングされるログ レベルと正確に一致する必要があり、ワイルドカードと正規表現はサポートされていません。たとえば、値が `logLevelDenyList="debug,warn"`に設定されている場合、ログ レベルが `Debug` または `Warn` のログ メッセージはキャプチャまたは転送されませんが、レベルが `Warning` のログは引き続き New Relic に送信されます。

    <Callout variant="caution">
      既存のログ転送ソリューションを使用してアプリケーションのログをすでにNewRelicに送信している場合は、ログデータの重複が請求されないように、エージェントでログ転送を有効にする前に必ず無効にしてください。
    </Callout>
  </Collapser>

  <Collapser
    id="contextData"
    title="コンテキスト データ (カスタム属性)"
  >
    `forwarding`要素の子であるこのサブ要素を使用して、エージェント バージョン 10.4.0 以降でロギング コンテキスト データ ([カスタム属性](/docs/apm/agents/net-agent/net-agent-api/itransaction/#addcustomattribute)) のキャプチャと転送を構成します。

    `enabled`属性を`true`に設定して、ロギング コンテキスト データのキャプチャと New Relic への転送を有効にします。デフォルト値は`false`です。

    `include`属性は、コンテキスト データ キャプチャが有効な場合に含める属性の名前のカンマ区切りのリストです。デフォルト値は空の文字列で、「すべてを含める」ことを意味します。

    `exclude`属性は、コンテキスト データ キャプチャが有効な場合に除外する属性の名前のカンマ区切りのリストです。デフォルト値は空の文字列で、「何も除外しない」ことを意味します。

    包含リストと除外リストは [、他のエージェント属性設定と同じ優先規則に](/docs/apm/agents/net-agent/attributes/enable-disable-attributes-net/#attruls)従います。
  </Collapser>

  <Collapser
    id="localDecorating"
    title="地元の丸太の装飾"
  >
    このサブ要素を使用して、NewRelicリンクメタデータでアプリケーションのログを装飾できるようにします。属性`enabled`のデフォルト値は`false`です。ローカルログの装飾には、いくつかの追加の構成変更が必要です。詳細については、 [.NET：コンテキストでのログの構成](/docs/logs/logs-context/net-configure-logs-context-all#2-decorate)を参照してください。
  </Collapser>
</CollapserGroup>

### コードレベルの指標 [#code_level_metrics]

`codeLevelMetrics`要素は`configuration`要素の子です。 `codeLevelMetrics`を使用して、スパンイベントの属性としてキャプチャされた追加のインストルメント化されたメソッドメタデータを介してCodeStreamでコードレベルのメトリックサポートを有効にします。

詳細については、 [NewRelicCodeStreamの統合](/docs/apm/agents/net-agent/other-features/net-codestream-integration)に関するドキュメントを参照してください。

```xml
<codeLevelMetrics enabled="true" />
```

これは、環境変数を介して構成することもできます。

```ini
NEW_RELIC_CODE_LEVEL_METRICS_ENABLED=<var>true|false</var>
```

### AIモニタリング [#ai_monitoring]

デフォルトでは、AI モニタリングは無効になっています。 AI モニタリングを有効にするには、 `aiMonitoring`要素で`enabled`属性を`true`に設定します。 `aiMonitoring`要素は`configuration`要素の子です。

```xml
<aiMonitoring enabled="true" />
```

これは、環境変数を介して構成することもできます。

```ini
NEW_RELIC_AI_MONITORING_ENABLED=<var>true|false</var>
```

`aiMonitoring`要素は、次のサブ要素をサポートします。

<CollapserGroup>
  <Collapser
    id="aiMonitoring_recordContent"
    title="記録内容"
  >
    このサブ要素を使用して、LLM イベントのすべての入力と出力を New Relic に送信できるようにします。 属性`enabled`のデフォルト値は`true`です。 高セキュリティモードではコンテンツの記録は無効になります。

    コンテンツの記録が無効になっている場合は、顧客が[`SetLlmTokenCountingCallback` API](/docs/agents/net-agent/net-agent-api/setllmtokencountingcallback-net-agent-api)を呼び出して LLM トークンのカウントを提供する必要があることに注意してください。 このコールバックが提供されない場合、エージェントは LLM トークンのカウントを提供できません。

    ```xml
    <aiMonitoring enabled="true">
      <recordContent enabled="false" />
    </aiMonitoring>
    ```

    これは、環境変数を介して構成することもできます。

    ```ini
    NEW_RELIC_AI_MONITORING_RECORD_CONTENT_ENABLED=<var>true|false</var>
    ```
  </Collapser>
</CollapserGroup>

## app.configまたはweb.configでの設定 [#app-config-settings]

ASP.NETおよび.NETFrameworkコンソールアプリの場合、アプリの`app.config`または`web.config`の最も外側の要素である`<configuration>`で次の設定を構成することもできます。

<CollapserGroup>
  <Collapser
    id="app-cfg-agent-enabled"
    title="エージェントの有効化・無効化"
  >
    ```xml
    <appSettings>
       <add key="NewRelic.AgentEnabled" value="false" />
    </appSettings>
    ```

    <Callout variant="important">
      エージェントがローカルまたはグローバルの `newrelic.config`で無効になっている場合、これらのファイルの `NewRelic.AgentEnabled` 設定ではエージェントは **有効** になりません。
    </Callout>
  </Collapser>

  <Collapser
    id="app-cfg-application-name"
    title="アプリケーション名"
  >
    詳細については、 [Name your .NET application](/docs/agents/net-agent/installation-configuration/name-your-net-application) を参照してください。

    ```xml
    <appSettings>
      <add key="NewRelic.AppName" value="Descriptive Name" />
    </appSettings>
    ```
  </Collapser>

  <Collapser
    id="app-cfg-license-key"
    title="ライセンスキー"
  >
    ```xml
    <appSettings>
      <add key="NewRelic.LicenseKey" value="XXXXXXXX" />
    </appSettings>
    ```
  </Collapser>

  <Collapser
    id="app-cfg-location"
    title="newrelic.configの場所の変更"
  >
    アプリのローカルルートやグローバルな設定場所以外の、設定ファイルの代替場所を指定します。入力する場所は、絶対パスでなければなりません。

    ```xml
    <appSettings>
      <add key="NewRelic.ConfigFile" value="C:\Path-to-alternate-config-dir\newrelic.config" />
    </appSettings>
    ```
  </Collapser>
</CollapserGroup>

## appsettings.jsonでの設定 [#appsettings-json]

.NET Coreアプリの場合、次の条件が当てはまる場合は、 `appsettings.json`で次の設定を構成できます。

* `appsettings.json`ファイルは、アプリケーションの現在の作業ディレクトリにある必要があります。

* このアプリケーションには、以下の依存関係が必要です。

  * [`Microsoft.Extensions.Configuration`](https://www.nuget.org/packages/Microsoft.Extensions.Configuration)
  * [`Microsoft.Extensions.Configuration.Json`](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.Json)
  * [`Microsoft.Extensions.Configuration.EnvironmentVariables`](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.EnvironmentVariables)

<CollapserGroup>
  <Collapser
    id="appsettings-json-agent-enabled"
    title="エージェントの有効化・無効化"
  >
    ```json
    {
       "NewRelic.AgentEnabled":"false"
    }
    ```

    <Callout variant="important">
      ローカルまたはグローバル `newrelic.config`でエージェントが無効になっている場合、これらのファイルの `NewRelic.AgentEnabled` 設定によってエージェントが有効になります。
    </Callout>
  </Collapser>

  <Collapser
    id="appsettings-json-application-name"
    title="アプリケーション名"
  >
    詳細については、 [Name your .NET application](/docs/agents/net-agent/installation-configuration/name-your-net-application) を参照してください。

    ```json
    {
        "NewRelic.AppName": "Descriptive Name"
    }
    ```
  </Collapser>

  <Collapser
    id="appsettings-json-application-license-key"
    title="ライセンスキー"
  >
    ```json
    {
        "NewRelic.LicenseKey": "XXXXXXXX"
    }
    ```
  </Collapser>

  <Collapser
    id="appsettings-json-location"
    title="newrelic.configの場所の変更"
  >
    アプリのローカルルートやグローバルな設定場所以外の、設定ファイルの代替場所を指定します。入力する場所は、絶対パスでなければなりません。

    ```json
    {
        "NewRelic.ConfigFile": "C:\Path-to-alternate-config-dir\newrelic.config"
    }
    ```
  </Collapser>
</CollapserGroup>

<Callout variant="important">
  [ASP.NET Core アプリ](https://asp.net/)の場合、 `ASPNETCORE_ENVIRONMENT`変数を設定すると、.NET エージェントは`appsettings.{environment}.json`から読み取ります。
</Callout>