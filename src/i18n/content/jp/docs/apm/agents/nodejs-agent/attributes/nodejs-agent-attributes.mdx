---
title: Node.jsエージェントの属性
tags:
  - Agents
  - Nodejs agent
  - Attributes
metaDescription: 'New Relic Node.js agent: How to include and exclude specific attributes for events and transactions, including their properties and rules.'
translationType: machine
---

このドキュメントでは、New Relic Node.js エージェントの [属性](/docs/agents/manage-apm-agents/agent-data/agent-attributes) 、属性を有効または無効にする方法を詳しく説明し、エージェントが [宛先](/docs/agents/manage-apm-agents/agent-data/agent-attributes#destinations) に対してどの属性を含めるか、または除外するかを決定するために従うルールを説明しています。

<Callout variant="tip">
  これらの属性設定は、Node.jsエージェントのバージョン2.7.1以降に適用されます。それ以前のバージョンのエージェントを使用している場合は、 [レガシー属性設定の更新](/docs/agents/nodejs-agent/installation-configuration/upgrade-nodejs-agent) を参照してください。
</Callout>

## 属性の検索と使用 [#location]

New Relic [属性](/docs/agents/manage-apm-agents/agent-data/agent-attributes) は、 [イベント](/docs/accounts-partnerships/getting-started-new-relic/glossary#event) および [トランザクション](/docs/accounts-partnerships/getting-started-new-relic/glossary#transaction) データのプロパティを決定する情報を含むキーと値のペアです。属性を利用することで、アプリケーションに対する洞察を深めたり、New Relic [のデータに注釈を付けたりすることができます。](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights) 。

属性（デフォルトと [カスタム](/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes) の両方）は、次のとおりです。

* APM [トランザクション・トレース](/docs/apm/transactions/transaction-traces/introduction-transaction-traces) and [エラー・アナリティクス](/docs/apm/applications-menu/error-analytics/introduction-error-analytics)
* [APMイベント](/docs/insights/explore-data/attributes/apm-default-attributes-insights)
* [ブラウザイベント](/docs/insights/explore-data/attributes/browser-default-attributes-insights#browser-attributes-table)

それぞれの送信先にどの属性を送信するかを正確にカスタマイズできます。

<Callout variant="tip">
  Node.js エージェント バージョン 6.10.0 の時点で、分散トレースや無限トレースを有効にすると、 `Transaction`イベントからの情報が現在使用可能なトランザクションの`Span`に適用されます。このため、 `Transaction`イベントの属性設定を`Span`イベントに適用するか、それらをグローバル属性設定として適用することをお勧めします。
</Callout>

## Node.js固有の属性 [#attributes]

[デフォルトのAPM属性](/docs/insights/new-relic-insights/decorating-events/apm-default-attributes-insights#transaction-event) に加えて、Node.jsエージェントは以下のソースから属性を収集します。

<CollapserGroup>
  <Collapser
    id="httpResponseCode"
    title="HTTPレスポンスコード"
  >
    Webリクエストの応答ステータスコード。この属性のキーは`httpResponseCode`です。

    各デスティネーションのデフォルト設定は

    * トランザクションのトレースEnabled

    * エラー分析。有効

    * APMのイベント有効

    * ブラウザのイベント。使用不可

      **注:** `httpResponseCode`属性 (文字列値) は、エージェント バージョン 7.0.0 で削除されました。代わりに`http.statusCode` (整数値) を使用する必要があります。
  </Collapser>

  <Collapser
    id="httpResponseMessage"
    title="HTTPレスポンスメッセージ"
  >
    Web要求に存在する場合の応答ステータスメッセージ。この属性のキーは`httpResponseMessage`です。

    各デスティネーションのデフォルト設定は

    * トランザクションのトレースEnabled

    * エラー分析。有効

    * APMのイベント有効

    * ブラウザのイベント。使用不可

      **注:** `httpResponseMessage`属性 (文字列値) は、エージェント バージョン 7.0.0 で削除されました。代わりに`http.statusText` (文字列値) を使用する必要があります。
  </Collapser>

  <Collapser
    id="NRaddCustomParameter"
    title="カスタムアトリビュート"
  >
    Node.js エージェント API への[`addCustomAttribute()`](https://newrelic.github.io/node-newrelic/API.html#addCustomAttribute)呼び出しに追加された属性。この属性のキー名は、メソッドを呼び出すときに指定した内容によって異なります。

    各デスティネーションのデフォルト設定は

    * トランザクションのトレースEnabled

    * エラー分析。有効

    * APMのイベント有効

    * ブラウザのイベント。使用不可

      <Callout variant="important">
        カスタム属性を作成する前に、NRQL で使用される New Relic の [reserved terms のリストを確認してください](/docs/insights/insights-data-sources/custom-data/insights-custom-data-requirements-limits#reserved-words) 。そうしないと、予期しない結果が発生する可能性があります。
      </Callout>
  </Collapser>

  <Collapser
    id="NRaddnoticeError"
    title={<><InlineCode>noticeError()</InlineCode> APIコール</>}
  >
    Node.js エージェント API の[`noticeError()`](https://newrelic.github.io/node-newrelic/API.html#noticeError)呼び出しに追加された属性。この属性のキー名は、メソッドを呼び出すときに指定した内容によって異なります。

    各デスティネーションのデフォルト設定は

    * トランザクションのトレース。利用できません
    * エラー分析。有効
    * APMのイベントです。利用不可
    * ブラウザのイベント使用不可
  </Collapser>

  <Collapser
    id="requestHeaders"
    title="リクエストヘッダーとレスポンスヘッダー"
  >
    Node.jsエージェントは、レスポンスヘッダとリクエストヘッダを属性として取り込むことができます。デフォルトでは、Node.jsエージェントは、除外されていないすべてのリクエストヘッダを収集します。

    デフォルトで除外されるHTTPリクエストヘッダ。

    * `request.headers.cookie`

    * `request.headers.authorization`

    * `request.headers.proxy-authorization`

    * `request.headers.set-cookie*`

    * `request.headers.x-*`

      キャプチャされた応答ヘッダー： `response.headers.content-type`

      `newrelic.js`ファイルで`allow_all_headers`を`false`に設定すると、すべてのヘッダーの収集を無効にできます。

      各デスティネーションのデフォルト設定は

    * トランザクションのトレースEnabled

    * エラー分析。有効

    * APMのイベント有効

    * ブラウザのイベント。使用不可
  </Collapser>

  <Collapser
    id="requestparams"
    title="リクエストパラメータ"
  >
    トランザクションからパラメーターを要求します。Node.js エージェントは、デフォルトではパラメーターをキャプチャしません。`request.parameters.*`エントリを[`attributes.include`](#cfg-attributes-include)に追加すると、すべての GET パラメータをキャプチャできます。または、特定のリクエスト パラメータをリストに追加できます (例: `request.parameters.foo`または`request.parameters.bar` 。POST パラメーターを取得するには、[`addCustomAttribute()`](https://newrelic.github.io/node-newrelic/API.html#addCustomAttribute) Node.js エージェント API 呼び出しを使用します。
  </Collapser>
</CollapserGroup>

## 属性の設定

Node.js エージェントが各送信先に送信する属性の種類をカスタマイズすることができます。これは、セキュリティ上の理由から、New Relic に報告してほしくない機密性の高い属性がある場合によく行われます。

以下の構成プロパティと [属性ルール](#attruls) を使用して、属性を有効または無効にします。

<CollapserGroup>
  <Collapser
    id="cfg-attributes-enabled"
    title="allow_all_headers"
  >
    デフォルトでは無効です。`exclude`ルールでフィルタリングされたものを除くすべてのヘッダーのみをエージェントが収集するには、これを`true`に設定します。
  </Collapser>

  <Collapser
    id="cfg-attributes-include-enabled"
    title="attribute.include_enabled"
  >
    デフォルトで有効になっています。[`attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_include)アレイを無効にするには、これを`false`に設定します。
  </Collapser>

  <Collapser
    id="cfg-attributes-enabled"
    title={<>destination.attributes.enabled</>}
  >
    <table>
      <thead>
        <tr>
          <th>
            行き先
          </th>

          <th style={{ width: "400px" }}>
            設定オプション
          </th>

          <th>
            デフォルト
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            すべて
          </td>

          <td>
            [`attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_enabled)
          </td>

          <td>
            トゥルー
          </td>
        </tr>

        <tr>
          <td>
            トランザクショントレース
          </td>

          <td>
            [`transaction_tracer.attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#tracer_enabled)
          </td>

          <td>
            トゥルー
          </td>
        </tr>

        <tr>
          <td>
            エラー解析
          </td>

          <td>
            [`error_collector.attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#error_collector)
          </td>

          <td>
            トゥルー
          </td>
        </tr>

        <tr>
          <td>
            APMイベント
          </td>

          <td>
            [`transaction_events.attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#tx_events_enabled)
          </td>

          <td>
            トゥルー
          </td>
        </tr>

        <tr>
          <td>
            ブラウザイベント
          </td>

          <td>
            [`browser_monitoring.attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#browser)
          </td>

          <td>
            false
          </td>
        </tr>
      </tbody>
    </table>

    属性全体を有効または無効にします。宛先を`false`に設定すると、包含/除外の設定に関係なく、属性はその宛先に送信されません。宛先が有効な場合、すべてのユーザー属性がデフォルトでその宛先に送信されます。
  </Collapser>

  <Collapser
    id="cfg-attributes-include"
    title={<>宛先.属性.インクルード</>}
  >
    <table>
      <thead>
        <tr>
          <th>
            行き先
          </th>

          <th style={{ width: "400px" }}>
            設定オプション
          </th>

          <th>
            デフォルト
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            すべて
          </td>

          <td>
            [`attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_include)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            トランザクショントレース
          </td>

          <td>
            [`transaction_tracer.attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#hide-attributes-include)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            エラー解析
          </td>

          <td>
            [`error_collector.attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#error_attributes_include)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            APMイベント
          </td>

          <td>
            [`transaction_events.attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#tx-attributes-include)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            ブラウザイベント
          </td>

          <td>
            [`browser_monitoring.attributes.include`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#browser-debug-include)
          </td>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが New Relic に報告する特定の属性キーを指定します。すべての宛先について、これはデフォルトで空の文字列のリストです。`.exclude`プロパティは`.include`プロパティをオーバーライドします。すべての`.include`値を無効にするには、 [`attributes.include_enabled`](#cfg-attributes-include-enabled)を`false`に設定します。
  </Collapser>

  <Collapser
    id="cfg-error-attributes-enabled"
    title={<>宛先.属性.除外</>}
  >
    <table>
      <thead>
        <tr>
          <th>
            行き先
          </th>

          <th style={{ width: "400px" }}>
            設定オプション
          </th>

          <th>
            デフォルト
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            すべて
          </td>

          <td>
            [`attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_exclude)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            トランザクショントレース
          </td>

          <td>
            [`transaction_tracer.attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#hide-attributes-exclude)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            エラー解析
          </td>

          <td>
            [`error_collector.attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#error_attributes_exclude)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            APMイベント
          </td>

          <td>
            [`transaction_events.attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#tx-attributes-exclude)
          </td>

          <td>
            （無し）
          </td>
        </tr>

        <tr>
          <td>
            ブラウザイベント
          </td>

          <td>
            [`browser_monitoring.attributes.exclude`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#browser-debug-exclude)
          </td>

          <td>
            （無し）
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが New Relic に報告しない特定の属性キーを指定します。すべての宛先について、これはデフォルトで空の文字列のリストです。`.exclude`プロパティは`.include`プロパティをオーバーライドします。
  </Collapser>
</CollapserGroup>

## アトリビュートルール [#attruls]

Node.jsエージェントは、デスティネーションに対してどの属性を含めるか、または除外するかを決定する際に、これらのルールに従います。

<CollapserGroup>
  <Collapser
    id="rule-disable-overrides-all"
    title="attributes.enabledをfalseに設定すると、他の設定がすべて無効になります。"
  >
    メインの[`attributes.enabled`](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_enabled)プロパティを`false`に設定すると、エージェントは属性をまったく報告しません。

    <CollapserGroup>
      <Collapser
        id="disable-all-example"
        title="すべてのアトリビュートを無効にする"
      >
        エージェントの設定。

        * `attributes.enabled: false`

        * `attributes.include: request.parameters.*`

        * `error_collector.attributes.enabled: true`

          入力キー。

        * `foo`

        * `bar`

        * `request.parameters.foo`

        * `request.parameters.bar`

          エージェントの出力です。

        * トランザクションの痕跡。属性なし

        * エラーアナリティクス。属性がありません

        * APMのイベントです。属性なし

        * ブラウザのイベントです。属性なし
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="rule-enable-overrides-incl-excl"
    title="デスティネーションをfalseに設定すると、include/excludeがオーバーライドされます。"
  >
    宛先の[有効](#cfg-attributes-enabled)化を`false`に設定すると、エージェントは包含/除外設定を無視し、その宛先の属性を報告しません。

    <CollapserGroup>
      <Collapser
        id="example-disabling-destination"
        title="1つのデスティネーションを無効にする"
      >
        エージェントの設定。

        * `transaction_tracer.attributes.enabled: false`

        * `attributes.include: one, two*`

        * `transaction_tracer.attributes.include: three, four`

          入力キー。

        * `one`

        * `two`

        * `three`

        * `four`

          エージェントの出力です。

        * トランザクションの痕跡。属性なし

        * エラー分析： `one` 、 `two`

        * APMイベント： `one` 、 `two`

        * ブラウザのイベントです。属性なし
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="rule-exclude-overrides-include"
    title="Exclude overridesはincludeです。"
  >
    `.exclude`プロパティは`.include`プロパティを上書きします。

    <CollapserGroup>
      <Collapser
        id="example-exclude-overrides"
        title="インクルード設定とエクスクルード設定の相克"
      >
        エージェントの設定。

        * `attributes.enabled: true`

        * `attributes.include: foo, myCustomAtt`

        * `attributes.exclude: password, myCustomAtt`

          入力キー。

        * `foo`

        * `myCustomAtt`

        * `password`

          エージェントの出力です。

        * トランザクショントレース： `foo`

        * エラー分析： `foo`

        * APMイベント： `foo`

        * ブラウザイベント： `foo`
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="rule-specific-wins"
    title="より具体的なルールが優先されます。"
  >
    複数のincludeまたはexclude属性が同じキーに影響を与える場合は、最も具体的な設定が優先されます。

    <CollapserGroup>
      <Collapser
        id="example-most-specific"
        title="特定の設定とのコンフリクト"
      >
        エージェントの設定。

        * `attributes.enabled: true`

        * `attributes.include: foo, myCustomAtt`

        * `attributes.exclude: password, myCustomAtt`

        * `browser_monitoring.attributes.enabled: true`

          入力キー。

        * `food`

        * `food.bread`

        * `food.fruit.banana`

        * `food.fruit.apple`

          エージェントの出力です。

        * トランザクショントレース： `food.fruit.apple`

        * エラー分析： `food.fruit.banana` 、 `food.fruit.apple`

        * APMイベント： `food.fruit.banana` 、 `food.fruit.apple`

        * ブラウザイベント： `food.fruit.banana` 、 `food.fruit.apple`
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="rule-keys-case-sensitive"
    title="キーは大文字と小文字を区別します。"
  >
    `.include`および`.exclude`プロパティで指定されたキーでは、大文字と小文字が区別されます。

    <CollapserGroup>
      <Collapser
        id="example-case-sensitive"
        title="キーが指定されたケースと一致しない"
      >
        エージェントの設定。

        * `attributes.enabled: true`

        * `attributes.exclude: password, PaSsWoRd`

          入力キー。

        * `password`

        * `Password`

        * `PASSWORD`

        * `PaSsWoRd`

        * `PassWORD`

          エージェントの出力です。

        * トランザクショントレース： `Password` 、 `PASSWORD` 、 `PassWORD`

        * エラー分析： `Password` 、 `PASSWORD` 、 `PassWORD`

        * APMイベント： `Password` 、 `PASSWORD` 、 `PassWORD`

        * ブラウザイベント： `Password` 、 `PASSWORD` 、 `PassWORD`
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="rule-star-wildcard"
    title="ワイルドカードにはアスタリスクを使用します。"
  >
    キーの末尾にあるアスタリスク`*`をワイルドカードとして使用できます。これは、同じプレフィックスを持つ属性のセットと一致します。

    <CollapserGroup>
      <Collapser
        id="example-asterisk-wildcard"
        title="ワイルドカードで複数の入力キーに対応"
      >
        エージェントの設定。

        * `attributes.enabled: true`

        * `attributes.include: custom*`

        * `attributes.exclude: request.parameters.*`

          入力キー。

        * `custom`

        * `custom.key1`

        * `custom.key2`

        * `request.parameters.`

        * `request.parameters.foo`

        * `request.parameters.bar`

          エージェントの出力です。

        * トランザクショントレース： `custom` 、 `custom.key1` 、 `custom.key2`

        * エラー分析： `custom` 、 `custom.key1` 、 `custom.key2`

        * APMイベント： `custom` 、 `custom.key1` 、 `custom.key2`

        * ブラウザイベント： `custom` 、 `custom.key1` 、 `custom.key2`
      </Collapser>
    </CollapserGroup>
  </Collapser>
</CollapserGroup>