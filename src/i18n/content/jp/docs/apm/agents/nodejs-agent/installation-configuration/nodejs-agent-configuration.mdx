---
title: Node.jsエージェントの設定
tags:
  - Agents
  - Nodejs agent
  - Installation and configuration
metaDescription: 'For New Relic''s Node.js agent: how to set configuration using your config file, environment variables, or server-side config.'
freshnessValidatedDate: never
translationType: human
---

`newrelic.js`設定ファイルを編集するか、環境変数を設定することで、Node.jsエージェントをアプリケーションの要件に合わせて調整できます。設定ファイルは、アプリケーションのルートディレクトリに存在します。また、New Relicでいくつかのオプションを設定するか、[Node.jsエージェントAPI](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api)を使用することもできます。

## スタートガイド [#requirements]

[New Relicアカウントを作成](https://newrelic.com/signup)（永久無料）し、[Node.jsエージェントをインストール](/docs/apm/agents/nodejs-agent/installation-configuration/install-nodejs-agent/)した後、環境に合わせてNode.jsエージェントを設定できます。

[`license_key`](#license)設定は必須です。また、アプリケーションにデフォルトの`app_name`ではなく[意味のある名前](#app_name)を[`My Application`](/docs/apm/new-relic-apm/installation-configuration/name-your-application)に付けることを強く推奨しています。

## 設定方法と優先順位 [#methods-and-precedence]

Node.jsエージェントを設定する最初の方法は、エージェント設定ファイル (`newrelic.js`) です。また、ほとんどの設定は[環境変数](#environment)を使用して設定できます。さらに、[サーバーサイドコンフィグレーション](#server-side)を使用して調整できる設定もあります。

Node.jsエージェントは、設定方法に下記の優先順位の順序を使用します：

<img
  title="Node.js agent configuration precedence"
  alt="Node.js agent configuration precedence"
  src="/images/apm_diagram_nodejs-agent-configuration-hierarchy.webp"
/>

<figcaption>
  <DNT>**Node.js configuration hierarchy:**</DNT> サーバーサイドコンフィグレーション設定は環境変数に優先します。環境変数はエージェント設定ファイルに優先します。設定ファイルはエージェントのデフォルト設定に優先します。
</figcaption>

各設定方法の詳細な説明は、以下のとおりです。

<CollapserGroup>
  <Collapser
    className="freq-link"
    id="config_file"
    title="エージェント設定ファイル"
  >
    設定ファイル (`newrelic.js`) には、すべてのNode.jsエージェント設定が含まれています。[Node.jsエージェントをインストール](/docs/agents/nodejs-agent/installation-configuration/installing-maintaining-nodejs#installing)する際、`newrelic.js`をアプリケーションのルートディレクトリにコピーする必要があります。ほとんどの設定のデフォルト値は空で、`config/default.js`からの値を継承します。

    アプリケーションがCommonJSで実行されている場合は、単純に設定ファイルタイプを（`newrelic.cjs`）に変更します。このファイルタイプは、Node.jsエージェントの[v7.5.0](/docs/release-notes/agent-release-notes/nodejs-release-notes/node-agent-7-5-0/)でサポートされています。
  </Collapser>

  <Collapser
    className="freq-link"
    id="environment"
    title="環境変数"
  >
    `newrelic.js`のすべてのコンフィグレーション設定には同等の環境変数があります。これらは、PaaS環境（Heroku、Microsoft Azureなど）でエージェントを実行する場合に役立ちます。Node.jsエージェントの環境変数は常に`NEW_RELIC_`で始まります。

    これらの環境変数は、以下の各構成オプションの下に<DNT>**Environ variable**</DNT>として文書化されています。 [環境変数を介してのみ構成できる](#environment-variable-overrides)、ほとんど使用されることがない2つの設定があります。より複雑なタイプを環境変数として指定する方法がわからない場合は、[リファレンスガイド](#environment-variable-type-reference-guide)を使用してください。

    New Relic CodeStreamを使用してIDEからパフォーマンスを監視する場合は、[リポジトリをサービスに関連付け](/docs/codestream/how-use-codestream/performance-monitoring#repo-association)、[ビルドSHAまたはリリースタグをエラーに関連付ける](/docs/codestream/how-use-codestream/performance-monitoring#buildsha)必要があります。
  </Collapser>

  <Collapser
    className="freq-link"
    id="server-side"
    title="サーバーサイドコンフィグレーション"
  >
    所有者と管理者は、[直接New Relic](/docs/agents/manage-apm-agents/configuration/server-side-agent-configuration)でいくつかの設定を表示、設定することができます。利用可能な場合、サーバーサイドコンフィグレーション用のUIラベルは、このドキュメントの個々の設定オプションの下に<DNT>**Server-side label**</DNT>としてリストアップされています。
  </Collapser>
</CollapserGroup>

## エクスポート変数 [#exports_config]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`exports.config = {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="app_name"
    title="app_name（必須）"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `"My Application"`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APP_NAME`
          </td>
        </tr>
      </tbody>
    </table>

    [New Relicがアプリケーションを識別するのに使用する名前](/docs/apm/new-relic-apm/installation-configuration/name-your-application)。例、`app_name: ['MyNodeApp']`。[アプリケーションに複数の名前を使用する](/docs/apm/new-relic-apm/installation-configuration/use-multiple-names-app)には、カンマ区切りの名前リストを指定します。

    同じ名前のすべてのアプリケーションのデータはNew Relic UIにマージされるため、この設定は慎重に行ってください。混同や非意図的なデータの集計を避けるために、デフォルト名を分かりやすい名前に置き換えることを<DNT>**highly recommend**</DNT>しています。

    <Callout variant="tip">
      [Azureユーザー](/docs/agents/nodejs-agent/hosting-services/nodejs-agent-microsoft-azure)の場合、Node.jsエージェントは、Azure Webサーバー用に選択した名前を設定し直すことなく使用できるように、`APP_POOL_ID`を（設定されていれば）使用します。
    </Callout>
  </Collapser>

  <Collapser
    id="license"
    title="license_key（必須）"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_LICENSE_KEY`
          </td>
        </tr>
      </tbody>
    </table>

    この設定は必須です。 New Relic <InlinePopover type="licenseKey"/>。 たとえば、 `license_key: '40HexadecimalCharacters'` 。
  </Collapser>

  <Collapser
    id="agent-enabled"
    title="agent_enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントの起動を防ぐには、`false`に設定します。これは、コードをデバッグする際にエージェントを一時的に無効にする必要がある場合に役立ちます。この設定は、エージェントによってそのインストゥルメンテーションのブートストラップや、すべての要素の設定が行われることを防止し、これによりエージェントが起動しNew Relicのサーバーに接続することを阻止できます。
  </Collapser>

  <Collapser
    id="allow_all_headers"
    title="allow_all_headers"
  >
    `true`の場合、`exclude`ルールでフィルタリングされたものを除いて、すべてのHTTPヘッダーの取得を有効にします。`false`の場合、収集されたヘッダーは[Node.jsエージェントの属性](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-attributes)で定義されたものに制限されます。

    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ALLOW_ALL_HEADERS`
          </td>
        </tr>
      </tbody>
    </table>

    <Callout variant="caution">
      すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
    </Callout>
  </Collapser>

  <Collapser
    id="compressed_content_encoding"
    title="compressed_content_encoding"
  >
    ペイロードでデータ圧縮閾値に達すると、エージェントはデフォルトでgzip圧縮を使用してデータを圧縮します。設定オプション`compressed_content_encoding`を`deflate`に設定すると、DEFLATE圧縮を使用できます。

    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `gzip`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_COMPRESSED_CONTENT_ENCODING`
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="apdex"
    title="apdex_t（非推奨）"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `0.100`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Apdex T`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APDEX_T`
          </td>
        </tr>
      </tbody>
    </table>

    Apdex Tは[New Relic UIを介して](/docs/apm/new-relic-apm/apdex/apdex-measure-user-satisfaction/#apm-apdex)設定できます。
  </Collapser>

  <Collapser
    id="certificates"
    title="certificates"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列の配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_CERTIFICATES`
          </td>
        </tr>
      </tbody>
    </table>

    PEM形式で文字列の配列として指定される、SSL接続に対する追加の信用証明書。これは、HTTPSプロキシとNew Relicへの両方の接続に影響します。

    <Callout variant="tip">
      また次のようにファイルから証明書を読み込むようにエージェントを設定できます。

      ```js
      certificates: [ fs.readFileSync('myca.crt', {encoding: 'utf8'}) ]
      ```
    </Callout>
  </Collapser>

  <Collapser
    id="high_security"
    title="high_security"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_HIGH_SECURITY`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定している場合、[高セキュリティv2](/docs/accounts-partnerships/accounts/security/high-security#version2description)を有効にします。また[`ssl`](#ssl)設定を有効化し、かつ[UIで高セキュリティを有効化する](/docs/accounts-partnerships/accounts/security/high-security#version2enabled)必要があります。
  </Collapser>

  <Collapser
    id="host"
    title="ホスト"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `collector.newrelic.com`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_HOST`
          </td>
        </tr>
      </tbody>
    </table>

    <Callout variant="important">
      この値は、New Relic Supportから変更を依頼されない限り編集しないでください。
    </Callout>

    インターネットに接続するための[New Relicコレクター](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector)のホスト名（例：`host: 'collector.newrelic.com'`）。
  </Collapser>

  <Collapser
    id="labels"
    title="labels"
  >
    [タグ](/docs/apm/new-relic-apm/maintenance/labels-categories-organize-your-apps-servers)を追加します。タグをオブジェクトとして、またはセミコロン区切りの文字列のコロンで分けられたペアとして指定します（例：`Server:One;Data Center:Primary`）。

    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            オブジェクトまたは文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_LABELS`
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="port"
    title="port"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `443`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PORT`
          </td>
        </tr>
      </tbody>
    </table>

    <Callout variant="important">
      この値は、New Relic Supportから変更を依頼されない限り編集しないでください。
    </Callout>

    New Relicコレクターに接続するためのポート番号（例：`port: 443`）。
  </Collapser>

  <Collapser
    id="proxy"
    title="proxy"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROXY_URL`
          </td>
        </tr>
      </tbody>
    </table>

    インターネットに接続するためのプロキシサーバーを指定するURL。例、`proxy: 'http://user:pass@10.0.0.1:8000/'`。重要な考慮事項：

    * `proxy`構成ファイル設定を使用すると、他の構成ファイルプロキシ設定（`proxy_host`、`proxy_port`、`proxy_user`、`proxy_pass`）が上書きされます。同様に、`NEW_RELIC_PROXY_URL`環境変数を使用すると、他の環境変数プロキシ設定（`NEW_RELIC_PROXY_HOST`、```NEW_RELIC_PROXY_PORT``NEW_RELIC_PROXY_USER```、`NEW_RELIC_PROXY_PASS`）が上書きされます。
    * [Infinite Tracing](/docs/distributed-tracing/infinite-tracing/introduction-infinite-tracing)を使用している場合：[Infinite Tracingのプロキシを設定する方法を参照してください](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-proxy-support/#node-php-python-ruby)。
  </Collapser>

  <Collapser
    id="proxy_host"
    title="proxy_host"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROXY_HOST`
          </td>
        </tr>
      </tbody>
    </table>

    インターネットに接続するためのプロキシサーバーのホスト名またはIPアドレス。
  </Collapser>

  <Collapser
    id="proxy_pass"
    title="proxy_pass"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROXY_PASS`
          </td>
        </tr>
      </tbody>
    </table>

    プロキシサーバーに対する認証用パスワード。エージェントはHTTP BASIC認証のみサポートします。
  </Collapser>

  <Collapser
    id="proxy_port"
    title="proxy_port"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROXY_PORT`
          </td>
        </tr>
      </tbody>
    </table>

    インターネットに接続するためのプロキシサーバーのポート番号。
  </Collapser>

  <Collapser
    id="proxy_user"
    title="proxy_user"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROXY_USER`
          </td>
        </tr>
      </tbody>
    </table>

    プロキシサーバーに対する認証用ユーザー名。エージェントはHTTP BASIC認証のみサポートします。
  </Collapser>
</CollapserGroup>

## 変数のロギング [#logging_config]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`logging: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="log-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true` （`serverless_mode`の`false`）
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_LOG_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントに特異なロギングを有効または無効にします。
  </Collapser>

  <Collapser
    id="log_level"
    title="level"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `info`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_LOG_LEVEL`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントログに記録される詳細レベルを定義します。最小から最大の詳細レベルの順で取りうる値は、`fatal`、`error`、`warn`、`info`、`debug`、`trace`があります。

    <Callout variant="caution">
      `debug`または`trace`ロギングは、New Relic Supportから使用を依頼されない限り、使用しないでください。これらのロギングレベルでは、過剰なオーバーヘッドが発生する可能性があります。ほとんどの場合は`info`を使用してください。
    </Callout>
  </Collapser>

  <Collapser
    id="log"
    title="filepath"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `process.cwd()` plus `newrelic_agent.log`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_LOG`
          </td>
        </tr>
      </tbody>
    </table>

    ファイル名を含めたNew Relicエージェントログへのフルパスです。デフォルトは`filepath: require('path').join(process.cwd(), 'newrelic_agent.log')`件です。エージェントは、このファイルを作成できない場合、プロセスを終了します。エージェントは、Node.jsエージェントプロセスの場合と同じアクセス権でログファイルを作成します。

    * すべてのロギングを

      <DNT>
        **stdout**
      </DNT>

      に書き込むには、これを`stdout`に設定します。

    * すべてのロギングを

      <DNT>
        **stderr**
      </DNT>

      に書き込むには、これを`stderr`に設定します。
  </Collapser>
</CollapserGroup>

## AIモニタリング [#ai-monitoring]

このセクションには、AIモニタリングを設定するためのNode.jsエージェント設定が含まれます。

<Callout variant="important">
  AIデータをキャプチャするには、[ディストリビューティッド（分散）トレーシング](/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#dt-main)を有効化する必要があります。 Node.jsエージェント8.3.0以降では、デフォルトで有効になっています。 高セキュリティモードを有効にしている場合、AIモニタリングは機能しません。
</Callout>

<CollapserGroup>
  <Collapser
    id="ai-monitoring-enabled"
    title="ai_monitoring.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_AI_MONITORING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定すると、AIモニタリングが有効化されます。 エージェントがLLMイベントデータをキャプチャできるようにします。
  </Collapser>

  <Collapser
    id="ai-monitoring-streaming"
    title="ai_monitoring.streaming.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_AI_MONITORING_STREAMING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `false`に設定すると、ストリーミングされたLLMデータのインストゥルメンテーションが無効化されます。 `true`に設定すると、LLMイベントのストリーミングデータがキャプチャされます。
  </Collapser>

  <Collapser
    id="ai-monitoring-record-content"
    title="ai_monitoring.record_content.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_AI_MONITORING_RECORD_CONTENT_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `false`に設定すると、エージェントはLLMイベントでキャプチャされた入力および出力コンテンツ（プロンプトやレスポンスのテキスト文字列など）を省略します。 これは、LLMとの間で送受信される機密データを記録したくない場合のオプションのセキュリティ設定です。
  </Collapser>
</CollapserGroup>

## 監査ログ [#audit_log]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`audit_log: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="audit_log-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_AUDIT_LOG_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    有効な場合、エージェントはコレクターに送信するペイロードをログします。このデータは、ロギングレベルが最小レベルに設定されている場合でも、メインログファイルに含まれます。
  </Collapser>

  <Collapser
    id="endpoints"
    title="endpoints"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]` （すべてのタイプを含む）
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_AUDIT_LOG_ENDPOINTS`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントは、さまざまなタイプのデータを個別のペイロード内のコレクターに送信します。デフォルトでは、これらすべてがログファイルに含まれています。このオプションでは、ロギングを特定のデータタイプに制限することができます。

    有効な値には、次が含まれます：

    * `agent_settings`
    * `analytic_event_data`
    * `connect`
    * `custom_event_data`
    * `error_data`
    * `error_event_data`
    * `metric_data`
    * `preconnect`
    * `shutdown`
    * `span_event_data`
    * `sql_trace_data`
    * `transaction_sample_data`
  </Collapser>
</CollapserGroup>

## APIの設定 [#api_config]

このセクションでは、有効にするAPIメソッドを選択できます。各設定オプションでは、New Relicにカスタム情報を送信する役割を果たすAPIメソッドをモジュール式に有効化できます。

<Callout variant="important">
  エージェントが高セキュリティモードの場合、これらすべては`false`に設定されます。
</Callout>

<CollapserGroup>
  <Collapser
    id="custom-attributes"
    title="custom_attributes_enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_API_CUSTOM_ATTRIBUTES`
          </td>
        </tr>
      </tbody>
    </table>

    このオプションで、[`newrelic.addCustomAttribute`](/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-param)と[`newrelic.addCustomAttributes`](/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-params)が有効になります。
  </Collapser>

  <Collapser
    id="custom-events"
    title="custom_events_enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_API_CUSTOM_EVENTS`
          </td>
        </tr>
      </tbody>
    </table>

    このオプションで、[`recordCustomEvent`](/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#record_custom_event)が有効になります。
  </Collapser>

  <Collapser
    id="notice-error"
    title="notice_error_enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_API_NOTICE_ERROR`
          </td>
        </tr>
      </tbody>
    </table>

    このオプションで、[`newrelic.noticeError`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)が有効になります。
  </Collapser>
</CollapserGroup>

## 属性 [#node-js-attributes]

このセクションでは、お使いのアプリケーションの`newrelic.js`設定ファイルの`attributes: {`セクションに通常表示される順序で、[Node.jsエージェント属性](/docs/agents/nodejs-agent/attributes/nodejs-agent-attributes)の変数を定義します。

<Callout variant="caution">
  すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
</Callout>

<CollapserGroup>
  <Collapser
    id="attributes_enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、すべての宛先に対して属性の取得を有効にします。
  </Collapser>

  <Collapser
    id="attributes_exclude"
    title="exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    すべての宛先から除外する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="attributes_include"
    title="include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    すべての宛先に追加する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="attributes_include_enabled"
    title="include_enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ATTRIBUTES_INCLUDE_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、パターンを[`attributes.include`](/docs/agents/nodejs-agent/attributes/nodejs-agent-attributes#cfg-attributes-include)リストに追加できます。
  </Collapser>
</CollapserGroup>

## エラーコレクター変数 [#error_config]

New Relicで[エラーの処理方法を管理](/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-mark-expected)できます。本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`error_collector: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="error_collector"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ENABLED`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Enable error collection?`
          </td>
        </tr>
      </tbody>
    </table>

    有効な場合、エージェントはアプリケーションから[エラートレース](/docs/apm/applications-menu/events/viewing-apm-errors-error-traces)を収集します。
  </Collapser>

  <Collapser
    id="error_ignore"
    title="ignore_status_codes"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数の配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[404]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_IGNORE_ERROR_CODES`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Ignore these status codes`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクターが無視するカンマ区切りのHTTPステータスコードリスト。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="error_ignore_classes"
    title="ignore_classes"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列|オブジェクト
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_IGNORE_ERRORS`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクターが無視すべきjavascriptエラータイプ//クラスのカンマ区切りリスト。

    以下の設定：

    ```js
    error_collector: {
        /* ... */
        ignore_classes: ["ReferenceError"]
    }
    ```

    すべての参照エラーを無視します。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="error_ignore_messages"
    title="ignore_messages"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            オブジェクト
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `{}`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_IGNORE_MESSAGES`
          </td>
        </tr>
      </tbody>
    </table>

    コレクターが無視すべきエラーメッセージに関連したクラスリストを説明するJavaScriptオブジェクト。次の設定では、`Undefined`および`Out of time`と全く同じ (大文字と小文字を区別) メッセージ文字列を持つタイプ`Error`のエラーをすべて無視します。

    ```js
    error_collector: {
        /* ... */
        ignore_messages: {"Error":["Undefined", "Out of time"]}
    }
    ```

    `Undefined`および`Out of time`と全く同じ（大文字と小文字を区別）メッセージ文字列を持つタイプ`Error`のエラーをすべて無視します。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="expected_status_codes"
    title="expected_status_codes"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数の配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_EXPECTED_ERROR_CODES`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクターが予想済みとしてマークする、カンマ区切りのHTTPステータスコードリスト。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="expected_classes"
    title="expected_classes"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_EXPECTED_ERRORS`
          </td>
        </tr>
      </tbody>
    </table>

    以下の設定：

    ```js
    error_collector: {
        /* ... */
        expected_classes: ["ReferenceError"]
    }
    ```

    すべての参照エラーを予想済みとしてマークします。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="expected_messages"
    title="expected_messages"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            オブジェクト
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `{}`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_EXPECTED_MESSAGES`
          </td>
        </tr>
      </tbody>
    </table>

    javascriptオブジェクト。コレクターが無視すべきjavascriptエラーメッセージに関連したjavascriptクラスリストを説明します。以下の設定。

    ```js
    error_collector: {
        /* ... */
        expected_messages: {"Error":["Undefined", "Out of time"]}
    }
    ```

    `Undefined`および`Out of time`と全く同じ（大文字と小文字を区別）メッセージ文字列を持つタイプ`Error`のすべてのエラーに印をつけます。

    <Callout variant="caution">
      [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
    </Callout>
  </Collapser>

  <Collapser
    id="error_attributes_enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、エージェントはエラーコレクションから属性を取得します。

    <Callout variant="caution">
      すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
    </Callout>
  </Collapser>

  <Collapser
    id="error_attributes_exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクションから除外する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="error_attributes_include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    エラーコレクションに追加する属性のプレフィックス。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>
</CollapserGroup>

<CollapserGroup>
  <Collapser
    id="error_max_event_samples_stored"
    title="max_event_samples_stored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `100`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ERROR_COLLECTOR_MAX_EVENT_SAMPLES_STORED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが1分あたりに収集するイベントの最大数。この数を超える場合、エージェントは統計的サンプリングを収集します。
  </Collapser>
</CollapserGroup>

## トランザクショントレーサーの変数 [#tx_tracer_config]

エージェントは、次の目的に、リクエストを[トランザクション](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction)に分類します。

* アプリケーションが時間を費やしている場所を可視化します（トランザクションの内訳）。
* 遅いリクエストを特定します。
* メトリクスをグループ化します。
* 遅い[データベースパフォーマンス](/docs/apm/applications-menu/monitoring/databases-slow-queries-dashboard)など、他の問題を切り分けます。

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`transaction_tracer: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<Callout variant="important">
  トランザクション名の末尾に角括弧`[suffix]`を使わないでください。New Relicは名前から自動的に角括弧を除去します。代わりに、必要に応じて丸括弧`(suffix)`、またはその他の記号を使ってください。
</Callout>

<CollapserGroup>
  <Collapser
    id="tracer_enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRACER_ENABLED`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Enable transaction tracing?`
          </td>
        </tr>
      </tbody>
    </table>

    有効な場合、エージェントは遅い[トランザクショントレース](/docs/apm/transactions/transaction-traces/transaction-traces)を収集します。
  </Collapser>

  <Collapser
    id="explain_threshold"
    title="explain_threshold"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `500`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_EXPLAIN_THRESHOLD`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションを[遅いクエリ](/docs/apm/applications-menu/monitoring/viewing-slow-query-details)と[トランザクショントレース](/docs/apm/transactions/transaction-traces/transaction-traces)の対象とするのに必要な最小クエリ時間 (ミリ秒単位)。
  </Collapser>

  <Collapser
    id="record-sql"
    title="record_sql"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列（`obfuscated`、`off`、または`raw`）
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `obfuscated`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_RECORD_SQL`
          </td>
        </tr>
      </tbody>
    </table>

    このオプションは、トランザクショントレースの[スロークエリ](#slow-queries)と`record_sql`の両方に影響します。これらの値（`off`、`obfuscated`、または`raw`）のいずれかを指定できます。

    `off`に設定されている場合、スロークエリは取得されません。また、バックトレースとSQLはトランザクショントレースに含まれません。`raw`または`obfuscated`に設定されている場合、エージェントは生のSQLまたは難読化されたSQLとスロークエリのサンプルを[コレクター](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector)に送信します。またエージェントは、その他の条件が満たされている場合（`slow_sql.enabled`が設定されているなど）、SQLを送信することがあります。
  </Collapser>

  <Collapser
    id="tracer_top"
    title="top_n"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `20`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRACER_TOP_N`
          </td>
        </tr>
      </tbody>
    </table>

    [トランザクショントレース](/docs/apm/transactions/transaction-traces/transaction-traces)に適したリクエストの最大数を定義。

    トランザクションはリクエストに基づいて命名され、`top_n`はこうした名前でグループ化された、「上位 n の最も遅いトランザクション」を意味します。モジュールが記録済みのトレースを新規トレースと置き換えるのは、新規トレースがその名前の過去のトレースの最も遅いものよりも遅い場合のみとなります。この設定のデフォルト値は`top_n: 20`です。これは、[<DNT>**Transactions**</DNT>ページ](/docs/apm/transactions/transaction-traces/transaction-traces)もまた、最も遅い20のトランザクションをデフォルトとするためです。

    Node.jsエージェントは、起動後の最初の収集サイクルにおいて、少なくとも5つの異なる遅いトランザクションをキャプチャーします。また、過去の5つの[収集サイクル](/docs/apm/new-relic-apm/getting-started/glossary#harvest-cycle)において遅いトランザクションがキャプチャーされなかった場合は、リセットしてから別のトランザクションをキャプチャーします。こうして、自社のアプリのリクエストパスに関して、その収集サイクルで絶対的に遅いリクエストに注目することなく詳細を確認できるようになります。

    <Callout variant="tip">
      過去1分間において絶対的に遅いトランザクションを記録するには、設定を`top_n: 0`または`top_n: 1`にします。ただし、これによって、非常に遅いルートがトランザクショントレースを支配することになります。
    </Callout>
  </Collapser>

  <Collapser
    id="tracer_threshold"
    title="transaction_threshold"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数または `apdex_f`
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `apdex_f`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRACER_THRESHOLD`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Threshold`
          </td>
        </tr>
      </tbody>
    </table>

    [トランザクショントレース](/docs/apm/transactions/transaction-traces/transaction-traces)が遅すぎると見なす時間を秒単位で設定します。デフォルト値は`apdex_f`です。これによって、トレースの閾値はご利用のアプリケーションの[Apdex T](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#apdex_t)の4倍に設定されます。数値が指定されている場合は、秒単位で設定されます。

    `apdex_t`のデフォルト値は500ミリ秒です。トランザクション閾値を`apdex_f`に設定した場合、「遅い」トランザクションは2秒になります。
  </Collapser>

  <Collapser
    id="hide-attributes-enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定されていると、エージェントはトランザクショントレースの属性をキャプチャーします。

    <Callout variant="caution">
      すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
    </Callout>
  </Collapser>

  <Collapser
    id="hide-attributes-exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクショントレースから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="hide-attributes-include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_TRACER_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクショントレースに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>
</CollapserGroup>

## ルールの変数 [#rules_config]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`rules: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="rules_names"
    title="name"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列または正規表現
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_NAMING_RULES`
          </td>
        </tr>
      </tbody>
    </table>

    受信するリクエストのURLを合致させ、関連のNew Relicトランザクションを命名するためのカンマ区切りルール一覧。次の形式を使用します：

    ```js
    name: [
        { pattern: 'STRING_OR_REGEX', name: 'NAME' },
        { pattern: 'STRING_OR_REGEX', name: 'NAME' }
    ]
    ```

    両方のパラメーターが必要。文字列に関しては、制御文字をエスケープしなくてはいけません。正規表現では、制御文字をエスケープする必要はありません。追加属性は無視されます。

    正規表現は`$1`式のキャプチャーグループに対応しており、名前は$1式の置換文字列を使用します。正規表現は、最初にマッチする結果のみを見つけ、それ以降のマッチは無視します。詳しくは[Node.jsトランザクションによるAPIの命名](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#ignoring)を参照してください。

    `NEW_RELIC_NAMING_RULES`環境変数に関しては、ルールをカンマ区切りのJSONオブジェクトリテラルとして渡します。

    ```ini
    NEW_RELIC_NAMING_RULES='{"pattern":"^t","name":"u"},{"pattern":"^u","name":"t"}'
    ```
  </Collapser>

  <Collapser
    id="rules_ignore"
    title="ignore"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列または正規表現
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `['^/socket.io/.*/xhr-polling/']`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_IGNORING_RULES`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントに無視してほしいリクエストURLの一覧を定義。一覧をパターンとして指定します。文字列または正規表現が可能です。デフォルト値は、socket.ioのロングポーリング要求に一致する正規表現です。
  </Collapser>

  <Collapser
    id="enforce_backstop"
    title="enforce_backstop"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_ENFORCE_BACKSTOP`
          </td>
        </tr>
      </tbody>
    </table>

    <Callout variant="caution">
      [メトリックのグループ化問題](/docs/features/metric-grouping-issues)を理解できる場合を除いて、この設定は変更しないでください。
    </Callout>

    これを有効にすると、エージェントは他の命名ロジックの影響を受けないトランザクション（API、ルール、またはメトリック正規化ルールなど）の名前を`NormalizedUri/*`に変更します。これを`false`に設定すると、エージェントはトランザクション名を`Uri/path/to/resource`に変更します。
  </Collapser>
</CollapserGroup>

## トランザクションイベントの変数 [#tx_events]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`transaction_events: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="tx_events_enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを有効にすると、エージェントがトランザクションイベントをNew Relicに送信します。このイベントデータには、トランザクションのタイミング、トランザクション名、任意のカスタムアトリビュートが含まれます。これが無効になると、エージェントはこうしたデータを収集せず、New Relicに送信することもありません。
  </Collapser>

  <Collapser
    id="tx_events_max_samples_stored"
    title="max_samples_stored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_MAX_SAMPLES_STORED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが1分あたりに収集するイベントの最大数。この数を超える場合、エージェントは統計的サンプリングを収集します。

    10,000を超える設定は推奨されません。サーバーによって1分あたりのデータの上限は10,000に制限されます。

    <Callout variant="important">
      6.0.0未満のエージェントバージョンの場合、この設定による動作は異なります。エージェントバージョン5.x以下の場合、[`max_samples_stored`（非推奨）](#tx_events_max_samples_stored_legacy)を参照してください。
    </Callout>
  </Collapser>

  <Collapser
    id="tx_events_max_samples_stored_legacy"
    title="max_samples_stored(廃止予定)"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `20000`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが[New Relicコレクター](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector)と通信できない場合に保管する最大イベント数を定義。以前の[収集サイクル](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#harvest-cycle)の値は新しいサンプリングにマージされ、このオプションは最大数を制限します。必ず、この数が`max_samples_per_minute`よりも大きいことを確認してください。たとえば、倍の数に設定しましょう。この値を増やす前に、メモリオーバーヘッドを考慮してください。

    <Callout variant="caution">
      エージェントバージョン6.0.0および新規の推奨最大値で始まる場合、この設定による動作は異なります。エージェントバージョン6.x以降については、[`max_samples_stored`](#tx_events_max_samples_stored)を参照してください。
    </Callout>
  </Collapser>

  <Collapser
    id="tx_events_max_samples_per_minute"
    title="max_samples_per_minute (廃止予定)"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが1分あたりに収集するイベントの最大数。この数を超える場合、エージェントは統計的サンプリングを収集します。

    <Callout variant="caution">
      エージェントバージョン6.0.0で始まる場合、この設定は`max_samples_stored`に置き換えられました。6.x以降のエージェントについては、[`max_samples_stored`](#tx_events_max_samples_stored)を参照してください。
    </Callout>
  </Collapser>

  <Collapser
    id="tx-attributes-enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定されていると、エージェントはトランザクションイベントの属性をキャプチャーします。

    <Callout variant="caution">
      すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
    </Callout>
  </Collapser>

  <Collapser
    id="tx-attributes-exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションイベントから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="tx-attributes-include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_TRANSACTION_EVENTS_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    トランザクションイベントに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>
</CollapserGroup>

## ブラウザモニターの変数 [#browser-variables]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`browser_monitoring: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="browser"
    title="enable"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITOR_ENABLE`
          </td>
        </tr>

        <tr>
          <th>
            [サーバーサイドラベル](#server-side)
          </th>

          <td>
            `Enable browser monitoring?`
          </td>
        </tr>
      </tbody>
    </table>

    BrowserインストゥルメンテーションのJavaScriptヘッダーを生成します。`true`に設定すると、 [手動で<InlinePopover type="browser"/>を有効に](/docs/browser/new-relic-browser/installation-configuration/adding-apps-new-relic-browser)しない限り、エージェントはブラウザJSコードのインジェクションを自動で行いません。有効にして[ブラウザタイミングヘッダーを追加した](/docs/agents/nodejs-agent/supported-features/page-load-timing-nodejs#procedures)場合でも、この値を`false`に設定することで[アプリのブラウザモニタリングを無効](/docs/agents/nodejs-agent/supported-features/page-load-timing-nodejs#disabling)にできます。
  </Collapser>

  <Collapser
    id="browser-debug"
    title="デバッグ"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITOR_DEBUG`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、サーバーからミニファイされていないソースをリクエストします。
  </Collapser>

  <Collapser
    id="browser-debug-enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`の場合、エージェントはブラウザモニタリングにカスタム属性を送信します。

    <Callout variant="caution">
      すべてのヘッダー関連の追加/除外ルールは、フィルタリング用にキャメルケース形式にする必要があります。
    </Callout>
  </Collapser>

  <Collapser
    id="browser-debug-exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    ブラウザモニタリングから除外する属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>

  <Collapser
    id="browser-debug-include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_BROWSER_MONITORING_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    ブラウザモニタリングに含める属性の接頭辞。末尾に`*`をワイルドカードとして使用可能。
  </Collapser>
</CollapserGroup>

## カスタムイベント変数 [#custom_events]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`custom_insights_events: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。

<CollapserGroup>
  <Collapser
    id="custom_events_enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_CUSTOM_INSIGHTS_EVENTS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを有効にすると、エージェントは[`recordCustomEvent()`](/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#custom-events-api)で記録したカスタムイベントを[New Relic](/docs/insights/new-relic-insights/adding-querying-data/inserting-custom-events-insights-api)に送信します。これが無効になると、エージェントはこうしたデータを収集せず、New Relicに送信することもありません。
  </Collapser>

  <Collapser
    id="custom_events_max_samples_stored"
    title="max_samples_stored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `3000`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_CUSTOM_INSIGHTS_EVENTS_MAX_SAMPLES_STORED`
          </td>
        </tr>
      </tbody>
    </table>

    * エージェントが1分あたりに収集するカスタムイベントの最大数を定義。カスタムイベント数がこの上限を超えた場合、エージェントは統計的サンプリングを収集します。

    * [AIモニタリング](/docs/ai-monitoring/intro-to-ai-monitoring)のエージェントを構成する場合は、最大値`100000`に設定します。 最大量のLLMイベントのキャプチャを保証します

      <Callout variant="important">
        この上限を増やすと、メモリ使用率が増大する可能性があります。
      </Callout>
  </Collapser>
</CollapserGroup>

## スロークエリ変数 [#slow-queries]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`slow_sql: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。こうしたオプションは、スロークエリに関する行動を制御するものの、トランザクショントレースにおけるSQLノードには作用しません。

<CollapserGroup>
  <Collapser
    id="slow-sql-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SLOW_SQL_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを有効にすると、エージェントは[スロークエリの詳細](/docs/apm/applications-menu/monitoring/viewing-slow-query-details)を収集します。
  </Collapser>

  <Collapser
    id="slow-sql-max-samples"
    title="max_samples"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_MAX_SQL_SAMPLES`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが1分あたりに収集するスロークエリの最大数を定義。エージェントは、上限に達した後の追加のクエリを破棄します。

    <Callout variant="important">
      この上限を増やすと、メモリ使用率が増大します。
    </Callout>
  </Collapser>
</CollapserGroup>

## カスタムホスト名変数 [#custom-hostnames]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`process_host: {`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。こうしたオプションは、APM UIにおけるホストのディスプレイ名に関する動作を制御します。

<CollapserGroup>
  <Collapser
    id="custom-hostnames-display"
    title="display_name"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            255バイト以下の文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_PROCESS_HOST_DISPLAY_NAME`
          </td>
        </tr>
      </tbody>
    </table>

    [New Relicで表示](/docs/apm/new-relic-apm/maintenance/add-rename-remove-hosts#display_name)するカスタムホスト名を指定。このフィールドを設定しない場合、`os.hostname()`をコールして得られるデフォルトのホスト名を引き続き使用します。

    * デフォルトのホスト名設定を使用した場合、New Relicは`os.hostname()`を通じてホスト名を探します。
    * このコールが失敗した場合、New RelicはホストのIPを名前に使用します。
    * `ipv_preference: 4`もしくは`ipv_preference: 6`を設定した場合、New Relic UIに表示されるIPアドレスの種類（IPv4もしくはIPv6）を選択できます。
  </Collapser>

  <Collapser
    id="custom-hostnames-ipv"
    title="ipv_preference"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            整数（`4`または`6`）
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `4`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_IPV_PREFERENCE`
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

## データストアトレーサーの変数 [#datastore-tracer]

本セクションは、ご利用のアプリケーションの`newrelic.js`設定ファイルの`datastore_tracer`セクションに通常表示される順序によって、Node.jsエージェントの変数を定義します。こうしたオプションは、データストアインスタンスのメトリクスの収集に関する行動を制御します。

<CollapserGroup>
  <Collapser
    id="datastore-instance-enabled"
    title="instance_reporting.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_DATASTORE_INSTANCE_REPORTING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを有効にすると、エージェントは[一部のデータベースドライバ](/docs/agents/nodejs-agent/supported-features/nodejs-instance-level-database-information)向けデータストアインスタンスのメトリクス（ホストとポートなど）を収集します。これらは、スロークエリトレースとトランザクショントレースで報告されます。
  </Collapser>

  <Collapser
    id="datastore-name-enabled"
    title="database_name_reporting.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_DATASTORE_DATABASE_NAME_REPORTING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを有効にすると、エージェントは[一部のデータベースドライバ](/docs/agents/nodejs-agent/supported-features/nodejs-instance-level-database-information)向けスロークエリトレースとトランザクショントレースのデータベース名を収集します。
  </Collapser>
</CollapserGroup>

## クロスアプリケーショントレース（廃止） [#cross-app-tracing]

[クロスアプリケーショントレーシング](/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces)を制御するNode.jsエージェントの変数は、通常はご利用のアプリケーションの`newrelic.js`設定ファイルの`cross_application_tracer`セクションに表示されます。

<Callout variant="important">
  クロスアプリケーショントレースは非推奨となり、代わりに[ディストリビューティッド（分散）トレーシング](/docs/enable-distributed-tracing)が採用されました。将来のエージェントバージョンでは削除されます。
</Callout>

<CollapserGroup>
  <Collapser
    id="cat-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_CROSS_APPLICATION_TRACER_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `true`に設定すると、New Relicが監視する複数のアプリケーションをまたいだトランザクションをトレースします。
  </Collapser>
</CollapserGroup>

<Callout variant="important">
  クロスアプリケーショントレース（CAT）は廃止され、今後のメジャーリリースで削除されます。クロスサービスの可視性のために、エージェントバージョン8.3.0のデフォルトで有効になっている[ディストリビューティッド（分散）トレーシング](#distributed-tracing)を使用することをお勧めします。有効にする前に、[移行ガイド](/docs/transition-guide-distributed-tracing)を読んでください。
</Callout>

## エラーメッセージ編集の変数 [#err-message-redact]

このNode.jsエージェントの変数は、ご利用のアプリケーションの`newrelic.js`設定の`strip_exception_messages`セクションに表示される、エラーメッセージ編集を制御します：

<CollapserGroup>
  <Collapser
    id="allow-raw-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_STRIP_EXCEPTION_MESSAGES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    `false`である場合、エージェントはキャプチャーしたエラーメッセージを編集します。
  </Collapser>
</CollapserGroup>

## ディストリビューティッド（分散）トレーシング [#dt-main]

[ディストリビューティッド（分散）トレーシング](/docs/intro-distributed-tracing)では、リクエストが経由する分散システムのパスを見ることができます。設定ファイルを介して設定する場合は、以下のオプションを`distributed_tracing`セクションに配置してください。Node.jsエージェント8.3.0以降では、デフォルトでオンになっています。

<Callout variant="important">
  ディストリビューティッド（分散）トレーシングを有効にすると、[クロスアプリケーショントレーシング](#cross-app-tracing)が無効になり、他のAPM機能に影響します。有効にする前に、[移行ガイド](/docs/transition-guide-distributed-tracing)を読んでください。[Node.jsエージェントのバージョン4.7.0以降が必要です](/docs/agents/nodejs-agent/installation-configuration/upgrade-nodejs-agent)。
</Callout>

ディストリビューティッド（分散）トレーシングの設定の詳細については、[Node.jsアプリケーションのディストリビューティッド（分散）トレーシングを有効にする](/docs/apm/agents/nodejs-agent/installation-configuration/distributed-tracing-nodejs-agent)を参照してください。

<CollapserGroup>
  <Collapser
    id="dt-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_DISTRIBUTED_TRACING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    これを`false`に設定し、ディストリビューティッド（分散）トレーシングを無効にします。たとえば、設定ファイルで、以下を使用します。

    ```js
    distributed_tracing: {
        enabled: false
    }
    ```
  </Collapser>

  <Collapser
    id="dt-exclude-newrelic-header"
    title="exclude_newrelic_header"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_DISTRIBUTED_TRACING_EXCLUDE_NEWRELIC_HEADER`
          </td>
        </tr>
      </tbody>
    </table>

    アウトバウンドリクエストに添付されたNew Relicヘッダーを除外するには、これを`true`に設定し、ディストリビューティッド（分散）トレーシング用のトレースコンテキストヘッダーにのみ依存します。これが`false`の場合、両方のタイプのヘッダーを使用します。

    たとえば、設定ファイルでこれを有効にするには、次のものを使用します：

    ```js
    distributed_tracing: {
        enabled: true,
        exclude_newrelic_header: true
    }
    ```
  </Collapser>
</CollapserGroup>

## gRPCサーバーインストゥルメンテーション [#grpc_server]

`grpc`セクションでは、gRPCサーバーのインストゥルメント方法の動作が制御されます。

<CollapserGroup>
  <Collapser
    id="record_errors"
    title="record_errors"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_GRPC_RECORD_ERRORS`
          </td>
        </tr>
      </tbody>
    </table>

    有効にすると、エージェントはすべてのエラーgRPCステータスコードをNew Relicに送信します。つまり、ステータスコードがゼロ以外の場合です。無効にすると、サーバーインストゥルメンテーションはゼロ以外のステータスコードをNew Relicに送信しません。
  </Collapser>
</CollapserGroup>

<Collapser
  id="grpc_error_ignore"
  title="ignore_status_codes"
>
  <table>
    <tbody>
      <tr>
        <th>
          タイプ
        </th>

        <td>
          整数の配列
        </td>
      </tr>

      <tr>
        <th>
          デフォルト
        </th>

        <td>
          `[]`
        </td>
      </tr>

      <tr>
        <th>
          [環境変数](#environment)
        </th>

        <td>
          `NEW_RELIC_GRPC_IGNORE_STATUS_CODES`
        </td>
      </tr>
    </tbody>
  </table>

  クライアント側とサーバー側の両方のインストゥルメンテーションで、エラーコレクターが無視するgRPCステータスコードのコンマ区切りリスト。

  <Callout variant="caution">
    [`newrelic.noticeError()`](/docs/apm/agents/nodejs-agent/api-guides/nodejs-agent-api/#noticeError)を使用して記録されたエラーは、この設定値に従いません。
  </Callout>
</Collapser>

## スパンイベント

[スパンデータ](/docs/apm/distributed-tracing/ui-data/span-event)は[ディストリビューティッド（分散）トレーシング](#distributed-tracing)用にレポートされます。スパンをレポートするには、ディストリビューティッド（分散）トレーシングが有効になっている必要があります。スパン設定は`span_events`セクションで設定されます。オプションには次のものが含まれます。

<CollapserGroup>
  <Collapser
    id="span-events-enabled"
    title="enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    スパンイベントのレポートをオンまたはオフにする。
  </Collapser>

  <Collapser
    id="span-events-attributes-enabled"
    title="attributes.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    この設定は、スパンの属性レポートをオンまたはオフにするために使用できます。ルートレベルで`attributes.enabled`が`false`である場合は、この設定方法にかかわらず、属性はスパンと一緒に送信されません。
  </Collapser>

  <Collapser
    id="span-events-attributes-include"
    title="attributes.include"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_INCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    属性がスパンに対して有効になっている場合は、このリストにあるすべての属性キーがスパンに添付されます。詳しくは[エージェント属性ルール](/docs/apm/other-features/attributes/agent-attributes)を参照してください。
  </Collapser>

  <Collapser
    id="span-events-attributes-exclude"
    title="attributes.exclude"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            配列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `[]`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SPAN_EVENTS_ATTRIBUTES_EXCLUDE`
          </td>
        </tr>
      </tbody>
    </table>

    このリストにあるすべての属性キーは、スパンと一緒に送信されません。詳しくは[エージェント属性ルール](/docs/apm/other-features/attributes/agent-attributes)を参照してください。
  </Collapser>
</CollapserGroup>

<Collapser
  id="span-events-max-samples-stored"
  title="max_samples_stored"
>
  <table>
    <tbody>
      <tr>
        <th>
          タイプ
        </th>

        <td>
          整数
        </td>
      </tr>

      <tr>
        <th>
          デフォルト
        </th>

        <td>
          `2000`
        </td>
      </tr>

      <tr>
        <th>
          [環境変数](#environment)
        </th>

        <td>
          `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED`
        </td>
      </tr>
    </tbody>
  </table>

  * エージェントが1分あたりに収集するイベントの最大数。この数を超える場合、エージェントは統計的サンプリングを収集します。

  * 10kを超える設定は推奨されません。サーバーによって1分あたりのデータの上限は10kに制限されることになります。

  * [AIモニタリング](/docs/ai-monitoring/intro-to-ai-monitoring)のエージェントを構成する場合は、最大値`10000`に設定します。 最大量のトレースのキャプチャを保証します

    <Callout variant="important">
      `max_samples_stored` 設定には、[Node.JSエージェントのバージョン8.3.0以降](/docs/apm/agents/nodejs-agent/installation-configuration/update-nodejs-agent/)が必要です。
    </Callout>
</Collapser>

## 無限トレーシング

無限トレーシングをオンにするには、以下の追加設定を加えます。無限トレーシング設定は`infinite_tracing`セクションで設定します。さらに、ディストリビューティッド（分散）トレーシングを[有効にする](/docs/apm/agents/nodejs-agent/installation-configuration/distributed-tracing-nodejs-agent)必要があります。Node.js APMエージェントバージョン8.3.0以降では、ディストリビューティッド（分散）トレーシングがデフォルトで有効になっています。

<CollapserGroup>
  <Collapser
    id="infinite-tracing-host"
    title="trace_observer.host"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST`
          </td>
        </tr>
      </tbody>
    </table>

    Infinite Tracing トレース オブザーバーのホストエントリを取得する方法については、「[トレースオブザーバーのエンドポイントを検索または作成する](/docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing#provision-trace-observer)」をご覧ください。
  </Collapser>

  <Collapser
    id="infinite-tracing-queue-size"
    title="span_events.queue_size"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_INFINITE_TRACING_SPAN_EVENTS_QUEUE_SIZE`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが削除する前にメモリに保持する無限トレーシングスパンの量。

    キューがほとんどの時間使用されていないため、この設定をデフォルトから変更する必要はありません。エージェントがデータをストリームできない間、無限トレーシングのエンドポイントへの再接続中にのみキューを使用します。エージェントがこの期間中に無限トレーシングスパンを削除する可能性があります。その場合は、この数を増やすと効果的です。
  </Collapser>
</CollapserGroup>

## アプリケーションロギング [#app-logging]

アプリケーションログの設定には、[Node.JSエージェントのバージョン8.11.0以降](/docs/apm/agents/nodejs-agent/installation-configuration/update-nodejs-agent/)が必要です。

Node.jsエージェントのログを設定するヒントについては、[コンテキスト内のNode.jsログの設定](/docs/logs/logs-context/configure-logs-context-nodejs)を参照してください。

<CollapserGroup>
  <Collapser
    id="application-logging-enabled"
    title="application_logging.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APPLICATION_LOGGING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    [コンテキストのログの](/docs/logs/logs-context/configure-logs-context-nodejs/)を自動生成できるようにします。

    たとえば、設定ファイルでこの機能を無効にするには、次のように使用します。

    ```js
    application_logging: {
        enabled: false
    }
    ```
  </Collapser>

  <Collapser
    id="application-logging-metrics-enabled"
    title="application_logging.metrics.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APPLICATION_LOGGING_METRICS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    APM概要ページのログチャートで使用するロギングメトリクスをエージェントが収集するかどうか切り替えます。
  </Collapser>

  <Collapser
    id="application-logging-forwarding-enabled"
    title="application_logging.forwarding.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントがNew Relicへの送信用にログレコードを収集するかどうかを切り替えます。
  </Collapser>

  <Collapser
    id="application-logging-forwarding-max_samples_stored"
    title="application_logging.forwarding.max_samples_stored"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            数
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `10000`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APPLICATION_LOGGING_FORWARDING_MAX_SAMPLES_STORED`
          </td>
        </tr>
      </tbody>
    </table>

    1分あたりにNew Relicに送信するログレコードの数。ログ転送を使用する場合の全体的なメモリ消費を制御します。

    これをより低い値に設定して、送信されるログラインの量を減らします（ログサンプリングの原因になる場合があります）。これをより高い値に設定すると、より多くのログラインが送信されます。

    各ログは、関連トランザクションと同じ優先度を受け取ります。トランザクション以外で発生するログは、ランダムな優先度を受け取ります。`max_samples_stored`によって制限されているため、一部のログが含まれない場合があります。たとえば、ロギング`max_samples_stored`が10,000に設定され、トランザクション1に10,000のログエントリがある場合、トランザクション1のログエントリのみが記録されます。トランザクション1のログが10,000未満の場合、トランザクション1のすべてのログを受け取ります。まだスペースがある場合は、トランザクション2のすべてのログを受け取るなどとなります。

    サンプリングされたトランザクションのすべてのログが記録された後も、 `max_samples_stored`の限度に達していない場合は、サンプリングに含まれていないトランザクションのログメッセージが送信されます。残っている場合は、トランザクション以外のログメッセージが記録されます。
  </Collapser>

  <Collapser
    id="application-logging-local_decorating-enabled"
    title="application_logging.local_decorating.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_APPLICATION_LOGGING_LOCAL_DECORATING_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    エージェントが標準ログ出力でローカルログ装飾を実行するかどうかを切り替えます。
  </Collapser>
</CollapserGroup>

## コードレベルのメトリクス [#code-level-metrics]

コードレベルのメトリクス設定には、[Node.JSエージェントのバージョン9.7.5以降](/docs/apm/agents/nodejs-agent/installation-configuration/update-nodejs-agent/)が必要です。

詳細については、[コードレベルのメトリクスのドキュメント](/docs/apm/agents/nodejs-agent/installation-configuration/codestream-integration)を参照してください。

<CollapserGroup>
  <Collapser
    id="code-level-metrics-enabled"
    title="code_level_metrics.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_CODE_LEVEL_METRICS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    [コードレベルのメトリクス](/docs/codestream/observability/code-level-metrics)の駆動に役立つ、すべてのNode.js Webフレームワークのミドルウェアスパンで追加の属性をキャプチャするかどうかを切り替えます。追加属性は、`code.filepath`、`code.function`、`code.lineno`、および`code.column`です。
  </Collapser>
</CollapserGroup>

## エラーインボックスの設定 [#errors-inbox-configuration]

次のタグのいずれかを設定すると、エラーが発生しているソフトウェアのバージョンを特定するのに役立ちます。

* `NEW_RELIC_METADATA_SERVICE_VERSION` デプロイされているコードのバージョン（多くの場合、1.2.3などのセマンティックバージョン）を含むイベントデータにtags.service.versionが作成されますが、常にそうとは限りません。
* `NEW_RELIC_METADATA_RELEASE_TAG `リリースタグを含むイベントデータにtags.releaseTagを作成します（v0.1.209またはリリース-209など）。
* `NEW_RELIC_METADATA_COMMIT` コミットSHAを含むイベントデータに対してtags.commitを作成します。SHA全体、または最初の7文字（例：734713b）のみを使用することもできます。

エラーインボックスの今後のリリースでは、ソフトウェアのどのバージョンでエラーが発生しているかを自動追跡します。どのバージョンデータも[CodeStream](/docs/codestream/how-use-codestream/performance-monitoring/#buildsha)に表示されます。

## URLの難読化 [#url-obfuscation]

URLの難読化設定には、[Node.jsエージェントのバージョン9.9.0以降](/docs/apm/agents/nodejs-agent/installation-configuration/update-nodejs-agent/)が必要です。

設定例については、[ノードエージェントURLの難読化](/docs/url-obfuscation/configure-url-obfuscation-nodejs)のドキュメントを参照してください。

<CollapserGroup>
  <Collapser
    id="url-obfuscation-enabled"
    title="url_obfuscation.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_URL_OBFUSCATION_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    正規表現ベースの[ノードエージェントURLの難読化](/docs/url-obfuscation/configure-url-obfuscation-nodejs/)を有効にします。
  </Collapser>

  <Collapser
    id="url-obfuscation-regex-pattern"
    title="url_obfuscation.regex.pattern"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列またはRegExp
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_URL_OBFUSCATION_REGEX_PATTERN`
          </td>
        </tr>
      </tbody>
    </table>

    URLの難読化に使用する正規表現パターンを指定します。これが設定されていない場合、URLの難読化は実行されません。
  </Collapser>

  <Collapser
    id="url-obfuscation-regex-flags"
    title="url_obfuscation.regex.flags"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_URL_OBFUSCATION_REGEX_FLAGS`
          </td>
        </tr>
      </tbody>
    </table>

    URLの難読化パターンマッチングに使用する正規表現フラグを指定します。グローバルマッチングの場合は`g`、大文字と小文字を区別しないマッチングの場合は`i`など。複数のフラグを文字列として指定できます。`gi`など。これが設定されていない場合、フラグは使用されません。
  </Collapser>

  <Collapser
    id="url-obfuscation-regex-replacement"
    title="url_obfuscation.regex.replacement"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_URL_OBFUSCATION_REGEX_REPLACEMENT`
          </td>
        </tr>
      </tbody>
    </table>

    URLの難読化に使用する置換文字列を指定します。パターン内のグループをキャプチャするための参照を含めることができます。`$1`など。これが設定されていない場合、すべてが1つの空の文字列に置き換えられます。
  </Collapser>
</CollapserGroup>

## Securityエージェント [#security-agent]

[New Relic Securityエージェントのインタラクティブアプリケーションセキュリティテスト](/docs/iast/introduction/)（IAST）は、脆弱なペイロードを含む生成済みHTTPリクエストを再生することで、お使いのアプリケーションに悪用できる脆弱性がないかをテストします。

<Callout variant="caution">
  実稼働ソフトウェアの脆弱性の露呈を避ける場合にのみ、非実稼働のデプロイメントでIASTを実行してください。
</Callout>

<Callout variant="important">
  セキュリティエージェントの構成設定には、[Node.jsエージェントのバージョン10.3.0以降](/docs/apm/agents/nodejs-agent/installation-configuration/update-nodejs-agent/)が必要です。
</Callout>

<CollapserGroup>
  <Collapser
    id="security-enabled"
    title="security.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    New Relic SecurityエージェントのデータをNew Relicに送信するかどうかを切り替えます。これが無効で、ssecurity.agent.enabledがtrueの場合、セキュリティエージェントは登録されますが、データは送信されません。
  </Collapser>

  <Collapser
    id="security-agent-enabled"
    title="security.agent.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_AGENT_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    New Relic Securityエージェントを読み込むかどうかを切り替えます。このプロパティは、アプリケーション起動時に1回だけ読み込まれます。
  </Collapser>

  <Collapser
    id="security-mode"
    title="security.mode"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `IAST`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_MODE`
          </td>
        </tr>
      </tbody>
    </table>

    New Relic Securityが提供するモード：IAST。デフォルトはIASTです。IASTスキャンは侵襲性であるため、実稼働環境または実稼働データが処理される環境でこのモードを有効にしないでください。
  </Collapser>

  <Collapser
    id="security-validator-url"
    title="security.validator_service_url"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `wss://csec.nr-data.net`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_VALIDATOR_SERVICE_URL`
          </td>
        </tr>
      </tbody>
    </table>

    New Relic Security接続のURL。これは、Securityエージェントがデータを送信するエンドポイントであり、Node.jsエージェント用に設定した環境と一致する必要があります。
  </Collapser>

  <Collapser
    id="security-rci-detection"
    title="security.detection.rci.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_DETECTION_RCI_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    RCIセキュリティイベント検出を有効にします。
  </Collapser>

  <Collapser
    id="security-xss-detection"
    title="security.detection.rxss.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_DETECTION_RXSS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    RXSSセキュリティイベント検出を有効にします。
  </Collapser>

  <Collapser
    id="security-deserialization-detection"
    title="security.detection.deserialization.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_SECURITY_DETECTION_DESERIALIZATION_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    逆シリアル化セキュリティイベント検出を有効にします。
  </Collapser>
</CollapserGroup>

## Heroku [#heroku]

<CollapserGroup>
  <Collapser
    id="heroku-dyno"
    title="heroku.use_dyno_names"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `true`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_HEROKU_USE_DYNO_NAMES`
          </td>
        </tr>
      </tbody>
    </table>

    trueの場合、エージェントはHeroku dyno名をホスト名として使用します。
  </Collapser>
</CollapserGroup>

## ワーカースレッド [#worker-threads]

11.0.0以前のバージョンのエージェントでは、エージェントはメインスレッドとワーカースレッドの両方で実行されていました。バージョン11.0.0では、非同期コンテキストの伝播との互換性がないため、エージェントはワーカースレッドでの実行を停止しました。ワーカースレッドで実行する機能はバージョン11.3.0で復元されましたが、`worker_threads.enabled`を`true`に設定する必要があります。ワーカースレッドでの実行動作は多様であるため、公式にはサポートされていません。メトリクスの生成や自己完結型のトランザクション追跡などの機能は動作する可能性がありますが、これは自己責任で使用してください。

<CollapserGroup>
  <Collapser
    id="worker-threads"
    title="worker_threads.enabled"
  >
    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>

        <tr>
          <th>
            [環境変数](#environment)
          </th>

          <td>
            `NEW_RELIC_WORKER_THREADS_ENABLED`
          </td>
        </tr>
      </tbody>
    </table>

    trueの場合、指定されていればエージェントはワーカースレッド内にあるときに読み込まれます。
  </Collapser>
</CollapserGroup>

## 環境変数のオーバーライド

このセクションでは、環境変数のみで利用できる2つの設定を定義します。こうしたオーバーライドは、大半の設定では使用されません。

<CollapserGroup>
  <Collapser
    id="home"
    title="NEW_RELIC_HOME"
  >
    `newrelic.js`を含むディレクトリへのパス。これは、環境変数としてのみ利用できます。ご自分の設定ファイルで設定することはできません。

    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            文字列
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            (なし)
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="no_file"
    title="NEW_RELIC_NO_CONFIG_FILE"
  >
    使用した場合、エージェントが`newrelic.js`から構成設定を読み取ることができなくなります。デフォルト値と環境変数の値は引き続き設定されます。

    これは、環境変数としてのみ利用できます。ご自分の設定ファイルで設定することはできません。

    <table>
      <tbody>
        <tr>
          <th>
            タイプ
          </th>

          <td>
            ブール値
          </td>
        </tr>

        <tr>
          <th>
            デフォルト
          </th>

          <td>
            `false`
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

## 環境変数タイプのリファレンスガイド

このセクションでは、複雑なデータ型を適切にフォーマットする方法について説明します。

<CollapserGroup>
  <Collapser
    id="array"
    title="配列"
  >
    配列タイプはコンマ区切り文字列として定義されます。

    ```ini
    NEW_RELIC_ERROR_COLLECTOR_IGNORE_ERROR_CODES=404,500,429
    ```
  </Collapser>

  <Collapser
    id="object"
    title="オブジェクト"
  >
    オブジェクトタイプはJSON文字列として定義されます。

    ```ini
    NEW_RELIC_ERROR_COLLECTOR_EXPECTED_MESSAGES='{"Error":["Undefined", "No soup for you!"]}'
    ```
  </Collapser>
</CollapserGroup>
