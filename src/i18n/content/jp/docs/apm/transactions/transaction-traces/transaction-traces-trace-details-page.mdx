---
title: トランザクションのトレースです。トレースの詳細ページ
tags:
  - APM
  - Transactions
  - Transaction traces
metaDescription: APM's Trace Details page shows additional timing details about the individual segments that make up a transaction trace.
translationType: machine
---

[APM](/docs/apm/new-relic-apm/getting-started/welcome-new-relic-apm) において、 **Trace details** タブは、 [トランザクショントレース](/docs/apm/transactions/transaction-traces/transaction-traces) における個々のセグメントのタイミングを表示します。このドキュメントでは、 **Trace details** タブのセクションと機能について説明します。

## トレース詳細ページの機能 [#options]

![トランザクショントレースの詳細画面のスクリーンショットです。](./images/trx-trace-details.png "trx-trace-details.png")

<figcaption>
  **[one.newrelic.com](https://one.newrelic.com) > APM> (select an app)> Monitor> Transactions> (select a transaction trace)> Trace details.**
</figcaption>

**Trace details** ページでは、トランザクション内のセグメントのタイミングデータを表にして表示するほか、その他の機能も紹介しています。

<table>
  <thead>
    <tr>
      <th width={200}>
        **トレースの詳細ページ**
      </th>

      <th>
        **説明**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        プライマリートレースデータ、機能
      </td>

      <td>
        各トランザクションのトレースUIページの上部には、トレース時間、応答時間、可能であればCPU情報など、いくつかの主要なデータが表示されます。また、時にはUIが [部分的なトレース](#partial) を示すこともあります。

        使用可能な機能：

        * このトレースを削除します。トレースを削除すると、そのトレースは検索できなくなります。
        * Track as [key transaction](/docs/apm/transactions/key-transactions/key-transactions-tracking-important-transactions-or-events).
      </td>
    </tr>

    <tr>
      <td>
        期間欄
      </td>

      <td>
        各セグメントおよびサブセグメントの時間は、ミリ秒単位で表示され、トランザクション時間全体に対する割合も表示されます。特に遅いセグメントは [色分けされています](#colors) 。
      </td>
    </tr>

    <tr>
      <td>
        セグメント欄
      </td>

      <td>
        **セグメント** カラムには、セグメント名とカウントが表示されます。速い通話や繰り返しの通話は、 [自動的にグループ化されることがあります。](#rollup) 。 [**アプリケーションコード**](#application-code) がセグメントやサブセグメントの名前として表示されている場合もあります。

        セグメントを拡張するには、以下のいずれかを使用します。

        * **パフォーマンスの問題を展開する** ページの上部にあるボタン
        * セグメントの横にあるドロップダウン矢印は、拡大と縮小が可能です。
      </td>
    </tr>

    <tr>
      <td>
        ドリルダウンカラム
      </td>

      <td>
        [**Drilldown** column](#drilldown) には、追加の取引データがある場合、そのデータにリンクするアイコンが表示されることがあります。
      </td>
    </tr>

    <tr>
      <td>
        タイムスタンプ欄
      </td>

      <td>
        **Timestamp** 列は、セグメントまたはサブセグメントの開始時刻を、トランザクションの開始時刻と比較して表示します。例えば、 `3.150 s` という値は、そのセグメントがトランザクションの 3.15 秒後に開始したことを示します。
      </td>
    </tr>
  </tbody>
</table>

## ドリルダウンのオプション [#drilldown]

**Drilldown** カラムでは、アイコンは追加データが利用可能であることを示しています。

<table>
  <thead>
    <tr>
      <th width={200}>
        **アイコン**
      </th>

      <th>
        **説明**
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        ![アイコンのデータベース](./images/icon-database.png "アイコンのデータベース") データベースクエリ
      </td>

      <td>
        データベース <Icon name="fe-database"/>アイコンは、そのクエリセグメントの生のデータベースクエリにリンクしています。 [トランザクショントレースの設定](/docs/features/configuring-transaction-traces) に応じて、このクエリは生データとして表示されるか、難読化されたデータとして表示されます。セグメントの合計時間が設定したクエリプランのしきい値を超えた場合は、コード内の呼び出しの正確な位置を示すスタックトレースとともに、クエリ分析も表示されます。
      </td>
    </tr>

    <tr>
      <td>
        ![アイコンの検索](./images/icon-parameters.png "アイコンの検索") Stack traces
      </td>

      <td>
        虫眼鏡 <Icon name="fe-search"/>スタックトレースの詳細へのリンクです。
      </td>
    </tr>

    <tr>
      <td>
        ![icon-web-transaction-app](./images/icon-webtx.png "icon-web-transaction-app") トランザクションの詳細を集約する
      </td>

      <td>
        このアイコンは、クロスアプリケーショントレースの詳細が利用できないことを示しています。しかし、このアイコンを選択すると、 [複数のトランザクションの呼び出しに渡って集約されたトランザクション情報](/docs/apm/applications-menu/monitoring/transactions-page) を表示することができます。
      </td>
    </tr>
  </tbody>
</table>

## トレースの詳細についてログを調べる [#logs-context]

ログとアプリケーションのデータを統合して、トラブルシューティングをより簡単かつ迅速に行うことができます。[コンテキストのログ](/docs/logs/logs-context/configure-logs-context-apm-agents/)では、エラーとトレースに関連するログメッセージをアプリケーションのUIで直接表示できます。

1. **Transactions**ページでトレースをクリックして、[**Trace details**ページ](/docs/apm/transactions/transaction-traces/transaction-traces-trace-details-page)に移動します。
2. トレースの詳細ページで、**See logs**をクリックします。
3. 各ログメッセージに関連する詳細を表示するには、メッセージを直接クリックしてください。

![APMのトレース詳細のコンテキストでのログ](./images/logs-in-context-traces.png "APMのトレース詳細のコンテキストでのログ")

<figcaption>
  ログ・イン・コンテキストでは、トレースの詳細の中でログデータを直接調べることができます。
</figcaption>

また、Kubernetesクラスタなど、[インフラストラクチャデータ](/docs/logs/forward-logs/forward-your-logs-using-infrastructure-agent/)のコンテキストでログを表示することもできます。New Relic Oneで別のUIページに切り替える必要はありません。

## セグメントデュレーションデータの色分け [#colors]

**Trace details** テーブルの **Duration** カラムは色分けされています。

![icon-alerts-red.png](./images/icon-alerts-red.png "アラートv3：アラートアイコン") 赤。全トランザクション時間の25％以上がこのセグメントに費やされた。

![icon-alerts-yellow.png](./images/icon-alerts-yellow.png "アラートv3：アラートアイコン") 黄色。全トランザクション時間の5%以上がこのセグメントに費やされた。

色分けされた持続時間は必ずしも問題を示すものではありません。そのタイミングが実際に問題であるかどうかは、あなたのアプリケーションにとって何が正常で許容範囲であるかによります。

## アプリケーションコードのトレース [#application-code]

表の中で、セグメントが **アプリケーションコード** と表示されている場合は、コードのその部分がインスツルメンテーションされていないことを示しています。 [カスタムインスツルメンテーション](/docs/apm/other-features/metrics/custom-instrumentation) を使用して、コードのその部分についての詳細を得ることができます。 **Application code** として記載されているセグメントは、 [Partial Traces](#partial) の場合が多いです。

## 部分的な痕跡 [#partial]

パフォーマンス上の理由から、APM はトランザクショントレースの最初の 2,000 セグメント（Node.js の場合は 900 セグメント）のみをキャプチャします。トランザクショントレースがこのセグメント数を超えた場合、エージェントはトランザクショントレースを切り捨て、 **Details** ページの上部にメッセージを表示します。

`これは部分的なトレースです。`

セグメントを切り詰めるタイミングについては、APMエージェントによってルールが異なります。

<table>
  <thead>
    <tr>
      <th style={{ width: "150px" }}>
        APMエージェント
      </th>

      <th>
        セグメントルールの切り捨て
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        C SDK
      </td>

      <td>
        セグメントの優先順位に基づいて切り捨てます。

        * ルートセグメントの優先順位が最も高い。

        * 配布されたトレースアクティビティが見られたセグメントは、2番目に高い優先度を持ちます。

        * 遅いセグメントは3番目に優先されます。

          詳細については、C SDKのドキュメント [`newrelic_transaction_tracer_config_t` on GitHub](https://newrelic.github.io/c-sdk/structnewrelic__transaction__tracer__config__t.html) をご覧ください。
      </td>
    </tr>

    <tr>
      <td>
        Go
      </td>

      <td>
        セグメントの継続時間は、 [`TransactionTracer.SegmentThreshold`](/docs/agents/go-agent/configuration/go-agent-configuration#txn-tracer-segment-threshold) Goセグメント設定で設定された値よりも大きくなければなりません。
      </td>
    </tr>

    <tr>
      <td>
        Java、.NET、Ruby
      </td>

      <td>
        これらのエージェントは、トレースを時系列に切り詰めます。詳細については、 [Java](/docs/agents/java-agent/configuration/java-agent-configuration-config-file#h2-transaction-segments) 、 [.NET](/docs/agents/net-agent/configuration/net-agent-configuration#transaction_tracer) 、 [Ruby](/docs/agents/ruby-agent/configuration/ruby-agent-configuration#transaction_tracer) のトランザクショントレーサーのドキュメントを参照してください。
      </td>
    </tr>

    <tr>
      <td>
        Node.js
      </td>

      <td>
        Node.jsエージェントは、トランザクション・トレースの最初の900セグメントのみをキャプチャします。詳細については、 [Node.js トランザクショントレーサの設定](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#tx_tracer_config) を参照してください。
      </td>
    </tr>

    <tr>
      <td>
        PHP
      </td>

      <td>
        セグメントの長さに基づいて切り詰めます。最も遅い 2,000 のセグメントがトレース用にキャプチャされます。詳細については、PHP トランザクショントレーサーの設定 を参照してください。
      </td>
    </tr>

    <tr>
      <td>
        Python
      </td>

      <td>
        セグメントの継続時間に基づいて切り捨てられ、最も遅い2,000セグメントがトレースに取り込まれます。詳細については、 [Python トランザクショントレーサの設定](/docs/agents/python-agent/configuration/python-agent-configuration#txn-tracer-settings) を参照してください。
      </td>
    </tr>
  </tbody>
</table>

## セグメントのグルーピングルール [#rollup]

たくさんのセグメントがあるトランザクショントレースは、解釈が難しい場合があります。New Relic では、高速なメソッドコールや繰り返されるメソッドコールを自動的に 1 つのセグメントグループにまとめることができます。

たとえば、 `7 fast method calls` というタイトルのセグメントがあるとします。これは、完了が早いことから、New Relic がこれらの呼び出しが問題になる可能性は低いと判断し、グループ化したことを意味します。このグループ化を展開すると、個々のセグメントを見ることができます。

セグメント別に分類する際のルールは以下の通りです。

* **高速コール：** New Relic が 7.5ms 以下の持続時間を持つ 4 つ以上の連続したセグメントを検出した場合、これらは 1 つの折りたたまれたヘッダーにまとめられます。
* **同一のコール：** New Relic が 4 つ以上の連続した同一のコールを検出した場合、これは通常 N+1 問題を示しています。これらのセグメントは折りたたまれています。折りたたまれたノードを展開すると、すべてのコールではなく、最初の 3 つのコールのみが表示されます。