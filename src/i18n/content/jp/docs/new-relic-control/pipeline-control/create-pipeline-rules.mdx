---
title: パイプラインルールを作成する
metaDescription: Learn how to create pipeline rules to manage the flow of data from your monitored entities to New Relic.
freshnessValidatedDate: never
translationType: machine
---

Pipelineルールには、ゲートウェイ ルールとcloudルールの 2 種類があります。 どちらも同じ方法を使用して作成されます。ゲートウェイ ルールは組織全体に適用されますが、 cloudルールはアカウント固有です。 ゲートウェイ ルールには、特に[エージェントとデータ タイプの考慮事項](/docs/new-relic-control/pipeline-control/data-dropping-gateway)に関して、特定の相違点や非互換性が存在する場合があります。

New Relic UI を介してパイプライン ルールを作成するには、ガイド付きの方法と独自の NRQL クエリを記述する方法の 2 つの方法があります。ガイド付きの方法では、ルールの構成を支援するステップバイステップのウィザードが提供され、NRQL クエリ オプションを使用すると、カスタム クエリを作成してデータを正確にフィルター処理できます。cloud経由でAPI ルールを管理することもできます。

ガイド付きメソッドを使用してルールを作成する場合、メトリクス、イベント、ログ、トレースなど、フィルターするデータの種類を指定できます。 cloudさらに、New Relic のインフラストラクチャで実行される ルールとして、または環境内で実行されるゲートウェイ ルールとして、ルールをどこにデプロイするかを決定できます。

<Callout variant="important">
  * Pipeline Controlルールは、ルールを作成した瞬間から到着するデータにのみ適用され、 [すでに取り込まれた](/docs/telemetry-data-platform/ingest-manage-data/manage-data/manage-data-retention#data-deletion)データは削除されません。
  * ゲートウェイ ルールでは、ゲートウェイのデプロイメントが必要です。
  * ルールを作成するときは、設定した条件を満たすデータをルールが正確に識別して破棄するようにする責任があります。また、ルールと New Relic に開示するデータを監視する責任も負います。
</Callout>

## ガイド付きメソッド経由 [#via-guided-method]

ガイド付きの方法でパイプライン ゲートウェイ ルールを作成するには、次の手順に従います。

1. New Relic で、New Relic Control に移動し、 **Pipeline Rules**タブを開きます。

2. **Create a rule** \[ルールの作成]をクリックします。表示されるウィザードでは、ガイド付きの方法がデフォルトで選択されています。

3. フィルタリングするデータの種類 (**Metrics** \[メトリクス]、**Events** \[イベント]、**Logs** \[ログ]、または**Traces** \[トレース] を選択し、 **Next** \[次へ]をクリックします。

4. ルール名を入力します。

5. データまたは属性を削除するかどうかを選択します。レコード全体を削除する場合は、 **Drop data** \[データを削除]を選択します。保持されているデータの特定の属性またはプロパティを削除する場合は、 **Drop attributes** \[属性を削除]を選択します。

6. ルールを New Relic のクラウドにデプロイするか、独自のネットワークでホストされているゲートウェイ クラスターにデプロイするかに応じて、**Cloud rule** \[クラウド ルール] または **Gateway rule** \[ゲートウェイ ルール] を選択します。

7. 必要に応じて、ルールのわかりやすい説明を追加します。

8. cloudルールの場合は、現在のアカウントが選択されていることを確認します。 ゲートウェイの場合、ルールは組織全体のゲートウェイを介して送信されるすべてのデータに適用されます。

9. 前に選択したテレメトリーデータのタイプに応じて、次のアクションを実行します。**メトリクスの場合:**

   * データをドロップするメトリクスを選択します。
   * NRQL `WHERE`句を使用してデータをフィルタリングし、クエリ対象データの範囲を指定します。`WHERE`句を使用すると、さまざまなデータ型にわたって条件付きフィルタリングを追加できます。
   * プロパティを削除する場合は、ドロップダウン メニューを使用してメトリクス プロパティを指定します。 **イベントの場合:**
   * データを削除するイベントを選択します。
   * NRQL `WHERE`句を使用してデータをフィルタリングし、クエリ対象データの範囲を指定します。
   * 属性をドロップする場合は、ドロップダウン メニューを使用してイベント属性を指定します。**ログの場合:**
   * データを削除するパーティションを選択します。
   * NRQL `WHERE`句を使用してデータをフィルタリングし、クエリ対象データの範囲を指定します。ログ フィルタリングの例: `level = 'INFO'`これにより、ログレベル、エラー タイプ、またはその他の関連するプロパティによるログのフィルタリングなど、特定の条件に書き込みを絞り込むことができます。
   * 属性を削除する場合は、ドロップダウン メニューを使用して属性を指定します。**トレースの場合:**
   * NRQL `WHERE`句を使用してデータをフィルタリングし、クエリ対象データの範囲を指定します。
   * 属性を削除する場合は、ドロップダウン メニューを使用して属性を指定します。

10. ルールを保存します。ルールは「デプロイ」です。

## NRQLクエリを書くことによって [#nrql-query]

Pipeline独自のNRQL クエリを記述して ルールを作成するには、次の手順に従います。

1. New Relic で、New Relic Control に移動し、 **Pipeline Rules**タブを開きます。
2. **Create a rule** \[ルールの作成]をクリックします。新しいルールの作成ウィザードが表示されます。デフォルトではガイド付きの方法が選択されます。
3. **Write a NRQL query** \[NRQL クエリの記述]を選択します。
4. ルール名を入力します。
5. データをフィルタリングするための独自の NRQL クエリを作成するには、 **Write your query** \[クエリの作成]をクリックします。下部に書き込みビルダーが開きます。
6. `SELECT`キーワードを使用してクエリを記述し、 **Run** \[実行]をクリックしてテストします。これにより、将来このルールが取り込まれたときに影響を受けるデータの例が表示されます。ただし、保存されているデータは、作成したルールの影響を受けません。
7. 満足したら、 **Save rule** \[ルールを保存]をクリックします。保存時に`SELECT`キーワードは`DELETE`キーワードに置き換えられるため、ルールによって`SELECT`を使用して参照したデータが削除されます。
8. ルールを New Relic のクラウドにデプロイするか、独自のネットワークでホストされているゲートウェイ クラスターにデプロイするかに応じて、**Cloud rule** \[クラウド ルール] または **Gateway rule** \[ゲートウェイ ルール] を選択します。
9. cloudルールの場合は、ルールを適用するアカウントも選択する必要があります。
10. **Save** \[保存]をクリックします。ルールは今やデプロイです。

パイプライン ルールでサポートされている NRQL 関数のリストについては、 [「NRQL 関数」](/docs/new-relic-control/pipeline-control/nrql-functions)を参照してください。

## 注意 [#caution]

New Relic は、この機能によってデータ漏洩に関する懸念が完全に解決されることを保証することはできません。New Relic開発したルールの有効性をレビューしたり監視したりしません。 常にクエリをテストおよび再テストし、ドロップ ルールの作成後に意図したとおりに動作することを確認してください。

センシティブなデータに関するルールを作成すると、どのような種類のデータを保持しているのか、データやシステムの形式（例えば、電子メールアドレスや特定のクレジットカード番号を参照することなど）などの情報が漏れてしまいます。作成したルールは、そのルールに含まれるすべての情報を含めて、関連するロールベースのアクセス制御権限を持つすべてのユーザーが表示および編集できます。

## 次のステップ

[ゲートウェイ クラスターにロード バランサーを実装します](/docs/new-relic-control/pipeline-control/load-balancer-for-gateway)。