---
title: ゲートウェイのサイズ設定とスケーリング ガイド
metaDescription: Learn how to allocate sufficient resources to the gateway to maintain its reliability.
freshnessValidatedDate: never
translationType: machine
---

ゲートウェイの信頼性を維持し、データ損失を防ぐために、ゲートウェイに十分なリソースを割り当てることが重要です。ゲートウェイがダウンすると、テレメトリー データが失われる危険があり、監視および分析機能に影響を与える可能性があります。

このガイドは、環境内で Pipeline Control ゲートウェイをデプロイおよび拡張するための適切なリソースを決定するのに役立ちます。最適なパフォーマンスと効率的なデータ処理を保証するには、これらの仕様を理解することが不可欠です。

## デフォルト設定

デフォルトでは、ゲートウェイは、ポッドあたり 2 GB のデフォルトのメモリ割り当てと 1 つの vCPU で構成されます。さらに、ゲートウェイ クラスターは[セットアップ時に](/docs/pipeline-control/set-up-and-deploy-pipeline-control#set-up-gateway)次の設定で初期構成されます (これらはゲートウェイの初期セットアップ後に変更できます)。

最小レプリカ数: 2 最大レプリカ数: 10 ターゲットCPU使用率: 60

## ゲートウェイのスケーリング

Pipeline Controlゲートウェイは、受信したテレメトリー データ全体を処理するのに十分な計算能力を維持する必要があります。 さまざまなエージェントやテレメトリー ワークロードの可変サイズとスループットを考慮して、必要な容量を予測するために、段階的なアプローチでゲートウェイ クラスターをスケーリングすることをお勧めします。

1. テレメトリーデータをゲートウェイに送信するために、非運用エージェントの小規模なセット (約 15 ～ 35) を構成します。 これらのエージェントが、本番環境のゲートウェイに送信する予定のエージェントおよびテレメトリー ペイロードのタイプを代表するものであることを確認してください (例: NR Infra、Java APM、Fluent Bit など)。それぞれのエージェントの数に注意してください。
2. このテレメトリーデータをNew Relicで収集していることを確認します。
3. ゲートウェイクラスタを監視して、vCPU の数と数分間の負荷にわたる平均 CPU 使用率を特定します。 これにより、このエージェント セットを実行するために必要な vCPU の数がわかります。
4. 構成したエージェントの数、ピーク本番で実行すると予想されるエージェントの数、および手順 3 の CPU 使用率に基づいて線形に推定します。たとえば、ゲートウェイ経由で 25 個のJava APMエージェントを実行していて、65% の負荷で 1 つの vCPU のみが実行されている場合、 `<=` 8 個の vCPU で 200 個のJava APMエージェントを実行できると期待できます。
5. ゲートウェイにデータを送信するエージェントのより大きなセットを構成する（例：100）を実行し、手順 4 の線形外挿が依然として当てはまることを確認します。
6. `maxReplicas`が、本番環境で実行することが予想されるエージェントの数に応じて十分なポッドをスケーリングできる大きさであることを確認します。
7. データをゲートウェイに送信するようにすべての運用エージェントとテレメトリーデータを構成したら、ゲートウェイのクラスタの監視を続けて、それらが 100% 以上の容量で動作していないかどうかを確認します。

## 性能仕様

単一の CPU コアと MELT タイプごとに 100 のドロップ ルールを備えたゲートウェイは、次のボリュームのテレメトリー データを処理できます。

<table>
  <thead>
    <tr>
      <th>
        データ型
      </th>

      <th>
        処理能力
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        指標
      </td>

      <td>
        1秒あたり7,000データポイント
      </td>
    </tr>

    <tr>
      <td>
        イベント
      </td>

      <td>
        毎秒4,500イベント
      </td>
    </tr>

    <tr>
      <td>
        ログ
      </td>

      <td>
        2,700 ログ/秒
      </td>
    </tr>

    <tr>
      <td>
        トレース
      </td>

      <td>
        1秒あたり3,300スパン
      </td>
    </tr>
  </tbody>
</table>

## エージェントの処理能力

1 つのゲートウェイ ポッドは、1 秒あたり 26 KB から 250 KB の非圧縮データのリクエスト サイズで、15 〜 35 個のエージェントを処理できます。

<img title="Agent handling capacity" alt="A diagram representing gateway pod agent handling capacity." src="/images/agent-handling-capacity.webp" />

<Callout variant="tip">これらの容量の見積もりは、既存のデプロイメントからの測定に基づいています。 実際の要件は、特定のデータ パターンと監視のニーズによって異なる場合があります。</Callout>

## ゲートウェイ設定の推奨事項

ゲートウェイのパフォーマンスと拡張性をさらに強化するには、お客様の考えに基づいて次の設定を検討してください。 これらの設定にアクセスするには、 **New Relic Control &gt; Gateway &gt; Settings**に移動します。

### 最小および最大のレプリカ

* **最小レプリカ:**定期的なデータ ロードに対応し、冗長性と信頼性を確保するためにゲートウェイ レプリカのベースライン数を設定します。これにより、データ損失を防ぎ、ピーク時のパフォーマンスの安定性を維持できます。推奨される最小値は**2**で、これがデフォルト設定でもあります。
* **最大レプリカ数:**ピーク使用期間を効果的に処理するために必要なレプリカの最大数を決定します。この設定により、ゲートウェイクラスタを動的に拡張でき、パフォーマンスを損なうことなく高トラフィックに十分なリソースを提供できます。 最大**15 個**のレプリカを設定できます。

### CPU使用率閾値

* **スケーリング値:**ゲートウェイクラスタが自動的にスケーリングする CPU 使用率のパーセンテージを指定します。 スケーリング値を構成すると、効率的なリソース管理が保証され、過密状態が防止され、安定したデータ処理が維持されます。 デフォルト設定は**60%**です。

### 健康とパフォーマンス管理

* **診断ログを収集する:**インサイトのゲートウェイ診断ログを定期的にチェックして、ゲートウェイの正常性と動作を確認します。 ログを監視することは、タイムリーなトラブルシューティングと最適なパフォーマンスの維持に不可欠です。デフォルトでは、診断ログはオフになっています。
* **ゲートウェイ ルールをバイパスする:**利用可能な CPU リソースが少ない場合は、複雑なゲートウェイ ルールをバイパスします。 この予防措置により、機密データが受信された場合でもNew Relicへのデータフローが継続され、リソースの節約と中断のないテレメトリ処理が可能になります。 デフォルトでは、ゲートウェイ ルールのバイパスはオフになっています。

## 次のステップ

次に、[エージェント設定を変更して](/docs/new-relic-control/pipeline-control/modify-agent-configuration)ゲートウェイ経由でデータを送信する方法を学びます。