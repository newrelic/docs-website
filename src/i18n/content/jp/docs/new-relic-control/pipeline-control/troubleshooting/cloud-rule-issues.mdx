---
title: トラブルPipeline Control cloudルール
metaDescription: Diagnose and resolve common issues with Pipeline Control cloud rules that drop data in New Relic infrastructure.
freshnessValidatedDate: never
translationType: machine
---

このガイドはPipeline Control cloudルールに関する一般的な問題のトラブルシューティングに役立ちます。 クラウド ルールは New Relic のインフラストラクチャで実行され、NRQL を使用して、New Relic エンドポイントに到達した後に不要なデータを削除します。

## データをドロップしないルール

### 無効なNRQL構文

**問題**: ルールに無効な NRQL 構文が含まれているため、データの処理に失敗します。

**症状**：

* ルールはUIに表示されますが、データはドロップされません
* 予想される下落メトリクスが表示されない
* ルールのステータスが非アクティブまたは失敗と表示される

**解決**：

* クエリロジックをテストするには、 `DELETE`を`SELECT`に変更してクエリビルダーでNRQL構文を検証します。

* クエリが期待通りのデータを返すことを確認してから、元に戻してください。 `DELETE`

* 一般的な NRQL 構文エラーを確認します。

  * `WHERE`節が欠落しているか正しくありません
  * 無効な属性名またはデータ型
  * 誤った比較演算子

* 構文ガイダンスについては[NRQLドキュメント](/docs/nrql/get-started/introduction-nrql-new-relics-query-language/)を参照してください

* ルールを編集して構文エラーを修正し、保存します

### ルールが期待されるデータと一致しない

**問題**: NRQL クエリは構文的には正しいですが、削除する予定のデータと一致しません。

**症状**：

* ルールはアクティブですが、メトリクスをドロップするとボリュームがゼロまたは少ないことが表示されます
* 削除されるはずのデータがNew Relicにまだ表示される
* クエリはテストしても結果を返しません `SELECT`

**解決**：

* `DELETE`の代わりに`SELECT`を使用してルールをテストし、どのデータが一致するかを確認します

* 属性名が実際のデータと一致していることを確認します。

  * 属性のスペルと大文字小文字の区別をチェックする
  * データ エクスプローラーを使用して、テレメトリー内の実際のプロパティ名を検査します。

* データ型の一致を確認する（文字列と数値の比較）

* 時間範囲をチェックする - 選択した時間枠内にデータが存在することを確認する

* `FROM`句が正しいデータ型 (ログ、メトリクス、スパン、瞬間) であることを確認してください。

* データをより正確に一致させるために、 `WHERE`条件を調整してください

### 間違ったアカウントへのルール デプロイ

**問題**: ルールはアクティブですが、意図したものとは異なるアカウントでデータを処理しています。

**症状**：

* UI にルールは存在しますが、期待されるデータがまだ表示されます
* 表示しているアカウントにドロップ メトリクスが表示されない
* ルールがどのアカウントに影響するかについての混乱

**解決**：

* Pipeline Control UIのアカウントセレクターを確認してください
* cloudルールは**アカウント固有で**あることに留意してください (組織全体のゲートウェイ ルールとは異なります)
* ルールがデプロイである同じアカウントを表示していることを確認してください
* 正しいアカウントのルールリストをチェックして、そこにルールが存在することを確認してください。
* 必要に応じて、対象のアカウントでルールを再作成します。

## ルールの作成と編集に関する問題

### ルールを作成または編集できません

**問題**: cloudルールを作成または変更する権限がありません。

**症状**：

* 作成/編集ボタンが無効になっているか、表示されません
* 権限不足に関するエラーメッセージ
* 変更は保存されません

**解決**：

* Pipeline Control cloudルールに必要な役割と権限があることを確認します
* アカウントのアドミニストレーターに連絡して、適切な権限を付与してください
* 必要な権限については[ユーザー権限のドキュメント](/docs/accounts/accounts-billing/new-relic-one-user-management/user-permissions/)を参照してください
* 適切なアクセス権を持つ正しいアカウントであることを確認してください

### ルールの変更は表示されない

**問題**: ルールを作成または編集しましたが、ルール リストに変更が表示されません。

**症状**：

* 変更を加えたが、UIに表示されない
* ルールリストに古いバージョンが表示されます
* 変化は消えてしまったようだ

**解決**：

* Pipeline Control UIページを更新する
* ルールを保存したことを確認します（保存すると変更がすぐに適用されます）
* ルールが有効になっていることを確認します（ルールは削除せずに無効にすることができます）
* アカウントセレクターで正しいアカウントが表示されていることを確認してください
* 変更は数秒以内に反映されます。更新しても表示されない場合は、ルールを再度編集してみてください。

## 監視とメトリクスの問題

### 欠落したドロップ メトリクス

**問題**: ルールはアクティブですが、ドロップされたデータに関するメトリクスが表示されません。

**症状**：

* ルールはUIにアクティブとして表示されます
* ダッシュボードにドロップボリュームメトリクスが表示されない
* ルールが機能しているかどうかを確認できません

**解決**：

* ルールのデプロイメントの後にメトリクスが表示されるまで数分待ちます
* ルールが実際に一致し、データがドロップされているかテストして確認します。 `SELECT`
* 正しいアカウントを確認してください - メトリクスをドロップすると、ルールと同じアカウントに表示されます
* NRQLを使用してメトリクスを直接ドロップする場合の書き込み:
  ```sql
  FROM NrIntegrationError SELECT count(*) WHERE newRelicFeature = 'pipeline_control'
  ```
* ルールがデータと一致しない場合は、 [「ルールが期待データと一致しない」](#rule-not-matching-expected-data)を参照してください。

### 予期せぬコストの影響

**問題**: クラウド ルールのコストが予想よりも高くなります。

**症状**：

* 高いBSE（スキャンされたイベントが数十億件）数
* コストが予想されるドロップ量と一致しない
* 計量効率に関する懸念

**解決**：

* ルールの`WHERE`句を確認してください - 条件が広いほど、より多くのイベントがスキャンされます

* 検査対象となるBSEを減らすために、より選択的な条件の使用を検討する

* BSEは通常、GBのドロップよりもはるかに低いコストを占めることを覚えておいてください。

* 大量のデータ ソースの場合は、代わりに[ゲートウェイ ルールの](/docs/new-relic-control/pipeline-control/gateway/overview)使用を検討してください。

  * New Relicに到達する前にデータを処理する
  * 落下量に関係なく流入量に基づいて課金
  * 大規模フィルタリングではコスト効率が高い可能性がある

* 計測モデルの詳細については[コストに関するドキュメント](/docs/new-relic-control/pipeline-control/costs)を確認してください

## データの動作の問題

### ルールデプロイ後もデータが表示される

**問題**: ドロップ ルールをデプロイしましたが、New Relic にデータがまだ表示されます。

**症状**：

* 特定のデータを対象とした`DELETE`ルールを作成しました
* ルールはアクティブとして表示されます
* ダッシュボードとクエリには期待どおりのデータが引き続き表示されます

**解決**：

* ルールが`DELETE`を使用していることを確認してください `SELECT`

* ルールが**有効になって**いることを確認します（無効なルールではデータは処理されません）

* `SELECT`でルールをテストし、期待されるデータと一致することを確認します

* ルールの`WHERE`条件が実際にデータと一致していることを確認してください

* cloudルールは**、デプロイメント後に到着する新しいデータに**のみ影響することに注意してください

  * NRDBにすでに存在する履歴データは影響を受けません
  * ルールの有効化前に送信されたデータは残ります

* ルールは保存後数秒以内に有効になります。データがまだ表示される場合は、ルールが正しく一致していない可能性があります。

* ルール デプロイメントより前のデータではなく、最近のデータを参照していることを確認してください。

* ルールがデプロイである正しいアカウントを確認してください

### ルールによりデータが多すぎる

**問題**: ルールによって意図したよりも多くのデータがドロップされます。

**症状**：

* New Relic から期待されるデータが欠落しています
* ドロップメトリクスは予想を上回る量を示す
* Dashboardsまたはアラートのデータが欠落している

**解決**：

* ルールの`WHERE`句を注意深く確認してください

* `SELECT`でルールをテストして、正確に一致するものを確認します

* 過度に広範囲な条件がないか確認します。

  * `LIKE '%value%'`を使用すると、意図したよりも多くの一致が見つかる可能性があります
  * 範囲を狭める条件が欠けている
  * ブール論理が正しくありません (`AND`と`OR`)

* ルールを編集してより具体的な条件を追加します

* 1つの広いルールではなく、複数の狭いルールを作成することを検討してください

* 変更後にメトリクスをドロップして正しい動作を確認するモニター

## 次のステップ

このトラブルシューティング ガイドに従っても問題が解決しない場合は、次の手順を実行します。

* [cloudルールのドキュメント](/docs/new-relic-control/pipeline-control/cloud-rules/create-pipeline-rules)を参照してルール設定を確認してください
* クエリ構文のガイダンスについては[NRQLドキュメント](/docs/nrql/get-started/introduction-nrql-new-relics-query-language/)を確認してください。
* デプロイの前に、書き込みビルダーを使用してルールの`SELECT`バージョンをテストします
* cloudルールの計測を理解するために[コストのドキュメント](/docs/new-relic-control/pipeline-control/costs)を確認する
* ルール定義とアカウント情報をNew Relicサポートにご連絡ください。