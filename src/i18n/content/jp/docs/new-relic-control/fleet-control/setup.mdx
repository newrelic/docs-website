---
title: Fleet Controlを設定する
metaDescription: Learn how to set up and manage fleets.
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy)に従ってプレビュー プログラムの一部として提供されています。
</Callout>

艦隊は次の 2 つの主要コンポーネントで構成されます。

* エージェント設定
* 管理対象エンティティ（クラスター）

艦隊を機能させるには、これら両方を Fleet Control で設定する必要があります。このセクションでは、フリートの設定と管理に関するガイダンスを提供します。まず構成を設定し、次にフリートを作成してクラスターを追加し、最後にデプロイメントを実行します。

## エージェント設定の作成

エージェント設定は、どのデータがNew Relicに取り込まれるかを決定し、エージェントの特定のバージョンが含まれます。 以前は、 Helmチャートを使用してデプロイメントを管理する場合でも、数百のエージェントを更新するには、これらの設定を変更するために大規模なスクリプトを実行する必要がありました。

Fleet Controlを使用すると、複数のエージェントに同時に適用できる単一の設定を作成できます。 これにより、既存の Helm チャート インフラストラクチャを活用してプロセスが合理化され、大規模なスクリプトを必要とせずに、必要なすべてのエージェントにわたって効率的かつ一貫した更新が可能になります。

Fleet Control経由でエージェント設定を作成するには、次の手順に従います。

1. New Relicで、 **New Relic Control → Configurations**に移動し、 **Create a new configuration**をクリックします。 ここで、選択したエージェントに必要な特定の設定を作成できます。
2. 環境として**Kubernetes**を選択します。
3. エージェントのタイプ ( **New Relic Infrastructure** 、 **New Relic OpenTelemetry Collector** 、 **Fluent Bit** 、または**New Relic Prometheus Agent**) を選択します。
4. 設定に名前を付けます。
5. 次に**Continue** \[続行]をクリックします。<br />設定を設定できる場所に移動します。画面の右半分にテンプレートが表示されます。このテンプレートは、 New Relic選択したエージェント タイプに使用することを推奨するデフォルトの設定です。 このテンプレートは、特定のニーズに合わせてカスタマイズできます。
6. 設定を保存します。
7. 同様に、クラスタの一部であるエージェント タイプごとに設定を作成します。

## 設定バージョンを作成する

設定を作成した後、この設定の新しいバージョンを作成して更新できます。 設定をフリートに割り当てるときに、これらのバージョンから選択できます。

新しいバージョンを作成するには、設定を選択し、 **Create config version** \[設定バージョンの作成]をクリックします。 これにより、設定の新しいバージョンが作成され、フリート内で更新できるようになります。

バージョン管理は、艦隊の状態を保護する上で重要な役割を果たします。

<Callout variant="important">
  フリートを新しい設定バージョンに更新するには、フリートは自動的に新しいバージョンに更新されないため、手動で選択する必要があります。
</Callout>

## 艦隊を作成する

Agent Controlがインストールされ、設定が定義されたら、フリートを作成してデプロイする準備が整いました。

フリートを作成してデプロイするには、次の手順に従います。

1. New Relic で、 **New Relic Control → Fleets**に移動し、 **Create a fleet**をクリックします。
2. フリートに名前を付け、フリートの種類を選択し、そのフリートのアクセス管理を設定します。

<Callout variant="important">
  パブリック プレビューのフリート タイプとしては**Kubernetes**のみがサポートされます。
</Callout>

## 開始

フリートを作成したら、 **Start a deployment** \[デプロイメントの開始]をクリックしてフリートの編集を開始します。

右からスライドするパネルで次の操作を行います。

1. デプロイメントに名前を付け、説明を入力します。
2. 次に、「設定を追加」をクリックして**Add a configuration** \[設定を追加します]。
3. 次に、**Add managed entities** \[管理対象エンティティの追加]をクリックしてクラスタを追加します。<br /> Agent Controlがインストールされ、別のフリートにまだ割り当てられていないクラスタのみが表示されます。
4. **Save draft** \[下書きの保存]をクリックし、 **Start deployment** \[デプロイメントの開始] をクリックします。

<Callout variant="important">
  フリートに追加できる設定は、エージェント タイプごとに 1 つだけです。 同じエージェントタイプの複数の設定（たとえば、 Kubernetesインフラストラクチャエージェントの異なる設定）はサポートされていません。 インフラストラクチャまたは NRDOT 設定のいずれかが各フリートに存在する必要がありますが、両方を同じフリートに同時に存在することはできません。 また、 Fluent Bit設定にはインフラストラクチャまたは OTel 設定が必要であることにも注意してください。
</Callout>

## ドラフト

デプロイメント名を追加したり、設定を追加したり、管理対象エンティティを追加したりすると、デプロイメントの下書きを保存できるようになります。 現在の画面から移動する場合は、必ず下書きを保存してください。デプロイメントを開始する前に下書きを保存する必要があることに注意してください。

ドラフトに戻るには、 **New Relic Control → Fleets**に移動し、**Deployments**タブをクリックします。

## カナリア

構成とクラスターを追加したら、デプロイ前に追加の安全策としてカナリアを設定できます。

これを行うには、canary クラスタとして指定するクラスタの横にある 3 つのドットをクリックします。 これらのクラスタは最初にデプロイメントされ、非カナリアクラスタへのデプロイメントは最初のデプロイメントが成功した場合にのみ続行されます。 いずれかのカナリアデプロイメントが失敗すると、プロセスは停止します。

この予防策により、すべてのクラスタにデプロイする前に、選択したいくつかのクラスタでフリートのセットアップをテストすることができます。

## を始める

準備ができたら、 **Start deployment** \[デプロイメントの開始]をクリックします。デプロイメントの**In progress** \[進行中]画面が表示されます。

「進行中」画面には、デプロイメントから設定を受信しているすべてのクラスタ、デプロイメントに含まれるクラスタとエージェントの数、およびデプロイメントの失敗が表示されます。

<Callout variant="important">
  フリート内のすべての設定は、その中のすべてのクラスタに適用されます。 したがって、フリート内のクラスタはすべて同じ設定を共有するため、均一である必要があります。
</Callout>

<img title="Configuration for clusters" alt="Screenshot of a fleet configuration for a Kubernetes cluster." src="/images/fleet-control-config-cluster.webp" />

## 追加のデプロイメント要素

* **継続:**最初のデプロイメントが成功した後、デプロイメント プロセスはフリート内の残りのクラスタに継続されます。
* **失敗の処理:**後続のクラスタ デプロイメントが失敗した場合、プロセスはクラスタの残りの部分で続行されます。 最初のリングのクラスタはすでに設定を検証しており、デプロイメントを後続のリングに進めることができます。

デプロイメントが完了すると、フリートが正式にセットアップされます。