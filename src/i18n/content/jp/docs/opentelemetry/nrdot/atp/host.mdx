---
title: ホストのATPを構成する
metaDescription: Step-by-step guide to install and configure the Adaptive Telemetry Processor (ATP) with NRDOT Collector Host distribution.
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Configuration
  - Setup
  - Installation
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/)に従ってプレビューの一部として提供されています。
</Callout>

NRDOT Collectorを使用して Adaptive telemory Processor (ATP) をインストールおよび構成する方法を学習します。 ATP は標準の NRDOT ディストリビューションに含まれており、重要な可視性を維持しながらテレメトリー データの量を削減します。

## インストールオプション [#installation-options]

現在のセットアップに適合する導入アプローチを選択してください。

<Tabs>
  <TabsBar>
    <TabsBarItem id="new">新しいインスト</TabsBarItem><TabsBarItem id="upgrade">レーション NRDOT からのアップグレード</TabsBarItem><TabsBarItem id="native">ネイティブエージェントからの移行</TabsBarItem>
  </TabsBar>

  <TabsPages>
    <TabsPageItem id="new">
      <Steps>
        <Step>
          ### あなたが始める前に [#prereq]

          以下のものを用意してください:

          * あなたのNew Relicライセンスキー
          * root または sudo 権限。
          * GitHub リリースへのネットワーク アクセス
        </Step>

        <Step>
          ### NRDOT コレクター ホストをインストールする [#install-nrdot]

          ATP は、NRDOT コレクター ディストリビューションにあらかじめパッケージ化されています。OS に基づいて、インストール方法を選択します。

          <CollapserGroup>
            <Collapser id="deb" title="Debian/Ubuntuの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="amd64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT パッケージをダウンロードします。

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
                   --location \
                   --output collector.deb
                 ```

              3. ダウンロードしたパッケージをインストールします。

                 ```bash
                 sudo dpkg -i collector.deb
                 ```

              4. 定義された環境変数を使用するように NRDOT コレクターを構成します。

                 ```bash
                 echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
                 ```

              5. NRDOT コレクター サービスを開始します。

                 ```bash
                 sudo systemctl reload-or-restart "${collector_distro}.service"
                 ```
            </Collapser>

            <Collapser id="rhel" title="RHEL/CentOSの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="x86_64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT パッケージをダウンロードします。

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
                   --location \
                   --output collector.rpm
                 ```

              3. ダウンロードしたパッケージをインストールします。

                 ```bash
                 sudo rpm -i collector.rpm
                 ```

              4. 定義された環境変数を使用するように NRDOT コレクターを構成します。

                 ```bash
                 echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
                 ```

              5. NRDOT コレクター サービスを開始します。

                 ```bash
                 sudo systemctl reload-or-restart "${collector_distro}.service"
                 ```
            </Collapser>

            <Collapser id="binary" title="手動バイナリの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="amd64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT コレクターをダウンロードしてください:

                 ```bash
                 # Download the tarball
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.tar.gz" \
                   --location \
                   --output collector.tar.gz
                 ```

              3. NRDOT コレクターを抽出します。

                 ```bash
                 # Extract contents
                 tar -xzf collector.tar.gz
                 ```

              4. コレクターを実行します。

                 ```bash
                 # Run collector in foreground
                 NEW_RELIC_LICENSE_KEY="${license_key}" ./nrdot-collector --config ./config.yaml
                 ```
            </Collapser>
          </CollapserGroup>
        </Step>

        <Step>
          ### ATPを構成する [#configure-atp]

          NRDOT コレクターをインストールしたら、コレクターの設定ファイルを編集して ATP を有効にしてカスタマイズします。 設定ファイルのパスは導入方法によって異なります。

          * DEB/RPM インストールの場合、構成ファイルは`/etc/nrdot-collector/config.yaml`にあります。
          * 手動バイナリ インストレーションの場合、設定ファイルは抽出されたフォルダー内にあります。

          設定ファイルを編集するには:

          1. 設定ファイル (`config.yaml`) をテキスト エディターで開きます。

             * DEB/RPM インストレーションの場合:

             ```bash
             sudo nano /etc/nrdot-collector/config.yaml
             ```

             * 手動バイナリインストールの場合:

             ```bash
             nano config.yaml
             ```

          2. プロセス メトリクスを収集するには、 `hostmetrics`レシーバーの`scrapers`セクションに次の`process`設定を追加します。

             ```yaml
             receivers:
               hostmetrics:
                 scrapers:
                   # Your existing scrapers...
                   process:
                     metrics:
                       process.cpu.utilization:
                         enabled: true
                       process.memory.utilization:
                         enabled: true
                     mute_process_name_error: true
                     mute_process_exe_error: true
                     mute_process_io_error: true
                     mute_process_user_error: true
             ```

          3. ATP を有効にするには、既存の`processors`セクションを見つけて、その下に`adaptivetelemetry`設定を追加します。

             ```yaml
             processors:
               adaptivetelemetry:
                 enable_storage: true
                 retention_minutes: 30
                 include_process_list:
                   - "/usr/bin/postgres"
                   - "/usr/sbin/nginx" # Replace with your target processes
                 metric_thresholds:
                   process.cpu.utilization: 0.05     # 5% CPU
                   process.memory.utilization: 0.05  # 5% memory
             ```

          4. ATP プロセッサをメトリクス パイプラインの`service`セクションに追加します。

             ```yaml
             service:
               pipelines:
                 metrics/host:
                   receivers: [hostmetrics]
                   processors:
                     - memory_limiter
                     - adaptivetelemetry  # ADD THIS LINE
                     - metricstransform
                     - filter/exclude_cpu_utilization
                     - filter/exclude_memory_utilization
             ```

          5. *(オプション)*必要に応じて、メトリクス閾値などの ATP 設定を更新します。 設定オプションの詳細については、 [「設定」を](#config-parameters)参照してください。

          6. 設定ファイルを保存します。

          7. 変更を適用するには、NRDOT コレクターを再起動します。

          ```bash
          sudo systemctl restart nrdot-collector
          ```
        </Step>

        <Step>
          ### New RelicでATPデータにアクセスする [#access-data]

          ATP が設定されると、Linux ホストからのデータの収集が開始されます。このデータには New Relic OpenTelemetry UI からアクセスできます。New Relic OpenTelemetry UI の詳細については、 [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui)を参照してください。

          **New Relicで ATP プロセスのメトリクス データを表示するには:**

          1. **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**へ移動します。

             また

             <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>に移動します。

          2. ATP を使用して NRDOT コレクターをインストールしたエンティティを検索します。

          3. エンティティを選択し、左側のペインで**<DNT>Process</DNT>**をクリックします。

             <DNT>Process</DNT>ページでは、ホスト上で実行されているすべてのプロセスと、その ID、CPU およびメモリ使用率のメトリクスを表示できます。 また、プロセスが他のプロセスを生成する場合、プロセス間の親子関係も表示されます。

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>

      /* ### ATP を設定する [#atp-configuration] ATP プロセッサの設定を `config.yaml` に追加するファイル。完全な設定例は次のとおりです: ```yaml processors: adaptivetelemetry: enable_storage: true retention_minutes: 30 include_process_list: - &quot;stress-ng&quot; metric_thresholds: process.cpu.utilization:0.05 プロセス.メモリ.使用率:0.05 プロセス.メモリ.仮想:20971520 # 20 MB プロセス.スレッド:16 個のプロセス.open_file_descriptors:30 プロセス.ディスク.io:204800 # 200KB プロセス.ディスク.操作:300 プロセス.コンテキストスイッチ:8 プロセス ページング エラー:50 プロセス.CPU.時間:0.01 # インテリジェンスレイヤーを有効にする enable_dynamic_thresholds: true dynamic_smoothing_factor: 0.1 min_thresholds: process.cpu.utilization:0.0005 プロセスメモリ使用率:0.0005 最大しきい値: プロセス.CPU.使用率:0.30 プロセス.メモリ.使用率:0.30 # マルチメトリック複合スコアリング enable_multi_metric: true composite_threshold: 1.5 weights: process.cpu.utilization: 0.5 プロセス.メモリ.使用率:0.5 # 異常検出 enable_anomaly_detection: true anomaly_history_size: 15 anomaly_change_threshold: 50.0 anomaly_min_data_points: 3 service: pipelines: メトリクス: receivers: [hostmetrics] processors: [adaptivetelemetry, batch] exporters: [otlp] ``` */
    </TabsPageItem>

    <TabsPageItem id="upgrade">
      <Steps>
        <Step>
          ### あなたが始める前に [#upgrade-prereq]

          以下のものを用意してください:

          * 既存の NRDOT Collectorバージョン`1.11.0`以降
          * あなたのNew Relicライセンスキー
          * ルート権限またはsudo権限
          * 現在の設定のバックアップ
        </Step>

        <Step>
          ### 現在の設定をバックアップ [#backup-config]

          続行する前に、現在の設定を保護してください。

          ```bash
          sudo cp /etc/nrdot-collector/config.yaml /etc/nrdot-collector/config.yaml.bak
          ```
        </Step>

        <Step>
          ### NRDOT コレクターのアップグレード [#upgrade-collector]

          NRDOT コレクターを ATP サポートを備えた最新バージョンに更新するには、最新バージョンのインストレーション コマンドを再実行します。 これにより、既存の設定ファイルを保持しながら古いバイナリが上書きされます。

          <CollapserGroup>
            <Collapser id="upgrade-deb" title="Debian/Ubuntuの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="amd64"  # Use 'arm64' for ARM processors
                 ```

              2. NRDOT コレクターの最新バージョンをダウンロードしてください:

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
                   --location \
                   --output collector.deb
                 ```

              3. ダウンロードした NRDOT コレクター パッケージをインストールします。

                 ```bash
                 sudo dpkg -i collector.deb
                 ```
            </Collapser>

            <Collapser id="upgrade-rpm" title="RHEL/CentOSの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>"
                 export collector_arch="x86_64"  # Use 'arm64' for ARM processors
                 ```

              2. NRDOT コレクターの最新バージョンをダウンロードしてください:

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
                   --location \
                   --output collector.rpm
                 ```

              3. ダウンロードした NRDOT コレクター パッケージをインストールします。

                 ```bash
                 sudo rpm -U collector.rpm
                 ```
            </Collapser>

            <Collapser id="upgrade-manual" title="手動バイナリの場合">
              1. 実行中のコレクターを停止し、設定をバックアップします。

                 ```bash
                 pkill -f nrdot-collector
                 cp config.yaml config.yaml.bak
                 ```

              2. **New Installation**タブ→ **For manual binary** セクションのインストレーション手順に従って、残りの手順を完了します。

                 <Callout variant="caution">
                   これにより、現在のconfig.yamlが上書きされます。そのため、ステップ 1 のバックアップが必要でした。
                 </Callout>
            </Collapser>
          </CollapserGroup>
        </Step>

        <Step>
          ### ATPを構成する [#configure-atp-upgrade]

          アップグレードでは以前の設定が保持されるため、 `config.yaml`にはまだ新しい ATP 設定が含まれていません。手動で追加する必要があります。

          設定ファイルを編集するには:

          1. root または sudo 権限を使用して、テキスト エディターで設定ファイル (`config.yaml`) を開きます。

             * DEB/RPM インストレーションの場合:

             ```bash
             sudo nano /etc/nrdot-collector/config.yaml
             ```

             * 手動バイナリインストールの場合:

             ```bash
             nano config.yaml
             ```

          2. プロセス メトリクスを収集するには、 `hostmetrics`レシーバーの`scrapers`セクションに次の`process`設定を追加します。

             ```yaml
             processes:
             process:
               metrics:
                 process.cpu.utilization:
                   enabled: true
                 process.memory.utilization:
                   enabled: true
               mute_process_name_error: true
               mute_process_exe_error: true
               mute_process_io_error: true
               mute_process_user_error: true
             ```

          3. ATP を有効にするには、既存の`processors`セクションを見つけて、その下に`adaptivetelemetry`設定を追加します。

             ```yaml
             processors:
               # Your existing processors...
               adaptivetelemetry:
                 enable_storage: true
                 retention_minutes: 30
                 include_process_list:
                   - "/usr/bin/postgres"
                   - "/usr/sbin/nginx" # Replace with your target processes
                 metric_thresholds:
                   process.cpu.utilization: 0.05     # 5% CPU
                   process.memory.utilization: 0.05  # 5% memory
             ```

          4. ATP プロセッサをメトリクス パイプラインの`service`セクションに追加します。

             ```yaml
             service:
               pipelines:
                 metrics/host:
                   receivers: [hostmetrics]
                   processors:
                     - memory_limiter
                     - adaptivetelemetry  # ADD THIS LINE
                     - metricstransform
                     - filter/exclude_cpu_utilization
                     - filter/exclude_memory_utilization
             ```

          5. *(オプション)*必要に応じて、メトリクス閾値などの ATP 設定を更新します。 設定オプションの詳細については、 [「設定」を](#config-parameters)参照してください。

          6. 設定ファイルを保存します。

          7. 変更を適用するには、NRDOT コレクターを再起動します。

             ```bash
             sudo systemctl restart nrdot-collector
             ```
        </Step>

        <Step>
          ### New RelicでATPデータにアクセスする [#access-data]

          ATP が設定されると、Linux ホストからのデータの収集が開始されます。このデータには New Relic OpenTelemetry UI からアクセスできます。New Relic OpenTelemetry UI の詳細については、 [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui)を参照してください。

          **New Relicで ATP プロセスのメトリクス データを表示するには:**

          1. **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**へ移動します。

             また

             <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>に移動します。

          2. ATP を使用して NRDOT コレクターをインストールしたエンティティを検索します。

          3. エンティティを選択し、左側のペインで**<DNT>Process</DNT>**をクリックします。

             <DNT>Process</DNT>ページでは、ホスト上で実行されているすべてのプロセスと、その ID、CPU およびメモリ使用率のメトリクスを表示できます。 また、プロセスが他のプロセスを生成する場合、プロセス間の親子関係も表示されます。

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>

    <TabsPageItem id="native">
      New Relicネイティブ インフラストラクチャ エージェントから NRDOT コレクター ホスト ディストリビューションに移行して ATP をインストールするには、ネイティブ エージェントをアンインストールし、ATP を使用して NRDOT をセットアップする必要があります。

      <Steps>
        <Step>
          ### あなたが始める前に [#prereq-native]

          以下のものを用意してください:

          * あなたのNew Relicライセンスキー
          * ルート権限またはsudo権限
          * サービスの中断を最小限に抑える計画
        </Step>

        <Step>
          ### ネイティブエージェントを停止して無効にする [#stop-native-agent]

          1. データの競合を防ぐために既存のインフラストラクチャエージェントを停止するには、次のコマンドを実行します。

             ```bash
             # Stop the service
             sudo systemctl stop newrelic-infra
             ```

          2. 起動時にインフラストラクチャエージェントが起動しないようにするには、次のコマンドを実行します。

             ```bash
             # Disable from starting on boot
             sudo systemctl disable newrelic-infra
             ```
        </Step>

        <Step>
          ### NRDOT コレクター ホストをインストールする [#install-nrdot-native]

          ATP は、NRDOT コレクター ディストリビューションにあらかじめパッケージ化されています。OS に基づいて、インストール方法を選択します。

          <CollapserGroup>
            <Collapser id="deb-native" title="Debian/Ubuntuの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="amd64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT パッケージをダウンロードします。

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.deb" \
                   --location \
                   --output collector.deb
                 ```

              3. ダウンロードしたパッケージをインストールします。

                 ```bash
                 sudo dpkg -i collector.deb
                 ```

              4. 定義された環境変数を使用するように NRDOT コレクターを構成します。

                 ```bash
                 echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
                 ```

              5. NRDOT コレクター サービスを開始します。

                 ```bash
                 sudo systemctl reload-or-restart "${collector_distro}.service"
                 ```
            </Collapser>

            <Collapser id="rhel-native" title="RHEL/CentOSの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="x86_64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT パッケージをダウンロードします。

                 ```bash
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.rpm" \
                   --location \
                   --output collector.rpm
                 ```

              3. ダウンロードしたパッケージをインストールします。

                 ```bash
                 sudo rpm -i collector.rpm
                 ```

              4. 定義された環境変数を使用するように NRDOT コレクターを構成します。

                 ```bash
                 echo "NEW_RELIC_LICENSE_KEY=${license_key}" | sudo tee -a /etc/${collector_distro}/${collector_distro}.conf > /dev/null
                 ```

              5. NRDOT コレクター サービスを開始します。

                 ```bash
                 sudo systemctl reload-or-restart "${collector_distro}.service"
                 ```
            </Collapser>

            <Collapser id="binary-native" title="手動バイナリの場合">
              1. 環境変数を設定します。

                 ```bash
                 export collector_distro="nrdot-collector"
                 export collector_version="<NRDOT_COLLECTOR_LATEST_VERSION>" #Fetch the latest version from GitHub releases available at https://github.com/newrelic/nrdot-collector-releases/releases
                 export collector_arch="amd64"  # Use 'arm64' for ARM processors
                 export license_key="<YOUR_NEW_RELIC_LICENSE_KEY>"
                 ```

              2. NRDOT コレクターをダウンロードしてください:

                 ```bash
                 # Download the tarball
                 curl "https://github.com/newrelic/nrdot-collector-releases/releases/download/${collector_version}/${collector_distro}_${collector_version}_linux_${collector_arch}.tar.gz" \
                   --location \
                   --output collector.tar.gz
                 ```

              3. NRDOT コレクターを抽出します。

                 ```bash
                 # Extract contents
                 tar -xzf collector.tar.gz
                 ```

              4. コレクターを実行します。

                 ```bash
                 # Run collector in foreground
                 NEW_RELIC_LICENSE_KEY="${license_key}" ./nrdot-collector --config ./config.yaml
                 ```
            </Collapser>
          </CollapserGroup>
        </Step>

        <Step>
          ### ATPを構成する [#configure-atp-native]

          NRDOT コレクターをインストールしたら、コレクターの設定ファイルを編集して ATP を有効にしてカスタマイズします。 設定ファイルのパスは導入方法によって異なります。

          * DEB/RPM インストールの場合、構成ファイルは`/etc/nrdot-collector/config.yaml`にあります。
          * 手動バイナリ インストレーションの場合、設定ファイルは抽出されたフォルダー内にあります。

          設定ファイルを編集するには:

          1. 設定ファイル (`config.yaml`) をテキスト エディターで開きます。

             * DEB/RPM インストレーションの場合:

             ```bash
             sudo nano /etc/nrdot-collector/config.yaml
             ```

             * 手動バイナリインストールの場合:

             ```bash
             nano config.yaml
             ```

          2. プロセス メトリクスを収集するには、 `hostmetrics`レシーバーの`scrapers`セクションに次の`process`設定を追加します。

             ```yaml
             receivers:
               hostmetrics:
                 scrapers:
                   # Your existing scrapers...
                   process:
                     metrics:
                       process.cpu.utilization:
                         enabled: true
                       process.memory.utilization:
                         enabled: true
                     mute_process_name_error: true
                     mute_process_exe_error: true
                     mute_process_io_error: true
                     mute_process_user_error: true
             ```

          3. ATP を有効にするには、既存の`processors`セクションを見つけて、その下に`adaptivetelemetry`設定を追加します。

             ```yaml
             processors:
               adaptivetelemetry:
                 enable_storage: true
                 retention_minutes: 30
                 include_process_list:
                   - "/usr/bin/postgres"
                   - "/usr/sbin/nginx" # Replace with your target processes
                 metric_thresholds:
                   process.cpu.utilization: 0.05     # 5% CPU
                   process.memory.utilization: 0.05  # 5% memory
             ```

          4. ATP プロセッサをメトリクス パイプラインの`service`セクションに追加します。

             ```yaml
             service:
               pipelines:
                 metrics/host:
                   receivers: [hostmetrics]
                   processors:
                     - memory_limiter
                     - adaptivetelemetry  # ADD THIS LINE
                     - metricstransform
                     - filter/exclude_cpu_utilization
                     - filter/exclude_memory_utilization
             ```

          5. *(オプション)*必要に応じて、メトリクス閾値などの ATP 設定を更新します。 設定オプションの詳細については、 [「設定」を](#config-parameters)参照してください。

          6. 設定ファイルを保存します。

          7. 変更を適用するには、NRDOT コレクターを再起動します。

          ```bash
          sudo systemctl restart nrdot-collector
          ```
        </Step>

        <Step>
          ### 移行を確認する [#verify-migration]

          インストールが成功したら、データがNew Relicに流れていることを確認します。

          1. サービスのステータスを確認するには、次のコマンドを実行します。

             ```bash
             sudo systemctl status nrdot-collector
             ```

          2. ログを確認するには、次のコマンドを実行します。

             ```bash
             sudo journalctl -u nrdot-collector -f
             ```
        </Step>

        <Step>
          ### New RelicでATPデータにアクセスする [#access-data]

          ATP が設定されると、Linux ホストからのデータの収集が開始されます。このデータには New Relic OpenTelemetry UI からアクセスできます。New Relic OpenTelemetry UI の詳細については、 [OpenTelemetry APM UI](/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-ui)を参照してください。

          **New Relicで ATP プロセスのメトリクス データを表示するには:**

          1. **<DNT>[one.newrelic.com](https://one.newrelic.com) &gt; All Entities</DNT>**へ移動します。

             また

             <DNT>**[one.newrelic.com](https://one.newrelic.com) &gt; Catalogs &gt; Infrastructure**</DNT>に移動します。

          2. ATP を使用して NRDOT コレクターをインストールしたエンティティを検索します。

          3. エンティティを選択し、左側のペインで**<DNT>Process</DNT>**をクリックします。

             <DNT>Process</DNT>ページでは、ホスト上で実行されているすべてのプロセスと、その ID、CPU およびメモリ使用率のメトリクスを表示できます。 また、プロセスが他のプロセスを生成する場合、プロセス間の親子関係も表示されます。

             <img style={{ align: 'left' }} title="ATP process metrics in New Relic OpenTelemetry UI" alt="ATP process metrics in New Relic OpenTelemetry UI" src="/images/atp-process-metrics.webp" />
        </Step>
      </Steps>
    </TabsPageItem>
  </TabsPages>
</Tabs>

## 設定パラメーター [#config-parameters]

<CollapserGroup>
  <Collapser id="core-settings" title="コア設定">
    <table>
      <thead>
        <tr>
          <th>
            **パラメータ**
          </th>

          <th>
            **タイプ**
          </th>

          <th>
            **デフォルト**
          </th>

          <th>
            **説明**
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `enable_storage`
          </td>

          <td>
            ブール値
          </td>

          <td>
            `true`
          </td>

          <td>
            永続ストレージを有効にします。ストレージ パスは自動的に決定されます: Linux: `/var/lib/nrdot-collector/adaptiveprocess.db` 、Windows: `%LOCALAPPDATA%\nrdot-collector\adaptiveprocess.db`
          </td>
        </tr>

        <tr>
          <td>
            `retention_minutes`
          </td>

          <td>
            整数
          </td>

          <td>
            `30`
          </td>

          <td>
            プロセス状態を保持する時間（分）
          </td>
        </tr>

        <tr>
          <td>
            `include_process_list`
          </td>

          <td>
            アレイ
          </td>

          <td>
            `[]`
          </td>

          <td>
            常に含めるプロセス名（フィルタリングをバイパス）
          </td>
        </tr>

        <tr>
          <td>
            `metric_thresholds`
          </td>

          <td>
            マップ
          </td>

          <td>
            `{}`
          </td>

          <td>
            メトリクスタイプごとの静的閾値
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="dynamic-thresholds" title="動的閾値">
    <table>
      <thead>
        <tr>
          <th>
            **パラメータ**
          </th>

          <th>
            **タイプ**
          </th>

          <th>
            **デフォルト**
          </th>

          <th>
            **説明**
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `enable_dynamic_thresholds`
          </td>

          <td>
            ブール値
          </td>

          <td>
            `false`
          </td>

          <td>
            適応閾値調整を有効にする
          </td>
        </tr>

        <tr>
          <td>
            `dynamic_smoothing_factor`
          </td>

          <td>
            浮く
          </td>

          <td>
            `0.1`
          </td>

          <td>
            閾値適応の平滑化係数（0.0-1.0）
          </td>
        </tr>

        <tr>
          <td>
            `min_thresholds`
          </td>

          <td>
            マップ
          </td>

          <td>
            `{}`
          </td>

          <td>
            メトリクスあたりの最小閾値値
          </td>
        </tr>

        <tr>
          <td>
            `max_thresholds`
          </td>

          <td>
            マップ
          </td>

          <td>
            `{}`
          </td>

          <td>
            メトリクスあたりの最大閾値
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="multi-metric-scoring" title="マルチメトリクス複合スコアリング">
    <table>
      <thead>
        <tr>
          <th>
            **パラメータ**
          </th>

          <th>
            **タイプ**
          </th>

          <th>
            **デフォルト**
          </th>

          <th>
            **説明**
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `enable_multi_metric`
          </td>

          <td>
            ブール値
          </td>

          <td>
            `false`
          </td>

          <td>
            メトリクス全体で複合スコアリングを有効にする
          </td>
        </tr>

        <tr>
          <td>
            `composite_threshold`
          </td>

          <td>
            浮く
          </td>

          <td>
            `1.5`
          </td>

          <td>
            総合スコア評価の閾値。 このスコアは `0.0`
          </td>
        </tr>

        <tr>
          <td>
            `weights`
          </td>

          <td>
            マップ
          </td>

          <td>
            `{}`
          </td>

          <td>
            複合スコアリングのメトリクスごとの重み値
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser id="anomaly-detection" title="異常検知">
    <table>
      <thead>
        <tr>
          <th>
            **パラメータ**
          </th>

          <th>
            **タイプ**
          </th>

          <th>
            **デフォルト**
          </th>

          <th>
            **説明**
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            `enable_anomaly_detection`
          </td>

          <td>
            ブール値
          </td>

          <td>
            `false`
          </td>

          <td>
            異常検出レイヤーを有効にする
          </td>
        </tr>

        <tr>
          <td>
            `anomaly_history_size`
          </td>

          <td>
            整数
          </td>

          <td>
            `15`
          </td>

          <td>
            追跡する履歴データポイントの数
          </td>
        </tr>

        <tr>
          <td>
            `anomaly_change_threshold`
          </td>

          <td>
            浮く
          </td>

          <td>
            `50.0`
          </td>

          <td>
            異常のパーセンテージ変化閾値
          </td>
        </tr>

        <tr>
          <td>
            `anomaly_min_data_points`
          </td>

          <td>
            整数
          </td>

          <td>
            `3`
          </td>

          <td>
            異常検出に必要な最小限のデータポイント
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

/\* ## メトリクス痛値ガイドライン ### CPU 使用率 (0.0-1.0 スケール) - \*\*ライト フィルタリング\*\*: \`0.10\` (10% CPU) - \*\*標準フィルタリング\*\*: \`0.05\` (5% CPU) - \*\*積極的なフィルタリング\*\*: \`0.02\` (2% CPU) ### メモリ使用率 (0.0-1.0 スケール) - \*\*ライト フィルタリング\*\*: \`0.10\` (10% メモリ) - \*\*標準フィルタリング\*\*: \`0.05\` (5% メモリ) - \*\*積極的なフィルタリング\*\*: \`0.02\` (2% メモリ) ### メモリ使用量 (バイト) - \*\*小規模プロセス\*\*: \`52428800\` (50 MB) - \*\*中規模プロセス\*\*: \`104857600\` (100 MB) - \*\*大規模なプロセス\*\*: \`209715200\` (200 MB) ### I/O (バイト) - \*\*軽いI/O \*\*: \`1048576\` (1 MB) - \*\*中程度のI/O \*\*: \`5242880\` (5 MB) - \*\*重いI/O \*\*: \`10485760\` (10 MB) ## プロセス名の一致 ATPはフルパスを使用してプロセス名を一致させます: ### 例 - ✅ \*\*正解\*\*: \`/usr/sbin/nginx\` - ✅ \*\*正解\*\*: \`/usr/bin/java\` - ❌ \*\*不正解\*\*: \`&quot;nginx&quot;\`は一致しません ### 一般的なプロセス名 \`\`\`yaml include\_process\_list: # Webサーバー - &quot;nginx&quot; - &quot;apache2&quot; - &quot;httpd&quot; # データベース - &quot;postgres&quot; - &quot; MySQL &quot; - &quot; redis &quot; - &quot;mongodb&quot; # アプリケーション - &quot;java&quot; - &quot;python&quot; - &quot;node&quot; - &quot;php-fpm&quot; \`\` \*/

## 関連資料 [#related-resources]

<DocTiles>
  <DocTile title="トラブルシューティング" path="/docs/opentelemetry/nrdot/atp/troubleshooting">
    ご使用の環境における ATP の問題をトラブルシューティングする方法を学びます。
  </DocTile>

  <DocTile title="データのクエリ" path="/docs/opentelemetry/nrdot/atp/query">
    NRQL を使用して New Relic で ATP データをクエリする方法を学びます。
  </DocTile>

  <DocTile title="高度な機能" path="/docs/opentelemetry/nrdot/atp/advanced-features">
    ATP デプロイメントの高度な機能を有効にする方法を学びます。
  </DocTile>
</DocTiles>