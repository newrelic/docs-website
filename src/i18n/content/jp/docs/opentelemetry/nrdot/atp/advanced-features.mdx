---
title: ATPの高度な機能とインテリジェンスレイヤー
metaDescription: 'Learn about ATP intelligent features including dynamic thresholds, multi-metric composite scoring, and anomaly detection.'
tags:
  - Open source telemetry integrations
  - OpenTelemetry
  - NRDOT
  - Adaptive Telemetry Processor
  - ATP
  - Dynamic thresholds
  - Anomaly detection
  - Multi-metric scoring
  - Intelligence
freshnessValidatedDate: never
translationType: machine
---

<Callout title="プレビュー">
  この機能はまだ開発中ですが、ぜひお試しください。

  この機能は現在、弊社の[プレリリース ポリシー](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy/)に従ってプレビューの一部として提供されています。
</Callout>

ATP には、単純な閾値ベースのフィルタリングを超えた、洗練された適応型テレメトリ処理を実現する高度なインテリジェンス レイヤーが含まれています。

## 高度な設定オプション [#advanced-config]

これらの**オプションの問題を**ATP プロセッサーの設定に追加して、高度な機能を有効にすることができます。

<CollapserGroup>
  <Collapser id="dynamic" title="動的閾値">
    ### 動的閾値 [#dynamic-thresholds]

    この機能は、システムの過去の動作に基づいて閾値を自動的に調整し、誤検知を減らしながら異常を発見するのに役立ちます。

    ```yaml
    processors:
      adaptivetelemetry:
        # ... existing config ...
        # Dynamic threshold configuration
        enable_dynamic_thresholds: true
        dynamic_smoothing_factor: 0.2
        min_thresholds:
          process.cpu.utilization: 0.04  # Can't go below 4%
          process.memory.utilization: 0.04  # Can't go below 4%
        max_thresholds:
          process.cpu.utilization: 0.30  # Can't exceed 30%
          process.memory.utilization: 0.30  # Can't exceed 30%
    ```
  </Collapser>

  <Collapser id="multi-metric" title="マルチメトリクス複合スコアリング">
    ### マルチメトリクス複合スコアリング [#multi-metric-scoring]

    これにより、複数のメトリックをまとめて評価し、プロセスの健全性の全体的なビューを提供し、複数の次元にわたって問題のあるプロセスを検出します。

    ```yaml
    processors:
      adaptivetelemetry:
        # ... existing config ...
        # Multi-metric configuration
        enable_multi_metric: true
        composite_threshold: 1.2
        weights:
          process.cpu.utilization: 0.5
          process.memory.utilization: 0.5
    ```
  </Collapser>

  <Collapser id="anomaly-detection" title="異常検知">
    ### 異常検知 [#anomaly-detection]

    これにより、過去の平均値を上回る突然のメトリックの急上昇が検出され、異常が発生したプロセスや予期しない動作の変化が発生したプロセスを把握できるようになります。

    ```yaml
    processors:
      adaptivetelemetry:
        # ... existing config ...
        # Anomaly detection configuration
        enable_anomaly_detection: true
        anomaly_history_size: 15
        anomaly_change_threshold: 50.0  # 50% spike triggers anomaly
        anomaly_min_data_points: 3
    ```
  </Collapser>
</CollapserGroup>

## 完全な高度な設定例 [#complete-example]

すべての高度な機能を有効にした完全な例を次に示します。

```yaml
processors:
  adaptivetelemetry:
    enable_storage: true
    retention_minutes: 30
    include_process_list:
      - "/usr/bin/postgres"
      - "/usr/sbin/nginx"
    metric_thresholds:
      process.cpu.utilization: 0.05
      process.memory.utilization: 0.05
    
    # All advanced features enabled
    enable_dynamic_thresholds: true
    dynamic_smoothing_factor: 0.2
    min_thresholds:
      process.cpu.utilization: 0.04
      process.memory.utilization: 0.04
    max_thresholds:
      process.cpu.utilization: 0.30
      process.memory.utilization: 0.30
    
    enable_multi_metric: true
    composite_threshold: 1.5
    weights:
      process.cpu.utilization: 0.5
      process.memory.utilization: 0.5
    
    enable_anomaly_detection: true
    anomaly_history_size: 15
    anomaly_change_threshold: 50.0
    anomaly_min_data_points: 3
```

## 設定チューニングガイド [#tuning-guide]

次のセクションでは、各詳細設定オプションについて詳細に説明し、環境に合わせて調整する方法についても説明します。

<CollapserGroup>
  <Collapser id="basic" title="基本設定">
    ### 基本設定

    * `enable_storage`: メトリクス履歴データの永続ストレージを有効にします。 これは、再起動後も持続するために必要です。

      * デフォルト： `true`

      * ストレージ パスはプラットフォームによって自動的に決定されます。

        * **Linux**: `/var/lib/nrdot-collector/adaptiveprocess.db`
        * **Windows** : `%LOCALAPPDATA%\nrdot-collector\adaptiveprocess.db`

    * `retention_minutes`: プロセスが最後に閾値を超えてから、そのプロセスを追跡し続ける時間 (分単位)。

      * デフォルト: 30 (最大: 30)
      * チューニング: 短命なプロセスには低い値（5～10）を使用し、安定したワークロードの場合は30に維持します。
  </Collapser>

  <Collapser id="thresholds" title="閾値設定">
    ### プロセスリストを含める

    `include_process_list`は、常にすべてのフィルターをバイパスし、閾値に関係なく報告されるプロセスのリストです。

    * ユースケース: 常に監視したい重要なプロセス (データベース、Web サーバーなど)
    * セキュリティ: `/usr/bin/postgres`などの区切り文字を含む完全なパス (`/usr/bin/postgres`) を使用します。`"postgres"`などのパス区切り文字のないエントリはどのプロセスにも一致しません。

    **例：**

    ```yaml
    include_process_list:
      - "/usr/bin/postgres"  # Always include PostgreSQL
      - "/usr/sbin/nginx"    # Always include Nginx
    ```
  </Collapser>

  <Collapser id="metric-thresholds" title="メトリクスの閾値">
    ### メトリクスの閾値

    `metric_thresholds`は、各メトリクスの静的な閾値です。 プロセスはこの値を**超える**とフラグが付けられます。

    **最適化する方法:**

    * 平均ワークロードのベースライン値から始めます
    * 閾値を上げてノイズを減らし、アラートを減らします
    * より小さな異常を捕捉するには、閾値を下げる
    * 使用率メトリクス (CPU/メモリ): パーセンテージを使用します (0.0 ～ 1.0 = 0% ～ 100%)。
    * メトリクス数 (スレッド、ファイル記述子) の場合: 絶対数を使用します。

    **例の値の説明:**

    ```yaml
    metric_thresholds:
      process.cpu.utilization: 0.0005      # 0.05% CPU - very sensitive
      process.memory.utilization: 0.0005   # 0.05% memory - very sensitive
      process.memory.virtual: 20971520     # 20 MB virtual memory
      process.threads: 16                  # 16 threads
      process.open_file_descriptors: 30    # 30 open files
      process.disk.io: 204800              # 200 KB disk I/O
      process.cpu.time: 0.01               # 0.01 seconds CPU time
    ```
  </Collapser>

  <Collapser id="dynamic-thresholds" title="動的閾値">
    ### 動的閾値

    過去の動作に基づいて閾値を自動的に調整します。 さまざまなワークロード パターンを持つプロセスに役立ちます。

    * `enable_dynamic_thresholds`：適応閾値調整をオンにします。

      * 有効にする場合: バッチジョブ、API サーバーなど、変動する動作を伴うプロセス
      * 無効にする場合: 安定した予測可能な動作をするプロセス

    * `dynamic_smoothing_factor`: 閾値がどれだけ早く適応するか (0.0-1.0)。

      * 低い（0.1）：適応が遅く、より安定している（段階的な変化に適している）
      * 高い（0.5）：適応が速く、応答性が高い（不安定なワークロードに適している）
      * デフォルト: 0.2 (バランス)

    * `min_thresholds`: 下限値 - 閾値はこれらを下回ることはありません。 これは閾値が敏感になりすぎないようにするために使用されます。

    * `max_thresholds`: 上限値 - 閾値はこれらを超えることはありません。 これは閾値が緩くなりすぎないようにするために使用されます。
  </Collapser>

  <Collapser id="multi-metric-scoring" title="マルチメトリクススコアリング">
    ### マルチメトリクススコアリング (複合スコアリング)

    複数のメトリクスを個別に評価するのではなく、まとめて評価します。 複数の次元にわたって「悪質な」プロセスをキャッチするのに役立ちます。

    * `enable_multi_metric`: 複合スコアリングを有効にします。

      * 有効にする場合: 複数の方法で問題のあるプロセスをキャッチしたい場合 (CPU 負荷 + メモリ負荷)
      * 無効にする場合: 個別のメトリクスを集計したい

    * `composite_threshold`: 総合スコア値。 (メトリクスの加重合計) &gt; composite\_threshold の場合、プロセスにフラグが立てられます。

      * 下限（0.5）：より敏感に、限界ケースを捕捉
      * 高い（2.0）：感度が低く、重大な問題のみを検出します
      * デフォルト: 1.5

    * `weights`: 複合スコアにおける各メトリクスの重要性。 重みが大きいほど、メトリクスの影響力が大きくなります。
  </Collapser>

  <Collapser id="anomaly-detection" title="異常検知">
    ### 異常検知

    これは、現在の値を履歴パターンと比較することで、突然の急増や異常な動作を検出します。

    * `enable_anomaly_detection`: スパイク検出をオンにします。

      * 有効にする場合: 突然の変更 (プロセスの異常) をキャッチするため
      * 無効にする場合: 絶対値の場合

    * `anomaly_history_size`: ベースライン平均を計算するために保持する最近のデータ ポイントの数。

      * 大きい（50～100）：ベースラインが滑らかになり、より大きな異常を検出します
      * 小さめ（5～15）：より反応が良く、小さなスパイクをキャッチします
      * デフォルト: 10 (最大: 100)

    * `anomaly_change_threshold`: 集計をトリガーする過去の平均を上回るパーセンテージのスパイク。

      * 例: 50.0 = 現在の値が平均より 50% 高い場合にフラグを立てます
      * 低い（20～50）：変化に敏感
      * 高い（100～200）: 劇的なスパイクのみをキャッチ
      * デフォルト: 200.0

    * `anomaly_min_data_points`: 異常検出がアクティブになる前の最小履歴データ ポイント。

      * これにより、起動時の誤検知を防ぐことができます。
      * 推奨: 3 (デフォルト) のままにする
      * ≤ である必要があります `anomaly_history_size`
  </Collapser>
</CollapserGroup>

## 最適化戦略 [#tuning-strategy]

**はじめる：**

1. `metric_thresholds`のみで開始します (動的/マルチメトリクス/異常を無効にします)
2. 1～2 日間観察し、その後、偽造を減らすために閾値を調整します。
3. 可変ワークロードに対して`enable_dynamic_thresholds`を有効にする
4. 突然のスパイクをキャッチするには`enable_anomaly_detection`を追加します
5. プロセスに相関リソースの問題がある場合は、 `enable_multi_metric`使用します。

**一般的なパターン:**

* **安定した運用サービス**: 静的な閾値のみを使用します
* **バッチジョブ**: 動的閾値 + 異常検出を使用
* **リソースを大量に消費するアプリ**: マルチメトリクス スコアリングを使用する
* **重要なプロセス**: 追加 `include_process_list`

## 関連資料 [#related-resources]

<DocTiles>
  <DocTile title="トラブルシューティング" path="/docs/opentelemetry/nrdot/atp/troubleshooting">
    ご使用の環境における ATP の問題をトラブルシューティングする方法を学びます。
  </DocTile>

  <DocTile title="データのクエリ" path="/docs/opentelemetry/nrdot/atp/query">
    NRQL を使用して New Relic で ATP データをクエリする方法を学びます。
  </DocTile>

  <DocTile title="自分のデータを見る" path="/docs/opentelemetry/nrdot/atp/view-data">
    ATP によって収集されたデータを New Relic で表示する方法を学びます。
  </DocTile>
</DocTiles>