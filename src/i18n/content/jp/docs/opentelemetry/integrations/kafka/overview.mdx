---
title: OpenTelemetry Kafka監視の概要
tags:
  - Integrations
  - OpenTelemetry
  - Kafka
  - On-host integrations
metaDescription: Monitor Kafka with OpenTelemetry Collector for comprehensive metrics collection from self-hosted and Kubernetes Kafka clusters.
freshnessValidatedDate: never
translationType: machine
---

Kafka 監視は、 Apache Kafka クラスターへの可視性を提供して、信頼性の高いデータ ストリーミングを確保し、分散システムでのコストのかかるダウンタイムを防ぎます。 コレクターベースのアプローチを使用すると、自己ホスト環境と Strimzi を使用したKubernetes全体で機能する柔軟なベンダーニュートラル ソリューションを通じて包括的な監視を取得できます。

## Collectorオプション [#collector-options]

New Relic 、Kafka 監視用に 2 つのOpenTelemetry Collectorディストリビューションをサポートしており、どちらも同じ設定ファイルと監視機能による同一の機能を提供します。

* **NRDOT Collector (推奨)** : New Relic のサポートが付いた、New Relic の OpenTelemetry Collector のディストリビューション。[NRDOT Collector リリース](https://github.com/newrelic/nrdot-collector-releases/releases)からダウンロードしてください。
* **OpenTelemetry Collector** : アップストリーム コミュニティ ディストリビューション。[OpenTelemetry Collector リリース](https://github.com/open-telemetry/opentelemetry-collector-releases/releases)からダウンロードしてください。

サポートと運用の要件に最適なコレクターを選択し、環境の[監視の設定](#get-started)に進みます。

<img title="OTel Kafka Dashboard" alt="Dashboard showing Kafka cluster health, network throughput, active brokers, topics, partitions, and consumer groups" src="/images/otel-kafka-dashboard.webp" />

<figcaption>
  クラスタの健全性、ブローカーのステータス、トピックのメトリクス、および消費者グループのパフォーマンスを示す包括的なダッシュ ボードで Kafka クラスタを監視します。
</figcaption>

## なぜKafka監視なのか?

* 停止を防ぐ - ブローカーの障害、レプリケーション不足のパーティション、オフラインのトピックなど、ダウンタイムが発生する前にアラートを取得します。
* パフォーマンスの最適化 - データ処理速度に影響を与える消費者の遅延、低速なプロデューサー、ネットワークのボトルネックを特定します
* 容量を計画する - リソース使用量、メッセージレート、接続数を追跡して、事前に拡張します
* データの整合性を確保 - レプリケーションの健全性とパーティションのバランスを監視してデータ損失を防ぎます

### 一般的な使用例

金融取引のストリーミング、IoT センサー データの処理、マイクロサービス通信の処理のいずれの場合でも、Kafka 監視は、ビジネスに影響を与える前に問題を発見するのに役立ちます。 消費者によるラグの急増により、ダッシュボードが脅かされる場合、ブローカーの障害によりデータ損失の危険がある場合、またはネットワークのボトルネックにより重要なデータ パイプラインが遅くなる場合に、アラートを取得します。 この監視は、電子商取引プラットフォーム、保留分析システム、およびメッセージ配信の遅延や失敗がユーザー エクスペリエンスやビジネス運営に影響を与える可能性があるアプリケーションにとって不可欠です。

## 始めましょう [#get-started]

監視を開始するには、Kafka 環境を選択します。各セットアップ ガイドには、前提条件、設定手順、トラブルシューティングのヒントが含まれています。

<TechTileGrid>
  <TechTile name="Self-hosted Kafka" to="/docs/opentelemetry/integrations/kafka/self-hosted" icon="logo-linux" />

  <TechTile name="Kubernetes (Strimzi)" to="/docs/opentelemetry/integrations/kafka/kubernetes-strimzi" icon="logo-kubernetes" />
</TechTileGrid>

## 使い方 [#how-it-works]

Kafka 監視は、Kafka クラスタと並行してコレクターをデプロイして、パフォーマンス データを継続的に収集します。 コレクターは、複数の特殊なコンポーネントを使用して、Kafka インフラストラクチャのさまざまな部分から包括的なメトリクスをキャプチャします。

**3 つのコンポーネントが連携してデータを収集します。**

* [Kafka メトリクス レシーバー](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkametricsreceiver)- Kafka クラスタに接続して、消費者のラグ、トピック メトリクス、パーティション ステータスなどの全体的な健全性を監視します。
* [OpenTelemetry Javaエージェント](https://github.com/open-telemetry/opentelemetry-java-instrumentation)- 各Kafkaブローカーと並行して実行して、詳細なJVMパフォーマンス・メトリクスおよび運用データを収集し、この情報をコレクターに送信します。
* [OTLP レシーバー](https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver)- Javaエージェントから詳細なブローカー メトリクスを受信して処理します。

**データフロー:**

1. OpenTelemetry Javaエージェントは、 `-javaagent`懸案を介してJavaエージェントとして Kafka ブローカーに接続します
2. Javaエージェントはカスタム設定ルールを使用してKafkaブローカーからJMXメトリクスを収集します
3. メトリクスは、OTLP (gRPC) プロトコル経由でポート 4317 の OpenTelemetry Collector に送信されます。
4. Kafka メトリクス レシーバーは、ブートストラップ ポートを介して Kafka から直接クラスター レベルのメトリクスを収集します。
5. データは処理され、強化され、効率的な送信のためにバッチ処理されます
6. メトリクスはOTLPエクスポーターを介してNew Relicにエクスポートされます。
7. New Relicは自動的にエンティティを作成し、ダッシュボードに入力します

**得られるもの:**主要なメトリクスには、消費者のラグ、ブローカーの健全性、リクエスト レート、ネットワーク スループット、パーティション レプリケーション ステータス、リソース使用率、およびJVMパフォーマンス データが含まれます。

メトリクスの完全な名前、説明、およびアラートの推奨事項については、 [「Kafka メトリクス リファレンス」を](/docs/opentelemetry/integrations/kafka/metrics-reference)参照してください。

### オプション: アプリケーションレベルの監視を追加する

上記の監視設定は、Kafka クラスターの健全性とパフォーマンスを追跡します。データがシステム内をどのように流れるかの全体像を把握するには、Kafka からメッセージを送受信するアプリケーションを監視することもできます。

**アプリケーション監視により次のものが追加されます:**

* アプリから Kafka へのリクエストのレイテンシ
* アプリケーションレベルのスループットメトリクス
* エラー率とディストリビューティッド（分散）トレーシング
* 生産者→ブローカー→消費者までの完全な可視性

[OpenTelemetryJavaクイック](https://opentelemetry.io/docs/zero-code/java/agent/getting-started/) **セットアップ:**[ ゼロコード Kafka 計装 には](https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/out-of-the-box-instrumentation/) エージェント を使用します。高度な設定については、 [Kafka 計装ドキュメントを](https://github.com/open-telemetry/opentelemetry-java-instrumentation/tree/main/instrumentation/kafka)参照してください。

## 次のステップ [#next-steps]

Kafka クラスターの監視を開始する準備はできましたか?

**監視を設定します。**

* [自己ホスト型 Kafka](/docs/opentelemetry/integrations/kafka/self-hosted) - 物理マシンまたは仮想マシン上で実行されている Kafka を監視します
* [Strimzi を使用したKubernetes](/docs/opentelemetry/integrations/kafka/kubernetes-strimzi) - Kubernetesでの Kafka デプロイの監視

**セットアップ後:**

* [データを検索して書き込みます](/docs/opentelemetry/integrations/kafka/find-and-query-data)- New Relic UIに移動してNRQL書き込みを書き込みます
* [Kafka メトリクスの探索](/docs/opentelemetry/integrations/kafka/metrics-reference)- アラート推奨事項を含む完全なメトリクス リファレンス