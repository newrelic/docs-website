---
title: メトリックAPIの制限と制限された属性
tags:
  - Ingest and manage data
  - Ingest APIs
metaDescription: 'Rate limits and restricted keywords for the New Relic Metric API, and what to do if you reach their limits.'
freshnessValidatedDate: never
translationType: machine
---

本ドキュメントでは、 [メトリック API](/docs/new-relic-metric-api) のデータ要件について説明しています。

* 最大限の制限
* 制限された属性
* 制限されたメトリック値

## 最大限の制限 [#requirements]

すべてのMetricデータには、以下のデフォルトリミットが適用されます。

<table>
  <thead>
    <tr>
      <th>
        条件
      </th>

      <th>
        制限
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        タイムスタンプ値の年齢範囲
      </td>

      <td>
        報告されたタイムスタンプが48時間前よりも古い、または報告された時点から24時間よりも新しいメトリクスは削除されます。
      </td>
    </tr>

    <tr>
      <td>
        最大データポイント/分（DPM）
      </td>

      <td>
        300〜1500万DPM [（詳細）](#additional-considerations)
      </td>
    </tr>

    <tr>
      <td>
        Max unique time series (cardinality) per account per day
      </td>

      <td>
        1〜1500万[（詳細）](#additional-considerations)

        A time series is a single, unique combination of a metric name and any attributes.
      </td>
    </tr>

    <tr>
      <td>
        Max unique time series (cardinality) per metric name per day
      </td>

      <td>
        100k
      </td>
    </tr>

    <tr>
      <td>
        最大ペイロード数/分
      </td>

      <td>
        100k [（詳細）](#additional-considerations)
      </td>
    </tr>

    <tr>
      <td>
        メトリクスごとの最大アトリビュート
      </td>

      <td>
        100
      </td>
    </tr>

    <tr>
      <td>
        最大のメトリック属性名の長さ
      </td>

      <td>
        255文字
      </td>
    </tr>

    <tr>
      <td>
        属性キーの最大文字数
      </td>

      <td>
        255文字
      </td>
    </tr>

    <tr>
      <td>
        最大メトリック属性値の長さ
      </td>

      <td>
        4096文字
      </td>
    </tr>

    <tr>
      <td>
        許可されるHTTPプロトコル
      </td>

      <td>
        HTTPSのみ
      </td>
    </tr>

    <tr>
      <td>
        Javaの長さの最小値または最大値から外れる数値の長さ
      </td>

      <td>
        長さの数値が、Javaの長さの最小値または最大値から外れている場合は、拒否されます。

        * その番号が共通ブロックにある場合は、そのブロック全体が落とされます。
        * 数値がメートル法のデータポイントにある場合、その数値が存在するメートル法のデータポイントは削除されます。
      </td>
    </tr>

    <tr>
      <td>
        Javaのダブル値の最小値または最大値から外れる数値のダブル値
      </td>

      <td>
        Javaのダブル値の最小値または最大値から外れた数値のダブル値は拒否されます。

        * その番号が共通ブロックにある場合は、そのブロック全体が落とされます。
        * 数値がメートル法のデータポイントにある場合、その数値が存在するメートル法のデータポイントは削除されます。
      </td>
    </tr>

    <tr>
      <td>
        倍精度浮動小数点数に変換するために丸めが必要な double 数値。
      </td>

      <td>
        倍精度浮動小数点数に変換するために丸めが必要な double 数値は拒否されます。

        この例は、 `1.12345678901234567E18`です。double にはこれほど大きな値を含めることができますが、それを正確に表現するには十分な精度がありません ( `1.12345678901234573E18`に丸める必要があります)。

        * その番号が共通ブロックにある場合は、そのブロック全体が落とされます。
        * 数値がメートル法のデータポイントにある場合、その数値が存在するメートル法のデータポイントは削除されます。
      </td>
    </tr>

    <tr>
      <td>
        ペイロードサイズ
      </td>

      <td>
        合計最大サイズまたは長さ: <DoNotTranslate>**1MB (10^6 bytes) maximum per POST**</DoNotTranslate> 。 圧縮を使用することを強くお勧めします。
      </td>
    </tr>

    <tr>
      <td>
        ペイロードフォーマット
      </td>

      <td>
        ペイロードは<DoNotTranslate>**UTF-8**</DoNotTranslate>としてエンコードする必要があります。
      </td>
    </tr>

    <tr>
      <td>
        アトリビュートネーミングシンタックス
      </td>

      <td>
        属性名は、英数字、コロン（ `:` ）、ピリオド（ `.` ）、およびアンダースコア（ `_` ）の組み合わせにすることができます。
      </td>
    </tr>
  </tbody>
</table>

以下のデフォルトリミットは、Prometheus Remote Writeインテグレーションを介して収集されたデータにのみ適用されます。

<table>
  <thead>
    <tr>
      <th>
        条件
      </th>

      <th>
        制限
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        Max unique Count and Summary time series (cardinality) per account per 5 minute interval
      </td>

      <td>
        1〜1500万[（詳細）](#additional-considerations)

        A time series is a single, unique combination of a metric name and any attributes. Time series received above this limit are dropped. This limit is enforced prior to and in addition to standard metric limits.
      </td>
    </tr>
  </tbody>
</table>

### 追加アカウント条件 [#additional-considerations]

メトリクス API の制限は、個々のアカウント レベルで適用されます。DPM とカーディナリティのデフォルトの制限は [、無料版](/docs/accounts/accounts-billing/new-relic-one-pricing-billing/new-relic-one-pricing-billing/#editions)の組織では 300 万、一部の有料組織では最大 1,020 万の範囲です。組織の制限を理解するには、 [制限 UI](/docs/data-apis/manage-data/view-system-limits)を参照してください。支払いを行う組織のリクエストに応じて、DPM とカーディナリティを 15M まで増やすことができます。1 分あたりの最大ペイロードは、ケースバイケースで 100,000 を超えて調整できます。メトリック レート制限の変更をリクエストするには、New Relic アカウント担当者に連絡するか、 [サポート ポータル](http://support.newrelic.com/)にアクセスしてください。

## レート制限インシデント [#rate-limit-incidents]

ここでは、レートの制限を超えたときのMetric APIの動作と、制限を超えた場合の対応について説明します。

<CollapserGroup>
  <Collapser
    id="incident-dpm-exceeded"
    title="最大データポイント/分（DPM）"
  >
    Data points per minuteは、個々のメトリック値がMetric APIに送信される毎分のレートを指します。

    アカウントの最大DPM制限を超えると、New RelicMetricAPIは残りの1分間に`429`応答を返します。応答には、新しいデータを再送信または送信する前に秒単位で待機する時間を示す`Retry-After`ヘッダーが含まれます。

    この問題を解決するには、送信するデータポイントの数を減らすか、レートリミットの変更をリクエストしてください。その後のサブスクリプションの変更は、変更後のレートリミットに影響しません。アカウントの変更がレートリミットに影響を与える場合は、レートリミットを調整するよう当社に通知する必要があります。

    レートリミットの変更をリクエストするには、New Relic のアカウント担当者に連絡するか、 [Support ポータル](http://support.newrelic.com) にアクセスしてください。
  </Collapser>

  <Collapser
    id="incident-unique-timeseries"
    title="Max unique time series per account per day"
  >
    A time series is a single, unique combination of a metric name and any attributes assigned to that metric. For example, if a `CPU utilization` metric with a single attribute `hostname` is sent from ten different hosts, this equals ten distinct values for the `hostname` attribute and ten unique metric time series.

    If the per-account, per-day unique metric time series (cardinality) limit is exceeded during a 24 hour period, the endpoint will continue to receive and store raw metric data. However, New Relic will stop creating additional aggregate rollups (1 minute, 5 minutes, etc.) for the remainder of the 24 hour period. (These rollups are used used by default to query time windows longer than 60 minutes.)

    このようなインシデントが発生した場合でも、60 分以下の時間枠を指定するか、RAW キーワードを指定することで、データのクエリを継続できます (詳細については、 [「高カーディナリティ メトリック](/docs/data-apis/ingest-apis/metric-api/NRQL-high-cardinality-metrics)」を参照してください)。これは、インシデントの潜在的な原因を特定するのに役立ちます。
  </Collapser>

  <Collapser
    id="incident-unique-timeseries"
    title="Max unique time series per metric name per day"
  >
    A time series is a single, unique combination of a metric name and any attributes assigned to that metric. For example, if a `CPU utilization` metric with a single attribute `hostname` is sent from ten different hosts, this equals ten distinct values for the `hostname` attribute and ten unique metric time series.

    If the per-metric name, per-day unique metric time series (cardinality) limit is exceeded during a 24 hour period, the endpoint will continue to receive and store raw metric data. However, New Relic will stop creating additional aggregate rollups (1 minute, 5 minutes, etc.) for the remainder of the 24 hour period. (These rollups are used used by default to query time windows longer than 60 minutes.)

    このようなインシデントが発生した場合でも、60 分以下の時間枠を指定するか、RAW キーワードを指定することで、データのクエリを継続できます (詳細については、 [「高カーディナリティ メトリック](/docs/data-apis/ingest-apis/metric-api/NRQL-high-cardinality-metrics)」を参照してください)。これは、インシデントの潜在的な原因を特定するのに役立ちます。
  </Collapser>

  <Collapser
    id="incident-payloads"
    title="最大ペイロード数/分"
  >
    1分以内にMetricAPIエンドポイントに対して100,000を超えるPOSTリクエストを行うと、エンドポイントはその分の残りの時間に`429`応答を返します。応答には、新しいデータを再送信または送信する前に秒単位で待機する時間を示す`Retry-After`ヘッダーが含まれます。

    一般的に、この限界に達した場合は、より大きなペイロードの作成を検討してください。そのためには、より多くのデータポイントを各リクエストに組み合わせて、必要なPOSTの数を減らします。

    これができない場合は、New Relic のアカウント担当者に連絡するか、 [サポートポータル](http://support.newrelic.com/) にアクセスして、レートリミットの引き上げをリクエストすることができます。
  </Collapser>
</CollapserGroup>

## 制限された属性 [#send-metric-data]

これらの属性は、New Relic プラットフォームによって制限されています。メトリックデータポイントの属性セクションでこれらのキーを使用して送信された値は、データポイントが削除されるか、値が省略または上書きされます。

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `newrelic.source`
      </td>

      <td>
        これにより、値`metricAPI`にリセットされます。
      </td>
    </tr>

    <tr>
      <td>
        `metricName`
      </td>

      <td>
        これは、各データポイントに渡された`name`値にリセットされます。これにより、 `name`を属性キーにすることができます。
      </td>
    </tr>

    <tr>
      <td>
        `endTimestamp`
      </td>

      <td>
        `timestamp` `interval.ms`はデータポイントの`endTimestamp`に変換されます。
      </td>
    </tr>
  </tbody>
</table>

これらの属性は、エンティティを識別するために内部的に使用されます。メトリック・データ・ポイントの属性セクションでこれらのキーを使用して送信された値は、UIにエンティティが表示されなかったり、遠隔測定が期待したエンティティに関連付けられなかったりするなど、未定義の動作を引き起こす可能性があります。詳細については、 [Entity synthesis](/docs/new-relic-one/use-new-relic-one/core-concepts/what-entity-new-relic/#entity-synthesis) を参照してください。

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `entity.guid`
      </td>

      <td>
        New Relic がエンティティに割り当てる一意の識別子。
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`
      </td>

      <td>
        エンティティの人間が読める名前で、UIでエンティティを識別するためによく使われます。
      </td>
    </tr>

    <tr>
      <td>
        `entity.type`
      </td>

      <td>
        ホストやアプリケーションなど、異なるタイプのエンティティを区別するために使用されます。
      </td>
    </tr>
  </tbody>
</table>

追加の制限があります。

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        制限
      </th>

      <th>
        コメントコメント
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        メトリクスおよびアトリビュート名
      </td>

      <td>
        メトリック名と属性名に同じ値を渡すことはできません。

        次の例では、メトリックの名前が`service.errors.all`で、属性`service.errors.all`があるため、メトリックは無効です。

        <DoNotTranslate>
          **Example: Metric value used as an attribute (invalid)**
        </DoNotTranslate>

        ```json
        [
          {
            "metrics": [
              {
                "name": "service.errors.all",
                "type": "count",
                "value": 15,
                "timestamp": 1531414060739,
                "interval.ms": 10000,
                "attributes": {
                  "service.response.statuscode": "400",
                  "service.errors.all": "test",
                  "service.name": "foo"
                }
              }
            ]
          }
        ]
        ```
      </td>
    </tr>

    <tr>
      <td>
        予約語
      </td>

      <td>
        `accountId` 、 `appId` 、 `eventType`などの[予約語](/docs/data-apis/custom-data/custom-events/data-requirements-limits-custom-event-data/#reserved-words)の使用は避けてください。 また、バックティック ( ``` `` ``` ) を使用しない限り、NRQL 構文用語の使用は避けてください。
      </td>
    </tr>

    <tr>
      <td>
        メートル法のJSON内のキー
      </td>

      <td>
        メトリックJSON内で使用されるすべてのキーを属性キーにすることはできません。これには、 `interval.ms` 、 `timestamp` 、 `value` 、 `common` 、 `min` 、 `max` 、 `count` 、 `sum` 、および`metrics`が含まれます。

        <DoNotTranslate>**Exception:**</DoNotTranslate> `name`属性キーとして使用できます。
      </td>
    </tr>
  </tbody>
</table>

## 制限されたメトリック値 [#restricted-metric-values]

`value`が`NaN` (数値ではない)、 `positive infinity` 、または`negative infinity`に等しいメトリック API に送信されたメトリック データはすべて破棄されます。