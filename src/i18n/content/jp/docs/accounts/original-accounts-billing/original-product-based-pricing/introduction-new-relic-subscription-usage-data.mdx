---
title: サブスクリプションの使用状況（元の価格設定モデル）
tags:
  - Accounts
  - Original accounts and billing
  - Original pricing model usage
metaDescription: 'For accounts on our original pricing model, how to understand your product subscription usage data.'
translationType: machine
---

<Callout variant="important">
  このドキュメントは、オリジナルの [製品ベースの価格設定](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントを対象としています。新しい価格モデルをご利用の方は、 [New Relic One の価格モデル](/docs/accounts/accounts-billing/new-relic-one-pricing-users/pricing-billing) をご覧ください。どちらのモデルかわからない場合は [Overview of pricing models](/docs/transition-guide-our-new-pricing-plan-user-model) をご覧ください。
</Callout>

[オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントでは、使用量 UI により、データ使用量を予測可能に追跡し、それが価格にどのように影響するかを確認することができます。このドキュメントでは、サブスクリプションの使用状況 UI の仕組みと、必要な使用状況データを照会・取得する方法について説明します。

お客様の使用データを確認するために

* アカウントオーナーまたは管理者であれば、New Relic UI でサブスクリプションの使用状況データにアクセスできます。
* アカウントの所有者や管理者でない場合は、 [`NrDailyUsage` イベント](/attribute-dictionary/?event=NrDailyUsage) を使用して使用量データを照会することができます。

## 使用方法 [#about-usage]

<Callout variant="tip">
  **オーナーとアドミン**
</Callout>

サブスクリプション使用状況のUIでは、New Relic製品の使用状況と、その使用状況がお客様のアカウントの [サブスクリプションレベルと価格にどのような影響を与えるかが表示されます](/docs/accounts/accounts/subscription-pricing) 。例えば、以下のようになります。

* 組織の部門や子アカウントが、請求可能なNew Relicの使用量にどれだけ貢献しているかを示しています。これは、組織でITチャージバックを使用している場合などに便利です。
* Insights Proのサブスクリプションレベルを超えるまでの期間。

製品の使用状況を把握するために、これらの資料をご利用ください。

* View [**Usage** UI pages](#ui) お客様のNew Relic製品の使用状況の概要がわかります。
* 使用量データのCSVダウンロード、その他 [UI機能の利用](#ui-features) 。
* [NRQL クエリを実行するか、Insights クエリ API コール](#nrql-queries) を使用して、フォーカスされた使用データを取得します。

## 使用状況をUIで確認 [#ui]

<Callout variant="tip">
  アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を使って使用量データを照会できます。
</Callout>

New Relicサブスクリプションの使用データを表示するには

1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
2. 全製品のアカウント使用状況の概要については、 **Usage** を選択してください。
3. 特定の製品の使用状況を表示するには、その製品の **Usage** ページを選択します。

![New Relicの利用UI ](./images/New-Relic-usage-UI.png "new-relic-use-ui.png")

<figcaption>
  オリジナルの価格モデルを採用している組織では、オーナーや管理者は、すべての製品の使用状況を確認したり、製品ごとに確認したりすることができます。
</figcaption>

New Relic の各製品には、使用量を計算するための独自の単位があります。例えば、Mobile は月間アクティブユーザーを追跡します。計測単位を除けば、UIチャートや機能はすべての製品で共通しています。

## UI機能

ここでは、New Relic の使用方法の UI ページで利用できる一般的な機能をご紹介します。製品固有の UI や計算の詳細については、 [製品の使用方法に関するドキュメント](#product-ui) をご覧ください。

<table>
  <thead>
    <tr>
      <th style={{ width: "240px" }}>
        以下を行う場合...
      </th>

      <th>
        操作...
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        スイッチ時間範囲
      </td>

      <td>
        **Time picker** を使用して、現在の暦月のデータの表示と過去30日のデータの表示を切り替えます。UIでの時間測定はすべて協定世界時（UTC）を使用しています。
      </td>
    </tr>

    <tr>
      <td>
        異なるアカウントレベルへの切り替え
      </td>

      <td>
        [カスタマーパートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions), [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts), 子アカウントなどのアカウントレベルを選択するには、 **Scope から** を選択します。
      </td>
    </tr>

    <tr id="csv">
      <td>
        CSVダウンロード
      </td>

      <td>
        製品別の使用方法のページで、 **Download CSV** を選択すると、カンマで区切られた値のファイルを取得できます。CSVの列とデータは、UIに表示されているデータと一致しています。
      </td>
    </tr>

    <tr>
      <td>
        グループデータ
      </td>

      <td>
        製品別のページでは、デフォルトのチャート表示は、 **アカウント名** で構成されています。アプリケーション別やホスト別など、データをグループ化する他の方法に切り替えるには、 **Group by** を選択します。
      </td>
    </tr>

    <tr id="view-query">
      <td>
        問い合わせを見る
      </td>

      <td>
        チャートの上にマウスを置き、 <Icon name="fe-more-horizontal"/>を選択し、次に **View query** を選択します。
      </td>
    </tr>

    <tr>
      <td>
        グラフセグメント詳細を見る
      </td>

      <td>
        複数のセグメントを持つチャートの詳細を表示するには、任意のセグメントにマウスオーバーします。
      </td>
    </tr>
  </tbody>
</table>

## 使用データの照会 [#nrql-queries]

New Relic はお客様の使用状況データを [`NrDailyUsage` イベントタイプ](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) として保存します。使用状況グラフには、UI で表示されるものに近い NRQL クエリが関連付けられています。

製品固有の属性やNRQLクエリの例については、このままお読みください。

<CollapserGroup>
  <Collapser
    id="apm-cu"
    title="APM CUベースのサブスクリプション"
  >
    [オリジナルの価格設定モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントでは、使用量 UI により、データ使用量を予測的に追跡し、それが価格にどのように影響するかを確認することができます。このドキュメントでは、CU ベースの価格設定 (ホストベースの価格設定ではない) をしている APM アカウントの請求可能な使用量を New Relic がどのように計算するかを説明するとともに、利用可能なサブスクリプションの使用量属性と、New Relic UI や API コールで使用できる [NRQL クエリの例](#query-examples) を提供しています。

    ### データ作成 [#details]

    1日1回、APMアカウントは、 `NrDailyUsage` [event](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を生成します。

    * 過去24時間に作成されたすべてのアプリケーションインスタンス
    * 過去24時間にアプリケーション・インスタンスが存在したすべてのホスト

    これらの2種類のイベントにより、使用状況データを様々な方法で照会・分析することができます。アプリケーションイベントを照会するには、 `usageType` 属性値として `Application` を使用します。ホストイベントを照会するには、 `usageType` 属性値として `Host` を使用します。

    すべてのAPMイベントは、 `productLine` 属性値として、 `APM` を使用します。詳細については、 [APM クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    ホストの毎月の請求可能な CU は、APM を実行しているホストのサイズ (CPU 数 + RAM GB) に、その月にホストが New Relic に接続している時間数を乗じて算出されます。この計算方法の詳細については、 [CU ベースの価格設定](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#compute-unit) をご覧ください。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を使って使用量データを照会することができます。
    </Callout>

    当月の最終的な課金対象となるCUの推定値を得るため。

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **APMの使い方** ページで、タイムピッカーを **当月** に設定します。
    3. **Avg daily compute units** に当月の日数を掛けてください。

    Usage UIの詳細については、 [Intro to subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) を参照してください。

    ### 表の定義 [#details]

    ここでは、UIテーブルやCSVファイルに表示されるカラムヘッダーの定義を示します。表示される列は、ページ上部で選択されている「 **Group by** 」オプションによって異なります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            ヘッダー
          </th>

          <th>
            定義
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            アカウント名
          </td>

          <td>
            アカウントの名前です。これは、スタンドアロンのアカウント、 [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts) または [顧客パートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions) とすることができます。
          </td>
        </tr>

        <tr>
          <td>
            ホストID
          </td>

          <td>
            そのホストの一意の識別子です。ホストがAWSにある場合は、AWSが提供するインスタンスIDを使用します。その他のホストの場合は、New Relic がホスト ID を割り当てます。この値の作成方法については、 [`hostID`](/docs/apm-cu-based-usage-attributes-queries#hostid) を参照してください。
          </td>
        </tr>

        <tr>
          <td>
            エージェントのホスト名
          </td>

          <td>
            エージェントから報告されたホストの名前です。この値の詳細については、 [`agentHostname`](/docs/apm-cu-based-usage-attributes-queries#agenthostname) を参照してください。
          </td>
        </tr>

        <tr>
          <td>
            1日の平均計算ユニット数
          </td>

          <td>
            1日の平均的な [compute units](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#compute-unit) を使用しています。
          </td>
        </tr>

        <tr>
          <td>
            総使用量に占める割合
          </td>

          <td>
            全体の使用量に対する割合です。
          </td>
        </tr>
      </tbody>
    </table>

    ### クエリの例

    ここでは、アカウント使用データで使用できるNRQLクエリの例をご紹介します。

    <CollapserGroup>
      <Collapser
        id="last-month-query"
        title="先月の使用状況"
      >
        ```
        SELECT sum(apmComputeUnits) 
        FROM NrDailyUsage 
        WHERE usageType='Host' 
        AND productLine='APM' 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="last-year-query"
        title="昨年の月間使用量"
      >
        ```
        SELECT SUM(apmComputeUnits)
        FROM NrDailyUsage
        WHERE usageType='Host' 
        AND productLine='APM'
        FACET monthOf(timestamp) 
        SINCE 12 month ago limit 13
        ```
      </Collapser>

      <Collapser
        id="instance-hours-per-app-query"
        title="アプリケーションごとのInstance-Cu"
      >
        このクエリは、過去 24 時間にアプリケーションのすべてのインスタンス (プロセス) が使用した CU の合計数を測定します。どのアプリケーションがAPMの使用量の原因となっているかを判断するのに便利ですが、New RelicがAPMの使用量を価格設定する方法と正確に一致する結果は得られません。

        各アプリケーションインスタンスは、同じホスト上で他のアプリケーションインスタンスと同時に動作していても、このクエリでは個別にカウントされるため、アプリケーションインスタンス時間数はホスト時間数（請求可能な数量）よりも大きくなる可能性があります。

        ```
        SELECT sum(apmComputeUnits) 
        FROM NrDailyUsage 
        WHERE usageType='Application' 
        AND productLine='APM' 
        FACET consumingAccountName,consumingAccountId,apmAppName 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser title="レガシーホスト使用レポート">
        このクエリは、かつて"ホスト使用状況レポート" で提供されていたデータ（各ホストで実行されているアプリケーションのリスト）を返します。なお、APMの使用量は1時間単位でカウントされますが、1時間単位の使用量データはAPIやUIでは利用できなくなりました。

        ```
        FROM NrDailyUsage 
        SELECT min(timestamp) 
        AS 'Earliest reporting day',max(timestamp) 
        AS 'Latest reporting day' 
        FACET apmAppName,hostId,agentHostname,consumingAccountName,consumingAccountId 
        WHERE usageType='Application' 
        AND productLine='APM' 
        SINCE 1 month ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="legacy-per-host-query"
        title="従来のホスト毎の使用量レポート"
      >
        このクエリは、廃止されたUIシステムで得られたであろうCSVレポートに近いものを生成します。

        ```
        FROM NrDailyUsage 
        SELECT consumingAccountId 
        AS 'Account ID', hostId, cloudProvider 
        AS 'Host provider', cloudInstanceType 
        AS 'Instance type', apmBillingInstanceSize 
        AS 'Instance size', apmHoursUsed 
        AS 'Hours used', apmComputeUnits 
        AS 'Usage (CU)', apmMemoryBytes/(1024*1024*1024) 
        AS 'Total RAM', apmProcessorCount 
        AS 'Logical processors', apmContainerCount 
        AS 'Container count', apmComputeUnitRule 
        AS 'Business rule', missingCpuData, missingRamData, instanceSizeCapped, cloudZone, cloudInstanceId 
        WHERE productLine='APM' 
        AND usageType='Host' 
        SINCE 1 day ago 
        LIMIT 2000
        ```

        このNRQLクエリは、従来の使用レポートとは異なります。

        <table>
          <thead>
            <tr>
              <th style={{ width: "200px" }}>
                ホストごとのクエリ
              </th>

              <th>
                コメント
              </th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>
                期間
              </td>

              <td>
                このクエリには、過去24時間の使用状況のみが含まれています。より長い期間の使用量を集約して表示するには、 `SINCE` 句を変更します。
              </td>
            </tr>

            <tr>
              <td>
                結果が最大行数に制限される
              </td>

              <td>
                NRQL は返される行の数を制限しています。返される最大行数よりも多くのホストがあり、ホストの完全なセットを取得したい場合は、データのサブセットを返すために、より多くの `WHERE` 句でクエリを絞り込むことができます (例えば、 `WHERE cloudInstanceId LIKE "%0"`)データを最大 16 グループに分割し、AWS インスタンス ID の最後の文字をモジュロします。
              </td>
            </tr>

            <tr>
              <td>
                ドッカーコンテナID
              </td>

              <td>
                単一のDockerコンテナIDは、このレポートには表示されません。DockerコンテナIDは、アプリケーションインスタンスレベルの粒度でのみ報告されます(`usageType='Application'`)。

                ホスト（`usageType='Host'` ）では、非常に多くのコンテナが存在するため、ユニークなコンテナの数が報告されます。ホストについて報告するコンテナIDを1つだけ選択することは有益でしたが、現在は適切な粒度でより多くのデータが報告されています。
              </td>
            </tr>

            <tr>
              <td>
                ビジネスルール
              </td>

              <td>
                `ビジネスルール` は、2 つの属性に置き換えられました。

                * `apmComputeUnitRule` では、エージェントから得られるデータに応じて、ホストのサイズをどのように計算するかを定義しています。また、コンテナ環境でより正確なホスト名を提供するために、エージェントを更新する必要があるかどうかの説明はなくなりました(`update_agent_for_container_environment`)。
                * `missingCpuData` 、 `missingRamData` 、 `instanceSizeCapped` は、 `missing_data` という値が `apmComputeUnitRule` 属性に存在する場合の意味を説明するブーリアンフラグです。
              </td>
            </tr>
          </tbody>
        </table>
      </Collapser>

      <Collapser
        id="agent-version-info"
        title="エージェントのバージョン情報"
      >
        このクエリを使用して、過去24時間にアプリケーション上で実行されているエージェントのバージョンを確認します。この情報は、Dockerコンテナ環境でより正確なホスト名（LinuxブートIDまたはクラウドプロバイダーのインスタンスID）を報告するために、エージェントをアップグレードする必要があるかどうかを判断するのに役立ちます。

        ```
        FROM NrDailyUsage 
        SELECT count(*) 
        WHERE productLine='APM' 
        AND usageType='Application' 
        FACET consumingAccountId, consumingAccountName, apmAppName, apmAgentVersion, apmLanguage 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="agents-container-upgrades"
        title="コンテナトラッキングのアップデートを必要とするエージェント"
      >
        このクエリは、エージェントがコンテナIDと同じかもしれないホスト名を報告しているアプリケーションを特定するのに役立ちます。このクエリの結果は、そのようなアプリケーションの決定的なリストではありませんが、どのアプリケーションが影響を受ける可能性があるかを判断するのに役立ちます。

        Dockerコンテナにちなんで不正確に名付けられたホストは、 `hostId` の値が、 `containerId` の値の最初の部分と同じになります。 `apmComputeUnitRule != 'cloud_provider_data'` 句は、クラウドプロバイダーによって命名され、したがって、エフェメラルコンテナにちなんで命名されていないホストを考慮から外します。

        ```
        FROM NrDailyUsage 
        SELECT latest(hostId) 
        WHERE containerId is not null 
        AND apmComputeUnitRule != 'cloud_provider_data' 
        AND productLine='APM' 
        AND usageType='Application' 
        FACET consumingAccountId,apmAppName,apmAgentVersion,apmLanguage,containerId 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親、子のアカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName, masterAccountName, masterAccountId, consumingAccountName, consumingAccountId 
        LIMIT 2000 SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>

    ### Dockerなどのコンテナの使用 [#containers]

    従来のAPMエージェントの中には、コンテナをホストとして誤カウントするものがあり、その結果、コンピュートユニット（CU）の使用量が過剰に報告されることがありました。

    Linuxベースのコンテナ（Dockerを含む）でこの計算を修正するには、 [、APMエージェント](/docs/agents/manage-apm-agents/installation/update-new-relic-agent) をこれらのバージョンにアップグレードしてください。

    * **Go**: 1.11以上
    * **Java**: 3.42.0 以上
    * **.NET**: 6.19.330.0 以上
    * **Node.js**: 2.1.0 以上
    * **PHP**: 7.5.0.199 以上
    * **Python**: 2.90.0.75 以上
    * **Ruby**: 4.4.0.336 以上
  </Collapser>

  <Collapser
    id="apm-host-based"
    title="APMのホストベースのサブスクリプション"
  >
    当社の [オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントについて、 [ホストベースの価格設定](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#host-based) (CU ベースの価格設定 [ではありません](/docs/apm-cu-based-usage-attributes-queries))の APM アカウントの請求可能な使用量を New Relic がどのように計算するかについて説明します。また、このドキュメントでは、利用可能なサブスクリプションの使用状況の属性と、 [NRQL クエリの例](#query-examples) を提供しており、New Relic の UI や API コールで使用することができます。

    ### データ作成 [#details]

    1日1回、APMアカウントは、 `NrDailyUsage` [event](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を生成します。

    * 過去24時間に存在したすべてのアプリケーションインスタンス
    * 過去24時間にアプリケーション・インスタンスが実行されたすべてのホスト

    これらの2種類のイベントにより、使用状況データを様々な方法で照会・分析することができます。アプリケーションイベントを照会するには、 `usageType` 属性値として `Application` を使用します。ホストイベントを照会するには、 `usageType` 属性値として `Host` を使用します。

    すべてのAPMイベントは、 `productLine` 属性値として、 `APM` を使用します。詳細については、 [APM クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    ホストベースのAPM価格では、毎月の請求対象となる使用量は、その月に使用された **相当のホスト** の数によって決定されます。 **相当のホスト** は以下のように定義されます。1 つのホストまたは複数のホストによる New Relic への接続時間が 750 時間 (標準的な月間時間数) であること。この計算方法の詳細については、 [ホストベースの価格設定](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#host-based) を参照してください。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を使って使用量データを照会できます。
    </Callout>

    当月の請求可能な使用量の推定値を得るため。

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **APMの使い方** ページで、タイムピッカーを **当月** に設定します。
    3. **Avg daily equivalent hosts** for an account or grouping of accounts をご覧ください。

    このUIは、ホストの使用量を推定するためのものですが、特にクラウド環境では、使用量が時間とともに増減する可能性があります。

    ## クエリの例

    ここでは、アカウントの使用状況データで使用できるNRQLクエリの例をご紹介します。NRQL クエリを実行して、結果のチャートをダッシュボードで使用することができます。

    <CollapserGroup>
      <Collapser
        id="last-month-query"
        title="先月の使用状況"
      >
        このクエリでは、先月のAPM相当のホストを計算する目的で、New Relicの標準的な月間時間数（750時間）を使用しています。

        ```
        SELECT sum(apmHoursUsed)/750 
        AS 'Equivalent hosts' 
        FROM NrDailyUsage 
        WHERE usageType='Host' 
        AND productLine='APM' 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="per-host-app-query"
        title="アプリケーションごとのホストごとの使用量"
      >
        New Relic は、厳密にはアプリケーションごとではなく、アプリケーション・インスタンスごとの使用量を記録します。このクエリは、特定のホスト上の特定のアプリケーションの使用量の近似値を示します。ある日のうちにホスト上で一意のアプリケーション・インスタンスが連続して実行される場合、このクエリは過小評価を返す可能性があります（これは、たとえばコンテナ環境ではありがちなことです）。

        ```
        SELECT max(apmHoursUsed) 
        FROM NrDailyUsage 
        WHERE usageType='Application' 
        AND productLine='APM' 
        FACET consumingAccountName,consumingAccountId,apmAppName,hostId 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="instance-hours-per-app-query"
        title="アプリケーションごとのインスタンス時間"
      >
        このクエリは、過去24時間にアプリケーションのすべてのインスタンス（プロセス）が使用した総時間数を測定します。どのアプリケーションがAPMの使用量の原因となっているかを判断するのに便利ですが、New RelicがAPMの使用量を価格設定する方法と正確に一致する結果は得られません。

        各アプリケーションインスタンスは、同じホスト上で他のアプリケーションインスタンスと同時に動作していても、このクエリでは個別にカウントされるため、アプリケーションインスタンス時間数はホスト時間数（請求可能な数量）よりも大きくなる可能性があります。

        ```
        SELECT sum(apmHoursUsed) 
        FROM NrDailyUsage 
        WHERE usageType='Application' 
        AND productLine='APM' 
        FACET consumingAccountName,consumingAccountId,apmAppName 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="agent-version-info"
        title="エージェントのバージョン情報"
      >
        このクエリを使用して、過去24時間にアプリケーション上で実行されているエージェントのバージョンを確認します。この情報は、Dockerコンテナ環境でより正確なホスト名（LinuxブートIDまたはクラウドプロバイダーのインスタンスID）を報告するために、エージェントをアップグレードする必要があるかどうかを判断するのに役立ちます。

        ```
        FROM NrDailyUsage 
        SELECT count(*) 
        WHERE productLine='APM' 
        AND usageType='Application' 
        FACET consumingAccountId, consumingAccountName, apmAppName, apmAgentVersion, apmLanguage 
        SINCE 1 day ago 
        LIMIT 2000
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName,masterAccountName,masterAccountId,consumingAccountName,consumingAccountId 
        LIMIT 2000 
        SINCE 1 day ago
        ```
      </Collapser>

      <Collapser
        id="legacy-usage-report"
        title="従来のホスト毎の使用量レポート"
      >
        このクエリは、廃止されたUIシステムで見られたCSVレポートに近いものを生成します。

        ```
        FROM NrDailyUsage 
        SELECT consumingAccountId 
        AS 'Account ID', hostId, cloudProvider 
        AS 'Host provider', cloudInstanceType 
        AS 'Instance type', apmBillingInstanceSize 
        AS 'Instance size', apmHoursUsed 
        AS 'Hours used', apmComputeUnits 
        AS 'Usage (CU)', apmMemoryBytes/(1024*1024*1024) 
        AS 'Total RAM', apmProcessorCount 
        AS 'Logical processors', apmContainerCount 
        AS 'Container count', apmComputeUnitRule 
        AS 'Business rule', missingCpuData, missingRamData, instanceSizeCapped, cloudZone, cloudInstanceId 
        WHERE productLine='APM' 
        AND usageType='Host' 
        SINCE 1 day ago 
        LIMIT 2000
        ```

        このNRQLクエリは、従来の使用レポートとは異なります。

        <table>
          <thead>
            <tr>
              <th style={{ width: "200px" }}>
                ホストごとのクエリ
              </th>

              <th>
                コメント
              </th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>
                期間
              </td>

              <td>
                このクエリには、過去24時間の使用状況のみが含まれています。より長い期間の使用量を集約して表示するには、 `SINCE` 句を変更します。
              </td>
            </tr>

            <tr>
              <td>
                結果が最大行数に制限される
              </td>

              <td>
                NRQL は返される行の数を制限しています。返される最大行数よりも多くのホストがあり、ホストの完全なセットを取得したい場合は、データのサブセットを返すために、より多くの `WHERE` 句でクエリを絞り込むことができます（例えば `WHERE cloudInstanceId LIKE "%0"` ）データを最大 16 グループに分割し、AWS インスタンス ID の最後の文字をモジュロします。
              </td>
            </tr>

            <tr>
              <td>
                ドッカーコンテナID
              </td>

              <td>
                単一のDockerコンテナIDは、このレポートには表示されません。DockerコンテナIDは、アプリケーションインスタンスレベルの粒度でのみ報告されます(`usageType='Application'`)。

                ホスト（`usageType='Host'` ）では、非常に多くのコンテナが存在するため、ユニークなコンテナの数が報告されます。ホストについて報告するコンテナIDを1つだけ選択することは有益でしたが、現在は適切な粒度でより多くのデータが報告されています。
              </td>
            </tr>

            <tr>
              <td>
                ビジネスルール
              </td>

              <td>
                `ビジネスルール` は、他の属性に置き換えられました。エージェントを更新する必要があるかどうかを表すのに使われなくなりました。
              </td>
            </tr>
          </tbody>
        </table>
      </Collapser>

      <Collapser
        id="legacy-host-usage-query"
        title="レガシーホスト使用レポート（アプリケーション一覧）"
      >
        このクエリは、かつて"ホスト使用状況レポート" で提供されていたデータ（各ホストで実行されているアプリケーションのリスト）を返します。なお、APMの使用量は1時間単位でカウントされますが、1時間単位の使用量データはAPIやUIでは利用できなくなりました。

        ```
        FROM NrDailyUsage 
        SELECT min(timestamp) 
        AS 'Earliest reporting day',max(timestamp) 
        AS 'Latest reporting day' 
        FACET apmAppName,hostId,agentHostname,consumingAccountName,consumingAccountId 
        WHERE usageType='Application' 
        AND productLine='APM' 
        SINCE 1 month ago 
        LIMIT 2000
        ```
      </Collapser>
    </CollapserGroup>

    ### Dockerなどのコンテナの利用 [#containers]

    以前の New Relic APM エージェントの中には、コンテナをホストとして誤カウントするものがあり、これによりホストベースの使用量が過剰に報告されることがあります。

    Linuxベースのコンテナ（Dockerを含む）でこの計算を修正するには、 [、APMエージェント](/docs/agents/manage-apm-agents/installation/update-new-relic-agent) をこれらのバージョンにアップグレードしてください。

    * **Go**: 1.11以上
    * **Java**: 3.42.0 以上
    * **.NET**: 6.19.330.0 以上
    * **Node.js**: 2.1.0 以上
    * **PHP**: 7.5.0.199 以上
    * **Python**: 2.90.0.75 以上
    * **Ruby**: 4.4.0.336 以上
  </Collapser>

  <Collapser
    id="browser-usage"
    title="ブラウザサブスクリプション"
  >
    [オリジナルの価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントに対して、ブラウザのサブスクリプション利用に対する請求可能な使用量の計算方法を説明しています。 また、本ドキュメントでは、利用可能なサブスクリプション使用量の属性と、New Relic UI や API コールで使用する [NRQL クエリの例を提供しています。](#query-examples)

    [](#query-examples)

    [シングルページアプリ（SPA）の監視使用については、 ](#query-examples)[SPAの使用](#spa) を参照してください。

    ### データ作成 [#data]

    1 時間に 1 回、監視対象のアプリケーションごとに、New Relic Browser アカウントが `NrUsage` [イベント](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を生成します。各イベントには、直近1時間の使用量がまとめられています。

    Browserの使用状況データを照会する際には、 `productLine` 属性値として、 `Browser` を使用してください。詳細については、 [Browser クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    月間使用量は、その月のすべてのエンドユーザーのブラウザにおけるページビューの合計数に相当します。AJAXトラフィックは、1日の使用量にはカウントされません。ページビューが長期的に安定している場合は、当月の使用量を見積もることができます。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。ただし、アカウントの誰もが `NrUsage` [event](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を使って使用状況データを照会できます。
    </Callout>

    UIで使用情報を表示するには

    1. に移動します。 **[account dropdown](/docs/using-new-relic/welcome-new-relic/get-started/glossary#account-dropdown) > View your usage**.
    2. **「ブラウザの使用状況」** ページで、タイムピッカーを **「過去30日間」** に設定します。
    3. **Avg daily page views** に当月の日数を掛けたものです。

    使用状況のUIについては、 [Introduction to New Relic subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) をご覧ください。

    ### 表の定義 [#details]

    ここでは、UIテーブルやCSVファイルに表示されるカラムヘッダーの定義を示します。表示される列は、ページ上部で選択されている「 **Group by** 」オプションによって異なります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            ヘッダー
          </th>

          <th>
            定義
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            アカウント名
          </td>

          <td>
            アカウントの名前です。これは、スタンドアロンのアカウント、 [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts) 、 [顧客パートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions) とすることができます。
          </td>
        </tr>

        <tr>
          <td>
            アカウントID
          </td>

          <td>
            New Relic [アカウントID](/docs/accounts-partnerships/accounts/account-setup/account-id).
          </td>
        </tr>

        <tr>
          <td>
            1日の平均ページビュー
          </td>

          <td>
            そのアカウントまたはアプリケーションの1日あたりの平均ページビューです。
          </td>
        </tr>

        <tr>
          <td>
            総使用量に占める割合
          </td>

          <td>
            全体の使用量に対する割合です。
          </td>
        </tr>
      </tbody>
    </table>

    ### クエリの例

    ここでは、サブスクリプション利用データで使用できるNRQLクエリの例を紹介します。NRQL クエリを実行して、結果のチャートをダッシュボードで使用することができます。

    <CollapserGroup>
      <Collapser
        id="page-views-last-month"
        title="過去1ヶ月間のページビュー"
      >
        このクエリは、過去1ヶ月間のページビューのカウントを表示します。

        ```
        SELECT sum(usage) 
        FROM NrUsage 
        WHERE productLine='Browser' 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="views-week-by-app-account"
        title="直近1週間のアカウント別ページビュー"
      >
        このクエリは、先週のページビューのカウントをアカウント別に表示します。

        ```
        SELECT sum(usage) 
        FROM NrUsage 
        WHERE productLine='Browser' 
        SINCE 7 days ago 
        FACET consumingAccountName
        ```
      </Collapser>

      <Collapser
        id="views-week-by-app-account"
        title="アプリケーション別の過去1ヶ月間のページビューです。"
      >
        このクエリは、アプリケーション別に過去1ヶ月のページビューのカウントを表示します。

        ```
        SELECT sum(usage) 
        FROM NrUsage 
        WHERE productLine='Browser' 
        SINCE 30 days ago 
        FACET browserAppID
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrUsage 
        FACET partnershipName,masterAccountName,masterAccountId,consumingAccountName,consumingAccountId 
        LIMIT 1000 
        SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>

    ### SPAの使い方 [#spa]

    ページビューは、 [New Relic Browser](/docs/browser/new-relic-browser/getting-started/new-relic-browser) がお客様のデータ使用量や製品価格を決定するために使用します。このドキュメントでは、New Relic Browser の [SPA モニタリング](/docs/browser/single-page-app-monitoring/get-started/welcome-single-page-app-monitoring) におけるページビューの定義とその理由について説明します。

    * SPAのモニタリング **は、** ブラウザのデータ使用には影響しません。
    * SPA モニタリング **は、** インサイトのデータ使用量が増加します。

    New Relic Browser では、 **ページビュー** は、 `window.onload` イベントの発火によって通知される、ページの完全なロードまたはリロードと定義されています。

    New Relic の [SPA モニタリング](/docs/browser/single-page-app-monitoring/use-spa-data/understand-spa-data-collection) は、従来のページビューを追跡するだけでなく、ページロードを必要としないブラウザ内の変化も追跡します。

    * ルートとハッシュの変更
    * 同期と非同期のJavaScript
    * サーバーサイドでのページの動的な更新

    ルートの変更は自動的に追跡され、 [カスタムインストルメント](/docs/browser/new-relic-browser/browser-agent-apis/report-data-events-browser-agent-api#spa-api) を設定することで、ほぼすべてのタイプのブラウザのインタラクションをキャプチャすることができます。

    [New Relic Browser Pro](https://newrelic.com/browser-monitoring/pricing) では、課金はアカウントの月間ページビュー数に基づいて行われます。 [SPAモニタリング](/docs/browser/single-page-app-monitoring/use-spa-data/understand-spa-data-collection) が有効な場合、ページロードを必要としないブラウザインタラクションは ****課金目的のページビューとしてカウントされません。SPAモニタリングでは、ページロードを伴わないルート変更やその他のカスタムブラウザインタラクションを無制限にトラッキングすることができます。

    ### Insightsの購読に関する注意事項 [#insights]

    標準のブラウザ監視からSPA監視に切り替え、Insightsもお支払いになった場合（Insightsの補完的なサブスクリプションのみを使用しない場合）、Insightsのデータ使用量が増加します。SPA監視はアプリケーションを監視するより高度な方法であるため、以下の理由で標準監視よりも多くのInsightsイベントが作成されます。

    * ページビューは、 `PageView` イベントだけでなく、 `BrowserInteraction`, `AjaxRequest`, `BrowserTiming` イベントも作成します。
    * 一般的なSPAアーキテクチャのアプリでは、通常のページロードよりもルート変更が多くなります。

    お客様がInsightsをお支払いになり、現在のInsightsのライセンスが、SPAモニタリングで生成される [イベント](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) の量に対して十分でない場合、データ使用量のプランを超えたことをお知らせします。これを改善するために、以下のオプションが用意されています。

    * インサイトプランのアップグレード
    * [一部のイベントタイプの報告をオフにする](/docs/accounts/accounts/data-management/event-data-retention).
    * [Browser API](/docs/browser/new-relic-browser/browser-agent-apis/report-data-events-browser-agent-api) を使用して、一部のイベントの収集を手動でオフにします。
    * Browser SPAの監視を標準の監視に戻す
  </Collapser>

  <Collapser
    id="mobile-usage"
    title="モバイルサブスクリプション"
  >
    [オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントについて、モバイルアカウントの請求可能な使用量の計算方法を説明しています。また、このドキュメントでは、利用可能なサブスクリプションの使用量属性と、 [NRQL クエリの例を示しています。](#query-examples) New Relic の UI や API コールで使用できます。

    ## データ作成 [#data]

    New Relic Mobile アカウントは、1 日に 1 回、監視対象のアプリケーションごとに、 `NrDailyUsage` [イベント](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を生成します。各イベントは、現在の暦月の過去 24 時間までの Mobile の使用状況をまとめたものです。

    Mobileの使用状況データを照会するには、 `productLine` 属性値として、 `Mobile` を使用します。詳細については、 [Mobile クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    New Relic Mobile のサブスクリプションの使用量は、月間アクティブユーザー (MAU) の概念に基づいています。

    * New Relic が監視しているモバイルアプリの場合、MAU は、1 暦月中にそのアプリを使用したユニークユーザーの累積カウントを表します。この指標では、ユニークなエンドユーザーのモバイルデバイスはそれぞれ、"ユーザー" としてカウントされます。
    * 複数のアプリをお持ちのアカウントの場合、アカウントの総使用量は、そのアカウントの下にあるすべてのアプリのMAUの合計となります。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type) を使って使用量データを照会できます。
    </Callout>

    当月の請求可能な使用量の推定値を得るため。

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **モバイルの使用状況** ページで、タイムピッカーを **「当月」** に設定します。

    モバイル使用率のグラフと表は、一定期間に到達した最大MAUを表示します。通常、月の初めに急速に増加し、その後、月を通してゆっくりと増加します。この値は、これまでに発見された最大値を表しているため、下がることはありません。このため、モバイルの使用率は、日々の使用量の合計に基づく他のNew Relicの使用率測定値とは異なります。

    使用状況のUIについては、 [Introduction to New Relic subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) をご覧ください。

    ### 表の定義 [#table]

    ここでは、UIテーブルやCSVファイルに表示されるカラムヘッダーの定義を示します。表示される列は、ページ上部で選択されている「 **Group by** 」オプションによって異なります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            ヘッダー
          </th>

          <th>
            定義
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            アカウント名
          </td>

          <td>
            アカウントの名前です。これは、スタンドアロンのアカウント、 [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts) 、 [顧客パートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions) とすることができます。
          </td>
        </tr>

        <tr>
          <td>
            アプリケーション名
          </td>

          <td>
            モバイルアプリケーションの名前です。
          </td>
        </tr>

        <tr>
          <td>
            アプリケーションID
          </td>

          <td>
            New Relic Mobile [アプリケーションID](/docs/using-new-relic/welcome-new-relic/getting-started/glossary#application_id).
          </td>
        </tr>

        <tr>
          <td>
            最大MAU
          </td>

          <td>
            月間最大アクティブユーザー数。現在の暦月において、到達したアクティブユーザーの最高カウント数。この数値は、New Relic のサブスクリプションに含まれる MAU と比較することができます。
          </td>
        </tr>

        <tr>
          <td>
            総使用量に占める割合
          </td>

          <td>
            グループ（アカウントまたはアプリケーション、 **Group by** の選択による）に帰属する総使用量の割合です。
          </td>
        </tr>
      </tbody>
    </table>

    ### クエリの例

    ここでは、サブスクリプション利用データで使用できるNRQLクエリの例を紹介します。NRQL クエリを実行して、結果のチャートをダッシュボードで使用することができます。

    <CollapserGroup>
      <Collapser
        id="users-last-month"
        title="直近1ヶ月間の月間アクティブユーザー数（MAU"
      >
        直近の完全な月の月間アクティブユーザー数のグラフです。

        ```
        SELECT sum(mobileUniqueUsersPerMonth) 
        FROM NrDailyUsage 
        WHERE usageType='Application' AND productLine='Mobile' 
        SINCE last month UNTIL this month TIMESERIES 1 day
        ```

        その月の請求可能なMAU数は、このグラフ上の最大数です。また、 `since` 句に月の最終日を使うなどして、このクエリで特定の月の請求可能数を直接取得することもできます。

        ```
        SELECT sum(mobileUniqueUsersPerMonth) 
        FROM NrDailyUsage 
        SINCE '<var>2018-05-31</var>' UNTIL '<var>2018-06-01</var>'
        ```
      </Collapser>

      <Collapser
        id="users-last-month-by-app"
        title="月間アクティブユーザー数（MAU）、アプリ別、直近1ヶ月間"
      >
        直近1ヶ月間の月間アクティブユーザー数を、アプリケーション名でファセットしたもの。

        ```
        SELECT max(mobileUniqueUsersPerMonth) 
        FROM NrDailyUsage 
        WHERE usageType='Application' AND productLine='Mobile' 
        SINCE last month UNTIL this month 
        FACET mobileAppName
        ```

        これらの数字の合計が、最後の完全な月のアカウントの請求可能なMAUとなります。
      </Collapser>

      <Collapser
        id="unique-apps-last-month"
        title="直近1ヶ月のユニークなモバイルアプリ"
      >
        このクエリは、過去1ヶ月間のユニークなモバイルアプリケーションの数を表示します。

        ```
        SELECT uniqueCount(mobileAppName) 
        FROM NrDailyUsage 
        WHERE usageType='Application' AND productLine='Mobile' 
        SINCE 1 month ago
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName,masterAccountName,masterAccountId,consumingAccountName,consumingAccountId 
        LIMIT 1000 
        SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="infrastructure-usage"
    title="インフラストラクチャー・サブスクリプション"
  >
    [オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントについて、インフラストラクチャアカウントの請求可能な使用量の計算方法を説明します。また、このドキュメントでは、利用可能なサブスクリプションの使用量属性と、 [NRQL クエリの例を示しています。](#query-examples) New Relic UI や API コールで使用できます。

    ### データ作成 [#data]

    1 日に 1 回、New Relic Infrastructure アカウントは、過去 24 時間にアプリケーション インスタンスが存在したすべてのユニークなホストに対して、 `NrDailyUsage` [イベント](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を生成します。すべての Infrastructure イベントは、 `productLine` 属性値が `Infrastructure` となります。詳細については、 [クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    ホストの毎月の請求可能な CU は、Infrastructure を実行しているホストのサイズ (CPU 数 + RAM GB 数) に、その月にホストが New Relic に接続している時間数を乗じて算出されます。この計算方法の詳細については、 [CU ベースの価格設定](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#compute-unit) をご覧ください。

    長期的に使用量が安定している場合は、当月の使用量を推定することができます。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を使って使用量データを照会することができます。
    </Callout>

    UIで使用情報を表示するには

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **インフラストラクチャの使用状況** ページで、タイムピッカーを **過去30日** に設定します。
    3. **Avg daily compute units** に当月の日数を掛けてください。

    Usage UIについては、 [Introduction to subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) を参照してください。

    ### 表の定義 [#details]

    ここでは、UIテーブルやCSVファイルに表示されるカラムヘッダの定義を示します。表示される列は、ページ上部で選択されている **Group by** オプションによって異なります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            ヘッダー
          </th>

          <th>
            定義
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            アカウント名
          </td>

          <td>
            アカウントの名前です。これは、スタンドアロンのアカウント、 [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts) または [顧客パートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions) とすることができます。
          </td>
        </tr>

        <tr>
          <td>
            アカウントID
          </td>

          <td>
            New Relic [アカウントID](/docs/accounts-partnerships/accounts/account-setup/account-id).
          </td>
        </tr>

        <tr>
          <td>
            エージェントのホスト名
          </td>

          <td>
            エージェントから報告されたホストの名前です。この値の詳細については、 [`agentHostname`](/docs/apm-cu-based-usage-attributes-queries#agenthostname) を参照してください。
          </td>
        </tr>

        <tr>
          <td>
            1日の平均計算ユニット数
          </td>

          <td>
            1日の平均的な [compute units](/docs/accounts/accounts/subscription-pricing/compute-unit-cu-pricing-vs-host-based-pricing-apm-infrastructure#compute-unit) を使用しています。
          </td>
        </tr>

        <tr>
          <td>
            総使用量に占める割合
          </td>

          <td>
            全体の使用量に対する割合です。
          </td>
        </tr>
      </tbody>
    </table>

    ### クエリの例

    ここでは、Infrastructureサブスクリプションの使用データで使用できるNRQLクエリの例を紹介します。NRQL クエリを実行して、結果のチャートをダッシュボードで使用することができます。

    NRQL クエリを使用して焦点を絞った使用データを取得する方法についての一般的な情報は、 [使用データの紹介](/docs/introduction-new-relic-subscription-usage-data) を参照してください。

    <CollapserGroup>
      <Collapser
        id="cus-month-query"
        title="先月の計算ユニット"
      >
        このクエリは、過去1ヶ月間に使用されたCUのカウントを生成します。

        ```
        SELECT sum(infrastructureComputeUnits) 
        FROM NrDailyUsage 
        WHERE productLine='Infrastructure' 
        AND usageType='Host' 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="host-report-query"
        title="ホストの詳細レポート（旧使用レポートの再現）"
      >
        このクエリは、以前に提供されていたInfrastructureサブスクリプションの使用状況のUIからCSVをダウンロードして得られたレポートを可能な限り再現しています。

        ```
        FROM NrDailyUsage 
        SELECT consumingAccountId 
        AS 'Account ID',agentHostname,cloudProvider 
        AS 'Host provider', cloudInstanceType 
        AS 'Instance type',infrastructureBillingInstanceSize 
        AS 'Instance size',infrastructureHoursUsed 
        AS 'Hours used',infrastructureComputeUnits 
        AS 'Usage (CU)', infrastructureCloudDerivedMemoryBytes/(1024*1024*1024) 
        AS 'Total RAM',infrastructureCloudDerivedProcessorCount 
        AS 'Logical processors',infrastructureAgentMemoryBytes/(1024*1024*1024) 
        AS 'Total RAM',infrastructureAgentProcessorCount 
        AS 'Logical processors',infrastructureComputeUnitRule 
        AS 'Business rule',missingCpuData, missingRamData, instanceSizeCapped,cloudZone,cloudInstanceId 
        WHERE productLine='Infrastructure' 
        AND usageType='Host' 
        SINCE 1 day ago 
        LIMIT 1000
        ```

        このNRQLクエリは、従来の使用レポートとは異なります。

        <table>
          <thead>
            <tr>
              <th style={{ width: "200px" }}>
                ホストの詳細検索
              </th>

              <th>
                コメント
              </th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>
                期間
              </td>

              <td>
                このクエリには、最後の日の使用状況のみが含まれます。より長い期間の使用量を集計するには、SINCE 句を変更します。
              </td>
            </tr>

            <tr>
              <td>
                結果は1000件に限定
              </td>

              <td>
                NRQL は結果を 1000 に制限します。1000 以上のホストがあり、ホストの完全なセットを取得したい場合は、データのサブセットを返すために、より多くの `WHERE` 節でクエリを絞り込むことができます (たとえば、 `WHERE agentHostname LIKE ...` でデータをグループに分割します)。
              </td>
            </tr>

            <tr>
              <td>
                ビジネスルール
              </td>

              <td>
                `ビジネスルール` は、2 つの属性に置き換えられました。

                * `infrastructureComputeUnitRule` では、エージェントから得られるデータに応じて、ホストのサイズをどのように計算するかを定義しています。また、コンテナ環境でより正確なホスト名を提供するために、エージェントを更新する必要があるかどうかの説明はなくなりました(`update_agent_for_container_environment`)。
                * `missingCpuData` 、 `missingRamData` 、 `instanceSizeCapped` は、 `missing_data` という値が `infrastructureComputeUnitRule` 属性に存在する場合の意味を説明するブーリアンフラグになりました。
              </td>
            </tr>
          </tbody>
        </table>
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName,masterAccountName,masterAccountId,consumingAccountName,consumingAccountId 
        LIMIT 1000 
        SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="insights-usage"
    title="インサイト購読"
  >
    当社の [オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントについては、これで説明します。

    * New Relic が [Insights Pro サブスクリプションの請求可能な使用量を計算する方法](/docs/insights/use-insights-ui/manage-account-data/extend-event-data-retention#insights-pro).
    * 利用可能なサブスクリプションの使用属性と [NRQL クエリの例](#query-examples) New Relic UI や API 呼び出しで使用できます。

    ### データ作成 [#data]

    1日1回、Insights Proを契約しているアカウントは、 `NrDailyUsage` [イベント](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) [イベントのネームスペース](#namespace) を生成します。 `NrDailyUsage` イベントには、そのネームスペース下のイベントのカウントが含まれます。

    このイベントの属性を見るには、データ辞書 `NrDailyUsage` [のエントリ](/attribute-dictionary/?event=NrDailyUsage) を参照してください。

    ### 使用量計算 [#calculation]

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を使って使用量データを照会することができます。
    </Callout>

    当月の請求可能な使用量の推定値を得るため。

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **Insights usage** ページで、タイムピッカーを **Current month** に設定します。

    Usage UIについては、 [Introduction to subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) を参照してください。

    Insights の使用状況の UI では、 **有料のイベントのみが表示されます**: これは、 [Insights Pro のサブスクリプションにカウントされるイベントです](/docs/insights/use-insights-ui/manage-account-data/extend-event-data-retention#insights-pro) 。 ****他の New Relic 製品のサブスクリプションの一部として無料で含まれているイベントは表示されません。ただし、 [製品に含まれるイベントを照会することもできます](#query-examples) 。

    特定のイベントがどのくらいの期間保持されるかは、各イベントタイプの [データ保持期間](/docs/insights/use-insights-ui/manage-account-data/insights-data-retention) によります。適用可能なイベントタイプのリストについては、 [Event namespaces](#namespace) を参照してください。

    ### 表の定義 [#details]

    ここでは、UIのテーブルとCSVファイルに表示されるカラムヘッダーの定義を示します。表示される列は、UIで選択した「 **Group by** 」オプションによって異なります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            ヘッダー
          </th>

          <th>
            定義
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            アカウント名
          </td>

          <td>
            アカウントの名前です。これは、独立したアカウント、 [親アカウント](/docs/accounts/install-new-relic/account-setup/manage-apps-or-users-sub-accounts) 、または [パートナーシップ](/docs/new-relic-partnerships/partner-integration-guide/partner-account-maintenance/partnership-accounts-users-subscriptions) とすることができます。
          </td>
        </tr>

        <tr>
          <td>
            アカウントID
          </td>

          <td>
            [New RelicアカウントID](/docs/accounts/install-new-relic/account-setup/account-id).
          </td>
        </tr>

        <tr>
          <td>
            イベントの名前空間
          </td>

          <td>
            Insights サブスクリプションで管理されるイベントのカテゴリー。例： `APM` または `Mobile error` 。詳細については、 [event namespaces のリスト](/docs/accounts/new-relic-account-usage/insights-usage/insights-usage-attributes-queries#namespace) を参照してください。
          </td>
        </tr>

        <tr>
          <td>
            保存された有料イベント
          </td>

          <td>
            [Insights Pro サブスクリプションにカウントされる保存されたイベントの数](/docs/insights/use-insights-ui/manage-account-data/extend-event-data-retention#insights-pro) 。他の New Relic 製品のサブスクリプションの一部として含まれるイベントはカウントされません。
          </td>
        </tr>

        <tr>
          <td>
            総使用量に占める割合
          </td>

          <td>
            全体の使用量に対する割合です。
          </td>
        </tr>
      </tbody>
    </table>

    ### イベントの名前空間（タイプ） [#namespace]

    [Insights Proのサブスクリプション](/docs/insights/use-insights-ui/manage-account-data/extend-event-data-retention#insights-pro) は、特定のタイプのイベントのデータ保持を管理します。イベントの名前空間（ [`insightsEventNamespace`](#insightsEventNamespace) 属性で示される）は、単一の [データ保持](/docs/using-new-relic/welcome-new-relic/getting-started/data-retention-components) ポリシーを共有する1つまたは複数のイベントタイプに対応します。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            UIのイベント名前空間
          </th>

          <th style={{ width: "250px" }}>
            問い合わせ時のイベントの名前空間
          </th>

          <th>
            イベントの種類
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            APM トランザクション
          </td>

          <td>
            `APM`
          </td>

          <td>
            `トランザクション`
          </td>
        </tr>

        <tr>
          <td>
            APMのエラー
          </td>

          <td>
            `APMのエラー`
          </td>

          <td>
            `TransactionError`
          </td>
        </tr>

        <tr>
          <td>
            ブラウザ
          </td>

          <td>
            `ブラウザ`
          </td>

          <td>
            `Ajax`

            `PageAction`

            `PageView`
          </td>
        </tr>

        <tr>
          <td>
            ページビューのタイミング
          </td>

          <td>
            `PcvPerf`
          </td>

          <td>
            `PageViewTiming`
          </td>
        </tr>

        <tr>
          <td>
            SPAモニタリング
          </td>

          <td>
            `ブラウザ:イベントログ`
          </td>

          <td>
            `AjaxRequest`

            `BrowserInteraction`

            `ブラウザータイミング`
          </td>
        </tr>

        <tr>
          <td>
            JSエラー
          </td>

          <td>
            `ブラウザ：JSErrors`
          </td>

          <td>
            `JavaScriptError`
          </td>
        </tr>

        <tr>
          <td>
            カスタム：\*。
          </td>

          <td>
            `カスタム：*。`
          </td>

          <td>
            New Relic で作成されたカスタムフィルターを使用して保存されたイベントタイプです。ほとんどのお客様には適用されません。
          </td>
        </tr>

        <tr>
          <td>
            カスタムイベント
          </td>

          <td>
            `デフォルト`
          </td>

          <td>
            [New Relic エージェントや Event API を使用して作成したカスタムイベントタイプ](/docs/insights/insights-data-sources/custom-data/send-custom-data-insights)
          </td>
        </tr>

        <tr>
          <td>
            [クラッシュイベントの軌跡](/docs/mobile-monitoring/new-relic-mobile/maintenance/add-custom-data-new-relic-mobile#custom-breadcrumbs)
          </td>

          <td>
            `ブレッドクラム`
          </td>

          <td>
            `MobileBreadcrumb`
          </td>
        </tr>

        <tr>
          <td>
            モバイルクラッシュ
          </td>

          <td>
            `モバイルクラッシュ`
          </td>

          <td>
            `MobileCrash`
          </td>
        </tr>

        <tr>
          <td>
            モバイルエラー（ [HTTP リクエスト](/docs/mobile-monitoring/mobile-monitoring-ui/network-pages/http-requests-page) および [HTTP エラー](/docs/mobile-monitoring/mobile-monitoring-ui/network-pages/http-errors-network-failure-analysis) 機能の場合）
          </td>

          <td>
            `モバイルエラー`
          </td>

          <td>
            `MobileRequest`

            `MobileRequestError`
          </td>
        </tr>

        <tr id="partnershipId">
          <td>
            モバイルの例外
          </td>

          <td>
            `モバイル・エクセプション`
          </td>

          <td>
            `MobileHandledException`
          </td>
        </tr>

        <tr id="partnershipName">
          <td>
            モバイル総合
          </td>

          <td>
            `モバイル総合`
          </td>

          <td>
            `モバイル`
          </td>
        </tr>

        <tr id="productLine">
          <td>
            モバイルセッション
          </td>

          <td>
            `モバイルセッション`
          </td>

          <td>
            `モバイルセッション`
          </td>
        </tr>
      </tbody>
    </table>

    ### クエリの例

    Insightsの使用データを最大限に活用するためには

    * このデータのクエリを実行し、カスタムチャートやダッシュボードを作成することができます。
    * 当社のAPIを使用してプログラム的にこのデータを使用します。

    NRQL クエリの使用方法に関する一般的な情報については、 [使用データの紹介](/docs/introduction-new-relic-subscription-usage-data) を参照してください。

    <Callout variant="tip">
      Insights は使用イベント [を1日1回書き込んでいます](#data) 。そのため、これらのクエリでは `24時間前から` または `1日の時系列` を使用しています。
    </Callout>

    使い方に関するNRQLクエリの例をご紹介します。

    <CollapserGroup>
      <Collapser
        id="example-account-events"
        title="先月のストアドイベント使用量"
      >
        このクエリは、クエリが実行されたアカウントの下の階層にあるすべてのアカウント（親アカウントと子アカウント）について、前暦月のInsights統治下のイベントの"請求可能な" 数を示します。この数字は、保存されているイベントの1日の平均数として計算されます。

        ```
        SELECT rate(sum(insightsTotalEventCount)-sum(insightsIncludedEventCount), 1 day) 
        AS 'Paid events' 
        FROM NrDailyUsage 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="example-single-account"
        title="アカウントの現在のインサイト使用量"
      >
        このクエリは、特定のアカウントに現在保存されているInsights統治下のイベントの数を、 [イベントの名前空間](#insightsEventNamespace) によって分類して表示します。これらのクエリでは、 <var>YOUR_ACCOUNT_ID</var> を必ず [アカウントID](/docs/accounts/install-new-relic/account-setup/account-id) に置き換えてください。

        ```
        SELECT latest(insightsTotalEventCount) 
        FROM NrDailyUsage 
        SINCE 24 hours ago 
        WHERE consumingAccountId = <var>YOUR_ACCOUNT_ID</var> 
        FACET insightsEventNamespace
        ```

        このクエリでは、特定のアカウントのすべてのイベントネームスペースについて、現在のInsightsが管理するイベントストレージの合計を知ることができます。

        ```
        SELECT sum(insightsTotalEventCount) 
        FROM NrDailyUsage 
        SINCE 24 hours ago 
        WHERE consumingAccountId = <var>YOUR_ACCOUNT_ID</var>
        ```
      </Collapser>

      <Collapser
        id="example-multiple-accounts"
        title="複数のアカウントにおける現在のインサイトの使用状況"
      >
        このクエリは、 [イベントのネームスペース](#insightsEventNamespace) によって、アカウントのリストに現在保存されている Insights 統治のイベントの数を示します。なお、このクエリでは、 <var>LIST_OF_ACCOUNT_IDs</var> を [アカウントIDのリスト](/docs/accounts/install-new-relic/account-setup/account-id) に置き換える必要があります。

        ```
        SELECT latest(insightsTotalEventCount) 
        FROM NrDailyUsage SINCE 24 hours ago 
        WHERE consumingAccountId 
        IN (<var>LIST_OF_ACCOUNT_IDs</var>) 
        FACET consumingAccountId, insightsEventNamespace 
        LIMIT 100
        ```

        このクエリですべてのファセットを表示するには、 `limit` 句の値を増やす必要があるかもしれません。
      </Collapser>

      <Collapser
        id="example-product"
        title="他のNew Relic製品に含まれるイベント"
      >
        このクエリは、他の New Relic 製品のサブスクリプションに含まれる Insights 統治のイベントが、そのイベントを作成した製品によって、過去 7 日間にアカウントに保存された数を示します。なお、クエリ内の <var>YOUR_ACCOUNT_ID</var> は、 [アカウントID](/docs/accounts/install-new-relic/account-setup/account-id) に置き換える必要があります。

        ```
        SELECT sum(insightsIncludedEventCount) 
        FROM NrDailyUsage 
        SINCE 7 days ago 
        WHERE consumingAccountId = <var>YOUR_ACCOUNT_ID</var> 
        FACET insightsNrProduct 
        TIMESERIES 1 day
        ```
      </Collapser>

      <Collapser
        id="example-subaccount"
        title="子アカウントとイベントネームスペースごとの保存期間"
      >
        このクエリは、指定された親アカウント ID の下にある各子アカウントについて、さまざまな New Relic 製品に関連するさまざまなイベント カテゴリ (APM `Transaction` イベントなど) の合計、支払い済み、および含まれる保持期間を示します。独自の NRQL クエリを作成する場合は、必ず <var>YOUR_ACCOUNT_ID</var> をお客様固有の [アカウント ID](/docs/accounts/install-new-relic/account-setup/account-id) に置き換えてください。

        ```
        SELECT latest(insightsTotalRetentionInHours)/24 
        AS 'Total retention, days', latest(insightsIncludedRetentionInHours)/24 
        AS 'Included retention, days', (latest(insightsTotalRetentionInHours) - 
        latest(insightsIncludedRetentionInHours))/24 
        AS 'Paid retention, days' 
        FROM NrDailyUsage where productLine='Insights' 
        AND masterAccountId = <var>YOUR_ACCOUNT_ID</var> 
        FACET consumingAccountId,consumingAccountName,insightsEventNamespace 
        SINCE 1 day ago
        ```
      </Collapser>

      <Collapser
        id="example-pro-subaccount"
        title="子アカウントによる有料インサイトの利用"
      >
        このクエリは、Insights Pro サブスクリプションの下で、指定された親アカウント ID の各子アカウントが過去 7 日間に消費したイベントの数を示します。独自の NRQL クエリを作成する場合は、クエリ内の <var>YOUR_MASTER_ACCOUNT_ID</var> を、特定の親 [アカウント ID](/docs/accounts/install-new-relic/account-setup/account-id) に置き換えるようにしてください。

        ```
        SELECT sum(insightsTotalEventCount)-sum(insightsIncludedEventCount) 
        AS 'Paid events' from NrDailyUsage 
        SINCE 7 days ago 
        WHERE masterAccountId = <var>YOUR_MASTER_ACCOUNT_ID</var> 
        FACET consumingAccountId, consumingAccountName 
        TIMESERIES 1 day
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        このクエリは、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName,masterAccountName,masterAccountId,
        consumingAccountName,consumingAccountId 
        LIMIT 1000 
        SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>
  </Collapser>

  <Collapser
    id="synthetics-usage"
    title="シンセティック・サブスクリプション"
  >
    [オリジナル価格モデル](/docs/accounts/original-accounts-billing/product-pricing/product-based-pricing) のアカウントに対して、Synthetics アカウントの請求可能な使用量を計算する方法を説明します。また、このドキュメントでは、利用可能なサブスクリプションの使用量属性と、 [NRQL クエリの例を示しています。](#query-examples) New Relic UI や API コールで使用できます。

    ### データ作成 [#data]

    New Relic Synthetics のサブスクリプションレベルは、1 暦月中に使用される非[ping](/docs/synthetics-subscription-usage-attributes-queries#label) モニタチェックの数に基づいています。Syntheticsのモニターロケーションは、1日1回、 `NrDailyUsage` [イベント](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) [モニタータイプ](#type) を生成します。このイベントは、その場所とモニタータイプの過去24時間のSyntheticsの使用状況をまとめたものです。

    すべてのSyntheticsの使用イベントは、 `productLine` 属性値が `Synthetics` となっています。詳細については、Synthetics [クエリの例](#query-examples) を参照してください。

    ### 使用量計算 [#calculation]

    New Relic Synthetics のサブスクリプションレベルは、暦月中に使用された非[ping](/docs/synthetics-subscription-usage-attributes-queries#label) のモニターチェックの数に基づいています。モニターチェックが長期的に安定している場合は、当月の使用量を推定することができます。

    <Callout variant="tip">
      アカウント **Owner** と **Admins** だけが使用量の UI を見ることができます。しかし、アカウントの誰もが `NrDailyUsage` [event](/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic) を使って使用量データを照会することができます。
    </Callout>

    UIで使用情報を表示するには

    1. [使い方のUI](/docs/accounts/accounts-billing/general-account-settings/introduction-account-settings/#pricing) にアクセスしてください。
    2. **Synthetics usage** ページで、time picker を **Last 30 days** に設定します。
    3. **Avg daily paid checks** に当月の日数を掛けてください。

    Syntheticsの使用チャートは、モニターチェックの日次カウントを表示します。表の値 **Avg daily paid checks** は、選択した期間のモニターチェックの総数を日数で割って表示します。

    Usage UIについては、 [Introduction to subscription usage data](/docs/accounts/new-relic-account-usage/getting-started-usage/introduction-new-relic-subscription-usage-data) を参照してください。

    ### クエリの例

    ここでは、Syntheticsサブスクリプションの使用データで使用できるNRQLクエリの例を紹介します。NRQLクエリを実行して、結果のチャートをダッシュボードで使用することができます。

    <CollapserGroup>
      <Collapser
        id="billable-checks-last-month"
        title="先月の請求書チェック"
      >
        このクエリは、先月の請求可能なモニターチェックのチャートを作成します。 `syntheticsType` of `SIMPLE` は、 [ping monitor](/docs/synthetics/new-relic-synthetics/getting-started/types-synthetics-monitors#types-monitors) を参照しており、有料使用量にはカウントされないことに注意してください。

        ```
        FROM NrDailyUsage 
        SELECT sum(syntheticsFailedCheckCount) + sum(syntheticsSuccessCheckCount) 
        AS 'Paid checks' where productLine='Synthetics' 
        AND syntheticsType != 'SIMPLE' 
        SINCE last month 
        UNTIL this month
        ```
      </Collapser>

      <Collapser
        id="account-hierarchy-query"
        title="アカウントの階層"
      >
        これは、製品に依存しないクエリで、アカウントの階層（パートナーシップ、親アカウント、子アカウント）を確認するのに便利です。

        ```
        SELECT count(*) 
        FROM NrDailyUsage 
        FACET partnershipName,masterAccountName,masterAccountId,consumingAccountName,consumingAccountId 
        LIMIT 1000 
        SINCE 1 day ago
        ```
      </Collapser>
    </CollapserGroup>
  </Collapser>
</CollapserGroup>