---
title: NRQL によるエンティティとリレーションシップの例 (NRQL による E&R)
metaDescription: Examples of NRQL queries for entities & relationships
freshnessValidatedDate: '2024-03-19T00:00:00.000Z'
translationType: machine
---

New Relic書き込み言語 (NRQL) を使用してエンティティと関係データを直接記述することにより、システム分析を合理化します。 このアプローチは、CPU パフォーマンスとホスト属性の関連付け、過去のエンティティ状態の表示、設定変更の追跡などの重要なタスクの面倒な手動プロセスを置き換え、複雑な環境に高速なインサイトを提供します。

このデータを作成するには、高度な計算が必要です。エンティティ イベント タイプ (および関係固有の書き込みには Relationships またはentityRelationships) を使用します。

<Callout variant="tip">
  NRQL を使用してエンティティとリレーションシップをクエリするのは初めてですか?これらの例を検討する前に、 [NRQL 経由の E&amp;R の概念と利点](/docs/nrql/get-started/query-entities-and-relationships-via-nrql)について学習してください。
</Callout>

以下の実用的な NRQL ソリューションをご確認ください。

<CollapserGroup>
  <Collapser id="total-tx" title="CPU使用率とホスト属性を相関させる">
    * **目的**: 運用チームは、特定の AWS リージョン (例: &apos;eu-central-1&apos;) にあるすべての本番ホストの CPU 使用率を分析し、潜在的なパフォーマンスのボトルネックを特定する必要があります。
    * **課題**: これには、多くの場合、ホスト データとパフォーマンス メトリクスを個別にエクスポートし、外部ツールまたは複雑なスクリプトを使用してそれらを結合して分析する必要がありました。
    * **NRQLソリューション**:

    ```sql
    FROM SystemSample
    JOIN (FROM Entity SELECT id, name WHERE type = 'INFRA-HOST' AND `tags.aws.awsRegion` = 'eu-central-1')
    ON entityGuid = id
    SELECT average(cpuPercent) FACET name
    ```
  </Collapser>

  <Collapser id="total-tx" title="特定の時点でのエンティティの状態を表示する">
    * **目的**: 開発者は数時間前に発生したインシデントを調査しており、その特定の時点での特定のホスト (またはコンテナ、アプリケーションなど) の正確な設定または状態を知る必要があります。

    * **課題**: 過去の特定の期間からエンティティのプロパティのスナップショットを取得することは、多くの場合不可能であったり、大量の設定ログが存在する場合でもそれらを精査する必要がありました。

    * **NRQL ソリューション**: このクエリは、7 時間前から 1 時間という狭い時間枠内で、特定のエンティティ (ID で識別) の使用可能なすべての属性を取得します。

    ```sql
    FROM Entity
    SELECT *
    WHERE id = '<your_entity_id>'
    SINCE 7 hours ago UNTIL 6 hours ago
    LIMIT 1
    ```
  </Collapser>

  <Collapser id="total-tx" title="エンティティの状態変化の追跡">
    * **目的**: SRE 、エンティティの設定または主要なプロパティが過去数時間でどのように変化したかを理解したいと考えています。おそらく、デプロイメントまたは自動化されたプロセスによってその状態が予想どおりに変更されたかどうかを確認したいと考えています。

    * **課題**: エンティティの状態の微妙な変化を時間の経過とともに追跡することは困難であり、多くの場合、手動での比較やカスタム監視スクリプトが必要でした。

    * **NRQL ソリューション**: このクエリは、過去 3 時間以内の特定のエンティティの記録されたすべての状態を取得し、変更の監査を可能にします。

    ```sql
      SELECT *
      FROM Entity
      WHERE id = '<your_entity_id>'
      SINCE 3 hours ago
    ```
  </Collapser>

  <Collapser id="total-tx" title="ホストに関連するアプリケーションの検索">
    * **目的**: 特定のホストで実行されているアプリケーションを識別する

    * **課題**: アプリケーションとホストの関連付けが困難

    * **NRQLソリューション**:

    ```sql
    FROM EntityRelationship SELECT sourceEntityGuid, targetEntityGuid, sourceEntityType, targetEntityType, relationshipType   where (sourceEntityType like '%HOST%' and targetEntityType='APPLICATION') or (targetEntityType LIKE '%HOST%' and sourceEntityType='APPLICATION')
    ```
  </Collapser>
</CollapserGroup>