---
title: 異常検知
tags:
  - Anomaly detection
  - Alerts
metaDescription: Learn how anomaly detection in New Relic notifies you of unusual app behavior.
freshnessValidatedDate: never
translationType: machine
---

異常検出により、チームはシステム内の異常な動作を検出する際に最大限の汎用性を得ることができます。 異常検出により、チームはエンティティや信号を集計し、感度値を調整して最適化することができます。 異常検出では、静的閾値アラートと同じストリーミング アラート パイプラインを使用し、同じ詳細なチューニング設定を共有します。 これにより、ストリーム処理がテレメトリー信号の特性に合わせて調整され、誤った警告が減少します。

異常検出設定を追加のメタデータで強化して、さらに詳しいコンテキストを提供したり、オンコールのエンジニアに追加の指示を提供できるカスタムの集中イベントの説明を追加したりできます。 デフォルトでは、異常状態は New Relic による自動季節性検出を活用します。あるいは、季節性をカスタム設定することもできます。

## 異常感度閾値を設定する [#configure-custom-anomalies]

[アラート条件](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-nrql-alert-conditions/)から異常感度閾値を作成できます。 異常値を設定するためのヒントをいくつか示します。

* [異常の方向を](#anomaly-direction)異常の上または下で発生するイベントを監視するように設定します。
* [季節性](#seasonality)を設定して、既知の季節性パターンを指定します。
* スライダー バーを使用して、プレビュー チャートで信号の周囲の薄い灰色の領域として表される<DNT>**Critical**</DNT>感度 閾値を調整します。 信号の周囲の帯域が狭いほど感度が高くなり、より多くのイベントが発生します。
* [<DNT>**Warning**</DNT>閾値](/docs/alerts-applied-intelligence/new-relic-alerts/advanced-alerts/advanced-techniques/set-thresholds-alert-condition/#threshold-levels)（異常の周囲の濃い灰色の領域）を作成できます。

異常検出アラート条件を作成するには、次の手順に従います。

1. <DNT>**[one.newrelic.com &gt; All capabilities](https://one.newrelic.com/all-capabilities) &gt; Alerts &gt; Alert Conditions**</DNT>に移動します。

2. <DNT>**+ New alert condition &gt; Use guided mode**</DNT> (またはより高度なクエリ モード) をクリックします。

3. <DNT>**Set thresholds**</DNT>に到達するまで、ガイドに従って手順を実行します。

4. <DNT>**Anomaly**</DNT>を選択します。

   <DNT>
     /* &lt;img width=&quot;80%;&quot; title=&quot;Set anomoly thresholds&quot; alt=&quot;Screenshot of the anomoly thresholds options&quot; src=&quot;/images/alerts_screenshot-crop_try-anomaly-thresholds.webp&quot; /&gt; */
   </DNT>

5. アラート条件の季節性を計算するオプションを選択します。季節性とそれがアラート条件にどのように影響するかを理解するには、 [「季節性」を](#seasonality)参照してください。

6. 1 つ以上の閾値の設定を構成します。 異常検出は、以前のアクティビティに基づいて、次のデータ ポイントが何になるかを予測します。 異常検出の閾値は、実際の値が予測値からどれだけ離れているかを許容するアラート条件の感度を制御します。 閾値は、信号値が予測された値から離れている標準偏差の数です。 過去 7 日間のデータの予測値と実際の値の間の標準偏差を追跡します。

   しきい値を構成するには、次のことを行う必要があります。

   * 「閾値方向」を上、下、または両方に設定します。 つまり、信号値 (クエリの出力) が予測値を上回る場合、予測値を下回る場合、またはその両方の場合にのみ、集計 イベントが作成されます。

     このフィールドは、指定された期間中に閾値外になる必要があるデータ ポイントの数を指定します。 オプションは<DNT>**for at least**</DNT>と<DNT>**at least once in**</DNT>です。<DNT>**for at least**</DNT>を選択すると、集中イベントが開かれる前に、信号のすべてのデータ ポイントが、指定された期間、閾値の範囲外になければならないことを意味します。 人気イベントを終了するには、その逆が真でなければなりません。 <DNT>**at least once in**</DNT>オプションは、信号のデータ ポイントのいずれかが閾値の範囲外になるとすぐに、集中イベントが開始されることを単に意味します。 このオプションを使用すると、継続イベントをいつ開くかを決定する際に期間は関係ありません。 ただし、これはイベントの締めくくりに関係します。 指定された期間、すべての信号データポイントが範囲内にある必要があります

   * 「閾値期間」を設定します。 これは、イベントが開催される前にシグナル値が閾値の範囲外に留まらなければならない期間と考えてください。 逆に、これは、集中イベントが終了するためにシグナルが閾値以内になければならない時間でもあります。

     このフィールドは、上記の期間を回答します。信号が定義されているしきい値を超える長さです。これは実際のしきい値期間です。

   * 「しきい値レベル」を設定します。カスタム異常検出の場合、これはシグナルのデータ ポイントが予測した値からの標準偏差の数です。

7. アラート条件の詳細を追加し、 <DNT>**Save condition**</DNT>をクリックします。

## マルチシグナル条件のしきい値の設定 (ファセット クエリ) [#faceted-queries]

手順 1 でクエリをどのように定義したかに応じて、アラート条件は 1 つの信号だけでなく、多数の信号を監視する場合があります。NRQL を使用する場合、これらのクエリは[`FACET`句](/docs/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions/#sel-facet)を使用します。1 つのアラート条件で監視できる信号の最大数は 20,000 です。 指定した閾値設定は、この条件によって監視されているすべての信号に同じように適用されます。 各信号は個別に監視および評価されますが、設定はすべての信号に一貫して適用されます。 プレビュー チャートには最大 500 個のシグナルのみが表示されます。ただし、チャートに複数の信号が表示されている場合は、予測信号と バンドは表示されません。 理想的な閾値を決定する際にその情報を表示するには、凡例から時系列信号の 1 つを選択し、チャートを単一の時系列にフィルターします。

## 異常の方向: 上限または下限の範囲を選択します [#anomaly-direction]

予測値を上回る (「上限」) か、予測値を下回る (「下限」) か、または上回るか下回るかを条件で検索するかどうかを選択できます。これらは、予測方向セレクターで選択します。

使用例：

* エラー率のようなデータ ソースには上限設定を使用する場合があります。これは、通常、データ ソースが上昇する場合のみ考慮し、下降する場合は考慮しないためです。
* スループットのようなデータ ソースには \[下限] 設定を使用できます。これは、突然の上昇変動が非常に一般的であるためですが、突然の大幅な下降は問題を示している可能性があるためです。

以下に、さまざまな異常方向設定でデータの大きな変動がどのように処理されるかの例を示します。赤いエリアは集中イベントを表します。

<img title="A screenshot of anomaly details in the New Relic UI" alt="A screenshot demonstrating how to select upper and lower ranges for anomalies" src="/images/alerts_screenshot-full_anomalies-set-upper-and-lower-ranges.webp" />

## 予測値の計算に関するルール [#anomaly-rules]

予測を計算するアルゴリズムは数学的に複雑です。その予測能力を支配する主要なルールのいくつかを次に示します。

* <DNT>**Age of data**</DNT> 最初の作成では、データの可用性と予測の種類に応じて、1 ～ 4 週間のデータを使用して予測が計算されます。 現在、 `FACET`句を使用するクエリは保存されたデータでトレーニングされていません。 アルゴリズムは作成後、長期間にわたる継続的なデータ変動を考慮しますが、より最近のデータに大きな重みが与えられます。 短期間しか存在しないデータの場合、予測値は大きく変動する可能性があり、あまり正確ではありません。 これは、通常の値と動作を決定するのに十分なデータがないためです。 データの履歴が多いほど、予測の精度が高くなります。
* <DNT>**Consistency of data**</DNT> 一貫した範囲内に留まるメトリクス値、またはゆっくりと着実に傾向を示すメトリクス値の場合、その動作がより予測可能になるということは、その感度値が予測付近でより厳しくなるということを意味します。 データがより多様で予測不可能な場合、感度値はより緩やかな (より広い) 値になります。
* <DNT>**Regular fluctuations**</DNT> 1 週間未満の周期的変動 (毎週水曜日午後 1 時のデプロイメントや夜間のレポートなど) の場合、予測アルゴリズムはこれらの周期的変動を探し、それに調整しようとします。

## 季節性 [#seasonality]

平日のトラフィックのピークなど、シグナルの定期的な変動に対処するには、条件の季節性を指定できます。デフォルトでは、異常検出は<DNT>\*\* New Relic calculation\*\*</DNT>を使用して各信号の季節性を自動的に計算します。ただし、季節性の計算を特定の値に設定したり、完全に無効にしたりすることもできます。利用可能なオプションは次のとおりです。

* <DNT>**New Relic calculation**</DNT> (デフォルト): データの古さ、データの一貫性、定期的な変動など、いくつかの要因に基づいて各信号の季節性を自動的に決定します。
* <DNT>**Hourly**</DNT>: 異常検出の条件内のすべての信号に時間ごとのパターンを適用します。
* <DNT>**Daily**</DNT>: 条件内のすべての信号に日次パターンを適用して異常を検出します。
* <DNT>**Weekly**</DNT>: 異常検出の条件内のすべての信号に週次パターンを適用します。
* <DNT>**None**</DNT>: 季節性を完全に無効にして、信号を評価するときに季節パターンが考慮されないようにします。

<Callout variant="tip">
  現在のソリューションは、データ保持期間、計算、および期間の評価などの要素を含む計算上の制限により、月次および年次の季節性オプションをサポートしていません。
</Callout>