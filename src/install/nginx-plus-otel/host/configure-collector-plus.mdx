---
headingText: Configure the OpenTelemetry Collector
componentType: default
---

In the below OpenTelemetry Collector config snippet:

- Update the `nginx.deployment.name` value to with a unique name to identify this NGINX Plus server in a New Relic account.
- Update the `targets` value to match your Prometheus exporter host and port (default is `127.0.0.1:9113`).
- Update the `nginx.server.endpoint` value to match your API status path and port.

Merge the receivers, processors, exporters, and service pipelines from the snippet below into your current configuration (typically located at `/etc/otelcol-contrib/config.yaml`).

Note: Update the `filter/nginx_metrics` as per your requirement under the processor section in order to ingest additional metrics.

```yaml
receivers:
  prometheus:
    config:
      scrape_configs:
        - job_name: nginx-plus
          scrape_interval: 30s
          static_configs:
            - targets:
                - 127.0.0.1:9113
processors:
  batch:
    send_batch_size: 1024
    timeout: 30s
  filter/nginx_metrics:
    metrics:
      include:
        match_type: regexp
        metric_names:
          - "nginxplus_connections_.*"
          - "nginxplus_http_requests_.*"
          - "nginxplus_ssl_.*"
          - "nginxplus_server_.*"
          - "nginxplus_location_zone_.*"
          - "nginxplus_cache_.*"

      exclude:
        match_type: regexp
        metric_names:
          - "nginxplus_stream_server_.*"
          - "nginxplus_upstream_.*"
          - "nginxplus_stream_upstream_.*"
          - "nginxplus_stream_zone_sync_zone_.*"
          - "nginxplus_resolver_.*"
          - "nginxplus_limit_request_.*"
          - "nginxplus_limit_connection_.*"
          - "nginxplus_stream_limit_connection_.*"
          - "nginxplus_worker_.*"
  resource/nginx:
    attributes:
      - key: nginx.server.endpoint
        value: <API_ENDPOINT>
        action: insert
      - key: nginx.deployment.name
        value: <DEPLOYMENT_NAME>
        action: insert
  resourcedetection:
    detectors: [system]
    system:
      resource_attributes:
        host.name:
          enabled: true
        host.id:
          enabled: true
  transform/nginx:
    metric_statements:
      - context: resource
        statements:
          - set(attributes["nginx.display.name"], Concat(["server", attributes["nginx.deployment.name"]], ":"))
      - context: resource
        statements:
          - delete_key(attributes, "service.name")
exporters:
  otlphttp/newrelic:
    endpoint: ${env:NEWRELIC_OTLP_ENDPOINT}
    headers:
      api-key: ${env:NEWRELIC_LICENSE_KEY}
service:
  pipelines:
    metrics/nginx:
      receivers: [prometheus]
      processors: [batch, filter/nginx_metrics, resourcedetection, resource/nginx, transform/nginx]
      exporters: [otlphttp/newrelic]
```

Save the file and ensure the `otelcol-contrib` system user can read it.
