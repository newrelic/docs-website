---
headingText: Configure the collector for NGINX metrics
componentType: default
---

Create or replace `/etc/otelcol-contrib/config.yaml` with the configuration below. This enables the NGINX receiver, enriches metrics with resource attributes, and sends them to New Relic over OTLP.

- Update the `endpoint` and `nginx.server.endpoint` value to match your stub status path and port.
- Update the `nginx.deployment.name` value to with a unique name to identify this NGINX server in New Relic.

```yaml
receivers:
  nginx:
    metrics:
      nginx.requests:
        enabled: true
      nginx.connections_accepted:
        enabled: true
      nginx.connections_handled:
        enabled: true
      nginx.connections_current:
        enabled: true
    endpoint: <STUB_STATUS_ENDPOINT>
    collection_interval: 30s
processors:
  resourcedetection:
    detectors: [system]
    system:
      resource_attributes:
        host.name:
          enabled: true
        host.id:
          enabled: true
  resource:
    attributes:
      - action: upsert
        key: nginx.server.endpoint
        value: <STUB_STATUS_ENDPOINT>
      - action: upsert
        key: nginx.deployment.name
        value: <DEPLOYMENT_NAME>
  batch:
    timeout: 30s
    send_batch_size: 512
  transform/nginx_metrics:
    metric_statements:
      - context: resource
        statements:
          - set(attributes["nginx.display.name"], Concat(["server", attributes["nginx.deployment.name"]], ":"))
exporters:
  otlphttp/newrelic:
    endpoint: ${env:NEWRELIC_OTLP_ENDPOINT}
    headers:
      api-key: ${env:NEWRELIC_LICENSE_KEY}
    compression: gzip
extensions:
  health_check:
service:
  pipelines:
    metrics:
      receivers: [nginx]
      processors: [resourcedetection, resource, batch, transform/nginx_metrics]
      exporters: [otlphttp/newrelic]
```

Save the file and ensure the `otelcol-contrib` system user can read it.
