---
componentType: default
headingText: Enable MySQL query-level monitoring
---

Configure your integration to enable query-level monitoring in New Relic. By setting the appropriate parameters, you can capture detailed metrics on query performance, which allows you to identify and optimize slow or inefficient queries. For more information, refer [Query-Level monitoring](/docs/infrastructure/infrastructure-data/query-level-monitoring).


<Callout variant="important">
Query-level monitoring is supported only on MySQL version 8.0 and later.
</Callout>


1. Open the MySQL configuration file available at `C:\ProgramData\MySQL\MySQL Server 8.0\my.ini`, then add the following lines to the configuration file:
   ```ini
   [mysqld]
   performance_schema=ON
   max_digest_length = 4096
   performance_schema_max_digest_length = 4096
   performance_schema_max_sql_text_length = 4096
    
   # Enable the necessary Performance Schema instruments and consumers
   performance-schema-instrument='statement/%=ON'
   performance-schema-consumer-events-statements-current=ON
   performance-schema-consumer-events-statements-history=ON
   performance-schema-consumer-events-statements-history-long=ON
   performance-schema-consumer-events-statements-cpu=ON
   performance-schema-instrument='wait/%=ON'
   performance-schema-consumer-events-waits-current=ON
   performance-schema-consumer-events-waits-history=ON
   performance-schema-consumer-events-waits-history-long=ON
   performance-schema-instrument='%lock%=ON'
   ```

2. To apply the changes made to the configuration file, run the following command, and restart MySQL server:
   ```shell
    Restart-Service -Name "MySQL80"
   ```
3. To check the MySQL server status, run the following command:
   ```shell
    Get-Service -Name "MySQL80"
   ```
4. Create the following schema
   ```sql
   CREATE SCHEMA IF NOT EXISTS newrelic;
   GRANT EXECUTE ON newrelic.* TO 'newrelic'@'localhost';
   ```
5. Runtime setup consumers
   <Callout variant="tip">
   Newrelic recommends that you create the following procedure to grant the Agent the ability to enable performance_schema.events_* `consumers` and `instruments` at runtime.
   </Callout>
   <>&nbsp;</>
   ```sql
   DELIMITER $$
   CREATE PROCEDURE newrelic.enable_essential_consumers_and_instruments()
      SQL SECURITY DEFINER
   BEGIN
      UPDATE performance_schema.setup_consumers SET enabled='YES' WHERE name LIKE 'events_statements_%' OR name LIKE 'events_waits_%';
      UPDATE performance_schema.setup_instruments SET ENABLED = 'YES', TIMED = 'YES' WHERE NAME LIKE 'wait/%' OR NAME LIKE 'statement/%' OR NAME LIKE '%lock%';
   END $$
   DELIMITER ;
   GRANT EXECUTE ON PROCEDURE newrelic.enable_essential_consumers_and_instruments TO 'newrelic'@'localhost';
   ```